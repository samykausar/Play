<div class="part" title="Part&nbsp;V.&nbsp;The Web">
 <div class="titlepage">
  <div>
   <div>
    <h1 class="title"><a name="spring-web"></a>Part&nbsp;V.&nbsp;The Web</h1>
   </div>
  </div>
 </div> 
 <div class="partintro" title="The Web">
  <div></div> 
  <p>This part of the reference documentation covers Spring Frameworks support for the presentation tier (and specifically web-based presentation tiers) including support for WebSocket-style messaging in web applications.</p> 
  <p>Spring Frameworks own web framework, <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc" title="16.&nbsp;Web MVC framework">Spring Web MVC</a>, is covered in the first couple of chapters. Subsequent chapters are concerned with Spring Frameworks integration with other web technologies, such as <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#struts" title="18.4&nbsp;Apache Struts 2.x">Struts</a> <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#jsf" title="18.3&nbsp;JavaServer Faces 1.2">JSF</a> and others.</p> 
  <p>Following that is coverage of Spring Frameworks MVC <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#portlet" title="19.&nbsp;Portlet MVC Framework">portlet framework</a>.</p> 
  <p>The section then concludes with comprehensive coverage of the Spring Framework <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#websocket" title="20.&nbsp;WebSocket Support">Chapter&nbsp;20, <i>WebSocket Support</i></a> (including <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#websocket-stomp" title="20.4&nbsp;STOMP Messaging">Section&nbsp;20.4, STOMP Messaging</a>).</p> 
  <div class="itemizedlist">
   <ul class="itemizedlist" type="disc">
    <li class="listitem"> <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc" title="16.&nbsp;Web MVC framework">Chapter&nbsp;16, <i>Web MVC framework</i></a> </li>
    <li class="listitem"> <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#view" title="17.&nbsp;View technologies">Chapter&nbsp;17, <i>View technologies</i></a> </li>
    <li class="listitem"> <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#web-integration" title="18.&nbsp;Integrating with other web frameworks">Chapter&nbsp;18, <i>Integrating with other web frameworks</i></a> </li>
    <li class="listitem"> <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#portlet" title="19.&nbsp;Portlet MVC Framework">Chapter&nbsp;19, <i>Portlet MVC Framework</i></a> </li>
    <li class="listitem"> <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#websocket" title="20.&nbsp;WebSocket Support">Chapter&nbsp;20, <i>WebSocket Support</i></a> </li>
   </ul>
  </div> 
 </div> 
 <div class="chapter" title="16.&nbsp;Web MVC framework">
  <div class="titlepage">
   <div>
    <div>
     <h2 class="title"><a name="mvc"></a>16.&nbsp;Web MVC framework</h2>
    </div>
   </div>
  </div> 
  <div class="section" title="16.1&nbsp;Introduction to Spring Web MVC framework">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="mvc-introduction"></a>16.1&nbsp;Introduction to Spring Web MVC framework</h2>
     </div>
    </div>
   </div> 
   <p>The Spring Web model-view-controller (MVC) framework is designed around a <code class="literal">DispatcherServlet</code> that dispatches requests to handlers, with configurable handler mappings, view resolution, locale, time zone and theme resolution as well as support for uploading files. The default handler is based on the <code class="literal">@Controller</code> and <code class="literal">@RequestMapping</code> annotations, offering a wide range of flexible handling methods. With the introduction of Spring 3.0, the <code class="literal">@Controller</code> mechanism also allows you to create RESTful Web sites and applications, through the <code class="literal">@PathVariable</code> annotation and other features.</p> 
   <div class="sidebar">
    <p class="title"><b></b></p> 
    <p>&quot;Open for extension&quot; A key design principle in Spring Web MVC and in Spring in general is the &quot;<span class="emphasis"><em>Open for extension, closed for modification</em></span>&quot; principle.</p> 
    <p>Some methods in the core classes of Spring Web MVC are marked <code class="literal">final</code>. As a developer you cannot override these methods to supply your own behavior. This has not been done arbitrarily, but specifically with this principle in mind.</p> 
    <p>For an explanation of this principle, refer to <span class="emphasis"><em>Expert Spring Web MVC and Web Flow</em></span> by Seth Ladd and others; specifically see the section &quot;A Look At Design,&quot; on page 117 of the first edition. Alternatively, see</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> <a class="ulink" href="http://www.objectmentor.com/resources/articles/ocp.pdf" target="_top">Bob Martin, The Open-Closed Principle (PDF)</a> </li>
     </ul>
    </div> 
    <p>You cannot add advice to final methods when you use Spring MVC. For example, you cannot add advice to the <code class="literal">AbstractController.setSynchronizeOnSession()</code> method. Refer to <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-understanding-aop-proxies" title="8.6.1&nbsp;Understanding AOP proxies">Section&nbsp;8.6.1, Understanding AOP proxies</a> for more information on AOP proxies and why you cannot add advice to final methods.</p> 
   </div> 
   <p>In Spring Web MVC you can use any object as a command or form-backing object; you do not need to implement a framework-specific interface or base class. Springs data binding is highly flexible: for example, it treats type mismatches as validation errors that can be evaluated by the application, not as system errors. Thus you need not duplicate your business objects' properties as simple, untyped strings in your form objects simply to handle invalid submissions, or to convert the Strings properly. Instead, it is often preferable to bind directly to your business objects.</p> 
   <p>Springs view resolution is extremely flexible. A <code class="literal">Controller</code> is typically responsible for preparing a model <code class="literal">Map</code> with data and selecting a view name but it can also write directly to the response stream and complete the request. View name resolution is highly configurable through file extension or Accept header content type negotiation, through bean names, a properties file, or even a custom <code class="literal">ViewResolver</code> implementation. The model (the M in MVC) is a <code class="literal">Map</code> interface, which allows for the complete abstraction of the view technology. You can integrate directly with template based rendering technologies such as JSP, Velocity and Freemarker, or directly generate XML, JSON, Atom, and many other types of content. The model <code class="literal">Map</code> is simply transformed into an appropriate format, such as JSP request attributes, a Velocity template model.</p> 
   <div class="section" title="16.1.1&nbsp;Features of Spring Web MVC">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-features"></a>16.1.1&nbsp;Features of Spring Web MVC</h3>
      </div>
     </div>
    </div> 
    <div class="sidebar" title="Spring Web Flow">
     <p class="title"><b>Spring Web Flow</b></p> 
     <p>Spring Web Flow (SWF) aims to be the best solution for the management of web application page flow.</p> 
     <p>SWF integrates with existing frameworks like Spring MVC, Struts, and JSF, in both servlet and portlet environments. If you have a business process (or processes) that would benefit from a conversational model as opposed to a purely request model, then SWF may be the solution.</p> 
     <p>SWF allows you to capture logical page flows as self-contained modules that are reusable in different situations, and as such is ideal for building web application modules that guide the user through controlled navigations that drive business processes.</p> 
     <p>For more information about SWF, consult the <a class="ulink" href="http://projects.spring.io/spring-webflow/" target="_top">Spring Web Flow website</a>.</p> 
    </div> 
    <p>Springs web module includes many unique web support features:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> <span class="emphasis"><em>Clear separation of roles</em></span>. Each role&#x2009;&#x2009;controller, validator, command object, form object, model object, <code class="literal">DispatcherServlet</code>, handler mapping, view resolver, and so on&#x2009;&#x2009;can be fulfilled by a specialized object. </li>
      <li class="listitem"> <span class="emphasis"><em>Powerful and straightforward configuration of both framework and application classes as JavaBeans</em></span>. This configuration capability includes easy referencing across contexts, such as from web controllers to business objects and validators. </li>
      <li class="listitem"> <span class="emphasis"><em>Adaptability, non-intrusiveness, and flexibility.</em></span> Define any controller method signature you need, possibly using one of the parameter annotations (such as @RequestParam, @RequestHeader, @PathVariable, and more) for a given scenario. </li>
      <li class="listitem"> <span class="emphasis"><em>Reusable business code, no need for duplication</em></span>. Use existing business objects as command or form objects instead of mirroring them to extend a particular framework base class. </li>
      <li class="listitem"> <span class="emphasis"><em>Customizable binding and validation</em></span>. Type mismatches as application-level validation errors that keep the offending value, localized date and number binding, and so on instead of String-only form objects with manual parsing and conversion to business objects. </li>
      <li class="listitem"> <span class="emphasis"><em>Customizable handler mapping and view resolution</em></span>. Handler mapping and view resolution strategies range from simple URL-based configuration, to sophisticated, purpose-built resolution strategies. Spring is more flexible than web MVC frameworks that mandate a particular technique. </li>
      <li class="listitem"> <span class="emphasis"><em>Flexible model transfer</em></span>. Model transfer with a name/value <code class="literal">Map</code> supports easy integration with any view technology. </li>
      <li class="listitem"> <span class="emphasis"><em>Customizable locale, time zone and theme resolution, support for JSPs with or without Spring tag library, support for JSTL, support for Velocity without the need for extra bridges, and so on.</em></span> </li>
      <li class="listitem"> <span class="emphasis"><em>A simple yet powerful JSP tag library known as the Spring tag library that provides support for features such as data binding and themes</em></span>. The custom tags allow for maximum flexibility in terms of markup code. For information on the tag library descriptor, see the appendix entitled <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#spring.tld" title="35.&nbsp;spring.tld">Chapter&nbsp;35, <i>spring.tld</i></a> </li>
      <li class="listitem"> <span class="emphasis"><em>A JSP form tag library, introduced in Spring 2.0, that makes writing forms in JSP pages much easier.</em></span> For information on the tag library descriptor, see the appendix entitled <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#spring-form.tld" title="36.&nbsp;spring-form.tld">Chapter&nbsp;36, <i>spring-form.tld</i></a> </li>
      <li class="listitem"> <span class="emphasis"><em>Beans whose lifecycle is scoped to the current HTTP request or HTTP <code class="literal">Session</code>.</em></span> This is not a specific feature of Spring MVC itself, but rather of the <code class="literal">WebApplicationContext</code> container(s) that Spring MVC uses. These bean scopes are described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes-other" title="4.5.4&nbsp;Request, session, and global session scopes">Section&nbsp;4.5.4, Request, session, and global session scopes</a> </li>
     </ul>
    </div> 
   </div> 
   <div class="section" title="16.1.2&nbsp;Pluggability of other MVC implementations">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-introduction-pluggability"></a>16.1.2&nbsp;Pluggability of other MVC implementations</h3>
      </div>
     </div>
    </div> 
    <p>Non-Spring MVC implementations are preferable for some projects. Many teams expect to leverage their existing investment in skills and tools. A large body of knowledge and experience exist for the Struts framework. If you can abide Struts' architectural flaws, it can be a viable choice for the web layer; the same applies to JSF and other web MVC frameworks.</p> 
    <p>If you do not want to use Springs web MVC, but intend to leverage other solutions that Spring offers, you can integrate the web MVC framework of your choice with Spring easily. Simply start up a Spring root application context through its <code class="literal">ContextLoaderListener</code>, and access it through its <code class="literal">ServletContext</code> attribute (or Springs respective helper method) from within a Struts action. No &quot;plug-ins&quot; are involved, so no dedicated integration is necessary. From the web layers point of view, you simply use Spring as a library, with the root application context instance as the entry point.</p> 
    <p>Your registered beans and Springs services can be at your fingertips even without Springs Web MVC. Spring does not compete with Struts in this scenario. It simply addresses the many areas that the pure web MVC frameworks do not, from bean configuration to data access and transaction handling. So you can enrich your application with a Spring middle tier and/or data access tier, even if you just want to use, for example, the transaction abstraction with JDBC or Hibernate.</p> 
   </div> 
  </div> 
  <div class="section" title="16.2&nbsp;The DispatcherServlet">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="mvc-servlet"></a>16.2&nbsp;The DispatcherServlet</h2>
     </div>
    </div>
   </div> 
   <p>Springs web MVC framework is, like many other web MVC frameworks, request-driven, designed around a central Servlet that dispatches requests to controllers and offers other functionality that facilitates the development of web applications. Springs <code class="literal">DispatcherServlet</code> however, does more than just that. It is completely integrated with the Spring IoC container and as such allows you to use every other feature that Spring has.</p> 
   <p>The request processing workflow of the Spring Web MVC <code class="literal">DispatcherServlet</code> is illustrated in the following diagram. The pattern-savvy reader will recognize that the <code class="literal">DispatcherServlet</code> is an expression of the &quot;Front Controller&quot; design pattern (this is a pattern that Spring Web MVC shares with many other leading web frameworks).</p> 
   <div class="figure">
    <a name="d4e12848"></a>
    <p class="title"><b>Figure&nbsp;16.1.&nbsp;</b></p>
    <div class="figure-contents"> 
     <div class="mediaobject">
      <img src="./Spring Framework Reference Documentation_files/mvc.png" alt="mvc" />
     </div> 
    </div>
   </div>
   <br class="figure-break" /> 
   <p>The request processing workflow in Spring Web MVC (high level)</p> 
   <p>The <code class="literal">DispatcherServlet</code> is an actual <code class="literal">Servlet</code> (it inherits from the <code class="literal">HttpServlet</code> base class), and as such is declared in the <code class="literal">web.xml</code> of your web application. You need to map requests that you want the <code class="literal">DispatcherServlet</code> to handle, by using a URL mapping in the same <code class="literal">web.xml</code> file. This is standard Java EE Servlet configuration; the following example shows such a <code class="literal">DispatcherServlet</code> declaration and mapping:</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;web-app&gt;</span>
    <span class="hl-tag">&lt;servlet&gt;</span>
        <span class="hl-tag">&lt;servlet-name&gt;</span>example<span class="hl-tag">&lt;/servlet-name&gt;</span>
        <span class="hl-tag">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hl-tag">&lt;/servlet-class&gt;</span>
        <span class="hl-tag">&lt;load-on-startup&gt;</span>1<span class="hl-tag">&lt;/load-on-startup&gt;</span>
    <span class="hl-tag">&lt;/servlet&gt;</span>

    <span class="hl-tag">&lt;servlet-mapping&gt;</span>
        <span class="hl-tag">&lt;servlet-name&gt;</span>example<span class="hl-tag">&lt;/servlet-name&gt;</span>
        <span class="hl-tag">&lt;url-pattern&gt;</span>/example/*<span class="hl-tag">&lt;/url-pattern&gt;</span>
    <span class="hl-tag">&lt;/servlet-mapping&gt;</span>

<span class="hl-tag">&lt;/web-app&gt;</span></pre> 
   <p>In the preceding example, all requests starting with <code class="literal">/example</code> will be handled by the <code class="literal">DispatcherServlet</code> instance named <code class="literal">example</code>. In a Servlet 3.0+ environment, you also have the option of configuring the Servlet container programmatically. Below is the code based equivalent of the above <code class="literal">web.xml</code> example:</p> 
   <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWebApplicationInitializer <span class="hl-keyword">implements</span> WebApplicationInitializer {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> onStartup(ServletContext container) {
        ServletRegistration.Dynamic registration = container.addServlet(<span class="hl-string">&quot;dispatcher&quot;</span>, <span class="hl-keyword">new</span> DispatcherServlet());
        registration.setLoadOnStartup(<span class="hl-number">1</span>);
        registration.addMapping(<span class="hl-string">&quot;/example/*&quot;</span>);
    }

}</pre> 
   <p><code class="literal">WebApplicationInitializer</code> is an interface provided by Spring MVC that ensures your code-based configuration is detected and automatically used to initialize any Servlet 3 container. An abstract base class implementation of this interace named <code class="literal">AbstractDispatcherServletInitializer</code> makes it even easier to register the <code class="literal">DispatcherServlet</code> by simply specifying its servlet mapping. See <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-container-config" title="16.15&nbsp;Code-based Servlet container initialization">Code-based Servlet container initialization</a> for more details.</p> 
   <p>The above is only the first step in setting up Spring Web MVC. You now need to configure the various beans used by the Spring Web MVC framework (over and above the <code class="literal">DispatcherServlet</code> itself).</p> 
   <p>As detailed in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#context-introduction" title="4.16&nbsp;Additional Capabilities of the ApplicationContext">Section&nbsp;4.16, Additional Capabilities of the ApplicationContext</a>, <code class="literal">ApplicationContext</code> instances in Spring can be scoped. In the Web MVC framework, each <code class="literal">DispatcherServlet</code> has its own <code class="literal">WebApplicationContext</code>, which inherits all the beans already defined in the root <code class="literal">WebApplicationContext</code>. These inherited beans can be overridden in the servlet-specific scope, and you can define new scope-specific beans local to a given Servlet instance.</p> 
   <div class="figure">
    <a name="d4e12883"></a>
    <p class="title"><b>Figure&nbsp;16.2.&nbsp;Context hierarchy in Spring Web MVC</b></p>
    <div class="figure-contents"> 
     <div class="mediaobject">
      <img src="./Spring Framework Reference Documentation_files/mvc-contexts.gif" alt="mvc contexts" />
     </div> 
    </div>
   </div>
   <br class="figure-break" /> 
   <p>Upon initialization of a <code class="literal">DispatcherServlet</code>, Spring MVC looks for a file named <span class="emphasis"><em>[servlet-name]-servlet.xml</em></span> in the <code class="literal">WEB-INF</code> directory of your web application and creates the beans defined there, overriding the definitions of any beans defined with the same name in the global scope.</p> 
   <p>Consider the following <code class="literal">DispatcherServlet</code> Servlet configuration (in the <code class="literal">web.xml</code> file):</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;web-app&gt;</span>
    <span class="hl-tag">&lt;servlet&gt;</span>
        <span class="hl-tag">&lt;servlet-name&gt;</span><span class="strong"><strong>golfing</strong></span><span class="hl-tag">&lt;/servlet-name&gt;</span>
        <span class="hl-tag">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hl-tag">&lt;/servlet-class&gt;</span>
        <span class="hl-tag">&lt;load-on-startup&gt;</span>1<span class="hl-tag">&lt;/load-on-startup&gt;</span>
    <span class="hl-tag">&lt;/servlet&gt;</span>
    <span class="hl-tag">&lt;servlet-mapping&gt;</span>
        <span class="hl-tag">&lt;servlet-name&gt;</span><span class="strong"><strong>golfing</strong></span><span class="hl-tag">&lt;/servlet-name&gt;</span>
        <span class="hl-tag">&lt;url-pattern&gt;</span>/golfing/*<span class="hl-tag">&lt;/url-pattern&gt;</span>
    <span class="hl-tag">&lt;/servlet-mapping&gt;</span>
<span class="hl-tag">&lt;/web-app&gt;</span></pre> 
   <p>With the above Servlet configuration in place, you will need to have a file called <code class="literal">/WEB-INF/golfing-servlet.xml</code> in your application; this file will contain all of your Spring Web MVC-specific components (beans). You can change the exact location of this configuration file through a Servlet initialization parameter (see below for details).</p> 
   <p>The <code class="literal">WebApplicationContext</code> is an extension of the plain <code class="literal">ApplicationContext</code> that has some extra features necessary for web applications. It differs from a normal <code class="literal">ApplicationContext</code> in that it is capable of resolving themes (see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-themeresolver" title="16.10&nbsp;Using themes">Section&nbsp;16.10, Using themes</a>), and that it knows which Servlet it is associated with (by having a link to the <code class="literal">ServletContext</code>). The <code class="literal">WebApplicationContext</code> is bound in the <code class="literal">ServletContext</code>, and by using static methods on the <code class="literal">RequestContextUtils</code> class you can always look up the <code class="literal">WebApplicationContext</code> if you need access to it.</p> 
   <div class="section" title="16.2.1&nbsp;Special Bean Types In the WebApplicationContext">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-servlet-special-bean-types"></a>16.2.1&nbsp;Special Bean Types In the WebApplicationContext</h3>
      </div>
     </div>
    </div> 
    <p>The Spring <code class="literal">DispatcherServlet</code> uses special beans to process requests and render the appropriate views. These beans are part of Spring MVC. You can choose which special beans to use by simply configuring one or more of them in the <code class="literal">WebApplicationContext</code>. However, you dont need to do that initially since Spring MVC maintains a list of default beans to use if you dont configure any. More on that in the next section. First see the table below listing the special bean types the <code class="literal">DispatcherServlet</code> relies on.</p> 
    <div class="table">
     <a name="mvc-webappctx-special-beans-tbl"></a>
     <p class="title"><b>Table&nbsp;16.1.&nbsp;Special bean types in the WebApplicationContext</b></p>
     <div class="table-contents"> 
      <table summary="Special bean types in the WebApplicationContext" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
       <colgroup>
        <col />
        <col />
       </colgroup>
       <thead>
        <tr>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Bean type</th>
         <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explanation</th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-handlermapping" title="16.4&nbsp;Handler mappings">HandlerMapping</a></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Maps incoming requests to handlers and a list of pre- and post-processors (handler interceptors) based on some criteria the details of which vary by <code class="literal">HandlerMapping</code> implementation. The most popular implementation supports annotated controllers but other implementations exists as well.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>HandlerAdapter</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Helps the <code class="literal">DispatcherServlet</code> to invoke a handler mapped to a request regardless of the handler is actually invoked. For example, invoking an annotated controller requires resolving various annotations. Thus the main purpose of a <code class="literal">HandlerAdapter</code> is to shield the <code class="literal">DispatcherServlet</code> from such details.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-exceptionhandlers" title="16.12&nbsp;Handling exceptions">HandlerExceptionResolver</a></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Maps exceptions to views also allowing for more complex exception handling code.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-viewresolver" title="16.5&nbsp;Resolving views">ViewResolver</a></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Resolves logical String-based view names to actual <code class="literal">View</code> types.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-localeresolver" title="16.9&nbsp;Using locales">LocaleResolver</a> &amp; <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-timezone" title="16.9.1&nbsp;Obtaining Time Zone Information">LocaleContextResolver</a></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Resolves the locale a client is using and possibly their time zone, in order to be able to offer internationalized views</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-themeresolver" title="16.10&nbsp;Using themes">ThemeResolver</a></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Resolves themes your web application can use, for example, to offer personalized layouts</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-multipart" title="16.11&nbsp;Springs multipart (file upload) support">MultipartResolver</a></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Parses multi-part requests for example to support processing file uploads from HTML forms.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-flash-attributes" title="16.6&nbsp;Using flash attributes">FlashMapManager</a></p></td>
         <td style="" align="left" valign="top"><p>Stores and retrieves the &quot;input&quot; and the &quot;output&quot; <code class="literal">FlashMap</code> that can be used to pass attributes from one request to another, usually across a redirect.</p></td>
        </tr>
       </tbody>
      </table> 
     </div>
    </div>
    <br class="table-break" /> 
   </div> 
   <div class="section" title="16.2.2&nbsp;Default DispatcherServlet Configuration">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-servlet-config"></a>16.2.2&nbsp;Default DispatcherServlet Configuration</h3>
      </div>
     </div>
    </div> 
    <p>As mentioned in the previous section for each special bean the <code class="literal">DispatcherServlet</code> maintains a list of implementations to use by default. This information is kept in the file <code class="literal">DispatcherServlet.properties</code> in the package <code class="literal">org.springframework.web.servlet</code>.</p> 
    <p>All special beans have some reasonable defaults of their own. Sooner or later though youll need to customize one or more of the properties these beans provide. For example its quite common to configure an <code class="literal">InternalResourceViewResolver</code> settings its <code class="literal">prefix</code> property to the parent location of view files.</p> 
    <p>Regardless of the details, the important concept to understand here is that once you configure a special bean such as an <code class="literal">InternalResourceViewResolver</code> in your <code class="literal">WebApplicationContext</code>, you effectively override the list of default implementations that would have been used otherwise for that special bean type. For example if you configure an <code class="literal">InternalResourceViewResolver</code>, the default list of <code class="literal">ViewResolver</code> implementations is ignored.</p> 
    <p>In <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-config" title="16.16&nbsp;Configuring Spring MVC">Section&nbsp;16.16, Configuring Spring MVC</a> youll learn about other options for configuring Spring MVC including MVC Java config and the MVC XML namespace both of which provide a simple starting point and assume little knowledge of how Spring MVC works. Regardless of how you choose to configure your application, the concepts explained in this section are fundamental should be of help to you.</p> 
   </div> 
   <div class="section" title="16.2.3&nbsp;DispatcherServlet Processing Sequence">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-servlet-sequence"></a>16.2.3&nbsp;DispatcherServlet Processing Sequence</h3>
      </div>
     </div>
    </div> 
    <p>After you set up a <code class="literal">DispatcherServlet</code>, and a request comes in for that specific <code class="literal">DispatcherServlet</code>, the <code class="literal">DispatcherServlet</code> starts processing the request as follows:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> The <code class="literal">WebApplicationContext</code> is searched for and bound in the request as an attribute that the controller and other elements in the process can use. It is bound by default under the key <code class="literal">DispatcherServlet.WEB_APPLICATION_CONTEXT_ATTRIBUTE</code>. </li>
      <li class="listitem"> The locale resolver is bound to the request to enable elements in the process to resolve the locale to use when processing the request (rendering the view, preparing data, and so on). If you do not need locale resolving, you do not need it. </li>
      <li class="listitem"> The theme resolver is bound to the request to let elements such as views determine which theme to use. If you do not use themes, you can ignore it. </li>
      <li class="listitem"> If you specify a multipart file resolver, the request is inspected for multiparts; if multiparts are found, the request is wrapped in a <code class="literal">MultipartHttpServletRequest</code> for further processing by other elements in the process. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-multipart" title="16.11&nbsp;Springs multipart (file upload) support">Section&nbsp;16.11, Springs multipart (file upload) support</a> for further information about multipart handling. </li>
      <li class="listitem"> An appropriate handler is searched for. If a handler is found, the execution chain associated with the handler (preprocessors, postprocessors, and controllers) is executed in order to prepare a model or rendering. </li>
      <li class="listitem"> If a model is returned, the view is rendered. If no model is returned, (may be due to a preprocessor or postprocessor intercepting the request, perhaps for security reasons), no view is rendered, because the request could already have been fulfilled. </li>
     </ul>
    </div> 
    <p>Handler exception resolvers that are declared in the <code class="literal">WebApplicationContext</code> pick up exceptions that are thrown during processing of the request. Using these exception resolvers allows you to define custom behaviors to address exceptions.</p> 
    <p>The Spring <code class="literal">DispatcherServlet</code> also supports the return of the <span class="emphasis"><em>last-modification-date</em></span>, as specified by the Servlet API. The process of determining the last modification date for a specific request is straightforward: the <code class="literal">DispatcherServlet</code> looks up an appropriate handler mapping and tests whether the handler that is found implements the <span class="emphasis"><em>LastModified</em></span> interface. If so, the value of the <code class="literal">long getLastModified(request)</code> method of the <code class="literal">LastModified</code> interface is returned to the client.</p> 
    <p>You can customize individual <code class="literal">DispatcherServlet</code> instances by adding Servlet initialization parameters ( <code class="literal">init-param</code> elements) to the Servlet declaration in the <code class="literal">web.xml</code> file. See the following table for the list of supported parameters.</p> 
    <div class="table">
     <a name="mvc-disp-servlet-init-params-tbl"></a>
     <p class="title"><b>Table&nbsp;16.2.&nbsp;DispatcherServlet initialization parameters</b></p>
     <div class="table-contents"> 
      <table summary="DispatcherServlet initialization parameters" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
       <colgroup>
        <col />
        <col />
       </colgroup>
       <thead>
        <tr>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Parameter</th>
         <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explanation</th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">contextClass</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Class that implements <code class="literal">WebApplicationContext</code>, which instantiates the context used by this Servlet. By default, the <code class="literal">XmlWebApplicationContext</code> is used.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">contextConfigLocation</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>String that is passed to the context instance (specified by <code class="literal">contextClass</code>) to indicate where context(s) can be found. The string consists potentially of multiple strings (using a comma as a delimiter) to support multiple contexts. In case of multiple context locations with beans that are defined twice, the latest location takes precedence.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">namespace</code></p></td>
         <td style="" align="left" valign="top"><p>Namespace of the <code class="literal">WebApplicationContext</code>. Defaults to <code class="literal">[servlet-name]-servlet</code>.</p></td>
        </tr>
       </tbody>
      </table> 
     </div>
    </div>
    <br class="table-break" /> 
   </div> 
  </div> 
  <div class="section" title="16.3&nbsp;Implementing Controllers">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="mvc-controller"></a>16.3&nbsp;Implementing Controllers</h2>
     </div>
    </div>
   </div> 
   <p>Controllers provide access to the application behavior that you typically define through a service interface. Controllers interpret user input and transform it into a model that is represented to the user by the view. Spring implements a controller in a very abstract way, which enables you to create a wide variety of controllers.</p> 
   <p>Spring 2.5 introduced an annotation-based programming model for MVC controllers that uses annotations such as <code class="literal">@RequestMapping</code>, <code class="literal">@RequestParam</code>, <code class="literal">@ModelAttribute</code>, and so on. This annotation support is available for both Servlet MVC and Portlet MVC. Controllers implemented in this style do not have to extend specific base classes or implement specific interfaces. Furthermore, they do not usually have direct dependencies on Servlet or Portlet APIs, although you can easily configure access to Servlet or Portlet facilities.</p> 
   <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Tip">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
       <th align="left">Tip</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>Available in the <a class="ulink" href="https://github.com/spring-projects/" target="_top">spring-projects Org on Github</a>, a number of web applications leverage the annotation support described in this section including <span class="emphasis"><em>MvcShowcase</em></span>, <span class="emphasis"><em>MvcAjax</em></span>, <span class="emphasis"><em>MvcBasic</em></span>, <span class="emphasis"><em>PetClinic</em></span>, <span class="emphasis"><em>PetCare</em></span>, and others.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HelloWorldController {

    <i><span class="hl-annotation" style="color: gray">@RequestMapping(&quot;/helloWorld&quot;)</span></i>
    <span class="hl-keyword">public</span> String helloWorld(Model model) {
        model.addAttribute(<span class="hl-string">&quot;message&quot;</span>, <span class="hl-string">&quot;Hello World!&quot;</span>);
        <span class="hl-keyword">return</span> <span class="hl-string">&quot;helloWorld&quot;</span>;
    }
}</pre> 
   <p>As you can see, the <code class="literal">@Controller</code> and <code class="literal">@RequestMapping</code> annotations allow flexible method names and signatures. In this particular example the method accepts a <code class="literal">Model</code> and returns a view name as a <code class="literal">String</code>, but various other method parameters and return values can be used as explained later in this section. <code class="literal">@Controller</code> and <code class="literal">@RequestMapping</code> and a number of other annotations form the basis for the Spring MVC implementation. This section documents these annotations and how they are most commonly used in a Servlet environment.</p> 
   <div class="section" title="16.3.1&nbsp;Defining a controller with @Controller">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-ann-controller"></a>16.3.1&nbsp;Defining a controller with @Controller</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">@Controller</code> annotation indicates that a particular class serves the role of a <span class="emphasis"><em>controller</em></span>. Spring does not require you to extend any controller base class or reference the Servlet API. However, you can still reference Servlet-specific features if you need to.</p> 
    <p>The <code class="literal">@Controller</code> annotation acts as a stereotype for the annotated class, indicating its role. The dispatcher scans such annotated classes for mapped methods and detects <code class="literal">@RequestMapping</code> annotations (see the next section).</p> 
    <p>You can define annotated controller beans explicitly, using a standard Spring bean definition in the dispatchers context. However, the <code class="literal">@Controller</code> stereotype also allows for autodetection, aligned with Spring general support for detecting component classes in the classpath and auto-registering bean definitions for them.</p> 
    <p>To enable autodetection of such annotated controllers, you add component scanning to your configuration. Use the <span class="emphasis"><em>spring-context</em></span> schema as shown in the following XML snippet:</p> 
    <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:p</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/p&quot;</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/context&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">&quot;org.springframework.samples.petclinic.web&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- ... --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
   </div> 
   <div class="section" title="16.3.2&nbsp;Mapping Requests With Using @RequestMapping">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-ann-requestmapping"></a>16.3.2&nbsp;Mapping Requests With Using @RequestMapping</h3>
      </div>
     </div>
    </div> 
    <p>You use the <code class="literal">@RequestMapping</code> annotation to map URLs such as <code class="literal">/appointments</code> onto an entire class or a particular handler method. Typically the class-level annotation maps a specific request path (or path pattern) onto a form controller, with additional method-level annotations narrowing the primary mapping for a specific HTTP method request method (&quot;GET&quot;, &quot;POST&quot;, etc.) or an HTTP request parameter condition.</p> 
    <p>The following example from the <span class="emphasis"><em>Petcare</em></span> sample shows a controller in a Spring MVC application that uses this annotation:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<span class="strong"><strong>@RequestMapping(&quot;/appointments&quot;)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppointmentsController {

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> AppointmentBook appointmentBook;

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">public</span> AppointmentsController(AppointmentBook appointmentBook) {
        <span class="hl-keyword">this</span>.appointmentBook = appointmentBook;
    }

    <span class="strong"><strong>@RequestMapping(method = RequestMethod.GET)</strong></span>
    <span class="hl-keyword">public</span> Map&lt;String, Appointment&gt; get() {
        <span class="hl-keyword">return</span> appointmentBook.getAppointmentsForToday();
    }

    <span class="strong"><strong>@RequestMapping(value=&quot;/{day}&quot;, method = RequestMethod.GET)</strong></span>
    <span class="hl-keyword">public</span> Map&lt;String, Appointment&gt; getForDay(<i><span class="hl-annotation" style="color: gray">@PathVariable</span></i> <i><span class="hl-annotation" style="color: gray">@DateTimeFormat(iso=ISO.DATE)</span></i> Date day, Model model) {
        <span class="hl-keyword">return</span> appointmentBook.getAppointmentsForDay(day);
    }

    <span class="strong"><strong>@RequestMapping(value=&quot;/new&quot;, method = RequestMethod.GET)</strong></span>
    <span class="hl-keyword">public</span> AppointmentForm getNewForm() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> AppointmentForm();
    }

    <span class="strong"><strong>@RequestMapping(method = RequestMethod.POST)</strong></span>
    <span class="hl-keyword">public</span> String add(<i><span class="hl-annotation" style="color: gray">@Valid</span></i> AppointmentForm appointment, BindingResult result) {
        <span class="hl-keyword">if</span> (result.hasErrors()) {
            <span class="hl-keyword">return</span> <span class="hl-string">&quot;appointments/new&quot;</span>;
        }
        appointmentBook.addAppointment(appointment);
        <span class="hl-keyword">return</span> <span class="hl-string">&quot;redirect:/appointments&quot;</span>;
    }
}</pre> 
    <p>In the example, the <code class="literal">@RequestMapping</code> is used in a number of places. The first usage is on the type (class) level, which indicates that all handling methods on this controller are relative to the <code class="literal">/appointments</code> path. The <code class="literal">get()</code> method has a further <code class="literal">@RequestMapping</code> refinement: it only accepts GET requests, meaning that an HTTP GET for <code class="literal">/appointments</code> invokes this method. The <code class="literal">post()</code> has a similar refinement, and the <code class="literal">getNewForm()</code> combines the definition of HTTP method and path into one, so that GET requests for <code class="literal">appointments/new</code> are handled by that method.</p> 
    <p>The <code class="literal">getForDay()</code> method shows another usage of <code class="literal">@RequestMapping</code>: URI templates. (See <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-requestmapping-uri-templates" title="URI Template Patterns">the next section</a>).</p> 
    <p>A <code class="literal">@RequestMapping</code> on the class level is not required. Without it, all paths are simply absolute, and not relative. The following example from the <span class="emphasis"><em>PetClinic</em></span> sample application shows a multi-action controller using <code class="literal">@RequestMapping</code>:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ClinicController {

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> Clinic clinic;

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">public</span> ClinicController(Clinic clinic) {
        <span class="hl-keyword">this</span>.clinic = clinic;
    }

    <span class="strong"><strong>@RequestMapping(&quot;/&quot;)</strong></span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> welcomeHandler() {
    }

    <span class="strong"><strong>@RequestMapping(&quot;/vets&quot;)</strong></span>
    <span class="hl-keyword">public</span> ModelMap vetsHandler() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> ModelMap(<span class="hl-keyword">this</span>.clinic.getVets());
    }

}</pre> 
    <div class="tip" title="@RequestMapping On Interface Methods" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Tip: @RequestMapping On Interface Methods">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
        <th align="left">@RequestMapping On Interface Methods</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>A common pitfall when working with annotated controller classes happens when applying functionality that requires creating a proxy for the controller object (e.g. <code class="literal">@Transactional</code> methods). Usually you will introduce an interface for the controller in order to use JDK dynamic proxies. To make this work you must move the <code class="literal">@RequestMapping</code> annotations, as well as any other type and method-level annotations (e.g. <code class="literal">@ModelAttribute</code>, <code class="literal">@InitBinder</code>) to the interface as well as the mapping mechanism can only &quot;see&quot; the interface exposed by the proxy. Alternatively, you could activate <code class="literal">proxy-target-class=&quot;true&quot;</code> in the configuration for the functionality applied to the controller (in our transaction scenario in <code class="literal">&lt;tx:annotation-driven /&gt;</code>). Doing so indicates that CGLIB-based subclass proxies should be used instead of interface-based JDK proxies. For more information on various proxying mechanisms see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-proxying" title="8.6&nbsp;Proxying mechanisms">Section&nbsp;8.6, Proxying mechanisms</a>.</p> <p>Note however that method argument annotations, e.g. <code class="literal">@RequestParam</code>, must be present in the method signatures of the controller class.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <div class="section" title="New Support Classes for @RequestMapping methods in Spring MVC 3.1">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-requestmapping-31-vs-30"></a>New Support Classes for @RequestMapping methods in Spring MVC 3.1</h4>
       </div>
      </div>
     </div> 
     <p>Spring 3.1 introduced a new set of support classes for <code class="literal">@RequestMapping</code> methods called <code class="literal">RequestMappingHandlerMapping</code> and <code class="literal">RequestMappingHandlerAdapter</code> respectively. They are recommended for use and even required to take advantage of new features in Spring MVC 3.1 and going forward. The new support classes are enabled by default by the MVC namespace and the MVC Java config but must be configured explicitly if using neither. This section describes a few important differences between the old and the new support classes.</p> 
     <p>Prior to Spring 3.1, type and method-level request mappings were examined in two separate stages&#x2009;&#x2009;a controller was selected first by the <code class="literal">DefaultAnnotationHandlerMapping</code> and the actual method to invoke was narrowed down second by the <code class="literal">AnnotationMethodHandlerAdapter</code>.</p> 
     <p>With the new support classes in Spring 3.1, the <code class="literal">RequestMappingHandlerMapping</code> is the only place where a decision is made about which method should process the request. Think of controller methods as a collection of unique endpoints with mappings for each method derived from type and method-level <code class="literal">@RequestMapping</code> information.</p> 
     <p>This enables some new possibilities. For once a <code class="literal">HandlerInterceptor</code> or a <code class="literal">HandlerExceptionResolver</code> can now expect the Object-based handler to be a <code class="literal">HandlerMethod</code>, which allows them to examine the exact method, its parameters and associated annotations. The processing for a URL no longer needs to be split across different controllers.</p> 
     <p>There are also several things no longer possible:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> Select a controller first with a <code class="literal">SimpleUrlHandlerMapping</code> or <code class="literal">BeanNameUrlHandlerMapping</code> and then narrow the method based on <code class="literal">@RequestMapping</code> annotations. </li>
       <li class="listitem"> Rely on method names as a fall-back mechanism to disambiguate between two <code class="literal">@RequestMapping</code> methods that dont have an explicit path mapping URL path but otherwise match equally, e.g. by HTTP method. In the new support classes <code class="literal">@RequestMapping</code> methods have to be mapped uniquely. </li>
       <li class="listitem"> Have a single default method (without an explicit path mapping) with which requests are processed if no other controller method matches more concretely. In the new support classes if a matching method is not found a 404 error is raised. </li>
      </ul>
     </div> 
     <p>The above features are still supported with the existing support classes. However to take advantage of new Spring MVC 3.1 features youll need to use the new support classes.</p> 
    </div> 
    <div class="section" title="URI Template Patterns">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-requestmapping-uri-templates"></a>URI Template Patterns</h4>
       </div>
      </div>
     </div> 
     <p><span class="emphasis"><em>URI templates</em></span> can be used for convenient access to selected parts of a URL in a <code class="literal">@RequestMapping</code> method.</p> 
     <p>A URI Template is a URI-like string, containing one or more variable names. When you substitute values for these variables, the template becomes a URI. The <a class="ulink" href="http://bitworking.org/projects/URI-Templates/" target="_top">proposed RFC</a> for URI Templates defines how a URI is parameterized. For example, the URI Template <code class="literal"><span><a class="smarterwiki-linkify" href="http://www.example.com/users/%7BuserId%7D">http://www.example.com/users/{userId}</a></span></code> contains the variable <span class="emphasis"><em>userId</em></span>. Assigning the value <span class="emphasis"><em>fred</em></span> to the variable yields <code class="literal"><span><a class="smarterwiki-linkify" href="http://www.example.com/users/fred">http://www.example.com/users/fred</a></span></code>.</p> 
     <p>In Spring MVC you can use the <code class="literal">@PathVariable</code> annotation on a method argument to bind it to the value of a URI template variable:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping(value=&quot;/owners/{ownerId}&quot;, method=RequestMethod.GET)</span></i>
<span class="hl-keyword">public</span> String findOwner(<span class="strong"><strong>@PathVariable</strong></span> String ownerId, Model model) {
    Owner owner = ownerService.findOwner(ownerId);
    model.addAttribute(<span class="hl-string">&quot;owner&quot;</span>, owner);
    <span class="hl-keyword">return</span> <span class="hl-string">&quot;displayOwner&quot;</span>;
}</pre> 
     <p>The URI Template &quot; <code class="literal">/owners/{ownerId}</code>&quot; specifies the variable name <code class="literal">ownerId</code>. When the controller handles this request, the value of <code class="literal">ownerId</code> is set to the value found in the appropriate part of the URI. For example, when a request comes in for <code class="literal">/owners/fred</code>, the value of <code class="literal">ownerId</code> is <code class="literal">fred</code>.</p> 
     <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Tip">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
         <th align="left">Tip</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>To process the @PathVariable annotation, Spring MVC needs to find the matching URI template variable by name. You can specify it in the annotation:</p> <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping(value=&quot;/owners/{ownerId}&quot;, method=RequestMethod.GET)</span></i>
<span class="hl-keyword">public</span> String findOwner(<span class="strong"><strong>@PathVariable(&quot;ownerId&quot;)</strong></span> String theOwner, Model model) {
    <span class="hl-comment">// implementation omitted</span>
}</pre> <p>Or if the URI template variable name matches the method argument name you can omit that detail. As long as your code is not compiled without debugging information, Spring MVC will match the method argument name to the URI template variable name:</p> <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping(value=&quot;/owners/{ownerId}&quot;, method=RequestMethod.GET)</span></i>
<span class="hl-keyword">public</span> String findOwner(<span class="strong"><strong>@PathVariable</strong></span> String ownerId, Model model) {
    <span class="hl-comment">// implementation omitted</span>
}</pre> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <p>A method can have any number of <code class="literal">@PathVariable</code> annotations:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping(value=&quot;/owners/{ownerId}/pets/{petId}&quot;, method=RequestMethod.GET)</span></i>
<span class="hl-keyword">public</span> String findPet(<span class="strong"><strong>@PathVariable</strong></span> String ownerId, <span class="strong"><strong>@PathVariable</strong></span> String petId, Model model) {
    Owner owner = ownerService.findOwner(ownerId);
    Pet pet = owner.getPet(petId);
    model.addAttribute(<span class="hl-string">&quot;pet&quot;</span>, pet);
    <span class="hl-keyword">return</span> <span class="hl-string">&quot;displayPet&quot;</span>;
}</pre> 
     <p>When a <code class="literal">@PathVariable</code> annotation is used on a <code class="literal">Map&lt;String, String&gt;</code> argument, the map is populated with all URI template variables.</p> 
     <p>A URI template can be assembled from type and path level <span class="emphasis"><em>@RequestMapping</em></span> annotations. As a result the <code class="literal">findPet()</code> method can be invoked with a URL such as <code class="literal">/owners/42/pets/21</code>.</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
@RequestMapping(<span class="strong"><strong>&quot;/owners/{ownerId}&quot;</strong></span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RelativePathUriTemplateController {

    @RequestMapping(<span class="strong"><strong>&quot;/pets/{petId}&quot;</strong></span>)
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findPet(<i><span class="hl-annotation" style="color: gray">@PathVariable</span></i> String ownerId, <i><span class="hl-annotation" style="color: gray">@PathVariable</span></i> String petId, Model model) {
        <span class="hl-comment">// implementation omitted</span>
    }

}</pre> 
     <p>A <code class="literal">@PathVariable</code> argument can be of <span class="emphasis"><em>any simple type</em></span> such as int, long, Date, etc. Spring automatically converts to the appropriate type or throws a <code class="literal">TypeMismatchException</code> if it fails to do so. You can also register support for parsing additional data types. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-typeconversion" title="Method Parameters And Type Conversion">the section called Method Parameters And Type Conversion</a> and <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-webdatabinder" title="Customizing WebDataBinder initialization">the section called Customizing WebDataBinder initialization</a>.</p> 
    </div> 
    <div class="section" title="URI Template Patterns with Regular Expressions">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-requestmapping-uri-templates-regex"></a>URI Template Patterns with Regular Expressions</h4>
       </div>
      </div>
     </div> 
     <p>Sometimes you need more precision in defining URI template variables. Consider the URL <code class="literal">&quot;/spring-web/spring-web-3.0.5.jar&quot;</code>. How do you break it down into multiple parts?</p> 
     <p>The <code class="literal">@RequestMapping</code> annotation supports the use of regular expressions in URI template variables. The syntax is <code class="literal">{varName:regex}</code> where the first part defines the variable name and the second - the regular expression.For example:</p> 
     <pre class="programlisting">@RequestMapping(<span class="hl-string">&quot;/spring-web/{symbolicName:[a-z-]</span><code class="literal">}-{version:\\d\\.\\d\\.\\d}{extension:\\.[a-z]</code>}<span class="hl-string">&quot;)
</span>    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> handle(<i><span class="hl-annotation" style="color: gray">@PathVariable</span></i> String version, <i><span class="hl-annotation" style="color: gray">@PathVariable</span></i> String extension) {
        <span class="hl-comment">// ...</span>
    }
}</pre> 
    </div> 
    <div class="section" title="Path Patterns">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-requestmapping-patterns"></a>Path Patterns</h4>
       </div>
      </div>
     </div> 
     <p>In addition to URI templates, the <code class="literal">@RequestMapping</code> annotation also supports Ant-style path patterns (for example, <code class="literal">/myPath/*.do</code>). A combination of URI templates and Ant-style globs is also supported (for example, <code class="literal">/owners/*/pets/{petId}</code>).</p> 
    </div> 
    <div class="section" title="Patterns with Placeholders">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-requestmapping-placeholders"></a>Patterns with Placeholders</h4>
       </div>
      </div>
     </div> 
     <p>Patterns in <code class="literal">@RequestMapping</code> annotations support ${} placeholders against local properties and/or system properties and environment variables. This may be useful in cases where the path a controller is mapped to may need to be customized through configuration. For more information on placeholders see the Javadoc for <code class="literal">PropertyPlaceholderConfigurer</code>.</p> 
    </div> 
    <div class="section" title="Matrix Variables">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-matrix-variables"></a>Matrix Variables</h4>
       </div>
      </div>
     </div> 
     <p>The URI specification <a class="ulink" href="http://tools.ietf.org/html/rfc3986#section-3.3" target="_top">RFC 3986</a> defines the possibility of including name-value pairs within path segments. There is no specific term used in the spec. The general &quot;URI path parameters&quot; could be applied although the more unique <a class="ulink" href="http://www.w3.org/DesignIssues/MatrixURIs.html" target="_top">&quot;Matrix URIs&quot;</a>, originating from an old post by Tim Berners-Lee, is also frequently used and fairly well known. Within Spring MVC these are referred to as matrix variables.</p> 
     <p>Matrix variables can appear in any path segment, each matrix variable separated with a &quot;;&quot; (semicolon). For example: <code class="literal">&quot;/cars;color=red;year=2012&quot;</code>. Multiple values may be either &quot;,&quot; (comma) separated <code class="literal">&quot;color=red,green,blue&quot;</code> or the variable name may be repeated <code class="literal">&quot;color=red;color=green;color=blue&quot;</code>.</p> 
     <p>If a URL is expected to contain matrix variables, the request mapping pattern must represent them with a URI template. This ensures the request can be matched correctly regardless of whether matrix variables are present or not and in what order they are provided.</p> 
     <p>Below is an example of extracting the matrix variable &quot;q&quot;:</p> 
     <pre class="programlisting"><span class="hl-comment">// GET /pets/42;q=11;r=22</span>

<i><span class="hl-annotation" style="color: gray">@RequestMapping(value = &quot;/pets/{petId}&quot;, method = RequestMethod.GET)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findPet(<i><span class="hl-annotation" style="color: gray">@PathVariable</span></i> String petId, <i><span class="hl-annotation" style="color: gray">@MatrixVariable</span></i> <span class="hl-keyword">int</span> q) {

    <span class="hl-comment">// petId == 42</span>
    <span class="hl-comment">// q == 11</span>

}</pre> 
     <p>Since all path segments may contain matrix variables, in some cases you need to be more specific to identify where the variable is expected to be:</p> 
     <pre class="programlisting"><span class="hl-comment">// GET /owners/42;q=11/pets/21;q=22</span>

<i><span class="hl-annotation" style="color: gray">@RequestMapping(value = &quot;/owners/{ownerId}/pets/{petId}&quot;, method = RequestMethod.GET)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findPet(
        <i><span class="hl-annotation" style="color: gray">@MatrixVariable(value=&quot;q&quot;, pathVar=&quot;ownerId&quot;)</span></i> <span class="hl-keyword">int</span> q1,
        <i><span class="hl-annotation" style="color: gray">@MatrixVariable(value=&quot;q&quot;, pathVar=&quot;petId&quot;)</span></i> <span class="hl-keyword">int</span> q2) {

    <span class="hl-comment">// q1 == 11</span>
    <span class="hl-comment">// q2 == 22</span>

}</pre> 
     <p>A matrix variable may be defined as optional and a default value specified:</p> 
     <pre class="programlisting"><span class="hl-comment">// GET /pets/42</span>

<i><span class="hl-annotation" style="color: gray">@RequestMapping(value = &quot;/pets/{petId}&quot;, method = RequestMethod.GET)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findPet(<i><span class="hl-annotation" style="color: gray">@MatrixVariable(required=true, defaultValue=&quot;1&quot;)</span></i> <span class="hl-keyword">int</span> q) {

    <span class="hl-comment">// q == 1</span>

}</pre> 
     <p>All matrix variables may be obtained in a Map:</p> 
     <pre class="programlisting"><span class="hl-comment">// GET /owners/42;q=11;r=12/pets/21;q=22;s=23</span>

<i><span class="hl-annotation" style="color: gray">@RequestMapping(value = &quot;/owners/{ownerId}/pets/{petId}&quot;, method = RequestMethod.GET)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findPet(
        <i><span class="hl-annotation" style="color: gray">@MatrixVariable</span></i> Map&lt;String, String&gt; matrixVars,
        <i><span class="hl-annotation" style="color: gray">@MatrixVariable(pathVar=&quot;petId&quot;&quot;)</span></i> Map&lt;String, String&gt; petMatrixVars) {

    <span class="hl-comment">// matrixVars: [&quot;q&quot; : [11,22], &quot;r&quot; : 12, &quot;s&quot; : 23]</span>
    <span class="hl-comment">// petMatrixVars: [&quot;q&quot; : 11, &quot;s&quot; : 23]</span>

}</pre> 
     <p>Note that to enable the use of matrix variables, you must set the <code class="literal">removeSemicolonContent</code> property of <code class="literal">RequestMappingHandlerMapping</code> to <code class="literal">false</code>. By default it is set to <code class="literal">false</code>.</p> 
    </div> 
    <div class="section" title="Consumable Media Types">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-requestmapping-consumes"></a>Consumable Media Types</h4>
       </div>
      </div>
     </div> 
     <p>You can narrow the primary mapping by specifying a list of consumable media types. The request will be matched only if the <span class="emphasis"><em>Content-Type</em></span> request header matches the specified media type. For example:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
@RequestMapping(value = <span class="hl-string">&quot;/pets&quot;</span>, method = RequestMethod.POST, <span class="strong"><strong>consumes=&quot;application/json&quot;</strong></span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addPet(<i><span class="hl-annotation" style="color: gray">@RequestBody</span></i> Pet pet, Model model) {
    <span class="hl-comment">// implementation omitted</span>
}</pre> 
     <p>Consumable media type expressions can also be negated as in <span class="emphasis"><em>!text/plain</em></span> to match to all requests other than those with <span class="emphasis"><em>Content-Type</em></span> of <span class="emphasis"><em>text/plain</em></span>.</p> 
     <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Tip">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
         <th align="left">Tip</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>The <span class="emphasis"><em>consumes</em></span> condition is supported on the type and on the method level. Unlike most other conditions, when used at the type level, method-level consumable types override rather than extend type-level consumable types.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="Producible Media Types">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-requestmapping-produces"></a>Producible Media Types</h4>
       </div>
      </div>
     </div> 
     <p>You can narrow the primary mapping by specifying a list of producible media types. The request will be matched only if the <span class="emphasis"><em>Accept</em></span> request header matches one of these values. Furthermore, use of the <span class="emphasis"><em>produces</em></span> condition ensures the actual content type used to generate the response respects the media types specified in the <span class="emphasis"><em>produces</em></span> condition. For example:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
@RequestMapping(value = <span class="hl-string">&quot;/pets/{petId}&quot;</span>, method = RequestMethod.GET, <span class="strong"><strong>produces=&quot;application/json&quot;</strong></span>)
<i><span class="hl-annotation" style="color: gray">@ResponseBody</span></i>
<span class="hl-keyword">public</span> Pet getPet(<i><span class="hl-annotation" style="color: gray">@PathVariable</span></i> String petId, Model model) {
    <span class="hl-comment">// implementation omitted</span>
}</pre> 
     <p>Just like with <span class="emphasis"><em>consumes</em></span>, producible media type expressions can be negated as in <span class="emphasis"><em>!text/plain</em></span> to match to all requests other than those with an <span class="emphasis"><em>Accept</em></span> header value of <span class="emphasis"><em>text/plain</em></span>.</p> 
     <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Tip">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
         <th align="left">Tip</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>The <span class="emphasis"><em>produces</em></span> condition is supported on the type and on the method level. Unlike most other conditions, when used at the type level, method-level producible types override rather than extend type-level producible types.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="Request Parameters and Header Values">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-requestmapping-params-and-headers"></a>Request Parameters and Header Values</h4>
       </div>
      </div>
     </div> 
     <p>You can narrow request matching through request parameter conditions such as <code class="literal">&quot;myParam&quot;</code>, <code class="literal">&quot;!myParam&quot;</code>, or <code class="literal">&quot;myParam=myValue&quot;</code>. The first two test for request parameter presence/absence and the third for a specific parameter value. Here is an example with a request parameter value condition:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<i><span class="hl-annotation" style="color: gray">@RequestMapping(&quot;/owners/{ownerId}&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RelativePathUriTemplateController {

    @RequestMapping(value = <span class="hl-string">&quot;/pets/{petId}&quot;</span>, method = RequestMethod.GET, <span class="strong"><strong>params=&quot;myParam=myValue&quot;</strong></span>)
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findPet(<i><span class="hl-annotation" style="color: gray">@PathVariable</span></i> String ownerId, <i><span class="hl-annotation" style="color: gray">@PathVariable</span></i> String petId, Model model) {
        <span class="hl-comment">// implementation omitted</span>
    }

}</pre> 
     <p>The same can be done to test for request header presence/absence or to match based on a specific request header value:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<i><span class="hl-annotation" style="color: gray">@RequestMapping(&quot;/owners/{ownerId}&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RelativePathUriTemplateController {

    @RequestMapping(value = <span class="hl-string">&quot;/pets&quot;</span>, method = RequestMethod.GET, <span class="strong"><strong>headers=&quot;myHeader=myValue&quot;</strong></span>)
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findPet(<i><span class="hl-annotation" style="color: gray">@PathVariable</span></i> String ownerId, <i><span class="hl-annotation" style="color: gray">@PathVariable</span></i> String petId, Model model) {
        <span class="hl-comment">// implementation omitted</span>
    }

}</pre> 
     <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Tip">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
         <th align="left">Tip</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>Although you can match to <span class="emphasis"><em>Content-Type</em></span> and <span class="emphasis"><em>Accept</em></span> header values using media type wild cards (for example <span class="emphasis"><em>&quot;content-type=text/*&quot;</em></span> will match to <span class="emphasis"><em>&quot;text/plain&quot;</em></span> and <span class="emphasis"><em>&quot;text/html&quot;</em></span>), it is recommended to use the <span class="emphasis"><em>consumes</em></span> and <span class="emphasis"><em>produces</em></span> conditions respectively instead. They are intended specifically for that purpose.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
   </div> 
   <div class="section" title="16.3.3&nbsp;Defining @RequestMapping handler methods">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-ann-methods"></a>16.3.3&nbsp;Defining @RequestMapping handler methods</h3>
      </div>
     </div>
    </div> 
    <p>An <code class="literal">@RequestMapping</code> handler method can have a very flexible signatures. The supported method arguments and return values are described in the following section. Most arguments can be used in arbitrary order with the only exception of <code class="literal">BindingResult</code> arguments. This is described in the next section.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Spring 3.1 introduced a new set of support classes for <code class="literal">@RequestMapping</code> methods called <code class="literal">RequestMappingHandlerMapping</code> and <code class="literal">RequestMappingHandlerAdapter</code> respectively. They are recommended for use and even required to take advantage of new features in Spring MVC 3.1 and going forward. The new support classes are enabled by default from the MVC namespace and with use of the MVC Java config but must be configured explicitly if using neither.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <div class="section" title="Supported method argument types">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-arguments"></a>Supported method argument types</h4>
       </div>
      </div>
     </div> 
     <p>The following are the supported method arguments:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> Request or response objects (Servlet API). Choose any specific request or response type, for example <code class="literal">ServletRequest</code> or <code class="literal">HttpServletRequest</code>. </li>
       <li class="listitem"> Session object (Servlet API): of type <code class="literal">HttpSession</code>. An argument of this type enforces the presence of a corresponding session. As a consequence, such an argument is never <code class="literal">null</code>. </li>
      </ul>
     </div> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>Session access may not be thread-safe, in particular in a Servlet environment. Consider setting the <code class="literal">RequestMappingHandlerAdapter</code>'s &quot;synchronizeOnSession&quot; flag to &quot;true&quot; if multiple requests are allowed to access a session concurrently.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> <code class="literal">org.springframework.web.context.request.WebRequest</code> or <code class="literal">org.springframework.web.context.request.NativeWebRequest</code>. Allows for generic request parameter access as well as request/session attribute access, without ties to the native Servlet/Portlet API. </li>
       <li class="listitem"> <code class="literal">java.util.Locale</code> for the current request locale, determined by the most specific locale resolver available, in effect, the configured <code class="literal">LocaleResolver</code> in a Servlet environment. </li>
       <li class="listitem"> <code class="literal">java.io.InputStream</code> / <code class="literal">java.io.Reader</code> for access to the requests content. This value is the raw InputStream/Reader as exposed by the Servlet API. </li>
       <li class="listitem"> <code class="literal">java.io.OutputStream</code> / <code class="literal">java.io.Writer</code> for generating the responses content. This value is the raw OutputStream/Writer as exposed by the Servlet API. </li>
       <li class="listitem"> <code class="literal">java.security.Principal</code> containing the currently authenticated user. </li>
       <li class="listitem"> <code class="literal">@PathVariable</code> annotated parameters for access to URI template variables. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-requestmapping-uri-templates" title="URI Template Patterns">the section called URI Template Patterns</a>. </li>
       <li class="listitem"> <code class="literal">@MatrixVariable</code> annotated parameters for access to name-value pairs located in URI path segments. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-matrix-variables" title="Matrix Variables">the section called Matrix Variables</a>. </li>
       <li class="listitem"> <code class="literal">@RequestParam</code> annotated parameters for access to specific Servlet request parameters. Parameter values are converted to the declared method argument type. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-requestparam" title="Binding request parameters to method parameters with @RequestParam">the section called Binding request parameters to method parameters with @RequestParam</a>. </li>
       <li class="listitem"> <code class="literal">@RequestHeader</code> annotated parameters for access to specific Servlet request HTTP headers. Parameter values are converted to the declared method argument type. </li>
       <li class="listitem"> <code class="literal">@RequestBody</code> annotated parameters for access to the HTTP request body. Parameter values are converted to the declared method argument type using <code class="literal">HttpMessageConverter</code> s. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-requestbody" title="Mapping the request body with the @RequestBody annotation">the section called Mapping the request body with the @RequestBody annotation</a>. </li>
       <li class="listitem"> <code class="literal">@RequestPart</code> annotated parameters for access to the content of a &quot;multipart/form-data&quot; request part. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-multipart-forms-non-browsers" title="16.11.5&nbsp;Handling a file upload request from programmatic clients">Section&nbsp;16.11.5, Handling a file upload request from programmatic clients</a> and <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-multipart" title="16.11&nbsp;Springs multipart (file upload) support">Section&nbsp;16.11, Springs multipart (file upload) support</a>. </li>
       <li class="listitem"> <code class="literal">HttpEntity&lt;?&gt;</code> parameters for access to the Servlet request HTTP headers and contents. The request stream will be converted to the entity body using <code class="literal">HttpMessageConverter</code> s. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-httpentity" title="Using HttpEntity">the section called Using HttpEntity</a>. </li>
       <li class="listitem"> <code class="literal">java.util.Map</code> / <code class="literal">org.springframework.ui.Model</code> / <code class="literal">org.springframework.ui.ModelMap</code> for enriching the implicit model that is exposed to the web view. </li>
       <li class="listitem"> <code class="literal">org.springframework.web.servlet.mvc.support.RedirectAttributes</code> to specify the exact set of attributes to use in case of a redirect and also to add flash attributes (attributes stored temporarily on the server-side to make them available to the request after the redirect). <code class="literal">RedirectAttributes</code> is used instead of the implicit model if the method returns a &quot;redirect:&quot; prefixed view name or <code class="literal">RedirectView</code>. </li>
       <li class="listitem"> Command or form objects to bind request parameters to bean properties (via setters) or directly to fields, with customizable type conversion, depending on <code class="literal">@InitBinder</code> methods and/or the HandlerAdapter configuration. See the <code class="literal">webBindingInitializer</code> property on <code class="literal">RequestMappingHandlerAdapter</code>. Such command objects along with their validation results will be exposed as model attributes by default, using the command class class name - e.g. model attribute &quot;orderAddress&quot; for a command object of type &quot;some.package.OrderAddress&quot;. The <code class="literal">ModelAttribute</code> annotation can be used on a method argument to customize the model attribute name used. </li>
       <li class="listitem"> <code class="literal">org.springframework.validation.Errors</code> / <code class="literal">org.springframework.validation.BindingResult</code> validation results for a preceding command or form object (the immediately preceding method argument). </li>
       <li class="listitem"> <code class="literal">org.springframework.web.bind.support.SessionStatus</code> status handle for marking form processing as complete, which triggers the cleanup of session attributes that have been indicated by the <code class="literal">@SessionAttributes</code> annotation at the handler type level. </li>
       <li class="listitem"> <code class="literal">org.springframework.web.util.UriComponentsBuilder</code> a builder for preparing a URL relative to the current requests host, port, scheme, context path, and the literal part of the servlet mapping. </li>
      </ul>
     </div> 
     <p>The <code class="literal">Errors</code> or <code class="literal">BindingResult</code> parameters have to follow the model object that is being bound immediately as the method signature might have more that one model object and Spring will create a separate <code class="literal">BindingResult</code> instance for each of them so the following sample wont work:</p> 
     <p title="Invalid ordering of BindingResult and @ModelAttribute"> <b>Invalid ordering of BindingResult and @ModelAttribute.&nbsp;</b> </p>
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping(method = RequestMethod.POST)</span></i>
<span class="hl-keyword">public</span> String processSubmit(<span class="strong"><strong>@ModelAttribute(&quot;pet&quot;) Pet pet</strong></span>, Model model, <span class="strong"><strong>BindingResult result</strong></span>) { ... }</pre>
     <p title="Invalid ordering of BindingResult and @ModelAttribute"> </p> 
     <p>Note, that there is a <code class="literal">Model</code> parameter in between <code class="literal">Pet</code> and <code class="literal">BindingResult</code>. To get this working you have to reorder the parameters as follows:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping(method = RequestMethod.POST)</span></i>
<span class="hl-keyword">public</span> String processSubmit(<span class="strong"><strong>@ModelAttribute(&quot;pet&quot;) Pet pet</strong></span>, <span class="strong"><strong>BindingResult result</strong></span>, Model model) { ... }</pre> 
    </div> 
    <div class="section" title="Supported method return types">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-return-types"></a>Supported method return types</h4>
       </div>
      </div>
     </div> 
     <p>The following are the supported return types:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> A <code class="literal">ModelAndView</code> object, with the model implicitly enriched with command objects and the results of <code class="literal">@ModelAttribute</code> annotated reference data accessor methods. </li>
       <li class="listitem"> A <code class="literal">Model</code> object, with the view name implicitly determined through a <code class="literal">RequestToViewNameTranslator</code> and the model implicitly enriched with command objects and the results of <code class="literal">@ModelAttribute</code> annotated reference data accessor methods. </li>
       <li class="listitem"> A <code class="literal">Map</code> object for exposing a model, with the view name implicitly determined through a <code class="literal">RequestToViewNameTranslator</code> and the model implicitly enriched with command objects and the results of <code class="literal">@ModelAttribute</code> annotated reference data accessor methods. </li>
       <li class="listitem"> A <code class="literal">View</code> object, with the model implicitly determined through command objects and <code class="literal">@ModelAttribute</code> annotated reference data accessor methods. The handler method may also programmatically enrich the model by declaring a <code class="literal">Model</code> argument (see above). </li>
       <li class="listitem"> A <code class="literal">String</code> value that is interpreted as the logical view name, with the model implicitly determined through command objects and <code class="literal">@ModelAttribute</code> annotated reference data accessor methods. The handler method may also programmatically enrich the model by declaring a <code class="literal">Model</code> argument (see above). </li>
       <li class="listitem"> <code class="literal">void</code> if the method handles the response itself (by writing the response content directly, declaring an argument of type <code class="literal">ServletResponse</code> / <code class="literal">HttpServletResponse</code> for that purpose) or if the view name is supposed to be implicitly determined through a <code class="literal">RequestToViewNameTranslator</code> (not declaring a response argument in the handler method signature). </li>
       <li class="listitem"> If the method is annotated with <code class="literal">@ResponseBody</code>, the return type is written to the response HTTP body. The return value will be converted to the declared method argument type using <code class="literal">HttpMessageConverter</code> s. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-responsebody" title="Mapping the response body with the @ResponseBody annotation">the section called Mapping the response body with the @ResponseBody annotation</a>. </li>
       <li class="listitem"> A <code class="literal">HttpEntity&lt;?&gt;</code> or <code class="literal">ResponseEntity&lt;?&gt;</code> object to provide access to the Servlet response HTTP headers and contents. The entity body will be converted to the response stream using <code class="literal">HttpMessageConverter</code> s. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-httpentity" title="Using HttpEntity">the section called Using HttpEntity</a>. </li>
       <li class="listitem"> A <code class="literal">Callable&lt;?&gt;</code> can be returned when the application wants to produce the return value asynchronously in a thread managed by Spring MVC. </li>
       <li class="listitem"> A <code class="literal">DeferredResult&lt;?&gt;</code> can be returned when the application wants to produce the return value from a thread of its own choosing. </li>
       <li class="listitem"> Any other return type is considered to be a single model attribute to be exposed to the view, using the attribute name specified through <code class="literal">@ModelAttribute</code> at the method level (or the default attribute name based on the return type class name). The model is implicitly enriched with command objects and the results of <code class="literal">@ModelAttribute</code> annotated reference data accessor methods. </li>
      </ul>
     </div> 
    </div> 
    <div class="section" title="Binding request parameters to method parameters with @RequestParam">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-requestparam"></a>Binding request parameters to method parameters with @RequestParam</h4>
       </div>
      </div>
     </div> 
     <p>Use the <code class="literal">@RequestParam</code> annotation to bind request parameters to a method parameter in your controller.</p> 
     <p>The following code snippet shows the usage:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<i><span class="hl-annotation" style="color: gray">@RequestMapping(&quot;/pets&quot;)</span></i>
<i><span class="hl-annotation" style="color: gray">@SessionAttributes(&quot;pet&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> EditPetForm {

    <span class="hl-comment">// ...</span>

    <i><span class="hl-annotation" style="color: gray">@RequestMapping(method = RequestMethod.GET)</span></i>
    <span class="hl-keyword">public</span> String setupForm(<span class="strong"><strong>@RequestParam(&quot;petId&quot;) int petId</strong></span>, ModelMap model) {
        Pet pet = <span class="hl-keyword">this</span>.clinic.loadPet(petId);
        model.addAttribute(<span class="hl-string">&quot;pet&quot;</span>, pet);
        <span class="hl-keyword">return</span> <span class="hl-string">&quot;petForm&quot;</span>;
    }

    <span class="hl-comment">// ...</span>

}</pre> 
     <p>Parameters using this annotation are required by default, but you can specify that a parameter is optional by setting <code class="literal">@RequestParam</code>'s <code class="literal">required</code> attribute to <code class="literal">false</code> (e.g., <code class="literal">@RequestParam(value=&quot;id&quot;, required=false)</code>).</p> 
     <p>Type conversion is applied automatically if the target method parameter type is not <code class="literal">String</code>. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-typeconversion" title="Method Parameters And Type Conversion">the section called Method Parameters And Type Conversion</a>.</p> 
    </div> 
    <div class="section" title="Mapping the request body with the @RequestBody annotation">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-requestbody"></a>Mapping the request body with the @RequestBody annotation</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">@RequestBody</code> method parameter annotation indicates that a method parameter should be bound to the value of the HTTP request body. For example:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping(value = &quot;/something&quot;, method = RequestMethod.PUT)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> handle(<i><span class="hl-annotation" style="color: gray">@RequestBody</span></i> String body, Writer writer) <span class="hl-keyword">throws</span> IOException {
    writer.write(body);
}</pre> 
     <p>You convert the request body to the method argument by using an <code class="literal">HttpMessageConverter</code>. <code class="literal">HttpMessageConverter</code> is responsible for converting from the HTTP request message to an object and converting from an object to the HTTP response body. The <code class="literal">RequestMappingHandlerAdapter</code> supports the <code class="literal">@RequestBody</code> annotation with the following default <code class="literal">HttpMessageConverters</code>:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> <code class="literal">ByteArrayHttpMessageConverter</code> converts byte arrays. </li>
       <li class="listitem"> <code class="literal">StringHttpMessageConverter</code> converts strings. </li>
       <li class="listitem"> <code class="literal">FormHttpMessageConverter</code> converts form data to/from a MultiValueMap&lt;String, String&gt;. </li>
       <li class="listitem"> <code class="literal">SourceHttpMessageConverter</code> converts to/from a javax.xml.transform.Source. </li>
      </ul>
     </div> 
     <p>For more information on these converters, see <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#rest-message-conversion" title="21.10.2&nbsp;HTTP Message Conversion">Message Converters</a>. Also note that if using the MVC namespace or the MVC Java config, a wider range of message converters are registered by default. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-config-enable" title="16.16.1&nbsp;Enabling the MVC Java Config or the MVC XML Namespace">Section&nbsp;16.16.1, Enabling the MVC Java Config or the MVC XML Namespace</a> for more information.</p> 
     <p>If you intend to read and write XML, you will need to configure the <code class="literal">MarshallingHttpMessageConverter</code> with a specific <code class="literal">Marshaller</code> and an <code class="literal">Unmarshaller</code> implementation from the <code class="literal">org.springframework.oxm</code> package. The example below shows how to do that directly in your configuration but if your application is configured through the MVC namespace or the MVC Java config see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-config-enable" title="16.16.1&nbsp;Enabling the MVC Java Config or the MVC XML Namespace">Section&nbsp;16.16.1, Enabling the MVC Java Config or the MVC XML Namespace</a> instead.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;messageConverters&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;util:list</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;beanList&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">&quot;stringHttpMessageConverter&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">&quot;marshallingHttpMessageConverter&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/util:list&gt;</span>
    <span class="hl-tag">&lt;/property
&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;stringHttpMessageConverter&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.http.converter.StringHttpMessageConverter&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;marshallingHttpMessageConverter&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.http.converter.xml.MarshallingHttpMessageConverter&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;marshaller&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;castorMarshaller&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;unmarshaller&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;castorMarshaller&quot;</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;castorMarshaller&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.oxm.castor.CastorMarshaller&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <p>An <code class="literal">@RequestBody</code> method parameter can be annotated with <code class="literal">@Valid</code>, in which case it will be validated using the configured <code class="literal">Validator</code> instance. When using the MVC namespace or the MVC Java config, a JSR-303 validator is configured automatically assuming a JSR-303 implementation is available on the classpath.</p> 
     <p>Just like with <code class="literal">@ModelAttribute</code> parameters, an <code class="literal">Errors</code> argument can be used to examine the errors. If such an argument is not declared, a <code class="literal">MethodArgumentNotValidException</code> will be raised. The exception is handled in the <code class="literal">DefaultHandlerExceptionResolver</code>, which sends a <code class="literal">400</code> error back to the client.</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>Also see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-config-enable" title="16.16.1&nbsp;Enabling the MVC Java Config or the MVC XML Namespace">Section&nbsp;16.16.1, Enabling the MVC Java Config or the MVC XML Namespace</a> for information on configuring message converters and a validator through the MVC namespace or the MVC Java config.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="Mapping the response body with the @ResponseBody annotation">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-responsebody"></a>Mapping the response body with the @ResponseBody annotation</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">@ResponseBody</code> annotation is similar to <code class="literal">@RequestBody</code>. This annotation can be put on a method and indicates that the return type should be written straight to the HTTP response body (and not placed in a Model, or interpreted as a view name). For example:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping(value = &quot;/something&quot;, method = RequestMethod.PUT)</span></i>
<i><span class="hl-annotation" style="color: gray">@ResponseBody</span></i>
<span class="hl-keyword">public</span> String helloWorld() {
    <span class="hl-keyword">return</span> <span class="hl-string">&quot;Hello World&quot;</span>;
}</pre> 
     <p>The above example will result in the text <code class="literal">Hello World</code> being written to the HTTP response stream.</p> 
     <p>As with <code class="literal">@RequestBody</code>, Spring converts the returned object to a response body by using an <code class="literal">HttpMessageConverter</code>. For more information on these converters, see the previous section and <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#rest-message-conversion" title="21.10.2&nbsp;HTTP Message Conversion">Message Converters</a>.</p> 
    </div> 
    <div class="section" title="Creating REST Controllers with the @RestController annotation">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-restcontroller"></a>Creating REST Controllers with the @RestController annotation</h4>
       </div>
      </div>
     </div> 
     <p>Its a very common use case to have Controllers implement a REST API, thus serving only JSON, XML or custom MediaType content. For convenience, instead of annotating all your <code class="literal">@RequestMapping</code> methods with <code class="literal">@ResponseBody</code>, you can annotate your Controller Class with <code class="literal">@RestController</code>.</p> 
     <p><a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-apiorg/springframework/web/bind/annotation/RestController.html" target="_top"><code class="literal">@RestController</code></a> is a stereotype annotation that combines <code class="literal">@ResponseBody</code> and <code class="literal">@Controller</code>. More than that, it gives more meaning to your Controller and also may carry additional semantics in future releases of the framework.</p> 
     <p>As with regular <code class="literal">@Controllers</code>, a <code class="literal">@RestController</code> may be assisted by a <code class="literal">@ControllerAdvice</code> Bean. See the <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-controller-advice" title="Assisting Controllers with the @ControllerAdvice annotation">the section called Assisting Controllers with the @ControllerAdvice annotation</a> section for more details.</p> 
    </div> 
    <div class="section" title="Using HttpEntity">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-httpentity"></a>Using HttpEntity</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">HttpEntity</code> is similar to <code class="literal">@RequestBody</code> and <code class="literal">@ResponseBody</code>. Besides getting access to the request and response body, <code class="literal">HttpEntity</code> (and the response-specific subclass <code class="literal">ResponseEntity</code>) also allows access to the request and response headers, like so:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping(&quot;/something&quot;)</span></i>
<span class="hl-keyword">public</span> ResponseEntity&lt;String&gt; handle(HttpEntity&lt;<span class="hl-keyword">byte</span>[]&gt; requestEntity) <span class="hl-keyword">throws</span> UnsupportedEncodingException {
    String requestHeader = requestEntity.getHeaders().getFirst(<span class="hl-string">&quot;MyRequestHeader&quot;</span>));
    <span class="hl-keyword">byte</span>[] requestBody = requestEntity.getBody();

    <span class="hl-comment">// do something with request header and body</span>

    HttpHeaders responseHeaders = <span class="hl-keyword">new</span> HttpHeaders();
    responseHeaders.set(<span class="hl-string">&quot;MyResponseHeader&quot;</span>, <span class="hl-string">&quot;MyValue&quot;</span>);
    <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> ResponseEntity&lt;String&gt;(<span class="hl-string">&quot;Hello World&quot;</span>, responseHeaders, HttpStatus.CREATED);
}</pre> 
     <p>The above example gets the value of the <code class="literal">MyRequestHeader</code> request header, and reads the body as a byte array. It adds the <code class="literal">MyResponseHeader</code> to the response, writes <code class="literal">Hello World</code> to the response stream, and sets the response status code to 201 (Created).</p> 
     <p>As with <code class="literal">@RequestBody</code> and <code class="literal">@ResponseBody</code>, Spring uses <code class="literal">HttpMessageConverter</code> to convert from and to the request and response streams. For more information on these converters, see the previous section and <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#rest-message-conversion" title="21.10.2&nbsp;HTTP Message Conversion">Message Converters</a>.</p> 
    </div> 
    <div class="section" title="Using @ModelAttribute on a method">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-modelattrib-methods"></a>Using @ModelAttribute on a method</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">@ModelAttribute</code> annotation can be used on methods or on method arguments. This section explains its usage on methods while the next section explains its usage on method arguments.</p> 
     <p>An <code class="literal">@ModelAttribute</code> on a method indicates the purpose of that method is to add one or more model attributes. Such methods support the same argument types as <code class="literal">@RequestMapping</code> methods but cannot be mapped directly to requests. Instead <code class="literal">@ModelAttribute</code> methods in a controller are invoked before <code class="literal">@RequestMapping</code> methods, within the same controller. A couple of examples:</p> 
     <pre class="programlisting"><span class="hl-comment">// Add one attribute</span>
<span class="hl-comment">// The return value of the method is added to the model under the name &quot;account&quot;</span>
<span class="hl-comment">// You can customize the name via @ModelAttribute(&quot;myAccount&quot;)</span>

<i><span class="hl-annotation" style="color: gray">@ModelAttribute</span></i>
<span class="hl-keyword">public</span> Account addAccount(<i><span class="hl-annotation" style="color: gray">@RequestParam</span></i> String number) {
    <span class="hl-keyword">return</span> accountManager.findAccount(number);
}

<span class="hl-comment">// Add multiple attributes</span>

<i><span class="hl-annotation" style="color: gray">@ModelAttribute</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> populateModel(<i><span class="hl-annotation" style="color: gray">@RequestParam</span></i> String number, Model model) {
    model.addAttribute(accountManager.findAccount(number));
    <span class="hl-comment">// add more ...</span>
}</pre> 
     <p><code class="literal">@ModelAttribute</code> methods are used to populate the model with commonly needed attributes for example to fill a drop-down with states or with pet types, or to retrieve a command object like Account in order to use it to represent the data on an HTML form. The latter case is further discussed in the next section.</p> 
     <p>Note the two styles of <code class="literal">@ModelAttribute</code> methods. In the first, the method adds an attribute implicitly by returning it. In the second, the method accepts a <code class="literal">Model</code> and adds any number of model attributes to it. You can choose between the two styles depending on your needs.</p> 
     <p>A controller can have any number of <code class="literal">@ModelAttribute</code> methods. All such methods are invoked before <code class="literal">@RequestMapping</code> methods of the same controller.</p> 
     <p><code class="literal">@ModelAttribute</code> methods can also be defined in an <code class="literal">@ControllerAdvice</code>-annotated class and such methods apply to many controllers. See the <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-controller-advice" title="Assisting Controllers with the @ControllerAdvice annotation">the section called Assisting Controllers with the @ControllerAdvice annotation</a> section for more details.</p> 
     <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Tip">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
         <th align="left">Tip</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>What happens when a model attribute name is not explicitly specified? In such cases a default name is assigned to the model attribute based on its type. For example if the method returns an object of type <code class="literal">Account</code>, the default name used is &quot;account&quot;. You can change that through the value of the <code class="literal">@ModelAttribute</code> annotation. If adding attributes directly to the <code class="literal">Model</code>, use the appropriate overloaded <code class="literal">addAttribute(..)</code> method - i.e., with or without an attribute name.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <p>The <code class="literal">@ModelAttribute</code> annotation can be used on <code class="literal">@RequestMapping</code> methods as well. In that case the return value of the <code class="literal">@RequestMapping</code> method is interpreted as a model attribute rather than as a view name. The view name is derived from view name conventions instead much like for methods returning void&#x2009;&#x2009;see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-coc-r2vnt" title="16.13.3&nbsp;The View - RequestToViewNameTranslator">Section&nbsp;16.13.3, The View - RequestToViewNameTranslator</a>.</p> 
    </div> 
    <div class="section" title="Using @ModelAttribute on a method argument">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-modelattrib-method-args"></a>Using @ModelAttribute on a method argument</h4>
       </div>
      </div>
     </div> 
     <p>As explained in the previous section <code class="literal">@ModelAttribute</code> can be used on methods or on method arguments. This section explains its usage on method arguments.</p> 
     <p>An <code class="literal">@ModelAttribute</code> on a method argument indicates the argument should be retrieved from the model. If not present in the model, the argument should be instantiated first and then added to the model. Once present in the model, the arguments fields should be populated from all request parameters that have matching names. This is known as data binding in Spring MVC, a very useful mechanism that saves you from having to parse each form field individually.</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping(value=&quot;/owners/{ownerId}/pets/{petId}/edit&quot;, method = RequestMethod.POST)</span></i>
<span class="hl-keyword">public</span> String processSubmit(<span class="strong"><strong>@ModelAttribute Pet pet</strong></span>) { }</pre> 
     <p>Given the above example where can the Pet instance come from? There are several options:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> It may already be in the model due to use of <code class="literal">@SessionAttributes</code>&#x2009;&#x2009;see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-sessionattrib" title="Using @SessionAttributes to store model attributes in the HTTP session between requests">the section called Using @SessionAttributes to store model attributes in the HTTP session between requests</a>. </li>
       <li class="listitem"> It may already be in the model due to an <code class="literal">@ModelAttribute</code> method in the same controller&#x2009;&#x2009;as explained in the previous section. </li>
       <li class="listitem"> It may be retrieved based on a URI template variable and type converter (explained in more detail below). </li>
       <li class="listitem"> It may be instantiated using its default constructor. </li>
      </ul>
     </div> 
     <p>An <code class="literal">@ModelAttribute</code> method is a common way to to retrieve an attribute from the database, which may optionally be stored between requests through the use of <code class="literal">@SessionAttributes</code>. In some cases it may be convenient to retrieve the attribute by using an URI template variable and a type converter. Here is an example:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping(value=&quot;/accounts/{account}&quot;, method = RequestMethod.PUT)</span></i>
<span class="hl-keyword">public</span> String save(<i><span class="hl-annotation" style="color: gray">@ModelAttribute(&quot;account&quot;)</span></i> Account account) {

}</pre> 
     <p>In this example the name of the model attribute (i.e. &quot;account&quot;) matches the name of a URI template variable. If you register <code class="literal">Converter&lt;String, Account&gt;</code> that can turn the <code class="literal">String</code> account value into an <code class="literal">Account</code> instance, then the above example will work without the need for an <code class="literal">@ModelAttribute</code> method.</p> 
     <p>The next step is data binding. The <code class="literal">WebDataBinder</code> class matches request parameter names&#x2009;&#x2009;including query string parameters and form fields&#x2009;&#x2009;to model attribute fields by name. Matching fields are populated after type conversion (from String to the target field type) has been applied where necessary. Data binding and validation are covered in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#validation" title="6.&nbsp;Validation, Data Binding, and Type Conversion">Chapter&nbsp;6, <i>Validation, Data Binding, and Type Conversion</i></a>. Customizing the data binding process for a controller level is covered in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-webdatabinder" title="Customizing WebDataBinder initialization">the section called Customizing WebDataBinder initialization</a>.</p> 
     <p>As a result of data binding there may be errors such as missing required fields or type conversion errors. To check for such errors add a <code class="literal">BindingResult</code> argument immediately following the <code class="literal">@ModelAttribute</code> argument:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping(value=&quot;/owners/{ownerId}/pets/{petId}/edit&quot;, method = RequestMethod.POST)</span></i>
<span class="hl-keyword">public</span> String processSubmit(<span class="strong"><strong>@ModelAttribute(&quot;pet&quot;) Pet pet</strong></span>, BindingResult result) {

    <span class="hl-keyword">if</span> (result.hasErrors()) {
        <span class="hl-keyword">return</span> <span class="hl-string">&quot;petForm&quot;</span>;
    }

    <span class="hl-comment">// ...</span>

}</pre> 
     <p>With a <code class="literal">BindingResult</code> you can check if errors were found in which case its common to render the same form where the errors can be shown with the help of Springs <code class="literal">&lt;errors&gt;</code> form tag.</p> 
     <p>In addition to data binding you can also invoke validation using your own custom validator passing the same <code class="literal">BindingResult</code> that was used to record data binding errors. That allows for data binding and validation errors to be accumulated in one place and subsequently reported back to the user:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping(value=&quot;/owners/{ownerId}/pets/{petId}/edit&quot;, method = RequestMethod.POST)</span></i>
<span class="hl-keyword">public</span> String processSubmit(<span class="strong"><strong>@ModelAttribute(&quot;pet&quot;) Pet pet</strong></span>, BindingResult result) {

    <span class="hl-keyword">new</span> PetValidator().validate(pet, result);
    <span class="hl-keyword">if</span> (result.hasErrors()) {
        <span class="hl-keyword">return</span> <span class="hl-string">&quot;petForm&quot;</span>;
    }

    <span class="hl-comment">// ...</span>

}</pre> 
     <p>Or you can have validation invoked automatically by adding the JSR-303 <code class="literal">@Valid</code> annotation:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping(value=&quot;/owners/{ownerId}/pets/{petId}/edit&quot;, method = RequestMethod.POST)</span></i>
<span class="hl-keyword">public</span> String processSubmit(<span class="strong"><strong>@Valid @ModelAttribute(&quot;pet&quot;) Pet pet</strong></span>, BindingResult result) {

    <span class="hl-keyword">if</span> (result.hasErrors()) {
        <span class="hl-keyword">return</span> <span class="hl-string">&quot;petForm&quot;</span>;
    }

    <span class="hl-comment">// ...</span>

}</pre> 
     <p>See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#validation-beanvalidation" title="6.8&nbsp;Spring Validation">Section&nbsp;6.8, Spring Validation</a> and <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#validation" title="6.&nbsp;Validation, Data Binding, and Type Conversion">Chapter&nbsp;6, <i>Validation, Data Binding, and Type Conversion</i></a> for details on how to configure and use validation.</p> 
    </div> 
    <div class="section" title="Using @SessionAttributes to store model attributes in the HTTP session between requests">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-sessionattrib"></a>Using @SessionAttributes to store model attributes in the HTTP session between requests</h4>
       </div>
      </div>
     </div> 
     <p>The type-level <code class="literal">@SessionAttributes</code> annotation declares session attributes used by a specific handler. This will typically list the names of model attributes or types of model attributes which should be transparently stored in the session or some conversational storage, serving as form-backing beans between subsequent requests.</p> 
     <p>The following code snippet shows the usage of this annotation, specifying the model attribute name:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<i><span class="hl-annotation" style="color: gray">@RequestMapping(&quot;/editPet.do&quot;)</span></i>
<span class="strong"><strong>@SessionAttributes(&quot;pet&quot;)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> EditPetForm {
    <span class="hl-comment">// ...</span>
}</pre> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>When using controller interfaces (e.g., for AOP proxying), make sure to consistently put <span class="emphasis"><em>all</em></span> your mapping annotations - such as <code class="literal">@RequestMapping</code> and <code class="literal">@SessionAttributes</code> - on the controller <span class="emphasis"><em>interface</em></span> rather than on the implementation class.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="Specifying redirect and flash attributes">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-redirect-attributes"></a>Specifying redirect and flash attributes</h4>
       </div>
      </div>
     </div> 
     <p>By default all model attributes are considered to be exposed as URI template variables in the redirect URL. Of the remaining attributes those that are primitive types or collections/arrays of primitive types are automatically appended as query parameters.</p> 
     <p>In annotated controllers however the model may contain additional attributes originally added for rendering purposes (e.g. drop-down field values). To gain precise control over the attributes used in a redirect scenario, an <code class="literal">@RequestMapping</code> method can declare an argument of type <code class="literal">RedirectAttributes</code> and use it to add attributes for use in <code class="literal">RedirectView</code>. If the controller method does redirect, the content of <code class="literal">RedirectAttributes</code> is used. Otherwise the content of the default <code class="literal">Model</code> is used.</p> 
     <p>The <code class="literal">RequestMappingHandlerAdapter</code> provides a flag called <code class="literal">&quot;ignoreDefaultModelOnRedirect&quot;</code> that can be used to indicate the content of the default <code class="literal">Model</code> should never be used if a controller method redirects. Instead the controller method should declare an attribute of type <code class="literal">RedirectAttributes</code> or if it doesnt do so no attributes should be passed on to <code class="literal">RedirectView</code>. Both the MVC namespace and the MVC Java config keep this flag set to <code class="literal">false</code> in order to maintain backwards compatibility. However, for new applications we recommend setting it to <code class="literal">true</code></p> 
     <p>The <code class="literal">RedirectAttributes</code> interface can also be used to add flash attributes. Unlike other redirect attributes, which end up in the target redirect URL, flash attributes are saved in the HTTP session (and hence do not appear in the URL). The model of the controller serving the target redirect URL automatically receives these flash attributes after which they are removed from the session. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-flash-attributes" title="16.6&nbsp;Using flash attributes">Section&nbsp;16.6, Using flash attributes</a> for an overview of the general support for flash attributes in Spring MVC.</p> 
    </div> 
    <div class="section" title="Working with &quot;application/x-www-form-urlencoded&quot; data">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-form-urlencoded-data"></a>Working with &quot;application/x-www-form-urlencoded&quot; data</h4>
       </div>
      </div>
     </div> 
     <p>The previous sections covered use of <code class="literal">@ModelAttribute</code> to support form submission requests from browser clients. The same annotation is recommended for use with requests from non-browser clients as well. However there is one notable difference when it comes to working with HTTP PUT requests. Browsers can submit form data via HTTP GET or HTTP POST. Non-browser clients can also submit forms via HTTP PUT. This presents a challenge because the Servlet specification requires the <code class="literal">ServletRequest.getParameter*()</code> family of methods to support form field access only for HTTP POST, not for HTTP PUT.</p> 
     <p>To support HTTP PUT and PATCH requests, the <code class="literal">spring-web</code> module provides the filter <code class="literal">HttpPutFormContentFilter</code>, which can be configured in <code class="literal">web.xml</code>:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;filter&gt;</span>
    <span class="hl-tag">&lt;filter-name&gt;</span>httpPutFormFilter<span class="hl-tag">&lt;/filter-name&gt;</span>
    <span class="hl-tag">&lt;filter-class&gt;</span>org.springframework.web.filter.HttpPutFormContentFilter<span class="hl-tag">&lt;/filter-class&gt;</span>
<span class="hl-tag">&lt;/filter&gt;</span>

<span class="hl-tag">&lt;filter-mapping&gt;</span>
    <span class="hl-tag">&lt;filter-name&gt;</span>httpPutFormFilter<span class="hl-tag">&lt;/filter-name&gt;</span>
    <span class="hl-tag">&lt;servlet-name&gt;</span>dispatcherServlet<span class="hl-tag">&lt;/servlet-name&gt;</span>
<span class="hl-tag">&lt;/filter-mapping&gt;</span>

<span class="hl-tag">&lt;servlet&gt;</span>
    <span class="hl-tag">&lt;servlet-name&gt;</span>dispatcherServlet<span class="hl-tag">&lt;/servlet-name&gt;</span>
    <span class="hl-tag">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hl-tag">&lt;/servlet-class&gt;</span>
<span class="hl-tag">&lt;/servlet&gt;</span></pre> 
     <p>The above filter intercepts HTTP PUT and PATCH requests with content type <code class="literal">application/x-www-form-urlencoded</code>, reads the form data from the body of the request, and wraps the <code class="literal">ServletRequest</code> in order to make the form data available through the <code class="literal">ServletRequest.getParameter*()</code> family of methods.</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>As <code class="literal">HttpPutFormContentFilter</code> consumes the body of the request, it should not be configured for PUT or PATCH URLs that rely on other converters for <code class="literal">application/x-www-form-urlencoded</code>. This includes <code class="literal">@RequestBody MultiValueMap&lt;String, String&gt;</code> and <code class="literal">HttpEntity&lt;MultiValueMap&lt;String, String&gt;&gt;</code>.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="Mapping cookie values with the @CookieValue annotation">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-cookievalue"></a>Mapping cookie values with the @CookieValue annotation</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">@CookieValue</code> annotation allows a method parameter to be bound to the value of an HTTP cookie.</p> 
     <p>Let us consider that the following cookie has been received with an http request:</p> 
     <pre class="literallayout">JSESSIONID=415A4AC178C59DACE0B2C9CA727CDD84</pre> 
     <p>The following code sample demonstrates how to get the value of the <code class="literal">JSESSIONID</code> cookie:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping(&quot;/displayHeaderInfo.do&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> displayHeaderInfo(<span class="strong"><strong>@CookieValue(&quot;JSESSIONID&quot;)</strong></span> String cookie) {
    <span class="hl-comment">//...</span>
}</pre> 
     <p>Type conversion is applied automatically if the target method parameter type is not <code class="literal">String</code>. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-typeconversion" title="Method Parameters And Type Conversion">the section called Method Parameters And Type Conversion</a>.</p> 
     <p>This annotation is supported for annotated handler methods in Servlet and Portlet environments.</p> 
    </div> 
    <div class="section" title="Mapping request header attributes with the @RequestHeader annotation">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-requestheader"></a>Mapping request header attributes with the @RequestHeader annotation</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">@RequestHeader</code> annotation allows a method parameter to be bound to a request header.</p> 
     <p>Here is a sample request header:</p> 
     <pre class="literallayout">Host                    localhost:8080
Accept                  text/html,application/xhtml+xml,application/xml;q=0.9
Accept-Language         fr,en-gb;q=0.7,en;q=0.3
Accept-Encoding         gzip,deflate
Accept-Charset          ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive              300</pre> 
     <p>The following code sample demonstrates how to get the value of the <code class="literal">Accept-Encoding</code> and <code class="literal">Keep-Alive</code> headers:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping(&quot;/displayHeaderInfo.do&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> displayHeaderInfo(<span class="strong"><strong>@RequestHeader(&quot;Accept-Encoding&quot;)</strong></span> String encoding,
        <span class="strong"><strong>@RequestHeader(&quot;Keep-Alive&quot;)</strong></span> <span class="hl-keyword">long</span> keepAlive) {
    <span class="hl-comment">//...</span>
}</pre> 
     <p>Type conversion is applied automatically if the method parameter is not <code class="literal">String</code>. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-typeconversion" title="Method Parameters And Type Conversion">the section called Method Parameters And Type Conversion</a>.</p> 
     <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Tip">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
         <th align="left">Tip</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>Built-in support is available for converting a comma-separated string into an array/collection of strings or other types known to the type conversion system. For example a method parameter annotated with <code class="literal">@RequestHeader(&quot;Accept&quot;)</code> may be of type <code class="literal">String</code> but also <code class="literal">String[]</code> or <code class="literal">List&lt;String&gt;</code>.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <p>This annotation is supported for annotated handler methods in Servlet and Portlet environments.</p> 
    </div> 
    <div class="section" title="Method Parameters And Type Conversion">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-typeconversion"></a>Method Parameters And Type Conversion</h4>
       </div>
      </div>
     </div> 
     <p>String-based values extracted from the request including request parameters, path variables, request headers, and cookie values may need to be converted to the target type of the method parameter or field (e.g., binding a request parameter to a field in an <code class="literal">@ModelAttribute</code> parameter) theyre bound to. If the target type is not <code class="literal">String</code>, Spring automatically converts to the appropriate type. All simple types such as int, long, Date, etc. are supported. You can further customize the conversion process through a <code class="literal">WebDataBinder</code> (see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-webdatabinder" title="Customizing WebDataBinder initialization">the section called Customizing WebDataBinder initialization</a>) or by registering <code class="literal">Formatters</code> with the <code class="literal">FormattingConversionService</code> (see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#format" title="6.6&nbsp;Spring Field Formatting">Section&nbsp;6.6, Spring Field Formatting</a>).</p> 
    </div> 
    <div class="section" title="Customizing WebDataBinder initialization">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-webdatabinder"></a>Customizing WebDataBinder initialization</h4>
       </div>
      </div>
     </div> 
     <p>To customize request parameter binding with PropertyEditors through Springs <code class="literal">WebDataBinder</code>, you can use <code class="literal">@InitBinder</code>-annotated methods within your controller, <code class="literal">@InitBinder</code> methods within an <code class="literal">@ControllerAdvice</code> class, or provide a custom <code class="literal">WebBindingInitializer</code>. See the <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-controller-advice" title="Assisting Controllers with the @ControllerAdvice annotation">the section called Assisting Controllers with the @ControllerAdvice annotation</a> section for more details.</p> 
     <div class="section" title="Customizing data binding with @InitBinder">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="mvc-ann-initbinder"></a>Customizing data binding with @InitBinder</h5>
        </div>
       </div>
      </div> 
      <p>Annotating controller methods with <code class="literal">@InitBinder</code> allows you to configure web data binding directly within your controller class. <code class="literal">@InitBinder</code> identifies methods that initialize the <code class="literal">WebDataBinder</code> that will be used to populate command and form object arguments of annotated handler methods.</p> 
      <p>Such init-binder methods support all arguments that <code class="literal">@RequestMapping</code> supports, except for command/form objects and corresponding validation result objects. Init-binder methods must not have a return value. Thus, they are usually declared as <code class="literal">void</code>. Typical arguments include <code class="literal">WebDataBinder</code> in combination with <code class="literal">WebRequest</code> or <code class="literal">java.util.Locale</code>, allowing code to register context-specific editors.</p> 
      <p>The following example demonstrates the use of <code class="literal">@InitBinder</code> to configure a <code class="literal">CustomDateEditor</code> for all <code class="literal">java.util.Date</code> form properties.</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyFormController {

    <span class="strong"><strong>@InitBinder</strong></span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> initBinder(WebDataBinder binder) {
        SimpleDateFormat dateFormat = <span class="hl-keyword">new</span> SimpleDateFormat(<span class="hl-string">&quot;yyyy-MM-dd&quot;</span>);
        dateFormat.setLenient(false);
        binder.registerCustomEditor(Date.<span class="hl-keyword">class</span>, <span class="hl-keyword">new</span> CustomDateEditor(dateFormat, false));
    }

    <span class="hl-comment">// ...</span>

}</pre> 
     </div> 
     <div class="section" title="Configuring a custom WebBindingInitializer">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="mvc-ann-webbindinginitializer"></a>Configuring a custom WebBindingInitializer</h5>
        </div>
       </div>
      </div> 
      <p>To externalize data binding initialization, you can provide a custom implementation of the <code class="literal">WebBindingInitializer</code> interface, which you then enable by supplying a custom bean configuration for an <code class="literal">AnnotationMethodHandlerAdapter</code>, thus overriding the default configuration.</p> 
      <p>The following example from the PetClinic application shows a configuration using a custom implementation of the <code class="literal">WebBindingInitializer</code> interface, <code class="literal">org.springframework.samples.petclinic.web.ClinicBindingInitializer</code>, which configures PropertyEditors required by several of the PetClinic controllers.</p> 
      <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;cacheSeconds&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;0&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;webBindingInitializer&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.samples.petclinic.web.ClinicBindingInitializer&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
      <p><code class="literal">@InitBinder</code> methods can also be defined in an <code class="literal">@ControllerAdvice</code>-annotated class in which case they apply to matching controllers. This provides an alternative to using a <code class="literal">WebBindingInitializer</code>. See the <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-controller-advice" title="Assisting Controllers with the @ControllerAdvice annotation">the section called Assisting Controllers with the @ControllerAdvice annotation</a> section for more details.</p> 
     </div> 
    </div> 
    <div class="section" title="Support for the Last-Modified Response Header To Facilitate Content Caching">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-lastmodified"></a>Support for the Last-Modified Response Header To Facilitate Content Caching</h4>
       </div>
      </div>
     </div> 
     <p>An <code class="literal">@RequestMapping</code> method may wish to support <code class="literal">'Last-Modified'</code> HTTP requests, as defined in the contract for the Servlet APIs <code class="literal">getLastModified</code> method, to facilitate content caching. This involves calculating a lastModified <code class="literal">long</code> value for a given request, comparing it against the <code class="literal">'If-Modified-Since'</code> request header value, and potentially returning a response with status code 304 (Not Modified). An annotated controller method can achieve that as follows:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping</span></i>
<span class="hl-keyword">public</span> String myHandleMethod(WebRequest webRequest, Model model) {

    <span class="hl-keyword">long</span> lastModified = <span class="hl-comment">// 1. application-specific calculation</span>

    <span class="hl-keyword">if</span> (request.checkNotModified(lastModified)) {
        <span class="hl-comment">// 2. shortcut exit - no further processing necessary</span>
        <span class="hl-keyword">return</span> null;
    }

    <span class="hl-comment">// 3. or otherwise further request processing, actually preparing content</span>
    model.addAttribute(...);
    <span class="hl-keyword">return</span> <span class="hl-string">&quot;myViewName&quot;</span>;
}</pre> 
     <p>There are two key elements to note: calling <code class="literal">request.checkNotModified(lastModified)</code> and returning <code class="literal">null</code>. The former sets the response status to 304 before it returns <code class="literal">true</code>. The latter, in combination with the former, causes Spring MVC to do no further processing of the request.</p> 
    </div> 
    <div class="section" title="Assisting Controllers with the @ControllerAdvice annotation">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-controller-advice"></a>Assisting Controllers with the @ControllerAdvice annotation</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">@ControllerAdvice</code> annotation is a component annotation allowing implementation classes to be autodetected through classpath scanning. It is automatically enabled when using the MVC namespace or the MVC Java config.</p> 
     <p>Classes annotated with <code class="literal">@ControllerAdvice</code> can contain <code class="literal">@ExceptionHandler</code>, <code class="literal">@InitBinder</code>, and <code class="literal">@ModelAttribute</code> annotated methods and those will apply to <code class="literal">@RequestMapping</code> methods across controller hierarchies as opposed to the controller hierarchy within which they are declared.</p> 
     <p>The <code class="literal">@ControllerAdvice</code> annotation can also target a subset of controllers with its attributes:</p> 
     <pre class="programlisting"><span class="hl-comment">// Target all Controllers annotated with @RestController</span>
<i><span class="hl-annotation" style="color: gray">@ControllerAdvice(annotations = RestController.class)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AnnotationAdvice {}

<span class="hl-comment">// Target all Controllers within specific packages</span>
<i><span class="hl-annotation" style="color: gray">@ControllerAdvice(&quot;org.example.controllers&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BasePackageAdvice {}

<span class="hl-comment">// Target all Controllers assignable to specific classes</span>
<i><span class="hl-annotation" style="color: gray">@ControllerAdvice(assignableTypes = {ControllerInterface.class, AbstractController.class})</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AssignableTypesAdvice {}</pre> 
     <p>Check out the <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/bind/annotation/ControllerAdvice.html" target="_top"><code class="literal">@ControllerAdvice</code> documentation</a> for more details.</p> 
    </div> 
   </div> 
   <div class="section" title="16.3.4&nbsp;Asynchronous Request Processing">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-ann-async"></a>16.3.4&nbsp;Asynchronous Request Processing</h3>
      </div>
     </div>
    </div> 
    <p>Spring MVC 3.2 introduced Servlet 3 based asynchronous request processing. Instead of returning a value, as usual, a controller method can now return a <code class="literal">java.util.concurrent.Callable</code> and produce the return value from a separate thread. Meanwhile the main Servlet container thread is released and allowed to process other requests. Spring MVC invokes the <code class="literal">Callable</code> in a separate thread with the help of a <code class="literal">TaskExecutor</code> and when the <code class="literal">Callable</code> returns, the request is dispatched back to the Servlet container to resume processing with the value returned by the <code class="literal">Callable</code>. Here is an example controller method:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping(method=RequestMethod.POST)</span></i>
<span class="hl-keyword">public</span> Callable&lt;String&gt; processUpload(<span class="hl-keyword">final</span> MultipartFile file) {

    <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Callable&lt;String&gt;() {
        <span class="hl-keyword">public</span> String call() <span class="hl-keyword">throws</span> Exception {
            <span class="hl-comment">// ...</span>
            <span class="hl-keyword">return</span> <span class="hl-string">&quot;someView&quot;</span>;
        }
    };

}</pre> 
    <p>A second option is for the controller to return an instance of <code class="literal">DeferredResult</code>. In this case the return value will also be produced from a separate thread. However, that thread is not known to Spring MVC. For example the result may be produced in response to some external event such as a JMS message, a scheduled task, etc. Here is an example controller method:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping(&quot;/quotes&quot;)</span></i>
<i><span class="hl-annotation" style="color: gray">@ResponseBody</span></i>
<span class="hl-keyword">public</span> DeferredResult&lt;String&gt; quotes() {
    DeferredResult&lt;String&gt; deferredResult = <span class="hl-keyword">new</span> DeferredResult&lt;String&gt;();
    <span class="hl-comment">// Save the deferredResult in in-memory queue ...</span>
    <span class="hl-keyword">return</span> deferredResult;
}

<span class="hl-comment">// In some other thread...</span>
deferredResult.setResult(data);</pre> 
    <p>This may be difficult to understand without any knowledge of the Servlet 3 async processing feature. It would certainly help to read up on it. At a very minimum consider the following basic facts:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> A <code class="literal">ServletRequest</code> can be put in asynchronous mode by calling <code class="literal">request.startAsync()</code>. The main effect of doing so is that the Servlet, as well as any Filters, can exit but the response will remain open allowing some other thread to complete processing. </li>
      <li class="listitem"> The call to <code class="literal">request.startAsync()</code> returns an <code class="literal">AsyncContext</code>, which can be used for further control over async processing. For example it provides the method <code class="literal">dispatch</code>, which can be called from an application thread in order to &quot;dispatch&quot; the request back to the Servlet container. An async dispatch is similar to a forward except it is made from one (application) thread to another (Servlet container) thread whereas a forward occurs synchronously in the same (Servlet container) thread. </li>
      <li class="listitem"> <code class="literal">ServletRequest</code> provides access to the current <code class="literal">DispatcherType</code>, which can be used to distinguish if a <code class="literal">Servlet</code> or a <code class="literal">Filter</code> is processing on the initial request processing thread and when it is processing in an async dispatch. </li>
     </ul>
    </div> 
    <p>With the above in mind, the following is the sequence of events for async request processing with a <code class="literal">Callable</code>: (1) Controller returns a <code class="literal">Callable</code>, (2) Spring MVC starts async processing and submits the <code class="literal">Callable</code> to a <code class="literal">TaskExecutor</code> for processing in a separate thread, (3) the <code class="literal">DispatcherServlet</code> and all Filters exit the request processing thread but the response remains open, (4) the <code class="literal">Callable</code> produces a result and Spring MVC dispatches the request back to the Servlet container, (5) the <code class="literal">DispatcherServlet</code> is invoked again and processing resumes with the asynchronously produced result from the <code class="literal">Callable</code>. The exact sequencing of (2), (3), and (4) may vary depending on the speed of execution of the concurrent threads.</p> 
    <p>The sequence of events for async request processing with a <code class="literal">DeferredResult</code> is the same in principal except its up to the application to produce the asynchronous result from some thread: (1) Controller returns a <code class="literal">DeferredResult</code> and saves it in some in-memory queue or list where it can be accessed, (2) Spring MVC starts async processing, (3) the <code class="literal">DispatcherServlet</code> and all configured Filters exit the request processing thread but the response remains open, (4) the application sets the <code class="literal">DeferredResult</code> from some thread and Spring MVC dispatches the request back to the Servlet container, (5) the <code class="literal">DispatcherServlet</code> is invoked again and processing resumes with the asynchronously produced result.</p> 
    <p>Explaining the motivation for async request processing and when or why to use it are beyond the scope of this document. For further information you may wish to read <a class="ulink" href="http://spring.io/blog/2012/05/07/spring-mvc-3-2-preview-introducing-servlet-3-async-support" target="_top">this blog post series</a>.</p> 
    <div class="section" title="Exception Handling for Async Requests">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-async-exceptions"></a>Exception Handling for Async Requests</h4>
       </div>
      </div>
     </div> 
     <p>What happens if a <code class="literal">Callable</code> returned from a controller method raises an Exception while being executed? The effect is similar to what happens when any controller method raises an exception. It is handled by a matching <code class="literal">@ExceptionHandler</code> method in the same controller or by one of the configured <code class="literal">HandlerExceptionResolver</code> instances.</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>Under the covers, when a <code class="literal">Callable</code> raises an Exception, Spring MVC still dispatches to the Servlet container to resume processing. The only difference is that the result of executing the <code class="literal">Callable</code> is an <code class="literal">Exception</code> that must be processed with the configured <code class="literal">HandlerExceptionResolver</code> instances.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <p>When using a <code class="literal">DeferredResult</code>, you have a choice of calling its <code class="literal">setErrorResult(Object)</code> method and provide an <code class="literal">Exception</code> or any other Object youd like to use as the result. If the result is an <code class="literal">Exception</code>, it will be processed with a matching <code class="literal">@ExceptionHandler</code> method in the same controller or with any configured <code class="literal">HandlerExceptionResolver</code> instance.</p> 
    </div> 
    <div class="section" title="Intercepting Async Requests">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-async-interception"></a>Intercepting Async Requests</h4>
       </div>
      </div>
     </div> 
     <p>An existing <code class="literal">HandlerInterceptor</code> can implement <code class="literal">AsyncHandlerInterceptor</code>, which provides one additional method <code class="literal">afterConcurrentHandlingStarted</code>. It is invoked after async processing starts and when the initial request processing thread is being exited. See the Javadoc of <code class="literal">AsyncHandlerInterceptor</code> for more details on that.</p> 
     <p>Further options for async request lifecycle callbacks are provided directly on <code class="literal">DeferredResult</code>, which has the methods <code class="literal">onTimeout(Runnable)</code> and <code class="literal">onCompletion(Runnable)</code>. Those are called when the async request is about to time out or has completed respectively. The timeout event can be handled by setting the <code class="literal">DeferredResult</code> to some value. The completion callback however is final and the result can no longer be set.</p> 
     <p>Similar callbacks are also available with a <code class="literal">Callable</code>. However, you will need to wrap the <code class="literal">Callable</code> in an instance of <code class="literal">WebAsyncTask</code> and then use that to register the timeout and completion callbacks. Just like with <code class="literal">DeferredResult</code>, the timeout event can be handled and a value can be returned while the completion event is final.</p> 
     <p>You can also register a <code class="literal">CallableProcessingInterceptor</code> or a <code class="literal">DeferredResultProcessingInterceptor</code> globally through the MVC Java config or the MVC namespace. Those interceptors provide a full set of callbacks and apply every time a <code class="literal">Callable</code> or a <code class="literal">DeferredResult</code> is used.</p> 
    </div> 
    <div class="section" title="Configuration for Async Request Processing">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-ann-async-configuration"></a>Configuration for Async Request Processing</h4>
       </div>
      </div>
     </div> 
     <div class="section" title="Servlet 3 Async Config">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="mvc-ann-async-configuration-servlet3"></a>Servlet 3 Async Config</h5>
        </div>
       </div>
      </div> 
      <p>To use Servlet 3 async request processing, you need to update <code class="literal">web.xml</code> to version 3.0:</p> 
      <pre class="programlisting"><span class="hl-tag">&lt;web-app</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span>
    <span class="hl-attribute">version</span>=<span class="hl-value">&quot;3.0&quot;</span><span class="hl-tag">&gt;</span>

    ...

<span class="hl-tag">&lt;/web-app&gt;</span></pre> 
      <p>The <code class="literal">DispatcherServlet</code> and any <code class="literal">Filter</code> configuration need to have the <code class="literal">&lt;async-supported&gt;true&lt;/async-supported&gt;</code> sub-element. Additionally, any <code class="literal">Filter</code> that also needs to get involved in async dispatches should also be configured to support the ASYNC dispatcher type. Note that it is safe to enable the ASYNC dispatcher type for all filters provided with the Spring Framework since they will not get involved in async dispatches unless needed.</p> 
      <p>If using Servlet 3, Java based configuration, e.g. via <code class="literal">WebApplicationInitializer</code>, youll also need to set the &quot;asyncSupported&quot; flag as well as the ASYNC dispatcher type just like with <code class="literal">web.xml</code>. To simplify all this configuration, consider extending <code class="literal">AbstractDispatcherServletInitializer</code> or <code class="literal">AbstractAnnotationConfigDispatcherServletInitializer</code>, which automatically set those options and make it very easy to register <code class="literal">Filter</code> instances.</p> 
     </div> 
     <div class="section" title="Spring MVC Async Config">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="mvc-ann-async-configuration-spring-mvc"></a>Spring MVC Async Config</h5>
        </div>
       </div>
      </div> 
      <p>The MVC Java config and the MVC namespace both provide options for configuring async request processing. <code class="literal">WebMvcConfigurer</code> has the method <code class="literal">configureAsyncSupport</code> while &lt;mvc:annotation-driven&gt; has an &lt;async-support&gt; sub-element.</p> 
      <p>Those allow you to configure the default timeout value to use for async requests, which if not set depends on the underlying Servlet container (e.g. 10 seconds on Tomcat). You can also configure an <code class="literal">AsyncTaskExecutor</code> to use for executing <code class="literal">Callable</code> instances returned from controller methods. It is highly recommended to configure this property since by default Spring MVC uses <code class="literal">SimpleAsyncTaskExecutor</code>. The MVC Java config and the MVC namespace also allow you to register <code class="literal">CallableProcessingInterceptor</code> and <code class="literal">DeferredResultProcessingInterceptor</code> instances.</p> 
      <p>If you need to override the default timeout value for a specific <code class="literal">DeferredResult</code>, you can do so by using the appropriate class constructor. Similarly, for a <code class="literal">Callable</code>, you can wrap it in a <code class="literal">WebAsyncTask</code> and use the appropriate class constructor to customize the timeout value. The class constructor of <code class="literal">WebAsyncTask</code> also allows providing an <code class="literal">AsyncTaskExecutor</code>.</p> 
     </div> 
    </div> 
   </div> 
   <div class="section" title="16.3.5&nbsp;Testing Controllers">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-ann-tests"></a>16.3.5&nbsp;Testing Controllers</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">spring-test</code> module offers first class support for testing annotated controllers. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#spring-mvc-test-framework" title="10.3.6&nbsp;Spring MVC Test Framework">Section&nbsp;10.3.6, Spring MVC Test Framework</a>.</p> 
   </div> 
  </div> 
  <div class="section" title="16.4&nbsp;Handler mappings">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="mvc-handlermapping"></a>16.4&nbsp;Handler mappings</h2>
     </div>
    </div>
   </div> 
   <p>In previous versions of Spring, users were required to define one or more <code class="literal">HandlerMapping</code> beans in the web application context to map incoming web requests to appropriate handlers. With the introduction of annotated controllers, you generally dont need to do that because the <code class="literal">RequestMappingHandlerMapping</code> automatically looks for <code class="literal">@RequestMapping</code> annotations on all <code class="literal">@Controller</code> beans. However, do keep in mind that all <code class="literal">HandlerMapping</code> classes extending from <code class="literal">AbstractHandlerMapping</code> have the following properties that you can use to customize their behavior:</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem"> <code class="literal">interceptors</code> List of interceptors to use. <code class="literal">HandlerInterceptor</code> s are discussed in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-handlermapping-interceptor" title="16.4.1&nbsp;Intercepting requests with a HandlerInterceptor">Section&nbsp;16.4.1, Intercepting requests with a HandlerInterceptor</a>. </li>
     <li class="listitem"> <code class="literal">defaultHandler</code> Default handler to use, when this handler mapping does not result in a matching handler. </li>
     <li class="listitem"> <code class="literal">order</code> Based on the value of the order property (see the <code class="literal">org.springframework.core.Ordered</code> interface), Spring sorts all handler mappings available in the context and applies the first matching handler. </li>
     <li class="listitem"> <code class="literal">alwaysUseFullPath</code> If <code class="literal">true</code> , Spring uses the full path within the current Servlet context to find an appropriate handler. If <code class="literal">false</code> (the default), the path within the current Servlet mapping is used. For example, if a Servlet is mapped using <code class="literal">/testing/*</code> and the <code class="literal">alwaysUseFullPath</code> property is set to true, <code class="literal">/testing/viewPage.html</code> is used, whereas if the property is set to false, <code class="literal">/viewPage.html</code> is used. </li>
     <li class="listitem"> <code class="literal">urlDecode</code> Defaults to <code class="literal">true</code>, as of Spring 2.5. If you prefer to compare encoded paths, set this flag to <code class="literal">false</code>. However, the <code class="literal">HttpServletRequest</code> always exposes the Servlet path in decoded form. Be aware that the Servlet path will not match when compared with encoded paths. </li>
    </ul>
   </div> 
   <p>The following example shows how to configure an interceptor:</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;handlerMapping&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;interceptors&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.MyInterceptor&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;beans&gt;</span></pre> 
   <div class="section" title="16.4.1&nbsp;Intercepting requests with a HandlerInterceptor">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-handlermapping-interceptor"></a>16.4.1&nbsp;Intercepting requests with a HandlerInterceptor</h3>
      </div>
     </div>
    </div> 
    <p>Springs handler mapping mechanism includes handler interceptors, which are useful when you want to apply specific functionality to certain requests, for example, checking for a principal.</p> 
    <p>Interceptors located in the handler mapping must implement <code class="literal">HandlerInterceptor</code> from the <code class="literal">org.springframework.web.servlet</code> package. This interface defines three methods: <code class="literal">preHandle(..)</code> is called <span class="emphasis"><em>before</em></span> the actual handler is executed; <code class="literal">postHandle(..)</code> is called <span class="emphasis"><em>after</em></span> the handler is executed; and <code class="literal">afterCompletion(..)</code> is called <span class="emphasis"><em>after the complete request has finished</em></span>. These three methods should provide enough flexibility to do all kinds of preprocessing and postprocessing.</p> 
    <p>The <code class="literal">preHandle(..)</code> method returns a boolean value. You can use this method to break or continue the processing of the execution chain. When this method returns <code class="literal">true</code>, the handler execution chain will continue; when it returns false, the <code class="literal">DispatcherServlet</code> assumes the interceptor itself has taken care of requests (and, for example, rendered an appropriate view) and does not continue executing the other interceptors and the actual handler in the execution chain.</p> 
    <p>Interceptors can be configured using the <code class="literal">interceptors</code> property, which is present on all <code class="literal">HandlerMapping</code> classes extending from <code class="literal">AbstractHandlerMapping</code>. This is shown in the example below:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;handlerMapping&quot;</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;interceptors&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;list&gt;</span>
                <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">&quot;officeHoursInterceptor&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/list&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;officeHoursInterceptor&quot;</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">&quot;samples.TimeBasedAccessInterceptor&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;openingTime&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;9&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;closingTime&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;18&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;beans&gt;</span></pre> 
    <pre class="programlisting"><span class="hl-keyword">package</span> samples;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TimeBasedAccessInterceptor <span class="hl-keyword">extends</span> HandlerInterceptorAdapter {

    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> openingTime;
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> closingTime;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setOpeningTime(<span class="hl-keyword">int</span> openingTime) {
        <span class="hl-keyword">this</span>.openingTime = openingTime;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setClosingTime(<span class="hl-keyword">int</span> closingTime) {
        <span class="hl-keyword">this</span>.closingTime = closingTime;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> preHandle(HttpServletRequest request, HttpServletResponse response,
            Object handler) <span class="hl-keyword">throws</span> Exception {
        Calendar cal = Calendar.getInstance();
        <span class="hl-keyword">int</span> hour = cal.get(HOUR_OF_DAY);
        <span class="hl-keyword">if</span> (openingTime &lt;= hour &amp;&amp; hour &lt; closingTime) {
            <span class="hl-keyword">return</span> true;
        }
        response.sendRedirect(<span class="hl-string">&quot;http://host.com/outsideOfficeHours.html&quot;</span>);
        <span class="hl-keyword">return</span> false;
    }
}</pre> 
    <p>Any request handled by this mapping is intercepted by the <code class="literal">TimeBasedAccessInterceptor</code>. If the current time is outside office hours, the user is redirected to a static HTML file that says, for example, you can only access the website during office hours.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>When using the <code class="literal">RequestMappingHandlerMapping</code> the actual handler is an instance of <code class="literal">HandlerMethod</code> which identifies the specific controller method that will be invoked.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>As you can see, the Spring adapter class <code class="literal">HandlerInterceptorAdapter</code> makes it easier to extend the <code class="literal">HandlerInterceptor</code> interface.</p> 
    <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Tip">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
        <th align="left">Tip</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>In the example above, the configured interceptor will apply to all requests handled with annotated controller methods. If you want to narrow down the URL paths to which an interceptor applies, you can use the MVC namespace or the MVC Java config, or declare bean instances of type <code class="literal">MappedInterceptor</code> to do that. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-config-enable" title="16.16.1&nbsp;Enabling the MVC Java Config or the MVC XML Namespace">Section&nbsp;16.16.1, Enabling the MVC Java Config or the MVC XML Namespace</a>.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
  </div> 
  <div class="section" title="16.5&nbsp;Resolving views">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="mvc-viewresolver"></a>16.5&nbsp;Resolving views</h2>
     </div>
    </div>
   </div> 
   <p>All MVC frameworks for web applications provide a way to address views. Spring provides view resolvers, which enable you to render models in a browser without tying you to a specific view technology. Out of the box, Spring enables you to use JSPs, Velocity templates and XSLT views, for example. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#view" title="17.&nbsp;View technologies">Chapter&nbsp;17, <i>View technologies</i></a> for a discussion of how to integrate and use a number of disparate view technologies.</p> 
   <p>The two interfaces that are important to the way Spring handles views are <code class="literal">ViewResolver</code> and <code class="literal">View</code>. The <code class="literal">ViewResolver</code> provides a mapping between view names and actual views. The <code class="literal">View</code> interface addresses the preparation of the request and hands the request over to one of the view technologies.</p> 
   <div class="section" title="16.5.1&nbsp;Resolving views with the ViewResolver interface">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-viewresolver-resolver"></a>16.5.1&nbsp;Resolving views with the ViewResolver interface</h3>
      </div>
     </div>
    </div> 
    <p>As discussed in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-controller" title="16.3&nbsp;Implementing Controllers">Section&nbsp;16.3, Implementing Controllers</a>, all handler methods in the Spring Web MVC controllers must resolve to a logical view name, either explicitly (e.g., by returning a <code class="literal">String</code>, <code class="literal">View</code>, or <code class="literal">ModelAndView</code>) or implicitly (i.e., based on conventions). Views in Spring are addressed by a logical view name and are resolved by a view resolver. Spring comes with quite a few view resolvers. This table lists most of them; a couple of examples follow.</p> 
    <div class="table">
     <a name="mvc-view-resolvers-tbl"></a>
     <p class="title"><b>Table&nbsp;16.3.&nbsp;View resolvers</b></p>
     <div class="table-contents"> 
      <table summary="View resolvers" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
       <colgroup>
        <col />
        <col />
       </colgroup>
       <thead>
        <tr>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">ViewResolver</th>
         <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">AbstractCachingViewResolver</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Abstract view resolver that caches views. Often views need preparation before they can be used; extending this view resolver provides caching.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">XmlViewResolver</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Implementation of <code class="literal">ViewResolver</code> that accepts a configuration file written in XML with the same DTD as Springs XML bean factories. The default configuration file is <code class="literal">/WEB-INF/views.xml</code>.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ResourceBundleViewResolver</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Implementation of <code class="literal">ViewResolver</code> that uses bean definitions in a <code class="literal">ResourceBundle</code>, specified by the bundle base name. Typically you define the bundle in a properties file, located in the classpath. The default file name is <code class="literal">views.properties</code>.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">UrlBasedViewResolver</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Simple implementation of the <code class="literal">ViewResolver</code> interface that effects the direct resolution of logical view names to URLs, without an explicit mapping definition. This is appropriate if your logical names match the names of your view resources in a straightforward manner, without the need for arbitrary mappings.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">InternalResourceViewResolver</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Convenient subclass of <code class="literal">UrlBasedViewResolver</code> that supports <code class="literal">InternalResourceView</code> (in effect, Servlets and JSPs) and subclasses such as <code class="literal">JstlView</code> and <code class="literal">TilesView</code>. You can specify the view class for all views generated by this resolver by using <code class="literal">setViewClass(..)</code>. See the Javadocs for the <code class="literal">UrlBasedViewResolver</code> class for details.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">VelocityViewResolver</code> / <code class="literal">FreeMarkerViewResolver</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Convenient subclass of <code class="literal">UrlBasedViewResolver</code> that supports <code class="literal">VelocityView</code> (in effect, Velocity templates) or <code class="literal">FreeMarkerView</code> ,respectively, and custom subclasses of them.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ContentNegotiatingViewResolver</code></p></td>
         <td style="" align="left" valign="top"><p>Implementation of the <code class="literal">ViewResolver</code> interface that resolves a view based on the request file name or <code class="literal">Accept</code> header. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-multiple-representations" title="16.5.4&nbsp;ContentNegotiatingViewResolver">Section&nbsp;16.5.4, ContentNegotiatingViewResolver</a>.</p></td>
        </tr>
       </tbody>
      </table> 
     </div>
    </div>
    <br class="table-break" /> 
    <p>As an example, with JSP as a view technology, you can use the <code class="literal">UrlBasedViewResolver</code>. This view resolver translates a view name to a URL and hands the request over to the RequestDispatcher to render the view.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;viewResolver&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.UrlBasedViewResolver&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;viewClass&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.JstlView&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;prefix&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;/WEB-INF/jsp/&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;suffix&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;.jsp&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>When returning <code class="literal">test</code> as a logical view name, this view resolver forwards the request to the <code class="literal">RequestDispatcher</code> that will send the request to <code class="literal">/WEB-INF/jsp/test.jsp</code>.</p> 
    <p>When you combine different view technologies in a web application, you can use the <code class="literal">ResourceBundleViewResolver</code>:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;viewResolver&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.ResourceBundleViewResolver&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;basename&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;views&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;defaultParentView&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;parentView&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>The <code class="literal">ResourceBundleViewResolver</code> inspects the <code class="literal">ResourceBundle</code> identified by the basename, and for each view it is supposed to resolve, it uses the value of the property <code class="literal">[viewname].(class)</code> as the view class and the value of the property <code class="literal">[viewname].url</code> as the view url. Examples can be found in the next chapter which covers view technologies. As you can see, you can identify a parent view, from which all views in the properties file &quot;extend&quot;. This way you can specify a default view class, for example.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Subclasses of <code class="literal">AbstractCachingViewResolver</code> cache view instances that they resolve. Caching improves performance of certain view technologies. Its possible to turn off the cache by setting the <code class="literal">cache</code> property to <code class="literal">false</code>. Furthermore, if you must refresh a certain view at runtime (for example when a Velocity template is modified), you can use the <code class="literal">removeFromCache(String viewName, Locale loc)</code> method.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="16.5.2&nbsp;Chaining ViewResolvers">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-viewresolver-chaining"></a>16.5.2&nbsp;Chaining ViewResolvers</h3>
      </div>
     </div>
    </div> 
    <p>Spring supports multiple view resolvers. Thus you can chain resolvers and, for example, override specific views in certain circumstances. You chain view resolvers by adding more than one resolver to your application context and, if necessary, by setting the <code class="literal">order</code> property to specify ordering. Remember, the higher the order property, the later the view resolver is positioned in the chain.</p> 
    <p>In the following example, the chain of view resolvers consists of two resolvers, an <code class="literal">InternalResourceViewResolver</code>, which is always automatically positioned as the last resolver in the chain, and an <code class="literal">XmlViewResolver</code> for specifying Excel views. Excel views are not supported by the <code class="literal">InternalResourceViewResolver</code>.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;jspViewResolver&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;viewClass&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.JstlView&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;prefix&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;/WEB-INF/jsp/&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;suffix&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;.jsp&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;excelViewResolver&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.XmlViewResolver&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;order&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;1&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;location&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;/WEB-INF/views.xml&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-comment">&lt;!-- in views.xml --&gt;</span>

<span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;report&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.example.ReportExcelView&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>If a specific view resolver does not result in a view, Spring examines the context for other view resolvers. If additional view resolvers exist, Spring continues to inspect them until a view is resolved. If no view resolver returns a view, Spring throws a <code class="literal">ServletException</code>.</p> 
    <p>The contract of a view resolver specifies that a view resolver <span class="emphasis"><em>can</em></span> return null to indicate the view could not be found. Not all view resolvers do this, however, because in some cases, the resolver simply cannot detect whether or not the view exists. For example, the <code class="literal">InternalResourceViewResolver</code> uses the <code class="literal">RequestDispatcher</code> internally, and dispatching is the only way to figure out if a JSP exists, but this action can only execute once. The same holds for the <code class="literal">VelocityViewResolver</code> and some others. Check the Javadoc for the view resolver to see whether it reports non-existing views. Thus, putting an <code class="literal">InternalResourceViewResolver</code> in the chain in a place other than the last, results in the chain not being fully inspected, because the <code class="literal">InternalResourceViewResolver</code> will <span class="emphasis"><em>always</em></span> return a view!</p> 
   </div> 
   <div class="section" title="16.5.3&nbsp;Redirecting to views">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-redirecting"></a>16.5.3&nbsp;Redirecting to views</h3>
      </div>
     </div>
    </div> 
    <p>As mentioned previously, a controller typically returns a logical view name, which a view resolver resolves to a particular view technology. For view technologies such as JSPs that are processed through the Servlet or JSP engine, this resolution is usually handled through the combination of <code class="literal">InternalResourceViewResolver</code> and <code class="literal">InternalResourceView</code>, which issues an internal forward or include via the Servlet APIs <code class="literal">RequestDispatcher.forward(..)</code> method or <code class="literal">RequestDispatcher.include()</code> method. For other view technologies, such as Velocity, XSLT, and so on, the view itself writes the content directly to the response stream.</p> 
    <p>It is sometimes desirable to issue an HTTP redirect back to the client, before the view is rendered. This is desirable, for example, when one controller has been called with <code class="literal">POST</code> data, and the response is actually a delegation to another controller (for example on a successful form submission). In this case, a normal internal forward will mean that the other controller will also see the same <code class="literal">POST</code> data, which is potentially problematic if it can confuse it with other expected data. Another reason to perform a redirect before displaying the result is to eliminate the possibility of the user submitting the form data multiple times. In this scenario, the browser will first send an initial <code class="literal">POST</code>; it will then receive a response to redirect to a different URL; and finally the browser will perform a subsequent <code class="literal">GET</code> for the URL named in the redirect response. Thus, from the perspective of the browser, the current page does not reflect the result of a <code class="literal">POST</code> but rather of a <code class="literal">GET</code>. The end effect is that there is no way the user can accidentally re- <code class="literal">POST</code> the same data by performing a refresh. The refresh forces a <code class="literal">GET</code> of the result page, not a resend of the initial <code class="literal">POST</code> data.</p> 
    <div class="section" title="RedirectView">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-redirecting-redirect-view"></a>RedirectView</h4>
       </div>
      </div>
     </div> 
     <p>One way to force a redirect as the result of a controller response is for the controller to create and return an instance of Springs <code class="literal">RedirectView</code>. In this case, <code class="literal">DispatcherServlet</code> does not use the normal view resolution mechanism. Rather because it has been given the (redirect) view already, the <code class="literal">DispatcherServlet</code> simply instructs the view to do its work.</p> 
     <p>The <code class="literal">RedirectView</code> issues an <code class="literal">HttpServletResponse.sendRedirect()</code> call that returns to the client browser as an HTTP redirect. By default all model attributes are considered to be exposed as URI template variables in the redirect URL. Of the remaining attributes those that are primitive types or collections/arrays of primitive types are automatically appended as query parameters.</p> 
     <p>Appending primitive type attributes as query parameters may be the desired result if a model instance was prepared specifically for the redirect. However, in annotated controllers the model may contain additional attributes added for rendering purposes (e.g. drop-down field values). To avoid the possibility of having such attributes appear in the URL an annotated controller can declare an argument of type <code class="literal">RedirectAttributes</code> and use it to specify the exact attributes to make available to <code class="literal">RedirectView</code>. If the controller method decides to redirect, the content of <code class="literal">RedirectAttributes</code> is used. Otherwise the content of the model is used.</p> 
     <p>Note that URI template variables from the present request are automatically made available when expanding a redirect URL and do not need to be added explicitly neither through <code class="literal">Model</code> nor <code class="literal">RedirectAttributes</code>. For example:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping(value = &quot;/files/{path}&quot;, method = RequestMethod.POST)</span></i>
<span class="hl-keyword">public</span> String upload(...) {
    <span class="hl-comment">// ...</span>
    <span class="hl-keyword">return</span> <span class="hl-string">&quot;redirect:files/{path}&quot;</span>;
}</pre> 
     <p>If you use <code class="literal">RedirectView</code> and the view is created by the controller itself, it is recommended that you configure the redirect URL to be injected into the controller so that it is not baked into the controller but configured in the context along with the view names. The next section discusses this process.</p> 
    </div> 
    <div class="section" title="The redirect: prefix">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-redirecting-redirect-prefix"></a>The redirect: prefix</h4>
       </div>
      </div>
     </div> 
     <p>While the use of <code class="literal">RedirectView</code> works fine, if the controller itself creates the <code class="literal">RedirectView</code>, there is no avoiding the fact that the controller is aware that a redirection is happening. This is really suboptimal and couples things too tightly. The controller should not really care about how the response gets handled. In general it should operate only in terms of view names that have been injected into it.</p> 
     <p>The special <code class="literal">redirect:</code> prefix allows you to accomplish this. If a view name is returned that has the prefix <code class="literal">redirect:</code>, the <code class="literal">UrlBasedViewResolver</code> (and all subclasses) will recognize this as a special indication that a redirect is needed. The rest of the view name will be treated as the redirect URL.</p> 
     <p>The net effect is the same as if the controller had returned a <code class="literal">RedirectView</code>, but now the controller itself can simply operate in terms of logical view names. A logical view name such as <code class="literal">redirect:/myapp/some/resource</code> will redirect relative to the current Servlet context, while a name such as <code class="literal"><span>redirect:<a class="smarterwiki-linkify" href="http://myhost.com/some/arbitrary/path">http://myhost.com/some/arbitrary/path</a></span></code> will redirect to an absolute URL.</p> 
    </div> 
    <div class="section" title="The forward: prefix">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mvc-redirecting-forward-prefix"></a>The forward: prefix</h4>
       </div>
      </div>
     </div> 
     <p>It is also possible to use a special <code class="literal">forward:</code> prefix for view names that are ultimately resolved by <code class="literal">UrlBasedViewResolver</code> and subclasses. This creates an <code class="literal">InternalResourceView</code> (which ultimately does a <code class="literal">RequestDispatcher.forward()</code>) around the rest of the view name, which is considered a URL. Therefore, this prefix is not useful with <code class="literal">InternalResourceViewResolver</code> and <code class="literal">InternalResourceView</code> (for JSPs for example). But the prefix can be helpful when you are primarily using another view technology, but still want to force a forward of a resource to be handled by the Servlet/JSP engine. (Note that you may also chain multiple view resolvers, instead.)</p> 
     <p>As with the <code class="literal">redirect:</code> prefix, if the view name with the <code class="literal">forward:</code> prefix is injected into the controller, the controller does not detect that anything special is happening in terms of handling the response.</p> 
    </div> 
   </div> 
   <div class="section" title="16.5.4&nbsp;ContentNegotiatingViewResolver">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-multiple-representations"></a>16.5.4&nbsp;ContentNegotiatingViewResolver</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">ContentNegotiatingViewResolver</code> does not resolve views itself but rather delegates to other view resolvers, selecting the view that resembles the representation requested by the client. Two strategies exist for a client to request a representation from the server:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> Use a distinct URI for each resource, typically by using a different file extension in the URI. For example, the URI <code class="literal"><span><a class="smarterwiki-linkify" href="http://www.example.com/users/fred.pdf">http://www.example.com/users/fred.pdf</a></span></code> requests a PDF representation of the user fred, and <code class="literal"><span><a class="smarterwiki-linkify" href="http://www.example.com/users/fred.xml">http://www.example.com/users/fred.xml</a></span></code> requests an XML representation. </li>
      <li class="listitem"> Use the same URI for the client to locate the resource, but set the <code class="literal">Accept</code> HTTP request header to list the <a class="ulink" href="http://en.wikipedia.org/wiki/Internet_media_type" target="_top">media types</a> that it understands. For example, an HTTP request for <code class="literal"><span><a class="smarterwiki-linkify" href="http://www.example.com/users/fred">http://www.example.com/users/fred</a></span></code> with an <code class="literal">Accept</code> header set to <code class="literal">application/pdf</code> requests a PDF representation of the user fred, while <code class="literal"><span><a class="smarterwiki-linkify" href="http://www.example.com/users/fred">http://www.example.com/users/fred</a></span></code> with an <code class="literal">Accept</code> header set to <code class="literal">text/xml</code> requests an XML representation. This strategy is known as <a class="ulink" href="http://en.wikipedia.org/wiki/Content_negotiation" target="_top">content negotiation</a>. </li>
     </ul>
    </div> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>One issue with the <code class="literal">Accept</code> header is that it is impossible to set it in a web browser within HTML. For example, in Firefox, it is fixed to:</p> <pre class="literallayout">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,<span class="strong"><strong>/</strong></span>;q=0.8</pre> <p>For this reason it is common to see the use of a distinct URI for each representation when developing browser based web applications.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>To support multiple representations of a resource, Spring provides the <code class="literal">ContentNegotiatingViewResolver</code> to resolve a view based on the file extension or <code class="literal">Accept</code> header of the HTTP request. <code class="literal">ContentNegotiatingViewResolver</code> does not perform the view resolution itself but instead delegates to a list of view resolvers that you specify through the bean property <code class="literal">ViewResolvers</code>.</p> 
    <p>The <code class="literal">ContentNegotiatingViewResolver</code> selects an appropriate <code class="literal">View</code> to handle the request by comparing the request media type(s) with the media type (also known as <code class="literal">Content-Type</code>) supported by the <code class="literal">View</code> associated with each of its <code class="literal">ViewResolvers</code>. The first <code class="literal">View</code> in the list that has a compatible <code class="literal">Content-Type</code> returns the representation to the client. If a compatible view cannot be supplied by the <code class="literal">ViewResolver</code> chain, then the list of views specified through the <code class="literal">DefaultViews</code> property will be consulted. This latter option is appropriate for singleton <code class="literal">Views</code> that can render an appropriate representation of the current resource regardless of the logical view name. The <code class="literal">Accept</code> header may include wild cards, for example <code class="literal">text/*</code>, in which case a <code class="literal">View</code> whose Content-Type was <code class="literal">text/xml</code> is a compatible match.</p> 
    <p>To support the resolution of a view based on a file extension, use the <code class="literal">ContentNegotiatingViewResolver</code> bean property <code class="literal">mediaTypes</code> to specify a mapping of file extensions to media types. For more information on the algorithm used to determine the request media type, refer to the API documentation for <code class="literal">ContentNegotiatingViewResolver</code>.</p> 
    <p>Here is an example configuration of a <code class="literal">ContentNegotiatingViewResolver:</code></p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.ContentNegotiatingViewResolver&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;mediaTypes&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;map&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;atom&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;application/atom+xml&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;html&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;text/html&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;json&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;application/json&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/map&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;viewResolvers&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.BeanNameViewResolver&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span><span class="hl-tag">&gt;</span>
                <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;prefix&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;/WEB-INF/jsp/&quot;</span><span class="hl-tag">/&gt;</span>
                <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;suffix&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;.jsp&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/bean&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;defaultViews&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.json.MappingJackson2JsonView&quot;</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;content&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.springsource.samples.rest.SampleContentAtomView&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <p>The <code class="literal">InternalResourceViewResolver</code> handles the translation of view names and JSP pages, while the <code class="literal">BeanNameViewResolver</code> returns a view based on the name of a bean. (See &quot;<a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-viewresolver-resolver" title="16.5.1&nbsp;Resolving views with the ViewResolver interface">Resolving views with the ViewResolver interface</a>&quot; for more details on how Spring looks up and instantiates a view.) In this example, the <code class="literal">content</code> bean is a class that inherits from <code class="literal">AbstractAtomFeedView</code>, which returns an Atom RSS feed. For more information on creating an Atom Feed representation, see the section Atom Views.</p> 
    <p>In the above configuration, if a request is made with an <code class="literal">.html</code> extension, the view resolver looks for a view that matches the <code class="literal">text/html</code> media type. The <code class="literal">InternalResourceViewResolver</code> provides the matching view for <code class="literal">text/html</code>. If the request is made with the file extension <code class="literal">.atom</code>, the view resolver looks for a view that matches the <code class="literal">application/atom+xml</code> media type. This view is provided by the <code class="literal">BeanNameViewResolver</code> that maps to the <code class="literal">SampleContentAtomView</code> if the view name returned is <code class="literal">content</code>. If the request is made with the file extension <code class="literal">.json</code>, the <code class="literal">MappingJackson2JsonView</code> instance from the <code class="literal">DefaultViews</code> list will be selected regardless of the view name. Alternatively, client requests can be made without a file extension but with the <code class="literal">Accept</code> header set to the preferred media-type, and the same resolution of request to views would occur.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>If <code class="literal">ContentNegotiatingViewResolver</code>'s list of ViewResolvers is not configured explicitly, it automatically uses any ViewResolvers defined in the application context.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>The corresponding controller code that returns an Atom RSS feed for a URI of the form <code class="literal"><span><a class="smarterwiki-linkify" href="http://localhost/content.atom">http://localhost/content.atom</a></span></code> or <code class="literal"><span><a class="smarterwiki-linkify" href="http://localhost/content">http://localhost/content</a></span></code> with an <code class="literal">Accept</code> header of application/atom+xml is shown below.</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ContentController {

    <span class="hl-keyword">private</span> List&lt;SampleContent&gt; contentList = <span class="hl-keyword">new</span> ArrayList&lt;SampleContent&gt;();

    <i><span class="hl-annotation" style="color: gray">@RequestMapping(value=&quot;/content&quot;, method=RequestMethod.GET)</span></i>
    <span class="hl-keyword">public</span> ModelAndView getContent() {
        ModelAndView mav = <span class="hl-keyword">new</span> ModelAndView();
        mav.setViewName(<span class="hl-string">&quot;content&quot;</span>);
        mav.addObject(<span class="hl-string">&quot;sampleContentList&quot;</span>, contentList);
        <span class="hl-keyword">return</span> mav;
    }

}</pre> 
   </div> 
  </div> 
  <div class="section" title="16.6&nbsp;Using flash attributes">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="mvc-flash-attributes"></a>16.6&nbsp;Using flash attributes</h2>
     </div>
    </div>
   </div> 
   <p>Flash attributes provide a way for one request to store attributes intended for use in another. This is most commonly needed when redirecting&#x2009;&#x2009;for example, the <span class="emphasis"><em>Post/Redirect/Get</em></span> pattern. Flash attributes are saved temporarily before the redirect (typically in the session) to be made available to the request after the redirect and removed immediately.</p> 
   <p>Spring MVC has two main abstractions in support of flash attributes. <code class="literal">FlashMap</code> is used to hold flash attributes while <code class="literal">FlashMapManager</code> is used to store, retrieve, and manage <code class="literal">FlashMap</code> instances.</p> 
   <p>Flash attribute support is always &quot;on&quot; and does not need to enabled explicitly although if not used, it never causes HTTP session creation. On each request there is an &quot;input&quot; <code class="literal">FlashMap</code> with attributes passed from a previous request (if any) and an &quot;output&quot; <code class="literal">FlashMap</code> with attributes to save for a subsequent request. Both <code class="literal">FlashMap</code> instances are accessible from anywhere in Spring MVC through static methods in <code class="literal">RequestContextUtils</code>.</p> 
   <p>Annotated controllers typically do not need to work with <code class="literal">FlashMap</code> directly. Instead an <code class="literal">@RequestMapping</code> method can accept an argument of type <code class="literal">RedirectAttributes</code> and use it to add flash attributes for a redirect scenario. Flash attributes added via <code class="literal">RedirectAttributes</code> are automatically propagated to the &quot;output&quot; FlashMap. Similarly after the redirect attributes from the &quot;input&quot; <code class="literal">FlashMap</code> are automatically added to the <code class="literal">Model</code> of the controller serving the target URL.</p> 
   <div class="sidebar" title="Matching requests to flash attributes">
    <p class="title"><b>Matching requests to flash attributes</b></p> 
    <p>The concept of flash attributes exists in many other Web frameworks and has proven to be exposed sometimes to concurrency issues. This is because by definition flash attributes are to be stored until the next request. However the very &quot;next&quot; request may not be the intended recipient but another asynchronous request (e.g. polling or resource requests) in which case the flash attributes are removed too early.</p> 
    <p>To reduce the possibility of such issues, <code class="literal">RedirectView</code> automatically &quot;stamps&quot; <code class="literal">FlashMap</code> instances with the path and query parameters of the target redirect URL. In turn the default <code class="literal">FlashMapManager</code> matches that information to incoming requests when looking up the &quot;input&quot; <code class="literal">FlashMap</code>.</p> 
    <p>This does not eliminate the possibility of a concurrency issue entirely but nevertheless reduces it greatly with information that is already available in the redirect URL. Therefore the use of flash attributes is recommended mainly for redirect scenarios .</p> 
   </div> 
  </div> 
  <div class="section" title="16.7&nbsp;Building URIs">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="mvc-construct-encode-uri"></a>16.7&nbsp;Building URIs</h2>
     </div>
    </div>
   </div> 
   <p>Spring MVC provides a mechanism for building and encoding a URI using <code class="literal">UriComponentsBuilder</code> and <code class="literal">UriComponents</code>.</p> 
   <p>For example you can expand and encode a URI template string:</p> 
   <pre class="programlisting">UriComponents uriComponents = UriComponentsBuilder.fromUriString(
        <span class="hl-string">&quot;http://example.com/hotels/{hotel}/bookings/{booking}&quot;</span>).build();

URI uri = uriComponents.expand(<span class="hl-string">&quot;42&quot;</span>, <span class="hl-string">&quot;21&quot;</span>).encode().toUri();</pre> 
   <p>Note that <code class="literal">UriComponents</code> is immutable and the <code class="literal">expand()</code> and <code class="literal">encode()</code> operations return new instances if necessary.</p> 
   <p>You can also expand and encode using individual URI components:</p> 
   <pre class="programlisting">UriComponents uriComponents = UriComponentsBuilder.newInstance()
        .scheme(<span class="hl-string">&quot;http&quot;</span>).host(<span class="hl-string">&quot;example.com&quot;</span>).path(<span class="hl-string">&quot;/hotels/{hotel}/bookings/{booking}&quot;</span>).build()
        .expand(<span class="hl-string">&quot;42&quot;</span>, <span class="hl-string">&quot;21&quot;</span>)
        .encode();</pre> 
   <p>In a Servlet environment the <code class="literal">ServletUriComponentsBuilder</code> sub-class provides static factory methods to copy available URL information from a Servlet requests:</p> 
   <pre class="programlisting">HttpServletRequest request = ...

<span class="hl-comment">// Re-use host, scheme, port, path and query string</span>
<span class="hl-comment">// Replace the &quot;accountId&quot; query param</span>

ServletUriComponentsBuilder ucb = ServletUriComponentsBuilder.fromRequest(request)
        .replaceQueryParam(<span class="hl-string">&quot;accountId&quot;</span>, <span class="hl-string">&quot;{id}&quot;</span>).build()
        .expand(<span class="hl-string">&quot;123&quot;</span>)
        .encode();</pre> 
   <p>Alternatively, you may choose to copy a subset of the available information up to and including the context path:</p> 
   <pre class="programlisting"><span class="hl-comment">// Re-use host, port and context path</span>
<span class="hl-comment">// Append &quot;/accounts&quot; to the path</span>

ServletUriComponentsBuilder ucb = ServletUriComponentsBuilder.fromContextPath(request)
        .path(<span class="hl-string">&quot;/accounts&quot;</span>).build()</pre> 
   <p>Or in cases where the <code class="literal">DispatcherServlet</code> is mapped by name (e.g. <code class="literal">/main/*</code>), you can also have the literal part of the servlet mapping included:</p> 
   <pre class="programlisting"><span class="hl-comment">// Re-use host, port, context path</span>
<span class="hl-comment">// Append the literal part of the servlet mapping to the path</span>
<span class="hl-comment">// Append &quot;/accounts&quot; to the path</span>

ServletUriComponentsBuilder ucb = ServletUriComponentsBuilder.fromServletMapping(request)
        .path(<span class="hl-string">&quot;/accounts&quot;</span>).build()</pre> 
  </div> 
  <div class="section" title="16.8&nbsp;Building URIs to Controllers and methods">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="mvc-construct-uri-controllers"></a>16.8&nbsp;Building URIs to Controllers and methods</h2>
     </div>
    </div>
   </div> 
   <p>Spring MVC provides another mechanism for building and encoding URIs that link to Controllers and methods defined within an application. <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/servlet/mvc/method/annotation/MvcUriComponentsBuilder.html" target="_top"><code class="literal">MvcUriComponentsBuilder</code></a> extends <code class="literal">UriComponentsBuilder</code> and provides such possibilities.</p> 
   <p>Given this Controller:</p> 
   <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<i><span class="hl-annotation" style="color: gray">@RequestMapping(&quot;/hotels/{hotel}&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BookingController {

    <i><span class="hl-annotation" style="color: gray">@RequestMapping(&quot;/bookings/{booking}&quot;)</span></i>
    <span class="hl-keyword">public</span> String getBooking(<i><span class="hl-annotation" style="color: gray">@PathVariable</span></i> Long booking) {

    <span class="hl-comment">// ...</span>

}</pre> 
   <p>and using the <code class="literal">MvcUriComponentsBuilder</code>, the previous example is now:</p> 
   <pre class="programlisting">UriComponents uriComponents = MvcUriComponentsBuilder
    .fromMethodName(BookingController.<span class="hl-keyword">class</span>, <span class="hl-string">&quot;getBooking&quot;</span>,<span class="hl-number">21</span>).buildAndExpand(<span class="hl-number">42</span>);

URI uri = uriComponents.encode().toUri();</pre> 
   <p>The <code class="literal">MvcUriComponentsBuilder</code> can also create &quot;mock Controllers&quot;, thus enabling to create URIs by coding against the actual Controllers API:</p> 
   <pre class="programlisting">UriComponents uriComponents = MvcUriComponentsBuilder
    .fromMethodCall(on(BookingController.<span class="hl-keyword">class</span>).getBooking(<span class="hl-number">21</span>)).buildAndExpand(<span class="hl-number">42</span>);

URI uri = uriComponents.encode().toUri();</pre> 
  </div> 
  <div class="section" title="16.9&nbsp;Using locales">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="mvc-localeresolver"></a>16.9&nbsp;Using locales</h2>
     </div>
    </div>
   </div> 
   <p>Most parts of Springs architecture support internationalization, just as the Spring web MVC framework does. <code class="literal">DispatcherServlet</code> enables you to automatically resolve messages using the clients locale. This is done with <code class="literal">LocaleResolver</code> objects.</p> 
   <p>When a request comes in, the <code class="literal">DispatcherServlet</code> looks for a locale resolver, and if it finds one it tries to use it to set the locale. Using the <code class="literal">RequestContext.getLocale()</code> method, you can always retrieve the locale that was resolved by the locale resolver.</p> 
   <p>In addition to automatic locale resolution, you can also attach an interceptor to the handler mapping (see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-handlermapping-interceptor" title="16.4.1&nbsp;Intercepting requests with a HandlerInterceptor">Section&nbsp;16.4.1, Intercepting requests with a HandlerInterceptor</a> for more information on handler mapping interceptors) to change the locale under specific circumstances, for example, based on a parameter in the request.</p> 
   <p>Locale resolvers and interceptors are defined in the <code class="literal">org.springframework.web.servlet.i18n</code> package and are configured in your application context in the normal way. Here is a selection of the locale resolvers included in Spring.</p> 
   <div class="section" title="16.9.1&nbsp;Obtaining Time Zone Information">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-timezone"></a>16.9.1&nbsp;Obtaining Time Zone Information</h3>
      </div>
     </div>
    </div> 
    <p>In addition to obtaining the clients locale, it is often useful to know their time zone. The <code class="literal">LocaleContextResolver</code> interface offers an extension to <code class="literal">LocaleResolver</code> that allows resolvers to provide a richer <code class="literal">LocaleContext</code>, which may include time zone information.</p> 
    <p>When available, the users <code class="literal">TimeZone</code> can be obtained using the <code class="literal">RequestContext.getTimeZone()</code> method. Time zone information will automatically be used by Date/Time <code class="literal">Converter</code> and <code class="literal">Formatter</code> objects registered with Springs <code class="literal">ConversionService</code>.</p> 
   </div> 
   <div class="section" title="16.9.2&nbsp;AcceptHeaderLocaleResolver">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-localeresolver-acceptheader"></a>16.9.2&nbsp;AcceptHeaderLocaleResolver</h3>
      </div>
     </div>
    </div> 
    <p>This locale resolver inspects the <code class="literal">accept-language</code> header in the request that was sent by the client (e.g., a web browser). Usually this header field contains the locale of the clients operating system. <span class="emphasis"><em>Note that this resolver does not support time zone information.</em></span></p> 
   </div> 
   <div class="section" title="16.9.3&nbsp;CookieLocaleResolver">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-localeresolver-cookie"></a>16.9.3&nbsp;CookieLocaleResolver</h3>
      </div>
     </div>
    </div> 
    <p>This locale resolver inspects a <code class="literal">Cookie</code> that might exist on the client to see if a <code class="literal">Locale</code> or <code class="literal">TimeZone</code> is specified. If so, it uses the specified details. Using the properties of this locale resolver, you can specify the name of the cookie as well as the maximum age. Find below an example of defining a <code class="literal">CookieLocaleResolver</code>.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;localeResolver&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.i18n.CookieLocaleResolver&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;cookieName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;clientlanguage&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- in seconds. If set to -1, the cookie is not persisted (deleted when browser shuts down) --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;cookieMaxAge&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;100000&quot;</span><span class="hl-tag">&gt;</span>

<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <div class="table">
     <a name="mvc-cookie-locale-resolver-props-tbl"></a>
     <p class="title"><b>Table&nbsp;16.4.&nbsp;CookieLocaleResolver properties</b></p>
     <div class="table-contents"> 
      <table summary="CookieLocaleResolver properties" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
       <colgroup>
        <col />
        <col />
        <col />
       </colgroup>
       <thead>
        <tr>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Property</th>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Default</th>
         <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>cookieName</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>classname + LOCALE</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The name of the cookie</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>cookieMaxAge</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Integer.MAX_INT</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The maximum time a cookie will stay persistent on the client. If -1 is specified, the cookie will not be persisted; it will only be available until the client shuts down their browser.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>cookiePath</p></td>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>/</p></td>
         <td style="" align="left" valign="top"><p>Limits the visibility of the cookie to a certain part of your site. When cookiePath is specified, the cookie will only be visible to that path and the paths below it.</p></td>
        </tr>
       </tbody>
      </table> 
     </div>
    </div>
    <br class="table-break" /> 
   </div> 
   <div class="section" title="16.9.4&nbsp;SessionLocaleResolver">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-localeresolver-session"></a>16.9.4&nbsp;SessionLocaleResolver</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">SessionLocaleResolver</code> allows you to retrieve <code class="literal">Locale</code> and <code class="literal">TimeZone</code> from the session that might be associated with the users request.</p> 
   </div> 
   <div class="section" title="16.9.5&nbsp;LocaleChangeInterceptor">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-localeresolver-interceptor"></a>16.9.5&nbsp;LocaleChangeInterceptor</h3>
      </div>
     </div>
    </div> 
    <p>You can enable changing of locales by adding the <code class="literal">LocaleChangeInterceptor</code> to one of the handler mappings (see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-handlermapping" title="16.4&nbsp;Handler mappings">Section&nbsp;16.4, Handler mappings</a>). It will detect a parameter in the request and change the locale. It calls <code class="literal">setLocale()</code> on the <code class="literal">LocaleResolver</code> that also exists in the context. The following example shows that calls to all <code class="literal">*.view</code> resources containing a parameter named <code class="literal">siteLanguage</code> will now change the locale. So, for example, a request for the following URL, <code class="literal"><span><a class="smarterwiki-linkify" href="http://www.sf.net/home.view?siteLanguage=nl">http://www.sf.net/home.view?siteLanguage=nl</a></span></code> will change the site language to Dutch.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;localeChangeInterceptor&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.i18n.LocaleChangeInterceptor&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;paramName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;siteLanguage&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;localeResolver&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.i18n.CookieLocaleResolver&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;urlMapping&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.handler.SimpleUrlHandlerMapping&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;interceptors&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">&quot;localeChangeInterceptor&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;mappings&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;value&gt;</span>/<span class="strong"><strong>*/</strong></span>.view=someController<span class="hl-tag">&lt;/value&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   </div> 
  </div> 
  <div class="section" title="16.10&nbsp;Using themes">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="mvc-themeresolver"></a>16.10&nbsp;Using themes</h2>
     </div>
    </div>
   </div> 
   <div class="section" title="16.10.1&nbsp;Overview of themes">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-themeresolver-introduction"></a>16.10.1&nbsp;Overview of themes</h3>
      </div>
     </div>
    </div> 
    <p>You can apply Spring Web MVC framework themes to set the overall look-and-feel of your application, thereby enhancing user experience. A theme is a collection of static resources, typically style sheets and images, that affect the visual style of the application.</p> 
   </div> 
   <div class="section" title="16.10.2&nbsp;Defining themes">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-themeresolver-defining"></a>16.10.2&nbsp;Defining themes</h3>
      </div>
     </div>
    </div> 
    <p>To use themes in your web application, you must set up an implementation of the <code class="literal">org.springframework.ui.context.ThemeSource</code> interface. The <code class="literal">WebApplicationContext</code> interface extends <code class="literal">ThemeSource</code> but delegates its responsibilities to a dedicated implementation. By default the delegate will be an <code class="literal">org.springframework.ui.context.support.ResourceBundleThemeSource</code> implementation that loads properties files from the root of the classpath. To use a custom <code class="literal">ThemeSource</code> implementation or to configure the base name prefix of the <code class="literal">ResourceBundleThemeSource</code>, you can register a bean in the application context with the reserved name <code class="literal">themeSource</code>. The web application context automatically detects a bean with that name and uses it.</p> 
    <p>When using the <code class="literal">ResourceBundleThemeSource</code>, a theme is defined in a simple properties file. The properties file lists the resources that make up the theme. Here is an example:</p> 
    <pre class="literallayout">styleSheet=/themes/cool/style.css
background=/themes/cool/img/coolBg.jpg</pre> 
    <p>The keys of the properties are the names that refer to the themed elements from view code. For a JSP, you typically do this using the <code class="literal">spring:theme</code> custom tag, which is very similar to the <code class="literal">spring:message</code> tag. The following JSP fragment uses the theme defined in the previous example to customize the look and feel:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;%@</span> <span class="hl-attribute">taglib</span> <span class="hl-attribute">prefix</span>=<span class="hl-value">&quot;spring&quot;</span> <span class="hl-attribute">uri</span>=<span class="hl-value">&quot;http://www.springframework.org/tags&quot;</span><span class="hl-attribute">%&gt;</span>
<span class="hl-attribute">&lt;html&gt;</span>
    <span class="hl-attribute">&lt;head&gt;</span>
        <span class="hl-attribute">&lt;link</span> <span class="hl-attribute">rel</span>=<span class="hl-value">&quot;stylesheet&quot;</span> <span class="hl-attribute">href</span>=<span class="hl-value">&quot;&lt;spring:theme code=</span><span class="emphasis"><em>styleSheet</em></span>/&gt;&quot; type=&quot;text/css&quot;/&gt;
    <span class="hl-tag">&lt;/head&gt;</span>
    <span class="hl-tag">&lt;body</span> <span class="hl-attribute">style</span>=<span class="hl-value">&quot;background=&lt;spring:theme code=</span><span class="emphasis"><em>background</em></span>/&gt;&quot;&gt;
        ...
    <span class="hl-tag">&lt;/body&gt;</span>
<span class="hl-tag">&lt;/html&gt;</span></pre> 
    <p>By default, the <code class="literal">ResourceBundleThemeSource</code> uses an empty base name prefix. As a result, the properties files are loaded from the root of the classpath. Thus you would put the <code class="literal">cool.properties</code> theme definition in a directory at the root of the classpath, for example, in <code class="literal">/WEB-INF/classes</code>. The <code class="literal">ResourceBundleThemeSource</code> uses the standard Java resource bundle loading mechanism, allowing for full internationalization of themes. For example, we could have a <code class="literal">/WEB-INF/classes/cool_nl.properties</code> that references a special background image with Dutch text on it.</p> 
   </div> 
   <div class="section" title="16.10.3&nbsp;Theme resolvers">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-themeresolver-resolving"></a>16.10.3&nbsp;Theme resolvers</h3>
      </div>
     </div>
    </div> 
    <p>After you define themes, as in the preceding section, you decide which theme to use. The <code class="literal">DispatcherServlet</code> will look for a bean named <code class="literal">themeResolver</code> to find out which <code class="literal">ThemeResolver</code> implementation to use. A theme resolver works in much the same way as a <code class="literal">LocaleResolver</code>. It detects the theme to use for a particular request and can also alter the requests theme. The following theme resolvers are provided by Spring:</p> 
    <div class="table">
     <a name="mvc-theme-resolver-impls-tbl"></a>
     <p class="title"><b>Table&nbsp;16.5.&nbsp;ThemeResolver implementations</b></p>
     <div class="table-contents"> 
      <table summary="ThemeResolver implementations" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
       <colgroup>
        <col />
        <col />
       </colgroup>
       <thead>
        <tr>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Class</th>
         <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">FixedThemeResolver</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Selects a fixed theme, set using the <code class="literal">defaultThemeName</code> property.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">SessionThemeResolver</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The theme is maintained in the users HTTP session. It only needs to be set once for each session, but is not persisted between sessions.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">CookieThemeResolver</code></p></td>
         <td style="" align="left" valign="top"><p>The selected theme is stored in a cookie on the client.</p></td>
        </tr>
       </tbody>
      </table> 
     </div>
    </div>
    <br class="table-break" /> 
    <p>Spring also provides a <code class="literal">ThemeChangeInterceptor</code> that allows theme changes on every request with a simple request parameter.</p> 
   </div> 
  </div> 
  <div class="section" title="16.11&nbsp;Springs multipart (file upload) support">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="mvc-multipart"></a>16.11&nbsp;Springs multipart (file upload) support</h2>
     </div>
    </div>
   </div> 
   <div class="section" title="16.11.1&nbsp;Introduction">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-multipart-introduction"></a>16.11.1&nbsp;Introduction</h3>
      </div>
     </div>
    </div> 
    <p>Springs built-in multipart support handles file uploads in web applications. You enable this multipart support with pluggable <code class="literal">MultipartResolver</code> objects, defined in the <code class="literal">org.springframework.web.multipart</code> package. Spring provides one <code class="literal">MultipartResolver</code> implementation for use with <a class="ulink" href="http://jakarta.apache.org/commons/fileupload" target="_top"><span class="emphasis"><em>Commons FileUpload</em></span></a> and another for use with Servlet 3.0 multipart request parsing.</p> 
    <p>By default, Spring does no multipart handling, because some developers want to handle multiparts themselves. You enable Spring multipart handling by adding a multipart resolver to the web applications context. Each request is inspected to see if it contains a multipart. If no multipart is found, the request continues as expected. If a multipart is found in the request, the <code class="literal">MultipartResolver</code> that has been declared in your context is used. After that, the multipart attribute in your request is treated like any other attribute.</p> 
   </div> 
   <div class="section" title="16.11.2&nbsp;Using a MultipartResolver with Commons FileUpload">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-multipart-resolver-commons"></a>16.11.2&nbsp;Using a MultipartResolver with <span class="emphasis"><em>Commons FileUpload</em></span></h3>
      </div>
     </div>
    </div> 
    <p>The following example shows how to use the <code class="literal">CommonsMultipartResolver</code>:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;multipartResolver&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- one of the properties available; the maximum file size in bytes --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;maxUploadSize&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;100000&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>Of course you also need to put the appropriate jars in your classpath for the multipart resolver to work. In the case of the <code class="literal">CommonsMultipartResolver</code>, you need to use <code class="literal">commons-fileupload.jar</code>.</p> 
    <p>When the Spring <code class="literal">DispatcherServlet</code> detects a multi-part request, it activates the resolver that has been declared in your context and hands over the request. The resolver then wraps the current <code class="literal">HttpServletRequest</code> into a <code class="literal">MultipartHttpServletRequest</code> that supports multipart file uploads. Using the <code class="literal">MultipartHttpServletRequest</code>, you can get information about the multiparts contained by this request and actually get access to the multipart files themselves in your controllers.</p> 
   </div> 
   <div class="section" title="16.11.3&nbsp;Using a MultipartResolver with Servlet 3.0">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-multipart-resolver-standard"></a>16.11.3&nbsp;Using a MultipartResolver with <span class="emphasis"><em>Servlet 3.0</em></span></h3>
      </div>
     </div>
    </div> 
    <p>In order to use Servlet 3.0 based multipart parsing, you need to mark the <code class="literal">DispatcherServlet</code> with a <code class="literal">&quot;multipart-config&quot;</code> section in <code class="literal">web.xml</code>, or with a <code class="literal">javax.servlet.MultipartConfigElement</code> in programmatic Servlet registration, or in case of a custom Servlet class possibly with a <code class="literal">javax.servlet.annotation.MultipartConfig</code> annotation on your Servlet class. Configuration settings such as maximum sizes or storage locations need to be applied at that Servlet registration level as Servlet 3.0 does not allow for those settings to be done from the MultipartResolver.</p> 
    <p>Once Servlet 3.0 multipart parsing has been enabled in one of the above mentioned ways you can add the <code class="literal">StandardServletMultipartResolver</code> to your Spring configuration:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;multipartResolver&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.multipart.support.StandardServletMultipartResolver&quot;</span><span class="hl-tag">&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   </div> 
   <div class="section" title="16.11.4&nbsp;Handling a file upload in a form">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-multipart-forms"></a>16.11.4&nbsp;Handling a file upload in a form</h3>
      </div>
     </div>
    </div> 
    <p>After the <code class="literal">MultipartResolver</code> completes its job, the request is processed like any other. First, create a form with a file input that will allow the user to upload a form. The encoding attribute ( <code class="literal">enctype=&quot;multipart/form-data&quot;</code>) lets the browser know how to encode the form as multipart request:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;html&gt;</span>
    <span class="hl-tag">&lt;head&gt;</span>
        <span class="hl-tag">&lt;title&gt;</span>Upload a file please<span class="hl-tag">&lt;/title&gt;</span>
    <span class="hl-tag">&lt;/head&gt;</span>
    <span class="hl-tag">&lt;body&gt;</span>
        <span class="hl-tag">&lt;h1&gt;</span>Please upload a file<span class="hl-tag">&lt;/h1&gt;</span>
        <span class="hl-tag">&lt;form</span> <span class="hl-attribute">method</span>=<span class="hl-value">&quot;post&quot;</span> <span class="hl-attribute">action</span>=<span class="hl-value">&quot;/form&quot;</span> <span class="hl-attribute">enctype</span>=<span class="hl-value">&quot;multipart/form-data&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;text&quot;</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;file&quot;</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;file&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;submit&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/form&gt;</span>
    <span class="hl-tag">&lt;/body&gt;</span>
<span class="hl-tag">&lt;/html&gt;</span></pre> 
    <p>The next step is to create a controller that handles the file upload. This controller is very similar to a <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-ann-controller" title="16.3.1&nbsp;Defining a controller with @Controller">normal annotated <code class="literal">@Controller</code></a>, except that we use <code class="literal">MultipartHttpServletRequest</code> or <code class="literal">MultipartFile</code> in the method parameters:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FileUploadController {

    <i><span class="hl-annotation" style="color: gray">@RequestMapping(value = &quot;/form&quot;, method = RequestMethod.POST)</span></i>
    <span class="hl-keyword">public</span> String handleFormUpload(<i><span class="hl-annotation" style="color: gray">@RequestParam(&quot;name&quot;)</span></i> String name,
            <i><span class="hl-annotation" style="color: gray">@RequestParam(&quot;file&quot;)</span></i> MultipartFile file) {

        <span class="hl-keyword">if</span> (!file.isEmpty()) {
            <span class="hl-keyword">byte</span>[] bytes = file.getBytes();
            <span class="hl-comment">// store the bytes somewhere</span>
            <span class="hl-keyword">return</span> <span class="hl-string">&quot;redirect:uploadSuccess&quot;</span>;
        }

        <span class="hl-keyword">return</span> <span class="hl-string">&quot;redirect:uploadFailure&quot;</span>;
    }

}</pre> 
    <p>Note how the <code class="literal">@RequestParam</code> method parameters map to the input elements declared in the form. In this example, nothing is done with the <code class="literal">byte[]</code>, but in practice you can save it in a database, store it on the file system, and so on.</p> 
    <p>When using Servlet 3.0 multipart parsing you can also use <code class="literal">javax.servlet.http.Part</code> for the method parameter:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FileUploadController {

    <i><span class="hl-annotation" style="color: gray">@RequestMapping(value = &quot;/form&quot;, method = RequestMethod.POST)</span></i>
    <span class="hl-keyword">public</span> String handleFormUpload(<i><span class="hl-annotation" style="color: gray">@RequestParam(&quot;name&quot;)</span></i> String name,
            <i><span class="hl-annotation" style="color: gray">@RequestParam(&quot;file&quot;)</span></i> Part file) {

        InputStream inputStream = file.getInputStream();
        <span class="hl-comment">// store bytes from uploaded file somewhere</span>

        <span class="hl-keyword">return</span> <span class="hl-string">&quot;redirect:uploadSuccess&quot;</span>;
    }

}</pre> 
   </div> 
   <div class="section" title="16.11.5&nbsp;Handling a file upload request from programmatic clients">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-multipart-forms-non-browsers"></a>16.11.5&nbsp;Handling a file upload request from programmatic clients</h3>
      </div>
     </div>
    </div> 
    <p>Multipart requests can also be submitted from non-browser clients in a RESTful service scenario. All of the above examples and configuration apply here as well. However, unlike browsers that typically submit files and simple form fields, a programmatic client can also send more complex data of a specific content type&#x2009;&#x2009;for example a multipart request with a file and second part with JSON formatted data:</p> 
    <pre class="literallayout">POST /someUrl
Content-Type: multipart/mixed

--edt7Tfrdusa7r3lNQc79vXuhIIMlatb7PQg7Vp
Content-Disposition: form-data; name=&quot;meta-data&quot;
Content-Type: application/json; charset=UTF-8
Content-Transfer-Encoding: 8bit

{
	&quot;name&quot;: &quot;value&quot;
}
--edt7Tfrdusa7r3lNQc79vXuhIIMlatb7PQg7Vp
Content-Disposition: form-data; name=&quot;file-data&quot;; filename=&quot;file.properties&quot;
Content-Type: text/xml
Content-Transfer-Encoding: 8bit
... File Data ...</pre> 
    <p>You could access the part named &quot;meta-data&quot; with a <code class="literal">@RequestParam(&quot;meta-data&quot;) String metadata</code> controller method argument. However, you would probably prefer to accept a strongly typed object initialized from the JSON formatted data in the body of the request part, very similar to the way <code class="literal">@RequestBody</code> converts the body of a non-multipart request to a target object with the help of an <code class="literal">HttpMessageConverter</code>.</p> 
    <p>You can use the <code class="literal">@RequestPart</code> annotation instead of the <code class="literal">@RequestParam</code> annotation for this purpose. It allows you to have the content of a specific multipart passed through an <code class="literal">HttpMessageConverter</code> taking into consideration the <code class="literal">'Content-Type'</code> header of the multipart:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping(value=&quot;/someUrl&quot;, method = RequestMethod.POST)</span></i>
<span class="hl-keyword">public</span> String onSubmit(<span class="strong"><strong>@RequestPart(&quot;meta-data&quot;) MetaData metadata, @RequestPart(&quot;file-data&quot;) MultipartFile file</strong></span>) {

    <span class="hl-comment">// ...</span>

}</pre> 
    <p>Notice how <code class="literal">MultipartFile</code> method arguments can be accessed with <code class="literal">@RequestParam</code> or with <code class="literal">@RequestPart</code> interchangeably. However, the <code class="literal">@RequestPart(&quot;meta-data&quot;) MetaData</code> method argument in this case is read as JSON content based on its <code class="literal">'Content-Type'</code> header and converted with the help of the <code class="literal">MappingJackson2HttpMessageConverter</code>.</p> 
   </div> 
  </div> 
  <div class="section" title="16.12&nbsp;Handling exceptions">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="mvc-exceptionhandlers"></a>16.12&nbsp;Handling exceptions</h2>
     </div>
    </div>
   </div> 
   <div class="section" title="16.12.1&nbsp;HandlerExceptionResolver">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-exceptionhandlers-resolver"></a>16.12.1&nbsp;HandlerExceptionResolver</h3>
      </div>
     </div>
    </div> 
    <p>Spring <code class="literal">HandlerExceptionResolver</code> implementations deal with unexpected exceptions that occur during controller execution. A <code class="literal">HandlerExceptionResolver</code> somewhat resembles the exception mappings you can define in the web application descriptor <code class="literal">web.xml</code>. However, they provide a more flexible way to do so. For example they provide information about which handler was executing when the exception was thrown. Furthermore, a programmatic way of handling exceptions gives you more options for responding appropriately before the request is forwarded to another URL (the same end result as when you use the Servlet specific exception mappings).</p> 
    <p>Besides implementing the <code class="literal">HandlerExceptionResolver</code> interface, which is only a matter of implementing the <code class="literal">resolveException(Exception, Handler)</code> method and returning a <code class="literal">ModelAndView</code>, you may also use the provided <code class="literal">SimpleMappingExceptionResolver</code> or create <code class="literal">@ExceptionHandler</code> methods. The <code class="literal">SimpleMappingExceptionResolver</code> enables you to take the class name of any exception that might be thrown and map it to a view name. This is functionally equivalent to the exception mapping feature from the Servlet API, but it is also possible to implement more finely grained mappings of exceptions from different handlers. The <code class="literal">@ExceptionHandler</code> annotation on the other hand can be used on methods that should be invoked to handle an exception. Such methods may be defined locally within an <code class="literal">@Controller</code> or may apply to many <code class="literal">@Controller</code> classes when defined within an <code class="literal">@ControllerAdvice</code> class. The following sections explain this in more detail.</p> 
   </div> 
   <div class="section" title="16.12.2&nbsp;@ExceptionHandler">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-ann-exceptionhandler"></a>16.12.2&nbsp;@ExceptionHandler</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">HandlerExceptionResolver</code> interface and the <code class="literal">SimpleMappingExceptionResolver</code> implementations allow you to map Exceptions to specific views declaratively along with some optional Java logic before forwarding to those views. However, in some cases, especially when relying on <code class="literal">@ResponseBody</code> methods rather than on view resolution, it may be more convenient to directly set the status of the response and optionally write error content to the body of the response.</p> 
    <p>You can do that with <code class="literal">@ExceptionHandler</code> methods. When declared within a controller such methods apply to exceptions raised by <code class="literal">@RequestMapping</code> methods of that contoroller (or any of its sub-classes). You can also declare an <code class="literal">@ExceptionHandler</code> method within an <code class="literal">@ControllerAdvice</code> class in which case it handles exceptions from <code class="literal">@RequestMapping</code> methods from many controllers. Below is an example of a controller-local <code class="literal">@ExceptionHandler</code> method:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleController {

    <span class="hl-comment">// @RequestMapping methods omitted ...</span>

    <i><span class="hl-annotation" style="color: gray">@ExceptionHandler(IOException.class)</span></i>
    <span class="hl-keyword">public</span> ResponseEntity&lt;String&gt; handleIOException(IOException ex) {
        <span class="hl-comment">// prepare responseEntity</span>
        <span class="hl-keyword">return</span> responseEntity;
    }

}</pre> 
    <p>The <code class="literal">@ExceptionHandler</code> value can be set to an array of Exception types. If an exception is thrown that matches one of the types in the list, then the method annotated with the matching <code class="literal">@ExceptionHandler</code> will be invoked. If the annotation value is not set then the exception types listed as method arguments are used.</p> 
    <p>Much like standard controller methods annotated with a <code class="literal">@RequestMapping</code> annotation, the method arguments and return values of <code class="literal">@ExceptionHandler</code> methods can be flexible. For example, the <code class="literal">HttpServletRequest</code> can be accessed in Servlet environments and the <code class="literal">PortletRequest</code> in Portlet environments. The return type can be a <code class="literal">String</code>, which is interpreted as a view name, a <code class="literal">ModelAndView</code> object, a <code class="literal">ResponseEntity</code>, or you can also add the <code class="literal">@ResponseBody</code> to have the method return value converted with message converters and written to the response stream.</p> 
   </div> 
   <div class="section" title="16.12.3&nbsp;Handling Standard Spring MVC Exceptions">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-ann-rest-spring-mvc-exceptions"></a>16.12.3&nbsp;Handling Standard Spring MVC Exceptions</h3>
      </div>
     </div>
    </div> 
    <p>Spring MVC may raise a number of exceptions while processing a request. The <code class="literal">SimpleMappingExceptionResolver</code> can easily map any exception to a default error view as needed. However, when working with clients that interpret responses in an automated way you will want to set specific status code on the response. Depending on the exception raised the status code may indicate a client error (4xx) or a server error (5xx).</p> 
    <p>The <code class="literal">DefaultHandlerExceptionResolver</code> translates Spring MVC exceptions to specific error status codes. It is registered by default with the MVC namespace, the MVC Java config, and also by the the <code class="literal">DispatcherServlet</code> (i.e. when not using the MVC namespace or Java config). Listed below are some of the exceptions handled by this resolver and the corresponding status codes:</p> 
    <div class="informaltable"> 
     <table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
      <colgroup>
       <col />
       <col />
      </colgroup>
      <thead>
       <tr>
        <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Exception</th>
        <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">HTTP Status Code</th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">BindException</code></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>400 (Bad Request)</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ConversionNotSupportedException</code></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>500 (Internal Server Error)</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">HttpMediaTypeNotAcceptableException</code></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>406 (Not Acceptable)</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">HttpMediaTypeNotSupportedException</code></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>415 (Unsupported Media Type)</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">HttpMessageNotReadableException</code></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>400 (Bad Request)</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">HttpMessageNotWritableException</code></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>500 (Internal Server Error)</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">HttpRequestMethodNotSupportedException</code></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>405 (Method Not Allowed)</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">MethodArgumentNotValidException</code></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>400 (Bad Request)</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">MissingServletRequestParameterException</code></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>400 (Bad Request)</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">MissingServletRequestPartException</code></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>400 (Bad Request)</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">NoHandlerFoundException</code></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>404 (Not Found)</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">NoSuchRequestHandlingMethodException</code></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>404 (Not Found)</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">TypeMismatchException</code></p></td>
        <td style="" align="left" valign="top"><p>400 (Bad Request)</p></td>
       </tr>
      </tbody>
     </table> 
    </div> 
    <p>The <code class="literal">DefaultHandlerExceptionResolver</code> works transparently by setting the status of the response. However, it stops short of writing any error content to the body of the response while your application may need to add developer-friendly content to every error response for example when providing a REST API. You can prepare a <code class="literal">ModelAndView</code> and render error content through view resolution&#x2009;&#x2009;i.e. by configuring a <code class="literal">ContentNegotiatingViewResolver</code>, <code class="literal">MappingJacksonJsonView</code>, and so on. However, you may prefer to use <code class="literal">@ExceptionHandler</code> methods instead.</p> 
    <p>If you prefer to write error content via <code class="literal">@ExceptionHandler</code> methods you can extend <code class="literal">ResponseEntityExceptionHandler</code> instead. This is a convenient base for <code class="literal">@ControllerAdvice</code> classes providing an <code class="literal">@ExceptionHandler</code> method to handle standard Spring MVC exceptions and return <code class="literal">ResponseEntity</code>. That allows you to customize the response and write error content with message converters. See the Javadoc of <code class="literal">ResponseEntityExceptionHandler</code> for more details.</p> 
   </div> 
   <div class="section" title="16.12.4&nbsp;Annotating Business Exceptions With @ResponseStatus">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-ann-annotated-exceptions"></a>16.12.4&nbsp;Annotating Business Exceptions With @ResponseStatus</h3>
      </div>
     </div>
    </div> 
    <p>A business exception can be annotated with <code class="literal">@ResponseStatus</code>. When the exception is raised, the <code class="literal">ResponseStatusExceptionResolver</code> handles it by setting the status of the response accordingly. By default the <code class="literal">DispatcherServlet</code> registers the <code class="literal">ResponseStatusExceptionResolver</code> and it is available for use.</p> 
   </div> 
   <div class="section" title="16.12.5&nbsp;Customizing the Default Servlet Container Error Page">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-ann-customer-servlet-container-error-page"></a>16.12.5&nbsp;Customizing the Default Servlet Container Error Page</h3>
      </div>
     </div>
    </div> 
    <p>When the status of the response is set to an error status code and the body of the response is empty, Servlet containers commonly render an HTML formatted error page. To customize the default error page of the container, you can declare an <code class="literal">&lt;error-page&gt;</code> element in <code class="literal">web.xml</code>. Up until Servlet 3, that element had to be mapped to a specific status code or exception type. Starting with Servlet 3 an error page does not need to be mapped, which effectively means the specified location customizes the default Servlet container error page.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;error-page&gt;</span>
    <span class="hl-tag">&lt;location&gt;</span>/error<span class="hl-tag">&lt;/location&gt;</span>
<span class="hl-tag">&lt;/error-page&gt;</span></pre> 
    <p>Note that the actual location for the error page can be a JSP page or some other URL within the container including one handled through an <code class="literal">@Controller</code> method:</p> 
    <p>When writing error information, the status code and the error message set on the <code class="literal">HttpServletResponse</code> can be accessed through request attributes in a controller:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ErrorController {

    <i><span class="hl-annotation" style="color: gray">@RequestMapping(value=&quot;/error&quot;, produces=&quot;application/json&quot;)</span></i>
    <i><span class="hl-annotation" style="color: gray">@ResponseBody</span></i>
    <span class="hl-keyword">public</span> Map&lt;String, Object&gt; handle(HttpServletRequest request) {

        Map&lt;String, Object&gt; map = <span class="hl-keyword">new</span> HashMap&lt;String, Object&gt;();
        map.put(<span class="hl-string">&quot;status&quot;</span>, request.getAttribute(<span class="hl-string">&quot;javax.servlet.error.status_code&quot;</span>));
        map.put(<span class="hl-string">&quot;reason&quot;</span>, request.getAttribute(<span class="hl-string">&quot;javax.servlet.error.message&quot;</span>));

        <span class="hl-keyword">return</span> map;
    }

}</pre> 
    <p>or in a JSP:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;%@</span> <span class="hl-attribute">page</span> <span class="hl-attribute">contentType</span>=<span class="hl-value">&quot;application/json&quot;</span> <span class="hl-attribute">pageEncoding</span>=<span class="hl-value">&quot;UTF-8&quot;</span><span class="hl-attribute">%&gt;</span>
<span class="hl-attribute">{</span>
    <span class="hl-attribute">status:&lt;%</span>=<span class="hl-value">request.getAttribute(&quot;javax.servlet.error.status_code&quot;)</span> <span class="hl-attribute">%&gt;,</span>
    <span class="hl-attribute">reason:&lt;%</span>=<span class="hl-value">request.getAttribute(&quot;javax.servlet.error.message&quot;)</span> <span class="hl-attribute">%&gt;</span>
<span class="hl-attribute">}</span></pre> 
   </div> 
  </div> 
  <div class="section" title="16.13&nbsp;Convention over configuration support">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="mvc-coc"></a>16.13&nbsp;Convention over configuration support</h2>
     </div>
    </div>
   </div> 
   <p>For a lot of projects, sticking to established conventions and having reasonable defaults is just what they (the projects) need, and Spring Web MVC now has explicit support for <span class="emphasis"><em>convention over configuration</em></span>. What this means is that if you establish a set of naming conventions and suchlike, you can <span class="emphasis"><em>substantially</em></span> cut down on the amount of configuration that is required to set up handler mappings, view resolvers, <code class="literal">ModelAndView</code> instances, etc. This is a great boon with regards to rapid prototyping, and can also lend a degree of (always good-to-have) consistency across a codebase should you choose to move forward with it into production.</p> 
   <p>Convention-over-configuration support addresses the three core areas of MVC: models, views, and controllers.</p> 
   <div class="section" title="16.13.1&nbsp;The Controller ControllerClassNameHandlerMapping">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-coc-ccnhm"></a>16.13.1&nbsp;The Controller ControllerClassNameHandlerMapping</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">ControllerClassNameHandlerMapping</code> class is a <code class="literal">HandlerMapping</code> implementation that uses a convention to determine the mapping between request URLs and the <code class="literal">Controller</code> instances that are to handle those requests.</p> 
    <p>Consider the following simple <code class="literal">Controller</code> implementation. Take special notice of the <span class="emphasis"><em>name</em></span> of the class.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> <span class="strong"><strong>ViewShoppingCartController</strong></span> <span class="hl-keyword">implements</span> Controller {

    <span class="hl-keyword">public</span> ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) {
        <span class="hl-comment">// the implementation is not hugely important for this example...</span>
    }

}</pre> 
    <p>Here is a snippet from the corresponding Spring Web MVC configuration file:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.mvc.support.ControllerClassNameHandlerMapping&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;</span><span class="strong"><strong>viewShoppingCart</strong></span>&quot; class=&quot;x.y.z.ViewShoppingCartController&quot;&gt;
    <span class="hl-comment">&lt;!-- inject dependencies as required... --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>The <code class="literal">ControllerClassNameHandlerMapping</code> finds all of the various handler (or <code class="literal">Controller</code>) beans defined in its application context and strips <code class="literal">Controller</code> off the name to define its handler mappings. Thus, <code class="literal">ViewShoppingCartController</code> maps to the <code class="literal">/viewshoppingcart*</code> request URL.</p> 
    <p>Lets look at some more examples so that the central idea becomes immediately familiar. (Notice all lowercase in the URLs, in contrast to camel-cased <code class="literal">Controller</code> class names.)</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> <code class="literal">WelcomeController</code> maps to the <code class="literal">/welcome*</code> request URL </li>
      <li class="listitem"> <code class="literal">HomeController</code> maps to the <code class="literal">/home*</code> request URL </li>
      <li class="listitem"> <code class="literal">IndexController</code> maps to the <code class="literal">/index*</code> request URL </li>
      <li class="listitem"> <code class="literal">RegisterController</code> maps to the <code class="literal">/register*</code> request URL </li>
     </ul>
    </div> 
    <p>In the case of <code class="literal">MultiActionController</code> handler classes, the mappings generated are slightly more complex. The <code class="literal">Controller</code> names in the following examples are assumed to be <code class="literal">MultiActionController</code> implementations:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> <code class="literal">AdminController</code> maps to the <code class="literal">/admin/*</code> request URL </li>
      <li class="listitem"> <code class="literal">CatalogController</code> maps to the <code class="literal">/catalog/*</code> request URL </li>
     </ul>
    </div> 
    <p>If you follow the convention of naming your <code class="literal">Controller</code> implementations as <code class="literal">xxxController</code>, the <code class="literal">ControllerClassNameHandlerMapping</code> saves you the tedium of defining and maintaining a potentially <span class="emphasis"><em>looooong</em></span> <code class="literal">SimpleUrlHandlerMapping</code> (or suchlike).</p> 
    <p>The <code class="literal">ControllerClassNameHandlerMapping</code> class extends the <code class="literal">AbstractHandlerMapping</code> base class so you can define <code class="literal">HandlerInterceptor</code> instances and everything else just as you would with many other <code class="literal">HandlerMapping</code> implementations.</p> 
   </div> 
   <div class="section" title="16.13.2&nbsp;The Model ModelMap (ModelAndView)">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-coc-modelmap"></a>16.13.2&nbsp;The Model ModelMap (ModelAndView)</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">ModelMap</code> class is essentially a glorified <code class="literal">Map</code> that can make adding objects that are to be displayed in (or on) a <code class="literal">View</code> adhere to a common naming convention. Consider the following <code class="literal">Controller</code> implementation; notice that objects are added to the <code class="literal">ModelAndView</code> without any associated name specified.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DisplayShoppingCartController <span class="hl-keyword">implements</span> Controller {

    <span class="hl-keyword">public</span> ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) {

        List cartItems = <span class="hl-comment">// get a List of CartItem objects</span>
        User user = <span class="hl-comment">// get the User doing the shopping</span>

        ModelAndView mav = <span class="hl-keyword">new</span> ModelAndView(<span class="hl-string">&quot;displayShoppingCart&quot;</span>); &lt;-- the logical view name

        mav.addObject(cartItems); &lt;-- look ma, no name, just the object
        mav.addObject(user); &lt;-- and again ma!

        <span class="hl-keyword">return</span> mav;
    }
}</pre> 
    <p>The <code class="literal">ModelAndView</code> class uses a <code class="literal">ModelMap</code> class that is a custom <code class="literal">Map</code> implementation that automatically generates a key for an object when an object is added to it. The strategy for determining the name for an added object is, in the case of a scalar object such as <code class="literal">User</code>, to use the short class name of the objects class. The following examples are names that are generated for scalar objects put into a <code class="literal">ModelMap</code> instance.</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> An <code class="literal">x.y.User</code> instance added will have the name <code class="literal">user</code> generated. </li>
      <li class="listitem"> An <code class="literal">x.y.Registration</code> instance added will have the name <code class="literal">registration</code> generated. </li>
      <li class="listitem"> An <code class="literal">x.y.Foo</code> instance added will have the name <code class="literal">foo</code> generated. </li>
      <li class="listitem"> A <code class="literal">java.util.HashMap</code> instance added will have the name <code class="literal">hashMap</code> generated. You probably want to be explicit about the name in this case because <code class="literal">hashMap</code> is less than intuitive. </li>
      <li class="listitem"> Adding <code class="literal">null</code> will result in an <code class="literal">IllegalArgumentException</code> being thrown. If the object (or objects) that you are adding could be <code class="literal">null</code>, then you will also want to be explicit about the name. </li>
     </ul>
    </div> 
    <div class="sidebar" title="What, no automatic pluralization?">
     <p class="title"><b>What, no automatic pluralization?</b></p> 
     <p>Spring Web MVCs convention-over-configuration support does not support automatic pluralization. That is, you cannot add a <code class="literal">List</code> of <code class="literal">Person</code> objects to a <code class="literal">ModelAndView</code> and have the generated name be <code class="literal">people</code>.</p> 
     <p>This decision was made after some debate, with the &quot;Principle of Least Surprise&quot; winning out in the end.</p> 
    </div> 
    <p>The strategy for generating a name after adding a <code class="literal">Set</code> or a <code class="literal">List</code> is to peek into the collection, take the short class name of the first object in the collection, and use that with <code class="literal">List</code> appended to the name. The same applies to arrays although with arrays it is not necessary to peek into the array contents. A few examples will make the semantics of name generation for collections clearer:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> An <code class="literal">x.y.User[]</code> array with zero or more <code class="literal">x.y.User</code> elements added will have the name <code class="literal">userList</code> generated. </li>
      <li class="listitem"> An <code class="literal">x.y.Foo[]</code> array with zero or more <code class="literal">x.y.User</code> elements added will have the name <code class="literal">fooList</code> generated. </li>
      <li class="listitem"> A <code class="literal">java.util.ArrayList</code> with one or more <code class="literal">x.y.User</code> elements added will have the name <code class="literal">userList</code> generated. </li>
      <li class="listitem"> A <code class="literal">java.util.HashSet</code> with one or more <code class="literal">x.y.Foo</code> elements added will have the name <code class="literal">fooList</code> generated. </li>
      <li class="listitem"> An <span class="emphasis"><em>empty</em></span> <code class="literal">java.util.ArrayList</code> will not be added at all (in effect, the <code class="literal">addObject(..)</code> call will essentially be a no-op). </li>
     </ul>
    </div> 
   </div> 
   <div class="section" title="16.13.3&nbsp;The View - RequestToViewNameTranslator">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-coc-r2vnt"></a>16.13.3&nbsp;The View - RequestToViewNameTranslator</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">RequestToViewNameTranslator</code> interface determines a logical <code class="literal">View</code> name when no such logical view name is explicitly supplied. It has just one implementation, the <code class="literal">DefaultRequestToViewNameTranslator</code> class.</p> 
    <p>The <code class="literal">DefaultRequestToViewNameTranslator</code> maps request URLs to logical view names, as with this example:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RegistrationController <span class="hl-keyword">implements</span> Controller {

    <span class="hl-keyword">public</span> ModelAndView handleRequest(HttpServletRequest request, HttpServletResponse response) {
        <span class="hl-comment">// process the request...</span>
        ModelAndView mav = <span class="hl-keyword">new</span> ModelAndView();
        <span class="hl-comment">// add data as necessary to the model...</span>
        <span class="hl-keyword">return</span> mav;
        <span class="hl-comment">// notice that no View or logical view name has been set</span>
    }

}</pre> 
    <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- this bean with the well known name generates view names for us --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;viewNameTranslator&quot;</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;x.y.RegistrationController&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- inject dependencies as necessary --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- maps request URLs to Controller names --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.mvc.support.ControllerClassNameHandlerMapping&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;viewResolver&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;prefix&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;/WEB-INF/jsp/&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;suffix&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;.jsp&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>Notice how in the implementation of the <code class="literal">handleRequest(..)</code> method no <code class="literal">View</code> or logical view name is ever set on the <code class="literal">ModelAndView</code> that is returned. The <code class="literal">DefaultRequestToViewNameTranslator</code> is tasked with generating a <span class="emphasis"><em>logical view name</em></span> from the URL of the request. In the case of the above <code class="literal">RegistrationController</code>, which is used in conjunction with the <code class="literal">ControllerClassNameHandlerMapping</code>, a request URL of <code class="literal"><span><a class="smarterwiki-linkify" href="http://localhost/registration.html">http://localhost/registration.html</a></span></code> results in a logical view name of <code class="literal">registration</code> being generated by the <code class="literal">DefaultRequestToViewNameTranslator</code>. This logical view name is then resolved into the <code class="literal">/WEB-INF/jsp/registration.jsp</code> view by the <code class="literal">InternalResourceViewResolver</code> bean.</p> 
    <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Tip">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
        <th align="left">Tip</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>You do not need to define a <code class="literal">DefaultRequestToViewNameTranslator</code> bean explicitly. If you like the default settings of the <code class="literal">DefaultRequestToViewNameTranslator</code>, you can rely on the Spring Web MVC <code class="literal">DispatcherServlet</code> to instantiate an instance of this class if one is not explicitly configured.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>Of course, if you need to change the default settings, then you do need to configure your own <code class="literal">DefaultRequestToViewNameTranslator</code> bean explicitly. Consult the comprehensive Javadoc for the <code class="literal">DefaultRequestToViewNameTranslator</code> class for details of the various properties that can be configured.</p> 
   </div> 
  </div> 
  <div class="section" title="16.14&nbsp;ETag support">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="mvc-etag"></a>16.14&nbsp;ETag support</h2>
     </div>
    </div>
   </div> 
   <p>An <a class="ulink" href="http://en.wikipedia.org/wiki/HTTP_ETag" target="_top">ETag</a> (entity tag) is an HTTP response header returned by an HTTP/1.1 compliant web server used to determine change in content at a given URL. It can be considered to be the more sophisticated successor to the <code class="literal">Last-Modified</code> header. When a server returns a representation with an ETag header, the client can use this header in subsequent GETs, in an <code class="literal">If-None-Match</code> header. If the content has not changed, the server returns <code class="literal">304: Not Modified</code>.</p> 
   <p>Support for ETags is provided by the Servlet filter <code class="literal">ShallowEtagHeaderFilter</code>. It is a plain Servlet Filter, and thus can be used in combination with any web framework. The <code class="literal">ShallowEtagHeaderFilter</code> filter creates so-called shallow ETags (as opposed to deep ETags, more about that later).The filter caches the content of the rendered JSP (or other content), generates an MD5 hash over that, and returns that as an ETag header in the response. The next time a client sends a request for the same resource, it uses that hash as the <code class="literal">If-None-Match</code> value. The filter detects this, renders the view again, and compares the two hashes. If they are equal, a <code class="literal">304</code> is returned. This filter will not save processing power, as the view is still rendered. The only thing it saves is bandwidth, as the rendered response is not sent back over the wire.</p> 
   <p>You configure the <code class="literal">ShallowEtagHeaderFilter</code> in <code class="literal">web.xml</code>:</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;filter&gt;</span>
    <span class="hl-tag">&lt;filter-name&gt;</span>etagFilter<span class="hl-tag">&lt;/filter-name&gt;</span>
    <span class="hl-tag">&lt;filter-class&gt;</span>org.springframework.web.filter.ShallowEtagHeaderFilter<span class="hl-tag">&lt;/filter-class&gt;</span>
<span class="hl-tag">&lt;/filter&gt;</span>

<span class="hl-tag">&lt;filter-mapping&gt;</span>
    <span class="hl-tag">&lt;filter-name&gt;</span>etagFilter<span class="hl-tag">&lt;/filter-name&gt;</span>
    <span class="hl-tag">&lt;servlet-name&gt;</span>petclinic<span class="hl-tag">&lt;/servlet-name&gt;</span>
<span class="hl-tag">&lt;/filter-mapping&gt;</span></pre> 
  </div> 
  <div class="section" title="16.15&nbsp;Code-based Servlet container initialization">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="mvc-container-config"></a>16.15&nbsp;Code-based Servlet container initialization</h2>
     </div>
    </div>
   </div> 
   <p>In a Servlet 3.0+ environment, you have the option of configuring the Servlet container programmatically as an alternative or in combination with a <code class="literal">web.xml</code> file. Below is an example of registering a <code class="literal">DispatcherServlet</code>:</p> 
   <pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.web.WebApplicationInitializer;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWebApplicationInitializer <span class="hl-keyword">implements</span> WebApplicationInitializer {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> onStartup(ServletContext container) {
        XmlWebApplicationContext appContext = <span class="hl-keyword">new</span> XmlWebApplicationContext();
        appContext.setConfigLocation(<span class="hl-string">&quot;/WEB-INF/spring/dispatcher-config.xml&quot;</span>);

        ServletRegistration.Dynamic registration = container.addServlet(<span class="hl-string">&quot;dispatcher&quot;</span>, <span class="hl-keyword">new</span> DispatcherServlet(appContext));
        registration.setLoadOnStartup(<span class="hl-number">1</span>);
        registration.addMapping(<span class="hl-string">&quot;/&quot;</span>);
    }

}</pre> 
   <p><code class="literal">WebApplicationInitializer</code> is an interface provided by Spring MVC that ensures your implementation is detected and automatically used to initialize any Servlet 3 container. An abstract base class implementation of <code class="literal">WebApplicationInitializer</code> named <code class="literal">AbstractDispatcherServletInitializer</code> makes it even easier to register the <code class="literal">DispatcherServlet</code> by simply overriding methods to specify the servlet mapping and the location of the <code class="literal">DispatcherServlet</code> configuration:</p> 
   <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWebAppInitializer <span class="hl-keyword">extends</span> AbstractAnnotationConfigDispatcherServletInitializer {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">protected</span> Class&lt;?&gt;[] getRootConfigClasses() {
        <span class="hl-keyword">return</span> null;
    }

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">protected</span> Class&lt;?&gt;[] getServletConfigClasses() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Class[] { MyWebConfig.<span class="hl-keyword">class</span> };
    }

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">protected</span> String[] getServletMappings() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> String[] { <span class="hl-string">&quot;/&quot;</span> };
    }

}</pre> 
   <p>The above example is for an application that uses Java-based Spring configuration. If using XML-based Spring configuration, extend directly from <code class="literal">AbstractDispatcherServletInitializer</code>:</p> 
   <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWebAppInitializer <span class="hl-keyword">extends</span> AbstractDispatcherServletInitializer {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">protected</span> WebApplicationContext createRootApplicationContext() {
        <span class="hl-keyword">return</span> null;
    }

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">protected</span> WebApplicationContext createServletApplicationContext() {
        XmlWebApplicationContext cxt = <span class="hl-keyword">new</span> XmlWebApplicationContext();
        cxt.setConfigLocation(<span class="hl-string">&quot;/WEB-INF/spring/dispatcher-config.xml&quot;</span>);
        <span class="hl-keyword">return</span> cxt;
    }

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">protected</span> String[] getServletMappings() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> String[] { <span class="hl-string">&quot;/&quot;</span> };
    }

}</pre> 
   <p><code class="literal">AbstractDispatcherServletInitializer</code> also provides a convenient way to add <code class="literal">Filter</code> instances and have them automatically mapped to the <code class="literal">DispatcherServlet</code>:</p> 
   <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWebAppInitializer <span class="hl-keyword">extends</span> AbstractDispatcherServletInitializer {

    <span class="hl-comment">// ...</span>

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">protected</span> Filter[] getServletFilters() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Filter[] { <span class="hl-keyword">new</span> HiddenHttpMethodFilter(), <span class="hl-keyword">new</span> CharacterEncodingFilter() };
    }

}</pre> 
   <p>Each filter is added with a default name based on its concrete type and automatically mapped to the <code class="literal">DispatcherServlet</code>.</p> 
   <p>The <code class="literal">isAsyncSupported</code> protected method of <code class="literal">AbstractDispatcherServletInitializer</code> provides a single place to enable async support on the <code class="literal">DispatcherServlet</code> and all filters mapped to it. By default this flag is set to <code class="literal">true</code>.</p> 
  </div> 
  <div class="section" title="16.16&nbsp;Configuring Spring MVC">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="mvc-config"></a>16.16&nbsp;Configuring Spring MVC</h2>
     </div>
    </div>
   </div> 
   <p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-servlet-special-bean-types" title="16.2.1&nbsp;Special Bean Types In the WebApplicationContext">Section&nbsp;16.2.1, Special Bean Types In the WebApplicationContext</a> and <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-servlet-config" title="16.2.2&nbsp;Default DispatcherServlet Configuration">Section&nbsp;16.2.2, Default DispatcherServlet Configuration</a> explained about Spring MVCs special beans and the default implementations used by the <code class="literal">DispatcherServlet</code>. In this section youll learn about two additional ways of configuring Spring MVC. Namely the MVC Java config and the MVC XML namespace.</p> 
   <p>The MVC Java config and the MVC namespace provide similar default configuration that overrides the <code class="literal">DispatcherServlet</code> defaults. The goal is to spare most applications from having to having to create the same configuration and also to provide higher-level constructs for configuring Spring MVC that serve as a simple starting point and require little or no prior knowledge of the underlying configuration.</p> 
   <p>You can choose either the MVC Java config or the MVC namespace depending on your preference. Also as you will see further below, with the MVC Java config it is easier to see the underlying configuration as well as to make fine-grained customizations directly to the created Spring MVC beans. But lets start from the beginning.</p> 
   <div class="section" title="16.16.1&nbsp;Enabling the MVC Java Config or the MVC XML Namespace">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-config-enable"></a>16.16.1&nbsp;Enabling the MVC Java Config or the MVC XML Namespace</h3>
      </div>
     </div>
    </div> 
    <p>To enable MVC Java config add the annotation <code class="literal">@EnableWebMvc</code> to one of your <code class="literal">@Configuration</code> classes:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig {

}</pre> 
    <p>To achieve the same in XML use the <code class="literal">mvc:annotation-driven</code> element:</p> 
    <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:mvc</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/mvc&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;mvc:annotation-driven /&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>The above registers a <code class="literal">RequestMappingHandlerMapping</code>, a <code class="literal">RequestMappingHandlerAdapter</code>, and an <code class="literal">ExceptionHandlerExceptionResolver</code> (among others) in support of processing requests with annotated controller methods using annotations such as <code class="literal">@RequestMapping</code>, <code class="literal">@ExceptionHandler</code>, and others.</p> 
    <p>It also enables the following:</p> 
    <div class="orderedlist">
     <ol class="orderedlist" type="1">
      <li class="listitem"> Spring 3 style type conversion through a <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#core-convert" title="6.5&nbsp;Spring Type Conversion">ConversionService</a> instance in addition to the JavaBeans PropertyEditors used for Data Binding. </li>
      <li class="listitem"> Support for <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#format" title="6.6&nbsp;Spring Field Formatting">formatting</a> Number fields using the <code class="literal">@NumberFormat</code> annotation through the <code class="literal">ConversionService</code>. </li>
      <li class="listitem"> Support for <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#format" title="6.6&nbsp;Spring Field Formatting">formatting</a> Date, Calendar, Long, and Joda Time fields using the <code class="literal">@DateTimeFormat</code> annotation. </li>
      <li class="listitem"> Support for <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#validation-mvc-jsr303" title="Configuring a JSR-303/JSR-349 Validator for use by Spring MVC">validating</a> @Controller inputs with <code class="literal">@Valid</code>, if a JSR-303 Provider is present on the classpath. </li>
      <li class="listitem"> <p class="simpara">HttpMessageConverter support for <code class="literal">@RequestBody</code> method parameters and <code class="literal">@ResponseBody</code> method return values from <code class="literal">@RequestMapping</code> or <code class="literal">@ExceptionHandler</code> methods.</p> <p class="simpara">This is the complete list of HttpMessageConverters set up by mvc:annotation-driven:</p> 
       <div class="orderedlist">
        <ol class="orderedlist" type="a">
         <li class="listitem"> <code class="literal">ByteArrayHttpMessageConverter</code> converts byte arrays. </li>
         <li class="listitem"> <code class="literal">StringHttpMessageConverter</code> converts strings. </li>
         <li class="listitem"> <code class="literal">ResourceHttpMessageConverter</code> converts to/from <code class="literal">org.springframework.core.io.Resource</code> for all media types. </li>
         <li class="listitem"> <code class="literal">SourceHttpMessageConverter</code> converts to/from a <code class="literal">javax.xml.transform.Source</code>. </li>
         <li class="listitem"> <code class="literal">FormHttpMessageConverter</code> converts form data to/from a <code class="literal">MultiValueMap&lt;String, String&gt;</code>. </li>
         <li class="listitem"> <code class="literal">Jaxb2RootElementHttpMessageConverter</code> converts Java objects to/from XML&#x2009;&#x2009;added if JAXB2 is present on the classpath. </li>
         <li class="listitem"> <code class="literal">MappingJackson2HttpMessageConverter</code> (or <code class="literal">MappingJacksonHttpMessageConverter</code>) converts to/from JSON&#x2009;&#x2009;added if Jackson 2 (or Jackson) is present on the classpath. </li>
         <li class="listitem"> <code class="literal">AtomFeedHttpMessageConverter</code> converts Atom feeds&#x2009;&#x2009;added if Rome is present on the classpath. </li>
         <li class="listitem"> <code class="literal">RssChannelHttpMessageConverter</code> converts RSS feeds&#x2009;&#x2009;added if Rome is present on the classpath. </li>
        </ol>
       </div> </li>
     </ol>
    </div> 
   </div> 
   <div class="section" title="16.16.2&nbsp;Customizing the Provided Configuration">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-config-customize"></a>16.16.2&nbsp;Customizing the Provided Configuration</h3>
      </div>
     </div>
    </div> 
    <p>To customize the default configuration in Java you simply implement the <code class="literal">WebMvcConfigurer</code> interface or more likely extend the class <code class="literal">WebMvcConfigurerAdapter</code> and override the methods you need. Below is an example of some of the available methods to override. See <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/servlet/config/annotation/WebMvcConfigurer.html" target="_top"><code class="literal">WebMvcConfigurer</code></a> for a list of all methods and the Javadoc for further details:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> addFormatters(FormatterRegistry registry) {
        <span class="hl-comment">// Add formatters and/or converters</span>
    }

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> configureMessageConverters(List&lt;HttpMessageConverter&lt;?&gt;&gt; converters) {
        <span class="hl-comment">// Configure the list of HttpMessageConverters to use</span>
    }

}</pre> 
    <p>To customize the default configuration of <code class="literal">&lt;mvc:annotation-driven /&gt;</code> check what attributes and sub-elements it supports. You can view the <a class="ulink" href="http://schema.spring.io/mvc/spring-mvc.xsd" target="_top">Spring MVC XML schema</a> or use the code completion feature of your IDE to discover what attributes and sub-elements are available. The sample below shows a subset of what is available:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;mvc:annotation-driven</span> <span class="hl-attribute">conversion-service</span>=<span class="hl-value">&quot;conversionService&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;mvc:message-converters&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.example.MyHttpMessageConverter&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.example.MyOtherHttpMessageConverter&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/mvc:message-converters&gt;</span>
<span class="hl-tag">&lt;/mvc:annotation-driven&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;conversionService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;formatters&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.example.MyFormatter&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.example.MyOtherFormatter&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   </div> 
   <div class="section" title="16.16.3&nbsp;Configuring Interceptors">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-config-interceptors"></a>16.16.3&nbsp;Configuring Interceptors</h3>
      </div>
     </div>
    </div> 
    <p>You can configure <code class="literal">HandlerInterceptors</code> or <code class="literal">WebRequestInterceptors</code> to be applied to all incoming requests or restricted to specific URL path patterns.</p> 
    <p>An example of registering interceptors in Java:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(<span class="hl-keyword">new</span> LocaleInterceptor());
        registry.addInterceptor(<span class="hl-keyword">new</span> ThemeInterceptor()).addPathPatterns(<span class="hl-string">&quot;/</span><span class="strong"><strong>&quot;).excludePathPatterns(&quot;/admin/</strong></span><span class="hl-string">&quot;);
</span>        registry.addInterceptor(<span class="hl-keyword">new</span> SecurityInterceptor()).addPathPatterns(<span class="hl-string">&quot;/secure/*&quot;</span>);
    }

}</pre> 
    <p>And in XML use the <code class="literal">&lt;mvc:interceptors&gt;</code> element:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;mvc:interceptors&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.i18n.LocaleChangeInterceptor&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;mvc:interceptor&gt;</span>
        <span class="hl-tag">&lt;mvc:mapping</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;/</span><span class="strong"><strong>&quot;/&gt; &lt;mvc:exclude-mapping path=&quot;/admin/</strong></span>&quot;/&gt;
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.theme.ThemeChangeInterceptor&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/mvc:interceptor&gt;</span>
    <span class="hl-tag">&lt;mvc:interceptor&gt;</span>
        <span class="hl-tag">&lt;mvc:mapping</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;/secure/*&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.example.SecurityInterceptor&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/mvc:interceptor&gt;</span>
<span class="hl-tag">&lt;/mvc:interceptors&gt;</span></pre> 
   </div> 
   <div class="section" title="16.16.4&nbsp;Configuring Content Negotiation">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-config-content-negotiation"></a>16.16.4&nbsp;Configuring Content Negotiation</h3>
      </div>
     </div>
    </div> 
    <p>You can configure how Spring MVC determines the requested media types from the client for request mapping as well as for content negotiation purposes. The available options are to check the file extension in the request URI, the &quot;Accept&quot; header, a request parameter, as well as to fall back on a default content type. By default, file extension in the request URI is checked first and the &quot;Accept&quot; header is checked next.</p> 
    <p>For file extensions in the request URI, the MVC Java config and the MVC namespace, automatically register extensions such as <code class="literal">.json</code>, <code class="literal">.xml</code>, <code class="literal">.rss</code>, and <code class="literal">.atom</code> if the corresponding dependencies such as Jackson, JAXB2, or Rome are present on the classpath. Additional extensions may be not need to be registered explicitly if they can be discovered via <code class="literal">ServletContext.getMimeType(String)</code> or the <span class="emphasis"><em>Java Activation Framework</em></span> (see <code class="literal">javax.activation.MimetypesFileTypeMap</code>). You can register more extensions with the <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/servlet/mvc/method/annotation/RequestMappingHandlerMapping.html#setUseRegisteredSuffixPatternMatch(boolean)" target="_top">setUseRegisteredSuffixPatternMatch method</a>.</p> 
    <p>The introduction of <code class="literal">ContentNegotiationManger</code> also enables selective suffix pattern matching for incoming requests. For more details, see the Javadoc of</p> 
    <p>Below is an example of customizing content negotiation options through the MVC Java config:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> configureContentNegotiation(ContentNegotiationConfigurer configurer) {
        configurer.favorPathExtension(false).favorParameter(true);
    }
}</pre> 
    <p>In the MVC namespace, the <code class="literal">&lt;mvc:annotation-driven&gt;</code> element has a <code class="literal">content-negotiation-manager</code> attribute, which expects a <code class="literal">ContentNegotiationManager</code> that in turn can be created with a <code class="literal">ContentNegotiationManagerFactoryBean</code>:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;mvc:annotation-driven</span> <span class="hl-attribute">content-negotiation-manager</span>=<span class="hl-value">&quot;contentNegotiationManager&quot;</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;contentNegotiationManager&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.accept.ContentNegotiationManagerFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;favorPathExtension&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;false&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;favorParameter&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;true&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;mediaTypes&quot;</span><span class="hl-tag"> &gt;</span>
        <span class="hl-tag">&lt;value&gt;</span>
            json=application/json
            xml=application/xml
        <span class="hl-tag">&lt;/value&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>If not using the MVC Java config or the MVC namespace, youll need to create an instance of <code class="literal">ContentNegotiationManager</code> and use it to configure <code class="literal">RequestMappingHandlerMapping</code> for request mapping purposes, and <code class="literal">RequestMappingHandlerAdapter</code> and <code class="literal">ExceptionHandlerExceptionResolver</code> for content negotiation purposes.</p> 
    <p>Note that <code class="literal">ContentNegotiatingViewResolver</code> now can also be configured with a <code class="literal">ContentNegotiatingViewResolver</code>, so you can use one instance throughout Spring MVC.</p> 
    <p>In more advanced cases, it may be useful to configure multiple <code class="literal">ContentNegotiationManager</code> instances that in turn may contain custom <code class="literal">ContentNegotiationStrategy</code> implementations. For example you could configure <code class="literal">ExceptionHandlerExceptionResolver</code> with a <code class="literal">ContentNegotiationManager</code> that always resolves the requested media type to <code class="literal">&quot;application/json&quot;</code>. Or you may want to plug a custom strategy that has some logic to select a default content type (e.g. either XML or JSON) if no content types were requested.</p> 
   </div> 
   <div class="section" title="16.16.5&nbsp;Configuring View Controllers">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-config-view-controller"></a>16.16.5&nbsp;Configuring View Controllers</h3>
      </div>
     </div>
    </div> 
    <p>This is a shortcut for defining a <code class="literal">ParameterizableViewController</code> that immediately forwards to a view when invoked. Use it in static cases when there is no Java controller logic to execute before the view generates the response.</p> 
    <p>An example of forwarding a request for <code class="literal">&quot;/&quot;</code> to a view called <code class="literal">&quot;home&quot;</code> in Java:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addViewControllers(ViewControllerRegistry registry) {
        registry.addViewController(<span class="hl-string">&quot;/&quot;</span>).setViewName(<span class="hl-string">&quot;home&quot;</span>);
    }

}</pre> 
    <p>And the same in XML use the <code class="literal">&lt;mvc:view-controller&gt;</code> element:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;mvc:view-controller</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;/&quot;</span> <span class="hl-attribute">view-name</span>=<span class="hl-value">&quot;home&quot;</span><span class="hl-tag">/&gt;</span></pre> 
   </div> 
   <div class="section" title="16.16.6&nbsp;Configuring Serving of Resources">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-config-static-resources"></a>16.16.6&nbsp;Configuring Serving of Resources</h3>
      </div>
     </div>
    </div> 
    <p>This option allows static resource requests following a particular URL pattern to be served by a <code class="literal">ResourceHttpRequestHandler</code> from any of a list of <code class="literal">Resource</code> locations. This provides a convenient way to serve static resources from locations other than the web application root, including locations on the classpath. The <code class="literal">cache-period</code> property may be used to set far future expiration headers (1 year is the recommendation of optimization tools such as Page Speed and YSlow) so that they will be more efficiently utilized by the client. The handler also properly evaluates the <code class="literal">Last-Modified</code> header (if present) so that a <code class="literal">304</code> status code will be returned as appropriate, avoiding unnecessary overhead for resources that are already cached by the client. For example, to serve resource requests with a URL pattern of <code class="literal">/resources/**</code> from a <code class="literal">public-resources</code> directory within the web application root you would use:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler(<span class="hl-string">&quot;/resources/**&quot;</span>).addResourceLocations(<span class="hl-string">&quot;/public-resources/&quot;</span>);
    }

}</pre> 
    <p>And the same in XML:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;mvc:resources</span> <span class="hl-attribute">mapping</span>=<span class="hl-value">&quot;/resources/**&quot;</span> <span class="hl-attribute">location</span>=<span class="hl-value">&quot;/public-resources/&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <p>To serve these resources with a 1-year future expiration to ensure maximum use of the browser cache and a reduction in HTTP requests made by the browser:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler(<span class="hl-string">&quot;/resources/**&quot;</span>).addResourceLocations(<span class="hl-string">&quot;/public-resources/&quot;</span>).setCachePeriod(<span class="hl-number">31556926</span>);
    }

}</pre> 
    <p>And in XML:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;mvc:resources</span> <span class="hl-attribute">mapping</span>=<span class="hl-value">&quot;/resources/**&quot;</span> <span class="hl-attribute">location</span>=<span class="hl-value">&quot;/public-resources/&quot;</span> <span class="hl-attribute">cache-period</span>=<span class="hl-value">&quot;31556926&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <p>The <code class="literal">mapping</code> attribute must be an Ant pattern that can be used by <code class="literal">SimpleUrlHandlerMapping</code>, and the <code class="literal">location</code> attribute must specify one or more valid resource directory locations. Multiple resource locations may be specified using a comma-separated list of values. The locations specified will be checked in the specified order for the presence of the resource for any given request. For example, to enable the serving of resources from both the web application root and from a known path of <code class="literal">/META-INF/public-web-resources/</code> in any jar on the classpath use:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></i>
<i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler(<span class="hl-string">&quot;/resources/**&quot;</span>)
                .addResourceLocations(<span class="hl-string">&quot;/&quot;</span>, <span class="hl-string">&quot;classpath:/META-INF/public-web-resources/&quot;</span>);
    }

}</pre> 
    <p>And in XML:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;mvc:resources</span> <span class="hl-attribute">mapping</span>=<span class="hl-value">&quot;/resources/**&quot;</span> <span class="hl-attribute">location</span>=<span class="hl-value">&quot;/, classpath:/META-INF/public-web-resources/&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <p>When serving resources that may change when a new version of the application is deployed, it is recommended that you incorporate a version string into the mapping pattern used to request the resources, so that you may force clients to request the newly deployed version of your applications resources. Such a version string can be parameterized and accessed using SpEL so that it may be easily managed in a single place when deploying new versions.</p> 
    <p>As an example, lets consider an application that uses a performance-optimized custom build (as recommended) of the Dojo JavaScript library in production, and that the build is generally deployed within the web application at a path of <code class="literal">/public-resources/dojo/dojo.js</code>. Since different parts of Dojo may be incorporated into the custom build for each new version of the application, the client web browsers need to be forced to re-download that custom-built <code class="literal">dojo.js</code> resource any time a new version of the application is deployed. A simple way to achieve this would be to manage the version of the application in a properties file, such as:</p> 
    <pre class="literallayout">application.version=1.0.0</pre> 
    <p>and then to make the properties files values accessible to SpEL as a bean using the <code class="literal">util:properties</code> tag:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;util:properties</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;applicationProps&quot;</span> <span class="hl-attribute">location</span>=<span class="hl-value">&quot;/WEB-INF/spring/application.properties&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <p>With the application version now accessible via SpEL, we can incorporate this into the use of the <code class="literal">resources</code> tag:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;mvc:resources</span> <span class="hl-attribute">mapping</span>=<span class="hl-value">&quot;/resources-#{applicationProps[</span><span class="emphasis"><em>application.version</em></span>]}/**&quot; location=&quot;/public-resources/&quot;/&gt;</pre> 
    <p>In Java, you can use the <code class="literal">@PropertySouce</code> annotation and then inject the <code class="literal">Environment</code> abstraction for access to all defined properties:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></i>
<i><span class="hl-annotation" style="color: gray">@PropertySource(&quot;/WEB-INF/spring/application.properties&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <i><span class="hl-annotation" style="color: gray">@Inject</span></i> Environment env;

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler(
                <span class="hl-string">&quot;/resources-&quot;</span> + env.getProperty(<span class="hl-string">&quot;application.version&quot;</span>) + <span class="hl-string">&quot;/**&quot;</span>)
                .addResourceLocations(<span class="hl-string">&quot;/public-resources/&quot;</span>);
    }

}</pre> 
    <p>and finally, to request the resource with the proper URL, we can take advantage of the Spring JSP tags:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;spring:eval</span> <span class="hl-attribute">expression</span>=<span class="hl-value">&quot;@applicationProps[</span><span class="emphasis"><em>application.version</em></span>]&quot; var=&quot;applicationVersion&quot;/&gt;

<span class="hl-tag">&lt;spring:url</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;/resources-{applicationVersion}&quot;</span> <span class="hl-attribute">var</span>=<span class="hl-value">&quot;resourceUrl&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;spring:param</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;applicationVersion&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;${applicationVersion}&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/spring:url&gt;</span>

<span class="hl-tag">&lt;script</span> <span class="hl-attribute">src</span>=<span class="hl-value">&quot;${resourceUrl}/dojo/dojo.js&quot;</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;text/javascript&quot;</span><span class="hl-tag">&gt;</span> <span class="hl-tag">&lt;/script&gt;</span></pre> 
   </div> 
   <div class="section" title="16.16.7&nbsp;mvc:default-servlet-handler">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-default-servlet-handler"></a>16.16.7&nbsp;mvc:default-servlet-handler</h3>
      </div>
     </div>
    </div> 
    <p>This tag allows for mapping the <code class="literal">DispatcherServlet</code> to &quot;/&quot; (thus overriding the mapping of the containers default Servlet), while still allowing static resource requests to be handled by the containers default Servlet. It configures a <code class="literal">DefaultServletHttpRequestHandler</code> with a URL mapping of &quot;/**&quot; and the lowest priority relative to other URL mappings.</p> 
    <p>This handler will forward all requests to the default Servlet. Therefore it is important that it remains last in the order of all other URL <code class="literal">HandlerMappings</code>. That will be the case if you use <code class="literal">&lt;mvc:annotation-driven&gt;</code> or alternatively if you are setting up your own customized <code class="literal">HandlerMapping</code> instance be sure to set its <code class="literal">order</code> property to a value lower than that of the <code class="literal">DefaultServletHttpRequestHandler</code>, which is <code class="literal">Integer.MAX_VALUE</code>.</p> 
    <p>To enable the feature using the default setup use:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {
        configurer.enable();
    }

}</pre> 
    <p>Or in XML:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;mvc:default-servlet-handler/&gt;</span></pre> 
    <p>The caveat to overriding the &quot;/&quot; Servlet mapping is that the <code class="literal">RequestDispatcher</code> for the default Servlet must be retrieved by name rather than by path. The <code class="literal">DefaultServletHttpRequestHandler</code> will attempt to auto-detect the default Servlet for the container at startup time, using a list of known names for most of the major Servlet containers (including Tomcat, Jetty, GlassFish, JBoss, Resin, WebLogic, and WebSphere). If the default Servlet has been custom configured with a different name, or if a different Servlet container is being used where the default Servlet name is unknown, then the default Servlets name must be explicitly provided as in the following example:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableWebMvc</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> WebMvcConfigurerAdapter {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> configureDefaultServletHandling(DefaultServletHandlerConfigurer configurer) {
        configurer.enable(<span class="hl-string">&quot;myCustomDefaultServlet&quot;</span>);
    }

}</pre> 
    <p>Or in XML:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;mvc:default-servlet-handler</span> <span class="hl-attribute">default-servlet-name</span>=<span class="hl-value">&quot;myCustomDefaultServlet&quot;</span><span class="hl-tag">/&gt;</span></pre> 
   </div> 
   <div class="section" title="16.16.8&nbsp;More Spring Web MVC Resources">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-resources"></a>16.16.8&nbsp;More Spring Web MVC Resources</h3>
      </div>
     </div>
    </div> 
    <p>See the following links and pointers for more resources about Spring Web MVC:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> There are many excellent articles and tutorials that show how to build web applications with Spring MVC. Read them at the <a class="ulink" href="http://spring.io/docs" target="_top">Spring Documentation</a> page. </li>
      <li class="listitem"> &quot;Expert Spring Web MVC and Web Flow&quot; by Seth Ladd and others (published by Apress) is an excellent hard copy source of Spring Web MVC goodness. </li>
     </ul>
    </div> 
   </div> 
   <div class="section" title="16.16.9&nbsp;Advanced Customizations with MVC Java Config">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-config-advanced-java"></a>16.16.9&nbsp;Advanced Customizations with MVC Java Config</h3>
      </div>
     </div>
    </div> 
    <p>As you can see from the above examples, MVC Java config and the MVC namespace provide higher level constructs that do not require deep knowledge of the underlying beans created for you. Instead it helps you to focus on your application needs. However, at some point you may need more fine-grained control or you may simply wish to understand the underlying configuration.</p> 
    <p>The first step towards more fine-grained control is to see the underlying beans created for you. In MVC Java config you can see the Javadoc and the <code class="literal">@Bean</code> methods in <code class="literal">WebMvcConfigurationSupport</code>. The configuration in this class is automatically imported through the <code class="literal">@EnableWebMvc</code> annotation. In fact if you open <code class="literal">@EnableWebMvc</code> you can see the <code class="literal">@Import</code> statement.</p> 
    <p>The next step towards more fine-grained control is to customize a property on one of the beans created in <code class="literal">WebMvcConfigurationSupport</code> or perhaps to provide your own instance. This requires two things&#x2009;&#x2009;remove the <code class="literal">@EnableWebMvc</code> annotation in order to prevent the import and then extend from <code class="literal">DelegatingWebMvcConfiguration</code>, a subclass of <code class="literal">WebMvcConfigurationSupport</code>. Here is an example:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebConfig <span class="hl-keyword">extends</span> DelegatingWebMvcConfiguration {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> addInterceptors(InterceptorRegistry registry){
        <span class="hl-comment">// ...</span>
    }

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> RequestMappingHandlerAdapter requestMappingHandlerAdapter() {
        <span class="hl-comment">// Create or let &quot;super&quot; create the adapter</span>
        <span class="hl-comment">// Then customize one of its properties</span>
    }

}</pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>An application should have only one configuration extending <code class="literal">DelegatingWebMvcConfiguration</code> or a single <code class="literal">@EnableWebMvc</code> annotated class, since they both register the same underlying beans.</p> <p>Modifying beans in this way does not prevent you from using any of the higher-level constructs shown earlier in this section. <code class="literal">WebMvcConfigurerAdapter</code> subclasses and <code class="literal">WebMvcConfigurer</code> implementations are still being used.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="16.16.10&nbsp;Advanced Customizations with the MVC Namespace">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mvc-config-advanced-xml"></a>16.16.10&nbsp;Advanced Customizations with the MVC Namespace</h3>
      </div>
     </div>
    </div> 
    <p>Fine-grained control over the configuration created for you is a bit harder with the MVC namespace.</p> 
    <p>If you do need to do that, rather than replicating the configuration it provides, consider configuring a <code class="literal">BeanPostProcessor</code> that detects the bean you want to customize by type and then modifying its properties as necessary. For example:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Component</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyPostProcessor <span class="hl-keyword">implements</span> BeanPostProcessor {

    <span class="hl-keyword">public</span> Object postProcessBeforeInitialization(Object bean, String name) <span class="hl-keyword">throws</span> BeansException {
        <span class="hl-keyword">if</span> (bean <span class="hl-keyword">instanceof</span> RequestMappingHandlerAdapter) {
            <span class="hl-comment">// Modify properties of the adapter</span>
        }
    }

}</pre> 
    <p>Note that <code class="literal">MyPostProcessor</code> needs to be included in an <code class="literal">&lt;component scan /&gt;</code> in order for it to be detected or if you prefer you can declare it explicitly with an XML bean declaration.</p> 
   </div> 
  </div> 
 </div> 
 <div class="chapter" title="17.&nbsp;View technologies">
  <div class="titlepage">
   <div>
    <div>
     <h2 class="title"><a name="view"></a>17.&nbsp;View technologies</h2>
    </div>
   </div>
  </div> 
  <div class="section" title="17.1&nbsp;Introduction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="view-introduction"></a>17.1&nbsp;Introduction</h2>
     </div>
    </div>
   </div> 
   <p>One of the areas in which Spring excels is in the separation of view technologies from the rest of the MVC framework. For example, deciding to use Velocity or XSLT in place of an existing JSP is primarily a matter of configuration. This chapter covers the major view technologies that work with Spring and touches briefly on how to add new ones. This chapter assumes you are already familiar with <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-viewresolver" title="16.5&nbsp;Resolving views">Section&nbsp;16.5, Resolving views</a> which covers the basics of how views in general are coupled to the MVC framework.</p> 
  </div> 
  <div class="section" title="17.2&nbsp;JSP &amp; JSTL">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="view-jsp"></a>17.2&nbsp;JSP &amp; JSTL</h2>
     </div>
    </div>
   </div> 
   <p>Spring provides a couple of out-of-the-box solutions for JSP and JSTL views. Using JSP or JSTL is done using a normal view resolver defined in the <code class="literal">WebApplicationContext</code>. Furthermore, of course you need to write some JSPs that will actually render the view.</p> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>Setting up your application to use JSTL is a common source of error, mainly caused by confusion over the different servlet spec., JSP and JSTL version numbers, what they mean and how to declare the taglibs correctly. The article <a class="ulink" href="http://www.mularien.com/blog/2008/04/24/how-to-reference-and-use-jstl-in-your-web-application/" target="_top">How to Reference and Use JSTL in your Web Application</a> provides a useful guide to the common pitfalls and how to avoid them. Note that as of Spring 3.0, the minimum supported servlet version is 2.4 (JSP 2.0 and JSTL 1.1), which reduces the scope for confusion somewhat.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <div class="section" title="17.2.1&nbsp;View resolvers">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="view-jsp-resolver"></a>17.2.1&nbsp;View resolvers</h3>
      </div>
     </div>
    </div> 
    <p>Just as with any other view technology youre integrating with Spring, for JSPs youll need a view resolver that will resolve your views. The most commonly used view resolvers when developing with JSPs are the <code class="literal">InternalResourceViewResolver</code> and the <code class="literal">ResourceBundleViewResolver</code>. Both are declared in the <code class="literal">WebApplicationContext</code>:</p> 
    <pre class="programlisting"><span class="hl-comment">&lt;!-- the ResourceBundleViewResolver --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;viewResolver&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.ResourceBundleViewResolver&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;basename&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;views&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

# And a sample properties file is uses (views.properties in WEB-INF/classes):
welcome.(class)=org.springframework.web.servlet.view.JstlView
welcome.url=/WEB-INF/jsp/welcome.jsp

productList.(class)=org.springframework.web.servlet.view.JstlView
productList.url=/WEB-INF/jsp/productlist.jsp</pre> 
    <p>As you can see, the <code class="literal">ResourceBundleViewResolver</code> needs a properties file defining the view names mapped to 1) a class and 2) a URL. With a <code class="literal">ResourceBundleViewResolver</code> you can mix different types of views using only one resolver.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;viewResolver&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;viewClass&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.JstlView&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;prefix&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;/WEB-INF/jsp/&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;suffix&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;.jsp&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>The <code class="literal">InternalResourceBundleViewResolver</code> can be configured for using JSPs as described above. As a best practice, we strongly encourage placing your JSP files in a directory under the <code class="literal">'WEB-INF'</code> directory, so there can be no direct access by clients.</p> 
   </div> 
   <div class="section" title="17.2.2&nbsp;Plain-old JSPs versus JSTL">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="view-jsp-jstl"></a>17.2.2&nbsp;<span class="emphasis"><em>Plain-old</em></span> JSPs versus JSTL</h3>
      </div>
     </div>
    </div> 
    <p>When using the Java Standard Tag Library you must use a special view class, the <code class="literal">JstlView</code>, as JSTL needs some preparation before things such as the I18N features will work.</p> 
   </div> 
   <div class="section" title="17.2.3&nbsp;Additional tags facilitating development">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="view-jsp-tags"></a>17.2.3&nbsp;Additional tags facilitating development</h3>
      </div>
     </div>
    </div> 
    <p>Spring provides data binding of request parameters to command objects as described in earlier chapters. To facilitate the development of JSP pages in combination with those data binding features, Spring provides a few tags that make things even easier. All Spring tags have<span class="emphasis"><em>HTML escaping</em></span> features to enable or disable escaping of characters.</p> 
    <p>The tag library descriptor (TLD) is included in the <code class="literal">spring-webmvc.jar</code>. Further information about the individual tags can be found in the appendix entitled <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#spring.tld" title="35.&nbsp;spring.tld">Chapter&nbsp;35, <i>spring.tld</i></a>.</p> 
   </div> 
   <div class="section" title="17.2.4&nbsp;Using Springs form tag library">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="view-jsp-formtaglib"></a>17.2.4&nbsp;Using Springs form tag library</h3>
      </div>
     </div>
    </div> 
    <p>As of version 2.0, Spring provides a comprehensive set of data binding-aware tags for handling form elements when using JSP and Spring Web MVC. Each tag provides support for the set of attributes of its corresponding HTML tag counterpart, making the tags familiar and intuitive to use. The tag-generated HTML is HTML 4.01/XHTML 1.0 compliant.</p> 
    <p>Unlike other form/input tag libraries, Springs form tag library is integrated with Spring Web MVC, giving the tags access to the command object and reference data your controller deals with. As you will see in the following examples, the form tags make JSPs easier to develop, read and maintain.</p> 
    <p>Lets go through the form tags and look at an example of how each tag is used. We have included generated HTML snippets where certain tags require further commentary.</p> 
    <div class="section" title="Configuration">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-jsp-formtaglib-configuration"></a>Configuration</h4>
       </div>
      </div>
     </div> 
     <p>The form tag library comes bundled in <code class="literal">spring-webmvc.jar</code>. The library descriptor is called <code class="literal">spring-form.tld</code>.</p> 
     <p>To use the tags from this library, add the following directive to the top of your JSP page:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;%@</span> <span class="hl-attribute">taglib</span> <span class="hl-attribute">prefix</span>=<span class="hl-value">&quot;form&quot;</span> <span class="hl-attribute">uri</span>=<span class="hl-value">&quot;http://www.springframework.org/tags/form&quot;</span> <span class="hl-attribute">%&gt;</span></pre> 
     <p>where <code class="literal">form</code> is the tag name prefix you want to use for the tags from this library.</p> 
    </div> 
    <div class="section" title="The form tag">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-jsp-formtaglib-formtag"></a>The form tag</h4>
       </div>
      </div>
     </div> 
     <p>This tag renders an HTML <span class="emphasis"><em>form</em></span> tag and exposes a binding path to inner tags for binding. It puts the command object in the <code class="literal">PageContext</code> so that the command object can be accessed by inner tags. <span class="emphasis"><em>All the other tags in this library are nested tags of the <code class="literal">form</code> tag</em></span>.</p> 
     <p>Lets assume we have a domain object called <code class="literal">User</code>. It is a JavaBean with properties such as <code class="literal">firstName</code> and <code class="literal">lastName</code>. We will use it as the form backing object of our form controller which returns <code class="literal">form.jsp</code>. Below is an example of what <code class="literal">form.jsp</code> would look like:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;form:form&gt;</span>
    <span class="hl-tag">&lt;table&gt;</span>
        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span>First Name:<span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;form:input</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;firstName&quot;</span><span class="hl-tag"> /&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>
        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span>Last Name:<span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;form:input</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;lastName&quot;</span><span class="hl-tag"> /&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>
        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td</span> <span class="hl-attribute">colspan</span>=<span class="hl-value">&quot;2&quot;</span><span class="hl-tag">&gt;</span>
                <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;submit&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Save Changes&quot;</span><span class="hl-tag"> /&gt;</span>
            <span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>
    <span class="hl-tag">&lt;/table&gt;</span>
<span class="hl-tag">&lt;/form:form&gt;</span></pre> 
     <p>The <code class="literal">firstName</code> and <code class="literal">lastName</code> values are retrieved from the command object placed in the <code class="literal">PageContext</code> by the page controller. Keep reading to see more complex examples of how inner tags are used with the <code class="literal">form</code> tag.</p> 
     <p>The generated HTML looks like a standard form:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;form</span> <span class="hl-attribute">method</span>=<span class="hl-value">&quot;POST&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;table&gt;</span>
        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span>First Name:<span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;firstName&quot;</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;text&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Harry&quot;</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>
        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span>Last Name:<span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;lastName&quot;</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;text&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Potter&quot;</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>
        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td</span> <span class="hl-attribute">colspan</span>=<span class="hl-value">&quot;2&quot;</span><span class="hl-tag">&gt;</span>
                <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;submit&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Save Changes&quot;</span><span class="hl-tag"> /&gt;</span>
            <span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>
    <span class="hl-tag">&lt;/table&gt;</span>
<span class="hl-tag">&lt;/form&gt;</span></pre> 
     <p>The preceding JSP assumes that the variable name of the form backing object is <code class="literal">'command'</code>. If you have put the form backing object into the model under another name (definitely a best practice), then you can bind the form to the named variable like so:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;form:form</span> <span class="hl-attribute">commandName</span>=<span class="hl-value">&quot;user&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;table&gt;</span>
        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span>First Name:<span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;form:input</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;firstName&quot;</span><span class="hl-tag"> /&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>
        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span>Last Name:<span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;form:input</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;lastName&quot;</span><span class="hl-tag"> /&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>
        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td</span> <span class="hl-attribute">colspan</span>=<span class="hl-value">&quot;2&quot;</span><span class="hl-tag">&gt;</span>
                <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;submit&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Save Changes&quot;</span><span class="hl-tag"> /&gt;</span>
            <span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>
    <span class="hl-tag">&lt;/table&gt;</span>
<span class="hl-tag">&lt;/form:form&gt;</span></pre> 
    </div> 
    <div class="section" title="The input tag">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-jsp-formtaglib-inputtag"></a>The input tag</h4>
       </div>
      </div>
     </div> 
     <p>This tag renders an HTML <span class="emphasis"><em>input</em></span> tag using the bound value and type=<span class="emphasis"><em>text</em></span> by default. For an example of this tag, see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#view-jsp-formtaglib-formtag" title="The form tag">the section called The form tag</a>. Starting with Spring 3.1 you can use other types such HTML5-specific types like <span class="emphasis"><em>email</em></span>, <span class="emphasis"><em>tel</em></span>, <span class="emphasis"><em>date</em></span>, and others.</p> 
    </div> 
    <div class="section" title="The checkbox tag">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-jsp-formtaglib-checkboxtag"></a>The checkbox tag</h4>
       </div>
      </div>
     </div> 
     <p>This tag renders an HTML <span class="emphasis"><em>input</em></span> tag with type <span class="emphasis"><em>checkbox</em></span>.</p> 
     <p>Lets assume our <code class="literal">User</code> has preferences such as newsletter subscription and a list of hobbies. Below is an example of the <code class="literal">Preferences</code> class:</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Preferences {

    <span class="hl-keyword">private</span> <span class="hl-keyword">boolean</span> receiveNewsletter;
    <span class="hl-keyword">private</span> String[] interests;
    <span class="hl-keyword">private</span> String favouriteWord;

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> isReceiveNewsletter() {
        <span class="hl-keyword">return</span> receiveNewsletter;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setReceiveNewsletter(<span class="hl-keyword">boolean</span> receiveNewsletter) {
        <span class="hl-keyword">this</span>.receiveNewsletter = receiveNewsletter;
    }

    <span class="hl-keyword">public</span> String[] getInterests() {
        <span class="hl-keyword">return</span> interests;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setInterests(String[] interests) {
        <span class="hl-keyword">this</span>.interests = interests;
    }

    <span class="hl-keyword">public</span> String getFavouriteWord() {
        <span class="hl-keyword">return</span> favouriteWord;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setFavouriteWord(String favouriteWord) {
        <span class="hl-keyword">this</span>.favouriteWord = favouriteWord;
    }
}</pre> 
     <p>The <code class="literal">form.jsp</code> would look like:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;form:form&gt;</span>
    <span class="hl-tag">&lt;table&gt;</span>
        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span>Subscribe to newsletter?:<span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;%--</span> <span class="hl-attribute">Approach</span> <span class="hl-attribute">1:</span> <span class="hl-attribute">Property</span> <span class="hl-attribute">is</span> <span class="hl-attribute">of</span> <span class="hl-attribute">type</span> <span class="hl-attribute">java.lang.Boolean</span> <span class="hl-attribute">--%&gt;</span>
            <span class="hl-attribute">&lt;td&gt;&lt;form:checkbox</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;preferences.receiveNewsletter&quot;</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>

        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span>Interests:<span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;%--</span> <span class="hl-attribute">Approach</span> <span class="hl-attribute">2:</span> <span class="hl-attribute">Property</span> <span class="hl-attribute">is</span> <span class="hl-attribute">of</span> <span class="hl-attribute">an</span> <span class="hl-attribute">array</span> <span class="hl-attribute">or</span> <span class="hl-attribute">of</span> <span class="hl-attribute">type</span> <span class="hl-attribute">java.util.Collection</span> <span class="hl-attribute">--%&gt;</span>
            <span class="hl-attribute">&lt;td&gt;</span>
                <span class="hl-attribute">Quidditch:</span> <span class="hl-attribute">&lt;form:checkbox</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;preferences.interests&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Quidditch&quot;</span><span class="hl-tag">/&gt;</span>
                Herbology: <span class="hl-tag">&lt;form:checkbox</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;preferences.interests&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Herbology&quot;</span><span class="hl-tag">/&gt;</span>
                Defence Against the Dark Arts: <span class="hl-tag">&lt;form:checkbox</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;preferences.interests&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Defence Against the Dark Arts&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>

        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span>Favourite Word:<span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;%--</span> <span class="hl-attribute">Approach</span> <span class="hl-attribute">3:</span> <span class="hl-attribute">Property</span> <span class="hl-attribute">is</span> <span class="hl-attribute">of</span> <span class="hl-attribute">type</span> <span class="hl-attribute">java.lang.Object</span> <span class="hl-attribute">--%&gt;</span>
            <span class="hl-attribute">&lt;td&gt;</span>
                <span class="hl-attribute">Magic:</span> <span class="hl-attribute">&lt;form:checkbox</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;preferences.favouriteWord&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Magic&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>
    <span class="hl-tag">&lt;/table&gt;</span>
<span class="hl-tag">&lt;/form:form&gt;</span></pre> 
     <p>There are 3 approaches to the <code class="literal">checkbox</code> tag which should meet all your checkbox needs.</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> Approach One - When the bound value is of type <code class="literal">java.lang.Boolean</code>, the <code class="literal">input(checkbox)</code> is marked as <span class="emphasis"><em>checked</em></span> if the bound value is <code class="literal">true</code>. The <code class="literal">value</code> attribute corresponds to the resolved value of the <code class="literal">setValue(Object)</code> value property. </li>
       <li class="listitem"> Approach Two - When the bound value is of type <code class="literal">array</code> or <code class="literal">java.util.Collection</code>, the <code class="literal">input(checkbox)</code> is marked as <span class="emphasis"><em>checked</em></span> if the configured <code class="literal">setValue(Object)</code> value is present in the bound <code class="literal">Collection</code>. </li>
       <li class="listitem"> Approach Three - For any other bound value type, the <code class="literal">input(checkbox)</code> is marked as <span class="emphasis"><em>checked</em></span> if the configured <code class="literal">setValue(Object)</code> is equal to the bound value. </li>
      </ul>
     </div> 
     <p>Note that regardless of the approach, the same HTML structure is generated. Below is an HTML snippet of some checkboxes:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;tr&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span>Interests:<span class="hl-tag">&lt;/td&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span>
        Quidditch: <span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;preferences.interests&quot;</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;checkbox&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Quidditch&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;hidden&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;1&quot;</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;_preferences.interests&quot;</span><span class="hl-tag">/&gt;</span>
        Herbology: <span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;preferences.interests&quot;</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;checkbox&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Herbology&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;hidden&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;1&quot;</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;_preferences.interests&quot;</span><span class="hl-tag">/&gt;</span>
        Defence Against the Dark Arts: <span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;preferences.interests&quot;</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;checkbox&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Defence Against the Dark Arts&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;hidden&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;1&quot;</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;_preferences.interests&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/td&gt;</span>
<span class="hl-tag">&lt;/tr&gt;</span></pre> 
     <p>What you might not expect to see is the additional hidden field after each checkbox. When a checkbox in an HTML page is <span class="emphasis"><em>not</em></span> checked, its value will not be sent to the server as part of the HTTP request parameters once the form is submitted, so we need a workaround for this quirk in HTML in order for Spring form data binding to work. The <code class="literal">checkbox</code> tag follows the existing Spring convention of including a hidden parameter prefixed by an underscore (&quot;_&quot;) for each checkbox. By doing this, you are effectively telling Spring that &quot;<span class="emphasis"><em>the checkbox was visible in the form and I want my object to which the form data will be bound to reflect the state of the checkbox no matter what</em></span>&quot;.</p> 
    </div> 
    <div class="section" title="The checkboxes tag">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-jsp-formtaglib-checkboxestag"></a>The checkboxes tag</h4>
       </div>
      </div>
     </div> 
     <p>This tag renders multiple HTML <span class="emphasis"><em>input</em></span> tags with type <span class="emphasis"><em>checkbox</em></span>.</p> 
     <p>Building on the example from the previous <code class="literal">checkbox</code> tag section. Sometimes you prefer not to have to list all the possible hobbies in your JSP page. You would rather provide a list at runtime of the available options and pass that in to the tag. That is the purpose of the <code class="literal">checkboxes</code> tag. You pass in an <code class="literal">Array</code>, a <code class="literal">List</code> or a <code class="literal">Map</code> containing the available options in the &quot;items&quot; property. Typically the bound property is a collection so it can hold multiple values selected by the user. Below is an example of the JSP using this tag:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;form:form&gt;</span>
    <span class="hl-tag">&lt;table&gt;</span>
        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span>Interests:<span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span>
                <span class="hl-tag">&lt;%--</span> <span class="hl-attribute">Property</span> <span class="hl-attribute">is</span> <span class="hl-attribute">of</span> <span class="hl-attribute">an</span> <span class="hl-attribute">array</span> <span class="hl-attribute">or</span> <span class="hl-attribute">of</span> <span class="hl-attribute">type</span> <span class="hl-attribute">java.util.Collection</span> <span class="hl-attribute">--%&gt;</span>
                <span class="hl-attribute">&lt;form:checkboxes</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;preferences.interests&quot;</span> <span class="hl-attribute">items</span>=<span class="hl-value">&quot;${interestList}&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>
    <span class="hl-tag">&lt;/table&gt;</span>
<span class="hl-tag">&lt;/form:form&gt;</span></pre> 
     <p>This example assumes that the &quot;interestList&quot; is a <code class="literal">List</code> available as a model attribute containing strings of the values to be selected from. In the case where you use a Map, the map entry key will be used as the value and the map entrys value will be used as the label to be displayed. You can also use a custom object where you can provide the property names for the value using &quot;itemValue&quot; and the label using &quot;itemLabel&quot;.</p> 
    </div> 
    <div class="section" title="The radiobutton tag">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-jsp-formtaglib-radiobuttontag"></a>The radiobutton tag</h4>
       </div>
      </div>
     </div> 
     <p>This tag renders an HTML <span class="emphasis"><em>input</em></span> tag with type <span class="emphasis"><em>radio</em></span>.</p> 
     <p>A typical usage pattern will involve multiple tag instances bound to the same property but with different values.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;tr&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span>Sex:<span class="hl-tag">&lt;/td&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span>
        Male: <span class="hl-tag">&lt;form:radiobutton</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;sex&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;M&quot;</span><span class="hl-tag">/&gt;</span> <span class="hl-tag">&lt;br/&gt;</span>
        Female: <span class="hl-tag">&lt;form:radiobutton</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;sex&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;F&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/td&gt;</span>
<span class="hl-tag">&lt;/tr&gt;</span></pre> 
    </div> 
    <div class="section" title="The radiobuttons tag">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-jsp-formtaglib-radiobuttonstag"></a>The radiobuttons tag</h4>
       </div>
      </div>
     </div> 
     <p>This tag renders multiple HTML <span class="emphasis"><em>input</em></span> tags with type <span class="emphasis"><em>radio</em></span>.</p> 
     <p>Just like the <code class="literal">checkboxes</code> tag above, you might want to pass in the available options as a runtime variable. For this usage you would use the <code class="literal">radiobuttons</code> tag. You pass in an <code class="literal">Array</code>, a <code class="literal">List</code> or a <code class="literal">Map</code> containing the available options in the &quot;items&quot; property. In the case where you use a Map, the map entry key will be used as the value and the map entrys value will be used as the label to be displayed. You can also use a custom object where you can provide the property names for the value using &quot;itemValue&quot; and the label using &quot;itemLabel&quot;.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;tr&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span>Sex:<span class="hl-tag">&lt;/td&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;form:radiobuttons</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;sex&quot;</span> <span class="hl-attribute">items</span>=<span class="hl-value">&quot;${sexOptions}&quot;</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
<span class="hl-tag">&lt;/tr&gt;</span></pre> 
    </div> 
    <div class="section" title="The password tag">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-jsp-formtaglib-passwordtag"></a>The password tag</h4>
       </div>
      </div>
     </div> 
     <p>This tag renders an HTML <span class="emphasis"><em>input</em></span> tag with type <span class="emphasis"><em>password</em></span> using the bound value.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;tr&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span>Password:<span class="hl-tag">&lt;/td&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span>
        <span class="hl-tag">&lt;form:password</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;password&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/td&gt;</span>
<span class="hl-tag">&lt;/tr&gt;</span></pre> 
     <p>Please note that by default, the password value is <span class="emphasis"><em>not</em></span> shown. If you do want the password value to be shown, then set the value of the <code class="literal">'showPassword'</code> attribute to true, like so.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;tr&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span>Password:<span class="hl-tag">&lt;/td&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span>
        <span class="hl-tag">&lt;form:password</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;password&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;^76525bvHGq&quot;</span> <span class="hl-attribute">showPassword</span>=<span class="hl-value">&quot;true&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/td&gt;</span>
<span class="hl-tag">&lt;/tr&gt;</span></pre> 
    </div> 
    <div class="section" title="The select tag">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-jsp-formtaglib-selecttag"></a>The select tag</h4>
       </div>
      </div>
     </div> 
     <p>This tag renders an HTML <span class="emphasis"><em>select</em></span> element. It supports data binding to the selected option as well as the use of nested <code class="literal">option</code> and <code class="literal">options</code> tags.</p> 
     <p>Lets assume a <code class="literal">User</code> has a list of skills.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;tr&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span>Skills:<span class="hl-tag">&lt;/td&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;form:select</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;skills&quot;</span> <span class="hl-attribute">items</span>=<span class="hl-value">&quot;${skills}&quot;</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
<span class="hl-tag">&lt;/tr&gt;</span></pre> 
     <p>If the <code class="literal">User's</code> skill were in Herbology, the HTML source of the <span class="emphasis"><em>Skills</em></span> row would look like:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;tr&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span>Skills:<span class="hl-tag">&lt;/td&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span>
        <span class="hl-tag">&lt;select</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;skills&quot;</span> <span class="hl-attribute">multiple</span>=<span class="hl-value">&quot;true&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;option</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Potions&quot;</span><span class="hl-tag">&gt;</span>Potions<span class="hl-tag">&lt;/option&gt;</span>
            <span class="hl-tag">&lt;option</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Herbology&quot;</span> <span class="hl-attribute">selected</span>=<span class="hl-value">&quot;selected&quot;</span><span class="hl-tag">&gt;</span>Herbology<span class="hl-tag">&lt;/option&gt;</span>
            <span class="hl-tag">&lt;option</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Quidditch&quot;</span><span class="hl-tag">&gt;</span>Quidditch<span class="hl-tag">&lt;/option&gt;</span>
        <span class="hl-tag">&lt;/select&gt;</span>
    <span class="hl-tag">&lt;/td&gt;</span>
<span class="hl-tag">&lt;/tr&gt;</span></pre> 
    </div> 
    <div class="section" title="The option tag">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-jsp-formtaglib-optiontag"></a>The option tag</h4>
       </div>
      </div>
     </div> 
     <p>This tag renders an HTML <span class="emphasis"><em>option</em></span>. It sets <span class="emphasis"><em>selected</em></span> as appropriate based on the bound value.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;tr&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span>House:<span class="hl-tag">&lt;/td&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span>
        <span class="hl-tag">&lt;form:select</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;house&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;form:option</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Gryffindor&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;form:option</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Hufflepuff&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;form:option</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Ravenclaw&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;form:option</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Slytherin&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/form:select&gt;</span>
    <span class="hl-tag">&lt;/td&gt;</span>
<span class="hl-tag">&lt;/tr&gt;</span></pre> 
     <p>If the <code class="literal">User's</code> house was in Gryffindor, the HTML source of the <span class="emphasis"><em>House</em></span> row would look like:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;tr&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span>House:<span class="hl-tag">&lt;/td&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span>
        <span class="hl-tag">&lt;select</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;house&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;option</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Gryffindor&quot;</span> <span class="hl-attribute">selected</span>=<span class="hl-value">&quot;selected&quot;</span><span class="hl-tag">&gt;</span>Gryffindor<span class="hl-tag">&lt;/option&gt;</span>
            <span class="hl-tag">&lt;option</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Hufflepuff&quot;</span><span class="hl-tag">&gt;</span>Hufflepuff<span class="hl-tag">&lt;/option&gt;</span>
            <span class="hl-tag">&lt;option</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Ravenclaw&quot;</span><span class="hl-tag">&gt;</span>Ravenclaw<span class="hl-tag">&lt;/option&gt;</span>
            <span class="hl-tag">&lt;option</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Slytherin&quot;</span><span class="hl-tag">&gt;</span>Slytherin<span class="hl-tag">&lt;/option&gt;</span>
        <span class="hl-tag">&lt;/select&gt;</span>
    <span class="hl-tag">&lt;/td&gt;</span>
<span class="hl-tag">&lt;/tr&gt;</span></pre> 
    </div> 
    <div class="section" title="The options tag">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-jsp-formtaglib-optionstag"></a>The options tag</h4>
       </div>
      </div>
     </div> 
     <p>This tag renders a list of HTML <span class="emphasis"><em>option</em></span> tags. It sets the <span class="emphasis"><em>selected</em></span> attribute as appropriate based on the bound value.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;tr&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span>Country:<span class="hl-tag">&lt;/td&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span>
        <span class="hl-tag">&lt;form:select</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;country&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;form:option</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;-&quot;</span> <span class="hl-attribute">label</span>=<span class="hl-value">&quot;--Please Select&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;form:options</span> <span class="hl-attribute">items</span>=<span class="hl-value">&quot;${countryList}&quot;</span> <span class="hl-attribute">itemValue</span>=<span class="hl-value">&quot;code&quot;</span> <span class="hl-attribute">itemLabel</span>=<span class="hl-value">&quot;name&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/form:select&gt;</span>
    <span class="hl-tag">&lt;/td&gt;</span>
<span class="hl-tag">&lt;/tr&gt;</span></pre> 
     <p>If the <code class="literal">User</code> lived in the UK, the HTML source of the <span class="emphasis"><em>Country</em></span> row would look like:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;tr&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span>Country:<span class="hl-tag">&lt;/td&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span>
        <span class="hl-tag">&lt;select</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;country&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;option</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;-&quot;</span><span class="hl-tag">&gt;</span>--Please Select<span class="hl-tag">&lt;/option&gt;</span>
            <span class="hl-tag">&lt;option</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;AT&quot;</span><span class="hl-tag">&gt;</span>Austria<span class="hl-tag">&lt;/option&gt;</span>
            <span class="hl-tag">&lt;option</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;UK&quot;</span> <span class="hl-attribute">selected</span>=<span class="hl-value">&quot;selected&quot;</span><span class="hl-tag">&gt;</span>United Kingdom<span class="hl-tag">&lt;/option&gt;</span>
            <span class="hl-tag">&lt;option</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;US&quot;</span><span class="hl-tag">&gt;</span>United States<span class="hl-tag">&lt;/option&gt;</span>
        <span class="hl-tag">&lt;/select&gt;</span>
    <span class="hl-tag">&lt;/td&gt;</span>
<span class="hl-tag">&lt;/tr&gt;</span></pre> 
     <p>As the example shows, the combined usage of an <code class="literal">option</code> tag with the <code class="literal">options</code> tag generates the same standard HTML, but allows you to explicitly specify a value in the JSP that is for display only (where it belongs) such as the default string in the example: &quot;-- Please Select&quot;.</p> 
     <p>The <code class="literal">items</code> attribute is typically populated with a collection or array of item objects. <code class="literal">itemValue</code> and <code class="literal">itemLabel</code> simply refer to bean properties of those item objects, if specified; otherwise, the item objects themselves will be stringified. Alternatively, you may specify a <code class="literal">Map</code> of items, in which case the map keys are interpreted as option values and the map values correspond to option labels. If <code class="literal">itemValue</code> and/or <code class="literal">itemLabel</code> happen to be specified as well, the item value property will apply to the map key and the item label property will apply to the map value.</p> 
    </div> 
    <div class="section" title="The textarea tag">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-jsp-formtaglib-textAreatag"></a>The textarea tag</h4>
       </div>
      </div>
     </div> 
     <p>This tag renders an HTML <span class="emphasis"><em>textarea</em></span>.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;tr&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span>Notes:<span class="hl-tag">&lt;/td&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;form:textarea</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;notes&quot;</span> <span class="hl-attribute">rows</span>=<span class="hl-value">&quot;3&quot;</span> <span class="hl-attribute">cols</span>=<span class="hl-value">&quot;20&quot;</span><span class="hl-tag"> /&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
    <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;form:errors</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;notes&quot;</span><span class="hl-tag"> /&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
<span class="hl-tag">&lt;/tr&gt;</span></pre> 
    </div> 
    <div class="section" title="The hidden tag">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-jsp-formtaglib-hiddeninputtag"></a>The hidden tag</h4>
       </div>
      </div>
     </div> 
     <p>This tag renders an HTML <span class="emphasis"><em>input</em></span> tag with type <span class="emphasis"><em>hidden</em></span> using the bound value. To submit an unbound hidden value, use the HTML <code class="literal">input</code> tag with type <span class="emphasis"><em>hidden</em></span>.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;form:hidden</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;house&quot;</span><span class="hl-tag"> /&gt;</span>

</pre> 
     <p>If we choose to submit the <span class="emphasis"><em>house</em></span> value as a hidden one, the HTML would look like:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;house&quot;</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;hidden&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Gryffindor&quot;</span><span class="hl-tag">/&gt;</span>

</pre> 
    </div> 
    <div class="section" title="The errors tag">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-jsp-formtaglib-errorstag"></a>The errors tag</h4>
       </div>
      </div>
     </div> 
     <p>This tag renders field errors in an HTML <span class="emphasis"><em>span</em></span> tag. It provides access to the errors created in your controller or those that were created by any validators associated with your controller.</p> 
     <p>Lets assume we want to display all error messages for the <code class="literal">firstName</code> and <code class="literal">lastName</code> fields once we submit the form. We have a validator for instances of the <code class="literal">User</code> class called <code class="literal">UserValidator</code>.</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> UserValidator <span class="hl-keyword">implements</span> Validator {

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> supports(Class candidate) {
        <span class="hl-keyword">return</span> User.<span class="hl-keyword">class</span>.isAssignableFrom(candidate);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validate(Object obj, Errors errors) {
        ValidationUtils.rejectIfEmptyOrWhitespace(errors, <span class="hl-string">&quot;firstName&quot;</span>, <span class="hl-string">&quot;required&quot;</span>, <span class="hl-string">&quot;Field is required.&quot;</span>);
        ValidationUtils.rejectIfEmptyOrWhitespace(errors, <span class="hl-string">&quot;lastName&quot;</span>, <span class="hl-string">&quot;required&quot;</span>, <span class="hl-string">&quot;Field is required.&quot;</span>);
    }
}</pre> 
     <p>The <code class="literal">form.jsp</code> would look like:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;form:form&gt;</span>
    <span class="hl-tag">&lt;table&gt;</span>
        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span>First Name:<span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;form:input</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;firstName&quot;</span><span class="hl-tag"> /&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;%--</span> <span class="hl-attribute">Show</span> <span class="hl-attribute">errors</span> <span class="hl-attribute">for</span> <span class="hl-attribute">firstName</span> <span class="hl-attribute">field</span> <span class="hl-attribute">--%&gt;</span>
            <span class="hl-attribute">&lt;td&gt;&lt;form:errors</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;firstName&quot;</span><span class="hl-tag"> /&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>

        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span>Last Name:<span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;form:input</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;lastName&quot;</span><span class="hl-tag"> /&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;%--</span> <span class="hl-attribute">Show</span> <span class="hl-attribute">errors</span> <span class="hl-attribute">for</span> <span class="hl-attribute">lastName</span> <span class="hl-attribute">field</span> <span class="hl-attribute">--%&gt;</span>
            <span class="hl-attribute">&lt;td&gt;&lt;form:errors</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;lastName&quot;</span><span class="hl-tag"> /&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>
        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td</span> <span class="hl-attribute">colspan</span>=<span class="hl-value">&quot;3&quot;</span><span class="hl-tag">&gt;</span>
                <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;submit&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Save Changes&quot;</span><span class="hl-tag"> /&gt;</span>
            <span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>
    <span class="hl-tag">&lt;/table&gt;</span>
<span class="hl-tag">&lt;/form:form&gt;</span></pre> 
     <p>If we submit a form with empty values in the <code class="literal">firstName</code> and <code class="literal">lastName</code> fields, this is what the HTML would look like:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;form</span> <span class="hl-attribute">method</span>=<span class="hl-value">&quot;POST&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;table&gt;</span>
        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span>First Name:<span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;firstName&quot;</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;text&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;&quot;</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;%--</span> <span class="hl-attribute">Associated</span> <span class="hl-attribute">errors</span> <span class="hl-attribute">to</span> <span class="hl-attribute">firstName</span> <span class="hl-attribute">field</span> <span class="hl-attribute">displayed</span> <span class="hl-attribute">--%&gt;</span>
            <span class="hl-attribute">&lt;td&gt;&lt;span</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;firstName.errors&quot;</span><span class="hl-tag">&gt;</span>Field is required.<span class="hl-tag">&lt;/span&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>

        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span>Last Name:<span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;lastName&quot;</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;text&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;&quot;</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;%--</span> <span class="hl-attribute">Associated</span> <span class="hl-attribute">errors</span> <span class="hl-attribute">to</span> <span class="hl-attribute">lastName</span> <span class="hl-attribute">field</span> <span class="hl-attribute">displayed</span> <span class="hl-attribute">--%&gt;</span>
            <span class="hl-attribute">&lt;td&gt;&lt;span</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;lastName.errors&quot;</span><span class="hl-tag">&gt;</span>Field is required.<span class="hl-tag">&lt;/span&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>
        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td</span> <span class="hl-attribute">colspan</span>=<span class="hl-value">&quot;3&quot;</span><span class="hl-tag">&gt;</span>
                <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;submit&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Save Changes&quot;</span><span class="hl-tag"> /&gt;</span>
            <span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>
    <span class="hl-tag">&lt;/table&gt;</span>
<span class="hl-tag">&lt;/form&gt;</span></pre> 
     <p>What if we want to display the entire list of errors for a given page? The example below shows that the <code class="literal">errors</code> tag also supports some basic wildcarding functionality.</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> <code class="literal">path=&quot;*&quot;</code> - displays all errors </li>
       <li class="listitem"> <code class="literal">path=&quot;lastName&quot;</code> - displays all errors associated with the <code class="literal">lastName</code> field </li>
       <li class="listitem"> if <code class="literal">path</code> is omitted - object errors only are displayed </li>
      </ul>
     </div> 
     <p>The example below will display a list of errors at the top of the page, followed by field-specific errors next to the fields:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;form:form&gt;</span>
    <span class="hl-tag">&lt;form:errors</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;*&quot;</span> <span class="hl-attribute">cssClass</span>=<span class="hl-value">&quot;errorBox&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;table&gt;</span>
        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span>First Name:<span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;form:input</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;firstName&quot;</span><span class="hl-tag"> /&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;form:errors</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;firstName&quot;</span><span class="hl-tag"> /&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>
        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span>Last Name:<span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;form:input</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;lastName&quot;</span><span class="hl-tag"> /&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;form:errors</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;lastName&quot;</span><span class="hl-tag"> /&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>
        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td</span> <span class="hl-attribute">colspan</span>=<span class="hl-value">&quot;3&quot;</span><span class="hl-tag">&gt;</span>
                <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;submit&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Save Changes&quot;</span><span class="hl-tag"> /&gt;</span>
            <span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>
    <span class="hl-tag">&lt;/table&gt;</span>
<span class="hl-tag">&lt;/form:form&gt;</span></pre> 
     <p>The HTML would look like:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;form</span> <span class="hl-attribute">method</span>=<span class="hl-value">&quot;POST&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;span</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;*.errors&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;errorBox&quot;</span><span class="hl-tag">&gt;</span>Field is required.<span class="hl-tag">&lt;br/&gt;</span>Field is required.<span class="hl-tag">&lt;/span&gt;</span>
    <span class="hl-tag">&lt;table&gt;</span>
        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span>First Name:<span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;firstName&quot;</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;text&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;&quot;</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;span</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;firstName.errors&quot;</span><span class="hl-tag">&gt;</span>Field is required.<span class="hl-tag">&lt;/span&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>

        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span>Last Name:<span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;input</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;lastName&quot;</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;text&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;&quot;</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
            <span class="hl-tag">&lt;td&gt;</span><span class="hl-tag">&lt;span</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;lastName.errors&quot;</span><span class="hl-tag">&gt;</span>Field is required.<span class="hl-tag">&lt;/span&gt;</span><span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>
        <span class="hl-tag">&lt;tr&gt;</span>
            <span class="hl-tag">&lt;td</span> <span class="hl-attribute">colspan</span>=<span class="hl-value">&quot;3&quot;</span><span class="hl-tag">&gt;</span>
                <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;submit&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Save Changes&quot;</span><span class="hl-tag"> /&gt;</span>
            <span class="hl-tag">&lt;/td&gt;</span>
        <span class="hl-tag">&lt;/tr&gt;</span>
<span class="hl-tag">&lt;/form&gt;</span></pre> 
    </div> 
    <div class="section" title="HTTP Method Conversion">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="rest-method-conversion"></a>HTTP Method Conversion</h4>
       </div>
      </div>
     </div> 
     <p>A key principle of REST is the use of the Uniform Interface. This means that all resources (URLs) can be manipulated using the same four HTTP methods: GET, PUT, POST, and DELETE. For each method, the HTTP specification defines the exact semantics. For instance, a GET should always be a safe operation, meaning that is has no side effects, and a PUT or DELETE should be idempotent, meaning that you can repeat these operations over and over again, but the end result should be the same. While HTTP defines these four methods, HTML only supports two: GET and POST. Fortunately, there are two possible workarounds: you can either use JavaScript to do your PUT or DELETE, or simply do a POST with the <span class="emphasis"><em>real</em></span> method as an additional parameter (modeled as a hidden input field in an HTML form). This latter trick is what Springs <code class="literal">HiddenHttpMethodFilter</code> does. This filter is a plain Servlet Filter and therefore it can be used in combination with any web framework (not just Spring MVC). Simply add this filter to your web.xml, and a POST with a hidden _method parameter will be converted into the corresponding HTTP method request.</p> 
     <p>To support HTTP method conversion the Spring MVC form tag was updated to support setting the HTTP method. For example, the following snippet taken from the updated Petclinic sample</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;form:form</span> <span class="hl-attribute">method</span>=<span class="hl-value">&quot;delete&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;p</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;submit&quot;</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;submit&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Delete Pet&quot;</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/p&gt;</span>
<span class="hl-tag">&lt;/form:form&gt;</span></pre> 
     <p>This will actually perform an HTTP POST, with the <span class="emphasis"><em>real</em></span> DELETE method hidden behind a request parameter, to be picked up by the <code class="literal">HiddenHttpMethodFilter</code>, as defined in web.xml:</p> 
     <pre class="programlisting">&lt;filter&gt;
    &lt;filter-name&gt;httpMethodFilter&lt;/filter-name&gt;
    &lt;filter-<span class="hl-keyword">class</span>&gt;org.springframework.web.filter.HiddenHttpMethodFilter&lt;/filter-<span class="hl-keyword">class</span>&gt;
&lt;/filter&gt;

&lt;filter-mapping&gt;
    &lt;filter-name&gt;httpMethodFilter&lt;/filter-name&gt;
    &lt;servlet-name&gt;petclinic&lt;/servlet-name&gt;
&lt;/filter-mapping&gt;</pre> 
     <p>The corresponding @Controller method is shown below:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RequestMapping(method = RequestMethod.DELETE)</span></i>
<span class="hl-keyword">public</span> String deletePet(<i><span class="hl-annotation" style="color: gray">@PathVariable</span></i> <span class="hl-keyword">int</span> ownerId, <i><span class="hl-annotation" style="color: gray">@PathVariable</span></i> <span class="hl-keyword">int</span> petId) {
    <span class="hl-keyword">this</span>.clinic.deletePet(petId);
    <span class="hl-keyword">return</span> <span class="hl-string">&quot;redirect:/owners/&quot;</span> + ownerId;
}</pre> 
    </div> 
    <div class="section" title="HTML5 Tags">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-jsp-formtaglib-html5"></a>HTML5 Tags</h4>
       </div>
      </div>
     </div> 
     <p>Starting with Spring 3, the Spring form tag library allows entering dynamic attributes, which means you can enter any HTML5 specific attributes.</p> 
     <p>In Spring 3.1, the form input tag supports entering a type attribute other than <span class="emphasis"><em>text</em></span>. This is intended to allow rendering new HTML5 specific input types such as <span class="emphasis"><em>email</em></span>, <span class="emphasis"><em>date</em></span>, <span class="emphasis"><em>range</em></span>, and others. Note that entering type=<span class="emphasis"><em>text</em></span> is not required since <span class="emphasis"><em>text</em></span> is the default type.</p> 
    </div> 
   </div> 
  </div> 
  <div class="section" title="17.3&nbsp;Tiles">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="view-tiles"></a>17.3&nbsp;Tiles</h2>
     </div>
    </div>
   </div> 
   <p>It is possible to integrate Tiles - just as any other view technology - in web applications using Spring. The following describes in a broad way how to do this.</p> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>This section focuses on Springs support for Tiles v3 in the <code class="literal">org.springframework.web.servlet.view.tiles3</code> package. Tiles v1 (a.k.a. &quot;Struts Tiles&quot;) as well as Tiles v2 are no longer supported by Spring.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <div class="section" title="17.3.1&nbsp;Dependencies">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="view-tiles-dependencies"></a>17.3.1&nbsp;Dependencies</h3>
      </div>
     </div>
    </div> 
    <p>To be able to use Tiles you have to have a couple of additional dependencies included in your project. The following is the list of dependencies you need.</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> <code class="literal">Tiles version 2.1.2 or higher</code> </li>
      <li class="listitem"> <code class="literal">Commons BeanUtils</code> </li>
      <li class="listitem"> <code class="literal">Commons Digester</code> </li>
      <li class="listitem"> <code class="literal">Commons Logging</code> </li>
     </ul>
    </div> 
   </div> 
   <div class="section" title="17.3.2&nbsp;How to integrate Tiles">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="view-tiles-integrate"></a>17.3.2&nbsp;How to integrate Tiles</h3>
      </div>
     </div>
    </div> 
    <p>To be able to use Tiles, you have to configure it using files containing definitions (for basic information on definitions and other Tiles concepts, please have a look at <a class="ulink" href="http://tiles.apache.org/" target="_top">http://tiles.apache.org</a>). In Spring this is done using the <code class="literal">TilesConfigurer</code>. Have a look at the following piece of example ApplicationContext configuration:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;tilesConfigurer&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.tiles2.TilesConfigurer&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;definitions&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>/WEB-INF/defs/general.xml<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>/WEB-INF/defs/widgets.xml<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>/WEB-INF/defs/administrator.xml<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>/WEB-INF/defs/customer.xml<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>/WEB-INF/defs/templates.xml<span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>As you can see, there are five files containing definitions, which are all located in the <code class="literal">'WEB-INF/defs'</code> directory. At initialization of the <code class="literal">WebApplicationContext</code>, the files will be loaded and the definitions factory will be initialized. After that has been done, the Tiles includes in the definition files can be used as views within your Spring web application. To be able to use the views you have to have a <code class="literal">ViewResolver</code> just as with any other view technology used with Spring. Below you can find two possibilities, the <code class="literal">UrlBasedViewResolver</code> and the <code class="literal">ResourceBundleViewResolver</code>.</p> 
    <div class="section" title="UrlBasedViewResolver">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-tiles-url"></a>UrlBasedViewResolver</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">UrlBasedViewResolver</code> instantiates the given <code class="literal">viewClass</code> for each view it has to resolve.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;viewResolver&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.UrlBasedViewResolver&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;viewClass&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.tiles2.TilesView&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    </div> 
    <div class="section" title="ResourceBundleViewResolver">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-tiles-resource"></a>ResourceBundleViewResolver</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">ResourceBundleViewResolver</code> has to be provided with a property file containing viewnames and viewclasses the resolver can use:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;viewResolver&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.ResourceBundleViewResolver&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;basename&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;views&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
     <pre class="programlisting">...
welcomeView.(<span class="hl-keyword">class</span>)=org.springframework.web.servlet.view.tiles2.TilesView
welcomeView.url=welcome (<span class="hl-keyword">this</span> is the name of a Tiles definition)

vetsView.(<span class="hl-keyword">class</span>)=org.springframework.web.servlet.view.tiles2.TilesView
vetsView.url=vetsView (again, <span class="hl-keyword">this</span> is the name of a Tiles definition)

findOwnersForm.(<span class="hl-keyword">class</span>)=org.springframework.web.servlet.view.JstlView
findOwnersForm.url=/WEB-INF/jsp/findOwners.jsp
...</pre> 
     <p>As you can see, when using the <code class="literal">ResourceBundleViewResolver</code>, you can easily mix different view technologies.</p> 
     <p>Note that the <code class="literal">TilesView</code> class supports JSTL (the JSP Standard Tag Library) out of the box.</p> 
    </div> 
    <div class="section" title="SimpleSpringPreparerFactory and SpringBeanPreparerFactory">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-tiles-preparer"></a>SimpleSpringPreparerFactory and SpringBeanPreparerFactory</h4>
       </div>
      </div>
     </div> 
     <p>As an advanced feature, Spring also supports two special Tiles <code class="literal">PreparerFactory</code> implementations. Check out the Tiles documentation for details on how to use <code class="literal">ViewPreparer</code> references in your Tiles definition files.</p> 
     <p>Specify <code class="literal">SimpleSpringPreparerFactory</code> to autowire ViewPreparer instances based on specified preparer classes, applying Springs container callbacks as well as applying configured Spring BeanPostProcessors. If Springs context-wide annotation-config has been activated, annotations in ViewPreparer classes will be automatically detected and applied. Note that this expects preparer <span class="emphasis"><em>classes</em></span> in the Tiles definition files, just like the default <code class="literal">PreparerFactory</code> does.</p> 
     <p>Specify <code class="literal">SpringBeanPreparerFactory</code> to operate on specified preparer <span class="emphasis"><em>names</em></span> instead of classes, obtaining the corresponding Spring bean from the DispatcherServlets application context. The full bean creation process will be in the control of the Spring application context in this case, allowing for the use of explicit dependency injection configuration, scoped beans etc. Note that you need to define one Spring bean definition per preparer name (as used in your Tiles definitions).</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;tilesConfigurer&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.tiles2.TilesConfigurer&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;definitions&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>/WEB-INF/defs/general.xml<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>/WEB-INF/defs/widgets.xml<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>/WEB-INF/defs/administrator.xml<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>/WEB-INF/defs/customer.xml<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>/WEB-INF/defs/templates.xml<span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>

    <span class="hl-comment">&lt;!-- resolving preparer names as Spring bean definition names --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;preparerFactoryClass&quot;</span>
            <span class="hl-attribute">value</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.tiles2.SpringBeanPreparerFactory&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    </div> 
   </div> 
  </div> 
  <div class="section" title="17.4&nbsp;Velocity &amp; FreeMarker">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="view-velocity"></a>17.4&nbsp;Velocity &amp; FreeMarker</h2>
     </div>
    </div>
   </div> 
   <p><a class="ulink" href="http://velocity.apache.org/" target="_top">Velocity</a> and <a class="ulink" href="http://www.freemarker.org/" target="_top">FreeMarker</a> are two templating languages that can be used as view technologies within Spring MVC applications. The languages are quite similar and serve similar needs and so are considered together in this section. For semantic and syntactic differences between the two languages, see the <a class="ulink" href="http://www.freemarker.org/" target="_top">FreeMarker</a> web site.</p> 
   <div class="section" title="17.4.1&nbsp;Dependencies">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="view-velocity-dependencies"></a>17.4.1&nbsp;Dependencies</h3>
      </div>
     </div>
    </div> 
    <p>Your web application will need to include <code class="literal">velocity-1.x.x.jar</code> or <code class="literal">freemarker-2.x.jar</code> in order to work with Velocity or FreeMarker respectively and <code class="literal">commons-collections.jar</code> is required for Velocity. Typically they are included in the <code class="literal">WEB-INF/lib</code> folder where they are guaranteed to be found by a Java EE server and added to the classpath for your application. It is of course assumed that you already have the <code class="literal">spring-webmvc.jar</code> in your <code class="literal">'WEB-INF/lib'</code> directory too! If you make use of Springs <span class="emphasis"><em>dateToolAttribute</em></span> or <span class="emphasis"><em>numberToolAttribute</em></span> in your Velocity views, you will also need to include the <code class="literal">velocity-tools-generic-1.x.jar</code></p> 
   </div> 
   <div class="section" title="17.4.2&nbsp;Context configuration">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="view-velocity-contextconfig"></a>17.4.2&nbsp;Context configuration</h3>
      </div>
     </div>
    </div> 
    <p>A suitable configuration is initialized by adding the relevant configurer bean definition to your <code class="literal">'*-servlet.xml'</code> as shown below:</p> 
    <pre class="programlisting"><span class="hl-comment">&lt;!--
This bean sets up the Velocity environment for us based on a root path for templates.
Optionally, a properties file can be specified for more control over the Velocity
environment, but the defaults are pretty sane for file based template loading.
--&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;velocityConfig&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.velocity.VelocityConfigurer&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;resourceLoaderPath&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;/WEB-INF/velocity/&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-comment">&lt;!--
View resolvers can also be configured with ResourceBundles or XML files. If you need
different view resolving based on Locale, you have to use the resource bundle resolver.
--&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;viewResolver&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.velocity.VelocityViewResolver&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;cache&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;true&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;prefix&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;suffix&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;.vm&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <pre class="programlisting"><span class="hl-comment">&lt;!-- freemarker config --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;freemarkerConfig&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;templateLoaderPath&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;/WEB-INF/freemarker/&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-comment">&lt;!--
View resolvers can also be configured with ResourceBundles or XML files. If you need
different view resolving based on Locale, you have to use the resource bundle resolver.
--&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;viewResolver&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerViewResolver&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;cache&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;true&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;prefix&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;suffix&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;.ftl&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>For non web-apps add a <code class="literal">VelocityConfigurationFactoryBean</code> or a <code class="literal">FreeMarkerConfigurationFactoryBean</code> to your application context definition file.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="17.4.3&nbsp;Creating templates">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="view-velocity-createtemplates"></a>17.4.3&nbsp;Creating templates</h3>
      </div>
     </div>
    </div> 
    <p>Your templates need to be stored in the directory specified by the <code class="literal">*Configurer</code> bean shown above. This document does not cover details of creating templates for the two languages - please see their relevant websites for information. If you use the view resolvers highlighted, then the logical view names relate to the template file names in similar fashion to <code class="literal">InternalResourceViewResolver</code> for JSPs. So if your controller returns a ModelAndView object containing a view name of &quot;welcome&quot; then the resolvers will look for the <code class="literal">/WEB-INF/freemarker/welcome.ftl</code> or <code class="literal">/WEB-INF/velocity/welcome.vm</code> template as appropriate.</p> 
   </div> 
   <div class="section" title="17.4.4&nbsp;Advanced configuration">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="view-velocity-advancedconfig"></a>17.4.4&nbsp;Advanced configuration</h3>
      </div>
     </div>
    </div> 
    <p>The basic configurations highlighted above will be suitable for most application requirements, however additional configuration options are available for when unusual or advanced requirements dictate.</p> 
    <div class="section" title="velocity.properties">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-velocity-example-velocityproperties"></a>velocity.properties</h4>
       </div>
      </div>
     </div> 
     <p>This file is completely optional, but if specified, contains the values that are passed to the Velocity runtime in order to configure velocity itself. Only required for advanced configurations, if you need this file, specify its location on the <code class="literal">VelocityConfigurer</code> bean definition above.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;velocityConfig&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.velocity.VelocityConfigurer&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;configLocation&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;/WEB-INF/velocity.properties&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
     <p>Alternatively, you can specify velocity properties directly in the bean definition for the Velocity config bean by replacing the &quot;configLocation&quot; property with the following inline properties.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;velocityConfig&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.velocity.VelocityConfigurer&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;velocityProperties&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;props&gt;</span>
            <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;resource.loader&quot;</span><span class="hl-tag">&gt;</span>file<span class="hl-tag">&lt;/prop&gt;</span>
            <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;file.resource.loader.class&quot;</span><span class="hl-tag">&gt;</span>
                org.apache.velocity.runtime.resource.loader.FileResourceLoader
            <span class="hl-tag">&lt;/prop&gt;</span>
            <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;file.resource.loader.path&quot;</span><span class="hl-tag">&gt;</span>${webapp.root}/WEB-INF/velocity<span class="hl-tag">&lt;/prop&gt;</span>
            <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;file.resource.loader.cache&quot;</span><span class="hl-tag">&gt;</span>false<span class="hl-tag">&lt;/prop&gt;</span>
        <span class="hl-tag">&lt;/props&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
     <p>Refer to the <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/ui/velocity/VelocityEngineFactory.html" target="_top">API documentation</a> for Spring configuration of Velocity, or the Velocity documentation for examples and definitions of the <code class="literal">'velocity.properties'</code> file itself.</p> 
    </div> 
    <div class="section" title="FreeMarker">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="views-freemarker"></a>FreeMarker</h4>
       </div>
      </div>
     </div> 
     <p>FreeMarker <span class="emphasis"><em>Settings</em></span> and <span class="emphasis"><em>SharedVariables</em></span> can be passed directly to the FreeMarker <code class="literal">Configuration</code> object managed by Spring by setting the appropriate bean properties on the <code class="literal">FreeMarkerConfigurer</code> bean. The <code class="literal">freemarkerSettings</code> property requires a <code class="literal">java.util.Properties</code> object and the <code class="literal">freemarkerVariables</code> property requires a <code class="literal">java.util.Map</code>.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;freemarkerConfig&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;templateLoaderPath&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;/WEB-INF/freemarker/&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;freemarkerVariables&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;map&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;xml_escape&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;fmXmlEscape&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/map&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;fmXmlEscape&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;freemarker.template.utility.XmlEscape&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <p>See the FreeMarker documentation for details of settings and variables as they apply to the <code class="literal">Configuration</code> object.</p> 
    </div> 
   </div> 
   <div class="section" title="17.4.5&nbsp;Bind support and form handling">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="view-velocity-forms"></a>17.4.5&nbsp;Bind support and form handling</h3>
      </div>
     </div>
    </div> 
    <p>Spring provides a tag library for use in JSPs that contains (amongst other things) a <code class="literal">&lt;spring:bind/&gt;</code> tag. This tag primarily enables forms to display values from form backing objects and to show the results of failed validations from a <code class="literal">Validator</code> in the web or business tier. From version 1.1, Spring now has support for the same functionality in both Velocity and FreeMarker, with additional convenience macros for generating form input elements themselves.</p> 
    <div class="section" title="The bind macros">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-bind-macros"></a>The bind macros</h4>
       </div>
      </div>
     </div> 
     <p>A standard set of macros are maintained within the <code class="literal">spring-webmvc.jar</code> file for both languages, so they are always available to a suitably configured application.</p> 
     <p>Some of the macros defined in the Spring libraries are considered internal (private) but no such scoping exists in the macro definitions making all macros visible to calling code and user templates. The following sections concentrate only on the macros you need to be directly calling from within your templates. If you wish to view the macro code directly, the files are called spring.vm / spring.ftl and are in the packages <code class="literal">org.springframework.web.servlet.view.velocity</code> or <code class="literal">org.springframework.web.servlet.view.freemarker</code> respectively.</p> 
    </div> 
    <div class="section" title="Simple binding">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-simple-binding"></a>Simple binding</h4>
       </div>
      </div>
     </div> 
     <p>In your html forms (vm / ftl templates) that act as the <span class="emphasis"><em>formView</em></span> for a Spring form controller, you can use code similar to the following to bind to field values and display error messages for each input field in similar fashion to the JSP equivalent. Note that the name of the command object is &quot;command&quot; by default, but can be overridden in your MVC configuration by setting the <span class="emphasis"><em>commandName</em></span> bean property on your form controller. Example code is shown below for the <code class="literal">personFormV</code> and <code class="literal">personFormF</code> views configured earlier;</p> 
     <pre class="programlisting"><span class="hl-comment">&lt;!-- velocity macros are automatically available --&gt;</span>
<span class="hl-tag">&lt;html&gt;</span>
    ...
    <span class="hl-tag">&lt;form</span> <span class="hl-attribute">action</span>=<span class="hl-value">&quot;&quot;</span> <span class="hl-attribute">method</span>=<span class="hl-value">&quot;POST&quot;</span><span class="hl-tag">&gt;</span>
        Name:
        #springBind( &quot;command.name&quot; )
        <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;text&quot;</span>
            <span class="hl-attribute">name</span>=<span class="hl-value">&quot;${status.expression}&quot;</span>
            <span class="hl-attribute">value</span>=<span class="hl-value">&quot;$!status.value&quot;</span><span class="hl-tag"> /&gt;</span><span class="hl-tag">&lt;br&gt;</span>
        #foreach($error in $status.errorMessages) <span class="hl-tag">&lt;b&gt;</span>$error<span class="hl-tag">&lt;/b&gt;</span> <span class="hl-tag">&lt;br&gt;</span> #end
        <span class="hl-tag">&lt;br&gt;</span>
        ...
        <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;submit&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;submit&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/form&gt;</span>
    ...
<span class="hl-tag">&lt;/html&gt;</span></pre> 
     <pre class="programlisting"><span class="hl-comment">&lt;!-- freemarker macros have to be imported into a namespace. We strongly
recommend sticking to </span><span class="emphasis"><em>spring</em></span> --&gt;
<span class="hl-tag">&lt;#import</span> <span class="hl-attribute">&quot;/spring.ftl&quot;</span> <span class="hl-attribute">as</span> <span class="hl-attribute">spring</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;html&gt;</span>
    ...
    <span class="hl-tag">&lt;form</span> <span class="hl-attribute">action</span>=<span class="hl-value">&quot;&quot;</span> <span class="hl-attribute">method</span>=<span class="hl-value">&quot;POST&quot;</span><span class="hl-tag">&gt;</span>
        Name:
        <span class="hl-tag">&lt;@spring.bind</span> <span class="hl-attribute">&quot;command.name&quot;</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;text&quot;</span>
            <span class="hl-attribute">name</span>=<span class="hl-value">&quot;${spring.status.expression}&quot;</span>
            <span class="hl-attribute">value</span>=<span class="hl-value">&quot;${spring.status.value?default(&quot;</span><span class="hl-attribute">&quot;)}&quot;</span><span class="hl-tag"> /&gt;</span><span class="hl-tag">&lt;br&gt;</span>
        <span class="hl-tag">&lt;#list</span> <span class="hl-attribute">spring.status.errorMessages</span> <span class="hl-attribute">as</span> <span class="hl-attribute">error&gt;</span> <span class="hl-attribute">&lt;b&gt;${error}&lt;/b&gt;</span> <span class="hl-attribute">&lt;br&gt;</span> <span class="hl-attribute">&lt;/#list&gt;</span>
        <span class="hl-attribute">&lt;br&gt;</span>
        <span class="hl-attribute">...</span>
        <span class="hl-attribute">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;submit&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;submit&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/form&gt;</span>
    ...
<span class="hl-tag">&lt;/html&gt;</span></pre> 
     <p><code class="literal">#springBind</code> / <code class="literal">&lt;@spring.bind&gt;</code> requires a <span class="emphasis"><em>path</em></span> argument which consists of the name of your command object (it will be <span class="emphasis"><em>command</em></span> unless you changed it in your FormController properties) followed by a period and the name of the field on the command object you wish to bind to. Nested fields can be used too such as &quot;command.address.street&quot;. The <code class="literal">bind</code> macro assumes the default HTML escaping behavior specified by the ServletContext parameter <code class="literal">defaultHtmlEscape</code> in web.xml</p> 
     <p>The optional form of the macro called <code class="literal">#springBindEscaped</code> / <code class="literal">&lt;@spring.bindEscaped&gt;</code> takes a second argument and explicitly specifies whether HTML escaping should be used in the status error messages or values. Set to true or false as required. Additional form handling macros simplify the use of HTML escaping and these macros should be used wherever possible. They are explained in the next section.</p> 
    </div> 
    <div class="section" title="Form input generation macros">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="views-form-macros"></a>Form input generation macros</h4>
       </div>
      </div>
     </div> 
     <p>Additional convenience macros for both languages simplify both binding and form generation (including validation error display). It is never necessary to use these macros to generate form input fields, and they can be mixed and matched with simple HTML or calls direct to the spring bind macros highlighted previously.</p> 
     <p>The following table of available macros show the VTL and FTL definitions and the parameter list that each takes.</p> 
     <div class="table">
      <a name="views-macros-defs-tbl"></a>
      <p class="title"><b>Table&nbsp;17.1.&nbsp;Table of macro definitions</b></p>
      <div class="table-contents"> 
       <table summary="Table of macro definitions" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
        <colgroup>
         <col />
         <col />
         <col />
        </colgroup>
        <thead>
         <tr>
          <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">macro</th>
          <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">VTL definition</th>
          <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">FTL definition</th>
         </tr>
        </thead>
        <tbody>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>message</strong></span> (output a string from a resource bundle based on the code parameter)</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>#springMessage($code)</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&lt;@spring.message code/&gt;</p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>messageText</strong></span> (output a string from a resource bundle based on the code parameter, falling back to the value of the default parameter)</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>#springMessageText($code $text)</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&lt;@spring.messageText code, text/&gt;</p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>url</strong></span> (prefix a relative URL with the applications context root)</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>#springUrl($relativeUrl)</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&lt;@spring.url relativeUrl/&gt;</p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>formInput</strong></span> (standard input field for gathering user input)</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>#springFormInput($path $attributes)</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&lt;@spring.formInput path, attributes, fieldType/&gt;</p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>formHiddenInput </strong></span>* (hidden input field for submitting non-user input)</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>#springFormHiddenInput($path $attributes)</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&lt;@spring.formHiddenInput path, attributes/&gt;</p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>formPasswordInput</strong></span> * (standard input field for gathering passwords. Note that no value will ever be populated in fields of this type)</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>#springFormPasswordInput($path $attributes)</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&lt;@spring.formPasswordInput path, attributes/&gt;</p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>formTextarea</strong></span> (large text field for gathering long, freeform text input)</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>#springFormTextarea($path $attributes)</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&lt;@spring.formTextarea path, attributes/&gt;</p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>formSingleSelect</strong></span> (drop down box of options allowing a single required value to be selected)</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>#springFormSingleSelect( $path $options $attributes)</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&lt;@spring.formSingleSelect path, options, attributes/&gt;</p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>formMultiSelect</strong></span> (a list box of options allowing the user to select 0 or more values)</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>#springFormMultiSelect($path $options $attributes)</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&lt;@spring.formMultiSelect path, options, attributes/&gt;</p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>formRadioButtons</strong></span> (a set of radio buttons allowing a single selection to be made from the available choices)</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>#springFormRadioButtons($path $options $separator $attributes)</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&lt;@spring.formRadioButtons path, options separator, attributes/&gt;</p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>formCheckboxes</strong></span> (a set of checkboxes allowing 0 or more values to be selected)</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>#springFormCheckboxes($path $options $separator $attributes)</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&lt;@spring.formCheckboxes path, options, separator, attributes/&gt;</p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>formCheckbox</strong></span> (a single checkbox)</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>#springFormCheckbox($path $attributes)</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>&lt;@spring.formCheckbox path, attributes/&gt;</p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><span class="strong"><strong>showErrors</strong></span> (simplify display of validation errors for the bound field)</p></td>
          <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>#springShowErrors($separator $classOrStyle)</p></td>
          <td style="" align="left" valign="top"><p>&lt;@spring.showErrors separator, classOrStyle/&gt;</p></td>
         </tr>
        </tbody>
       </table> 
      </div>
     </div>
     <br class="table-break" /> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> In FTL (FreeMarker), these two macros are not actually required as you can use the normal <code class="literal">formInput</code> macro, specifying ' <code class="literal">hidden</code>' or ' <code class="literal">password</code>' as the value for the <code class="literal">fieldType</code> parameter. </li>
      </ul>
     </div> 
     <p>The parameters to any of the above macros have consistent meanings:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> path: the name of the field to bind to (ie &quot;command.name&quot;) </li>
       <li class="listitem"> options: a Map of all the available values that can be selected from in the input field. The keys to the map represent the values that will be POSTed back from the form and bound to the command object. Map objects stored against the keys are the labels displayed on the form to the user and may be different from the corresponding values posted back by the form. Usually such a map is supplied as reference data by the controller. Any Map implementation can be used depending on required behavior. For strictly sorted maps, a <code class="literal">SortedMap</code> such as a <code class="literal">TreeMap</code> with a suitable Comparator may be used and for arbitrary Maps that should return values in insertion order, use a <code class="literal">LinkedHashMap</code> or a <code class="literal">LinkedMap</code> from commons-collections. </li>
       <li class="listitem"> separator: where multiple options are available as discreet elements (radio buttons or checkboxes), the sequence of characters used to separate each one in the list (ie &quot;&lt;br&gt;&quot;). </li>
       <li class="listitem"> attributes: an additional string of arbitrary tags or text to be included within the HTML tag itself. This string is echoed literally by the macro. For example, in a textarea field you may supply attributes as <span class="emphasis"><em>rows=&quot;5&quot; cols=&quot;60&quot;</em></span> or you could pass style information such as <span class="emphasis"><em>style=&quot;border:1px solid silver&quot;</em></span>. </li>
       <li class="listitem"> classOrStyle: for the showErrors macro, the name of the CSS class that the span tag wrapping each error will use. If no information is supplied (or the value is empty) then the errors will be wrapped in &lt;b&gt;&lt;/b&gt; tags. </li>
      </ul>
     </div> 
     <p>Examples of the macros are outlined below some in FTL and some in VTL. Where usage differences exist between the two languages, they are explained in the notes.</p> 
     <div class="section" title="Input Fields">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="views-form-macros-input"></a>Input Fields</h5>
        </div>
       </div>
      </div> 
      <pre class="programlisting"><span class="hl-comment">&lt;!-- the Name field example from above using form macros in VTL --&gt;</span>
...
Name:
#springFormInput(&quot;command.name&quot; &quot;&quot;)<span class="hl-tag">&lt;br&gt;</span>
#springShowErrors(&quot;<span class="hl-tag">&lt;br&gt;</span>&quot; &quot;&quot;)<span class="hl-tag">&lt;br&gt;</span></pre> 
      <p>The formInput macro takes the path parameter (command.name) and an additional attributes parameter which is empty in the example above. The macro, along with all other form generation macros, performs an implicit spring bind on the path parameter. The binding remains valid until a new bind occurs so the showErrors macro doesnt need to pass the path parameter again - it simply operates on whichever field a bind was last created for.</p> 
      <p>The showErrors macro takes a separator parameter (the characters that will be used to separate multiple errors on a given field) and also accepts a second parameter, this time a class name or style attribute. Note that FreeMarker is able to specify default values for the attributes parameter, unlike Velocity, and the two macro calls above could be expressed as follows in FTL:</p> 
      <pre class="programlisting"><span class="hl-tag">&lt;@spring.formInput</span> <span class="hl-attribute">&quot;command.name&quot;/&gt;</span>
<span class="hl-attribute">&lt;@spring.showErrors</span> <span class="hl-attribute">&quot;&lt;br&gt;&quot;/&gt;</span></pre> 
      <p>Output is shown below of the form fragment generating the name field, and displaying a validation error after the form was submitted with no value in the field. Validation occurs through Springs Validation framework.</p> 
      <p>The generated HTML looks like this:</p> 
      <pre class="programlisting">Name:
&lt;input type=&quot;text&quot; name=&quot;name&quot; value=&quot;&quot;&gt;
&lt;br&gt;
    &lt;b&gt;required&lt;/b&gt;
&lt;br&gt;
&lt;br&gt;</pre> 
      <p>The formTextarea macro works the same way as the formInput macro and accepts the same parameter list. Commonly, the second parameter (attributes) will be used to pass style information or rows and cols attributes for the textarea.</p> 
     </div> 
     <div class="section" title="Selection Fields">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="views-form-macros-select"></a>Selection Fields</h5>
        </div>
       </div>
      </div> 
      <p>Four selection field macros can be used to generate common UI value selection inputs in your HTML forms.</p> 
      <div class="itemizedlist">
       <ul class="itemizedlist" type="disc">
        <li class="listitem"> formSingleSelect </li>
        <li class="listitem"> formMultiSelect </li>
        <li class="listitem"> formRadioButtons </li>
        <li class="listitem"> formCheckboxes </li>
       </ul>
      </div> 
      <p>Each of the four macros accepts a Map of options containing the value for the form field, and the label corresponding to that value. The value and the label can be the same.</p> 
      <p>An example of radio buttons in FTL is below. The form backing object specifies a default value of <span class="emphasis"><em>London</em></span> for this field and so no validation is necessary. When the form is rendered, the entire list of cities to choose from is supplied as reference data in the model under the name <span class="emphasis"><em>cityMap</em></span>.</p> 
      <pre class="programlisting">...
Town:
&lt;@spring.formRadioButtons &quot;command.address.town&quot;, cityMap, &quot;&quot; /&gt;&lt;br&gt;&lt;br&gt;</pre> 
      <p>This renders a line of radio buttons, one for each value in <code class="literal">cityMap</code> using the separator &quot;&quot;. No additional attributes are supplied (the last parameter to the macro is missing). The cityMap uses the same String for each key-value pair in the map. The maps keys are what the form actually submits as POSTed request parameters, map values are the labels that the user sees. In the example above, given a list of three well known cities and a default value in the form backing object, the HTML would be</p> 
      <pre class="programlisting">Town:
&lt;input type=&quot;radio&quot; name=&quot;address.town&quot; value=&quot;London&quot;&gt;London&lt;/input&gt;
&lt;input type=&quot;radio&quot; name=&quot;address.town&quot; value=&quot;Paris&quot; checked=&quot;checked&quot;&gt;Paris&lt;/input&gt;
&lt;input type=&quot;radio&quot; name=&quot;address.town&quot; value=&quot;New York&quot;&gt;New York&lt;/input&gt;</pre> 
      <p>If your application expects to handle cities by internal codes for example, the map of codes would be created with suitable keys like the example below.</p> 
      <pre class="programlisting"><span class="hl-keyword">protected</span> Map referenceData(HttpServletRequest request) <span class="hl-keyword">throws</span> Exception {
    Map cityMap = <span class="hl-keyword">new</span> LinkedHashMap();
    cityMap.put(<span class="hl-string">&quot;LDN&quot;</span>, <span class="hl-string">&quot;London&quot;</span>);
    cityMap.put(<span class="hl-string">&quot;PRS&quot;</span>, <span class="hl-string">&quot;Paris&quot;</span>);
    cityMap.put(<span class="hl-string">&quot;NYC&quot;</span>, <span class="hl-string">&quot;New York&quot;</span>);

    Map m = <span class="hl-keyword">new</span> HashMap();
    m.put(<span class="hl-string">&quot;cityMap&quot;</span>, cityMap);
    <span class="hl-keyword">return</span> m;
}</pre> 
      <p>The code would now produce output where the radio values are the relevant codes but the user still sees the more user friendly city names.</p> 
      <pre class="programlisting">Town:
&lt;input type=&quot;radio&quot; name=&quot;address.town&quot; value=&quot;LDN&quot;&gt;London&lt;/input&gt;
&lt;input type=&quot;radio&quot; name=&quot;address.town&quot; value=&quot;PRS&quot; checked=&quot;checked&quot;&gt;Paris&lt;/input&gt;
&lt;input type=&quot;radio&quot; name=&quot;address.town&quot; value=&quot;NYC&quot;&gt;New York&lt;/input&gt;</pre> 
     </div> 
    </div> 
    <div class="section" title="HTML escaping and XHTML compliance">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="views-form-macros-html-escaping"></a>HTML escaping and XHTML compliance</h4>
       </div>
      </div>
     </div> 
     <p>Default usage of the form macros above will result in HTML tags that are HTML 4.01 compliant and that use the default value for HTML escaping defined in your web.xml as used by Springs bind support. In order to make the tags XHTML compliant or to override the default HTML escaping value, you can specify two variables in your template (or in your model where they will be visible to your templates). The advantage of specifying them in the templates is that they can be changed to different values later in the template processing to provide different behavior for different fields in your form.</p> 
     <p>To switch to XHTML compliance for your tags, specify a value of <span class="emphasis"><em>true</em></span> for a model/context variable named xhtmlCompliant:</p> 
     <pre class="programlisting"># for Velocity..
#set($springXhtmlCompliant = true)

&lt;-- for FreeMarker --&gt;
&lt;#assign xhtmlCompliant = true in spring&gt;</pre> 
     <p>Any tags generated by the Spring macros will now be XHTML compliant after processing this directive.</p> 
     <p>In similar fashion, HTML escaping can be specified per field:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;#--</span> <span class="hl-attribute">until</span> <span class="hl-attribute">this</span> <span class="hl-attribute">point,</span> <span class="hl-attribute">default</span> <span class="hl-attribute">HTML</span> <span class="hl-attribute">escaping</span> <span class="hl-attribute">is</span> <span class="hl-attribute">used</span> <span class="hl-attribute">--&gt;</span>

<span class="hl-attribute">&lt;#assign</span> <span class="hl-attribute">htmlEscape</span> = <span class="hl-value">true</span> <span class="hl-attribute">in</span> <span class="hl-attribute">spring&gt;</span>
<span class="hl-attribute">&lt;#--</span> <span class="hl-attribute">next</span> <span class="hl-attribute">field</span> <span class="hl-attribute">will</span> <span class="hl-attribute">use</span> <span class="hl-attribute">HTML</span> <span class="hl-attribute">escaping</span> <span class="hl-attribute">--&gt;</span>
<span class="hl-attribute">&lt;@spring.formInput</span> <span class="hl-attribute">&quot;command.name&quot;</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;#assign</span> <span class="hl-attribute">htmlEscape</span> = <span class="hl-value">false</span> <span class="hl-attribute">in</span> <span class="hl-attribute">spring&gt;</span>
<span class="hl-attribute">&lt;#--</span> <span class="hl-attribute">all</span> <span class="hl-attribute">future</span> <span class="hl-attribute">fields</span> <span class="hl-attribute">will</span> <span class="hl-attribute">be</span> <span class="hl-attribute">bound</span> <span class="hl-attribute">with</span> <span class="hl-attribute">HTML</span> <span class="hl-attribute">escaping</span> <span class="hl-attribute">off</span> <span class="hl-attribute">--&gt;</span></pre> 
    </div> 
   </div> 
  </div> 
  <div class="section" title="17.5&nbsp;XSLT">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="view-xslt"></a>17.5&nbsp;XSLT</h2>
     </div>
    </div>
   </div> 
   <p>XSLT is a transformation language for XML and is popular as a view technology within web applications. XSLT can be a good choice as a view technology if your application naturally deals with XML, or if your model can easily be converted to XML. The following section shows how to produce an XML document as model data and have it transformed with XSLT in a Spring Web MVC application.</p> 
   <div class="section" title="17.5.1&nbsp;My First Words">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="view-xslt-firstwords"></a>17.5.1&nbsp;My First Words</h3>
      </div>
     </div>
    </div> 
    <p>This example is a trivial Spring application that creates a list of words in the <code class="literal">Controller</code> and adds them to the model map. The map is returned along with the view name of our XSLT view. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-controller" title="16.3&nbsp;Implementing Controllers">Section&nbsp;16.3, Implementing Controllers</a> for details of Spring Web MVCs <code class="literal">Controller</code> interface. The XSLT view will turn the list of words into a simple XML document ready for transformation.</p> 
    <div class="section" title="Bean definitions">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-xslt-beandefs"></a>Bean definitions</h4>
       </div>
      </div>
     </div> 
     <p>Configuration is standard for a simple Spring application. The dispatcher servlet config file contains a reference to a <code class="literal">ViewResolver</code>, URL mappings and a single controller bean</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;homeController&quot;</span><span class="hl-attribute">class</span>=<span class="hl-value">&quot;xslt.HomeController&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <div class="orderedlist">
      <ol class="orderedlist" type="i">
       <li class="listitem"> that encapsulates our word generation logic. </li>
      </ol>
     </div> 
    </div> 
    <div class="section" title="Standard MVC controller code">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-xslt-controllercode"></a>Standard MVC controller code</h4>
       </div>
      </div>
     </div> 
     <p>The controller logic is encapsulated in a subclass of <code class="literal">AbstractController</code>, with the handler method being defined like so</p> 
     <pre class="programlisting"><span class="hl-keyword">protected</span> ModelAndView handleRequestInternal(HttpServletRequest request,
        HttpServletResponse response) <span class="hl-keyword">throws</span> Exception {

    Map map = <span class="hl-keyword">new</span> HashMap();
    List wordList = <span class="hl-keyword">new</span> ArrayList();

    wordList.add(<span class="hl-string">&quot;hello&quot;</span>);
    wordList.add(<span class="hl-string">&quot;world&quot;</span>);

    map.put(<span class="hl-string">&quot;wordList&quot;</span>, wordList);

    <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> ModelAndView(<span class="hl-string">&quot;home&quot;</span>, map);
}</pre> 
     <p>So far weve done nothing thats XSLT specific. The model data has been created in the same way as you would for any other Spring MVC application. Depending on the configuration of the application now, that list of words could be rendered by JSP/JSTL by having them added as request attributes, or they could be handled by Velocity by adding the object to the <code class="literal">VelocityContext</code>. In order to have XSLT render them, they of course have to be converted into an XML document somehow. There are software packages available that will automatically <span class="emphasis"><em>domify</em></span> an object graph, but within Spring, you have complete flexibility to create the DOM from your model in any way you choose. This prevents the transformation of XML playing too great a part in the structure of your model data which is a danger when using tools to manage the domification process.</p> 
    </div> 
    <div class="section" title="Convert the model data to XML">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-xslt-subclassing"></a>Convert the model data to XML</h4>
       </div>
      </div>
     </div> 
     <p>In order to create a DOM document from our list of words or any other model data, we must subclass the (provided) <code class="literal">org.springframework.web.servlet.view.xslt.AbstractXsltView</code> class. In doing so, we must also typically implement the abstract method <code class="literal">createXsltSource(..)</code> method. The first parameter passed to this method is our model map. Heres the complete listing of the <code class="literal">HomePage</code> class in our trivial word application:</p> 
     <pre class="programlisting"><span class="hl-keyword">package</span> xslt;

<span class="hl-comment">// imports omitted for brevity</span>

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HomePage <span class="hl-keyword">extends</span> AbstractXsltView {

    <span class="hl-keyword">protected</span> Source createXsltSource(Map model, String rootName,
            HttpServletRequest request, HttpServletResponse response) <span class="hl-keyword">throws</span> Exception {

        Document document = DocumentBuilderFactory.newInstance().newDocumentBuilder().newDocument();
        Element root = document.createElement(rootName);

        List words = (List) model.get(<span class="hl-string">&quot;wordList&quot;</span>);
        <span class="hl-keyword">for</span> (Iterator it = words.iterator(); it.hasNext();) {
            String nextWord = (String) it.next();
            Element wordNode = document.createElement(<span class="hl-string">&quot;word&quot;</span>);
            Text textNode = document.createTextNode(nextWord);
            wordNode.appendChild(textNode);
            root.appendChild(wordNode);
        }
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> DOMSource(root);
    }

}</pre> 
     <p>A series of parameter name/value pairs can optionally be defined by your subclass which will be added to the transformation object. The parameter names must match those defined in your XSLT template declared with <code class="literal">&lt;xsl:param name=&quot;myParam&quot;&gt;defaultValue&lt;/xsl:param&gt;</code>. To specify the parameters, override the <code class="literal">getParameters()</code> method of the <code class="literal">AbstractXsltView</code> class and return a <code class="literal">Map</code> of the name/value pairs. If your parameters need to derive information from the current request, you can override the <code class="literal">getParameters(HttpServletRequest request)</code> method instead.</p> 
    </div> 
    <div class="section" title="Defining the view properties">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-xslt-viewdefinitions"></a>Defining the view properties</h4>
       </div>
      </div>
     </div> 
     <p>The views.properties file (or equivalent xml definition if youre using an XML based view resolver as we did in the Velocity examples above) looks like this for the one-view application that is <span class="emphasis"><em>My First Words</em></span>:</p> 
     <pre class="literallayout">home.(class)=xslt.HomePage
home.stylesheetLocation=/WEB-INF/xsl/home.xslt
home.root=words</pre> 
     <p>Here, you can see how the view is tied in with the <code class="literal">HomePage</code> class just written which handles the model domification in the first property <code class="literal">'.(class)'</code>. The <code class="literal">'stylesheetLocation'</code> property points to the XSLT file which will handle the XML transformation into HTML for us and the final property <code class="literal">'.root'</code> is the name that will be used as the root of the XML document. This gets passed to the <code class="literal">HomePage</code> class above in the second parameter to the <code class="literal">createXsltSource(..)</code> method(s).</p> 
    </div> 
    <div class="section" title="Document transformation">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-xslt-transforming"></a>Document transformation</h4>
       </div>
      </div>
     </div> 
     <p>Finally, we have the XSLT code used for transforming the above document. As shown in the above <code class="literal">'views.properties'</code> file, the stylesheet is called <code class="literal">'home.xslt'</code> and it lives in the war file in the <code class="literal">'WEB-INF/xsl'</code> directory.</p> 
     <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>
<span class="hl-tag">&lt;xsl:stylesheet</span> <span class="hl-attribute">version</span>=<span class="hl-value">&quot;1.0&quot;</span> <span class="hl-attribute">xmlns:xsl</span>=<span class="hl-value">&quot;http://www.w3.org/1999/XSL/Transform&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;xsl:output</span> <span class="hl-attribute">method</span>=<span class="hl-value">&quot;html&quot;</span> <span class="hl-attribute">omit-xml-declaration</span>=<span class="hl-value">&quot;yes&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;xsl:template</span> <span class="hl-attribute">match</span>=<span class="hl-value">&quot;/&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;html&gt;</span>
            <span class="hl-tag">&lt;head&gt;</span><span class="hl-tag">&lt;title&gt;</span>Hello!<span class="hl-tag">&lt;/title&gt;</span><span class="hl-tag">&lt;/head&gt;</span>
            <span class="hl-tag">&lt;body&gt;</span>
                <span class="hl-tag">&lt;h1&gt;</span>My First Words<span class="hl-tag">&lt;/h1&gt;</span>
                <span class="hl-tag">&lt;xsl:apply-templates/&gt;</span>
            <span class="hl-tag">&lt;/body&gt;</span>
        <span class="hl-tag">&lt;/html&gt;</span>
    <span class="hl-tag">&lt;/xsl:template&gt;</span>

    <span class="hl-tag">&lt;xsl:template</span> <span class="hl-attribute">match</span>=<span class="hl-value">&quot;word&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;xsl:value-of</span> <span class="hl-attribute">select</span>=<span class="hl-value">&quot;.&quot;</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;br/&gt;</span>
    <span class="hl-tag">&lt;/xsl:template&gt;</span>

<span class="hl-tag">&lt;/xsl:stylesheet&gt;</span></pre> 
    </div> 
   </div> 
   <div class="section" title="17.5.2&nbsp;Summary">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="view-xslt-summary"></a>17.5.2&nbsp;Summary</h3>
      </div>
     </div>
    </div> 
    <p>A summary of the files discussed and their location in the WAR file is shown in the simplified WAR structure below.</p> 
    <pre class="literallayout">ProjectRoot
  |
  +- WebContent
      |
      +- WEB-INF
          |
          +- classes
          |    |
          |    +- xslt
          |    |   |
          |    |   +- HomePageController.class
          |    |   +- HomePage.class
          |    |
          |    +- views.properties
          |
          +- lib
          |   |
          |   +- spring-*.jar
          |
          +- xsl
          |   |
          |   +- home.xslt
          |
          +- frontcontroller-servlet.xml</pre> 
    <p>You will also need to ensure that an XML parser and an XSLT engine are available on the classpath. JDK 1.4 provides them by default, and most Java EE containers will also make them available by default, but its a possible source of errors to be aware of.</p> 
   </div> 
  </div> 
  <div class="section" title="17.6&nbsp;Document views (PDF/Excel)">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="view-document"></a>17.6&nbsp;Document views (PDF/Excel)</h2>
     </div>
    </div>
   </div> 
   <div class="section" title="17.6.1&nbsp;Introduction">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="view-document-intro"></a>17.6.1&nbsp;Introduction</h3>
      </div>
     </div>
    </div> 
    <p>Returning an HTML page isnt always the best way for the user to view the model output, and Spring makes it simple to generate a PDF document or an Excel spreadsheet dynamically from the model data. The document is the view and will be streamed from the server with the correct content type to (hopefully) enable the client PC to run their spreadsheet or PDF viewer application in response.</p> 
    <p>In order to use Excel views, you need to add the <span class="emphasis"><em>poi</em></span> library to your classpath, and for PDF generation, the iText library.</p> 
   </div> 
   <div class="section" title="17.6.2&nbsp;Configuration and setup">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="view-document-config"></a>17.6.2&nbsp;Configuration and setup</h3>
      </div>
     </div>
    </div> 
    <p>Document based views are handled in an almost identical fashion to XSLT views, and the following sections build upon the previous one by demonstrating how the same controller used in the XSLT example is invoked to render the same model as both a PDF document and an Excel spreadsheet (which can also be viewed or manipulated in Open Office).</p> 
    <div class="section" title="Document view definitions">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-document-configviews"></a>Document view definitions</h4>
       </div>
      </div>
     </div> 
     <p>First, lets amend the views.properties file (or xml equivalent) and add a simple view definition for both document types. The entire file now looks like this with the XSLT view shown from earlier:</p> 
     <pre class="literallayout">home.(class)=xslt.HomePage
home.stylesheetLocation=/WEB-INF/xsl/home.xslt
home.root=words

xl.(class)=excel.HomePage

pdf.(class)=pdf.HomePage</pre> 
     <p><span class="emphasis"><em>If you want to start with a template spreadsheet or a fillable PDF form to add your model data to, specify the location as the <span class="emphasis"><em>url</em></span> property in the view definition</em></span></p> 
    </div> 
    <div class="section" title="Controller code">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-document-configcontroller"></a>Controller code</h4>
       </div>
      </div>
     </div> 
     <p>The controller code well use remains exactly the same from the XSLT example earlier other than to change the name of the view to use. Of course, you could be clever and have this selected based on a URL parameter or some other logic - proof that Spring really is very good at decoupling the views from the controllers!</p> 
    </div> 
    <div class="section" title="Subclassing for Excel views">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-document-configsubclasses"></a>Subclassing for Excel views</h4>
       </div>
      </div>
     </div> 
     <p>Exactly as we did for the XSLT example, well subclass suitable abstract classes in order to implement custom behavior in generating our output documents. For Excel, this involves writing a subclass of <code class="literal">org.springframework.web.servlet.view.document.AbstractExcelView</code> (for Excel files generated by POI) or <code class="literal">org.springframework.web.servlet.view.document.AbstractJExcelView</code> (for JExcelApi-generated Excel files) and implementing the <code class="literal">buildExcelDocument()</code> method.</p> 
     <p>Heres the complete listing for our POI Excel view which displays the word list from the model map in consecutive rows of the first column of a new spreadsheet:</p> 
     <pre class="programlisting"><span class="hl-keyword">package</span> excel;

<span class="hl-comment">// imports omitted for brevity</span>

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HomePage <span class="hl-keyword">extends</span> AbstractExcelView {

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> buildExcelDocument(Map model, HSSFWorkbook wb, HttpServletRequest req,
            HttpServletResponse resp) <span class="hl-keyword">throws</span> Exception {

        HSSFSheet sheet;
        HSSFRow sheetRow;
        HSSFCell cell;

        <span class="hl-comment">// Go to the first sheet</span>
        <span class="hl-comment">// getSheetAt: only if wb is created from an existing document</span>
        <span class="hl-comment">// sheet = wb.getSheetAt(0);</span>
        sheet = wb.createSheet(<span class="hl-string">&quot;Spring&quot;</span>);
        sheet.setDefaultColumnWidth((<span class="hl-keyword">short</span>) <span class="hl-number">12</span>);

        <span class="hl-comment">// write a text at A1</span>
        cell = getCell(sheet, <span class="hl-number">0</span>, <span class="hl-number">0</span>);
        setText(cell, <span class="hl-string">&quot;Spring-Excel test&quot;</span>);

        List words = (List) model.get(<span class="hl-string">&quot;wordList&quot;</span>);
        <span class="hl-keyword">for</span> (<span class="hl-keyword">int</span> i=<span class="hl-number">0</span>; i &lt; words.size(); i++) {
            cell = getCell(sheet, <span class="hl-number">2</span>+i, <span class="hl-number">0</span>);
            setText(cell, (String) words.get(i));
        }
    }

}</pre> 
     <p>And the following is a view generating the same Excel file, now using JExcelApi:</p> 
     <pre class="programlisting"><span class="hl-keyword">package</span> excel;

<span class="hl-comment">// imports omitted for brevity</span>

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HomePage <span class="hl-keyword">extends</span> AbstractJExcelView {

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> buildExcelDocument(Map model, WritableWorkbook wb,
            HttpServletRequest request, HttpServletResponse response) <span class="hl-keyword">throws</span> Exception {

        WritableSheet sheet = wb.createSheet(<span class="hl-string">&quot;Spring&quot;</span>, <span class="hl-number">0</span>);

        sheet.addCell(<span class="hl-keyword">new</span> Label(<span class="hl-number">0</span>, <span class="hl-number">0</span>, <span class="hl-string">&quot;Spring-Excel test&quot;</span>));

        List words = (List) model.get(<span class="hl-string">&quot;wordList&quot;</span>);
        <span class="hl-keyword">for</span> (<span class="hl-keyword">int</span> i = <span class="hl-number">0</span>; i &lt; words.size(); i++) {
            sheet.addCell(<span class="hl-keyword">new</span> Label(<span class="hl-number">2</span>+i, <span class="hl-number">0</span>, (String) words.get(i)));
        }
    }
}</pre> 
     <p>Note the differences between the APIs. Weve found that the JExcelApi is somewhat more intuitive, and furthermore, JExcelApi has slightly better image-handling capabilities. There have been memory problems with large Excel files when using JExcelApi however.</p> 
     <p>If you now amend the controller such that it returns <code class="literal">xl</code> as the name of the view ( <code class="literal">return new ModelAndView(&quot;xl&quot;, map);</code>) and run your application again, you should find that the Excel spreadsheet is created and downloaded automatically when you request the same page as before.</p> 
    </div> 
    <div class="section" title="Subclassing for PDF views">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-document-configsubclasspdf"></a>Subclassing for PDF views</h4>
       </div>
      </div>
     </div> 
     <p>The PDF version of the word list is even simpler. This time, the class extends <code class="literal">org.springframework.web.servlet.view.document.AbstractPdfView</code> and implements the <code class="literal">buildPdfDocument()</code> method as follows:</p> 
     <pre class="programlisting"><span class="hl-keyword">package</span> pdf;

<span class="hl-comment">// imports omitted for brevity</span>

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PDFPage <span class="hl-keyword">extends</span> AbstractPdfView {

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> buildPdfDocument(Map model, Document doc, PdfWriter writer,
        HttpServletRequest req, HttpServletResponse resp) <span class="hl-keyword">throws</span> Exception {
        List words = (List) model.get(<span class="hl-string">&quot;wordList&quot;</span>);
        <span class="hl-keyword">for</span> (<span class="hl-keyword">int</span> i=<span class="hl-number">0</span>; i&lt;words.size(); i++) {
            doc.add( <span class="hl-keyword">new</span> Paragraph((String) words.get(i)));
        }
    }

}</pre> 
     <p>Once again, amend the controller to return the <code class="literal">pdf</code> view with <code class="literal">return new ModelAndView(&quot;pdf&quot;, map);</code>, and reload the URL in your application. This time a PDF document should appear listing each of the words in the model map.</p> 
    </div> 
   </div> 
  </div> 
  <div class="section" title="17.7&nbsp;JasperReports">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="view-jasper-reports"></a>17.7&nbsp;JasperReports</h2>
     </div>
    </div>
   </div> 
   <p>JasperReports ( <a class="ulink" href="http://jasperreports.sourceforge.net/" target="_top">http://jasperreports.sourceforge.net</a>) is a powerful open-source reporting engine that supports the creation of report designs using an easily understood XML file format. JasperReports is capable of rendering reports in four different formats: CSV, Excel, HTML and PDF.</p> 
   <div class="section" title="17.7.1&nbsp;Dependencies">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="view-jasper-reports-dependencies"></a>17.7.1&nbsp;Dependencies</h3>
      </div>
     </div>
    </div> 
    <p>Your application will need to include the latest release of JasperReports, which at the time of writing was 0.6.1. JasperReports itself depends on the following projects:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> BeanShell </li>
      <li class="listitem"> Commons BeanUtils </li>
      <li class="listitem"> Commons Collections </li>
      <li class="listitem"> Commons Digester </li>
      <li class="listitem"> Commons Logging </li>
      <li class="listitem"> iText </li>
      <li class="listitem"> POI </li>
     </ul>
    </div> 
    <p>JasperReports also requires a JAXP compliant XML parser.</p> 
   </div> 
   <div class="section" title="17.7.2&nbsp;Configuration">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="view-jasper-reports-configuration"></a>17.7.2&nbsp;Configuration</h3>
      </div>
     </div>
    </div> 
    <p>To configure JasperReports views in your Spring container configuration you need to define a <code class="literal">ViewResolver</code> to map view names to the appropriate view class depending on which format you want your report rendered in.</p> 
    <div class="section" title="Configuring the ViewResolver">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-jasper-reports-configuration-resolver"></a>Configuring the ViewResolver</h4>
       </div>
      </div>
     </div> 
     <p>Typically, you will use the <code class="literal">ResourceBundleViewResolver</code> to map view names to view classes and files in a properties file.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;viewResolver&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.ResourceBundleViewResolver&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;basename&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;views&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
     <p>Here weve configured an instance of the <code class="literal">ResourceBundleViewResolver</code> class that will look for view mappings in the resource bundle with base name <code class="literal">views</code>. (The content of this file is described in the next section.)</p> 
    </div> 
    <div class="section" title="Configuring the Views">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-jasper-reports-configuration-views"></a>Configuring the Views</h4>
       </div>
      </div>
     </div> 
     <p>The Spring Framework contains five different <code class="literal">View</code> implementations for JasperReports, four of which correspond to one of the four output formats supported by JasperReports, and one that allows for the format to be determined at runtime:</p> 
     <div class="table">
      <a name="view-jasper-reports-configuration-views-classes"></a>
      <p class="title"><b>Table&nbsp;17.2.&nbsp;JasperReports View classes</b></p>
      <div class="table-contents"> 
       <table summary="JasperReports View classes" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
        <colgroup>
         <col />
         <col />
        </colgroup>
        <thead>
         <tr>
          <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Class Name</th>
          <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Render Format</th>
         </tr>
        </thead>
        <tbody>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">JasperReportsCsvView</code></p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>CSV</p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">JasperReportsHtmlView</code></p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>HTML</p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">JasperReportsPdfView</code></p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PDF</p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">JasperReportsXlsView</code></p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Microsoft Excel</p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">JasperReportsMultiFormatView</code></p></td>
          <td style="" align="left" valign="top"><p>The view is <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#view-jasper-reports-configuration-multiformat-view" title="Using JasperReportsMultiFormatView">decided upon at runtime</a></p></td>
         </tr>
        </tbody>
       </table> 
      </div>
     </div>
     <br class="table-break" /> 
     <p>Mapping one of these classes to a view name and a report file is a matter of adding the appropriate entries in the resource bundle configured in the previous section as shown here:</p> 
     <pre class="literallayout">simpleReport.(class)=org.springframework.web.servlet.view.jasperreports.JasperReportsPdfView
simpleReport.url=/WEB-INF/reports/DataSourceReport.jasper</pre> 
     <p>Here you can see that the view with name <code class="literal">simpleReport</code> is mapped to the <code class="literal">JasperReportsPdfView</code> class, causing the output of this report to be rendered in PDF format. The <code class="literal">url</code> property of the view is set to the location of the underlying report file.</p> 
    </div> 
    <div class="section" title="About Report Files">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-jasper-reports-configuration-report-files"></a>About Report Files</h4>
       </div>
      </div>
     </div> 
     <p>JasperReports has two distinct types of report file: the design file, which has a <code class="literal">.jrxml</code> extension, and the compiled report file, which has a <code class="literal">.jasper</code> extension. Typically, you use the JasperReports Ant task to compile your <code class="literal">.jrxml</code> design file into a <code class="literal">.jasper</code> file before deploying it into your application. With the Spring Framework you can map either of these files to your report file and the framework will take care of compiling the <code class="literal">.jrxml</code> file on the fly for you. You should note that after a <code class="literal">.jrxml</code> file is compiled by the Spring Framework, the compiled report is cached for the lifetime of the application. Thus, to make changes to the file you will need to restart your application.</p> 
    </div> 
    <div class="section" title="Using JasperReportsMultiFormatView">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-jasper-reports-configuration-multiformat-view"></a>Using JasperReportsMultiFormatView</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">JasperReportsMultiFormatView</code> allows for the report format to be specified at runtime. The actual rendering of the report is delegated to one of the other JasperReports view classes - the <code class="literal">JasperReportsMultiFormatView</code> class simply adds a wrapper layer that allows for the exact implementation to be specified at runtime.</p> 
     <p>The <code class="literal">JasperReportsMultiFormatView</code> class introduces two concepts: the format key and the discriminator key. The <code class="literal">JasperReportsMultiFormatView</code> class uses the mapping key to look up the actual view implementation class, and it uses the format key to lookup up the mapping key. From a coding perspective you add an entry to your model with the format key as the key and the mapping key as the value, for example:</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> ModelAndView handleSimpleReportMulti(HttpServletRequest request,
HttpServletResponse response) <span class="hl-keyword">throws</span> Exception {

    String uri = request.getRequestURI();
    String format = uri.substring(uri.lastIndexOf(<span class="hl-string">&quot;.&quot;</span>) + <span class="hl-number">1</span>);

    Map model = getModel();
    model.put(<span class="hl-string">&quot;format&quot;</span>, format);

    <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> ModelAndView(<span class="hl-string">&quot;simpleReportMulti&quot;</span>, model);

}</pre> 
     <p>In this example, the mapping key is determined from the extension of the request URI and is added to the model under the default format key: <code class="literal">format</code>. If you wish to use a different format key then you can configure this using the <code class="literal">formatKey</code> property of the <code class="literal">JasperReportsMultiFormatView</code> class.</p> 
     <p>By default the following mapping key mappings are configured in <code class="literal">JasperReportsMultiFormatView</code>:</p> 
     <div class="table">
      <a name="view-jasper-reports-configuration-multiformat-view-mappings"></a>
      <p class="title"><b>Table&nbsp;17.3.&nbsp;JasperReportsMultiFormatView Default Mapping Key Mappings</b></p>
      <div class="table-contents"> 
       <table summary="JasperReportsMultiFormatView Default Mapping Key Mappings" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
        <colgroup>
         <col />
         <col />
        </colgroup>
        <thead>
         <tr>
          <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Mapping Key</th>
          <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">View Class</th>
         </tr>
        </thead>
        <tbody>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>csv</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">JasperReportsCsvView</code></p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>html</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">JasperReportsHtmlView</code></p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>pdf</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">JasperReportsPdfView</code></p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>xls</p></td>
          <td style="" align="left" valign="top"><p><code class="literal">JasperReportsXlsView</code></p></td>
         </tr>
        </tbody>
       </table> 
      </div>
     </div>
     <br class="table-break" /> 
     <p>So in the example above a request to URI /foo/myReport.pdf would be mapped to the <code class="literal">JasperReportsPdfView</code> class. You can override the mapping key to view class mappings using the <code class="literal">formatMappings</code> property of <code class="literal">JasperReportsMultiFormatView</code>.</p> 
    </div> 
   </div> 
   <div class="section" title="17.7.3&nbsp;Populating the ModelAndView">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="view-jasper-reports-model"></a>17.7.3&nbsp;Populating the ModelAndView</h3>
      </div>
     </div>
    </div> 
    <p>In order to render your report correctly in the format you have chosen, you must supply Spring with all of the data needed to populate your report. For JasperReports this means you must pass in all report parameters along with the report datasource. Report parameters are simple name/value pairs and can be added to the <code class="literal">Map</code> for your model as you would add any name/value pair.</p> 
    <p>When adding the datasource to the model you have two approaches to choose from. The first approach is to add an instance of <code class="literal">JRDataSource</code> or a <code class="literal">Collection</code> type to the model <code class="literal">Map</code> under any arbitrary key. Spring will then locate this object in the model and treat it as the report datasource. For example, you may populate your model like so:</p> 
    <pre class="programlisting"><span class="hl-keyword">private</span> Map getModel() {
    Map model = <span class="hl-keyword">new</span> HashMap();
    Collection beanData = getBeanData();
    model.put(<span class="hl-string">&quot;myBeanData&quot;</span>, beanData);
    <span class="hl-keyword">return</span> model;
}</pre> 
    <p>The second approach is to add the instance of <code class="literal">JRDataSource</code> or <code class="literal">Collection</code> under a specific key and then configure this key using the <code class="literal">reportDataKey</code> property of the view class. In both cases Spring will wrap instances of <code class="literal">Collection</code> in a <code class="literal">JRBeanCollectionDataSource</code> instance. For example:</p> 
    <pre class="programlisting"><span class="hl-keyword">private</span> Map getModel() {
    Map model = <span class="hl-keyword">new</span> HashMap();
    Collection beanData = getBeanData();
    Collection someData = getSomeData();
    model.put(<span class="hl-string">&quot;myBeanData&quot;</span>, beanData);
    model.put(<span class="hl-string">&quot;someData&quot;</span>, someData);
    <span class="hl-keyword">return</span> model;
}</pre> 
    <p>Here you can see that two <code class="literal">Collection</code> instances are being added to the model. To ensure that the correct one is used, we simply modify our view configuration as appropriate:</p> 
    <pre class="literallayout">simpleReport.(class)=org.springframework.web.servlet.view.jasperreports.JasperReportsPdfView
simpleReport.url=/WEB-INF/reports/DataSourceReport.jasper
simpleReport.reportDataKey=myBeanData</pre> 
    <p>Be aware that when using the first approach, Spring will use the first instance of <code class="literal">JRDataSource</code> or <code class="literal">Collection</code> that it encounters. If you need to place multiple instances of <code class="literal">JRDataSource</code> or <code class="literal">Collection</code> into the model you need to use the second approach.</p> 
   </div> 
   <div class="section" title="17.7.4&nbsp;Working with Sub-Reports">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="view-jasper-reports-subreports"></a>17.7.4&nbsp;Working with Sub-Reports</h3>
      </div>
     </div>
    </div> 
    <p>JasperReports provides support for embedded sub-reports within your master report files. There are a wide variety of mechanisms for including sub-reports in your report files. The easiest way is to hard code the report path and the SQL query for the sub report into your design files. The drawback of this approach is obvious: the values are hard-coded into your report files reducing reusability and making it harder to modify and update report designs. To overcome this you can configure sub-reports declaratively, and you can include additional data for these sub-reports directly from your controllers.</p> 
    <div class="section" title="Configuring Sub-Report Files">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-jasper-reports-subreports-config-reports"></a>Configuring Sub-Report Files</h4>
       </div>
      </div>
     </div> 
     <p>To control which sub-report files are included in a master report using Spring, your report file must be configured to accept sub-reports from an external source. To do this you declare a parameter in your report file like so:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;parameter</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;ProductsSubReport&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;net.sf.jasperreports.engine.JasperReport&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <p>Then, you define your sub-report to use this sub-report parameter:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;subreport&gt;</span>
    <span class="hl-tag">&lt;reportElement</span> <span class="hl-attribute">isPrintRepeatedValues</span>=<span class="hl-value">&quot;false&quot;</span> <span class="hl-attribute">x</span>=<span class="hl-value">&quot;5&quot;</span> <span class="hl-attribute">y</span>=<span class="hl-value">&quot;25&quot;</span> <span class="hl-attribute">width</span>=<span class="hl-value">&quot;325&quot;</span>
        <span class="hl-attribute">height</span>=<span class="hl-value">&quot;20&quot;</span> <span class="hl-attribute">isRemoveLineWhenBlank</span>=<span class="hl-value">&quot;true&quot;</span> <span class="hl-attribute">backcolor</span>=<span class="hl-value">&quot;#ffcc99&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;subreportParameter</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;City&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;subreportParameterExpression&gt;</span><span class="hl-tag">&lt;![CDATA[</span>$F{city}<span class="hl-tag">]]&gt;</span><span class="hl-tag">&lt;/subreportParameterExpression&gt;</span>
    <span class="hl-tag">&lt;/subreportParameter&gt;</span>
    <span class="hl-tag">&lt;dataSourceExpression&gt;</span><span class="hl-tag">&lt;![CDATA[</span>$P{SubReportData}<span class="hl-tag">]]&gt;</span><span class="hl-tag">&lt;/dataSourceExpression&gt;</span>
    <span class="hl-tag">&lt;subreportExpression</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;net.sf.jasperreports.engine.JasperReport&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;![CDATA[</span>$P{ProductsSubReport}<span class="hl-tag">]]&gt;</span><span class="hl-tag">&lt;/subreportExpression&gt;</span>
<span class="hl-tag">&lt;/subreport&gt;</span></pre> 
     <p>This defines a master report file that expects the sub-report to be passed in as an instance of <code class="literal">net.sf.jasperreports.engine.JasperReports</code> under the parameter <code class="literal">ProductsSubReport</code>. When configuring your Jasper view class, you can instruct Spring to load a report file and pass it into the JasperReports engine as a sub-report using the <code class="literal">subReportUrls</code> property:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;subReportUrls&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;map&gt;</span>
        <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;ProductsSubReport&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;/WEB-INF/reports/subReportChild.jrxml&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/map&gt;</span>
<span class="hl-tag">&lt;/property&gt;</span></pre> 
     <p>Here, the key of the <code class="literal">Map</code> corresponds to the name of the sub-report parameter in the report design file, and the entry is the URL of the report file. Spring will load this report file, compiling it if necessary, and pass it into the JasperReports engine under the given key.</p> 
    </div> 
    <div class="section" title="Configuring Sub-Report Data Sources">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="view-jasper-reports-subreports-config-datasources"></a>Configuring Sub-Report Data Sources</h4>
       </div>
      </div>
     </div> 
     <p>This step is entirely optional when using Spring to configure your sub-reports. If you wish, you can still configure the data source for your sub-reports using static queries. However, if you want Spring to convert data returned in your <code class="literal">ModelAndView</code> into instances of <code class="literal">JRDataSource</code> then you need to specify which of the parameters in your <code class="literal">ModelAndView</code> Spring should convert. To do this, configure the list of parameter names using the <code class="literal">subReportDataKeys</code> property of your chosen view class:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;subReportDataKeys&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;SubReportData&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <p>Here, the key you supply <span class="emphasis"><em>must</em></span> correspond to both the key used in your <code class="literal">ModelAndView</code> and the key used in your report design file.</p> 
    </div> 
   </div> 
   <div class="section" title="17.7.5&nbsp;Configuring Exporter Parameters">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="view-jasper-reports-exporter-parameters"></a>17.7.5&nbsp;Configuring Exporter Parameters</h3>
      </div>
     </div>
    </div> 
    <p>If you have special requirements for exporter configuration&#x2009;&#x2009;perhaps you want a specific page size for your PDF report&#x2009;&#x2009;you can configure these exporter parameters declaratively in your Spring configuration file using the <code class="literal">exporterParameters</code> property of the view class. The <code class="literal">exporterParameters</code> property is typed as a <code class="literal">Map</code>. In your configuration the key of an entry should be the fully-qualified name of a static field that contains the exporter parameter definition, and the value of an entry should be the value you want to assign to the parameter. An example of this is shown below:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;htmlReport&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.view.jasperreports.JasperReportsHtmlView&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;url&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;/WEB-INF/reports/simpleReport.jrxml&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;exporterParameters&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;map&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;net.sf.jasperreports.engine.export.JRHtmlExporterParameter.HTML_FOOTER&quot;</span><span class="hl-tag">&gt;</span>
                <span class="hl-tag">&lt;value&gt;</span>Footer by Spring!
                    &amp;lt;/td&amp;gt;&amp;lt;td width=&quot;50%&quot;&amp;gt;&amp;amp;nbsp; &amp;lt;/td&amp;gt;&amp;lt;/tr&amp;gt;
                    &amp;lt;/table&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;
                <span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;/entry&gt;</span>
        <span class="hl-tag">&lt;/map&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>Here you can see that the <code class="literal">JasperReportsHtmlView</code> is configured with an exporter parameter for <code class="literal">net.sf.jasperreports.engine.export.JRHtmlExporterParameter.HTML_FOOTER</code> which will output a footer in the resulting HTML.</p> 
   </div> 
  </div> 
  <div class="section" title="17.8&nbsp;Feed Views">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="view-feeds"></a>17.8&nbsp;Feed Views</h2>
     </div>
    </div>
   </div> 
   <p>Both <code class="literal">AbstractAtomFeedView</code> and <code class="literal">AbstractRssFeedView</code> inherit from the base class <code class="literal">AbstractFeedView</code> and are used to provide Atom and RSS Feed views respectfully. They are based on java.nets <a class="ulink" href="https://rome.dev.java.net/" target="_top">ROME</a> project and are located in the package <code class="literal">org.springframework.web.servlet.view.feed</code>.</p> 
   <p><code class="literal">AbstractAtomFeedView</code> requires you to implement the <code class="literal">buildFeedEntries()</code> method and optionally override the <code class="literal">buildFeedMetadata()</code> method (the default implementation is empty), as shown below.</p> 
   <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SampleContentAtomView <span class="hl-keyword">extends</span> AbstractAtomFeedView {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> buildFeedMetadata(Map&lt;String, Object&gt; model,
            Feed feed, HttpServletRequest request) {
        <span class="hl-comment">// implementation omitted</span>
    }

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">protected</span> List&lt;Entry&gt; buildFeedEntries(Map&lt;String, Object&gt; model,
            HttpServletRequest request, HttpServletResponse response) <span class="hl-keyword">throws</span> Exception {
        <span class="hl-comment">// implementation omitted</span>
    }

}</pre> 
   <p>Similar requirements apply for implementing <code class="literal">AbstractRssFeedView</code>, as shown below.</p> 
   <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SampleContentAtomView <span class="hl-keyword">extends</span> AbstractRssFeedView {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> buildFeedMetadata(Map&lt;String, Object&gt; model,
            Channel feed, HttpServletRequest request) {
        <span class="hl-comment">// implementation omitted</span>
    }

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">protected</span> List&lt;Item&gt; buildFeedItems(Map&lt;String, Object&gt; model,
            HttpServletRequest request, HttpServletResponse response) <span class="hl-keyword">throws</span> Exception {
        <span class="hl-comment">// implementation omitted</span>
    }

}</pre> 
   <p>The <code class="literal">buildFeedItems()</code> and <code class="literal">buildFeedEntires()</code> methods pass in the HTTP request in case you need to access the Locale. The HTTP response is passed in only for the setting of cookies or other HTTP headers. The feed will automatically be written to the response object after the method returns.</p> 
   <p>For an example of creating an Atom view please refer to Alef Arendsens SpringSource Team Blog <a class="ulink" href="http://spring.io/blog/2009/03/16/adding-an-atom-view-to-an-application-using-spring-s-rest-support" target="_top">entry</a>.</p> 
  </div> 
  <div class="section" title="17.9&nbsp;XML Marshalling View">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="view-xml-marshalling"></a>17.9&nbsp;XML Marshalling View</h2>
     </div>
    </div>
   </div> 
   <p>The <code class="literal">MarhsallingView</code> uses an XML <code class="literal">Marshaller</code> defined in the <code class="literal">org.springframework.oxm</code> package to render the response content as XML. The object to be marshalled can be set explicitly using <code class="literal">MarhsallingView</code>'s <code class="literal">modelKey</code> bean property. Alternatively, the view will iterate over all model properties and marshal only those types that are supported by the <code class="literal">Marshaller</code>. For more information on the functionality in the <code class="literal">org.springframework.oxm</code> package refer to the chapter <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#oxm" title="15.&nbsp;Marshalling XML using O/X Mappers">Marshalling XML using O/X Mappers</a>.</p> 
  </div> 
  <div class="section" title="17.10&nbsp;JSON Mapping View">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="view-json-mapping"></a>17.10&nbsp;JSON Mapping View</h2>
     </div>
    </div>
   </div> 
   <p>The <code class="literal">MappingJackson2JsonView</code> (or <code class="literal">MappingJacksonJsonView</code> depending on the the Jackson version you have) uses the Jackson librarys <code class="literal">ObjectMapper</code> to render the response content as JSON. By default, the entire contents of the model map (with the exception of framework-specific classes) will be encoded as JSON. For cases where the contents of the map need to be filtered, users may specify a specific set of model attributes to encode via the <code class="literal">RenderedAttributes</code> property. The <code class="literal">extractValueFromSingleKeyModel</code> property may also be used to have the value in single-key models extracted and serialized directly rather than as a map of model attributes.</p> 
   <p>JSON mapping can be customized as needed through the use of Jacksons provided annotations. When further control is needed, a custom <code class="literal">ObjectMapper</code> can be injected through the <code class="literal">ObjectMapper</code> property for cases where custom JSON serializers/deserializers need to be provided for specific types.</p> 
  </div> 
 </div> 
 <div class="chapter" title="18.&nbsp;Integrating with other web frameworks">
  <div class="titlepage">
   <div>
    <div>
     <h2 class="title"><a name="web-integration"></a>18.&nbsp;Integrating with other web frameworks</h2>
    </div>
   </div>
  </div> 
  <div class="section" title="18.1&nbsp;Introduction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="intro"></a>18.1&nbsp;Introduction</h2>
     </div>
    </div>
   </div> 
   <div class="sidebar" title="Spring Web Flow">
    <p class="title"><b>Spring Web Flow</b></p> 
    <p>Spring Web Flow (SWF) aims to be the best solution for the management of web application page flow.</p> 
    <p>SWF integrates with existing frameworks like Spring MVC, Struts, and JSF, in both servlet and portlet environments. If you have a business process (or processes) that would benefit from a conversational model as opposed to a purely request model, then SWF may be the solution.</p> 
    <p>SWF allows you to capture logical page flows as self-contained modules that are reusable in different situations, and as such is ideal for building web application modules that guide the user through controlled navigations that drive business processes.</p> 
    <p>For more information about SWF, consult the <a class="ulink" href="http://projects.spring.io/spring-webflow/" target="_top">Spring Web Flow website</a>.</p> 
   </div> 
   <p>This chapter details Springs integration with third party web frameworks such as <a class="ulink" href="http://www.oracle.com/technetwork/java/javaee/javaserverfaces-139869.html" target="_top">JSF</a>, <a class="ulink" href="http://struts.apache.org/" target="_top">Struts</a>, and <a class="ulink" href="http://tapestry.apache.org/" target="_top">Tapestry</a>.</p> 
   <p>One of the core value propositions of the Spring Framework is that of enabling <span class="emphasis"><em>choice</em></span>. In a general sense, Spring does not force one to use or buy into any particular architecture, technology, or methodology (although it certainly recommends some over others). This freedom to pick and choose the architecture, technology, or methodology that is most relevant to a developer and their development team is arguably most evident in the web area, where Spring provides its own web framework (<a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc" title="16.&nbsp;Web MVC framework">Spring MVC</a>), while at the same time providing integration with a number of popular third party web frameworks. This allows one to continue to leverage any and all of the skills one may have acquired in a particular web framework such as Struts, while at the same time being able to enjoy the benefits afforded by Spring in other areas such as data access, declarative transaction management, and flexible configuration and application assembly.</p> 
   <p>Having dispensed with the woolly sales patter (c.f. the previous paragraph), the remainder of this chapter will concentrate upon the meaty details of integrating your favorite web framework with Spring. One thing that is often commented upon by developers coming to Java from other languages is the seeming super-abundance of web frameworks available in Java. There are indeed a great number of web frameworks in the Java space; in fact there are far too many to cover with any semblance of detail in a single chapter. This chapter thus picks four of the more popular web frameworks in Java, starting with the Spring configuration that is common to all of the supported web frameworks, and then detailing the specific integration options for each supported web framework.</p> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>Please note that this chapter does not attempt to explain how to use any of the supported web frameworks. For example, if you want to use Struts for the presentation layer of your web application, the assumption is that you are already familiar with Struts. If you need further details about any of the supported web frameworks themselves, please do consult <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#web-integration-resources" title="18.6&nbsp;Further Resources">Section&nbsp;18.6, Further Resources</a> at the end of this chapter.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
  </div> 
  <div class="section" title="18.2&nbsp;Common configuration">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="web-integration-common"></a>18.2&nbsp;Common configuration</h2>
     </div>
    </div>
   </div> 
   <p>Before diving into the integration specifics of each supported web framework, let us first take a look at the Spring configuration that is <span class="emphasis"><em>not</em></span> specific to any one web framework. (This section is equally applicable to Springs own web framework, Spring MVC.)</p> 
   <p>One of the concepts (for want of a better word) espoused by (Springs) lightweight application model is that of a layered architecture. Remember that in a <span class="emphasis"><em>classic</em></span> layered architecture, the web layer is but one of many layers; it serves as one of the entry points into a server side application and it delegates to service objects (facades) defined in a service layer to satisfy business specific (and presentation-technology agnostic) use cases. In Spring, these service objects, any other business-specific objects, data access objects, etc. exist in a distinct <span class="emphasis"><em>business context</em></span>, which contains <span class="emphasis"><em>no</em></span> web or presentation layer objects (presentation objects such as Spring MVC controllers are typically configured in a distinct <span class="emphasis"><em>presentation context</em></span>). This section details how one configures a Spring container (a <code class="literal">WebApplicationContext</code>) that contains all of the <span class="emphasis"><em>business beans</em></span> in ones application.</p> 
   <p>On to specifics: all that one need do is to declare a <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/context/ContextLoaderListener.html" target="_top"><code class="literal">ContextLoaderListener</code></a> in the standard Java EE servlet <code class="literal">web.xml</code> file of ones web application, and add a <code class="literal">contextConfigLocation</code>&lt;context-param/&gt; section (in the same file) that defines which set of Spring XML configuration files to load.</p> 
   <p>Find below the &lt;listener/&gt; configuration:</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;listener&gt;</span>
    <span class="hl-tag">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="hl-tag">&lt;/listener-class&gt;</span>
<span class="hl-tag">&lt;/listener&gt;</span></pre> 
   <p>Find below the &lt;context-param/&gt; configuration:</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;context-param&gt;</span>
    <span class="hl-tag">&lt;param-name&gt;</span>contextConfigLocation<span class="hl-tag">&lt;/param-name&gt;</span>
    <span class="hl-tag">&lt;param-value&gt;</span>/WEB-INF/applicationContext*.xml<span class="hl-tag">&lt;/param-value&gt;</span>
<span class="hl-tag">&lt;/context-param&gt;</span></pre> 
   <p>If you dont specify the <code class="literal">contextConfigLocation</code> context parameter, the <code class="literal">ContextLoaderListener</code> will look for a file called <code class="literal">/WEB-INF/applicationContext.xml</code> to load. Once the context files are loaded, Spring creates a <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/context/WebApplicationContext.html" target="_top"><code class="literal">WebApplicationContext</code></a> object based on the bean definitions and stores it in the <code class="literal">ServletContext</code> of the web application.</p> 
   <p>All Java web frameworks are built on top of the Servlet API, and so one can use the following code snippet to get access to this <span class="emphasis"><em>business context</em></span> <code class="literal">ApplicationContext</code> created by the <code class="literal">ContextLoaderListener</code>.</p> 
   <pre class="programlisting">WebApplicationContext ctx = WebApplicationContextUtils.getWebApplicationContext(servletContext);</pre> 
   <p>The <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/context/support/WebApplicationContextUtils.html" target="_top"><code class="literal">WebApplicationContextUtils</code></a> class is for convenience, so you dont have to remember the name of the <code class="literal">ServletContext</code> attribute. Its <span class="emphasis"><em>getWebApplicationContext()</em></span> method will return <code class="literal">null</code> if an object doesnt exist under the <code class="literal">WebApplicationContext.ROOT_WEB_APPLICATION_CONTEXT_ATTRIBUTE</code> key. Rather than risk getting <code class="literal">NullPointerExceptions</code> in your application, its better to use the <code class="literal">getRequiredWebApplicationContext()</code> method. This method throws an exception when the <code class="literal">ApplicationContext</code> is missing.</p> 
   <p>Once you have a reference to the <code class="literal">WebApplicationContext</code>, you can retrieve beans by their name or type. Most developers retrieve beans by name and then cast them to one of their implemented interfaces.</p> 
   <p>Fortunately, most of the frameworks in this section have simpler ways of looking up beans. Not only do they make it easy to get beans from a Spring container, but they also allow you to use dependency injection on their controllers. Each web framework section has more detail on its specific integration strategies.</p> 
  </div> 
  <div class="section" title="18.3&nbsp;JavaServer Faces 1.2">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="jsf"></a>18.3&nbsp;JavaServer Faces 1.2</h2>
     </div>
    </div>
   </div> 
   <p>JavaServer Faces (JSF) is the JCPs standard component-based, event-driven web user interface framework. As of Java EE 5, it is an official part of the Java EE umbrella.</p> 
   <p>For a popular JSF runtime as well as for popular JSF component libraries, check out the <a class="ulink" href="http://myfaces.apache.org/" target="_top">Apache MyFaces project</a>. The MyFaces project also provides common JSF extensions such as <a class="ulink" href="http://myfaces.apache.org/orchestra/" target="_top">MyFaces Orchestra</a>: a Spring-based JSF extension that provides rich conversation scope support.</p> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>Spring Web Flow 2.0 provides rich JSF support through its newly established Spring Faces module, both for JSF-centric usage (as described in this section) and for Spring-centric usage (using JSF views within a Spring MVC dispatcher). Check out the <a class="ulink" href="http://projects.spring.io/spring-webflow" target="_top">Spring Web Flow website</a> for details!</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <p>The key element in Springs JSF integration is the JSF <code class="literal">ELResolver</code> mechanism.</p> 
   <div class="section" title="18.3.1&nbsp;SpringBeanFacesELResolver (JSF 1.2+)">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jsf-springbeanfaceselresolver"></a>18.3.1&nbsp;SpringBeanFacesELResolver (JSF 1.2+)</h3>
      </div>
     </div>
    </div> 
    <p><code class="literal">SpringBeanFacesELResolver</code> is a JSF 1.2 compliant <code class="literal">ELResolver</code> implementation, integrating with the standard Unified EL as used by JSF 1.2 and JSP 2.1. Like <code class="literal">SpringBeanVariableResolver</code>, it delegates to the Springs <span class="emphasis"><em>business context</em></span> <code class="literal">WebApplicationContext</code> <span class="emphasis"><em>first</em></span>, then to the default resolver of the underlying JSF implementation.</p> 
    <p>Configuration-wise, simply define <code class="literal">SpringBeanFacesELResolver</code> in your JSF 1.2 <span class="emphasis"><em>faces-context.xml</em></span> file:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;faces-config&gt;</span>
    <span class="hl-tag">&lt;application&gt;</span>
        <span class="hl-tag">&lt;el-resolver&gt;</span>org.springframework.web.jsf.el.SpringBeanFacesELResolver<span class="hl-tag">&lt;/el-resolver&gt;</span>
        ...
    <span class="hl-tag">&lt;/application&gt;</span>
<span class="hl-tag">&lt;/faces-config&gt;</span></pre> 
   </div> 
   <div class="section" title="18.3.2&nbsp;FacesContextUtils">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jsf-facescontextutils"></a>18.3.2&nbsp;FacesContextUtils</h3>
      </div>
     </div>
    </div> 
    <p>A custom <code class="literal">VariableResolver</code> works well when mapping ones properties to beans in <span class="emphasis"><em>faces-config.xml</em></span>, but at times one may need to grab a bean explicitly. The <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/jsf/FacesContextUtils.html" target="_top"><code class="literal">FacesContextUtils</code></a> class makes this easy. It is similar to <code class="literal">WebApplicationContextUtils</code>, except that it takes a <code class="literal">FacesContext</code> parameter rather than a <code class="literal">ServletContext</code> parameter.</p> 
    <pre class="programlisting">ApplicationContext ctx = FacesContextUtils.getWebApplicationContext(FacesContext.getCurrentInstance());</pre> 
   </div> 
  </div> 
  <div class="section" title="18.4&nbsp;Apache Struts 2.x">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="struts"></a>18.4&nbsp;Apache Struts 2.x</h2>
     </div>
    </div>
   </div> 
   <p>Invented by Craig McClanahan, <a class="ulink" href="http://struts.apache.org/" target="_top">Struts</a> is an open source project hosted by the Apache Software Foundation. At the time, it greatly simplified the JSP/Servlet programming paradigm and won over many developers who were using proprietary frameworks. It simplified the programming model, it was open source (and thus free as in beer), and it had a large community, which allowed the project to grow and become popular among Java web developers.</p> 
   <p>Check out the Struts <a class="ulink" href="https://struts.apache.org/release/2.3.x/docs/spring-plugin.html" target="_top">Spring Plugin</a> for the built-in Spring integration shipped with Struts.</p> 
  </div> 
  <div class="section" title="18.5&nbsp;Tapestry 5.x">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="tapestry"></a>18.5&nbsp;Tapestry 5.x</h2>
     </div>
    </div>
   </div> 
   <p>From the <a class="ulink" href="http://tapestry.apache.org/" target="_top">Tapestry homepage</a>:</p> 
   <p>Tapestry is a &quot;<span class="emphasis"><em>Component oriented framework for creating dynamic, robust, highly scalable web applications in Java.</em></span>&quot;</p> 
   <p>While Spring has its own <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc" title="16.&nbsp;Web MVC framework">powerful web layer</a>, there are a number of unique advantages to building an enterprise Java application using a combination of Tapestry for the web user interface and the Spring container for the lower layers.</p> 
   <p>For more information, check out Tapestrys dedicated <a class="ulink" href="https://tapestry.apache.org/integrating-with-spring-framework.html" target="_top">integration module for Spring</a>.</p> 
  </div> 
  <div class="section" title="18.6&nbsp;Further Resources">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="web-integration-resources"></a>18.6&nbsp;Further Resources</h2>
     </div>
    </div>
   </div> 
   <p>Find below links to further resources about the various web frameworks described in this chapter.</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem"> The <a class="ulink" href="http://www.oracle.com/technetwork/java/javaee/javaserverfaces-139869.html" target="_top">JSF</a> homepage </li>
     <li class="listitem"> The <a class="ulink" href="http://struts.apache.org/" target="_top">Struts</a> homepage </li>
     <li class="listitem"> The <a class="ulink" href="http://tapestry.apache.org/" target="_top">Tapestry</a> homepage </li>
    </ul>
   </div> 
  </div> 
 </div> 
 <div class="chapter" title="19.&nbsp;Portlet MVC Framework">
  <div class="titlepage">
   <div>
    <div>
     <h2 class="title"><a name="portlet"></a>19.&nbsp;Portlet MVC Framework</h2>
    </div>
   </div>
  </div> 
  <div class="section" title="19.1&nbsp;Introduction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="portlet-introduction"></a>19.1&nbsp;Introduction</h2>
     </div>
    </div>
   </div> 
   <div class="sidebar" title="JSR-168 The Java Portlet Specification">
    <p class="title"><b>JSR-168 The Java Portlet Specification</b></p> 
    <p>For more general information about portlet development, please review a whitepaper from Oracle entitled <a class="ulink" href="http://www.oracle.com/technetwork/java/index-raji-test-141933.html" target="_top">&quot;Introduction to JSR 168&quot;</a>, and of course the <a class="ulink" href="http://jcp.org/aboutJava/communityprocess/final/jsr168/" target="_top">JSR-168 Specification</a> itself.</p> 
   </div> 
   <p>In addition to supporting conventional (servlet-based) Web development, Spring also supports JSR-168 Portlet development. As much as possible, the Portlet MVC framework is a mirror image of the Web MVC framework, and also uses the same underlying view abstractions and integration technology. So, be sure to review the chapters entitled <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc" title="16.&nbsp;Web MVC framework">Chapter&nbsp;16, <i>Web MVC framework</i></a> and <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#view" title="17.&nbsp;View technologies">Chapter&nbsp;17, <i>View technologies</i></a> before continuing with this chapter.</p> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>Bear in mind that while the concepts of Spring MVC are the same in Spring Portlet MVC, there are some notable differences created by the unique workflow of JSR-168 portlets.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <p>The main way in which portlet workflow differs from servlet workflow is that the request to the portlet can have two distinct phases: the action phase and the render phase. The action phase is executed only once and is where any <span class="emphasis"><em>backend</em></span> changes or actions occur, such as making changes in a database. The render phase then produces what is displayed to the user each time the display is refreshed. The critical point here is that for a single overall request, the action phase is executed only once, but the render phase may be executed multiple times. This provides (and requires) a clean separation between the activities that modify the persistent state of your system and the activities that generate what is displayed to the user.</p> 
   <div class="sidebar" title="Spring Web Flow">
    <p class="title"><b>Spring Web Flow</b></p> 
    <p>Spring Web Flow (SWF) aims to be the best solution for the management of web application page flow.</p> 
    <p>SWF integrates with existing frameworks like Spring MVC, Struts, and JSF, in both servlet and portlet environments. If you have a business process (or processes) that would benefit from a conversational model as opposed to a purely request model, then SWF may be the solution.</p> 
    <p>SWF allows you to capture logical page flows as self-contained modules that are reusable in different situations, and as such is ideal for building web application modules that guide the user through controlled navigations that drive business processes.</p> 
    <p>For more information about SWF, consult the Spring Web Flow website.</p> 
   </div> 
   <p>The dual phases of portlet requests are one of the real strengths of the JSR-168 specification. For example, dynamic search results can be updated routinely on the display without the user explicitly rerunning the search. Most other portlet MVC frameworks attempt to completely hide the two phases from the developer and make it look as much like traditional servlet development as possible - we think this approach removes one of the main benefits of using portlets. So, the separation of the two phases is preserved throughout the Spring Portlet MVC framework. The primary manifestation of this approach is that where the servlet version of the MVC classes will have one method that deals with the request, the portlet version of the MVC classes will have two methods that deal with the request: one for the action phase and one for the render phase. For example, where the servlet version of <code class="literal">AbstractController</code> has the <code class="literal">handleRequestInternal(..)</code> method, the portlet version of <code class="literal">AbstractController</code> has <code class="literal">handleActionRequestInternal(..)</code> and <code class="literal">handleRenderRequestInternal(..)</code> methods.</p> 
   <p>The framework is designed around a <code class="literal">DispatcherPortlet</code> that dispatches requests to handlers, with configurable handler mappings and view resolution, just as the <code class="literal">DispatcherServlet</code> in the web framework does. File upload is also supported in the same way.</p> 
   <p>Locale resolution and theme resolution are not supported in Portlet MVC - these areas are in the purview of the portal/portlet container and are not appropriate at the Spring level. However, all mechanisms in Spring that depend on the locale (such as internationalization of messages) will still function properly because <code class="literal">DispatcherPortlet</code> exposes the current locale in the same way as <code class="literal">DispatcherServlet</code>.</p> 
   <div class="section" title="19.1.1&nbsp;Controllers - The C in MVC">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-introduction-controller"></a>19.1.1&nbsp;Controllers - The C in MVC</h3>
      </div>
     </div>
    </div> 
    <p>The default handler is still a very simple <code class="literal">Controller</code> interface, offering just two methods:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> <code class="literal">void handleActionRequest(request,response)</code> </li>
      <li class="listitem"> <code class="literal">ModelAndView handleRenderRequest(request,response)</code> </li>
     </ul>
    </div> 
    <p>The framework also includes most of the same controller implementation hierarchy, such as <code class="literal">AbstractController</code>, <code class="literal">SimpleFormController</code>, and so on. Data binding, command object usage, model handling, and view resolution are all the same as in the servlet framework.</p> 
   </div> 
   <div class="section" title="19.1.2&nbsp;Views - The V in MVC">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-introduction-view"></a>19.1.2&nbsp;Views - The V in MVC</h3>
      </div>
     </div>
    </div> 
    <p>All the view rendering capabilities of the servlet framework are used directly via a special bridge servlet named <code class="literal">ViewRendererServlet</code>. By using this servlet, the portlet request is converted into a servlet request and the view can be rendered using the entire normal servlet infrastructure. This means all the existing renderers, such as JSP, Velocity, etc., can still be used within the portlet.</p> 
   </div> 
   <div class="section" title="19.1.3&nbsp;Web-scoped beans">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-introduction-scope"></a>19.1.3&nbsp;Web-scoped beans</h3>
      </div>
     </div>
    </div> 
    <p>Spring Portlet MVC supports beans whose lifecycle is scoped to the current HTTP request or HTTP <code class="literal">Session</code> (both normal and global). This is not a specific feature of Spring Portlet MVC itself, but rather of the <code class="literal">WebApplicationContext</code> container(s) that Spring Portlet MVC uses. These bean scopes are described in detail in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes-other" title="4.5.4&nbsp;Request, session, and global session scopes">Section&nbsp;4.5.4, Request, session, and global session scopes</a></p> 
   </div> 
  </div> 
  <div class="section" title="19.2&nbsp;The DispatcherPortlet">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="portlet-dispatcher"></a>19.2&nbsp;The DispatcherPortlet</h2>
     </div>
    </div>
   </div> 
   <p>Portlet MVC is a request-driven web MVC framework, designed around a portlet that dispatches requests to controllers and offers other functionality facilitating the development of portlet applications. Springs <code class="literal">DispatcherPortlet</code> however, does more than just that. It is completely integrated with the Spring <code class="literal">ApplicationContext</code> and allows you to use every other feature Spring has.</p> 
   <p>Like ordinary portlets, the <code class="literal">DispatcherPortlet</code> is declared in the <code class="literal">portlet.xml</code> file of your web application:</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;portlet&gt;</span>
    <span class="hl-tag">&lt;portlet-name&gt;</span>sample<span class="hl-tag">&lt;/portlet-name&gt;</span>
    <span class="hl-tag">&lt;portlet-class&gt;</span>org.springframework.web.portlet.DispatcherPortlet<span class="hl-tag">&lt;/portlet-class&gt;</span>
    <span class="hl-tag">&lt;supports&gt;</span>
        <span class="hl-tag">&lt;mime-type&gt;</span>text/html<span class="hl-tag">&lt;/mime-type&gt;</span>
        <span class="hl-tag">&lt;portlet-mode&gt;</span>view<span class="hl-tag">&lt;/portlet-mode&gt;</span>
    <span class="hl-tag">&lt;/supports&gt;</span>
    <span class="hl-tag">&lt;portlet-info&gt;</span>
        <span class="hl-tag">&lt;title&gt;</span>Sample Portlet<span class="hl-tag">&lt;/title&gt;</span>
    <span class="hl-tag">&lt;/portlet-info&gt;</span>
<span class="hl-tag">&lt;/portlet&gt;</span></pre> 
   <p>The <code class="literal">DispatcherPortlet</code> now needs to be configured.</p> 
   <p>In the Portlet MVC framework, each <code class="literal">DispatcherPortlet</code> has its own <code class="literal">WebApplicationContext</code>, which inherits all the beans already defined in the Root <code class="literal">WebApplicationContext</code>. These inherited beans can be overridden in the portlet-specific scope, and new scope-specific beans can be defined local to a given portlet instance.</p> 
   <p>The framework will, on initialization of a <code class="literal">DispatcherPortlet</code>, look for a file named <code class="literal">[portlet-name]-portlet.xml</code> in the <code class="literal">WEB-INF</code> directory of your web application and create the beans defined there (overriding the definitions of any beans defined with the same name in the global scope).</p> 
   <p>The config location used by the <code class="literal">DispatcherPortlet</code> can be modified through a portlet initialization parameter (see below for details).</p> 
   <p>The Spring <code class="literal">DispatcherPortlet</code> has a few special beans it uses, in order to be able to process requests and render the appropriate views. These beans are included in the Spring framework and can be configured in the <code class="literal">WebApplicationContext</code>, just as any other bean would be configured. Each of those beans is described in more detail below. Right now, well just mention them, just to let you know they exist and to enable us to go on talking about the <code class="literal">DispatcherPortlet</code>. For most of the beans, defaults are provided so you dont have to worry about configuring them.</p> 
   <div class="table">
    <a name="portlet-webappctx-special-beans-tbl"></a>
    <p class="title"><b>Table&nbsp;19.1.&nbsp;Special beans in the WebApplicationContext</b></p>
    <div class="table-contents"> 
     <table summary="Special beans in the WebApplicationContext" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
      <colgroup>
       <col />
       <col />
      </colgroup>
      <thead>
       <tr>
        <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Expression</th>
        <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explanation</th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>handler mapping(s)</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>(<a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#portlet-handlermapping" title="19.5&nbsp;Handler mappings">Section&nbsp;19.5, Handler mappings</a>) a list of pre- and post-processors and controllers that will be executed if they match certain criteria (for instance a matching portlet mode specified with the controller)</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>controller(s)</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>(<a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#portlet-controller" title="19.4&nbsp;Controllers">Section&nbsp;19.4, Controllers</a>) the beans providing the actual functionality (or at least, access to the functionality) as part of the MVC triad</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>view resolver</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>(<a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#portlet-viewresolver" title="19.6&nbsp;Views and resolving them">Section&nbsp;19.6, Views and resolving them</a>) capable of resolving view names to view definitions</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>multipart resolver</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>(<a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#portlet-multipart" title="19.7&nbsp;Multipart (file upload) support">Section&nbsp;19.7, Multipart (file upload) support</a>) offers functionality to process file uploads from HTML forms</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>handler exception resolver</p></td>
        <td style="" align="left" valign="top"><p>(<a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#portlet-exceptionresolver" title="19.8&nbsp;Handling exceptions">Section&nbsp;19.8, Handling exceptions</a>) offers functionality to map exceptions to views or implement other more complex exception handling code</p></td>
       </tr>
      </tbody>
     </table> 
    </div>
   </div>
   <br class="table-break" /> 
   <p>When a <code class="literal">DispatcherPortlet</code> is setup for use and a request comes in for that specific <code class="literal">DispatcherPortlet</code>, it starts processing the request. The list below describes the complete process a request goes through if handled by a <code class="literal">DispatcherPortlet</code>:</p> 
   <div class="orderedlist">
    <ol class="orderedlist" type="1">
     <li class="listitem"> The locale returned by <code class="literal">PortletRequest.getLocale()</code> is bound to the request to let elements in the process resolve the locale to use when processing the request (rendering the view, preparing data, etc.). </li>
     <li class="listitem"> If a multipart resolver is specified and this is an <code class="literal">ActionRequest</code>, the request is inspected for multiparts and if they are found, it is wrapped in a <code class="literal">MultipartActionRequest</code> for further processing by other elements in the process. (See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#portlet-multipart" title="19.7&nbsp;Multipart (file upload) support">Section&nbsp;19.7, Multipart (file upload) support</a> for further information about multipart handling). </li>
     <li class="listitem"> An appropriate handler is searched for. If a handler is found, the execution chain associated with the handler (pre-processors, post-processors, controllers) will be executed in order to prepare a model. </li>
     <li class="listitem"> If a model is returned, the view is rendered, using the view resolver that has been configured with the <code class="literal">WebApplicationContext</code>. If no model is returned (which could be due to a pre- or post-processor intercepting the request, for example, for security reasons), no view is rendered, since the request could already have been fulfilled. </li>
    </ol>
   </div> 
   <p>Exceptions that are thrown during processing of the request get picked up by any of the handler exception resolvers that are declared in the <code class="literal">WebApplicationContext</code>. Using these exception resolvers you can define custom behavior in case such exceptions get thrown.</p> 
   <p>You can customize Springs <code class="literal">DispatcherPortlet</code> by adding context parameters in the <code class="literal">portlet.xml</code> file or portlet init-parameters. The possibilities are listed below.</p> 
   <div class="table">
    <a name="portlet-dpp-init-params"></a>
    <p class="title"><b>Table&nbsp;19.2.&nbsp;DispatcherPortlet initialization parameters</b></p>
    <div class="table-contents"> 
     <table summary="DispatcherPortlet initialization parameters" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
      <colgroup>
       <col />
       <col />
      </colgroup>
      <thead>
       <tr>
        <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Parameter</th>
        <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explanation</th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">contextClass</code></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Class that implements <code class="literal">WebApplicationContext</code>, which will be used to instantiate the context used by this portlet. If this parameter isnt specified, the <code class="literal">XmlPortletApplicationContext</code> will be used.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">contextConfigLocation</code></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>String which is passed to the context instance (specified by <code class="literal">contextClass</code>) to indicate where context(s) can be found. The String is potentially split up into multiple Strings (using a comma as a delimiter) to support multiple contexts (in case of multiple context locations, for beans that are defined twice, the latest takes precedence).</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">namespace</code></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The namespace of the <code class="literal">WebApplicationContext</code>. Defaults to <code class="literal">[portlet-name]-portlet</code>.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">viewRendererUrl</code></p></td>
        <td style="" align="left" valign="top"><p>The URL at which <code class="literal">DispatcherPortlet</code> can access an instance of <code class="literal">ViewRendererServlet</code> (see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#portlet-viewservlet" title="19.3&nbsp;The ViewRendererServlet">Section&nbsp;19.3, The ViewRendererServlet</a>).</p></td>
       </tr>
      </tbody>
     </table> 
    </div>
   </div>
   <br class="table-break" /> 
  </div> 
  <div class="section" title="19.3&nbsp;The ViewRendererServlet">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="portlet-viewservlet"></a>19.3&nbsp;The ViewRendererServlet</h2>
     </div>
    </div>
   </div> 
   <p>The rendering process in Portlet MVC is a bit more complex than in Web MVC. In order to reuse all the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#view" title="17.&nbsp;View technologies">view technologies</a> from Spring Web MVC, we must convert the <code class="literal">PortletRequest</code> / <code class="literal">PortletResponse</code> to <code class="literal">HttpServletRequest</code> / <code class="literal">HttpServletResponse</code> and then call the <code class="literal">render</code> method of the <code class="literal">View</code>. To do this, <code class="literal">DispatcherPortlet</code> uses a special servlet that exists for just this purpose: the <code class="literal">ViewRendererServlet</code>.</p> 
   <p>In order for <code class="literal">DispatcherPortlet</code> rendering to work, you must declare an instance of the <code class="literal">ViewRendererServlet</code> in the <code class="literal">web.xml</code> file for your web application as follows:</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;servlet&gt;</span>
    <span class="hl-tag">&lt;servlet-name&gt;</span>ViewRendererServlet<span class="hl-tag">&lt;/servlet-name&gt;</span>
    <span class="hl-tag">&lt;servlet-class&gt;</span>org.springframework.web.servlet.ViewRendererServlet<span class="hl-tag">&lt;/servlet-class&gt;</span>
<span class="hl-tag">&lt;/servlet&gt;</span>

<span class="hl-tag">&lt;servlet-mapping&gt;</span>
    <span class="hl-tag">&lt;servlet-name&gt;</span>ViewRendererServlet<span class="hl-tag">&lt;/servlet-name&gt;</span>
    <span class="hl-tag">&lt;url-pattern&gt;</span>/WEB-INF/servlet/view<span class="hl-tag">&lt;/url-pattern&gt;</span>
<span class="hl-tag">&lt;/servlet-mapping&gt;</span></pre> 
   <p>To perform the actual rendering, <code class="literal">DispatcherPortlet</code> does the following:</p> 
   <div class="orderedlist">
    <ol class="orderedlist" type="1">
     <li class="listitem"> Binds the <code class="literal">WebApplicationContext</code> to the request as an attribute under the same <code class="literal">WEB_APPLICATION_CONTEXT_ATTRIBUTE</code> key that <code class="literal">DispatcherServlet</code> uses. </li>
     <li class="listitem"> Binds the <code class="literal">Model</code> and <code class="literal">View</code> objects to the request to make them available to the <code class="literal">ViewRendererServlet</code>. </li>
     <li class="listitem"> Constructs a <code class="literal">PortletRequestDispatcher</code> and performs an <code class="literal">include</code> using the <code class="literal">/WEB- INF/servlet/view</code> URL that is mapped to the <code class="literal">ViewRendererServlet</code>. </li>
    </ol>
   </div> 
   <p>The <code class="literal">ViewRendererServlet</code> is then able to call the <code class="literal">render</code> method on the <code class="literal">View</code> with the appropriate arguments.</p> 
   <p>The actual URL for the <code class="literal">ViewRendererServlet</code> can be changed using <code class="literal">DispatcherPortlet</code>'s <code class="literal">viewRendererUrl</code> configuration parameter.</p> 
  </div> 
  <div class="section" title="19.4&nbsp;Controllers">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="portlet-controller"></a>19.4&nbsp;Controllers</h2>
     </div>
    </div>
   </div> 
   <p>The controllers in Portlet MVC are very similar to the Web MVC Controllers, and porting code from one to the other should be simple.</p> 
   <p>The basis for the Portlet MVC controller architecture is the <code class="literal">org.springframework.web.portlet.mvc.Controller</code> interface, which is listed below.</p> 
   <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Controller {

    <b class="hl-tag" style="color: blue">/**
     * Process the render request and return a ModelAndView object which the
     * DispatcherPortlet will render.
     */</b>
    ModelAndView handleRenderRequest(RenderRequest request,
            RenderResponse response) <span class="hl-keyword">throws</span> Exception;

    <b class="hl-tag" style="color: blue">/**
     * Process the action request. There is nothing to return.
     */</b>
    <span class="hl-keyword">void</span> handleActionRequest(ActionRequest request,
            ActionResponse response) <span class="hl-keyword">throws</span> Exception;

}</pre> 
   <p>As you can see, the Portlet <code class="literal">Controller</code> interface requires two methods that handle the two phases of a portlet request: the action request and the render request. The action phase should be capable of handling an action request, and the render phase should be capable of handling a render request and returning an appropriate model and view. While the <code class="literal">Controller</code> interface is quite abstract, Spring Portlet MVC offers several controllers that already contain a lot of the functionality you might need; most of these are very similar to controllers from Spring Web MVC. The <code class="literal">Controller</code> interface just defines the most common functionality required of every controller: handling an action request, handling a render request, and returning a model and a view.</p> 
   <div class="section" title="19.4.1&nbsp;AbstractController and PortletContentGenerator">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-controller-abstractcontroller"></a>19.4.1&nbsp;AbstractController and PortletContentGenerator</h3>
      </div>
     </div>
    </div> 
    <p>Of course, just a <code class="literal">Controller</code> interface isnt enough. To provide a basic infrastructure, all of Spring Portlet MVCs <code class="literal">Controller</code> s inherit from <code class="literal">AbstractController</code>, a class offering access to Springs <code class="literal">ApplicationContext</code> and control over caching.</p> 
    <div class="table">
     <a name="portlet-ac-features"></a>
     <p class="title"><b>Table&nbsp;19.3.&nbsp;Features offered by the AbstractController</b></p>
     <div class="table-contents"> 
      <table summary="Features offered by the AbstractController" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
       <colgroup>
        <col />
        <col />
       </colgroup>
       <thead>
        <tr>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Parameter</th>
         <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explanation</th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">requireSession</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Indicates whether or not this <code class="literal">Controller</code> requires a session to do its work. This feature is offered to all controllers. If a session is not present when such a controller receives a request, the user is informed using a <code class="literal">SessionRequiredException</code>.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">synchronizeSession</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Use this if you want handling by this controller to be synchronized on the users session. To be more specific, the extending controller will override the <code class="literal">handleRenderRequestInternal(..)</code> and <code class="literal">handleActionRequestInternal(..)</code> methods, which will be synchronized on the users session if you specify this variable.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">renderWhenMinimized</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>If you want your controller to actually render the view when the portlet is in a minimized state, set this to true. By default, this is set to false so that portlets that are in a minimized state dont display any content.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">cacheSeconds</code></p></td>
         <td style="" align="left" valign="top"><p>When you want a controller to override the default cache expiration defined for the portlet, specify a positive integer here. By default it is set to <code class="literal">-1</code>, which does not change the default caching. Setting it to <code class="literal">0</code> will ensure the result is never cached.</p></td>
        </tr>
       </tbody>
      </table> 
     </div>
    </div>
    <br class="table-break" /> 
    <p>The <code class="literal">requireSession</code> and <code class="literal">cacheSeconds</code> properties are declared on the <code class="literal">PortletContentGenerator</code> class, which is the superclass of <code class="literal">AbstractController</code>) but are included here for completeness.</p> 
    <p>When using the <code class="literal">AbstractController</code> as a base class for your controllers (which is not recommended since there are a lot of other controllers that might already do the job for you) you only have to override either the <code class="literal">handleActionRequestInternal(ActionRequest, ActionResponse)</code> method or the <code class="literal">handleRenderRequestInternal(RenderRequest, RenderResponse)</code> method (or both), implement your logic, and return a <code class="literal">ModelAndView</code> object (in the case of <code class="literal">handleRenderRequestInternal</code>).</p> 
    <p>The default implementations of both <code class="literal">handleActionRequestInternal(..)</code> and <code class="literal">handleRenderRequestInternal(..)</code> throw a <code class="literal">PortletException</code>. This is consistent with the behavior of <code class="literal">GenericPortlet</code> from the JSR- 168 Specification API. So you only need to override the method that your controller is intended to handle.</p> 
    <p>Here is short example consisting of a class and a declaration in the web application context.</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> samples;

<span class="hl-keyword">import</span> javax.portlet.RenderRequest;
<span class="hl-keyword">import</span> javax.portlet.RenderResponse;

<span class="hl-keyword">import</span> org.springframework.web.portlet.mvc.AbstractController;
<span class="hl-keyword">import</span> org.springframework.web.portlet.ModelAndView;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SampleController <span class="hl-keyword">extends</span> AbstractController {

    <span class="hl-keyword">public</span> ModelAndView handleRenderRequestInternal(RenderRequest request, RenderResponse response) {
        ModelAndView mav = <span class="hl-keyword">new</span> ModelAndView(<span class="hl-string">&quot;foo&quot;</span>);
        mav.addObject(<span class="hl-string">&quot;message&quot;</span>, <span class="hl-string">&quot;Hello World!&quot;</span>);
        <span class="hl-keyword">return</span> mav;
    }

}</pre> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;sampleController&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;samples.SampleController&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;cacheSeconds&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;120&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>The class above and the declaration in the web application context is all you need besides setting up a handler mapping (see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#portlet-handlermapping" title="19.5&nbsp;Handler mappings">Section&nbsp;19.5, Handler mappings</a>) to get this very simple controller working.</p> 
   </div> 
   <div class="section" title="19.4.2&nbsp;Other simple controllers">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-controller-simple"></a>19.4.2&nbsp;Other simple controllers</h3>
      </div>
     </div>
    </div> 
    <p>Although you can extend <code class="literal">AbstractController</code>, Spring Portlet MVC provides a number of concrete implementations which offer functionality that is commonly used in simple MVC applications.</p> 
    <p>The <code class="literal">ParameterizableViewController</code> is basically the same as the example above, except for the fact that you can specify the view name that it will return in the web application context (no need to hard-code the view name).</p> 
    <p>The <code class="literal">PortletModeNameViewController</code> uses the current mode of the portlet as the view name. So, if your portlet is in View mode (i.e. <code class="literal">PortletMode.VIEW</code>) then it uses &quot;view&quot; as the view name.</p> 
   </div> 
   <div class="section" title="19.4.3&nbsp;Command Controllers">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-controller-command"></a>19.4.3&nbsp;Command Controllers</h3>
      </div>
     </div>
    </div> 
    <p>Spring Portlet MVC has the exact same hierarchy of <span class="emphasis"><em>command controllers</em></span> as Spring Web MVC. They provide a way to interact with data objects and dynamically bind parameters from the <code class="literal">PortletRequest</code> to the data object specified. Your data objects dont have to implement a framework-specific interface, so you can directly manipulate your persistent objects if you desire. Lets examine what command controllers are available, to get an overview of what you can do with them:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> <code class="literal">AbstractCommandController</code> - a command controller you can use to create your own command controller, capable of binding request parameters to a data object you specify. This class does not offer form functionality, it does however offer validation features and lets you specify in the controller itself what to do with the command object that has been filled with the parameters from the request. </li>
      <li class="listitem"> <code class="literal">AbstractFormController</code> - an abstract controller offering form submission support. Using this controller you can model forms and populate them using a command object you retrieve in the controller. After a user has filled the form, <code class="literal">AbstractFormController</code> binds the fields, validates, and hands the object back to the controller to take appropriate action. Supported features are: invalid form submission (resubmission), validation, and normal form workflow. You implement methods to determine which views are used for form presentation and success. Use this controller if you need forms, but dont want to specify what views youre going to show the user in the application context. </li>
      <li class="listitem"> <code class="literal">SimpleFormController</code> - a concrete <code class="literal">AbstractFormController</code> that provides even more support when creating a form with a corresponding command object. The <code class="literal">SimpleFormController</code> lets you specify a command object, a viewname for the form, a viewname for the page you want to show the user when form submission has succeeded, and more. </li>
      <li class="listitem"> <code class="literal">AbstractWizardFormController</code>&#x2009;&#x2009;a concrete <code class="literal">AbstractFormController</code> that provides a wizard-style interface for editing the contents of a command object across multiple display pages. Supports multiple user actions: finish, cancel, or page change, all of which are easily specified in request parameters from the view. </li>
     </ul>
    </div> 
    <p>These command controllers are quite powerful, but they do require a detailed understanding of how they operate in order to use them efficiently. Carefully review the Javadocs for this entire hierarchy and then look at some sample implementations before you start using them.</p> 
   </div> 
   <div class="section" title="19.4.4&nbsp;PortletWrappingController">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-controller-wrapping"></a>19.4.4&nbsp;PortletWrappingController</h3>
      </div>
     </div>
    </div> 
    <p>Instead of developing new controllers, it is possible to use existing portlets and map requests to them from a <code class="literal">DispatcherPortlet</code>. Using the <code class="literal">PortletWrappingController</code>, you can instantiate an existing <code class="literal">Portlet</code> as a <code class="literal">Controller</code> as follows:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myPortlet&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.portlet.mvc.PortletWrappingController&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;portletClass&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;sample.MyPortlet&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;portletName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;my-portlet&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;initParameters&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;value&gt;</span>config=/WEB-INF/my-portlet-config.xml<span class="hl-tag">&lt;/value&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>This can be very valuable since you can then use interceptors to pre-process and post-process requests going to these portlets. Since JSR-168 does not support any kind of filter mechanism, this is quite handy. For example, this can be used to wrap the Hibernate <code class="literal">OpenSessionInViewInterceptor</code> around a MyFaces JSF Portlet.</p> 
   </div> 
  </div> 
  <div class="section" title="19.5&nbsp;Handler mappings">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="portlet-handlermapping"></a>19.5&nbsp;Handler mappings</h2>
     </div>
    </div>
   </div> 
   <p>Using a handler mapping you can map incoming portlet requests to appropriate handlers. There are some handler mappings you can use out of the box, for example, the <code class="literal">PortletModeHandlerMapping</code>, but lets first examine the general concept of a <code class="literal">HandlerMapping</code>.</p> 
   <p>Note: We are intentionally using the term &quot;Handler&quot; here instead of &quot;Controller&quot;. <code class="literal">DispatcherPortlet</code> is designed to be used with other ways to process requests than just Spring Portlet MVCs own Controllers. A Handler is any Object that can handle portlet requests. Controllers are an example of Handlers, and they are of course the default. To use some other framework with <code class="literal">DispatcherPortlet</code>, a corresponding implementation of <code class="literal">HandlerAdapter</code> is all that is needed.</p> 
   <p>The functionality a basic <code class="literal">HandlerMapping</code> provides is the delivering of a <code class="literal">HandlerExecutionChain</code>, which must contain the handler that matches the incoming request, and may also contain a list of handler interceptors that are applied to the request. When a request comes in, the <code class="literal">DispatcherPortlet</code> will hand it over to the handler mapping to let it inspect the request and come up with an appropriate <code class="literal">HandlerExecutionChain</code>. Then the <code class="literal">DispatcherPortlet</code> will execute the handler and interceptors in the chain (if any). These concepts are all exactly the same as in Spring Web MVC.</p> 
   <p>The concept of configurable handler mappings that can optionally contain interceptors (executed before or after the actual handler was executed, or both) is extremely powerful. A lot of supporting functionality can be built into a custom <code class="literal">HandlerMapping</code>. Think of a custom handler mapping that chooses a handler not only based on the portlet mode of the request coming in, but also on a specific state of the session associated with the request.</p> 
   <p>In Spring Web MVC, handler mappings are commonly based on URLs. Since there is really no such thing as a URL within a Portlet, we must use other mechanisms to control mappings. The two most common are the portlet mode and a request parameter, but anything available to the portlet request can be used in a custom handler mapping.</p> 
   <p>The rest of this section describes three of Spring Portlet MVCs most commonly used handler mappings. They all extend <code class="literal">AbstractHandlerMapping</code> and share the following properties:</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem"> <code class="literal">interceptors</code>: The list of interceptors to use. <code class="literal">HandlerInterceptor</code> s are discussed in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#portlet-handlermapping-interceptor" title="19.5.4&nbsp;Adding HandlerInterceptors">Section&nbsp;19.5.4, Adding HandlerInterceptors</a>. </li>
     <li class="listitem"> <code class="literal">defaultHandler</code>: The default handler to use, when this handler mapping does not result in a matching handler. </li>
     <li class="listitem"> <code class="literal">order</code>: Based on the value of the order property (see the <code class="literal">org.springframework.core.Ordered</code> interface), Spring will sort all handler mappings available in the context and apply the first matching handler. </li>
     <li class="listitem"> <code class="literal">lazyInitHandlers</code>: Allows for lazy initialization of singleton handlers (prototype handlers are always lazily initialized). Default value is false. This property is directly implemented in the three concrete Handlers. </li>
    </ul>
   </div> 
   <div class="section" title="19.5.1&nbsp;PortletModeHandlerMapping">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-handlermapping-portletmode"></a>19.5.1&nbsp;PortletModeHandlerMapping</h3>
      </div>
     </div>
    </div> 
    <p>This is a simple handler mapping that maps incoming requests based on the current mode of the portlet (e.g. <span class="emphasis"><em>view</em></span>, <span class="emphasis"><em>edit</em></span>, <span class="emphasis"><em>help</em></span>). An example:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.portlet.handler.PortletModeHandlerMapping&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;portletModeMap&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;map&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;view&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;viewHandler&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;edit&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;editHandler&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;help&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;helpHandler&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/map&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   </div> 
   <div class="section" title="19.5.2&nbsp;ParameterHandlerMapping">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-handlermapping-parameter"></a>19.5.2&nbsp;ParameterHandlerMapping</h3>
      </div>
     </div>
    </div> 
    <p>If we need to navigate around to multiple controllers without changing portlet mode, the simplest way to do this is with a request parameter that is used as the key to control the mapping.</p> 
    <p><code class="literal">ParameterHandlerMapping</code> uses the value of a specific request parameter to control the mapping. The default name of the parameter is <code class="literal">'action'</code>, but can be changed using the <code class="literal">'parameterName'</code> property.</p> 
    <p>The bean configuration for this mapping will look something like this:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.portlet.handler.ParameterHandlerMapping&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;parameterMap&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;map&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;add&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;addItemHandler&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;edit&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;editItemHandler&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;delete&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;deleteItemHandler&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/map&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   </div> 
   <div class="section" title="19.5.3&nbsp;PortletModeParameterHandlerMapping">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-handlermapping-portletmodeparameter"></a>19.5.3&nbsp;PortletModeParameterHandlerMapping</h3>
      </div>
     </div>
    </div> 
    <p>The most powerful built-in handler mapping, <code class="literal">PortletModeParameterHandlerMapping</code> combines the capabilities of the two previous ones to allow different navigation within each portlet mode.</p> 
    <p>Again the default name of the parameter is &quot;action&quot;, but can be changed using the <code class="literal">parameterName</code> property.</p> 
    <p>By default, the same parameter value may not be used in two different portlet modes. This is so that if the portal itself changes the portlet mode, the request will no longer be valid in the mapping. This behavior can be changed by setting the <code class="literal">allowDupParameters</code> property to true. However, this is not recommended.</p> 
    <p>The bean configuration for this mapping will look something like this:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.portlet.handler.PortletModeParameterHandlerMapping&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;portletModeParameterMap&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;map&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;view&quot;</span><span class="hl-tag">&gt;</span> <span class="hl-comment">&lt;!-- </span><span class="emphasis"><em>view</em></span> portlet mode --&gt;
                <span class="hl-tag">&lt;map&gt;</span>
                    <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;add&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;addItemHandler&quot;</span><span class="hl-tag">/&gt;</span>
                    <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;edit&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;editItemHandler&quot;</span><span class="hl-tag">/&gt;</span>
                    <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;delete&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;deleteItemHandler&quot;</span><span class="hl-tag">/&gt;</span>
                <span class="hl-tag">&lt;/map&gt;</span>
            <span class="hl-tag">&lt;/entry&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;edit&quot;</span><span class="hl-tag">&gt;</span> <span class="hl-comment">&lt;!-- </span><span class="emphasis"><em>edit</em></span> portlet mode --&gt;
                <span class="hl-tag">&lt;map&gt;</span>
                    <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;prefs&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;prefsHandler&quot;</span><span class="hl-tag">/&gt;</span>
                    <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;resetPrefs&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;resetPrefsHandler&quot;</span><span class="hl-tag">/&gt;</span>
                <span class="hl-tag">&lt;/map&gt;</span>
            <span class="hl-tag">&lt;/entry&gt;</span>
        <span class="hl-tag">&lt;/map&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>This mapping can be chained ahead of a <code class="literal">PortletModeHandlerMapping</code>, which can then provide defaults for each mode and an overall default as well.</p> 
   </div> 
   <div class="section" title="19.5.4&nbsp;Adding HandlerInterceptors">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-handlermapping-interceptor"></a>19.5.4&nbsp;Adding HandlerInterceptors</h3>
      </div>
     </div>
    </div> 
    <p>Springs handler mapping mechanism has a notion of handler interceptors, which can be extremely useful when you want to apply specific functionality to certain requests, for example, checking for a principal. Again Spring Portlet MVC implements these concepts in the same way as Web MVC.</p> 
    <p>Interceptors located in the handler mapping must implement <code class="literal">HandlerInterceptor</code> from the <code class="literal">org.springframework.web.portlet</code> package. Just like the servlet version, this interface defines three methods: one that will be called before the actual handler will be executed ( <code class="literal">preHandle</code>), one that will be called after the handler is executed ( <code class="literal">postHandle</code>), and one that is called after the complete request has finished ( <code class="literal">afterCompletion</code>). These three methods should provide enough flexibility to do all kinds of pre- and post- processing.</p> 
    <p>The <code class="literal">preHandle</code> method returns a boolean value. You can use this method to break or continue the processing of the execution chain. When this method returns <code class="literal">true</code>, the handler execution chain will continue. When it returns <code class="literal">false</code>, the <code class="literal">DispatcherPortlet</code> assumes the interceptor itself has taken care of requests (and, for example, rendered an appropriate view) and does not continue executing the other interceptors and the actual handler in the execution chain.</p> 
    <p>The <code class="literal">postHandle</code> method is only called on a <code class="literal">RenderRequest</code>. The <code class="literal">preHandle</code> and <code class="literal">afterCompletion</code> methods are called on both an <code class="literal">ActionRequest</code> and a <code class="literal">RenderRequest</code>. If you need to execute logic in these methods for just one type of request, be sure to check what kind of request it is before processing it.</p> 
   </div> 
   <div class="section" title="19.5.5&nbsp;HandlerInterceptorAdapter">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-handlermapping-interceptoradapter"></a>19.5.5&nbsp;HandlerInterceptorAdapter</h3>
      </div>
     </div>
    </div> 
    <p>As with the servlet package, the portlet package has a concrete implementation of <code class="literal">HandlerInterceptor</code> called <code class="literal">HandlerInterceptorAdapter</code>. This class has empty versions of all the methods so that you can inherit from this class and implement just one or two methods when that is all you need.</p> 
   </div> 
   <div class="section" title="19.5.6&nbsp;ParameterMappingInterceptor">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-handlermapping-parameterinterceptor"></a>19.5.6&nbsp;ParameterMappingInterceptor</h3>
      </div>
     </div>
    </div> 
    <p>The portlet package also has a concrete interceptor named <code class="literal">ParameterMappingInterceptor</code> that is meant to be used directly with <code class="literal">ParameterHandlerMapping</code> and <code class="literal">PortletModeParameterHandlerMapping</code>. This interceptor will cause the parameter that is being used to control the mapping to be forwarded from an <code class="literal">ActionRequest</code> to the subsequent <code class="literal">RenderRequest</code>. This will help ensure that the <code class="literal">RenderRequest</code> is mapped to the same Handler as the <code class="literal">ActionRequest</code>. This is done in the <code class="literal">preHandle</code> method of the interceptor, so you can still modify the parameter value in your handler to change where the <code class="literal">RenderRequest</code> will be mapped.</p> 
    <p>Be aware that this interceptor is calling <code class="literal">setRenderParameter</code> on the <code class="literal">ActionResponse</code>, which means that you cannot call <code class="literal">sendRedirect</code> in your handler when using this interceptor. If you need to do external redirects then you will either need to forward the mapping parameter manually or write a different interceptor to handle this for you.</p> 
   </div> 
  </div> 
  <div class="section" title="19.6&nbsp;Views and resolving them">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="portlet-viewresolver"></a>19.6&nbsp;Views and resolving them</h2>
     </div>
    </div>
   </div> 
   <p>As mentioned previously, Spring Portlet MVC directly reuses all the view technologies from Spring Web MVC. This includes not only the various <code class="literal">View</code> implementations themselves, but also the <code class="literal">ViewResolver</code> implementations. For more information, refer to <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#view" title="17.&nbsp;View technologies">Chapter&nbsp;17, <i>View technologies</i></a> and <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-viewresolver" title="16.5&nbsp;Resolving views">Section&nbsp;16.5, Resolving views</a> respectively.</p> 
   <p>A few items on using the existing <code class="literal">View</code> and <code class="literal">ViewResolver</code> implementations are worth mentioning:</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem"> Most portals expect the result of rendering a portlet to be an HTML fragment. So, things like JSP/JSTL, Velocity, FreeMarker, and XSLT all make sense. But it is unlikely that views that return other document types will make any sense in a portlet context. </li>
     <li class="listitem"> There is no such thing as an HTTP redirect from within a portlet (the <code class="literal">sendRedirect(..)</code> method of <code class="literal">ActionResponse</code> cannot be used to stay within the portal). So, <code class="literal">RedirectView</code> and use of the <code class="literal">'redirect:'</code> prefix will <span class="emphasis"><em>not</em></span> work correctly from within Portlet MVC. </li>
     <li class="listitem"> It may be possible to use the <code class="literal">'forward:'</code> prefix from within Portlet MVC. However, remember that since you are in a portlet, you have no idea what the current URL looks like. This means you cannot use a relative URL to access other resources in your web application and that you will have to use an absolute URL. </li>
    </ul>
   </div> 
   <p>Also, for JSP development, the new Spring Taglib and the new Spring Form Taglib both work in portlet views in exactly the same way that they work in servlet views.</p> 
  </div> 
  <div class="section" title="19.7&nbsp;Multipart (file upload) support">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="portlet-multipart"></a>19.7&nbsp;Multipart (file upload) support</h2>
     </div>
    </div>
   </div> 
   <p>Spring Portlet MVC has built-in multipart support to handle file uploads in portlet applications, just like Web MVC does. The design for the multipart support is done with pluggable <code class="literal">PortletMultipartResolver</code> objects, defined in the <code class="literal">org.springframework.web.portlet.multipart</code> package. Spring provides a <code class="literal">PortletMultipartResolver</code> for use with <a class="ulink" href="http://jakarta.apache.org/commons/fileupload" target="_top">Commons FileUpload</a>. How uploading files is supported will be described in the rest of this section.</p> 
   <p>By default, no multipart handling will be done by Spring Portlet MVC, as some developers will want to handle multiparts themselves. You will have to enable it yourself by adding a multipart resolver to the web applications context. After you have done that, <code class="literal">DispatcherPortlet</code> will inspect each request to see if it contains a multipart. If no multipart is found, the request will continue as expected. However, if a multipart is found in the request, the <code class="literal">PortletMultipartResolver</code> that has been declared in your context will be used. After that, the multipart attribute in your request will be treated like any other attribute.</p> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>Any configured <code class="literal">PortletMultipartResolver</code> bean <span class="emphasis"><em>must</em></span> have the following id (or name): &quot; <code class="literal">portletMultipartResolver</code>&quot;. If you have defined your <code class="literal">PortletMultipartResolver</code> with any other name, then the <code class="literal">DispatcherPortlet</code> will <span class="emphasis"><em>not</em></span> find your <code class="literal">PortletMultipartResolver</code>, and consequently no multipart support will be in effect.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <div class="section" title="19.7.1&nbsp;Using the PortletMultipartResolver">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-multipart-resolver"></a>19.7.1&nbsp;Using the PortletMultipartResolver</h3>
      </div>
     </div>
    </div> 
    <p>The following example shows how to use the <code class="literal">CommonsPortletMultipartResolver</code>:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;portletMultipartResolver&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.portlet.multipart.CommonsPortletMultipartResolver&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- one of the properties available; the maximum file size in bytes --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;maxUploadSize&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;100000&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>Of course you also need to put the appropriate jars in your classpath for the multipart resolver to work. In the case of the <code class="literal">CommonsMultipartResolver</code>, you need to use <code class="literal">commons-fileupload.jar</code>. Be sure to use at least version 1.1 of Commons FileUpload as previous versions do not support JSR-168 Portlet applications.</p> 
    <p>Now that you have seen how to set Portlet MVC up to handle multipart requests, lets talk about how to actually use it. When <code class="literal">DispatcherPortlet</code> detects a multipart request, it activates the resolver that has been declared in your context and hands over the request. What the resolver then does is wrap the current <code class="literal">ActionRequest</code> in a <code class="literal">MultipartActionRequest</code> that has support for multipart file uploads. Using the <code class="literal">MultipartActionRequest</code> you can get information about the multiparts contained by this request and actually get access to the multipart files themselves in your controllers.</p> 
    <p>Note that you can only receive multipart file uploads as part of an <code class="literal">ActionRequest</code>, not as part of a <code class="literal">RenderRequest</code>.</p> 
   </div> 
   <div class="section" title="19.7.2&nbsp;Handling a file upload in a form">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-multipart-forms"></a>19.7.2&nbsp;Handling a file upload in a form</h3>
      </div>
     </div>
    </div> 
    <p>After the <code class="literal">PortletMultipartResolver</code> has finished doing its job, the request will be processed like any other. To use the <code class="literal">PortletMultipartResolver</code>, create a form with an upload field (see example below), then let Spring bind the file onto your form (backing object). To actually let the user upload a file, we have to create a (JSP/HTML) form:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;h1&gt;</span>Please upload a file<span class="hl-tag">&lt;/h1&gt;</span>
<span class="hl-tag">&lt;form</span> <span class="hl-attribute">method</span>=<span class="hl-value">&quot;post&quot;</span> <span class="hl-attribute">action</span>=<span class="hl-value">&quot;&lt;portlet:actionURL/&gt;&quot;</span> <span class="hl-attribute">enctype</span>=<span class="hl-value">&quot;multipart/form-data&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;file&quot;</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;file&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;input</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;submit&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/form&gt;</span></pre> 
    <p>As you can see, weve created a field named &quot;file&quot; that matches the property of the bean that holds the <code class="literal">byte[]</code> array. Furthermore weve added the encoding attribute ( <code class="literal">enctype=&quot;multipart/form-data&quot;</code>), which is necessary to let the browser know how to encode the multipart fields (do not forget this!).</p> 
    <p>Just as with any other property thats not automagically convertible to a string or primitive type, to be able to put binary data in your objects you have to register a custom editor with the <code class="literal">PortletRequestDataBinder</code>. There are a couple of editors available for handling files and setting the results on an object. Theres a <code class="literal">StringMultipartFileEditor</code> capable of converting files to Strings (using a user-defined character set), and there is a <code class="literal">ByteArrayMultipartFileEditor</code> which converts files to byte arrays. They function analogous to the <code class="literal">CustomDateEditor</code>.</p> 
    <p>So, to be able to upload files using a form, declare the resolver, a mapping to a controller that will process the bean, and the controller itself.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;portletMultipartResolver&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.portlet.multipart.CommonsPortletMultipartResolver&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.portlet.handler.PortletModeHandlerMapping&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;portletModeMap&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;map&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;view&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;fileUploadController&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/map&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;fileUploadController&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.FileUploadController&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;commandClass&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;examples.FileUploadBean&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;formView&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;fileuploadform&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;successView&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;confirmation&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>After that, create the controller and the actual class to hold the file property.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FileUploadController <span class="hl-keyword">extends</span> SimpleFormController {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> onSubmitAction(ActionRequest request, ActionResponse response,
            Object command, BindException errors) <span class="hl-keyword">throws</span> Exception {

        <span class="hl-comment">// cast the bean</span>
        FileUploadBean bean = (FileUploadBean) command;

        <span class="hl-comment">// let's see if there's content there</span>
        <span class="hl-keyword">byte</span>[] file = bean.getFile();
        <span class="hl-keyword">if</span> (file == null) {
            <span class="hl-comment">// hmm, that's strange, the user did not upload anything</span>
        }

        <span class="hl-comment">// do something with the file here</span>
    }

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> initBinder(PortletRequest request,
            PortletRequestDataBinder binder) <span class="hl-keyword">throws</span> Exception {
        <span class="hl-comment">// to actually be able to convert Multipart instance to byte[]</span>
        <span class="hl-comment">// we have to register a custom editor</span>
        binder.registerCustomEditor(<span class="hl-keyword">byte</span>[].<span class="hl-keyword">class</span>, <span class="hl-keyword">new</span> ByteArrayMultipartFileEditor());
        <span class="hl-comment">// now Spring knows how to handle multipart object and convert</span>
    }

}

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FileUploadBean {

    <span class="hl-keyword">private</span> <span class="hl-keyword">byte</span>[] file;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setFile(<span class="hl-keyword">byte</span>[] file) {
        <span class="hl-keyword">this</span>.file = file;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">byte</span>[] getFile() {
        <span class="hl-keyword">return</span> file;
    }

}</pre> 
    <p>As you can see, the <code class="literal">FileUploadBean</code> has a property of type <code class="literal">byte[]</code> that holds the file. The controller registers a custom editor to let Spring know how to actually convert the multipart objects the resolver has found to properties specified by the bean. In this example, nothing is done with the <code class="literal">byte[]</code> property of the bean itself, but in practice you can do whatever you want (save it in a database, mail it to somebody, etc).</p> 
    <p>An equivalent example in which a file is bound straight to a String-typed property on a form backing object might look like this:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FileUploadController <span class="hl-keyword">extends</span> SimpleFormController {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> onSubmitAction(ActionRequest request, ActionResponse response,
            Object command, BindException errors) <span class="hl-keyword">throws</span> Exception {

        <span class="hl-comment">// cast the bean</span>
        FileUploadBean bean = (FileUploadBean) command;

        <span class="hl-comment">// let's see if there's content there</span>
        String file = bean.getFile();
        <span class="hl-keyword">if</span> (file == null) {
            <span class="hl-comment">// hmm, that's strange, the user did not upload anything</span>
        }

        <span class="hl-comment">// do something with the file here</span>
    }

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> initBinder(PortletRequest request,
            PortletRequestDataBinder binder) <span class="hl-keyword">throws</span> Exception {

        <span class="hl-comment">// to actually be able to convert Multipart instance to a String</span>
        <span class="hl-comment">// we have to register a custom editor</span>
        binder.registerCustomEditor(String.<span class="hl-keyword">class</span>, <span class="hl-keyword">new</span> StringMultipartFileEditor());
        <span class="hl-comment">// now Spring knows how to handle multipart objects and convert</span>
    }
}

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FileUploadBean {

    <span class="hl-keyword">private</span> String file;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setFile(String file) {
        <span class="hl-keyword">this</span>.file = file;
    }

    <span class="hl-keyword">public</span> String getFile() {
        <span class="hl-keyword">return</span> file;
    }
}</pre> 
    <p>Of course, this last example only makes (logical) sense in the context of uploading a plain text file (it wouldnt work so well in the case of uploading an image file).</p> 
    <p>The third (and final) option is where one binds directly to a <code class="literal">MultipartFile</code> property declared on the (form backing) objects class. In this case one does not need to register any custom property editor because there is no type conversion to be performed.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FileUploadController <span class="hl-keyword">extends</span> SimpleFormController {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> onSubmitAction(ActionRequest request, ActionResponse response,
            Object command, BindException errors) <span class="hl-keyword">throws</span> Exception {

        <span class="hl-comment">// cast the bean</span>
        FileUploadBean bean = (FileUploadBean) command;

        <span class="hl-comment">// let's see if there's content there</span>
        MultipartFile file = bean.getFile();
        <span class="hl-keyword">if</span> (file == null) {
            <span class="hl-comment">// hmm, that's strange, the user did not upload anything</span>
        }

        <span class="hl-comment">// do something with the file here</span>
    }
}

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FileUploadBean {

    <span class="hl-keyword">private</span> MultipartFile file;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setFile(MultipartFile file) {
        <span class="hl-keyword">this</span>.file = file;
    }

    <span class="hl-keyword">public</span> MultipartFile getFile() {
        <span class="hl-keyword">return</span> file;
    }

}</pre> 
   </div> 
  </div> 
  <div class="section" title="19.8&nbsp;Handling exceptions">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="portlet-exceptionresolver"></a>19.8&nbsp;Handling exceptions</h2>
     </div>
    </div>
   </div> 
   <p>Just like Servlet MVC, Portlet MVC provides <code class="literal">HandlerExceptionResolver</code> s to ease the pain of unexpected exceptions that occur while your request is being processed by a handler that matched the request. Portlet MVC also provides a portlet-specific, concrete <code class="literal">SimpleMappingExceptionResolver</code> that enables you to take the class name of any exception that might be thrown and map it to a view name.</p> 
  </div> 
  <div class="section" title="19.9&nbsp;Annotation-based controller configuration">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="portlet-annotation"></a>19.9&nbsp;Annotation-based controller configuration</h2>
     </div>
    </div>
   </div> 
   <p>Spring 2.5 introduced an annotation-based programming model for MVC controllers, using annotations such as <code class="literal">@RequestMapping</code>, <code class="literal">@RequestParam</code>, <code class="literal">@ModelAttribute</code>, etc. This annotation support is available for both Servlet MVC and Portlet MVC. Controllers implemented in this style do not have to extend specific base classes or implement specific interfaces. Furthermore, they do not usually have direct dependencies on Servlet or Portlet APIs, although they can easily get access to Servlet or Portlet facilities if desired.</p> 
   <p>The following sections document these annotations and how they are most commonly used in a Portlet environment.</p> 
   <div class="section" title="19.9.1&nbsp;Setting up the dispatcher for annotation support">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-ann-setup"></a>19.9.1&nbsp;Setting up the dispatcher for annotation support</h3>
      </div>
     </div>
    </div> 
    <p><span class="emphasis"><em> <code class="literal">@RequestMapping</code> will only be processed if a corresponding <code class="literal">HandlerMapping</code> (for type level annotations) and/or <code class="literal">HandlerAdapter</code> (for method level annotations) is present in the dispatcher.</em></span> This is the case by default in both <code class="literal">DispatcherServlet</code> and <code class="literal">DispatcherPortlet</code>.</p> 
    <p>However, if you are defining custom <code class="literal">HandlerMappings</code> or <code class="literal">HandlerAdapters</code>, then you need to make sure that a corresponding custom <code class="literal">DefaultAnnotationHandlerMapping</code> and/or <code class="literal">AnnotationMethodHandlerAdapter</code> is defined as well - provided that you intend to use <code class="literal">@RequestMapping</code>.</p> 
    <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.portlet.mvc.annotation.DefaultAnnotationHandlerMapping&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.portlet.mvc.annotation.AnnotationMethodHandlerAdapter&quot;</span><span class="hl-tag">/&gt;</span>

    // ... (controller bean definitions) ...

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>Defining a <code class="literal">DefaultAnnotationHandlerMapping</code> and/or <code class="literal">AnnotationMethodHandlerAdapter</code> explicitly also makes sense if you would like to customize the mapping strategy, e.g. specifying a custom <code class="literal">WebBindingInitializer</code> (see below).</p> 
   </div> 
   <div class="section" title="19.9.2&nbsp;Defining a controller with @Controller">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-ann-controller"></a>19.9.2&nbsp;Defining a controller with @Controller</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">@Controller</code> annotation indicates that a particular class serves the role of a <span class="emphasis"><em>controller</em></span>. There is no need to extend any controller base class or reference the Portlet API. You are of course still able to reference Portlet-specific features if you need to.</p> 
    <p>The basic purpose of the <code class="literal">@Controller</code> annotation is to act as a stereotype for the annotated class, indicating its role. The dispatcher will scan such annotated classes for mapped methods, detecting <code class="literal">@RequestMapping</code> annotations (see the next section).</p> 
    <p>Annotated controller beans may be defined explicitly, using a standard Spring bean definition in the dispatchers context. However, the <code class="literal">@Controller</code> stereotype also allows for autodetection, aligned with Spring 2.5s general support for detecting component classes in the classpath and auto-registering bean definitions for them.</p> 
    <p>To enable autodetection of such annotated controllers, you have to add component scanning to your configuration. This is easily achieved by using the <span class="emphasis"><em>spring-context</em></span> schema as shown in the following XML snippet:</p> 
    <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:p</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/p&quot;</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/context&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">&quot;org.springframework.samples.petportal.portlet&quot;</span><span class="hl-tag">/&gt;</span>

    // ...

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
   </div> 
   <div class="section" title="19.9.3&nbsp;Mapping requests with @RequestMapping">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-ann-requestmapping"></a>19.9.3&nbsp;Mapping requests with @RequestMapping</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">@RequestMapping</code> annotation is used to map portlet modes like <span class="emphasis"><em>VIEW</em></span>/<span class="emphasis"><em>EDIT</em></span> onto an entire class or a particular handler method. Typically the type-level annotation maps a specific mode (or mode plus parameter condition) onto a form controller, with additional method-level annotations <span class="emphasis"><em>narrowing</em></span> the primary mapping for specific portlet request parameters.</p> 
    <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Tip">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
        <th align="left">Tip</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p><code class="literal">@RequestMapping</code> at the type level may be used for plain implementations of the <code class="literal">Controller</code> interface as well. In this case, the request processing code would follow the traditional <code class="literal">handle(Action|Render)Request</code> signature, while the controllers mapping would be expressed through an <code class="literal">@RequestMapping</code> annotation. This works for pre-built <code class="literal">Controller</code> base classes, such as <code class="literal">SimpleFormController</code>, too.</p> <p>In the following discussion, well focus on controllers that are based on annotated handler methods.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>The following is an example of a form controller from the PetPortal sample application using this annotation:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<i><span class="hl-annotation" style="color: gray">@RequestMapping(&quot;EDIT&quot;)</span></i>
<i><span class="hl-annotation" style="color: gray">@SessionAttributes(&quot;site&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PetSitesEditController {

    <span class="hl-keyword">private</span> Properties petSites;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setPetSites(Properties petSites) {
        <span class="hl-keyword">this</span>.petSites = petSites;
    }

    <i><span class="hl-annotation" style="color: gray">@ModelAttribute(&quot;petSites&quot;)</span></i>
    <span class="hl-keyword">public</span> Properties getPetSites() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.petSites;
    }

    <i><span class="hl-annotation" style="color: gray">@RequestMapping</span></i> <span class="hl-comment">// default (action=list)</span>
    <span class="hl-keyword">public</span> String showPetSites() {
        <span class="hl-keyword">return</span> <span class="hl-string">&quot;petSitesEdit&quot;</span>;
    }

    <i><span class="hl-annotation" style="color: gray">@RequestMapping(params = &quot;action=add&quot;)</span></i> <span class="hl-comment">// render phase</span>
    <span class="hl-keyword">public</span> String showSiteForm(Model model) {
        <span class="hl-comment">// Used for the initial form as well as for redisplaying with errors.</span>
        <span class="hl-keyword">if</span> (!model.containsAttribute(<span class="hl-string">&quot;site&quot;</span>)) {
            model.addAttribute(<span class="hl-string">&quot;site&quot;</span>, <span class="hl-keyword">new</span> PetSite());
        }

        <span class="hl-keyword">return</span> <span class="hl-string">&quot;petSitesAdd&quot;</span>;
    }

    <i><span class="hl-annotation" style="color: gray">@RequestMapping(params = &quot;action=add&quot;)</span></i> <span class="hl-comment">// action phase</span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> populateSite(<i><span class="hl-annotation" style="color: gray">@ModelAttribute(&quot;site&quot;)</span></i> PetSite petSite,
            BindingResult result, SessionStatus status, ActionResponse response) {
        <span class="hl-keyword">new</span> PetSiteValidator().validate(petSite, result);
        <span class="hl-keyword">if</span> (!result.hasErrors()) {
            <span class="hl-keyword">this</span>.petSites.put(petSite.getName(), petSite.getUrl());
            status.setComplete();
            response.setRenderParameter(<span class="hl-string">&quot;action&quot;</span>, <span class="hl-string">&quot;list&quot;</span>);
        }
    }

    <i><span class="hl-annotation" style="color: gray">@RequestMapping(params = &quot;action=delete&quot;)</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> removeSite(<i><span class="hl-annotation" style="color: gray">@RequestParam(&quot;site&quot;)</span></i> String site, ActionResponse response) {
        <span class="hl-keyword">this</span>.petSites.remove(site);
        response.setRenderParameter(<span class="hl-string">&quot;action&quot;</span>, <span class="hl-string">&quot;list&quot;</span>);
    }
}</pre> 
   </div> 
   <div class="section" title="19.9.4&nbsp;Supported handler method arguments">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-ann-requestmapping-arguments"></a>19.9.4&nbsp;Supported handler method arguments</h3>
      </div>
     </div>
    </div> 
    <p>Handler methods which are annotated with <code class="literal">@RequestMapping</code> are allowed to have very flexible signatures. They may have arguments of the following types, in arbitrary order (except for validation results, which need to follow right after the corresponding command object, if desired):</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> Request and/or response objects (Portlet API). You may choose any specific request/response type, e.g. PortletRequest / ActionRequest / RenderRequest. An explicitly declared action/render argument is also used for mapping specific request types onto a handler method (in case of no other information given that differentiates between action and render requests). </li>
      <li class="listitem"> Session object (Portlet API): of type PortletSession. An argument of this type will enforce the presence of a corresponding session. As a consequence, such an argument will never be <code class="literal">null</code>. </li>
      <li class="listitem"> <code class="literal">org.springframework.web.context.request.WebRequest</code> or <code class="literal">org.springframework.web.context.request.NativeWebRequest</code>. Allows for generic request parameter access as well as request/session attribute access, without ties to the native Servlet/Portlet API. </li>
      <li class="listitem"> <code class="literal">java.util.Locale</code> for the current request locale (the portal locale in a Portlet environment). </li>
      <li class="listitem"> <code class="literal">java.util.TimeZone</code> / <code class="literal">java.time.ZoneId</code> for the current request time zone. </li>
      <li class="listitem"> <code class="literal">java.io.InputStream</code> / <code class="literal">java.io.Reader</code> for access to the requests content. This will be the raw InputStream/Reader as exposed by the Portlet API. </li>
      <li class="listitem"> <code class="literal">java.io.OutputStream</code> / <code class="literal">java.io.Writer</code> for generating the responses content. This will be the raw OutputStream/Writer as exposed by the Portlet API. </li>
      <li class="listitem"> <code class="literal">@RequestParam</code> annotated parameters for access to specific Portlet request parameters. Parameter values will be converted to the declared method argument type. </li>
      <li class="listitem"> <code class="literal">java.util.Map</code> / <code class="literal">org.springframework.ui.Model</code> / <code class="literal">org.springframework.ui.ModelMap</code> for enriching the implicit model that will be exposed to the web view. </li>
      <li class="listitem"> Command/form objects to bind parameters to: as bean properties or fields, with customizable type conversion, depending on <code class="literal">@InitBinder</code> methods and/or the HandlerAdapter configuration - see the &quot; <code class="literal">webBindingInitializer</code>&quot; property on <code class="literal">AnnotationMethodHandlerAdapter</code>. Such command objects along with their validation results will be exposed as model attributes, by default using the non-qualified command class name in property notation (e.g. &quot;orderAddress&quot; for type &quot;mypackage.OrderAddress&quot;). Specify a parameter-level <code class="literal">ModelAttribute</code> annotation for declaring a specific model attribute name. </li>
      <li class="listitem"> <code class="literal">org.springframework.validation.Errors</code> / <code class="literal">org.springframework.validation.BindingResult</code> validation results for a preceding command/form object (the immediate preceding argument). </li>
      <li class="listitem"> <code class="literal">org.springframework.web.bind.support.SessionStatus</code> status handle for marking form processing as complete (triggering the cleanup of session attributes that have been indicated by the <code class="literal">@SessionAttributes</code> annotation at the handler type level). </li>
     </ul>
    </div> 
    <p>The following return types are supported for handler methods:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> A <code class="literal">ModelAndView</code> object, with the model implicitly enriched with command objects and the results of <code class="literal">@ModelAttribute</code> annotated reference data accessor methods. </li>
      <li class="listitem"> A <code class="literal">Model</code> object, with the view name implicitly determined through a <code class="literal">RequestToViewNameTranslator</code> and the model implicitly enriched with command objects and the results of <code class="literal">@ModelAttribute</code> annotated reference data accessor methods. </li>
      <li class="listitem"> A <code class="literal">Map</code> object for exposing a model, with the view name implicitly determined through a <code class="literal">RequestToViewNameTranslator</code> and the model implicitly enriched with command objects and the results of <code class="literal">@ModelAttribute</code> annotated reference data accessor methods. </li>
      <li class="listitem"> A <code class="literal">View</code> object, with the model implicitly determined through command objects and <code class="literal">@ModelAttribute</code> annotated reference data accessor methods. The handler method may also programmatically enrich the model by declaring a <code class="literal">Model</code> argument (see above). </li>
      <li class="listitem"> A <code class="literal">String</code> value which is interpreted as view name, with the model implicitly determined through command objects and <code class="literal">@ModelAttribute</code> annotated reference data accessor methods. The handler method may also programmatically enrich the model by declaring a <code class="literal">Model</code> argument (see above). </li>
      <li class="listitem"> <code class="literal">void</code> if the method handles the response itself (e.g. by writing the response content directly). </li>
      <li class="listitem"> Any other return type will be considered a single model attribute to be exposed to the view, using the attribute name specified through <code class="literal">@ModelAttribute</code> at the method level (or the default attribute name based on the return types class name otherwise). The model will be implicitly enriched with command objects and the results of <code class="literal">@ModelAttribute</code> annotated reference data accessor methods. </li>
     </ul>
    </div> 
   </div> 
   <div class="section" title="19.9.5&nbsp;Binding request parameters to method parameters with @RequestParam">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-ann-requestparam"></a>19.9.5&nbsp;Binding request parameters to method parameters with @RequestParam</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">@RequestParam</code> annotation is used to bind request parameters to a method parameter in your controller.</p> 
    <p>The following code snippet from the PetPortal sample application shows the usage:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<i><span class="hl-annotation" style="color: gray">@RequestMapping(&quot;EDIT&quot;)</span></i>
<i><span class="hl-annotation" style="color: gray">@SessionAttributes(&quot;site&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PetSitesEditController {

    <span class="hl-comment">// ...</span>

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> removeSite(<i><span class="hl-annotation" style="color: gray">@RequestParam(&quot;site&quot;)</span></i> String site, ActionResponse response) {
        <span class="hl-keyword">this</span>.petSites.remove(site);
        response.setRenderParameter(<span class="hl-string">&quot;action&quot;</span>, <span class="hl-string">&quot;list&quot;</span>);
    }

    <span class="hl-comment">// ...</span>

}</pre> 
    <p>Parameters using this annotation are required by default, but you can specify that a parameter is optional by setting <code class="literal">@RequestParam</code>'s <code class="literal">required</code> attribute to <code class="literal">false</code> (e.g., <code class="literal">@RequestParam(value=&quot;id&quot;, required=false)</code>).</p> 
   </div> 
   <div class="section" title="19.9.6&nbsp;Providing a link to data from the model with @ModelAttribute">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-ann-modelattrib"></a>19.9.6&nbsp;Providing a link to data from the model with @ModelAttribute</h3>
      </div>
     </div>
    </div> 
    <p><code class="literal">@ModelAttribute</code> has two usage scenarios in controllers. When placed on a method parameter, <code class="literal">@ModelAttribute</code> is used to map a model attribute to the specific, annotated method parameter (see the <code class="literal">populateSite()</code> method below). This is how the controller gets a reference to the object holding the data entered in the form. In addition, the parameter can be declared as the specific type of the form backing object rather than as a generic <code class="literal">java.lang.Object</code>, thus increasing type safety.</p> 
    <p><code class="literal">@ModelAttribute</code> is also used at the method level to provide <span class="emphasis"><em>reference data</em></span> for the model (see the <code class="literal">getPetSites()</code> method below). For this usage the method signature can contain the same types as documented above for the <code class="literal">@RequestMapping</code> annotation.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p><code class="literal">@ModelAttribute</code> annotated methods will be executed <span class="emphasis"><em>before</em></span> the chosen <code class="literal">@RequestMapping</code> annotated handler method. They effectively pre-populate the implicit model with specific attributes, often loaded from a database. Such an attribute can then already be accessed through <code class="literal">@ModelAttribute</code> annotated handler method parameters in the chosen handler method, potentially with binding and validation applied to it.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>The following code snippet shows these two usages of this annotation:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<i><span class="hl-annotation" style="color: gray">@RequestMapping(&quot;EDIT&quot;)</span></i>
<i><span class="hl-annotation" style="color: gray">@SessionAttributes(&quot;site&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PetSitesEditController {

    <span class="hl-comment">// ...</span>

    <i><span class="hl-annotation" style="color: gray">@ModelAttribute(&quot;petSites&quot;)</span></i>
    <span class="hl-keyword">public</span> Properties getPetSites() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.petSites;
    }

    <i><span class="hl-annotation" style="color: gray">@RequestMapping(params = &quot;action=add&quot;)</span></i> <span class="hl-comment">// action phase</span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> populateSite( <i><span class="hl-annotation" style="color: gray">@ModelAttribute(&quot;site&quot;)</span></i> PetSite petSite, BindingResult result, SessionStatus status, ActionResponse response) {
        <span class="hl-keyword">new</span> PetSiteValidator().validate(petSite, result);
        <span class="hl-keyword">if</span> (!result.hasErrors()) {
            <span class="hl-keyword">this</span>.petSites.put(petSite.getName(), petSite.getUrl());
            status.setComplete();
            response.setRenderParameter(<span class="hl-string">&quot;action&quot;</span>, <span class="hl-string">&quot;list&quot;</span>);
        }
    }
}</pre> 
   </div> 
   <div class="section" title="19.9.7&nbsp;Specifying attributes to store in a Session with @SessionAttributes">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-ann-sessionattrib"></a>19.9.7&nbsp;Specifying attributes to store in a Session with @SessionAttributes</h3>
      </div>
     </div>
    </div> 
    <p>The type-level <code class="literal">@SessionAttributes</code> annotation declares session attributes used by a specific handler. This will typically list the names of model attributes or types of model attributes which should be transparently stored in the session or some conversational storage, serving as form-backing beans between subsequent requests.</p> 
    <p>The following code snippet shows the usage of this annotation:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<i><span class="hl-annotation" style="color: gray">@RequestMapping(&quot;EDIT&quot;)</span></i>
<i><span class="hl-annotation" style="color: gray">@SessionAttributes(&quot;site&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PetSitesEditController {
    <span class="hl-comment">// ...</span>
}</pre> 
   </div> 
   <div class="section" title="19.9.8&nbsp;Customizing WebDataBinder initialization">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="portlet-ann-webdatabinder"></a>19.9.8&nbsp;Customizing WebDataBinder initialization</h3>
      </div>
     </div>
    </div> 
    <p>To customize request parameter binding with PropertyEditors, etc. via Springs <code class="literal">WebDataBinder</code>, you can either use <code class="literal">@InitBinder</code>-annotated methods within your controller or externalize your configuration by providing a custom <code class="literal">WebBindingInitializer</code>.</p> 
    <div class="section" title="Customizing data binding with @InitBinder">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="portlet-ann-initbinder"></a>Customizing data binding with @InitBinder</h4>
       </div>
      </div>
     </div> 
     <p>Annotating controller methods with <code class="literal">@InitBinder</code> allows you to configure web data binding directly within your controller class. <code class="literal">@InitBinder</code> identifies methods which initialize the <code class="literal">WebDataBinder</code> which will be used for populating command and form object arguments of annotated handler methods.</p> 
     <p>Such init-binder methods support all arguments that <code class="literal">@RequestMapping</code> supports, except for command/form objects and corresponding validation result objects. Init-binder methods must not have a return value. Thus, they are usually declared as <code class="literal">void</code>. Typical arguments include <code class="literal">WebDataBinder</code> in combination with <code class="literal">WebRequest</code> or <code class="literal">java.util.Locale</code>, allowing code to register context-specific editors.</p> 
     <p>The following example demonstrates the use of <code class="literal">@InitBinder</code> for configuring a <code class="literal">CustomDateEditor</code> for all <code class="literal">java.util.Date</code> form properties.</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyFormController {

    <i><span class="hl-annotation" style="color: gray">@InitBinder</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> initBinder(WebDataBinder binder) {
    SimpleDateFormat dateFormat = <span class="hl-keyword">new</span> SimpleDateFormat(<span class="hl-string">&quot;yyyy-MM-dd&quot;</span>);
        dateFormat.setLenient(false);
        binder.registerCustomEditor(Date.<span class="hl-keyword">class</span>, <span class="hl-keyword">new</span> CustomDateEditor(dateFormat, false));
    }

    <span class="hl-comment">// ...</span>

}</pre> 
    </div> 
    <div class="section" title="Configuring a custom WebBindingInitializer">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="portlet-ann-webbindinginitializer"></a>Configuring a custom WebBindingInitializer</h4>
       </div>
      </div>
     </div> 
     <p>To externalize data binding initialization, you can provide a custom implementation of the <code class="literal">WebBindingInitializer</code> interface, which you then enable by supplying a custom bean configuration for an <code class="literal">AnnotationMethodHandlerAdapter</code>, thus overriding the default configuration.</p> 
    </div> 
   </div> 
  </div> 
  <div class="section" title="19.10&nbsp;Portlet application deployment">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="portlet-deployment"></a>19.10&nbsp;Portlet application deployment</h2>
     </div>
    </div>
   </div> 
   <p>The process of deploying a Spring Portlet MVC application is no different than deploying any JSR-168 Portlet application. However, this area is confusing enough in general that it is worth talking about here briefly.</p> 
   <p>Generally, the portal/portlet container runs in one webapp in your servlet container and your portlets run in another webapp in your servlet container. In order for the portlet container webapp to make calls into your portlet webapp it must make cross-context calls to a well-known servlet that provides access to the portlet services defined in your <code class="literal">portlet.xml</code> file.</p> 
   <p>The JSR-168 specification does not specify exactly how this should happen, so each portlet container has its own mechanism for this, which usually involves some kind of &quot;deployment process&quot; that makes changes to the portlet webapp itself and then registers the portlets within the portlet container.</p> 
   <p>At a minimum, the <code class="literal">web.xml</code> file in your portlet webapp is modified to inject the well-known servlet that the portlet container will call. In some cases a single servlet will service all portlets in the webapp, in other cases there will be an instance of the servlet for each portlet.</p> 
   <p>Some portlet containers will also inject libraries and/or configuration files into the webapp as well. The portlet container must also make its implementation of the Portlet JSP Tag Library available to your webapp.</p> 
   <p>The bottom line is that it is important to understand the deployment needs of your target portal and make sure they are met (usually by following the automated deployment process it provides). Be sure to carefully review the documentation from your portal for this process.</p> 
   <p>Once you have deployed your portlet, review the resulting <code class="literal">web.xml</code> file for sanity. Some older portals have been known to corrupt the definition of the <code class="literal">ViewRendererServlet</code>, thus breaking the rendering of your portlets.</p> 
  </div> 
 </div> 
 <div class="chapter" title="20.&nbsp;WebSocket Support">
  <div class="titlepage">
   <div>
    <div>
     <h2 class="title"><a name="websocket"></a>20.&nbsp;WebSocket Support</h2>
    </div>
   </div>
  </div> 
  <p>This part of the reference documentation covers Spring Frameworks support for WebSocket-style messaging in web applications including use of STOMP as an application level WebSocket sub-protocol.</p> 
  <p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#websocket-intro" title="20.1&nbsp;Introduction">Section&nbsp;20.1, Introduction</a> establishes a frame of mind in which to think about WebSocket, covering adoption challenges, design considerations, and thoughts on when it is a good fit.</p> 
  <p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#websocket-server" title="20.2&nbsp;WebSocket Server">Section&nbsp;20.2, WebSocket Server</a> reviews the Spring WebSocket API on the server-side while <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#websocket-fallback" title="20.3&nbsp;Fallback Options">Section&nbsp;20.3, Fallback Options</a> explains the SockJS protocol and shows how to configure and use it.</p> 
  <p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#websocket-stomp-overview" title="20.4.1&nbsp;Overview of STOMP">Section&nbsp;20.4.1, Overview of STOMP</a> introduces the STOMP messaging protocol.</p> 
  <div class="section" title="20.1&nbsp;Introduction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="websocket-intro"></a>20.1&nbsp;Introduction</h2>
     </div>
    </div>
   </div> 
   <p>The WebSocket protocol <a class="ulink" href="http://tools.ietf.org/html/rfc6455" target="_top">RFC 6455</a> defines an important new capability for web applications: full-duplex, two-way communication between client and server. It is an exciting new capability on the heels of a long history of techniques to make the web more interactive including Java applets, XMLHttpRequest, Adobe Flash, ActiveXObject, various Comet techniques, server-sent events, and others.</p> 
   <p>A proper introduction of the WebSocket protocol is beyond the scope of this document. At a minimum however its important to understand that HTTP is used only for the initial handshake, which relies on a mechanism built into HTTP to request a protocol upgrade (or in this case a protocol switch) to which the server can respond with HTTP status 101 (switching protocols) if it agrees. Assuming the handshake succeeds the TCP socket underlying the HTTP upgrade request remains open and both client and server can use it to send messages to each other.</p> 
   <p>Spring Framework 4 includes a new <code class="literal">spring-websocket</code> module with comprehensive WebSocket support. It is compatible with the Java WebSocket API standard (<a class="ulink" href="http://jcp.org/en/jsr/detail?id=356" target="_top">JSR-356</a>) and also provides additional value-add as explained in the rest of the introduction.</p> 
   <div class="section" title="20.1.1&nbsp;Fallback Options">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="websocket-into-fallback-options"></a>20.1.1&nbsp;Fallback Options</h3>
      </div>
     </div>
    </div> 
    <p>An important challenge to adoption is the lack of support for WebSocket in some browsers. Notably the first Internet Explorer version to support WebSocket is version 10 (see <a class="ulink" href="http://caniuse.com/websockets" target="_top">http://caniuse.com/websockets</a> for support by browser versions). Furthermore, some restrictive proxies may be configured in ways that either preclude the attempt to do HTTP upgrade or otherwise break connection after some time because it has remained opened for too long. A good overview on this topic from Peter Lubbers is available in the InfoQ article <a class="ulink" href="http://www.infoq.com/articles/Web-Sockets-Proxy-Servers" target="_top">&quot;How HTML5 Web Sockets Interact With Proxy Servers&quot;</a>.</p> 
    <p>Therefore to build a WebSocket application today, fallback options are required to simulate the WebSocket API where necessary. Spring Framework provides such transparent fallback options based on the <a class="ulink" href="https://github.com/sockjs/sockjs-protocol" target="_top">SockJS protocol</a>. These options can be enabled through configuration and do not require modifying the application otherwise.</p> 
   </div> 
   <div class="section" title="20.1.2&nbsp;Messaging Architecture">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="websocket-intro-architecture"></a>20.1.2&nbsp;Messaging Architecture</h3>
      </div>
     </div>
    </div> 
    <p>Aside from short-to-midterm adoption challenges, using WebSocket brings up important design considerations that are important to recognize early on, especially in contrast to what we know about building web applications today.</p> 
    <p>Today REST is a widely accepted, understood, and supported architecture for building web applications. It is an architecture that relies on having many URLs (<span class="emphasis"><em>nouns</em></span>), a handful of HTTP methods (<span class="emphasis"><em>verbs</em></span>), and other principles such as using hypermedia (<span class="emphasis"><em>links</em></span>), remaining stateless, etc.</p> 
    <p>By contrast a WebSocket application may use a single URL only for the initial HTTP handshake. All messages thereafter share and flow on the same TCP connection. This points to an entirely different, asynchronous, event-driven, messaging architecture. One that is much closer to traditional messaging applications (e.g. JMS, AMQP).</p> 
    <p>Spring Framework 4 includes a new <code class="literal">spring-messaging</code> module with key abstractions from the <a class="ulink" href="http://projects.spring.io/spring-integration/" target="_top">Spring Integration</a> project such as <code class="literal">Message</code>, <code class="literal">MessageChannel</code>, <code class="literal">MessageHandler</code> and others that can serve as a foundation for such a messaging architecture. The module also includes a set of annotations for mapping messages to methods, similar to the Spring MVC annotation based programming model.</p> 
   </div> 
   <div class="section" title="20.1.3&nbsp;Sub-Protocol Support">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="websocket-intro-sub-protocol"></a>20.1.3&nbsp;Sub-Protocol Support</h3>
      </div>
     </div>
    </div> 
    <p>WebSocket does imply a <span class="emphasis"><em>messaging architecture</em></span> but does not mandate the use of any specific <span class="emphasis"><em>messaging protocol</em></span>. It is a very thin layer over TCP that transforms a stream of bytes into a stream of messages (either text or binary) and not much more. It is up to applications to interpret the meaning of a message.</p> 
    <p>Unlike HTTP, which is an application-level protocol, in the WebSocket protocol there is simply not enough information in an incoming message for a framework or container to know how to route it or process it. Therefore WebSocket is arguably too low level for anything but a very trivial application. It can be done, but it will likely lead to creating a framework on top. This is comparable to how most web applications today are written using a web framework rather than the Servlet API alone.</p> 
    <p>For this reason the WebSocket RFC defines the use of <a class="ulink" href="http://tools.ietf.org/html/rfc6455#section-1.9" target="_top">sub-protocols</a>. During the handshake, client and server can use the header <code class="literal">Sec-WebSocket-Protocol</code> to agree on a sub-protocol, i.e. a higher, application-level protocol to use. The use of a sub-protocol is not required, but even if not used, applications will still need to choose a message format that both client and server can understand. That format can be custom, framework-specific, or a standard messaging protocol.</p> 
    <p>Spring Framework provides support for using <a class="ulink" href="http://stomp.github.io/stomp-specification-1.2.html#Abstract" target="_top">STOMP</a>&#x2009;&#x2009;a simple, messaging protocol originally created for use in scripting languages with frames inspired by HTTP. STOMP is widely support and well suited for use over WebSocket and over the web.</p> 
   </div> 
   <div class="section" title="20.1.4&nbsp;When To Use WebSocket?">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="websocket-intro-when-to-use"></a>20.1.4&nbsp;When To Use WebSocket?</h3>
      </div>
     </div>
    </div> 
    <p>With all the design considerations surrounding the use of WebSocket, it is reasonable to ask when is it appropriate to use?</p> 
    <p>The best fit for WebSocket is in web applications where client and server need to exchange events at high frequency and at low latency. Prime candidates include but are not limited to applications in finance, games, collaboration, and others. Such applications are both very sensitive to time delays and also need to exchange a wide variety of messages at high frequency.</p> 
    <p>For other application types, however, this may not be the case. For example, a news or social feed that shows breaking news as they become available may be perfectly okay with simple polling once every few minutes. Here latency is important, but it is acceptable if the news takes a few minutes to appear.</p> 
    <p>Even in cases where latency is crucial, if the volume of messages is relatively low (e.g. monitoring network failures) the use of <a class="ulink" href="http://spring.io/blog/2012/05/08/spring-mvc-3-2-preview-techniques-for-real-time-updates" target="_top">long polling</a> should be considered as a relatively simple alternative that works reliably and is comparable by efficiency (again assuming the volume of messages is relatively low).</p> 
    <p>It is the combination of both low latency and high frequency of messages that can make the use of the WebSocket protocol critical. Even in such applications, the choice remains whether all client-server communication should be done through WebSocket messages as opposed to using HTTP and REST? The answer is going to vary by application, however, it is likely that some functionality may be exposed over both WebSocket and as a REST API in order to provide clients with alternatives. Furthermore, a REST API call may need to broadcast a message to interested clients connected via WebSocket.</p> 
    <p>Spring Framework allows <code class="literal">@Controller</code> classes to have both HTTP request handling and WebSocket message handling methods. Furthermore, a Spring MVC request handling method, or any application method for that matter, can easily broadcast a message to all interested WebSocket clients or to a specific user.</p> 
   </div> 
  </div> 
  <div class="section" title="20.2&nbsp;WebSocket Server">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="websocket-server"></a>20.2&nbsp;WebSocket Server</h2>
     </div>
    </div>
   </div> 
   <p>The Spring Framework provides a WebSocket API designed to adapt to various WebSocket engines. For example, it runs on JSR-356 runtimes such as Tomcat (7.0.47+) and GlassFish (4.0+) but can also adapt to other WebSocket runtimes such as the Jetty (9.0+) native WebSocket support.</p> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>As explained in the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#websocket-intro-sub-protocol" title="20.1.3&nbsp;Sub-Protocol Support">introduction</a>, direct use of a WebSocket API is too low level for applications&#x2009;&#x2009;until assumptions are made about the format of a message there is little a framework can do to interpret messages or route them via annotations. This is why applications should consider using a sub-protocol and Springs <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#websocket-stomp" title="20.4&nbsp;STOMP Messaging">STOMP over WebSocket</a> support.</p> <p>When using a higher level protocol, the details of the WebSocket API become less relevant, much like the details of TCP communication are not exposed to applications when using HTTP. Nevertheless this section covers the details of using WebSocket directly.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <div class="section" title="20.2.1&nbsp;Create and Configure a WebSocketHandler">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="websocket-server-handler"></a>20.2.1&nbsp;Create and Configure a WebSocketHandler</h3>
      </div>
     </div>
    </div> 
    <p>Creating a WebSocket server is as simple as implementing <code class="literal">WebSocketHandler</code> or more likely extending either <code class="literal">TextWebSocketHandler</code> or <code class="literal">BinaryWebSocketHandler</code>:</p> 
    <pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.web.socket.WebSocketHandler;
<span class="hl-keyword">import</span> org.springframework.web.socket.WebSocketSession;
<span class="hl-keyword">import</span> org.springframework.web.socket.TextMessage;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyHandler <span class="hl-keyword">extends</span> TextWebSocketHandler {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> handleTextMessage(WebSocketSession session, TextMessage message) {
        <span class="hl-comment">// ...</span>
    }

}</pre> 
    <p>There is dedicated WebSocket Java-config and XML namespace support for mapping the above WebSocket handler at a specific URL:</p> 
    <pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.web.socket.config.annotation.EnableWebSocket;
<span class="hl-keyword">import</span> org.springframework.web.socket.config.annotation.WebSocketConfigurer;
<span class="hl-keyword">import</span> org.springframework.web.socket.config.annotation.WebSocketHandlerRegistry;

<i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableWebSocket</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebSocketConfig <span class="hl-keyword">implements</span> WebSocketConfigurer {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> registerWebSocketHandlers(WebSocketHandlerRegistry registry) {
        registry.addHandler(myHandler(), <span class="hl-string">&quot;/myHandler&quot;</span>);
    }

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> WebSocketHandler myHandler() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> MyHandler();
    }

}</pre> 
    <p>XML configuration equivalent:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:websocket</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/websocket&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/websocket
        http://www.springframework.org/schema/websocket/spring-websocket-4.0.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;websocket:handlers&gt;</span>
        <span class="hl-tag">&lt;websocket:mapping</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;/myHandler&quot;</span> <span class="hl-attribute">handler</span>=<span class="hl-value">&quot;myHandler&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/websocket:handlers&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myHandler&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.samples.MyHandler&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>The above is for use in Spring MVC applications and should be included in the configuration of a <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#">DispatcherServlet</a>. However, Springs WebSocket support does not depend on Spring MVC. It is relatively simple to integrate a <code class="literal">WebSocketHandler</code> into other HTTP serving environments with the help of <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/socket/server/support/WebSocketHttpRequestHandler.html" target="_top">WebSocketHttpRequestHandler</a>.</p> 
   </div> 
   <div class="section" title="20.2.2&nbsp;Customizing the WebSocket Handshake">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="websocket-server-handshake"></a>20.2.2&nbsp;Customizing the WebSocket Handshake</h3>
      </div>
     </div>
    </div> 
    <p>The easiest way to customize the initial HTTP WebSocket handshake request is through a <code class="literal">HandshakeInterceptor</code>, which exposes &quot;before&quot; and &quot;after&quot; the handshake methods. Such an interceptor can be used to preclude the handshake or to make any attributes available to the <code class="literal">WebSocketSession</code>. For example, there is a built-in interceptor for passing HTTP session attributes to the WebSocket session:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableWebSocket</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebSocketConfig <span class="hl-keyword">implements</span> WebSocketConfigurer {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> registerWebSocketHandlers(WebSocketHandlerRegistry registry) {
        registry.addHandler(<span class="hl-keyword">new</span> MyHandler(), <span class="hl-string">&quot;/myHandler&quot;</span>)
            .addInterceptors(<span class="hl-keyword">new</span> HttpSessionHandshakeInterceptor());
    }

}</pre> 
    <p>And the XML configuration equivalent:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:websocket</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/websocket&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/websocket
        http://www.springframework.org/schema/websocket/spring-websocket-4.0.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;websocket:handlers&gt;</span>
        <span class="hl-tag">&lt;websocket:mapping</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;/myHandler&quot;</span> <span class="hl-attribute">handler</span>=<span class="hl-value">&quot;myHandler&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;websocket:handshake-interceptors&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.socket.server.support.HttpSessionHandshakeInterceptor&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/websocket:handshake-interceptors&gt;</span>
    <span class="hl-tag">&lt;/websocket:handlers&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myHandler&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.samples.MyHandler&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>A more advanced option is to extend the <code class="literal">DefaultHandshakeHandler</code> that performs the steps of the WebSocket handshake, including validating the client origin, negotiating a sub-protocol, and others. An application may also need to use this option if it needs to configure a custom <code class="literal">RequestUpgradeStrategy</code> in order to adapt to a WebSocket server engine and version that is not yet supported (also see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#websocket-server-deployment" title="20.2.4&nbsp;Deployment Considerations">Section&nbsp;20.2.4, Deployment Considerations</a> for more on this subject). Both the Java-config and XML namespace make it possible to configure a custom <code class="literal">HandshakeHandler</code>.</p> 
   </div> 
   <div class="section" title="20.2.3&nbsp;WebSocketHandler Decoration">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="websocket-server-decorators"></a>20.2.3&nbsp;WebSocketHandler Decoration</h3>
      </div>
     </div>
    </div> 
    <p>Spring provides a <code class="literal">WebSocketHandlerDecorator</code> base class that can be used to decorate a <code class="literal">WebSocketHandler</code> with additional behavior. Logging and exception handling implementations are provided and added by default when using the WebSocket Java-config or XML namespace. The <code class="literal">ExceptionWebSocketHandlerDecorator</code> catches all uncaught exceptions arising from any WebSocketHandler method and closes the WebSocket session with status <code class="literal">1011</code> that indicates a server error.</p> 
   </div> 
   <div class="section" title="20.2.4&nbsp;Deployment Considerations">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="websocket-server-deployment"></a>20.2.4&nbsp;Deployment Considerations</h3>
      </div>
     </div>
    </div> 
    <p>The Spring WebSocket API is easy to integrate into a Spring MVC application where the <code class="literal">DispatcherServlet</code> serves both HTTP WebSocket handshake as well as other HTTP requests. It is also easy to integrate into other HTTP processing scenarios by invoking <code class="literal">WebSocketHttpRequestHandler</code>. This is convenient and easy to understand. However, special considerations apply with regards to JSR-356 runtimes.</p> 
    <p>The Java WebSocket API (JSR-356) provides two deployment mechanisms. The first involves a Servlet container classpath scan (Servlet 3 feature) at startup; and the other is a registration API to use at Servlet container initialization. Neither of these mechanism make it possible to use a single &quot;front controller&quot; for all HTTP processing&#x2009;&#x2009;including WebSocket handshake and all other HTTP requests&#x2009;&#x2009;such as Spring MVCs <code class="literal">DispatcherServlet</code>.</p> 
    <p>This is a significant limitation of JSR-356 that Springs WebSocket support addresses by providing a server-specific <code class="literal">RequestUpgradeStrategy</code> even when running in a JSR-356 runtime. At present such support is available on Tomcat 7.0.47+, Jetty 9.0+, and GlassFish 4.0+. Additional support will be added as more WebSocket runtimes become available.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>A request to overcome the above limitation in the Java WebSocket API has been created and can be followed at <a class="ulink" href="https://java.net/jira/browse/WEBSOCKET_SPEC-211" target="_top">WEBSOCKET_SPEC-211</a>. Also note that Tomcat and Jetty already provide native API alternatives that makes it easy to overcome the limitation. We are hopeful that more servers will follow their example regardless of when it is addressed in the Java WebSocket API.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>A secondary consideration is that Servlet containers with JSR-356 support are expected to perform an SCI scan that can slow down application startup, in some cases dramatically. If a significant impact is observed after an upgrade to a Servlet container version with JSR-356 support, it should be possible to selectively enable or disable web fragments (and SCI scanning) through the use of an <code class="literal">&lt;absolute-ordering /&gt;</code> element in <code class="literal">web.xml</code>:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;web-app</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://java.sun.com/xml/ns/javaee
        http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span>
    <span class="hl-attribute">version</span>=<span class="hl-value">&quot;3.0&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;absolute-ordering/&gt;</span>

<span class="hl-tag">&lt;/web-app&gt;</span></pre> 
    <p>You can then selectively enable web fragments by name, such as Springs own <code class="literal">SpringServletContainerInitializer</code> that provides support for the Servlet 3 Java initialization API, if required:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;web-app</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://java.sun.com/xml/ns/javaee&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://java.sun.com/xml/ns/javaee
        http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span>
    <span class="hl-attribute">version</span>=<span class="hl-value">&quot;3.0&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;absolute-ordering&gt;</span>
        <span class="hl-tag">&lt;name&gt;</span>spring_web<span class="hl-tag">&lt;/name&gt;</span>
    <span class="hl-tag">&lt;/absolute-ordering&gt;</span>

<span class="hl-tag">&lt;/web-app&gt;</span></pre> 
   </div> 
  </div> 
  <div class="section" title="20.3&nbsp;Fallback Options">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="websocket-fallback"></a>20.3&nbsp;Fallback Options</h2>
     </div>
    </div>
   </div> 
   <p>As explained in the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#websocket-into-fallback-options" title="20.1.1&nbsp;Fallback Options">introduction</a>, WebSocket is not supported in all browsers yet and may be precluded by restrictive network proxies. This is why Spring provides fallback options that emulate the WebSocket API as close as possible based on the <a class="ulink" href="https://github.com/sockjs/sockjs-protocol" target="_top">SockJS protocol</a>.</p> 
   <div class="section" title="20.3.1&nbsp;Enable SockJS">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="websocket-fallback-sockjs-enable"></a>20.3.1&nbsp;Enable SockJS</h3>
      </div>
     </div>
    </div> 
    <p>SockJS is easy to enable through a configuration:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableWebSocket</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebSocketConfig <span class="hl-keyword">implements</span> WebSocketConfigurer {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> registerWebSocketHandlers(WebSocketHandlerRegistry registry) {
        registry.addHandler(myHandler(), <span class="hl-string">&quot;/myHandler&quot;</span>).withSockJS();
    }

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> WebSocketHandler myHandler() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> MyHandler();
    }

}</pre> 
    <p>and the XML configuration equivalent:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:websocket</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/websocket&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/websocket
        http://www.springframework.org/schema/websocket/spring-websocket-4.0.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;websocket:handlers&gt;</span>
        <span class="hl-tag">&lt;websocket:mapping</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;/myHandler&quot;</span> <span class="hl-attribute">handler</span>=<span class="hl-value">&quot;myHandler&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;websocket:sockjs/&gt;</span>
    <span class="hl-tag">&lt;/websocket:handlers&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myHandler&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.samples.MyHandler&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>The above is for use in Spring MVC applications and should be included in the configuration of a <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#">DispatcherServlet</a>. However, Springs WebSocket and SockJS support does not depend on Spring MVC. It is relatively simple to integrate into other HTTP serving environments with the help of <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/socket/sockjs/support/SockJsHttpRequestHandler.html" target="_top">SockJsHttpRequestHandler</a>.</p> 
    <p>On the browser side, applications can use the <a class="ulink" href="https://github.com/sockjs/sockjs-client" target="_top">sockjs-client</a> that emulates the W3C WebSocket API and communicates with the server to select the best transport option depending on the browser its running in. Review the <a class="ulink" href="https://github.com/sockjs/sockjs-client" target="_top">sockjs-client</a> page and the list of transport types supported by browser. The client also provides several configuration options, for example, to specify which transports to include.</p> 
   </div> 
   <div class="section" title="20.3.2&nbsp;How SockJS Works">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="websocket-fallback-sockjs-explained"></a>20.3.2&nbsp;How SockJS Works</h3>
      </div>
     </div>
    </div> 
    <p>An in-depth description of how SockJS works is beyond the scope of this document. This section summarizes a few key facts to aid with understanding. The SockJS protocol itself is defined in a <a class="ulink" href="https://github.com/sockjs/sockjs-protocol/blob/master/sockjs-protocol-0.3.3.py" target="_top">test suite</a>, with comments explaining the protocol. There is also an <a class="ulink" href="http://sockjs.github.io/sockjs-protocol/sockjs-protocol-0.3.3.html" target="_top">HTML version of that test</a> showing comments on the right and code on the left.</p> 
    <p>The SockJS client issues HTTP requests with this URL structure:</p> 
    <p title="SockJS URL"> <b>SockJS URL.&nbsp;</b> </p>
    <pre class="screen">http://host:port/{path-to-sockjs-endpoint}/{server-id}/{session-id}/{transport}</pre>
    <p title="SockJS URL"> </p> 
    <p>The WebSocket transport type uses a single HTTP connection to perform a WebSocket handshake and establish an actual WebSocket session. HTTP-based transports on the other hand must simulate the WebSocket API and at any time may use two HTTP connections&#x2009;&#x2009;one for server-to-client messages, via <a class="ulink" href="https://spring.io/blog/2012/05/08/spring-mvc-3-2-preview-techniques-for-real-time-updates" target="_top">HTTP streaming or long polling</a>, and another for sending client messages to the server via HTTP POST.</p> 
    <p>The session id is useful with HTTP transports to associate individual HTTP requests that belong to the same SockJS session. The server id is not used in the protocol but is added to help in clustered environments.</p> 
    <p>SockJS adds a minimal amount of message framing. For example, the server can send an &quot;open frame&quot; (the letter <code class="literal">o</code>), a &quot;heartbeat frame&quot; (the letter <code class="literal">h</code>), or a &quot;close frame&quot; (the letter <code class="literal">c</code>); while the client sends messages as a JSON-encoded array prepended with the letter <code class="literal">a</code> (e.g. <code class="literal">a[&quot;message1&quot;,&quot;message2&quot;]</code>).</p> 
    <p>By default the server sends a heartbeat frame every 25 seconds to keep proxies and loadbalancers from timing out the connection.</p> 
   </div> 
   <div class="section" title="20.3.3&nbsp;Springs SockJS Support">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="websocket-fallback-sockjs-spring"></a>20.3.3&nbsp;Springs SockJS Support</h3>
      </div>
     </div>
    </div> 
    <p>In the Spring Framework, server-side support for the SockJS protocol is provided through a hierarchy of classes that implement the <code class="literal">SockJsService</code> interface, while <code class="literal">SockJsHttpRequestHandler</code> integrates the service into HTTP request processing.</p> 
    <p>To implement HTTP streaming and long polling in Servlet containers (both of which require an HTTP connection to remain open longer than usual), Springs SockJS support relies on Servlet 3 async support.</p> 
    <div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Warning">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="./Spring Framework Reference Documentation_files/warning.png" /></td>
        <th align="left">Warning</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Servlet 3 async support does not expose a notification when a client disconnects, e.g. a browser tab is closed, page is refreshed, etc (see <a class="ulink" href="https://java.net/jira/browse/SERVLET_SPEC-44" target="_top">SERVLET_SPEC-44</a>). However, the Serlvet container will usually raise an IOException on the next attempt to write to the response; at which point the SockJS session will be closed. Since the SockJsService sends a heartbeat every 25 seconds, typically a disconnected client will be detected within that time period.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
  </div> 
  <div class="section" title="20.4&nbsp;STOMP Messaging">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="websocket-stomp"></a>20.4&nbsp;STOMP Messaging</h2>
     </div>
    </div>
   </div> 
   <p>The WebSocket protocol defines two main types of messages&#x2009;&#x2009;text and binary&#x2009;&#x2009;but leaves their content undefined. Instead its expected that client and server may agree on using a sub-protocol, i.e. a higher-level protocol that defines the message content. Using a sub-protocol is optional but either way client and server both need to understand how to interpret messages.</p> 
   <div class="section" title="20.4.1&nbsp;Overview of STOMP">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="websocket-stomp-overview"></a>20.4.1&nbsp;Overview of STOMP</h3>
      </div>
     </div>
    </div> 
    <p><a class="ulink" href="http://stomp.github.io/stomp-specification-1.2.html#Abstract" target="_top">STOMP</a> is a simple messaging protocol originally created for scripting languages (such as Ruby, Python and Perl) to connect to enterprise message brokers. It is designed to address a subset of commonly used patterns in messaging protocols. STOMP can be used over any reliable 2-way streaming network protocol such as TCP and WebSocket.</p> 
    <p>STOMP is a frame based protocol with frames modelled on HTTP. This is the structure of a frame:</p> 
    <pre class="screen">COMMAND
header1:value1
header2:value2

Body^@</pre> 
    <p>For example, a client can use the <code class="literal">SEND</code> command to send a message or the <code class="literal">SUBSCRIBE</code> command to express interest in receiving messages. Both of these commands require a <code class="literal">&quot;destination&quot;</code> header that indicates where to send a message to, or likewise what to subscribe to.</p> 
    <p>Here is an example of a client sending a request to buy stock shares:</p> 
    <pre class="screen">SEND
destination:/queue/trade
content-type:application/json
content-length:44

{&quot;action&quot;:&quot;BUY&quot;,&quot;ticker&quot;:&quot;MMM&quot;,&quot;shares&quot;,44}^@</pre> 
    <p>Here is an example of a client subscribing to receive stock quotes:</p> 
    <pre class="screen">SUBSCRIBE
id:sub-1
destination:/topic/price.stock.*

^@</pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>The meaning of a destination is intentionally left opaque in the STOMP spec. It can be any string and its entirely up to STOMP servers to define the semantics and the syntax of the destinations that they support. It is very common however, for destinations to be path-like strings where <code class="literal">&quot;/topic/..&quot;</code> implies publish-subscribe (<span class="emphasis"><em>one-to-many</em></span>) and <code class="literal">&quot;/queue/&quot;</code> to implies point-to-point (<span class="emphasis"><em>one-to-one</em></span>) message exchanges.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>STOMP servers can use the <code class="literal">MESSAGE</code> command to broadcast messages to all subscribers. Here is an example of a server sending a stock quote to a subscribed client:</p> 
    <pre class="screen">MESSAGE
message-id:nxahklf6-1
subscription:sub-1
destination:/topic/price.stock.MMM

{&quot;ticker&quot;:&quot;MMM&quot;,&quot;price&quot;:129.45}^@</pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Its important to know that a server cannot send unsolicited messages. All messages from a server must be in response to a specific client subscription and the <code class="literal">&quot;subscription-id&quot;</code> header of the server message must match the <code class="literal">&quot;id&quot;</code> header of the client subscription.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>The above overview is intended to provide the most basic understanding of the STOMP protocol. It is recommended to review the protocol <a class="ulink" href="http://stomp.github.io/stomp-specification-1.2.html" target="_top">specification</a>, which is easy to follow and manageable in terms of size.</p> 
    <p>The following summarizes the benefits for an application from using STOMP over WebSocket:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> Standard message format </li>
      <li class="listitem"> Application-level protocol with support for common messaging patterns </li>
      <li class="listitem"> Client-side support, e.g. <a class="ulink" href="https://github.com/jmesnil/stomp-websocket" target="_top">stomp.js</a>, <a class="ulink" href="https://github.com/cujojs/msgs" target="_top">msgs.js</a> </li>
      <li class="listitem"> The ability to interpret, route, and process messages on both client and server-side </li>
      <li class="listitem"> The option to plug a message broker&#x2009;&#x2009;RabbitMQ, ActiveMQ, many others&#x2009;&#x2009;to broadcast messages (explained later) </li>
     </ul>
    </div> 
    <p>Most importantly the use of STOMP (vs plain WebSocket) enables the Spring Framework to provide a programming model for application-level use in the same way that Spring MVC provides a programming model based on HTTP.</p> 
   </div> 
   <div class="section" title="20.4.2&nbsp;Enable STOMP (over WebSocket)">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="websocket-stomp-enable"></a>20.4.2&nbsp;Enable STOMP (over WebSocket)</h3>
      </div>
     </div>
    </div> 
    <p>The Spring Framework provides support for using STOMP over WebSocket through the <code class="literal">spring-messaging</code> and <code class="literal">spring-websocket</code> modules. Its easy to enable it.</p> 
    <p>Here is an example of configuring a STOMP WebSocket endpoint with SockJS fallback options. The endpoint is available for clients to connect to at URL path <code class="literal">/portfolio</code>:</p> 
    <pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;
<span class="hl-keyword">import</span> org.springframework.web.socket.config.annotation.StompEndpointRegistry;

<i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableWebSocketMessageBroker</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebSocketConfig <span class="hl-keyword">implements</span> WebSocketMessageBrokerConfigurer {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> registerStompEndpoints(StompEndpointRegistry registry) {
        registry.addEndpoint(<span class="hl-string">&quot;/portfolio&quot;</span>).withSockJS();
    }

    <span class="hl-comment">// ...</span>

}</pre> 
    <p>XML configuration equivalent:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:websocket</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/websocket&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/websocket
        http://www.springframework.org/schema/websocket/spring-websocket-4.0.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;websocket:message-broker&gt;</span>
        <span class="hl-tag">&lt;websocket:stomp-endpoint</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;/portfolio&quot;</span><span class="hl-tag"> /&gt;</span>
            <span class="hl-tag">&lt;websocket:sockjs/&gt;</span>
        <span class="hl-tag">&lt;/websocket:stomp-endpoint&gt;</span>
        ...
    <span class="hl-tag">&lt;/websocket:message-broker&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>On the browser side, a client might connect as follows using <a class="ulink" href="https://github.com/jmesnil/stomp-websocket" target="_top">stomp.js</a> and the <a class="ulink" href="https://github.com/sockjs/sockjs-client" target="_top">sockjs-client</a>:</p> 
    <pre class="programlisting"><span class="hl-keyword">var</span> socket = <span class="hl-keyword">new</span> SockJS(<span class="hl-string">&quot;/spring-websocket-portfolio/portfolio&quot;</span>);
<span class="hl-keyword">var</span> stompClient = Stomp.over(socket);</pre> 
    <p>Or if connecting via WebSocket (without SockJS):</p> 
    <pre class="programlisting"><span class="hl-keyword">var</span> socket = <span class="hl-keyword">new</span> WebSocket(<span class="hl-string">&quot;/spring-websocket-portfolio/portfolio&quot;</span>);
<span class="hl-keyword">var</span> stompClient = Stomp.over(socket);</pre> 
   </div> 
   <div class="section" title="20.4.3&nbsp;Overview of STOMP Message Handling">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="websocket-stomp-handle"></a>20.4.3&nbsp;Overview of STOMP Message Handling</h3>
      </div>
     </div>
    </div> 
    <p>When a STOMP endpoint is configured, the Spring application effectively becomes the broker to connected clients, handling incoming messages and broadcasting messages back to them. This part of the documentation describes how STOMP messages are handled within the application.</p> 
    <p>As mentioned in the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#websocket-intro-architecture" title="20.1.2&nbsp;Messaging Architecture">introduction</a> the <code class="literal">spring-messaging</code> module contains key abstractions from the <a class="ulink" href="https://spring.io/spring-integration" target="_top">Spring Integration</a> project, including <code class="literal">Message</code>, <code class="literal">MessageChannel</code>, <code class="literal">MessageHandler</code> and a few others.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Spring Integration 4 will be the first version to start using the abstractions from the package structure of the <code class="literal">spring-messaging</code> module as opposed to its own present packages. Spring Integration also provides many additional abstractions and implementations in support of the well-known EAI patterns (<a class="ulink" href="http://www.eaipatterns.com/" target="_top">enterprise integration patterns</a>).</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p><a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/messaging/MessageChannel.html" target="_top">MessageChannel</a> is a simple contract for passing messages between components without creating tight coupling among them. <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/messaging/SubscribableChannel.html" target="_top">SubscribableChannel</a> extends it, with the ability to register subscribers; and <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/messaging/support/ExecutorSubscribableChannel.html" target="_top">ExecutorSubscribableChannel</a> is an implementation that passes messages to subscribers in the same thread or a different thread depending on whether it has been provided with a <code class="literal">java.util.concurrent.Executor</code>. This enables assembling message handling flows from various components and modifying them through configuration.</p> 
    <p>The provided Java-config <code class="literal">@EnableWebSocketMessageBroker</code> and XML namespace <code class="literal">&lt;websocket:message-broker&gt;</code> each put together a default message handling flow for applications to use, as explained next. This flow can be modified, customized, or extended. For example, an application can add a <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/messaging/support/ChannelInterceptor.html" target="_top">ChannelInterceptor</a> to any message channel in order to intercept messages passing through it; it can register additional message handling components, alternate between synchronous and asynchronous message passing, and so on.</p> 
    <p>Incoming client STOMP messages are passed to a message channel with the name <code class="literal">&quot;clientInboundChannel&quot;</code>. By default the messages are routed to annotated methods as well as to a &quot;simple&quot; message broker. This simple message broker automatically records subscriptions, in-memory, and broadcasts messages as necessary. As explained later, you can also use a full-featured message broker (e.g. RabbitMQ, ActiveMQ, and any other broker that supports STOMP) to manage subscriptions and broadcast messages.</p> 
    <p>Below is example configuration:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableWebSocketMessageBroker</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebSocketConfig <span class="hl-keyword">implements</span> WebSocketMessageBrokerConfigurer {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> registerStompEndpoints(StompEndpointRegistry registry) {
        registry.addEndpoint(<span class="hl-string">&quot;/portfolio&quot;</span>).withSockJS();
    }

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> configureMessageBroker(MessageBrokerRegistry registry) {
        registry.enableSimpleBroker(<span class="hl-string">&quot;/topic/&quot;</span>);
        registry.setApplicationDestinationPrefixes(<span class="hl-string">&quot;/app&quot;</span>);
    }

}</pre> 
    <p>XML configuration equivalent:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:websocket</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/websocket&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/websocket
        http://www.springframework.org/schema/websocket/spring-websocket-4.0.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;websocket:message-broker</span> <span class="hl-attribute">application-destination-prefix</span>=<span class="hl-value">&quot;/app&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;websocket:stomp-endpoint</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;/portfolio&quot;</span><span class="hl-tag"> /&gt;</span>
            <span class="hl-tag">&lt;websocket:sockjs/&gt;</span>
        <span class="hl-tag">&lt;/websocket:stomp-endpoint&gt;</span>
        <span class="hl-tag">&lt;websocket:simple-broker</span> <span class="hl-attribute">prefix</span>=<span class="hl-value">&quot;/topic&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/websocket:message-broker&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>The configuration example assigns destination prefixes&#x2009;&#x2009;<code class="literal">/app</code> for filtering messages to annotated methods and <code class="literal">/topic</code> for messages to the broker. The examples below demonstrate how this can be used.</p> 
    <p>The destination prefix should not be included in annotation mappings. For example, this method handles messages to destination <code class="literal">/app/greetings</code>:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> GreetingController {

    <i><span class="hl-annotation" style="color: gray">@MessageMapping(&quot;/greetings&quot;)</span></i> {
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> handle(String greeting) {
        <span class="hl-comment">// ...</span>
    }

}

</pre> 
    <p>The method accepts a String extracted from the payload of the message, possibly converted based on its content type. The method can also return a value, which is wrapped as the payload of a new message and sent to a message channel named <code class="literal">&quot;brokerChannel&quot;</code> (which is used for sending messages to the broker from within the application). The new message is sent to the same destination as that of the client message, but with the default prefix <code class="literal">/topic</code> (you can also use <code class="literal">@SendTo</code> for any other target destination):</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> GreetingController {

    <i><span class="hl-annotation" style="color: gray">@MessageMapping(&quot;/greetings&quot;)</span></i> {
    <span class="hl-keyword">public</span> String handle(String greeting) {
        <span class="hl-keyword">return</span> <span class="hl-string">&quot;[&quot;</span> + getTimestamp() + <span class="hl-string">&quot;: &quot;</span> + greeting;
    }

}

</pre> 
    <p>As a result, to put it all together, a client sends a greeting message to destination <code class="literal">/app/greetings</code>. The message is routed to <code class="literal">GreetingController</code>, which enriches the greeting with a timestamp and sends a new message to the broker with destination <code class="literal">/topic/greetings</code>. The broker then broadcasts the message to all subscribed, connected clients.</p> 
    <div class="section" title="Annotation-based Message Handling">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="websocket-stomp-handle-annotations"></a>Annotation-based Message Handling</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">@MessageMapping</code> annotation is supported on methods of <code class="literal">@Controller</code>-annotated classes. It can be used for mapping methods to path-like message destinations. It is also possible to combine with a type-level <code class="literal">@MessageMapping</code> for expressing shared mappings across all annotated methods within a controller.</p> 
     <p>Destination mappings can contain Ant-style patterns (e.g. &quot;/foo*&quot;, &quot;/foo/**&quot;) and template variables (e.g. &quot;/foo/{id}&quot;), which can then be accessed via <code class="literal">@DestinationVariable</code> method arguments. This should be familiar to Spring MVC users, in fact the same <code class="literal">AntPathMatcher</code> is used for matching destinations based on patterns and for extracting template variables.</p> 
     <p>The following method arguments are supported for <code class="literal">@MessageMapping</code> methods:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> <code class="literal">Message</code> method argument to get access to the complete message being processed. </li>
       <li class="listitem"> <code class="literal">@Payload</code>-annotated argument for access to the payload of a message, converted with a <code class="literal">org.springframework.messaging.converter.MessageConverter</code>. The presence of the annotation is not required since it is assumed by default. </li>
       <li class="listitem"> <code class="literal">@Header</code>-annotated arguments for access to a specific header value along with type conversion using an <code class="literal">org.springframework.core.convert.converter.Converter</code> if necessary. </li>
       <li class="listitem"> <code class="literal">@Headers</code>-annotated method argument that must also be assignable to <code class="literal">java.util.Map</code> for access to all headers in the message. </li>
       <li class="listitem"> <code class="literal">MessageHeaders</code> method argument for getting access to a map of all headers. </li>
       <li class="listitem"> <code class="literal">MessageHeaderAccessor</code>, <code class="literal">SimpMessageHeaderAccessor</code>, or <code class="literal">StompHeaderAccessor</code> for access to headers via typed accessor methods. </li>
       <li class="listitem"> <code class="literal">@DestinationVariable</code>-annotated arguments for access to template variables extracted from the message destination. Values will be converted to the declared method argument type as necessary. </li>
       <li class="listitem"> <code class="literal">java.security.Principal</code> method arguments reflecting the user logged in at the time of the WebSocket HTTP handshake. </li>
      </ul>
     </div> 
     <p>The return value from an <code class="literal">@MessageMapping</code> method is converted with a <code class="literal">org.springframework.messaging.converter.MessageConverter</code> and used as the body of a new message that is then sent, by default, to the <code class="literal">&quot;brokerChannel&quot;</code> with the same destination as the client message but using the prefix &quot;/topic&quot; by default. An <code class="literal">@SendTo</code> message level annotation can be used to specify any other destination instead.</p> 
     <p>An <code class="literal">@SubscribeMapping</code> annotation can also be used to map subscription requests to <code class="literal">@Controller</code> methods. It is supported on the method level, but can also be combined with a type level <code class="literal">@MessageMapping</code> annotation that expresses shared mappings across all message handling methods within the same controller.</p> 
     <p>By default the return value from an <code class="literal">@SubscribeMapping</code> method is sent as a message directly back to the connected client and does not pass through the broker. This is useful for implementing request-reply message interactions; for example, to fetch application data when the application UI is being initialized. Or alternatively an <code class="literal">@SubscribeMapping</code> method can be annotated with <code class="literal">@SendTo</code> in which case the resulting message is sent to the <code class="literal">&quot;brokerChannel&quot;</code> using the specified target destination.</p> 
    </div> 
    <div class="section" title="Sending Messages From Anywhere">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="websocket-stomp-handle-send"></a>Sending Messages From Anywhere</h4>
       </div>
      </div>
     </div> 
     <p>What if you wanted to send messages to connected clients from any part of the application? Any application component can send messages to the <code class="literal">&quot;brokerChannel&quot;</code>. The easist way to do that is to have a <code class="literal">SimpMessagingTemplate</code> injected, and use it to send messages. Typically it should be easy to have it injected by type, for example:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> GreetingController {

    <span class="hl-keyword">private</span> SimpMessagingTemplate template;

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">public</span> GreetingController(SimpMessagingTemplate template) {
        <span class="hl-keyword">this</span>.template = template;
    }

    <i><span class="hl-annotation" style="color: gray">@RequestMapping(value=&quot;/greetings&quot;, method=POST)</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> greet(String greeting) {
        String text = <span class="hl-string">&quot;[&quot;</span> + getTimestamp() + <span class="hl-string">&quot;]:&quot;</span> + greeting;
        <span class="hl-keyword">this</span>.template.convertAndSend(<span class="hl-string">&quot;/topic/greetings&quot;</span>, text);
    }

}</pre> 
     <p>But it can also be qualified by its name &quot;brokerMessagingTemplate&quot; if another bean of the same type exists.</p> 
    </div> 
    <div class="section" title="Simple Message Broker">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="websocket-stomp-handle-simple-broker"></a>Simple Message Broker</h4>
       </div>
      </div>
     </div> 
     <p>The built-in, simple, message broker handles subscription requests from clients, stores them in memory, and broadcasts messages to connected clients with matching destinations. The broker supports path-like destinations, including subscriptions to Ant-style destination patterns.</p> 
    </div> 
    <div class="section" title="Using a Full-Featured Message Broker">