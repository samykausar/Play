<div class="part" title="Part&nbsp;VI.&nbsp;Integration">
 <div class="titlepage">
  <div>
   <div>
    <h1 class="title"><a name="spring-integration"></a>Part&nbsp;VI.&nbsp;Integration</h1>
   </div>
  </div>
 </div> 
 <div class="partintro" title="Integration">
  <div></div> 
  <p>This part of the reference documentation covers the Spring Frameworks integration with a number of Java EE (and related) technologies.</p> 
  <div class="itemizedlist">
   <ul class="itemizedlist" type="disc">
    <li class="listitem"> <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#remoting" title="21.&nbsp;Remoting and web services using Spring">Chapter&nbsp;21, <i>Remoting and web services using Spring</i></a> </li>
    <li class="listitem"> <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#ejb" title="22.&nbsp;Enterprise JavaBeans (EJB) integration">Chapter&nbsp;22, <i>Enterprise JavaBeans (EJB) integration</i></a> </li>
    <li class="listitem"> <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#jms" title="23.&nbsp;JMS (Java Message Service)">Chapter&nbsp;23, <i>JMS (Java Message Service)</i></a> </li>
    <li class="listitem"> <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#jmx" title="24.&nbsp;JMX">Chapter&nbsp;24, <i>JMX</i></a> </li>
    <li class="listitem"> <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#cci" title="25.&nbsp;JCA CCI">Chapter&nbsp;25, <i>JCA CCI</i></a> </li>
    <li class="listitem"> <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mail" title="26.&nbsp;Email">Chapter&nbsp;26, <i>Email</i></a> </li>
    <li class="listitem"> <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#scheduling" title="27.&nbsp;Task Execution and Scheduling">Chapter&nbsp;27, <i>Task Execution and Scheduling</i></a> </li>
    <li class="listitem"> <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#dynamic-language" title="28.&nbsp;Dynamic language support">Chapter&nbsp;28, <i>Dynamic language support</i></a> </li>
    <li class="listitem"> <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#cache" title="29.&nbsp;Cache Abstraction">Chapter&nbsp;29, <i>Cache Abstraction</i></a> </li>
   </ul>
  </div> 
 </div> 
 <div class="chapter" title="21.&nbsp;Remoting and web services using Spring">
  <div class="titlepage">
   <div>
    <div>
     <h2 class="title"><a name="remoting"></a>21.&nbsp;Remoting and web services using Spring</h2>
    </div>
   </div>
  </div> 
  <div class="section" title="21.1&nbsp;Introduction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="remoting-introduction"></a>21.1&nbsp;Introduction</h2>
     </div>
    </div>
   </div> 
   <p>Spring features integration classes for remoting support using various technologies. The remoting support eases the development of remote-enabled services, implemented by your usual (Spring) POJOs. Currently, Spring supports the following remoting technologies:</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem"> <span class="emphasis"><em>Remote Method Invocation (RMI)</em></span>. Through the use of the <code class="literal">RmiProxyFactoryBean</code> and the <code class="literal">RmiServiceExporter</code> Spring supports both traditional RMI (with <code class="literal">java.rmi.Remote</code> interfaces and <code class="literal">java.rmi.RemoteException</code>) and transparent remoting via RMI invokers (with any Java interface). </li>
     <li class="listitem"> <span class="emphasis"><em>Springs HTTP invoker</em></span>. Spring provides a special remoting strategy which allows for Java serialization via HTTP, supporting any Java interface (just like the RMI invoker). The corresponding support classes are <code class="literal">HttpInvokerProxyFactoryBean</code> and <code class="literal">HttpInvokerServiceExporter</code>. </li>
     <li class="listitem"> <span class="emphasis"><em>Hessian</em></span>. By using Springs <code class="literal">HessianProxyFactoryBean</code> and the <code class="literal">HessianServiceExporter</code> you can transparently expose your services using the lightweight binary HTTP-based protocol provided by Caucho. </li>
     <li class="listitem"> <span class="emphasis"><em>Burlap</em></span>. Burlap is Cauchos XML-based alternative to Hessian. Spring provides support classes such as <code class="literal">BurlapProxyFactoryBean</code> and <code class="literal">BurlapServiceExporter</code>. </li>
     <li class="listitem"> <span class="emphasis"><em>JAX-WS</em></span>. Spring provides remoting support for web services via JAX-WS (the successor of JAX-RPC, as introduced in Java EE 5 and Java 6). </li>
     <li class="listitem"> <span class="emphasis"><em>JMS</em></span>. Remoting using JMS as the underlying protocol is supported via the <code class="literal">JmsInvokerServiceExporter</code> and <code class="literal">JmsInvokerProxyFactoryBean</code> classes. </li>
     <li class="listitem"> <span class="emphasis"><em>AMQP</em></span>. Remoting using AMQP as the underlying protocol is supported by the Spring AMQP project. </li>
    </ul>
   </div> 
   <p>While discussing the remoting capabilities of Spring, well use the following domain model and corresponding services:</p> 
   <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Account <span class="hl-keyword">implements</span> Serializable{

    <span class="hl-keyword">private</span> String name;

    <span class="hl-keyword">public</span> String getName(){
        <span class="hl-keyword">return</span> name;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(String name) {
        <span class="hl-keyword">this</span>.name = name;
    }

}</pre> 
   <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> AccountService {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> insertAccount(Account account);

    <span class="hl-keyword">public</span> List&lt;Account&gt; getAccounts(String name);

}</pre> 
   <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> RemoteAccountService <span class="hl-keyword">extends</span> Remote {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> insertAccount(Account account) <span class="hl-keyword">throws</span> RemoteException;

    <span class="hl-keyword">public</span> List&lt;Account&gt; getAccounts(String name) <span class="hl-keyword">throws</span> RemoteException;

}</pre> 
   <pre class="programlisting"><span class="hl-comment">// the implementation doing nothing at the moment</span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AccountServiceImpl <span class="hl-keyword">implements</span> AccountService {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> insertAccount(Account acc) {
        <span class="hl-comment">// do something...</span>
    }

    <span class="hl-keyword">public</span> List&lt;Account&gt; getAccounts(String name) {
        <span class="hl-comment">// do something...</span>
    }

}</pre> 
   <p>We will start exposing the service to a remote client by using RMI and talk a bit about the drawbacks of using RMI. Well then continue to show an example using Hessian as the protocol.</p> 
  </div> 
  <div class="section" title="21.2&nbsp;Exposing services using RMI">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="remoting-rmi"></a>21.2&nbsp;Exposing services using RMI</h2>
     </div>
    </div>
   </div> 
   <p>Using Springs support for RMI, you can transparently expose your services through the RMI infrastructure. After having this set up, you basically have a configuration similar to remote EJBs, except for the fact that there is no standard support for security context propagation or remote transaction propagation. Spring does provide hooks for such additional invocation context when using the RMI invoker, so you can for example plug in security frameworks or custom security credentials here.</p> 
   <div class="section" title="21.2.1&nbsp;Exporting the service using the RmiServiceExporter">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="remoting-rmi-server"></a>21.2.1&nbsp;Exporting the service using the RmiServiceExporter</h3>
      </div>
     </div>
    </div> 
    <p>Using the <code class="literal">RmiServiceExporter</code>, we can expose the interface of our AccountService object as RMI object. The interface can be accessed by using <code class="literal">RmiProxyFactoryBean</code>, or via plain RMI in case of a traditional RMI service. The <code class="literal">RmiServiceExporter</code> explicitly supports the exposing of any non-RMI services via RMI invokers.</p> 
    <p>Of course, we first have to set up our service in the Spring container:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;accountService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.AccountServiceImpl&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- any additional properties, maybe a DAO? --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>Next well have to expose our service using the <code class="literal">RmiServiceExporter</code>:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.remoting.rmi.RmiServiceExporter&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- does not necessarily have to be the same name as the bean to be exported --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;AccountService&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;service&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;accountService&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceInterface&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;example.AccountService&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-comment">&lt;!-- defaults to 1099 --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;registryPort&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;1199&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>As you can see, were overriding the port for the RMI registry. Often, your application server also maintains an RMI registry and it is wise to not interfere with that one. Furthermore, the service name is used to bind the service under. So right now, the service will be bound at <code class="literal">'rmi://HOST:1199/AccountService'</code>. Well use the URL later on to link in the service at the client side.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>The <code class="literal">servicePort</code> property has been omitted (it defaults to 0). This means that an anonymous port will be used to communicate with the service.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="21.2.2&nbsp;Linking in the service at the client">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="remoting-rmi-client"></a>21.2.2&nbsp;Linking in the service at the client</h3>
      </div>
     </div>
    </div> 
    <p>Our client is a simple object using the <code class="literal">AccountService</code> to manage accounts:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleObject {

    <span class="hl-keyword">private</span> AccountService accountService;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setAccountService(AccountService accountService) {
        <span class="hl-keyword">this</span>.accountService = accountService;
    }

    <span class="hl-comment">// additional methods using the accountService</span>

}</pre> 
    <p>To link in the service on the client, well create a separate Spring container, containing the simple object and the service linking configuration bits:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.SimpleObject&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;accountService&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;accountService&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;accountService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.remoting.rmi.RmiProxyFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceUrl&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;rmi://HOST:1199/AccountService&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceInterface&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;example.AccountService&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>Thats all we need to do to support the remote account service on the client. Spring will transparently create an invoker and remotely enable the account service through the <code class="literal">RmiServiceExporter</code>. At the client were linking it in using the <code class="literal">RmiProxyFactoryBean</code>.</p> 
   </div> 
  </div> 
  <div class="section" title="21.3&nbsp;Using Hessian or Burlap to remotely call services via HTTP">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="remoting-caucho-protocols"></a>21.3&nbsp;Using Hessian or Burlap to remotely call services via HTTP</h2>
     </div>
    </div>
   </div> 
   <p>Hessian offers a binary HTTP-based remoting protocol. It is developed by Caucho and more information about Hessian itself can be found at <a class="ulink" href="http://www.caucho.com/" target="_top">http://www.caucho.com</a>.</p> 
   <div class="section" title="21.3.1&nbsp;Wiring up the DispatcherServlet for Hessian and co.">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="remoting-caucho-protocols-hessian"></a>21.3.1&nbsp;Wiring up the DispatcherServlet for Hessian and co.</h3>
      </div>
     </div>
    </div> 
    <p>Hessian communicates via HTTP and does so using a custom servlet. Using Springs <code class="literal">DispatcherServlet</code> principles, as known from Spring Web MVC usage, you can easily wire up such a servlet exposing your services. First well have to create a new servlet in your application (this is an excerpt from <code class="literal">'web.xml'</code>):</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;servlet&gt;</span>
    <span class="hl-tag">&lt;servlet-name&gt;</span>remoting<span class="hl-tag">&lt;/servlet-name&gt;</span>
    <span class="hl-tag">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hl-tag">&lt;/servlet-class&gt;</span>
    <span class="hl-tag">&lt;load-on-startup&gt;</span>1<span class="hl-tag">&lt;/load-on-startup&gt;</span>
<span class="hl-tag">&lt;/servlet&gt;</span>

<span class="hl-tag">&lt;servlet-mapping&gt;</span>
    <span class="hl-tag">&lt;servlet-name&gt;</span>remoting<span class="hl-tag">&lt;/servlet-name&gt;</span>
    <span class="hl-tag">&lt;url-pattern&gt;</span>/remoting/*<span class="hl-tag">&lt;/url-pattern&gt;</span>
<span class="hl-tag">&lt;/servlet-mapping&gt;</span></pre> 
    <p>Youre probably familiar with Springs <code class="literal">DispatcherServlet</code> principles and if so, you know that now youll have to create a Spring container configuration resource named <code class="literal">'remoting-servlet.xml'</code> (after the name of your servlet) in the <code class="literal">'WEB-INF'</code> directory. The application context will be used in the next section.</p> 
    <p>Alternatively, consider the use of Springs simpler <code class="literal">HttpRequestHandlerServlet</code>. This allows you to embed the remote exporter definitions in your root application context (by default in <code class="literal">'WEB-INF/applicationContext.xml'</code>), with individual servlet definitions pointing to specific exporter beans. Each servlet name needs to match the bean name of its target exporter in this case.</p> 
   </div> 
   <div class="section" title="21.3.2&nbsp;Exposing your beans by using the HessianServiceExporter">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="remoting-caucho-protocols-hessian-server"></a>21.3.2&nbsp;Exposing your beans by using the HessianServiceExporter</h3>
      </div>
     </div>
    </div> 
    <p>In the newly created application context called <code class="literal">remoting-servlet.xml</code>, well create a <code class="literal">HessianServiceExporter</code> exporting your services:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;accountService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.AccountServiceImpl&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- any additional properties, maybe a DAO? --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;/AccountService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.remoting.caucho.HessianServiceExporter&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;service&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;accountService&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceInterface&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;example.AccountService&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>Now were ready to link in the service at the client. No explicit handler mapping is specified, mapping request URLs onto services, so <code class="literal">BeanNameUrlHandlerMapping</code> will be used: Hence, the service will be exported at the URL indicated through its bean name within the containing <code class="literal">DispatcherServlet</code>'s mapping (as defined above): <code class="literal"><span>'<a class="smarterwiki-linkify" href="http://host:8080/remoting/AccountService">http://HOST:8080/remoting/AccountService</a>'</span></code>.</p> 
    <p>Alternatively, create a <code class="literal">HessianServiceExporter</code> in your root application context (e.g. in <code class="literal">'WEB-INF/applicationContext.xml'</code>):</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;accountExporter&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.remoting.caucho.HessianServiceExporter&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;service&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;accountService&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceInterface&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;example.AccountService&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>In the latter case, define a corresponding servlet for this exporter in <code class="literal">'web.xml'</code>, with the same end result: The exporter getting mapped to the request path <code class="literal">/remoting/AccountService</code>. Note that the servlet name needs to match the bean name of the target exporter.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;servlet&gt;</span>
    <span class="hl-tag">&lt;servlet-name&gt;</span>accountExporter<span class="hl-tag">&lt;/servlet-name&gt;</span>
    <span class="hl-tag">&lt;servlet-class&gt;</span>org.springframework.web.context.support.HttpRequestHandlerServlet<span class="hl-tag">&lt;/servlet-class&gt;</span>
<span class="hl-tag">&lt;/servlet&gt;</span>

<span class="hl-tag">&lt;servlet-mapping&gt;</span>
    <span class="hl-tag">&lt;servlet-name&gt;</span>accountExporter<span class="hl-tag">&lt;/servlet-name&gt;</span>
    <span class="hl-tag">&lt;url-pattern&gt;</span>/remoting/AccountService<span class="hl-tag">&lt;/url-pattern&gt;</span>
<span class="hl-tag">&lt;/servlet-mapping&gt;</span></pre> 
   </div> 
   <div class="section" title="21.3.3&nbsp;Linking in the service on the client">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="remoting-caucho-protocols-hessian-client"></a>21.3.3&nbsp;Linking in the service on the client</h3>
      </div>
     </div>
    </div> 
    <p>Using the <code class="literal">HessianProxyFactoryBean</code> we can link in the service at the client. The same principles apply as with the RMI example. Well create a separate bean factory or application context and mention the following beans where the <code class="literal">SimpleObject</code> is using the <code class="literal">AccountService</code> to manage accounts:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.SimpleObject&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;accountService&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;accountService&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;accountService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.remoting.caucho.HessianProxyFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceUrl&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;http://remotehost:8080/remoting/AccountService&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceInterface&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;example.AccountService&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   </div> 
   <div class="section" title="21.3.4&nbsp;Using Burlap">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="remoting-caucho-protocols-burlap"></a>21.3.4&nbsp;Using Burlap</h3>
      </div>
     </div>
    </div> 
    <p>We wont discuss Burlap, the XML-based equivalent of Hessian, in detail here, since it is configured and set up in exactly the same way as the Hessian variant explained above. Just replace the word <code class="literal">Hessian</code> with <code class="literal">Burlap</code> and youre all set to go.</p> 
   </div> 
   <div class="section" title="21.3.5&nbsp;Applying HTTP basic authentication to a service exposed through Hessian or Burlap">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="remoting-caucho-protocols-security"></a>21.3.5&nbsp;Applying HTTP basic authentication to a service exposed through Hessian or Burlap</h3>
      </div>
     </div>
    </div> 
    <p>One of the advantages of Hessian and Burlap is that we can easily apply HTTP basic authentication, because both protocols are HTTP-based. Your normal HTTP server security mechanism can easily be applied through using the <code class="literal">web.xml</code> security features, for example. Usually, you dont use per-user security credentials here, but rather shared credentials defined at the <code class="literal">Hessian/BurlapProxyFactoryBean</code> level (similar to a JDBC <code class="literal">DataSource</code>).</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;interceptors&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;authorizationInterceptor&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;authorizationInterceptor&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.web.servlet.handler.UserRoleAuthorizationInterceptor&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;authorizedRoles&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;administrator,operator&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>This is an example where we explicitly mention the <code class="literal">BeanNameUrlHandlerMapping</code> and set an interceptor allowing only administrators and operators to call the beans mentioned in this application context.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Of course, this example doesnt show a flexible kind of security infrastructure. For more options as far as security is concerned, have a look at the Spring Security project at <a class="ulink" href="http://projects.spring.io/spring-security/" target="_top">http://projects.spring.io/spring-security/</a>.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
  </div> 
  <div class="section" title="21.4&nbsp;Exposing services using HTTP invokers">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="remoting-httpinvoker"></a>21.4&nbsp;Exposing services using HTTP invokers</h2>
     </div>
    </div>
   </div> 
   <p>As opposed to Burlap and Hessian, which are both lightweight protocols using their own slim serialization mechanisms, Spring HTTP invokers use the standard Java serialization mechanism to expose services through HTTP. This has a huge advantage if your arguments and return types are complex types that cannot be serialized using the serialization mechanisms Hessian and Burlap use (refer to the next section for more considerations when choosing a remoting technology).</p> 
   <p>Under the hood, Spring uses either the standard facilities provided by J2SE to perform HTTP calls or Commons <code class="literal">HttpClient</code>. Use the latter if you need more advanced and easy-to-use functionality. Refer to <a class="ulink" href="http://jakarta.apache.org/commons/httpclient" target="_top">jakarta.apache.org/commons/httpclient</a> for more info.</p> 
   <div class="section" title="21.4.1&nbsp;Exposing the service object">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="remoting-httpinvoker-server"></a>21.4.1&nbsp;Exposing the service object</h3>
      </div>
     </div>
    </div> 
    <p>Setting up the HTTP invoker infrastructure for a service object resembles closely the way you would do the same using Hessian or Burlap. Just as Hessian support provides the <code class="literal">HessianServiceExporter</code>, Springs HttpInvoker support provides the <code class="literal">org.springframework.remoting.httpinvoker.HttpInvokerServiceExporter</code>.</p> 
    <p>To expose the <code class="literal">AccountService</code> (mentioned above) within a Spring Web MVC <code class="literal">DispatcherServlet</code>, the following configuration needs to be in place in the dispatchers application context:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;/AccountService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.remoting.httpinvoker.HttpInvokerServiceExporter&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;service&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;accountService&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceInterface&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;example.AccountService&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>Such an exporter definition will be exposed through the <code class="literal">DispatcherServlet</code>'s standard mapping facilities, as explained in the section on Hessian.</p> 
    <p>Alternatively, create an <code class="literal">HttpInvokerServiceExporter</code> in your root application context (e.g. in <code class="literal">'WEB-INF/applicationContext.xml'</code>):</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;accountExporter&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.remoting.httpinvoker.HttpInvokerServiceExporter&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;service&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;accountService&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceInterface&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;example.AccountService&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>In addition, define a corresponding servlet for this exporter in <code class="literal">'web.xml'</code>, with the servlet name matching the bean name of the target exporter:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;servlet&gt;</span>
    <span class="hl-tag">&lt;servlet-name&gt;</span>accountExporter<span class="hl-tag">&lt;/servlet-name&gt;</span>
    <span class="hl-tag">&lt;servlet-class&gt;</span>org.springframework.web.context.support.HttpRequestHandlerServlet<span class="hl-tag">&lt;/servlet-class&gt;</span>
<span class="hl-tag">&lt;/servlet&gt;</span>

<span class="hl-tag">&lt;servlet-mapping&gt;</span>
    <span class="hl-tag">&lt;servlet-name&gt;</span>accountExporter<span class="hl-tag">&lt;/servlet-name&gt;</span>
    <span class="hl-tag">&lt;url-pattern&gt;</span>/remoting/AccountService<span class="hl-tag">&lt;/url-pattern&gt;</span>
<span class="hl-tag">&lt;/servlet-mapping&gt;</span></pre> 
    <p>If you are running outside of a servlet container and are using Oracles Java 6, then you can use the built-in HTTP server implementation. You can configure the <code class="literal">SimpleHttpServerFactoryBean</code> together with a <code class="literal">SimpleHttpInvokerServiceExporter</code> as is shown in this example:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;accountExporter&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.remoting.httpinvoker.SimpleHttpInvokerServiceExporter&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;service&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;accountService&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceInterface&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;example.AccountService&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;httpServer&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.remoting.support.SimpleHttpServerFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;contexts&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;util:map&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;/remoting/AccountService&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;accountExporter&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/util:map&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;port&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;8080&quot;</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   </div> 
   <div class="section" title="21.4.2&nbsp;Linking in the service at the client">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="remoting-httpinvoker-client"></a>21.4.2&nbsp;Linking in the service at the client</h3>
      </div>
     </div>
    </div> 
    <p>Again, linking in the service from the client much resembles the way you would do it when using Hessian or Burlap. Using a proxy, Spring will be able to translate your calls to HTTP POST requests to the URL pointing to the exported service.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;httpInvokerProxy&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.remoting.httpinvoker.HttpInvokerProxyFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceUrl&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;http://remotehost:8080/remoting/AccountService&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceInterface&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;example.AccountService&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>As mentioned before, you can choose what HTTP client you want to use. By default, the <code class="literal">HttpInvokerProxy</code> uses the J2SE HTTP functionality, but you can also use the Commons <code class="literal">HttpClient</code> by setting the <code class="literal">httpInvokerRequestExecutor</code> property:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;httpInvokerRequestExecutor&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.remoting.httpinvoker.CommonsHttpInvokerRequestExecutor&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/property&gt;</span></pre> 
   </div> 
  </div> 
  <div class="section" title="21.5&nbsp;Web services">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="remoting-web-services"></a>21.5&nbsp;Web services</h2>
     </div>
    </div>
   </div> 
   <p>Spring provides full support for standard Java web services APIs:</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem"> Exposing web services using JAX-WS </li>
     <li class="listitem"> Accessing web services using JAX-WS </li>
    </ul>
   </div> 
   <p>In addition to stock support for JAX-WS in Spring Core, the Spring portfolio also features <a class="ulink" href="http://www.springframework.org/spring-ws" target="_top">Spring Web Services</a>, a solution for contract-first, document-driven web services - highly recommended for building modern, future-proof web services.</p> 
   <div class="section" title="21.5.1&nbsp;Exposing servlet-based web services using JAX-WS">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="remoting-web-services-jaxws-export-servlet"></a>21.5.1&nbsp;Exposing servlet-based web services using JAX-WS</h3>
      </div>
     </div>
    </div> 
    <p>Spring provides a convenient base class for JAX-WS servlet endpoint implementations - <code class="literal">SpringBeanAutowiringSupport</code>. To expose our <code class="literal">AccountService</code> we extend Springs <code class="literal">SpringBeanAutowiringSupport</code> class and implement our business logic here, usually delegating the call to the business layer. Well simply use Springs <code class="literal">@Autowired</code> annotation for expressing such dependencies on Spring-managed beans.</p> 
    <pre class="programlisting"><b class="hl-tag" style="color: blue">/**
 * JAX-WS compliant AccountService implementation that simply delegates
 * to the AccountService implementation in the root web application context.
 *
 * This wrapper class is necessary because JAX-WS requires working with dedicated
 * endpoint classes. If an existing service needs to be exported, a wrapper that
 * extends SpringBeanAutowiringSupport for simple Spring bean autowiring (through
 * the @Autowired annotation) is the simplest JAX-WS compliant way.
 *
 * This is the class registered with the server-side JAX-WS implementation.
 * In the case of a Java EE 5 server, this would simply be defined as a servlet
 * in web.xml, with the server detecting that this is a JAX-WS endpoint and reacting
 * accordingly. The servlet name usually needs to match the specified WS service name.
 *
 * The web service engine manages the lifecycle of instances of this class.
 * Spring bean references will just be wired in here.
 */</b>
<span class="hl-keyword">import</span> org.springframework.web.context.support.SpringBeanAutowiringSupport;

<i><span class="hl-annotation" style="color: gray">@WebService(serviceName=&quot;AccountService&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AccountServiceEndpoint <span class="hl-keyword">extends</span> SpringBeanAutowiringSupport {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> AccountService biz;

    <i><span class="hl-annotation" style="color: gray">@WebMethod</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> insertAccount(Account acc) {
        biz.insertAccount(acc);
    }

    <i><span class="hl-annotation" style="color: gray">@WebMethod</span></i>
    <span class="hl-keyword">public</span> Account[] getAccounts(String name) {
        <span class="hl-keyword">return</span> biz.getAccounts(name);
    }

}</pre> 
    <p>Our <code class="literal">AccountServletEndpoint</code> needs to run in the same web application as the Spring context to allow for access to Springs facilities. This is the case by default in Java EE 5 environments, using the standard contract for JAX-WS servlet endpoint deployment. See Java EE 5 web service tutorials for details.</p> 
   </div> 
   <div class="section" title="21.5.2&nbsp;Exporting standalone web services using JAX-WS">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="remoting-web-services-jaxws-export-standalone"></a>21.5.2&nbsp;Exporting standalone web services using JAX-WS</h3>
      </div>
     </div>
    </div> 
    <p>The built-in JAX-WS provider that comes with Oracles JDK 1.6 supports exposure of web services using the built-in HTTP server thats included in JDK 1.6 as well. Springs <code class="literal">SimpleJaxWsServiceExporter</code> detects all <code class="literal">@WebService</code> annotated beans in the Spring application context, exporting them through the default JAX-WS server (the JDK 1.6 HTTP server).</p> 
    <p>In this scenario, the endpoint instances are defined and managed as Spring beans themselves; they will be registered with the JAX-WS engine but their lifecycle will be up to the Spring application context. This means that Spring functionality like explicit dependency injection may be applied to the endpoint instances. Of course, annotation-driven injection through <code class="literal">@Autowired</code> will work as well.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.remoting.jaxws.SimpleJaxWsServiceExporter&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;baseAddress&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;http://localhost:8080/&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;accountServiceEndpoint&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.AccountServiceEndpoint&quot;</span><span class="hl-tag">&gt;</span>
    ...
<span class="hl-tag">&lt;/bean&gt;</span>

...</pre> 
    <p>The <code class="literal">AccountServiceEndpoint</code> may derive from Springs <code class="literal">SpringBeanAutowiringSupport</code> but doesnt have to since the endpoint is a fully Spring-managed bean here. This means that the endpoint implementation may look like as follows, without any superclass declared - and Springs <code class="literal">@Autowired</code> configuration annotation still being honored:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@WebService(serviceName=&quot;AccountService&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AccountServiceEndpoint {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> AccountService biz;

    <i><span class="hl-annotation" style="color: gray">@WebMethod</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> insertAccount(Account acc) {
        biz.insertAccount(acc);
    }

    <i><span class="hl-annotation" style="color: gray">@WebMethod</span></i>
    <span class="hl-keyword">public</span> List&lt;Account&gt; getAccounts(String name) {
        <span class="hl-keyword">return</span> biz.getAccounts(name);
    }

}</pre> 
   </div> 
   <div class="section" title="21.5.3&nbsp;Exporting web services using the JAX-WS RIs Spring support">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="remoting-web-services-jaxws-export-ri"></a>21.5.3&nbsp;Exporting web services using the JAX-WS RIs Spring support</h3>
      </div>
     </div>
    </div> 
    <p>Oracles JAX-WS RI, developed as part of the GlassFish project, ships Spring support as part of its JAX-WS Commons project. This allows for defining JAX-WS endpoints as Spring-managed beans, similar to the standalone mode discussed in the previous section - but this time in a Servlet environment. <span class="emphasis"><em>Note that this is not portable in a Java EE 5 environment; it is mainly intended for non-EE environments such as Tomcat, embedding the JAX-WS RI as part of the web application.</em></span></p> 
    <p>The difference to the standard style of exporting servlet-based endpoints is that the lifecycle of the endpoint instances themselves will be managed by Spring here, and that there will be only one JAX-WS servlet defined in <code class="literal">web.xml</code>. With the standard Java EE 5 style (as illustrated above), youll have one servlet definition per service endpoint, with each endpoint typically delegating to Spring beans (through the use of <code class="literal">@Autowired</code>, as shown above).</p> 
    <p>Check out <a class="ulink" href="https://jax-ws-commons.dev.java.net/spring/" target="_top">https://jax-ws-commons.dev.java.net/spring/</a> for the details on setup and usage style.</p> 
   </div> 
   <div class="section" title="21.5.4&nbsp;Accessing web services using JAX-WS">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="remoting-web-services-jaxws-access"></a>21.5.4&nbsp;Accessing web services using JAX-WS</h3>
      </div>
     </div>
    </div> 
    <p>Spring provides two factory beans to create JAX-WS web service proxies, namely <code class="literal">LocalJaxWsServiceFactoryBean</code> and <code class="literal">JaxWsPortProxyFactoryBean</code>. The former can only return a JAX-WS service class for us to work with. The latter is the full-fledged version that can return a proxy that implements our business service interface. In this example we use the latter to create a proxy for the <code class="literal">AccountService</code> endpoint (again):</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;accountWebService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.remoting.jaxws.JaxWsPortProxyFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceInterface&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;example.AccountService&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;wsdlDocumentUrl&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;http://localhost:8888/AccountServiceEndpoint?WSDL&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;namespaceUri&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;http://example/&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;AccountService&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;portName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;AccountServiceEndpointPort&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>Where <code class="literal">serviceInterface</code> is our business interface the clients will use. <code class="literal">wsdlDocumentUrl</code> is the URL for the WSDL file. Spring needs this a startup time to create the JAX-WS Service. <code class="literal">namespaceUri</code> corresponds to the targetNamespace in the .wsdl file. <code class="literal">serviceName</code> corresponds to the service name in the .wsdl file. <code class="literal">portName</code> corresponds to the port name in the .wsdl file.</p> 
    <p>Accessing the web service is now very easy as we have a bean factory for it that will expose it as <code class="literal">AccountService</code> interface. We can wire this up in Spring:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;client&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.AccountClientImpl&quot;</span><span class="hl-tag">&gt;</span>
    ...
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;service&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;accountWebService&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>From the client code we can access the web service just as if it was a normal class:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AccountClientImpl {

    <span class="hl-keyword">private</span> AccountService service;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setService(AccountService service) {
        <span class="hl-keyword">this</span>.service = service;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> foo() {
        service.insertAccount(...);
    }
}</pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>The above is slightly simplified in that JAX-WS requires endpoint interfaces and implementation classes to be annotated with <code class="literal">@WebService</code>, <code class="literal">@SOAPBinding</code> etc annotations. This means that you cannot (easily) use plain Java interfaces and implementation classes as JAX-WS endpoint artifacts; you need to annotate them accordingly first. Check the JAX-WS documentation for details on those requirements.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
  </div> 
  <div class="section" title="21.6&nbsp;JMS">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="remoting-jms"></a>21.6&nbsp;JMS</h2>
     </div>
    </div>
   </div> 
   <p>It is also possible to expose services transparently using JMS as the underlying communication protocol. The JMS remoting support in the Spring Framework is pretty basic - it sends and receives on the <code class="literal">same thread</code> and in the <span class="emphasis"><em>same non-transactional</em></span> <code class="literal">Session</code>, and as such throughput will be very implementation dependent. Note that these single-threaded and non-transactional constraints apply only to Springs JMS <span class="emphasis"><em>remoting</em></span> support. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#jms" title="23.&nbsp;JMS (Java Message Service)">Chapter&nbsp;23, <i>JMS (Java Message Service)</i></a> for information on Springs rich support for JMS-based <span class="emphasis"><em>messaging</em></span>.</p> 
   <p>The following interface is used on both the server and the client side.</p> 
   <pre class="programlisting"><span class="hl-keyword">package</span> com.foo;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> CheckingAccountService {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> cancelAccount(Long accountId);

}</pre> 
   <p>The following simple implementation of the above interface is used on the server-side.</p> 
   <pre class="programlisting"><span class="hl-keyword">package</span> com.foo;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleCheckingAccountService <span class="hl-keyword">implements</span> CheckingAccountService {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> cancelAccount(Long accountId) {
        System.out.println(<span class="hl-string">&quot;Cancelling account [&quot;</span> + accountId + <span class="hl-string">&quot;]&quot;</span>);
    }

}</pre> 
   <p>This configuration file contains the JMS-infrastructure beans that are shared on both the client and server.</p> 
   <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;connectionFactory&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.apache.activemq.ActiveMQConnectionFactory&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;brokerURL&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;tcp://ep-t43:61616&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;queue&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.apache.activemq.command.ActiveMQQueue&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;mmm&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
   <div class="section" title="21.6.1&nbsp;Server-side configuration">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="remoting-jms-server"></a>21.6.1&nbsp;Server-side configuration</h3>
      </div>
     </div>
    </div> 
    <p>On the server, you just need to expose the service object using the <code class="literal">JmsInvokerServiceExporter</code>.</p> 
    <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;checkingAccountService&quot;</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jms.remoting.JmsInvokerServiceExporter&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceInterface&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;com.foo.CheckingAccountService&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;service&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.SimpleCheckingAccountService&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jms.listener.SimpleMessageListenerContainer&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;connectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;destination&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;queue&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;concurrentConsumers&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;3&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;messageListener&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;checkingAccountService&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <pre class="programlisting"><span class="hl-keyword">package</span> com.foo;

<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Server {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) <span class="hl-keyword">throws</span> Exception {
        <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-keyword">new</span> String[]{<span class="hl-string">&quot;com/foo/server.xml&quot;</span>, <span class="hl-string">&quot;com/foo/jms.xml&quot;</span>});
    }

}</pre> 
   </div> 
   <div class="section" title="21.6.2&nbsp;Client-side configuration">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="remoting-jms-client"></a>21.6.2&nbsp;Client-side configuration</h3>
      </div>
     </div>
    </div> 
    <p>The client merely needs to create a client-side proxy that will implement the agreed upon interface ( <code class="literal">CheckingAccountService</code>). The resulting object created off the back of the following bean definition can be injected into other client side objects, and the proxy will take care of forwarding the call to the server-side object via JMS.</p> 
    <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;checkingAccountService&quot;</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jms.remoting.JmsInvokerProxyFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceInterface&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;com.foo.CheckingAccountService&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;connectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;queue&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;queue&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <pre class="programlisting"><span class="hl-keyword">package</span> com.foo;

<span class="hl-keyword">import</span> org.springframework.context.ApplicationContext;
<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Client {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) <span class="hl-keyword">throws</span> Exception {
        ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(
                <span class="hl-keyword">new</span> String[] {<span class="hl-string">&quot;com/foo/client.xml&quot;</span>, <span class="hl-string">&quot;com/foo/jms.xml&quot;</span>});
        CheckingAccountService service = (CheckingAccountService) ctx.getBean(<span class="hl-string">&quot;checkingAccountService&quot;</span>);
        service.cancelAccount(<span class="hl-keyword">new</span> Long(<span class="hl-number">10</span>));
    }

}</pre> 
    <p>You may also wish to investigate the support provided by the <a class="ulink" href="http://lingo.codehaus.org/" target="_top">Lingo</a> project, which (to quote the homepage blurb) &quot;<span class="emphasis"><em> is a lightweight POJO based remoting and messaging library based on the Spring Frameworks remoting libraries which extends it to support JMS.</em></span>&quot;</p> 
   </div> 
  </div> 
  <div class="section" title="21.7&nbsp;AMQP">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="remoting-amqp"></a>21.7&nbsp;AMQP</h2>
     </div>
    </div>
   </div> 
   <p>Refer to the <a class="ulink" href="http://docs.spring.io/spring-amqp/reference/html/amqp.html#remoting" target="_top">Spring AMQP Reference Document <span class="emphasis"><em>Spring Remoting with AMQP</em></span> section</a> for more information.</p> 
  </div> 
  <div class="section" title="21.8&nbsp;Auto-detection is not implemented for remote interfaces">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="remoting-autodection-remote-interfaces"></a>21.8&nbsp;Auto-detection is not implemented for remote interfaces</h2>
     </div>
    </div>
   </div> 
   <p>The main reason why auto-detection of implemented interfaces does not occur for remote interfaces is to avoid opening too many doors to remote callers. The target object might implement internal callback interfaces like <code class="literal">InitializingBean</code> or <code class="literal">DisposableBean</code> which one would not want to expose to callers.</p> 
   <p>Offering a proxy with all interfaces implemented by the target usually does not matter in the local case. But when exporting a remote service, you should expose a specific service interface, with specific operations intended for remote usage. Besides internal callback interfaces, the target might implement multiple business interfaces, with just one of them intended for remote exposure. For these reasons, we <span class="emphasis"><em>require</em></span> such a service interface to be specified.</p> 
   <p>This is a trade-off between configuration convenience and the risk of accidental exposure of internal methods. Always specifying a service interface is not too much effort, and puts you on the safe side regarding controlled exposure of specific methods.</p> 
  </div> 
  <div class="section" title="21.9&nbsp;Considerations when choosing a technology">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="remoting-considerations"></a>21.9&nbsp;Considerations when choosing a technology</h2>
     </div>
    </div>
   </div> 
   <p>Each and every technology presented here has its drawbacks. You should carefully consider your needs, the services you are exposing and the objects youll be sending over the wire when choosing a technology.</p> 
   <p>When using RMI, its not possible to access the objects through the HTTP protocol, unless youre tunneling the RMI traffic. RMI is a fairly heavy-weight protocol in that it supports full-object serialization which is important when using a complex data model that needs serialization over the wire. However, RMI-JRMP is tied to Java clients: It is a Java-to-Java remoting solution.</p> 
   <p>Springs HTTP invoker is a good choice if you need HTTP-based remoting but also rely on Java serialization. It shares the basic infrastructure with RMI invokers, just using HTTP as transport. Note that HTTP invokers are not only limited to Java-to-Java remoting but also to Spring on both the client and server side. (The latter also applies to Springs RMI invoker for non-RMI interfaces.)</p> 
   <p>Hessian and/or Burlap might provide significant value when operating in a heterogeneous environment, because they explicitly allow for non-Java clients. However, non-Java support is still limited. Known issues include the serialization of Hibernate objects in combination with lazily-initialized collections. If you have such a data model, consider using RMI or HTTP invokers instead of Hessian.</p> 
   <p>JMS can be useful for providing clusters of services and allowing the JMS broker to take care of load balancing, discovery and auto-failover. By default: Java serialization is used when using JMS remoting but the JMS provider could use a different mechanism for the wire formatting, such as XStream to allow servers to be implemented in other technologies.</p> 
   <p>Last but not least, EJB has an advantage over RMI in that it supports standard role-based authentication and authorization and remote transaction propagation. It is possible to get RMI invokers or HTTP invokers to support security context propagation as well, although this is not provided by core Spring: There are just appropriate hooks for plugging in third-party or custom solutions here.</p> 
  </div> 
  <div class="section" title="21.10&nbsp;Accessing RESTful services on the Client">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="rest-client-access"></a>21.10&nbsp;Accessing RESTful services on the Client</h2>
     </div>
    </div>
   </div> 
   <p>The <code class="literal">RestTemplate</code> is the core class for client-side access to RESTful services. It is conceptually similar to other template classes in Spring, such as <code class="literal">JdbcTemplate</code> and <code class="literal">JmsTemplate</code> and other template classes found in other Spring portfolio projects. <code class="literal">RestTemplate</code>'s behavior is customized by providing callback methods and configuring the <code class="literal">HttpMessageConverter</code> used to marshal objects into the HTTP request body and to unmarshal any response back into an object. As it is common to use XML as a message format, Spring provides a <code class="literal">MarshallingHttpMessageConverter</code> that uses the Object-to-XML framework that is part of the <code class="literal">org.springframework.oxm</code> package. This gives you a wide range of choices of XML to Object mapping technologies to choose from.</p> 
   <p>This section describes how to use the <code class="literal">RestTemplate</code> and its associated <code class="literal">HttpMessageConverters</code>.</p> 
   <div class="section" title="21.10.1&nbsp;RestTemplate">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="rest-resttemplate"></a>21.10.1&nbsp;RestTemplate</h3>
      </div>
     </div>
    </div> 
    <p>Invoking RESTful services in Java is typically done using a helper class such as Apache HttpComponents <code class="literal">HttpClient</code>. For common REST operations this approach is too low level as shown below.</p> 
    <pre class="programlisting">String uri = <span class="hl-string">&quot;http://example.com/hotels/1/bookings&quot;</span>;

PostMethod post = <span class="hl-keyword">new</span> PostMethod(uri);
String request = <span class="hl-comment">// create booking request content</span>
post.setRequestEntity(<span class="hl-keyword">new</span> StringRequestEntity(request));

httpClient.executeMethod(post);

<span class="hl-keyword">if</span> (HttpStatus.SC_CREATED == post.getStatusCode()) {
    Header location = post.getRequestHeader(<span class="hl-string">&quot;Location&quot;</span>);
    <span class="hl-keyword">if</span> (location != null) {
        System.out.println(<span class="hl-string">&quot;Created new booking at :&quot;</span> + location.getValue());
    }
}</pre> 
    <p>RestTemplate provides higher level methods that correspond to each of the six main HTTP methods that make invoking many RESTful services a one-liner and enforce REST best practices.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>RestTemplate has an asynchronous counter-part: see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#rest-async-resttemplate" title="21.10.3&nbsp;Async RestTemplate">Section&nbsp;21.10.3, Async RestTemplate</a>.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <div class="table">
     <a name="rest-overview-of-resttemplate-methods-tbl"></a>
     <p class="title"><b>Table&nbsp;21.1.&nbsp;Overview of RestTemplate methods</b></p>
     <div class="table-contents"> 
      <table summary="Overview of RestTemplate methods" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
       <colgroup>
        <col />
        <col />
       </colgroup>
       <thead>
        <tr>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">HTTP Method</th>
         <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">RestTemplate Method</th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>DELETE</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html#delete(String,%20Object%E2%80%A6)" target="_top">delete</a></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>GET</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html#getForObject(String,%20Class,%20Object%E2%80%A6)" target="_top">getForObject</a> <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html#getForEntity(String,%20Class,%20Object%E2%80%A6)" target="_top">getForEntity</a></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>HEAD</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html#headForHeaders(String,%20Object%E2%80%A6)" target="_top">headForHeaders(String url, String urlVariables)</a></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>OPTIONS</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html#optionsForAllow(String,%20Object%E2%80%A6)" target="_top">optionsForAllow(String url, String urlVariables)</a></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>POST</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html#postForLocation(String,%20Object,%20Object%E2%80%A6)" target="_top">postForLocation(String url, Object request, String urlVariables)</a> <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html#postForObject(java.lang.String,%20java.lang.Object,%20java.lang.Class,%20java.lang.String%E2%80%A6)" target="_top">postForObject(String url, Object request, Class&lt;T&gt; responseType, String uriVariables)</a></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>PUT</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html#put(String,%20Object,%20Object%E2%80%A6)" target="_top">put(String url, Object request, StringurlVariables)</a></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>PATCH and others</p></td>
         <td style="" align="left" valign="top"><p><a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html#exchange(java.lang.String,%20org.springframework.http.HttpMethod,%20org.springframework.http.HttpEntity,%20java.lang.Class,%20java.lang.Object%E2%80%A6)" target="_top">exchange</a> <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/RestTemplate.html#execute(java.lang.String,%20org.springframework.http.HttpMethod,%20org.springframework.web.client.RequestCallback,%20org.springframework.web.client.ResponseExtractor,%20java.lang.Object%E2%80%A6)" target="_top">execute</a></p></td>
        </tr>
       </tbody>
      </table> 
     </div>
    </div>
    <br class="table-break" /> 
    <p>The names of <code class="literal">RestTemplate</code> methods follow a naming convention, the first part indicates what HTTP method is being invoked and the second part indicates what is returned. For example, the method <code class="literal">getForObject()</code> will perform a GET, convert the HTTP response into an object type of your choice and return that object. The method <code class="literal">postForLocation()</code> will do a POST, converting the given object into a HTTP request and return the response HTTP Location header where the newly created object can be found. In case of an exception processing the HTTP request, an exception of the type <code class="literal">RestClientException</code> will be thrown; this behavior can be changed by plugging in another <code class="literal">ResponseErrorHandler</code> implementation into the <code class="literal">RestTemplate</code>.</p> 
    <p>The <code class="literal">exchange</code> and <code class="literal">execute</code> methods are generalized versions of the more specific methods listed above them and can support additional combinations and methods, like HTTP PATCH. However, note that the underlying HTTP library must also support the desired combination. The JDK <code class="literal">HttpURLConnection</code> does not support the <code class="literal">PATCH</code> method, but Apache HttpComponents HttpClient version 4.2 or later does. They also enable <code class="literal">RestTemplate</code> to read an HTTP response to a generic type (e.g. <code class="literal">List&lt;Account&gt;</code>), using a <code class="literal">ParameterizedTypeReference</code>, a new class that enables capturing and passing generic type info.</p> 
    <p>Objects passed to and returned from these methods are converted to and from HTTP messages by <code class="literal">HttpMessageConverter</code> instances. Converters for the main mime types are registered by default, but you can also write your own converter and register it via the <code class="literal">messageConverters()</code> bean property. The default converter instances registered with the template are <code class="literal">ByteArrayHttpMessageConverter</code>, <code class="literal">StringHttpMessageConverter</code>, <code class="literal">FormHttpMessageConverter</code> and <code class="literal">SourceHttpMessageConverter</code>. You can override these defaults using the <code class="literal">messageConverters()</code> bean property as would be required if using the <code class="literal">MarshallingHttpMessageConverter</code> or <code class="literal">MappingJackson2HttpMessageConverter</code>.</p> 
    <p>Each method takes URI template arguments in two forms, either as a <code class="literal">String</code> variable length argument or a <code class="literal">Map&lt;String,String&gt;</code>. For example,</p> 
    <pre class="programlisting">String result = restTemplate.getForObject(
        <span class="hl-string">&quot;http://example.com/hotels/{hotel}/bookings/{booking}&quot;</span>, String.<span class="hl-keyword">class</span>,<span class="hl-string">&quot;42&quot;</span>, <span class="hl-string">&quot;21&quot;</span>);</pre> 
    <p>using variable length arguments and</p> 
    <pre class="programlisting">Map&lt;String, String&gt; vars = Collections.singletonMap(<span class="hl-string">&quot;hotel&quot;</span>, <span class="hl-string">&quot;42&quot;</span>);
String result = restTemplate.getForObject(
        <span class="hl-string">&quot;http://example.com/hotels/{hotel}/rooms/{hotel}&quot;</span>, String.<span class="hl-keyword">class</span>, vars);</pre> 
    <p>using a <code class="literal">Map&lt;String,String&gt;</code>.</p> 
    <p>To create an instance of <code class="literal">RestTemplate</code> you can simply call the default no-arg constructor. This will use standard Java classes from the <code class="literal">java.net</code> package as the underlying implementation to create HTTP requests. This can be overridden by specifying an implementation of <code class="literal">ClientHttpRequestFactory</code>. Spring provides the implementation <code class="literal">HttpComponentsClientHttpRequestFactory</code> that uses the Apache HttpComponents <code class="literal">HttpClient</code> to create requests. <code class="literal">HttpComponentsClientHttpRequestFactory</code> is configured using an instance of <code class="literal">org.apache.http.client.HttpClient</code> which can in turn be configured with credentials information or connection pooling functionality.</p> 
    <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Tip">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
        <th align="left">Tip</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Note that the <code class="literal">java.net</code> implementation for HTTP requests may raise an exception when accessing the status of a response that represents an error (e.g. 401). If this is an issue, switch to <code class="literal">HttpComponentsClientHttpRequestFactory</code> instead.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>The previous example using Apache HttpComponents <code class="literal">HttpClient</code> directly rewritten to use the <code class="literal">RestTemplate</code> is shown below</p> 
    <pre class="programlisting">uri = <span class="hl-string">&quot;http://example.com/hotels/{id}/bookings&quot;</span>;

RestTemplate template = <span class="hl-keyword">new</span> RestTemplate();

Booking booking = <span class="hl-comment">// create booking object</span>

URI location = template.postForLocation(uri, booking, <span class="hl-string">&quot;1&quot;</span>);</pre> 
    <p>To use Apache HttpComponents instead of the native <code class="literal">java.net</code> functionality, construct the <code class="literal">RestTemplate</code> as follows:</p> 
    <pre class="programlisting">RestTemplate template = <span class="hl-keyword">new</span> RestTemplate(<span class="hl-keyword">new</span> HttpComponentsClientHttpRequestFactory());</pre> 
    <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Tip">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
        <th align="left">Tip</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Apache HttpClient supports gzip encoding via the <code class="literal">DecompressingHttpClient</code>. To use it, construct a <code class="literal">HttpComponentsClientHttpRequestFactory</code> like so:</p> <pre class="programlisting">HttpClient httpClient = <span class="hl-keyword">new</span> DecompressingHttpClient(<span class="hl-keyword">new</span> DefaultHttpClient());
ClientHttpRequestFactory requestFactory = <span class="hl-keyword">new</span> HttpComponentsClientHttpRequestFactory(httpClient);
RestTemplate template = <span class="hl-keyword">new</span> RestTemplate(requestFactory);</pre> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>The general callback interface is <code class="literal">RequestCallback</code> and is called when the execute method is invoked.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> &lt;T&gt; T execute(String url, HttpMethod method, RequestCallback requestCallback,
        ResponseExtractor&lt;T&gt; responseExtractor, String... urlVariables)

<span class="hl-comment">// also has an overload with urlVariables as a Map&lt;String, String&gt;.</span></pre> 
    <p>The <code class="literal">RequestCallback</code> interface is defined as</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> RequestCallback {
 <span class="hl-keyword">void</span> doWithRequest(ClientHttpRequest request) <span class="hl-keyword">throws</span> IOException;
}</pre> 
    <p>and allows you to manipulate the request headers and write to the request body. When using the execute method you do not have to worry about any resource management, the template will always close the request and handle any errors. Refer to the API documentation for more information on using the execute method and the meaning of its other method arguments.</p> 
    <div class="section" title="Working with the URI">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="rest-resttemplate-uri"></a>Working with the URI</h4>
       </div>
      </div>
     </div> 
     <p>For each of the main HTTP methods, the <code class="literal">RestTemplate</code> provides variants that either take a String URI or <code class="literal">java.net.URI</code> as the first argument.</p> 
     <p>The String URI variants accept template arguments as a String variable length argument or as a <code class="literal">Map&lt;String,String&gt;</code>. They also assume the URL String is not encoded and needs to be encoded. For example the following:</p> 
     <pre class="programlisting">restTemplate.getForObject(<span class="hl-string">&quot;http://example.com/hotel list&quot;</span>, String.<span class="hl-keyword">class</span>);</pre> 
     <p>will perform a GET on <code class="literal"><span><a class="smarterwiki-linkify" href="http://example.com/hotel%20list">http://example.com/hotel%20list</a></span></code>. That means if the input URL String is already encoded, it will be encoded twice&#x2009;&#x2009;i.e. <code class="literal"><span><a class="smarterwiki-linkify" href="http://example.com/hotel%20list">http://example.com/hotel%20list</a></span></code> will become <code class="literal"><span><a class="smarterwiki-linkify" href="http://example.com/hotel%2520list">http://example.com/hotel%2520list</a></span></code>. If this is not the intended effect, use the <code class="literal">java.net.URI</code> method variant, which assumes the URL is already encoded is also generally useful if you want to reuse a single (fully expanded) <code class="literal">URI</code> multiple times.</p> 
     <p>The <code class="literal">UriComponentsBuilder</code> class can be used to build and encode the <code class="literal">URI</code> including support for URI templates. For example you can start with a URL String:</p> 
     <pre class="programlisting">UriComponents uriComponents = UriComponentsBuilder.fromUriString(
        <span class="hl-string">&quot;http://example.com/hotels/{hotel}/bookings/{booking}&quot;</span>).build()
        .expand(<span class="hl-string">&quot;42&quot;</span>, <span class="hl-string">&quot;21&quot;</span>)
        .encode();

URI uri = uriComponents.toUri();</pre> 
     <p>Or specify each URI component individually:</p> 
     <pre class="programlisting">UriComponents uriComponents = UriComponentsBuilder.newInstance()
        .scheme(<span class="hl-string">&quot;http&quot;</span>).host(<span class="hl-string">&quot;example.com&quot;</span>).path(<span class="hl-string">&quot;/hotels/{hotel}/bookings/{booking}&quot;</span>).build()
        .expand(<span class="hl-string">&quot;42&quot;</span>, <span class="hl-string">&quot;21&quot;</span>)
        .encode();

URI uri = uriComponents.toUri();</pre> 
    </div> 
    <div class="section" title="Dealing with request and response headers">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="rest-template-headers"></a>Dealing with request and response headers</h4>
       </div>
      </div>
     </div> 
     <p>Besides the methods described above, the <code class="literal">RestTemplate</code> also has the <code class="literal">exchange()</code> method, which can be used for arbitrary HTTP method execution based on the <code class="literal">HttpEntity</code> class.</p> 
     <p>Perhaps most importantly, the <code class="literal">exchange()</code> method can be used to add request headers and read response headers. For example:</p> 
     <pre class="programlisting">HttpHeaders requestHeaders = <span class="hl-keyword">new</span> HttpHeaders();
requestHeaders.set(<span class="hl-string">&quot;MyRequestHeader&quot;</span>, <span class="hl-string">&quot;MyValue&quot;</span>);
HttpEntity&lt;?&gt; requestEntity = <span class="hl-keyword">new</span> HttpEntity(requestHeaders);

HttpEntity&lt;String&gt; response = template.exchange(
        <span class="hl-string">&quot;http://example.com/hotels/{hotel}&quot;</span>,
        HttpMethod.GET, requestEntity, String.<span class="hl-keyword">class</span>, <span class="hl-string">&quot;42&quot;</span>);

String responseHeader = response.getHeaders().getFirst(<span class="hl-string">&quot;MyResponseHeader&quot;</span>);
String body = response.getBody();</pre> 
     <p>In the above example, we first prepare a request entity that contains the <code class="literal">MyRequestHeader</code> header. We then retrieve the response, and read the <code class="literal">MyResponseHeader</code> and body.</p> 
    </div> 
   </div> 
   <div class="section" title="21.10.2&nbsp;HTTP Message Conversion">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="rest-message-conversion"></a>21.10.2&nbsp;HTTP Message Conversion</h3>
      </div>
     </div>
    </div> 
    <p>Objects passed to and returned from the methods <code class="literal">getForObject()</code>, <code class="literal">postForLocation()</code>, and <code class="literal">put()</code> are converted to HTTP requests and from HTTP responses by <code class="literal">HttpMessageConverters</code>. The <code class="literal">HttpMessageConverter</code> interface is shown below to give you a better feel for its functionality</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> HttpMessageConverter&lt;T&gt; {

    <span class="hl-comment">// Indicate whether the given class and media type can be read by this converter.</span>
    <span class="hl-keyword">boolean</span> canRead(Class&lt;?&gt; clazz, MediaType mediaType);

    <span class="hl-comment">// Indicate whether the given class and media type can be written by this converter.</span>
    <span class="hl-keyword">boolean</span> canWrite(Class&lt;?&gt; clazz, MediaType mediaType);

    <span class="hl-comment">// Return the list of MediaType objects supported by this converter.</span>
    List&lt;MediaType&gt; getSupportedMediaTypes();

    <span class="hl-comment">// Read an object of the given type from the given input message, and returns it.</span>
    T read(Class&lt;T&gt; clazz, HttpInputMessage inputMessage) <span class="hl-keyword">throws</span> IOException, HttpMessageNotReadableException;

    <span class="hl-comment">// Write an given object to the given output message.</span>
    <span class="hl-keyword">void</span> write(T t, HttpOutputMessage outputMessage) <span class="hl-keyword">throws</span> IOException, HttpMessageNotWritableException;

}</pre> 
    <p>Concrete implementations for the main media (mime) types are provided in the framework and are registered by default with the <code class="literal">RestTemplate</code> on the client-side and with <code class="literal">AnnotationMethodHandlerAdapter</code> on the server-side.</p> 
    <p>The implementations of <code class="literal">HttpMessageConverter</code> s are described in the following sections. For all converters a default media type is used but can be overridden by setting the <code class="literal">supportedMediaTypes</code> bean property</p> 
    <div class="section" title="StringHttpMessageConverter">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="rest-string-converter"></a>StringHttpMessageConverter</h4>
       </div>
      </div>
     </div> 
     <p>An <code class="literal">HttpMessageConverter</code> implementation that can read and write Strings from the HTTP request and response. By default, this converter supports all text media types ( <code class="literal">text/*</code>), and writes with a <code class="literal">Content-Type</code> of <code class="literal">text/plain</code>.</p> 
    </div> 
    <div class="section" title="FormHttpMessageConverter">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="rest-form-converter"></a>FormHttpMessageConverter</h4>
       </div>
      </div>
     </div> 
     <p>An <code class="literal">HttpMessageConverter</code> implementation that can read and write form data from the HTTP request and response. By default, this converter reads and writes the media type <code class="literal">application/x-www-form-urlencoded</code>. Form data is read from and written into a <code class="literal">MultiValueMap&lt;String, String&gt;</code>.</p> 
    </div> 
    <div class="section" title="ByteArrayHttpMessageConverter">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="rest-byte-converter"></a>ByteArrayHttpMessageConverter</h4>
       </div>
      </div>
     </div> 
     <p>An <code class="literal">HttpMessageConverter</code> implementation that can read and write byte arrays from the HTTP request and response. By default, this converter supports all media types ( <code class="literal">*/*</code>), and writes with a <code class="literal">Content-Type</code> of <code class="literal">application/octet-stream</code>. This can be overridden by setting the <code class="literal">supportedMediaTypes</code> property, and overriding <code class="literal">getContentType(byte[])</code>.</p> 
    </div> 
    <div class="section" title="MarshallingHttpMessageConverter">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="rest-marhsalling-converter"></a>MarshallingHttpMessageConverter</h4>
       </div>
      </div>
     </div> 
     <p>An <code class="literal">HttpMessageConverter</code> implementation that can read and write XML using Springs <code class="literal">Marshaller</code> and <code class="literal">Unmarshaller</code> abstractions from the <code class="literal">org.springframework.oxm</code> package. This converter requires a <code class="literal">Marshaller</code> and <code class="literal">Unmarshaller</code> before it can be used. These can be injected via constructor or bean properties. By default this converter supports ( <code class="literal">text/xml</code>) and ( <code class="literal">application/xml</code>).</p> 
    </div> 
    <div class="section" title="MappingJackson2HttpMessageConverter (or MappingJacksonHttpMessageConverter with Jackson 1.x)">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="rest-mapping-json-converter"></a>MappingJackson2HttpMessageConverter (or MappingJacksonHttpMessageConverter with Jackson 1.x)</h4>
       </div>
      </div>
     </div> 
     <p>An <code class="literal">HttpMessageConverter</code> implementation that can read and write JSON using Jacksons <code class="literal">ObjectMapper</code>. JSON mapping can be customized as needed through the use of Jacksons provided annotations. When further control is needed, a custom <code class="literal">ObjectMapper</code> can be injected through the <code class="literal">ObjectMapper</code> property for cases where custom JSON serializers/deserializers need to be provided for specific types. By default this converter supports ( <code class="literal">application/json</code>).</p> 
    </div> 
    <div class="section" title="SourceHttpMessageConverter">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="rest-source-converter"></a>SourceHttpMessageConverter</h4>
       </div>
      </div>
     </div> 
     <p>An <code class="literal">HttpMessageConverter</code> implementation that can read and write <code class="literal">javax.xml.transform.Source</code> from the HTTP request and response. Only <code class="literal">DOMSource</code>, <code class="literal">SAXSource</code>, and <code class="literal">StreamSource</code> are supported. By default, this converter supports ( <code class="literal">text/xml</code>) and ( <code class="literal">application/xml</code>).</p> 
    </div> 
    <div class="section" title="BufferedImageHttpMessageConverter">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="rest-buffered-image-converter"></a>BufferedImageHttpMessageConverter</h4>
       </div>
      </div>
     </div> 
     <p>An <code class="literal">HttpMessageConverter</code> implementation that can read and write <code class="literal">java.awt.image.BufferedImage</code> from the HTTP request and response. This converter reads and writes the media type supported by the Java I/O API.</p> 
    </div> 
   </div> 
   <div class="section" title="21.10.3&nbsp;Async RestTemplate">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="rest-async-resttemplate"></a>21.10.3&nbsp;Async RestTemplate</h3>
      </div>
     </div>
    </div> 
    <p>Web applications often need to query external REST services those days. The very nature of HTTP and synchronous calls can lead up to challenges when scaling applications for those needs: multiple threads may be blocked, waiting for remote HTTP responses.</p> 
    <p><code class="literal">AsyncRestTemplate</code> and <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#rest-resttemplate" title="21.10.1&nbsp;RestTemplate">Section&nbsp;21.10.1, RestTemplate</a>'s APIs are very similar; see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#rest-overview-of-resttemplate-methods-tbl" title="Table&nbsp;21.1.&nbsp;Overview of RestTemplate methods">Table&nbsp;21.1, Overview of RestTemplate methods</a>. The main difference between those APIs is that <code class="literal">AsyncRestTemplate</code> returns <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/util/concurrent/ListenableFuture.html" target="_top"><code class="literal">ListenableFuture</code></a> wrappers as opposed to concrete results.</p> 
    <p>The previous <code class="literal">RestTemplate</code> example translates to:</p> 
    <pre class="programlisting"><span class="hl-comment">// async call</span>
Future&lt;ResponseEntity&lt;String&gt;&gt; futureEntity = template.getForEntity(
    <span class="hl-string">&quot;http://example.com/hotels/{hotel}/bookings/{booking}&quot;</span>, String.<span class="hl-keyword">class</span>, <span class="hl-string">&quot;42&quot;</span>, <span class="hl-string">&quot;21&quot;</span>);

<span class="hl-comment">// get the concrete result - synchronous call</span>
ResponseEntity&lt;String&gt; entity = futureEntity.get();</pre> 
    <p><a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/util/concurrent/ListenableFuture.html" target="_top"><code class="literal">ListenableFuture</code></a> accepts completion callbacks:</p> 
    <pre class="programlisting">ListenableFuture&lt;ResponseEntity&lt;String&gt;&gt; futureEntity = template.getForEntity(
    <span class="hl-string">&quot;http://example.com/hotels/{hotel}/bookings/{booking}&quot;</span>, String.<span class="hl-keyword">class</span>, <span class="hl-string">&quot;42&quot;</span>, <span class="hl-string">&quot;21&quot;</span>);

<span class="hl-comment">// register a callback</span>
futureEntity.addCallback(<span class="hl-keyword">new</span> ListenableFutureCallback&lt;ResponseEntity&lt;String&gt;&gt;() {
    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> onSuccess(ResponseEntity&lt;String&gt; entity) {
        <span class="hl-comment">//...</span>
    }

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> onFailure(Throwable t) {
        <span class="hl-comment">//...</span>
    }
});</pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>The default <code class="literal">AsyncRestTemplate</code> constructor registers a <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/core/task/SimpleAsyncTaskExecutor.html" target="_top"><code class="literal">SimpleAsyncTaskExecutor</code> </a> for executing HTTP requests. When dealing with a large number of short-lived requests, a thread-pooling TaskExecutor implementation like <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/scheduling/concurrent/ThreadPoolTaskExecutor.html" target="_top"><code class="literal">ThreadPoolTaskExecutor</code></a> may be a good choice.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>See <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/util/concurrent/ListenableFuture.html" target="_top"><code class="literal">ListenableFuture</code> Javadoc</a> and <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/web/client/AsyncRestTemplate.html" target="_top"><code class="literal">AsyncRestTemplate</code> Javadoc</a> for more details.</p> 
   </div> 
  </div> 
 </div> 
 <div class="chapter" title="22.&nbsp;Enterprise JavaBeans (EJB) integration">
  <div class="titlepage">
   <div>
    <div>
     <h2 class="title"><a name="ejb"></a>22.&nbsp;Enterprise JavaBeans (EJB) integration</h2>
    </div>
   </div>
  </div> 
  <div class="section" title="22.1&nbsp;Introduction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="ejb-introduction"></a>22.1&nbsp;Introduction</h2>
     </div>
    </div>
   </div> 
   <p>As a lightweight container, Spring is often considered an EJB replacement. We do believe that for many if not most applications and use cases, Spring as a container, combined with its rich supporting functionality in the area of transactions, ORM and JDBC access, is a better choice than implementing equivalent functionality via an EJB container and EJBs.</p> 
   <p>However, it is important to note that using Spring does not prevent you from using EJBs. In fact, Spring makes it much easier to access EJBs and implement EJBs and functionality within them. Additionally, using Spring to access services provided by EJBs allows the implementation of those services to later transparently be switched between local EJB, remote EJB, or POJO (plain old Java object) variants, without the client code having to be changed.</p> 
   <p>In this chapter, we look at how Spring can help you access and implement EJBs. Spring provides particular value when accessing stateless session beans (SLSBs), so well begin by discussing this.</p> 
  </div> 
  <div class="section" title="22.2&nbsp;Accessing EJBs">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="ejb-access"></a>22.2&nbsp;Accessing EJBs</h2>
     </div>
    </div>
   </div> 
   <div class="section" title="22.2.1&nbsp;Concepts">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="ejb-access-concepts"></a>22.2.1&nbsp;Concepts</h3>
      </div>
     </div>
    </div> 
    <p>To invoke a method on a local or remote stateless session bean, client code must normally perform a JNDI lookup to obtain the (local or remote) EJB Home object, then use a <span class="emphasis"><em>create</em></span> method call on that object to obtain the actual (local or remote) EJB object. One or more methods are then invoked on the EJB.</p> 
    <p>To avoid repeated low-level code, many EJB applications use the Service Locator and Business Delegate patterns. These are better than spraying JNDI lookups throughout client code, but their usual implementations have significant disadvantages. For example:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> Typically code using EJBs depends on Service Locator or Business Delegate singletons, making it hard to test. </li>
      <li class="listitem"> In the case of the Service Locator pattern used without a Business Delegate, application code still ends up having to invoke the create() method on an EJB home, and deal with the resulting exceptions. Thus it remains tied to the EJB API and the complexity of the EJB programming model. </li>
      <li class="listitem"> Implementing the Business Delegate pattern typically results in significant code duplication, where we have to write numerous methods that simply call the same method on the EJB. </li>
     </ul>
    </div> 
    <p>The Spring approach is to allow the creation and use of proxy objects, normally configured inside a Spring container, which act as codeless business delegates. You do not need to write another Service Locator, another JNDI lookup, or duplicate methods in a hand-coded Business Delegate unless you are actually adding real value in such code.</p> 
   </div> 
   <div class="section" title="22.2.2&nbsp;Accessing local SLSBs">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="ejb-access-local"></a>22.2.2&nbsp;Accessing local SLSBs</h3>
      </div>
     </div>
    </div> 
    <p>Assume that we have a web controller that needs to use a local EJB. Well follow best practice and use the EJB Business Methods Interface pattern, so that the EJBs local interface extends a non EJB-specific business methods interface. Lets call this business methods interface <code class="literal">MyComponent</code>.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> MyComponent {
    ...
}</pre> 
    <p>One of the main reasons to use the Business Methods Interface pattern is to ensure that synchronization between method signatures in local interface and bean implementation class is automatic. Another reason is that it later makes it much easier for us to switch to a POJO (plain old Java object) implementation of the service if it makes sense to do so. Of course well also need to implement the local home interface and provide an implementation class that implements <code class="literal">SessionBean</code> and the <code class="literal">MyComponent</code> business methods interface. Now the only Java coding well need to do to hook up our web tier controller to the EJB implementation is to expose a setter method of type <code class="literal">MyComponent</code> on the controller. This will save the reference as an instance variable in the controller:</p> 
    <pre class="programlisting"><span class="hl-keyword">private</span> MyComponent myComponent;

<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMyComponent(MyComponent myComponent) {
    <span class="hl-keyword">this</span>.myComponent = myComponent;
}</pre> 
    <p>We can subsequently use this instance variable in any business method in the controller. Now assuming we are obtaining our controller object out of a Spring container, we can (in the same context) configure a <code class="literal">LocalStatelessSessionProxyFactoryBean</code> instance, which will be the EJB proxy object. The configuration of the proxy, and setting of the <code class="literal">myComponent</code> property of the controller is done with a configuration entry such as:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myComponent&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.ejb.access.LocalStatelessSessionProxyFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;jndiName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;ejb/myBean&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;businessInterface&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;com.mycom.MyComponent&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myController&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.mycom.myController&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;myComponent&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;myComponent&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>Theres a lot of work happening behind the scenes, courtesy of the Spring AOP framework, although you arent forced to work with AOP concepts to enjoy the results. The <code class="literal">myComponent</code> bean definition creates a proxy for the EJB, which implements the business method interface. The EJB local home is cached on startup, so theres only a single JNDI lookup. Each time the EJB is invoked, the proxy invokes the <code class="literal">classname</code> method on the local EJB and invokes the corresponding business method on the EJB.</p> 
    <p>The <code class="literal">myController</code> bean definition sets the <code class="literal">myComponent</code> property of the controller class to the EJB proxy.</p> 
    <p>Alternatively (and preferably in case of many such proxy definitions), consider using the <code class="literal">&lt;jee:local-slsb&gt;</code> configuration element in Springs &quot;jee&quot; namespace:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;jee:local-slsb</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myComponent&quot;</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">&quot;ejb/myBean&quot;</span>
        <span class="hl-attribute">business-interface</span>=<span class="hl-value">&quot;com.mycom.MyComponent&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myController&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.mycom.myController&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;myComponent&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;myComponent&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>This EJB access mechanism delivers huge simplification of application code: the web tier code (or other EJB client code) has no dependence on the use of EJB. If we want to replace this EJB reference with a POJO or a mock object or other test stub, we could simply change the <code class="literal">myComponent</code> bean definition without changing a line of Java code. Additionally, we havent had to write a single line of JNDI lookup or other EJB plumbing code as part of our application.</p> 
    <p>Benchmarks and experience in real applications indicate that the performance overhead of this approach (which involves reflective invocation of the target EJB) is minimal, and is typically undetectable in typical use. Remember that we dont want to make fine-grained calls to EJBs anyway, as theres a cost associated with the EJB infrastructure in the application server.</p> 
    <p>There is one caveat with regards to the JNDI lookup. In a bean container, this class is normally best used as a singleton (there simply is no reason to make it a prototype). However, if that bean container pre-instantiates singletons (as do the various XML <code class="literal">ApplicationContext</code> variants) you may have a problem if the bean container is loaded before the EJB container loads the target EJB. That is because the JNDI lookup will be performed in the <code class="literal">init()</code> method of this class and then cached, but the EJB will not have been bound at the target location yet. The solution is to not pre-instantiate this factory object, but allow it to be created on first use. In the XML containers, this is controlled via the <code class="literal">lazy-init</code> attribute.</p> 
    <p>Although this will not be of interest to the majority of Spring users, those doing programmatic AOP work with EJBs may want to look at <code class="literal">LocalSlsbInvokerInterceptor</code>.</p> 
   </div> 
   <div class="section" title="22.2.3&nbsp;Accessing remote SLSBs">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="ejb-access-remote"></a>22.2.3&nbsp;Accessing remote SLSBs</h3>
      </div>
     </div>
    </div> 
    <p>Accessing remote EJBs is essentially identical to accessing local EJBs, except that the <code class="literal">SimpleRemoteStatelessSessionProxyFactoryBean</code> or <code class="literal">&lt;jee:remote-slsb&gt;</code> configuration element is used. Of course, with or without Spring, remote invocation semantics apply; a call to a method on an object in another VM in another computer does sometimes have to be treated differently in terms of usage scenarios and failure handling.</p> 
    <p>Springs EJB client support adds one more advantage over the non-Spring approach. Normally it is problematic for EJB client code to be easily switched back and forth between calling EJBs locally or remotely. This is because the remote interface methods must declare that they throw <code class="literal">RemoteException</code>, and client code must deal with this, while the local interface methods dont. Client code written for local EJBs which needs to be moved to remote EJBs typically has to be modified to add handling for the remote exceptions, and client code written for remote EJBs which needs to be moved to local EJBs, can either stay the same but do a lot of unnecessary handling of remote exceptions, or needs to be modified to remove that code. With the Spring remote EJB proxy, you can instead not declare any thrown <code class="literal">RemoteException</code> in your Business Method Interface and implementing EJB code, have a remote interface which is identical except that it does throw <code class="literal">RemoteException</code>, and rely on the proxy to dynamically treat the two interfaces as if they were the same. That is, client code does not have to deal with the checked <code class="literal">RemoteException</code> class. Any actual <code class="literal">RemoteException</code> that is thrown during the EJB invocation will be re-thrown as the non-checked <code class="literal">RemoteAccessException</code> class, which is a subclass of <code class="literal">RuntimeException</code>. The target service can then be switched at will between a local EJB or remote EJB (or even plain Java object) implementation, without the client code knowing or caring. Of course, this is optional; there is nothing stopping you from declaring <code class="literal">RemoteExceptions</code> in your business interface.</p> 
   </div> 
   <div class="section" title="22.2.4&nbsp;Accessing EJB 2.x SLSBs versus EJB 3 SLSBs">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="ejb-access-ejb2-ejb3"></a>22.2.4&nbsp;Accessing EJB 2.x SLSBs versus EJB 3 SLSBs</h3>
      </div>
     </div>
    </div> 
    <p>Accessing EJB 2.x Session Beans and EJB 3 Session Beans via Spring is largely transparent. Springs EJB accessors, including the <code class="literal">&lt;jee:local-slsb&gt;</code> and <code class="literal">&lt;jee:remote-slsb&gt;</code> facilities, transparently adapt to the actual component at runtime. They handle a home interface if found (EJB 2.x style), or perform straight component invocations if no home interface is available (EJB 3 style).</p> 
    <p>Note: For EJB 3 Session Beans, you could effectively use a <code class="literal">JndiObjectFactoryBean</code> / <code class="literal">&lt;jee:jndi-lookup&gt;</code> as well, since fully usable component references are exposed for plain JNDI lookups there. Defining explicit <code class="literal">&lt;jee:local-slsb&gt;</code> / <code class="literal">&lt;jee:remote-slsb&gt;</code> lookups simply provides consistent and more explicit EJB access configuration.</p> 
   </div> 
  </div> 
  <div class="section" title="22.3&nbsp;Using Springs EJB implementation support classes">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="ejb-implementation"></a>22.3&nbsp;Using Springs EJB implementation support classes</h2>
     </div>
    </div>
   </div> 
   <div class="section" title="22.3.1&nbsp;EJB 3 injection interceptor">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="ejb-implementation-ejb3"></a>22.3.1&nbsp;EJB 3 injection interceptor</h3>
      </div>
     </div>
    </div> 
    <p>For EJB 3 Session Beans and Message-Driven Beans, Spring provides a convenient interceptor that resolves Springs <code class="literal">@Autowired</code> annotation in the EJB component class: <code class="literal">org.springframework.ejb.interceptor.SpringBeanAutowiringInterceptor</code>. This interceptor can be applied through an <code class="literal">@Interceptors</code> annotation in the EJB component class, or through an <code class="literal">interceptor-binding</code> XML element in the EJB deployment descriptor.</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Stateless</span></i>
<i><span class="hl-annotation" style="color: gray">@Interceptors(SpringBeanAutowiringInterceptor.class)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyFacadeEJB <span class="hl-keyword">implements</span> MyFacadeLocal {

    <span class="hl-comment">// automatically injected with a matching Spring bean</span>
    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> MyComponent myComp;

    <span class="hl-comment">// for business method, delegate to POJO service impl.</span>
    <span class="hl-keyword">public</span> String myFacadeMethod(...) {
        <span class="hl-keyword">return</span> myComp.myMethod(...);
    }

    ...

}</pre> 
    <p><code class="literal">SpringBeanAutowiringInterceptor</code> by default obtains target beans from a <code class="literal">ContextSingletonBeanFactoryLocator</code>, with the context defined in a bean definition file named <code class="literal">beanRefContext.xml</code>. By default, a single context definition is expected, which is obtained by type rather than by name. However, if you need to choose between multiple context definitions, a specific locator key is required. The locator key (i.e. the name of the context definition in <code class="literal">beanRefContext.xml</code>) can be explicitly specified either through overriding the <code class="literal">getBeanFactoryLocatorKey</code> method in a custom <code class="literal">SpringBeanAutowiringInterceptor</code> subclass.</p> 
    <p>Alternatively, consider overriding <code class="literal">SpringBeanAutowiringInterceptor</code>'s <code class="literal">getBeanFactory</code> method, e.g. obtaining a shared <code class="literal">ApplicationContext</code> from a custom holder class.</p> 
   </div> 
  </div> 
 </div> 
 <div class="chapter" title="23.&nbsp;JMS (Java Message Service)">
  <div class="titlepage">
   <div>
    <div>
     <h2 class="title"><a name="jms"></a>23.&nbsp;JMS (Java Message Service)</h2>
    </div>
   </div>
  </div> 
  <div class="section" title="23.1&nbsp;Introduction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="jms-introduction"></a>23.1&nbsp;Introduction</h2>
     </div>
    </div>
   </div> 
   <p>Spring provides a JMS integration framework that simplifies the use of the JMS API much like Springs integration does for the JDBC API.</p> 
   <p>JMS can be roughly divided into two areas of functionality, namely the production and consumption of messages. The <code class="literal">JmsTemplate</code> class is used for message production and synchronous message reception. For asynchronous reception similar to Java EEs message-driven bean style, Spring provides a number of message listener containers that are used to create Message-Driven POJOs (MDPs).</p> 
   <p>The package <code class="literal">org.springframework.jms.core</code> provides the core functionality for using JMS. It contains JMS template classes that simplify the use of the JMS by handling the creation and release of resources, much like the <code class="literal">JdbcTemplate</code> does for JDBC. The design principle common to Spring template classes is to provide helper methods to perform common operations and for more sophisticated usage, delegate the essence of the processing task to user implemented callback interfaces. The JMS template follows the same design. The classes offer various convenience methods for the sending of messages, consuming a message synchronously, and exposing the JMS session and message producer to the user.</p> 
   <p>The package <code class="literal">org.springframework.jms.support</code> provides <code class="literal">JMSException</code> translation functionality. The translation converts the checked <code class="literal">JMSException</code> hierarchy to a mirrored hierarchy of unchecked exceptions. If there are any provider specific subclasses of the checked <code class="literal">javax.jms.JMSException</code>, this exception is wrapped in the unchecked <code class="literal">UncategorizedJmsException</code>.</p> 
   <p>The package <code class="literal">org.springframework.jms.support.converter</code> provides a <code class="literal">MessageConverter</code> abstraction to convert between Java objects and JMS messages.</p> 
   <p>The package <code class="literal">org.springframework.jms.support.destination</code> provides various strategies for managing JMS destinations, such as providing a service locator for destinations stored in JNDI.</p> 
   <p>Finally, the package <code class="literal">org.springframework.jms.connection</code> provides an implementation of the <code class="literal">ConnectionFactory</code> suitable for use in standalone applications. It also contains an implementation of Springs <code class="literal">PlatformTransactionManager</code> for JMS (the cunningly named <code class="literal">JmsTransactionManager</code>). This allows for seamless integration of JMS as a transactional resource into Springs transaction management mechanisms.</p> 
  </div> 
  <div class="section" title="23.2&nbsp;Using Spring JMS">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="jms-using"></a>23.2&nbsp;Using Spring JMS</h2>
     </div>
    </div>
   </div> 
   <div class="section" title="23.2.1&nbsp;JmsTemplate">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jms-jmstemplate"></a>23.2.1&nbsp;JmsTemplate</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">JmsTemplate</code> class is the central class in the JMS core package. It simplifies the use of JMS since it handles the creation and release of resources when sending or synchronously receiving messages.</p> 
    <p>Code that uses the <code class="literal">JmsTemplate</code> only needs to implement callback interfaces giving them a clearly defined high level contract. The <code class="literal">MessageCreator</code> callback interface creates a message given a <code class="literal">Session</code> provided by the calling code in <code class="literal">JmsTemplate</code>. In order to allow for more complex usage of the JMS API, the callback <code class="literal">SessionCallback</code> provides the user with the JMS session and the callback <code class="literal">ProducerCallback</code> exposes a <code class="literal">Session</code> and <code class="literal">MessageProducer</code> pair.</p> 
    <p>The JMS API exposes two types of send methods, one that takes delivery mode, priority, and time-to-live as Quality of Service (QOS) parameters and one that takes no QOS parameters which uses default values. Since there are many send methods in <code class="literal">JmsTemplate</code>, the setting of the QOS parameters have been exposed as bean properties to avoid duplication in the number of send methods. Similarly, the timeout value for synchronous receive calls is set using the property <code class="literal">setReceiveTimeout</code>.</p> 
    <p>Some JMS providers allow the setting of default QOS values administratively through the configuration of the ConnectionFactory. This has the effect that a call to <code class="literal">MessageProducer</code>'s send method <code class="literal">send(Destination destination, Message message)</code> will use different QOS default values than those specified in the JMS specification. In order to provide consistent management of QOS values, the <code class="literal">JmsTemplate</code> must therefore be specifically enabled to use its own QOS values by setting the boolean property <code class="literal">isExplicitQosEnabled</code> to <code class="literal">true</code>.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Instances of the <code class="literal">JmsTemplate</code> class are <span class="emphasis"><em>thread-safe once configured</em></span>. This is important because it means that you can configure a single instance of a <code class="literal">JmsTemplate</code> and then safely inject this <span class="emphasis"><em>shared</em></span> reference into multiple collaborators. To be clear, the <code class="literal">JmsTemplate</code> is stateful, in that it maintains a reference to a <code class="literal">ConnectionFactory</code>, but this state is <span class="emphasis"><em>not</em></span> conversational state.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="23.2.2&nbsp;Connections">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jms-connections"></a>23.2.2&nbsp;Connections</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">JmsTemplate</code> requires a reference to a <code class="literal">ConnectionFactory</code>. The <code class="literal">ConnectionFactory</code> is part of the JMS specification and serves as the entry point for working with JMS. It is used by the client application as a factory to create connections with the JMS provider and encapsulates various configuration parameters, many of which are vendor specific such as SSL configuration options.</p> 
    <p>When using JMS inside an EJB, the vendor provides implementations of the JMS interfaces so that they can participate in declarative transaction management and perform pooling of connections and sessions. In order to use this implementation, Java EE containers typically require that you declare a JMS connection factory as a <code class="literal">resource-ref</code> inside the EJB or servlet deployment descriptors. To ensure the use of these features with the <code class="literal">JmsTemplate</code> inside an EJB, the client application should ensure that it references the managed implementation of the <code class="literal">ConnectionFactory</code>.</p> 
    <div class="section" title="Caching Messaging Resources">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="jms-caching-resources"></a>Caching Messaging Resources</h4>
       </div>
      </div>
     </div> 
     <p>The standard API involves creating many intermediate objects. To send a message the following <span class="emphasis"><em>API</em></span> walk is performed</p> 
     <pre class="literallayout">ConnectionFactory-&gt;Connection-&gt;Session-&gt;MessageProducer-&gt;send</pre> 
     <p>Between the ConnectionFactory and the Send operation there are three intermediate objects that are created and destroyed. To optimise the resource usage and increase performance two implementations of IConnectionFactory are provided.</p> 
    </div> 
    <div class="section" title="SingleConnectionFactory">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="jms-connection-factory"></a>SingleConnectionFactory</h4>
       </div>
      </div>
     </div> 
     <p>Spring provides an implementation of the <code class="literal">ConnectionFactory</code> interface, <code class="literal">SingleConnectionFactory</code>, that will return the same <code class="literal">Connection</code> on all <code class="literal">createConnection()</code> calls and ignore calls to <code class="literal">close()</code>. This is useful for testing and standalone environments so that the same connection can be used for multiple <code class="literal">JmsTemplate</code> calls that may span any number of transactions. <code class="literal">SingleConnectionFactory</code> takes a reference to a standard <code class="literal">ConnectionFactory</code> that would typically come from JNDI.</p> 
    </div> 
    <div class="section" title="CachingConnectionFactory">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="jdbc-connection-factory-caching"></a>CachingConnectionFactory</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">CachingConnectionFactory</code> extends the functionality of <code class="literal">SingleConnectionFactory</code> and adds the caching of Sessions, MessageProducers, and MessageConsumers. The initial cache size is set to 1, use the property <code class="literal">SessionCacheSize</code> to increase the number of cached sessions. Note that the number of actual cached sessions will be more than that number as sessions are cached based on their acknowledgment mode, so there can be up to 4 cached session instances when <code class="literal">SessionCacheSize</code> is set to one, one for each AcknowledgementMode. MessageProducers and MessageConsumers are cached within their owning session and also take into account the unique properties of the producers and consumers when caching. MessageProducers are cached based on their destination. MessageConsumers are cached based on a key composed of the destination, selector, noLocal delivery flag, and the durable subscription name (if creating durable consumers).</p> 
    </div> 
   </div> 
   <div class="section" title="23.2.3&nbsp;Destination Management">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jms-destinations"></a>23.2.3&nbsp;Destination Management</h3>
      </div>
     </div>
    </div> 
    <p>Destinations, like ConnectionFactories, are JMS administered objects that can be stored and retrieved in JNDI. When configuring a Spring application context you can use the JNDI factory class <code class="literal">JndiObjectFactoryBean</code> / <code class="literal">&lt;jee:jndi-lookup&gt;</code> to perform dependency injection on your objects references to JMS destinations. However, often this strategy is cumbersome if there are a large number of destinations in the application or if there are advanced destination management features unique to the JMS provider. Examples of such advanced destination management would be the creation of dynamic destinations or support for a hierarchical namespace of destinations. The <code class="literal">JmsTemplate</code> delegates the resolution of a destination name to a JMS destination object to an implementation of the interface <code class="literal">DestinationResolver</code>. <code class="literal">DynamicDestinationResolver</code> is the default implementation used by <code class="literal">JmsTemplate</code> and accommodates resolving dynamic destinations. A <code class="literal">JndiDestinationResolver</code> is also provided that acts as a service locator for destinations contained in JNDI and optionally falls back to the behavior contained in <code class="literal">DynamicDestinationResolver</code>.</p> 
    <p>Quite often the destinations used in a JMS application are only known at runtime and therefore cannot be administratively created when the application is deployed. This is often because there is shared application logic between interacting system components that create destinations at runtime according to a well-known naming convention. Even though the creation of dynamic destinations is not part of the JMS specification, most vendors have provided this functionality. Dynamic destinations are created with a name defined by the user which differentiates them from temporary destinations and are often not registered in JNDI. The API used to create dynamic destinations varies from provider to provider since the properties associated with the destination are vendor specific. However, a simple implementation choice that is sometimes made by vendors is to disregard the warnings in the JMS specification and to use the <code class="literal">TopicSession</code> method <code class="literal">createTopic(String topicName)</code> or the <code class="literal">QueueSession</code> method <code class="literal">createQueue(String queueName)</code> to create a new destination with default destination properties. Depending on the vendor implementation, <code class="literal">DynamicDestinationResolver</code> may then also create a physical destination instead of only resolving one.</p> 
    <p>The boolean property <code class="literal">pubSubDomain</code> is used to configure the <code class="literal">JmsTemplate</code> with knowledge of what JMS domain is being used. By default the value of this property is false, indicating that the point-to-point domain, Queues, will be used. This property used by <code class="literal">JmsTemplate</code> determines the behavior of dynamic destination resolution via implementations of the <code class="literal">DestinationResolver</code> interface.</p> 
    <p>You can also configure the <code class="literal">JmsTemplate</code> with a default destination via the property <code class="literal">defaultDestination</code>. The default destination will be used with send and receive operations that do not refer to a specific destination.</p> 
   </div> 
   <div class="section" title="23.2.4&nbsp;Message Listener Containers">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jms-mdp"></a>23.2.4&nbsp;Message Listener Containers</h3>
      </div>
     </div>
    </div> 
    <p>One of the most common uses of JMS messages in the EJB world is to drive message-driven beans (MDBs). Spring offers a solution to create message-driven POJOs (MDPs) in a way that does not tie a user to an EJB container. (See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#jms-asynchronousMessageReception" title="23.4.2&nbsp;Asynchronous Reception - Message-Driven POJOs">Section&nbsp;23.4.2, Asynchronous Reception - Message-Driven POJOs</a> for detailed coverage of Springs MDP support.)</p> 
    <p>A message listener container is used to receive messages from a JMS message queue and drive the MessageListener that is injected into it. The listener container is responsible for all threading of message reception and dispatches into the listener for processing. A message listener container is the intermediary between an MDP and a messaging provider, and takes care of registering to receive messages, participating in transactions, resource acquisition and release, exception conversion and suchlike. This allows you as an application developer to write the (possibly complex) business logic associated with receiving a message (and possibly responding to it), and delegates boilerplate JMS infrastructure concerns to the framework.</p> 
    <p>There are two standard JMS message listener containers packaged with Spring, each with its specialised feature set.</p> 
    <div class="section" title="SimpleMessageListenerContainer">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="jms-mdp-simple"></a>SimpleMessageListenerContainer</h4>
       </div>
      </div>
     </div> 
     <p>This message listener container is the simpler of the two standard flavors. It creates a fixed number of JMS sessions and consumers at startup, registers the listener using the standard JMS <code class="literal">MessageConsumer.setMessageListener()</code> method, and leaves it up the JMS provider to perform listener callbacks. This variant does not allow for dynamic adaption to runtime demands or for participation in externally managed transactions. Compatibility-wise, it stays very close to the spirit of the standalone JMS specification - but is generally not compatible with Java EEs JMS restrictions.</p> 
    </div> 
    <div class="section" title="DefaultMessageListenerContainer">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="jms-mdp-default"></a>DefaultMessageListenerContainer</h4>
       </div>
      </div>
     </div> 
     <p>This message listener container is the one used in most cases. In contrast to <code class="literal">SimpleMessageListenerContainer</code>, this container variant does allow for dynamic adaption to runtime demands and is able to participate in externally managed transactions. Each received message is registered with an XA transaction when configured with a <code class="literal">JtaTransactionManager</code>; so processing may take advantage of XA transaction semantics. This listener container strikes a good balance between low requirements on the JMS provider, advanced functionality such as transaction participation, and compatibility with Java EE environments.</p> 
    </div> 
   </div> 
   <div class="section" title="23.2.5&nbsp;Transaction management">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jms-tx"></a>23.2.5&nbsp;Transaction management</h3>
      </div>
     </div>
    </div> 
    <p>Spring provides a <code class="literal">JmsTransactionManager</code> that manages transactions for a single JMS <code class="literal">ConnectionFactory</code>. This allows JMS applications to leverage the managed transaction features of Spring as described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#transaction" title="11.&nbsp;Transaction Management">Chapter&nbsp;11, <i>Transaction Management</i></a>. The <code class="literal">JmsTransactionManager</code> performs local resource transactions, binding a JMS Connection/Session pair from the specified <code class="literal">ConnectionFactory</code> to the thread. <code class="literal">JmsTemplate</code> automatically detects such transactional resources and operates on them accordingly.</p> 
    <p>In a Java EE environment, the <code class="literal">ConnectionFactory</code> will pool Connections and Sessions, so those resources are efficiently reused across transactions. In a standalone environment, using Springs <code class="literal">SingleConnectionFactory</code> will result in a shared JMS <code class="literal">Connection</code>, with each transaction having its own independent <code class="literal">Session</code>. Alternatively, consider the use of a provider-specific pooling adapter such as ActiveMQs <code class="literal">PooledConnectionFactory</code> class.</p> 
    <p><code class="literal">JmsTemplate</code> can also be used with the <code class="literal">JtaTransactionManager</code> and an XA-capable JMS <code class="literal">ConnectionFactory</code> for performing distributed transactions. Note that this requires the use of a JTA transaction manager as well as a properly XA-configured ConnectionFactory! (Check your Java EE servers / JMS providers documentation.)</p> 
    <p>Reusing code across a managed and unmanaged transactional environment can be confusing when using the JMS API to create a <code class="literal">Session</code> from a <code class="literal">Connection</code>. This is because the JMS API has only one factory method to create a <code class="literal">Session</code> and it requires values for the transaction and acknowledgement modes. In a managed environment, setting these values is the responsibility of the environments transactional infrastructure, so these values are ignored by the vendors wrapper to the JMS Connection. When using the <code class="literal">JmsTemplate</code> in an unmanaged environment you can specify these values through the use of the properties <code class="literal">sessionTransacted</code> and <code class="literal">sessionAcknowledgeMode</code>. When using a <code class="literal">PlatformTransactionManager</code> with <code class="literal">JmsTemplate</code>, the template will always be given a transactional JMS <code class="literal">Session</code>.</p> 
   </div> 
  </div> 
  <div class="section" title="23.3&nbsp;Sending a Message">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="jms-sending"></a>23.3&nbsp;Sending a Message</h2>
     </div>
    </div>
   </div> 
   <p>The <code class="literal">JmsTemplate</code> contains many convenience methods to send a message. There are send methods that specify the destination using a <code class="literal">javax.jms.Destination</code> object and those that specify the destination using a string for use in a JNDI lookup. The send method that takes no destination argument uses the default destination. Here is an example that sends a message to a queue using the 1.0.2 implementation.</p> 
   <pre class="programlisting"><span class="hl-keyword">import</span> javax.jms.ConnectionFactory;
<span class="hl-keyword">import</span> javax.jms.JMSException;
<span class="hl-keyword">import</span> javax.jms.Message;
<span class="hl-keyword">import</span> javax.jms.Queue;
<span class="hl-keyword">import</span> javax.jms.Session;

<span class="hl-keyword">import</span> org.springframework.jms.core.MessageCreator;
<span class="hl-keyword">import</span> org.springframework.jms.core.JmsTemplate;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JmsQueueSender {

    <span class="hl-keyword">private</span> JmsTemplate jmsTemplate;
    <span class="hl-keyword">private</span> Queue queue;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setConnectionFactory(ConnectionFactory cf) {
        <span class="hl-keyword">this</span>.jmsTemplate = <span class="hl-keyword">new</span> JmsTemplate(cf);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setQueue(Queue queue) {
        <span class="hl-keyword">this</span>.queue = queue;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> simpleSend() {
        <span class="hl-keyword">this</span>.jmsTemplate.send(<span class="hl-keyword">this</span>.queue, <span class="hl-keyword">new</span> MessageCreator() {
            <span class="hl-keyword">public</span> Message createMessage(Session session) <span class="hl-keyword">throws</span> JMSException {
                <span class="hl-keyword">return</span> session.createTextMessage(<span class="hl-string">&quot;hello queue world&quot;</span>);
            }
        });
    }
}</pre> 
   <p>This example uses the <code class="literal">MessageCreator</code> callback to create a text message from the supplied <code class="literal">Session</code> object. The <code class="literal">JmsTemplate</code> is constructed by passing a reference to a <code class="literal">ConnectionFactory</code>. As an alternative, a zero argument constructor and <code class="literal">connectionFactory</code> is provided and can be used for constructing the instance in JavaBean style (using a BeanFactory or plain Java code). Alternatively, consider deriving from Springs <code class="literal">JmsGatewaySupport</code> convenience base class, which provides pre-built bean properties for JMS configuration.</p> 
   <p>The method <code class="literal">send(String destinationName, MessageCreator creator)</code> lets you send a message using the string name of the destination. If these names are registered in JNDI, you should set the <code class="literal">destinationResolver</code> property of the template to an instance of <code class="literal">JndiDestinationResolver</code>.</p> 
   <p>If you created the <code class="literal">JmsTemplate</code> and specified a default destination, the <code class="literal">send(MessageCreator c)</code> sends a message to that destination.</p> 
   <div class="section" title="23.3.1&nbsp;Using Message Converters">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jms-msg-conversion"></a>23.3.1&nbsp;Using Message Converters</h3>
      </div>
     </div>
    </div> 
    <p>In order to facilitate the sending of domain model objects, the <code class="literal">JmsTemplate</code> has various send methods that take a Java object as an argument for a messages data content. The overloaded methods <code class="literal">convertAndSend()</code> and <code class="literal">receiveAndConvert()</code> in <code class="literal">JmsTemplate</code> delegate the conversion process to an instance of the <code class="literal">MessageConverter</code> interface. This interface defines a simple contract to convert between Java objects and JMS messages. The default implementation <code class="literal">SimpleMessageConverter</code> supports conversion between <code class="literal">String</code> and <code class="literal">TextMessage</code>, <code class="literal">byte[]</code> and <code class="literal">BytesMesssage</code>, and <code class="literal">java.util.Map</code> and <code class="literal">MapMessage</code>. By using the converter, you and your application code can focus on the business object that is being sent or received via JMS and not be concerned with the details of how it is represented as a JMS message.</p> 
    <p>The sandbox currently includes a <code class="literal">MapMessageConverter</code> which uses reflection to convert between a JavaBean and a <code class="literal">MapMessage</code>. Other popular implementation choices you might implement yourself are Converters that use an existing XML marshalling package, such as JAXB, Castor, XMLBeans, or XStream, to create a <code class="literal">TextMessage</code> representing the object.</p> 
    <p>To accommodate the setting of a messages properties, headers, and body that can not be generically encapsulated inside a converter class, the <code class="literal">MessagePostProcessor</code> interface gives you access to the message after it has been converted, but before it is sent. The example below demonstrates how to modify a message header and a property after a <code class="literal">java.util.Map</code> is converted to a message.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">void</span> sendWithConversion() {
    Map map = <span class="hl-keyword">new</span> HashMap();
    map.put(<span class="hl-string">&quot;Name&quot;</span>, <span class="hl-string">&quot;Mark&quot;</span>);
    map.put(<span class="hl-string">&quot;Age&quot;</span>, <span class="hl-keyword">new</span> Integer(<span class="hl-number">47</span>));
    jmsTemplate.convertAndSend(<span class="hl-string">&quot;testQueue&quot;</span>, map, <span class="hl-keyword">new</span> MessagePostProcessor() {
        <span class="hl-keyword">public</span> Message postProcessMessage(Message message) <span class="hl-keyword">throws</span> JMSException {
            message.setIntProperty(<span class="hl-string">&quot;AccountID&quot;</span>, <span class="hl-number">1234</span>);
            message.setJMSCorrelationID(<span class="hl-string">&quot;123-00001&quot;</span>);
            <span class="hl-keyword">return</span> message;
        }
    });
}</pre> 
    <p>This results in a message of the form:</p> 
    <pre class="literallayout">MapMessage={
	Header={
		... standard headers ...
		CorrelationID={123-00001}
	}
	Properties={
		AccountID={Integer:1234}
	}
	Fields={
		Name={String:Mark}
		Age={Integer:47}
	}
}</pre> 
   </div> 
   <div class="section" title="23.3.2&nbsp;SessionCallback and ProducerCallback">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jms-callbacks"></a>23.3.2&nbsp;SessionCallback and ProducerCallback</h3>
      </div>
     </div>
    </div> 
    <p>While the send operations cover many common usage scenarios, there are cases when you want to perform multiple operations on a JMS <code class="literal">Session</code> or <code class="literal">MessageProducer</code>. The <code class="literal">SessionCallback</code> and <code class="literal">ProducerCallback</code> expose the JMS <code class="literal">Session</code> and <code class="literal">Session</code> / <code class="literal">MessageProducer</code> pair respectively. The <code class="literal">execute()</code> methods on <code class="literal">JmsTemplate</code> execute these callback methods.</p> 
   </div> 
  </div> 
  <div class="section" title="23.4&nbsp;Receiving a message">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="jms-receiving"></a>23.4&nbsp;Receiving a message</h2>
     </div>
    </div>
   </div> 
   <div class="section" title="23.4.1&nbsp;Synchronous Reception">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jms-receiving-sync"></a>23.4.1&nbsp;Synchronous Reception</h3>
      </div>
     </div>
    </div> 
    <p>While JMS is typically associated with asynchronous processing, it is possible to consume messages synchronously. The overloaded <code class="literal">receive(..)</code> methods provide this functionality. During a synchronous receive, the calling thread blocks until a message becomes available. This can be a dangerous operation since the calling thread can potentially be blocked indefinitely. The property <code class="literal">receiveTimeout</code> specifies how long the receiver should wait before giving up waiting for a message.</p> 
   </div> 
   <div class="section" title="23.4.2&nbsp;Asynchronous Reception - Message-Driven POJOs">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jms-asynchronousMessageReception"></a>23.4.2&nbsp;Asynchronous Reception - Message-Driven POJOs</h3>
      </div>
     </div>
    </div> 
    <p>In a fashion similar to a Message-Driven Bean (MDB) in the EJB world, the Message-Driven POJO (MDP) acts as a receiver for JMS messages. The one restriction (but see also below for the discussion of the <code class="literal">MessageListenerAdapter</code> class) on an MDP is that it must implement the <code class="literal">javax.jms.MessageListener</code> interface. Please also be aware that in the case where your POJO will be receiving messages on multiple threads, it is important to ensure that your implementation is thread-safe.</p> 
    <p>Below is a simple implementation of an MDP:</p> 
    <pre class="programlisting"><span class="hl-keyword">import</span> javax.jms.JMSException;
<span class="hl-keyword">import</span> javax.jms.Message;
<span class="hl-keyword">import</span> javax.jms.MessageListener;
<span class="hl-keyword">import</span> javax.jms.TextMessage;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleListener <span class="hl-keyword">implements</span> MessageListener {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> onMessage(Message message) {
        <span class="hl-keyword">if</span> (message <span class="hl-keyword">instanceof</span> TextMessage) {
            <span class="hl-keyword">try</span> {
                System.out.println(((TextMessage) message).getText());
            }
            <span class="hl-keyword">catch</span> (JMSException ex) {
                <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> RuntimeException(ex);
            }
        }
        <span class="hl-keyword">else</span> {
            <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> IllegalArgumentException(<span class="hl-string">&quot;Message must be of type TextMessage&quot;</span>);
        }
    }

}</pre> 
    <p>Once youve implemented your <code class="literal">MessageListener</code>, its time to create a message listener container.</p> 
    <p>Find below an example of how to define and configure one of the message listener containers that ships with Spring (in this case the <code class="literal">DefaultMessageListenerContainer</code>).</p> 
    <pre class="programlisting"><span class="hl-comment">&lt;!-- this is the Message Driven POJO (MDP) --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;messageListener&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;jmsexample.ExampleListener&quot;</span><span class="hl-tag"> /&gt;</span>

<span class="hl-comment">&lt;!-- and this is the message listener container --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;jmsContainer&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jms.listener.DefaultMessageListenerContainer&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;connectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;destination&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;destination&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="strong"><strong>&lt;property name=&quot;messageListener&quot; ref=&quot;messageListener&quot; /&gt;</strong></span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>Please refer to the Spring Javadoc of the various message listener containers for a full description of the features supported by each implementation.</p> 
   </div> 
   <div class="section" title="23.4.3&nbsp;the SessionAwareMessageListener interface">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jms-receiving-async-session-aware-message-listener"></a>23.4.3&nbsp;the SessionAwareMessageListener interface</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">SessionAwareMessageListener</code> interface is a Spring-specific interface that provides a similar contract to the JMS <code class="literal">MessageListener</code> interface, but also provides the message handling method with access to the JMS <code class="literal">Session</code> from which the <code class="literal">Message</code> was received.</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.jms.listener;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> SessionAwareMessageListener {

    <span class="hl-keyword">void</span> onMessage(Message message, Session session) <span class="hl-keyword">throws</span> JMSException;

}</pre> 
    <p>You can choose to have your MDPs implement this interface (in preference to the standard JMS <code class="literal">MessageListener</code> interface) if you want your MDPs to be able to respond to any received messages (using the <code class="literal">Session</code> supplied in the <code class="literal">onMessage(Message, Session)</code> method). All of the message listener container implementations that ship with Spring have support for MDPs that implement either the <code class="literal">MessageListener</code> or <code class="literal">SessionAwareMessageListener</code> interface. Classes that implement the <code class="literal">SessionAwareMessageListener</code> come with the caveat that they are then tied to Spring through the interface. The choice of whether or not to use it is left entirely up to you as an application developer or architect.</p> 
    <p>Please note that the <code class="literal">'onMessage(..)'</code> method of the <code class="literal">SessionAwareMessageListener</code> interface throws <code class="literal">JMSException</code>. In contrast to the standard JMS <code class="literal">MessageListener</code> interface, when using the <code class="literal">SessionAwareMessageListener</code> interface, it is the responsibility of the client code to handle any exceptions thrown.</p> 
   </div> 
   <div class="section" title="23.4.4&nbsp;the MessageListenerAdapter">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jms-receiving-async-message-listener-adapter"></a>23.4.4&nbsp;the MessageListenerAdapter</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">MessageListenerAdapter</code> class is the final component in Springs asynchronous messaging support: in a nutshell, it allows you to expose almost <span class="emphasis"><em>any</em></span> class as a MDP (there are of course some constraints).</p> 
    <p>Consider the following interface definition. Notice that although the interface extends neither the <code class="literal">MessageListener</code> nor <code class="literal">SessionAwareMessageListener</code> interfaces, it can still be used as a MDP via the use of the <code class="literal">MessageListenerAdapter</code> class. Notice also how the various message handling methods are strongly typed according to the <span class="emphasis"><em>contents</em></span> of the various <code class="literal">Message</code> types that they can receive and handle.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> MessageDelegate {

    <span class="hl-keyword">void</span> handleMessage(String message);

    <span class="hl-keyword">void</span> handleMessage(Map message);

    <span class="hl-keyword">void</span> handleMessage(<span class="hl-keyword">byte</span>[] message);

    <span class="hl-keyword">void</span> handleMessage(Serializable message);

}</pre> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultMessageDelegate <span class="hl-keyword">implements</span> MessageDelegate {
    <span class="hl-comment">// implementation elided for clarity...</span>
}</pre> 
    <p>In particular, note how the above implementation of the <code class="literal">MessageDelegate</code> interface (the above <code class="literal">DefaultMessageDelegate</code> class) has <span class="emphasis"><em>no</em></span> JMS dependencies at all. It truly is a POJO that we will make into an MDP via the following configuration.</p> 
    <pre class="programlisting"><span class="hl-comment">&lt;!-- this is the Message Driven POJO (MDP) --&gt;</span>
<span class="strong"><strong>&lt;bean id=&quot;messageListener&quot; class=&quot;org.springframework.jms.listener.adapter.MessageListenerAdapter&quot;&gt; &lt;constructor-arg&gt; &lt;bean class=&quot;jmsexample.DefaultMessageDelegate&quot;/&gt; &lt;/constructor-arg&gt; &lt;/bean&gt;</strong></span>

<span class="hl-comment">&lt;!-- and this is the message listener container... --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;jmsContainer&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jms.listener.DefaultMessageListenerContainer&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;connectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;destination&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;destination&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="strong"><strong>&lt;property name=&quot;messageListener&quot; ref=&quot;messageListener&quot; /&gt;</strong></span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>Below is an example of another MDP that can only handle the receiving of JMS <code class="literal">TextMessage</code> messages. Notice how the message handling method is actually called <code class="literal">'receive'</code> (the name of the message handling method in a <code class="literal">MessageListenerAdapter</code> defaults to <code class="literal">'handleMessage'</code>), but it is configurable (as you will see below). Notice also how the <code class="literal">'receive(..)'</code> method is strongly typed to receive and respond only to JMS <code class="literal">TextMessage</code> messages.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> TextMessageDelegate {

    <span class="hl-keyword">void</span> receive(TextMessage message);

}</pre> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultTextMessageDelegate <span class="hl-keyword">implements</span> TextMessageDelegate {
    <span class="hl-comment">// implementation elided for clarity...</span>
}</pre> 
    <p>The configuration of the attendant <code class="literal">MessageListenerAdapter</code> would look like this:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;messageListener&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jms.listener.adapter.MessageListenerAdapter&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;constructor-arg&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;jmsexample.DefaultTextMessageDelegate&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/constructor-arg&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;defaultListenerMethod&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;receive&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-comment">&lt;!-- we don't want automatic message context extraction --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;messageConverter&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;null/&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>Please note that if the above <code class="literal">'messageListener'</code> receives a JMS <code class="literal">Message</code> of a type other than <code class="literal">TextMessage</code>, an <code class="literal">IllegalStateException</code> will be thrown (and subsequently swallowed). Another of the capabilities of the <code class="literal">MessageListenerAdapter</code> class is the ability to automatically send back a response <code class="literal">Message</code> if a handler method returns a non-void value. Consider the interface and class:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ResponsiveTextMessageDelegate {

    <span class="hl-comment">// notice the return type...</span>
    String receive(TextMessage message);

}</pre> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultResponsiveTextMessageDelegate <span class="hl-keyword">implements</span> ResponsiveTextMessageDelegate {
    <span class="hl-comment">// implementation elided for clarity...</span>
}</pre> 
    <p>If the above <code class="literal">DefaultResponsiveTextMessageDelegate</code> is used in conjunction with a <code class="literal">MessageListenerAdapter</code> then any non-null value that is returned from the execution of the <code class="literal">'receive(..)'</code> method will (in the default configuration) be converted into a <code class="literal">TextMessage</code>. The resulting <code class="literal">TextMessage</code> will then be sent to the <code class="literal">Destination</code> (if one exists) defined in the JMS Reply-To property of the original <code class="literal">Message</code>, or the default <code class="literal">Destination</code> set on the <code class="literal">MessageListenerAdapter</code> (if one has been configured); if no <code class="literal">Destination</code> is found then an <code class="literal">InvalidDestinationException</code> will be thrown (and please note that this exception <span class="emphasis"><em>will not</em></span> be swallowed and <span class="emphasis"><em>will</em></span> propagate up the call stack).</p> 
   </div> 
   <div class="section" title="23.4.5&nbsp;Processing messages within transactions">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jms-tx-participation"></a>23.4.5&nbsp;Processing messages within transactions</h3>
      </div>
     </div>
    </div> 
    <p>Invoking a message listener within a transaction only requires reconfiguration of the listener container.</p> 
    <p>Local resource transactions can simply be activated through the <code class="literal">sessionTransacted</code> flag on the listener container definition. Each message listener invocation will then operate within an active JMS transaction, with message reception rolled back in case of listener execution failure. Sending a response message (via <code class="literal">SessionAwareMessageListener</code>) will be part of the same local transaction, but any other resource operations (such as database access) will operate independently. This usually requires duplicate message detection in the listener implementation, covering the case where database processing has committed but message processing failed to commit.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;jmsContainer&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jms.listener.DefaultMessageListenerContainer&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;connectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;destination&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;destination&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;messageListener&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;messageListener&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="strong"><strong>&lt;property name=&quot;sessionTransacted&quot; value=&quot;true&quot;/&gt;</strong></span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>For participating in an externally managed transaction, you will need to configure a transaction manager and use a listener container which supports externally managed transactions: typically <code class="literal">DefaultMessageListenerContainer</code>.</p> 
    <p>To configure a message listener container for XA transaction participation, youll want to configure a <code class="literal">JtaTransactionManager</code> (which, by default, delegates to the Java EE servers transaction subsystem). Note that the underlying JMS ConnectionFactory needs to be XA-capable and properly registered with your JTA transaction coordinator! (Check your Java EE servers configuration of JNDI resources.) This allows message reception as well as e.g. database access to be part of the same transaction (with unified commit semantics, at the expense of XA transaction log overhead).</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;transactionManager&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.transaction.jta.JtaTransactionManager&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <p>Then you just need to add it to our earlier container configuration. The container will take care of the rest.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;jmsContainer&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jms.listener.DefaultMessageListenerContainer&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;connectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;destination&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;destination&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;messageListener&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;messageListener&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="strong"><strong>&lt;property name=&quot;transactionManager&quot; ref=&quot;transactionManager&quot;/&gt;</strong></span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   </div> 
  </div> 
  <div class="section" title="23.5&nbsp;Support for JCA Message Endpoints">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="jms-jca-message-endpoint-manager"></a>23.5&nbsp;Support for JCA Message Endpoints</h2>
     </div>
    </div>
   </div> 
   <p>Beginning with version 2.5, Spring also provides support for a JCA-based <code class="literal">MessageListener</code> container. The <code class="literal">JmsMessageEndpointManager</code> will attempt to automatically determine the <code class="literal">ActivationSpec</code> class name from the providers <code class="literal">ResourceAdapter</code> class name. Therefore, it is typically possible to just provide Springs generic <code class="literal">JmsActivationSpecConfig</code> as shown in the following example.</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jms.listener.endpoint.JmsMessageEndpointManager&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;resourceAdapter&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;resourceAdapter&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;activationSpecConfig&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jms.listener.endpoint.JmsActivationSpecConfig&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;destinationName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;myQueue&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/bean&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;messageListener&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;myMessageListener&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   <p>Alternatively, you may set up a <code class="literal">JmsMessageEndpointManager</code> with a given <code class="literal">ActivationSpec</code> object. The <code class="literal">ActivationSpec</code> object may also come from a JNDI lookup (using <code class="literal">&lt;jee:jndi-lookup&gt;</code>).</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jms.listener.endpoint.JmsMessageEndpointManager&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;resourceAdapter&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;resourceAdapter&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;activationSpec&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.apache.activemq.ra.ActiveMQActivationSpec&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;destination&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;myQueue&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;destinationType&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;javax.jms.Queue&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/bean&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;messageListener&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;myMessageListener&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   <p>Using Springs <code class="literal">ResourceAdapterFactoryBean</code>, the target <code class="literal">ResourceAdapter</code> may be configured locally as depicted in the following example.</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;resourceAdapter&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jca.support.ResourceAdapterFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;resourceAdapter&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.apache.activemq.ra.ActiveMQResourceAdapter&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serverUrl&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;tcp://localhost:61616&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/bean&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;workManager&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jca.work.SimpleTaskWorkManager&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   <p>The specified <code class="literal">WorkManager</code> may also point to an environment-specific thread pool - typically through <code class="literal">SimpleTaskWorkManager's</code> &quot;asyncTaskExecutor&quot; property. Consider defining a shared thread pool for all your <code class="literal">ResourceAdapter</code> instances if you happen to use multiple adapters.</p> 
   <p>In some environments (e.g. WebLogic 9 or above), the entire <code class="literal">ResourceAdapter</code> object may be obtained from JNDI instead (using <code class="literal">&lt;jee:jndi-lookup&gt;</code>). The Spring-based message listeners can then interact with the server-hosted <code class="literal">ResourceAdapter</code>, also using the servers built-in <code class="literal">WorkManager</code>.</p> 
   <p>Please consult the JavaDoc for <code class="literal">JmsMessageEndpointManager</code>, <code class="literal">JmsActivationSpecConfig</code>, and <code class="literal">ResourceAdapterFactoryBean</code> for more details.</p> 
   <p>Spring also provides a generic JCA message endpoint manager which is not tied to JMS: <code class="literal">org.springframework.jca.endpoint.GenericMessageEndpointManager</code>. This component allows for using any message listener type (e.g. a CCI MessageListener) and any provider-specific ActivationSpec object. Check out your JCA providers documentation to find out about the actual capabilities of your connector, and consult <code class="literal">GenericMessageEndpointManager</code>'s JavaDoc for the Spring-specific configuration details.</p> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>JCA-based message endpoint management is very analogous to EJB 2.1 Message-Driven Beans; it uses the same underlying resource provider contract. Like with EJB 2.1 MDBs, any message listener interface supported by your JCA provider can be used in the Spring context as well. Spring nevertheless provides explicit <span class="emphasis"><em>convenience</em></span> support for JMS, simply because JMS is the most common endpoint API used with the JCA endpoint management contract.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
  </div> 
  <div class="section" title="23.6&nbsp;JMS Namespace Support">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="jms-namespace"></a>23.6&nbsp;JMS Namespace Support</h2>
     </div>
    </div>
   </div> 
   <p>Spring 2.5 introduces an XML namespace for simplifying JMS configuration. To use the JMS namespace elements you will need to reference the JMS schema:</p> 
   <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
        <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
        <span class="strong"><strong>xmlns:jms=&quot;http://www.springframework.org/schema/jms&quot;</strong></span>
        xsi:schemaLocation=&quot;
            http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
            <span class="strong"><strong>http://www.springframework.org/schema/jms http://www.springframework.org/schema/jms/spring-jms.xsd</strong></span>&quot;&gt;

    <span class="hl-comment">&lt;!-- bean definitions here --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
   <p>The namespace consists of two top-level elements: <code class="literal">&lt;listener-container/&gt;</code> and <code class="literal">&lt;jca-listener-container/&gt;</code> both of which may contain one or more <code class="literal">&lt;listener/&gt;</code> child elements. Here is an example of a basic configuration for two listeners.</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;jms:listener-container&gt;</span>

    <span class="hl-tag">&lt;jms:listener</span> <span class="hl-attribute">destination</span>=<span class="hl-value">&quot;queue.orders&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;orderService&quot;</span> <span class="hl-attribute">method</span>=<span class="hl-value">&quot;placeOrder&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;jms:listener</span> <span class="hl-attribute">destination</span>=<span class="hl-value">&quot;queue.confirmations&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;confirmationLogger&quot;</span> <span class="hl-attribute">method</span>=<span class="hl-value">&quot;log&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/jms:listener-container&gt;</span></pre> 
   <p>The example above is equivalent to creating two distinct listener container bean definitions and two distinct <code class="literal">MessageListenerAdapter</code> bean definitions as demonstrated in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#jms-receiving-async-message-listener-adapter" title="23.4.4&nbsp;the MessageListenerAdapter">Section&nbsp;23.4.4, the MessageListenerAdapter</a>. In addition to the attributes shown above, the <code class="literal">listener</code> element may contain several optional ones. The following table describes all available attributes:</p> 
   <div class="table">
    <a name="jms-namespace-listener-tbl"></a>
    <p class="title"><b>Table&nbsp;23.1.&nbsp;Attributes of the JMS &lt;listener&gt; element</b></p>
    <div class="table-contents"> 
     <table summary="Attributes of the JMS &lt;listener&gt; element" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
      <colgroup>
       <col />
       <col />
      </colgroup>
      <thead>
       <tr>
        <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Attribute</th>
        <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>id</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>A bean name for the hosting listener container. If not specified, a bean name will be automatically generated.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>destination <span class="emphasis"><em>(required)</em></span></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The destination name for this listener, resolved through the <code class="literal">DestinationResolver</code> strategy.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>ref <span class="emphasis"><em>(required)</em></span></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The bean name of the handler object.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>method</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The name of the handler method to invoke. If the <code class="literal">ref</code> points to a <code class="literal">MessageListener</code> or Spring <code class="literal">SessionAwareMessageListener</code>, this attribute may be omitted.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>response-destination</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The name of the default response destination to send response messages to. This will be applied in case of a request message that does not carry a &quot;JMSReplyTo&quot; field. The type of this destination will be determined by the listener-containers &quot;destination-type&quot; attribute. Note: This only applies to a listener method with a return value, for which each result object will be converted into a response message.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>subscription</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The name of the durable subscription, if any.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>selector</p></td>
        <td style="" align="left" valign="top"><p>An optional message selector for this listener.</p></td>
       </tr>
      </tbody>
     </table> 
    </div>
   </div>
   <br class="table-break" /> 
   <p>The <code class="literal">&lt;listener-container/&gt;</code> element also accepts several optional attributes. This allows for customization of the various strategies (for example, <code class="literal">taskExecutor</code> and <code class="literal">destinationResolver</code>) as well as basic JMS settings and resource references. Using these attributes, it is possible to define highly-customized listener containers while still benefiting from the convenience of the namespace.</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;jms:listener-container</span> <span class="hl-attribute">connection-factory</span>=<span class="hl-value">&quot;myConnectionFactory&quot;</span>
        <span class="hl-attribute">task-executor</span>=<span class="hl-value">&quot;myTaskExecutor&quot;</span>
        <span class="hl-attribute">destination-resolver</span>=<span class="hl-value">&quot;myDestinationResolver&quot;</span>
        <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">&quot;myTransactionManager&quot;</span>
        <span class="hl-attribute">concurrency</span>=<span class="hl-value">&quot;10&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;jms:listener</span> <span class="hl-attribute">destination</span>=<span class="hl-value">&quot;queue.orders&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;orderService&quot;</span> <span class="hl-attribute">method</span>=<span class="hl-value">&quot;placeOrder&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;jms:listener</span> <span class="hl-attribute">destination</span>=<span class="hl-value">&quot;queue.confirmations&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;confirmationLogger&quot;</span> <span class="hl-attribute">method</span>=<span class="hl-value">&quot;log&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/jms:listener-container&gt;</span></pre> 
   <p>The following table describes all available attributes. Consult the class-level Javadoc of the <code class="literal">AbstractMessageListenerContainer</code> and its concrete subclasses for more details on the individual properties. The Javadoc also provides a discussion of transaction choices and message redelivery scenarios.</p> 
   <div class="table">
    <a name="jms-namespace-listener-container-tbl"></a>
    <p class="title"><b>Table&nbsp;23.2.&nbsp;Attributes of the JMS &lt;listener-container&gt; element</b></p>
    <div class="table-contents"> 
     <table summary="Attributes of the JMS &lt;listener-container&gt; element" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
      <colgroup>
       <col />
       <col />
      </colgroup>
      <thead>
       <tr>
        <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Attribute</th>
        <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>container-type</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The type of this listener container. Available options are: <code class="literal">default</code>, <code class="literal">simple</code>, <code class="literal">default102</code>, or <code class="literal">simple102</code> (the default value is <code class="literal">'default'</code>).</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>container-class</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>A custom listener container implementation class as fully qualified class name. Default is Springs standard <code class="literal">DefaultMessageListenerContainer</code> or <code class="literal">SimpleMessageListenerContainer</code>, according to the &quot;container-type&quot; attribute.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>connection-factory</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>A reference to the JMS <code class="literal">ConnectionFactory</code> bean (the default bean name is <code class="literal">'connectionFactory'</code>).</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>task-executor</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>A reference to the Spring <code class="literal">TaskExecutor</code> for the JMS listener invokers.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>destination-resolver</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>A reference to the <code class="literal">DestinationResolver</code> strategy for resolving JMS <code class="literal">Destinations</code>.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>message-converter</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>A reference to the <code class="literal">MessageConverter</code> strategy for converting JMS Messages to listener method arguments. Default is a <code class="literal">SimpleMessageConverter</code>.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>error-handler</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>A reference to an <code class="literal">ErrorHandler</code> strategy for handling any uncaught Exceptions that may occur during the execution of the <code class="literal">MessageListener</code>.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>destination-type</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The JMS destination type for this listener: <code class="literal">queue</code>, <code class="literal">topic</code> or <code class="literal">durableTopic</code>. The default is <code class="literal">queue</code>.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>client-id</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The JMS client id for this listener container. Needs to be specified when using durable subscriptions.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>cache</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The cache level for JMS resources: <code class="literal">none</code>, <code class="literal">connection</code>, <code class="literal">session</code>, <code class="literal">consumer</code> or <code class="literal">auto</code>. By default ( <code class="literal">auto</code>), the cache level will effectively be &quot;consumer&quot;, unless an external transaction manager has been specified - in which case the effective default will be <code class="literal">none</code> (assuming Java EE-style transaction management where the given ConnectionFactory is an XA-aware pool).</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>acknowledge</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The native JMS acknowledge mode: <code class="literal">auto</code>, <code class="literal">client</code>, <code class="literal">dups-ok</code> or <code class="literal">transacted</code>. A value of <code class="literal">transacted</code> activates a locally transacted <code class="literal">Session</code>. As an alternative, specify the <code class="literal">transaction-manager</code> attribute described below. Default is <code class="literal">auto</code>.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>transaction-manager</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>A reference to an external <code class="literal">PlatformTransactionManager</code> (typically an XA-based transaction coordinator, e.g. Springs <code class="literal">JtaTransactionManager</code>). If not specified, native acknowledging will be used (see &quot;acknowledge&quot; attribute).</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>concurrency</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The number of concurrent sessions/consumers to start for each listener. Can either be a simple number indicating the maximum number (e.g. &quot;5&quot;) or a range indicating the lower as well as the upper limit (e.g. &quot;3-5&quot;). Note that a specified minimum is just a hint and might be ignored at runtime. Default is 1; keep concurrency limited to 1 in case of a topic listener or if queue ordering is important; consider raising it for general queues.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>prefetch</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The maximum number of messages to load into a single session. Note that raising this number might lead to starvation of concurrent consumers!</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>receive-timeout</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The timeout to use for receive calls (in milliseconds). The default is <code class="literal">1000</code> ms (1 sec); <code class="literal">-1</code> indicates no timeout at all.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>recovery-interval</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Specify the interval between recovery attempts, in milliseconds. The default is <code class="literal">5000</code> ms, that is, 5 seconds.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>phase</p></td>
        <td style="" align="left" valign="top"><p>The lifecycle phase within which this container should start and stop. The lower the value the earlier this container will start and the later it will stop. The default is <code class="literal">Integer.MAX_VALUE</code> meaning the container will start as late as possible and stop as soon as possible.</p></td>
       </tr>
      </tbody>
     </table> 
    </div>
   </div>
   <br class="table-break" /> 
   <p>Configuring a JCA-based listener container with the &quot;jms&quot; schema support is very similar.</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;jms:jca-listener-container</span> <span class="hl-attribute">resource-adapter</span>=<span class="hl-value">&quot;myResourceAdapter&quot;</span>
        <span class="hl-attribute">destination-resolver</span>=<span class="hl-value">&quot;myDestinationResolver&quot;</span>
        <span class="hl-attribute">transaction-manager</span>=<span class="hl-value">&quot;myTransactionManager&quot;</span>
        <span class="hl-attribute">concurrency</span>=<span class="hl-value">&quot;10&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;jms:listener</span> <span class="hl-attribute">destination</span>=<span class="hl-value">&quot;queue.orders&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;myMessageListener&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/jms:jca-listener-container&gt;</span></pre> 
   <p>The available configuration options for the JCA variant are described in the following table:</p> 
   <div class="table">
    <a name="jms-namespace-jca-listener-container-tbl"></a>
    <p class="title"><b>Table&nbsp;23.3.&nbsp;Attributes of the JMS &lt;jca-listener-container/&gt; element</b></p>
    <div class="table-contents"> 
     <table summary="Attributes of the JMS &lt;jca-listener-container/&gt; element" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
      <colgroup>
       <col />
       <col />
      </colgroup>
      <thead>
       <tr>
        <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Attribute</th>
        <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>resource-adapter</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>A reference to the JCA <code class="literal">ResourceAdapter</code> bean (the default bean name is <code class="literal">'resourceAdapter'</code>).</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>activation-spec-factory</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>A reference to the <code class="literal">JmsActivationSpecFactory</code>. The default is to autodetect the JMS provider and its <code class="literal">ActivationSpec</code> class (see <code class="literal">DefaultJmsActivationSpecFactory</code>)</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>destination-resolver</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>A reference to the <code class="literal">DestinationResolver</code> strategy for resolving JMS <code class="literal">Destinations</code>.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>message-converter</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>A reference to the <code class="literal">MessageConverter</code> strategy for converting JMS Messages to listener method arguments. Default is a <code class="literal">SimpleMessageConverter</code>.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>destination-type</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The JMS destination type for this listener: <code class="literal">queue</code>, <code class="literal">topic</code> or <code class="literal">durableTopic</code>. The default is <code class="literal">queue</code>.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>client-id</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The JMS client id for this listener container. Needs to be specified when using durable subscriptions.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>acknowledge</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The native JMS acknowledge mode: <code class="literal">auto</code>, <code class="literal">client</code>, <code class="literal">dups-ok</code> or <code class="literal">transacted</code>. A value of <code class="literal">transacted</code> activates a locally transacted <code class="literal">Session</code>. As an alternative, specify the <code class="literal">transaction-manager</code> attribute described below. Default is <code class="literal">auto</code>.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>transaction-manager</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>A reference to a Spring <code class="literal">JtaTransactionManager</code> or a <code class="literal">javax.transaction.TransactionManager</code> for kicking off an XA transaction for each incoming message. If not specified, native acknowledging will be used (see the &quot;acknowledge&quot; attribute).</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>concurrency</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The number of concurrent sessions/consumers to start for each listener. Can either be a simple number indicating the maximum number (e.g. &quot;5&quot;) or a range indicating the lower as well as the upper limit (e.g. &quot;3-5&quot;). Note that a specified minimum is just a hint and will typically be ignored at runtime when using a JCA listener container. Default is 1.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>prefetch</p></td>
        <td style="" align="left" valign="top"><p>The maximum number of messages to load into a single session. Note that raising this number might lead to starvation of concurrent consumers!</p></td>
       </tr>
      </tbody>
     </table> 
    </div>
   </div>
   <br class="table-break" /> 
  </div> 
 </div> 
 <div class="chapter" title="24.&nbsp;JMX">
  <div class="titlepage">
   <div>
    <div>
     <h2 class="title"><a name="jmx"></a>24.&nbsp;JMX</h2>
    </div>
   </div>
  </div> 
  <div class="section" title="24.1&nbsp;Introduction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="jmx-introduction"></a>24.1&nbsp;Introduction</h2>
     </div>
    </div>
   </div> 
   <p>The JMX support in Spring provides you with the features to easily and transparently integrate your Spring application into a JMX infrastructure.</p> 
   <div class="sidebar" title="JMX?">
    <p class="title"><b>JMX?</b></p> 
    <p>This chapter is not an introduction to JMX it doesnt try to explain the motivations of why one might want to use JMX (or indeed what the letters JMX actually stand for). If you are new to JMX, check out <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#jmx-resources" title="24.8&nbsp;Further Resources">Section&nbsp;24.8, Further Resources</a> at the end of this chapter.</p> 
   </div> 
   <p>Specifically, Springs JMX support provides four core features:</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem"> The automatic registration of <span class="emphasis"><em>any</em></span> Spring bean as a JMX MBean </li>
     <li class="listitem"> A flexible mechanism for controlling the management interface of your beans </li>
     <li class="listitem"> The declarative exposure of MBeans over remote, JSR-160 connectors </li>
     <li class="listitem"> The simple proxying of both local and remote MBean resources </li>
    </ul>
   </div> 
   <p>These features are designed to work without coupling your application components to either Spring or JMX interfaces and classes. Indeed, for the most part your application classes need not be aware of either Spring or JMX in order to take advantage of the Spring JMX features.</p> 
  </div> 
  <div class="section" title="24.2&nbsp;Exporting your beans to JMX">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="jmx-exporting"></a>24.2&nbsp;Exporting your beans to JMX</h2>
     </div>
    </div>
   </div> 
   <p>The core class in Springs JMX framework is the <code class="literal">MBeanExporter</code>. This class is responsible for taking your Spring beans and registering them with a JMX <code class="literal">MBeanServer</code>. For example, consider the following class:</p> 
   <pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.jmx;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JmxTestBean <span class="hl-keyword">implements</span> IJmxTestBean {

    <span class="hl-keyword">private</span> String name;
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> age;
    <span class="hl-keyword">private</span> <span class="hl-keyword">boolean</span> isSuperman;

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getAge() {
        <span class="hl-keyword">return</span> age;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setAge(<span class="hl-keyword">int</span> age) {
        <span class="hl-keyword">this</span>.age = age;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(String name) {
        <span class="hl-keyword">this</span>.name = name;
    }

    <span class="hl-keyword">public</span> String getName() {
        <span class="hl-keyword">return</span> name;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> add(<span class="hl-keyword">int</span> x, <span class="hl-keyword">int</span> y) {
        <span class="hl-keyword">return</span> x + y;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> dontExposeMe() {
        <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> RuntimeException();
    }
}</pre> 
   <p>To expose the properties and methods of this bean as attributes and operations of an MBean you simply configure an instance of the <code class="literal">MBeanExporter</code> class in your configuration file and pass in the bean as shown below:</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-comment">&lt;!-- this bean must not be lazily initialized if the exporting is to happen --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exporter&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.MBeanExporter&quot;</span> <span class="hl-attribute">lazy-init</span>=<span class="hl-value">&quot;false&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;beans&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;map&gt;</span>
                <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;bean:name=testBean1&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;testBean&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/map&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;testBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.JmxTestBean&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;TEST&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;age&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;100&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
   <p>The pertinent bean definition from the above configuration snippet is the <code class="literal">exporter</code> bean. The <code class="literal">beans</code> property tells the <code class="literal">MBeanExporter</code> exactly which of your beans must be exported to the JMX <code class="literal">MBeanServer</code>. In the default configuration, the key of each entry in the <code class="literal">beans</code> <code class="literal">Map</code> is used as the <code class="literal">ObjectName</code> for the bean referenced by the corresponding entry value. This behavior can be changed as described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#jmx-naming" title="24.4&nbsp;Controlling the ObjectNames for your beans">Section&nbsp;24.4, Controlling the ObjectNames for your beans</a>.</p> 
   <p>With this configuration the <code class="literal">testBean</code> bean is exposed as an MBean under the <code class="literal">ObjectName</code> <code class="literal">bean:name=testBean1</code>. By default, all <span class="emphasis"><em>public</em></span> properties of the bean are exposed as attributes and all <span class="emphasis"><em>public</em></span> methods (bar those inherited from the <code class="literal">Object</code> class) are exposed as operations.</p> 
   <div class="section" title="24.2.1&nbsp;Creating an MBeanServer">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jmx-exporting-mbeanserver"></a>24.2.1&nbsp;Creating an MBeanServer</h3>
      </div>
     </div>
    </div> 
    <p>The above configuration assumes that the application is running in an environment that has one (and only one) <code class="literal">MBeanServer</code> already running. In this case, Spring will attempt to locate the running <code class="literal">MBeanServer</code> and register your beans with that server (if any). This behavior is useful when your application is running inside a container such as Tomcat or IBM WebSphere that has its own <code class="literal">MBeanServer</code>.</p> 
    <p>However, this approach is of no use in a standalone environment, or when running inside a container that does not provide an <code class="literal">MBeanServer</code>. To address this you can create an <code class="literal">MBeanServer</code> instance declaratively by adding an instance of the <code class="literal">org.springframework.jmx.support.MBeanServerFactoryBean</code> class to your configuration. You can also ensure that a specific <code class="literal">MBeanServer</code> is used by setting the value of the <code class="literal">MBeanExporter</code>'s <code class="literal">server</code> property to the <code class="literal">MBeanServer</code> value returned by an <code class="literal">MBeanServerFactoryBean</code>; for example:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;mbeanServer&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.support.MBeanServerFactoryBean&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!--
    this bean needs to be eagerly pre-instantiated in order for the exporting to occur;
    this means that it must not be marked as lazily initialized
    --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exporter&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.MBeanExporter&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;beans&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;map&gt;</span>
                <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;bean:name=testBean1&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;testBean&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/map&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;server&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;mbeanServer&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;testBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.JmxTestBean&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;TEST&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;age&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;100&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>Here an instance of <code class="literal">MBeanServer</code> is created by the <code class="literal">MBeanServerFactoryBean</code> and is supplied to the <code class="literal">MBeanExporter</code> via the server property. When you supply your own <code class="literal">MBeanServer</code> instance, the <code class="literal">MBeanExporter</code> will not attempt to locate a running <code class="literal">MBeanServer</code> and will use the supplied <code class="literal">MBeanServer</code> instance. For this to work correctly, you must (of course) have a JMX implementation on your classpath.</p> 
   </div> 
   <div class="section" title="24.2.2&nbsp;Reusing an existing MBeanServer">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jmx-mbean-server"></a>24.2.2&nbsp;Reusing an existing MBeanServer</h3>
      </div>
     </div>
    </div> 
    <p>If no server is specified, the <code class="literal">MBeanExporter</code> tries to automatically detect a running <code class="literal">MBeanServer</code>. This works in most environment where only one <code class="literal">MBeanServer</code> instance is used, however when multiple instances exist, the exporter might pick the wrong server. In such cases, one should use the <code class="literal">MBeanServer</code> <code class="literal">agentId</code> to indicate which instance to be used:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;mbeanServer&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.support.MBeanServerFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- indicate to first look for a server --&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;locateExistingServerIfPossible&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;true&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-comment">&lt;!-- search for the MBeanServer instance with the given agentId --&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;agentId&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;MBeanServer_instance_agentId&gt;&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exporter&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.MBeanExporter&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;server&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;mbeanServer&quot;</span><span class="hl-tag">/&gt;</span>
        ...
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>For platforms/cases where the existing <code class="literal">MBeanServer</code> has a dynamic (or unknown) <code class="literal">agentId</code> which is retrieved through lookup methods, one should use <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-class-static-factory-method" title="Instantiation with a static factory method">factory-method</a>:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exporter&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.MBeanExporter&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;server&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-comment">&lt;!-- Custom MBeanServerLocator --&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;platform.package.MBeanServerLocator&quot;</span> <span class="hl-attribute">factory-method</span>=<span class="hl-value">&quot;locateMBeanServer&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- other beans here --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
   </div> 
   <div class="section" title="24.2.3&nbsp;Lazy-initialized MBeans">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jmx-exporting-lazy"></a>24.2.3&nbsp;Lazy-initialized MBeans</h3>
      </div>
     </div>
    </div> 
    <p>If you configure a bean with the <code class="literal">MBeanExporter</code> that is also configured for lazy initialization, then the <code class="literal">MBeanExporter</code> will <span class="emphasis"><em>not</em></span> break this contract and will avoid instantiating the bean. Instead, it will register a proxy with the <code class="literal">MBeanServer</code> and will defer obtaining the bean from the container until the first invocation on the proxy occurs.</p> 
   </div> 
   <div class="section" title="24.2.4&nbsp;Automatic registration of MBeans">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jmx-exporting-auto"></a>24.2.4&nbsp;Automatic registration of MBeans</h3>
      </div>
     </div>
    </div> 
    <p>Any beans that are exported through the <code class="literal">MBeanExporter</code> and are already valid MBeans are registered as-is with the <code class="literal">MBeanServer</code> without further intervention from Spring. MBeans can be automatically detected by the <code class="literal">MBeanExporter</code> by setting the <code class="literal">autodetect</code> property to <code class="literal">true</code>:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exporter&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.MBeanExporter&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;autodetect&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;true&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;spring:mbean=true&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.TestDynamicMBean&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <p>Here, the bean called <code class="literal">spring:mbean=true</code> is already a valid JMX MBean and will be automatically registered by Spring. By default, beans that are autodetected for JMX registration have their bean name used as the <code class="literal">ObjectName</code>. This behavior can be overridden as detailed in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#jmx-naming" title="24.4&nbsp;Controlling the ObjectNames for your beans">Section&nbsp;24.4, Controlling the ObjectNames for your beans</a>.</p> 
   </div> 
   <div class="section" title="24.2.5&nbsp;Controlling the registration behavior">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jmx-exporting-registration-behavior"></a>24.2.5&nbsp;Controlling the registration behavior</h3>
      </div>
     </div>
    </div> 
    <p>Consider the scenario where a Spring <code class="literal">MBeanExporter</code> attempts to register an <code class="literal">MBean</code> with an <code class="literal">MBeanServer</code> using the <code class="literal">ObjectName</code> <code class="literal">'bean:name=testBean1'</code>. If an <code class="literal">MBean</code> instance has already been registered under that same <code class="literal">ObjectName</code>, the default behavior is to fail (and throw an <code class="literal">InstanceAlreadyExistsException</code>).</p> 
    <p>It is possible to control the behavior of exactly what happens when an <code class="literal">MBean</code> is registered with an <code class="literal">MBeanServer</code>. Springs JMX support allows for three different registration behaviors to control the registration behavior when the registration process finds that an <code class="literal">MBean</code> has already been registered under the same <code class="literal">ObjectName</code>; these registration behaviors are summarized on the following table:</p> 
    <div class="table">
     <a name="jmx-registration-behaviors"></a>
     <p class="title"><b>Table&nbsp;24.1.&nbsp;Registration Behaviors</b></p>
     <div class="table-contents"> 
      <table summary="Registration Behaviors" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
       <colgroup>
        <col />
        <col />
       </colgroup>
       <thead>
        <tr>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Registration behavior</th>
         <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explanation</th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">REGISTRATION_FAIL_ON_EXISTING</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>This is the default registration behavior. If an <code class="literal">MBean</code> instance has already been registered under the same <code class="literal">ObjectName</code>, the <code class="literal">MBean</code> that is being registered will not be registered and an <code class="literal">InstanceAlreadyExistsException</code> will be thrown. The existing <code class="literal">MBean</code> is unaffected.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">REGISTRATION_IGNORE_EXISTING</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>If an <code class="literal">MBean</code> instance has already been registered under the same <code class="literal">ObjectName</code>, the <code class="literal">MBean</code> that is being registered will <span class="emphasis"><em>not</em></span> be registered. The existing <code class="literal">MBean</code> is unaffected, and no <code class="literal">Exception</code> will be thrown. This is useful in settings where multiple applications want to share a common <code class="literal">MBean</code> in a shared <code class="literal">MBeanServer</code>.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">REGISTRATION_REPLACE_EXISTING</code></p></td>
         <td style="" align="left" valign="top"><p>If an <code class="literal">MBean</code> instance has already been registered under the same <code class="literal">ObjectName</code>, the existing <code class="literal">MBean</code> that was previously registered will be unregistered and the new <code class="literal">MBean</code> will be registered in its place (the new <code class="literal">MBean</code> effectively replaces the previous instance).</p></td>
        </tr>
       </tbody>
      </table> 
     </div>
    </div>
    <br class="table-break" /> 
    <p>The above values are defined as constants on the <code class="literal">MBeanRegistrationSupport</code> class (the <code class="literal">MBeanExporter</code> class derives from this superclass). If you want to change the default registration behavior, you simply need to set the value of the <code class="literal">registrationBehaviorName</code> property on your <code class="literal">MBeanExporter</code> definition to one of those values.</p> 
    <p>The following example illustrates how to effect a change from the default registration behavior to the <code class="literal">REGISTRATION_REPLACE_EXISTING</code> behavior:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exporter&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.MBeanExporter&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;beans&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;map&gt;</span>
                <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;bean:name=testBean1&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;testBean&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/map&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;registrationBehaviorName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;REGISTRATION_REPLACE_EXISTING&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;testBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.JmxTestBean&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;TEST&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;age&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;100&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
   </div> 
  </div> 
  <div class="section" title="24.3&nbsp;Controlling the management interface of your beans">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="jmx-interface"></a>24.3&nbsp;Controlling the management interface of your beans</h2>
     </div>
    </div>
   </div> 
   <p>In the previous example, you had little control over the management interface of your bean; <span class="emphasis"><em>all</em></span> of the <span class="emphasis"><em>public</em></span> properties and methods of each exported bean was exposed as JMX attributes and operations respectively. To exercise finer-grained control over exactly which properties and methods of your exported beans are actually exposed as JMX attributes and operations, Spring JMX provides a comprehensive and extensible mechanism for controlling the management interfaces of your beans.</p> 
   <div class="section" title="24.3.1&nbsp;the MBeanInfoAssembler Interface">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jmx-interface-assembler"></a>24.3.1&nbsp;the MBeanInfoAssembler Interface</h3>
      </div>
     </div>
    </div> 
    <p>Behind the scenes, the <code class="literal">MBeanExporter</code> delegates to an implementation of the <code class="literal">org.springframework.jmx.export.assembler.MBeanInfoAssembler</code> interface which is responsible for defining the management interface of each bean that is being exposed. The default implementation, <code class="literal">org.springframework.jmx.export.assembler.SimpleReflectiveMBeanInfoAssembler</code>, simply defines a management interface that exposes all public properties and methods (as you saw in the previous examples). Spring provides two additional implementations of the <code class="literal">MBeanInfoAssembler</code> interface that allow you to control the generated management interface using either source-level metadata or any arbitrary interface.</p> 
   </div> 
   <div class="section" title="24.3.2&nbsp;Using Source-Level Metadata (JDK 5.0 annotations)">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jmx-interface-metadata"></a>24.3.2&nbsp;Using Source-Level Metadata (JDK 5.0 annotations)</h3>
      </div>
     </div>
    </div> 
    <p>Using the <code class="literal">MetadataMBeanInfoAssembler</code> you can define the management interfaces for your beans using source level metadata. The reading of metadata is encapsulated by the <code class="literal">org.springframework.jmx.export.metadata.JmxAttributeSource</code> interface. Spring JMX provides a default implementation which uses JDK 5.0 annotations, namely <code class="literal">org.springframework.jmx.export.annotation.AnnotationJmxAttributeSource</code>. The <code class="literal">MetadataMBeanInfoAssembler</code> <span class="emphasis"><em>must</em></span> be configured with an implementation instance of the <code class="literal">JmxAttributeSource</code> interface for it to function correctly (there is <span class="emphasis"><em>no</em></span> default).</p> 
    <p>To mark a bean for export to JMX, you should annotate the bean class with the <code class="literal">ManagedResource</code> annotation. Each method you wish to expose as an operation must be marked with the <code class="literal">ManagedOperation</code> annotation and each property you wish to expose must be marked with the <code class="literal">ManagedAttribute</code> annotation. When marking properties you can omit either the annotation of the getter or the setter to create a write-only or read-only attribute respectively.</p> 
    <p>The example below shows the annotated version of the <code class="literal">JmxTestBean</code> class that you saw earlier:</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.jmx;

<span class="hl-keyword">import</span> org.springframework.jmx.export.annotation.ManagedResource;
<span class="hl-keyword">import</span> org.springframework.jmx.export.annotation.ManagedOperation;
<span class="hl-keyword">import</span> org.springframework.jmx.export.annotation.ManagedAttribute;

<i><span class="hl-annotation" style="color: gray">@ManagedResource( objectName=&quot;bean:name=testBean4&quot;, description=&quot;My Managed Bean&quot;, log=true, logFile=&quot;jmx.log&quot;, currencyTimeLimit=15, persistPolicy=&quot;OnUpdate&quot;, persistPeriod=200, persistLocation=&quot;foo&quot;, persistName=&quot;bar&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AnnotationTestBean <span class="hl-keyword">implements</span> IJmxTestBean {

    <span class="hl-keyword">private</span> String name;
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> age;

    <i><span class="hl-annotation" style="color: gray">@ManagedAttribute(description=&quot;The Age Attribute&quot;, currencyTimeLimit=15)</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getAge() {
        <span class="hl-keyword">return</span> age;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setAge(<span class="hl-keyword">int</span> age) {
        <span class="hl-keyword">this</span>.age = age;
    }

    <i><span class="hl-annotation" style="color: gray">@ManagedAttribute(description=&quot;The Name Attribute&quot;, currencyTimeLimit=20, defaultValue=&quot;bar&quot;, persistPolicy=&quot;OnUpdate&quot;)</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(String name) {
        <span class="hl-keyword">this</span>.name = name;
    }

    <i><span class="hl-annotation" style="color: gray">@ManagedAttribute(defaultValue=&quot;foo&quot;, persistPeriod=300)</span></i>
    <span class="hl-keyword">public</span> String getName() {
        <span class="hl-keyword">return</span> name;
    }

    <i><span class="hl-annotation" style="color: gray">@ManagedOperation(description=&quot;Add two numbers&quot;)</span></i>
    <i><span class="hl-annotation" style="color: gray">@ManagedOperationParameters({ @ManagedOperationParameter(name = &quot;x&quot;, description = &quot;The first number&quot;), @ManagedOperationParameter(name = &quot;y&quot;, description = &quot;The second number&quot;)})</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> add(<span class="hl-keyword">int</span> x, <span class="hl-keyword">int</span> y) {
        <span class="hl-keyword">return</span> x + y;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> dontExposeMe() {
        <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> RuntimeException();
    }

}</pre> 
    <p>Here you can see that the <code class="literal">JmxTestBean</code> class is marked with the <code class="literal">ManagedResource</code> annotation and that this <code class="literal">ManagedResource</code> annotation is configured with a set of properties. These properties can be used to configure various aspects of the MBean that is generated by the <code class="literal">MBeanExporter</code>, and are explained in greater detail later in section entitled <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#jmx-interface-metadata-types" title="24.3.3&nbsp;Source-Level Metadata Types">Section&nbsp;24.3.3, Source-Level Metadata Types</a>.</p> 
    <p>You will also notice that both the <code class="literal">age</code> and <code class="literal">name</code> properties are annotated with the <code class="literal">ManagedAttribute</code> annotation, but in the case of the <code class="literal">age</code> property, only the getter is marked. This will cause both of these properties to be included in the management interface as attributes, but the <code class="literal">age</code> attribute will be read-only.</p> 
    <p>Finally, you will notice that the <code class="literal">add(int, int)</code> method is marked with the <code class="literal">ManagedOperation</code> attribute whereas the <code class="literal">dontExposeMe()</code> method is not. This will cause the management interface to contain only one operation, <code class="literal">add(int, int)</code>, when using the <code class="literal">MetadataMBeanInfoAssembler</code>.</p> 
    <p>The configuration below shows how you configure the <code class="literal">MBeanExporter</code> to use the <code class="literal">MetadataMBeanInfoAssembler</code>:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exporter&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.MBeanExporter&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;assembler&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;assembler&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;namingStrategy&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;namingStrategy&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;autodetect&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;true&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;jmxAttributeSource&quot;</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.annotation.AnnotationJmxAttributeSource&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- will create management interface using annotation metadata --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;assembler&quot;</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.assembler.MetadataMBeanInfoAssembler&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;attributeSource&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;jmxAttributeSource&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- will pick up the ObjectName from the annotation --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;namingStrategy&quot;</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.naming.MetadataNamingStrategy&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;attributeSource&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;jmxAttributeSource&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;testBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.AnnotationTestBean&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;TEST&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;age&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;100&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>Here you can see that an <code class="literal">MetadataMBeanInfoAssembler</code> bean has been configured with an instance of the <code class="literal">AnnotationJmxAttributeSource</code> class and passed to the <code class="literal">MBeanExporter</code> through the assembler property. This is all that is required to take advantage of metadata-driven management interfaces for your Spring-exposed MBeans.</p> 
   </div> 
   <div class="section" title="24.3.3&nbsp;Source-Level Metadata Types">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jmx-interface-metadata-types"></a>24.3.3&nbsp;Source-Level Metadata Types</h3>
      </div>
     </div>
    </div> 
    <p>The following source level metadata types are available for use in Spring JMX:</p> 
    <div class="table">
     <a name="jmx-metadata-types"></a>
     <p class="title"><b>Table&nbsp;24.2.&nbsp;Source-Level Metadata Types</b></p>
     <div class="table-contents"> 
      <table summary="Source-Level Metadata Types" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
       <colgroup>
        <col />
        <col />
        <col />
       </colgroup>
       <thead>
        <tr>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Purpose</th>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Annotation</th>
         <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Annotation Type</th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Mark all instances of a <code class="literal">Class</code> as JMX managed resources</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">@ManagedResource</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Class</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Mark a method as a JMX operation</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">@ManagedOperation</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Method</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Mark a getter or setter as one half of a JMX attribute</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">@ManagedAttribute</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Method (only getters and setters)</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Define descriptions for operation parameters</p></td>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">@ManagedOperationParameter</code> and <code class="literal">@ManagedOperationParameters</code></p></td>
         <td style="" align="left" valign="top"><p>Method</p></td>
        </tr>
       </tbody>
      </table> 
     </div>
    </div>
    <br class="table-break" /> 
    <p>The following configuration parameters are available for use on these source-level metadata types:</p> 
    <div class="table">
     <a name="jmx-metadata-parameters"></a>
     <p class="title"><b>Table&nbsp;24.3.&nbsp;Source-Level Metadata Parameters</b></p>
     <div class="table-contents"> 
      <table summary="Source-Level Metadata Parameters" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
       <colgroup>
        <col />
        <col />
        <col />
       </colgroup>
       <thead>
        <tr>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Parameter</th>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th>
         <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Applies to</th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ObjectName</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Used by <code class="literal">MetadataNamingStrategy</code> to determine the <code class="literal">ObjectName</code> of a managed resource</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ManagedResource</code></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">description</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Sets the friendly description of the resource, attribute or operation</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ManagedResource</code>, <code class="literal">ManagedAttribute</code>, <code class="literal">ManagedOperation</code>, <code class="literal">ManagedOperationParameter</code></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">currencyTimeLimit</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Sets the value of the <code class="literal">currencyTimeLimit</code> descriptor field</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ManagedResource</code>, <code class="literal">ManagedAttribute</code></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">defaultValue</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Sets the value of the <code class="literal">defaultValue</code> descriptor field</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ManagedAttribute</code></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">log</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Sets the value of the <code class="literal">log</code> descriptor field</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ManagedResource</code></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">logFile</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Sets the value of the <code class="literal">logFile</code> descriptor field</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ManagedResource</code></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">persistPolicy</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Sets the value of the <code class="literal">persistPolicy</code> descriptor field</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ManagedResource</code></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">persistPeriod</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Sets the value of the <code class="literal">persistPeriod</code> descriptor field</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ManagedResource</code></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">persistLocation</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Sets the value of the <code class="literal">persistLocation</code> descriptor field</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ManagedResource</code></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">persistName</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Sets the value of the <code class="literal">persistName</code> descriptor field</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ManagedResource</code></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">name</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Sets the display name of an operation parameter</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ManagedOperationParameter</code></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">index</code></p></td>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Sets the index of an operation parameter</p></td>
         <td style="" align="left" valign="top"><p><code class="literal">ManagedOperationParameter</code></p></td>
        </tr>
       </tbody>
      </table> 
     </div>
    </div>
    <br class="table-break" /> 
   </div> 
   <div class="section" title="24.3.4&nbsp;the AutodetectCapableMBeanInfoAssembler interface">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jmx-interface-autodetect"></a>24.3.4&nbsp;the AutodetectCapableMBeanInfoAssembler interface</h3>
      </div>
     </div>
    </div> 
    <p>To simplify configuration even further, Spring introduces the <code class="literal">AutodetectCapableMBeanInfoAssembler</code> interface which extends the <code class="literal">MBeanInfoAssembler</code> interface to add support for autodetection of MBean resources. If you configure the <code class="literal">MBeanExporter</code> with an instance of <code class="literal">AutodetectCapableMBeanInfoAssembler</code> then it is allowed to &quot;vote&quot; on the inclusion of beans for exposure to JMX.</p> 
    <p>Out of the box, the only implementation of the <code class="literal">AutodetectCapableMBeanInfo</code> interface is the <code class="literal">MetadataMBeanInfoAssembler</code> which will vote to include any bean which is marked with the <code class="literal">ManagedResource</code> attribute. The default approach in this case is to use the bean name as the <code class="literal">ObjectName</code> which results in a configuration like this:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exporter&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.MBeanExporter&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- notice how no </span><span class="emphasis"><em>beans</em></span> are explicitly configured here --&gt;
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;autodetect&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;true&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;assembler&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;assembler&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;testBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.JmxTestBean&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;TEST&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;age&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;100&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;assembler&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.assembler.MetadataMBeanInfoAssembler&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;attributeSource&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.annotation.AnnotationJmxAttributeSource&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>Notice that in this configuration no beans are passed to the <code class="literal">MBeanExporter</code>; however, the <code class="literal">JmxTestBean</code> will still be registered since it is marked with the <code class="literal">ManagedResource</code> attribute and the <code class="literal">MetadataMBeanInfoAssembler</code> detects this and votes to include it. The only problem with this approach is that the name of the <code class="literal">JmxTestBean</code> now has business meaning. You can address this issue by changing the default behavior for <code class="literal">ObjectName</code> creation as defined in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#jmx-naming" title="24.4&nbsp;Controlling the ObjectNames for your beans">Section&nbsp;24.4, Controlling the ObjectNames for your beans</a>.</p> 
   </div> 
   <div class="section" title="24.3.5&nbsp;Defining management interfaces using Java interfaces">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jmx-interface-java"></a>24.3.5&nbsp;Defining management interfaces using Java interfaces</h3>
      </div>
     </div>
    </div> 
    <p>In addition to the <code class="literal">MetadataMBeanInfoAssembler</code>, Spring also includes the <code class="literal">InterfaceBasedMBeanInfoAssembler</code> which allows you to constrain the methods and properties that are exposed based on the set of methods defined in a collection of interfaces.</p> 
    <p>Although the standard mechanism for exposing MBeans is to use interfaces and a simple naming scheme, the <code class="literal">InterfaceBasedMBeanInfoAssembler</code> extends this functionality by removing the need for naming conventions, allowing you to use more than one interface and removing the need for your beans to implement the MBean interfaces.</p> 
    <p>Consider this interface that is used to define a management interface for the <code class="literal">JmxTestBean</code> class that you saw earlier:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> IJmxTestBean {

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> add(<span class="hl-keyword">int</span> x, <span class="hl-keyword">int</span> y);

    <span class="hl-keyword">public</span> <span class="hl-keyword">long</span> myOperation();

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getAge();

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setAge(<span class="hl-keyword">int</span> age);

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(String name);

    <span class="hl-keyword">public</span> String getName();

}</pre> 
    <p>This interface defines the methods and properties that will be exposed as operations and attributes on the JMX MBean. The code below shows how to configure Spring JMX to use this interface as the definition for the management interface:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exporter&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.MBeanExporter&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;beans&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;map&gt;</span>
                <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;bean:name=testBean5&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;testBean&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/map&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;assembler&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.assembler.InterfaceBasedMBeanInfoAssembler&quot;</span><span class="hl-tag">&gt;</span>
                <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;managedInterfaces&quot;</span><span class="hl-tag">&gt;</span>
                    <span class="hl-tag">&lt;value&gt;</span>org.springframework.jmx.IJmxTestBean<span class="hl-tag">&lt;/value&gt;</span>
                <span class="hl-tag">&lt;/property&gt;</span>
            <span class="hl-tag">&lt;/bean&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;testBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.JmxTestBean&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;TEST&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;age&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;100&quot;</span><span class="hl-tag">/&gt;</span>
      <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>Here you can see that the <code class="literal">InterfaceBasedMBeanInfoAssembler</code> is configured to use the <code class="literal">IJmxTestBean</code> interface when constructing the management interface for any bean. It is important to understand that beans processed by the <code class="literal">InterfaceBasedMBeanInfoAssembler</code> are <span class="emphasis"><em>not</em></span> required to implement the interface used to generate the JMX management interface.</p> 
    <p>In the case above, the <code class="literal">IJmxTestBean</code> interface is used to construct all management interfaces for all beans. In many cases this is not the desired behavior and you may want to use different interfaces for different beans. In this case, you can pass <code class="literal">InterfaceBasedMBeanInfoAssembler</code> a <code class="literal">Properties</code> instance via the <code class="literal">interfaceMappings</code> property, where the key of each entry is the bean name and the value of each entry is a comma-separated list of interface names to use for that bean.</p> 
    <p>If no management interface is specified through either the <code class="literal">managedInterfaces</code> or <code class="literal">interfaceMappings</code> properties, then the <code class="literal">InterfaceBasedMBeanInfoAssembler</code> will reflect on the bean and use all of the interfaces implemented by that bean to create the management interface.</p> 
   </div> 
   <div class="section" title="24.3.6&nbsp;Using MethodNameBasedMBeanInfoAssembler">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jmx-interface-methodnames"></a>24.3.6&nbsp;Using MethodNameBasedMBeanInfoAssembler</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">MethodNameBasedMBeanInfoAssembler</code> allows you to specify a list of method names that will be exposed to JMX as attributes and operations. The code below shows a sample configuration for this:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exporter&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.MBeanExporter&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;beans&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;map&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;bean:name=testBean5&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;testBean&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/map&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;assembler&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.assembler.MethodNameBasedMBeanInfoAssembler&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;managedMethods&quot;</span><span class="hl-tag">&gt;</span>
                <span class="hl-tag">&lt;value&gt;</span>add,myOperation,getName,setName,getAge<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;/property&gt;</span>
        <span class="hl-tag">&lt;/bean&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>Here you can see that the methods <code class="literal">add</code> and <code class="literal">myOperation</code> will be exposed as JMX operations and <code class="literal">getName()</code>, <code class="literal">setName(String)</code> and <code class="literal">getAge()</code> will be exposed as the appropriate half of a JMX attribute. In the code above, the method mappings apply to beans that are exposed to JMX. To control method exposure on a bean-by-bean basis, use the <code class="literal">methodMappings</code> property of <code class="literal">MethodNameMBeanInfoAssembler</code> to map bean names to lists of method names.</p> 
   </div> 
  </div> 
  <div class="section" title="24.4&nbsp;Controlling the ObjectNames for your beans">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="jmx-naming"></a>24.4&nbsp;Controlling the ObjectNames for your beans</h2>
     </div>
    </div>
   </div> 
   <p>Behind the scenes, the <code class="literal">MBeanExporter</code> delegates to an implementation of the <code class="literal">ObjectNamingStrategy</code> to obtain <code class="literal">ObjectName</code> s for each of the beans it is registering. The default implementation, <code class="literal">KeyNamingStrategy</code>, will, by default, use the key of the <code class="literal">beans</code> <code class="literal">Map</code> as the <code class="literal">ObjectName</code>. In addition, the <code class="literal">KeyNamingStrategy</code> can map the key of the <code class="literal">beans</code> <code class="literal">Map</code> to an entry in a <code class="literal">Properties</code> file (or files) to resolve the <code class="literal">ObjectName</code>. In addition to the <code class="literal">KeyNamingStrategy</code>, Spring provides two additional <code class="literal">ObjectNamingStrategy</code> implementations: the <code class="literal">IdentityNamingStrategy</code> that builds an <code class="literal">ObjectName</code> based on the JVM identity of the bean and the <code class="literal">MetadataNamingStrategy</code> that uses source level metadata to obtain the <code class="literal">ObjectName</code>.</p> 
   <div class="section" title="24.4.1&nbsp;Reading ObjectNames from Properties">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jmx-naming-properties"></a>24.4.1&nbsp;Reading ObjectNames from Properties</h3>
      </div>
     </div>
    </div> 
    <p>You can configure your own <code class="literal">KeyNamingStrategy</code> instance and configure it to read <code class="literal">ObjectName</code> s from a <code class="literal">Properties</code> instance rather than use bean key. The <code class="literal">KeyNamingStrategy</code> will attempt to locate an entry in the <code class="literal">Properties</code> with a key corresponding to the bean key. If no entry is found or if the <code class="literal">Properties</code> instance is <code class="literal">null</code> then the bean key itself is used.</p> 
    <p>The code below shows a sample configuration for the <code class="literal">KeyNamingStrategy</code>:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exporter&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.MBeanExporter&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;beans&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;map&gt;</span>
                <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;testBean&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;testBean&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/map&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;namingStrategy&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;namingStrategy&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;testBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.JmxTestBean&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;TEST&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;age&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;100&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;namingStrategy&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.naming.KeyNamingStrategy&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;mappings&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;props&gt;</span>
                <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;testBean&quot;</span><span class="hl-tag">&gt;</span>bean:name=testBean1<span class="hl-tag">&lt;/prop&gt;</span>
            <span class="hl-tag">&lt;/props&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;mappingLocations&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>names1.properties,names2.properties<span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>Here an instance of <code class="literal">KeyNamingStrategy</code> is configured with a <code class="literal">Properties</code> instance that is merged from the <code class="literal">Properties</code> instance defined by the mapping property and the properties files located in the paths defined by the mappings property. In this configuration, the <code class="literal">testBean</code> bean will be given the <code class="literal">ObjectName</code> <code class="literal">bean:name=testBean1</code> since this is the entry in the <code class="literal">Properties</code> instance that has a key corresponding to the bean key.</p> 
    <p>If no entry in the <code class="literal">Properties</code> instance can be found then the bean key name is used as the <code class="literal">ObjectName</code>.</p> 
   </div> 
   <div class="section" title="24.4.2&nbsp;Using the MetadataNamingStrategy">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jmx-naming-metadata"></a>24.4.2&nbsp;Using the MetadataNamingStrategy</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">MetadataNamingStrategy</code> uses the <code class="literal">objectName</code> property of the <code class="literal">ManagedResource</code> attribute on each bean to create the <code class="literal">ObjectName</code>. The code below shows the configuration for the <code class="literal">MetadataNamingStrategy</code>:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exporter&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.MBeanExporter&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;beans&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;map&gt;</span>
                <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;testBean&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;testBean&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/map&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;namingStrategy&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;namingStrategy&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;testBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.JmxTestBean&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;TEST&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;age&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;100&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;namingStrategy&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.naming.MetadataNamingStrategy&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;attributeSource&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;attributeSource&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;attributeSource&quot;</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.annotation.AnnotationJmxAttributeSource&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>If no <code class="literal">objectName</code> has been provided for the <code class="literal">ManagedResource</code> attribute, then an <code class="literal">ObjectName</code> will be created with the following format:<span class="emphasis"><em>[fully-qualified-package-name]:type=[short-classname],name=[bean-name]</em></span>. For example, the generated <code class="literal">ObjectName</code> for the following bean would be: <span class="emphasis"><em>com.foo:type=MyClass,name=myBean</em></span>.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.MyClass&quot;</span><span class="hl-tag">/&gt;</span></pre> 
   </div> 
   <div class="section" title="24.4.3&nbsp;Configuring annotation based MBean export">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jmx-context-mbeanexport"></a>24.4.3&nbsp;Configuring annotation based MBean export</h3>
      </div>
     </div>
    </div> 
    <p>If you prefer using <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#jmx-interface-metadata" title="24.3.2&nbsp;Using Source-Level Metadata (JDK 5.0 annotations)">the annotation based approach</a> to define your management interfaces, then a convenience subclass of <code class="literal">MBeanExporter</code> is available: <code class="literal">AnnotationMBeanExporter</code>. When defining an instance of this subclass, the <code class="literal">namingStrategy</code>, <code class="literal">assembler</code>, and <code class="literal">attributeSource</code> configuration is no longer needed, since it will always use standard Java annotation-based metadata (autodetection is always enabled as well). In fact, rather than defining an <code class="literal">MBeanExporter</code> bean, an even simpler syntax is supported by the <code class="literal">@EnableMBeanExport</code> <code class="literal">@Configuration</code> annotation.</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableMBeanExport</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

}</pre> 
    <p>If you prefer XML based configuration the ' <code class="literal">context:mbean-export'</code> element serves the same purpose.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;context:mbean-export/&gt;</span></pre> 
    <p>You can provide a reference to a particular MBean <code class="literal">server</code> if necessary, and the <code class="literal">defaultDomain</code> attribute (a property of <code class="literal">AnnotationMBeanExporter</code>) accepts an alternate value for the generated MBean <code class="literal">ObjectNames</code>' domains. This would be used in place of the fully qualified package name as described in the previous section on <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#jmx-naming-metadata" title="24.4.2&nbsp;Using the MetadataNamingStrategy"><code class="literal">MetadataNamingStrategy</code></a>.</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@EnableMBeanExport(server=&quot;myMBeanServer&quot;, defaultDomain=&quot;myDomain&quot;)</span></i>
<i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
ContextConfiguration {

}</pre> 
    <pre class="programlisting"><span class="hl-tag">&lt;context:mbean-export</span> <span class="hl-attribute">server</span>=<span class="hl-value">&quot;myMBeanServer&quot;</span> <span class="hl-attribute">default-domain</span>=<span class="hl-value">&quot;myDomain&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Do not use interface-based AOP proxies in combination with autodetection of JMX annotations in your bean classes. Interface-based proxies <span class="emphasis"><em>hide</em></span> the target class, which also hides the JMX managed resource annotations. Hence, use target-class proxies in that case: through setting the <span class="emphasis"><em>proxy-target-class</em></span> flag on <code class="literal">&lt;aop:config/&gt;</code>, <code class="literal">&lt;tx:annotation-driven/&gt;</code>, etc. Otherwise, your JMX beans might be silently ignored at startup</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
  </div> 
  <div class="section" title="24.5&nbsp;JSR-160 Connectors">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="jmx-jsr160"></a>24.5&nbsp;JSR-160 Connectors</h2>
     </div>
    </div>
   </div> 
   <p>For remote access, Spring JMX module offers two <code class="literal">FactoryBean</code> implementations inside the <code class="literal">org.springframework.jmx.support</code> package for creating both server- and client-side connectors.</p> 
   <div class="section" title="24.5.1&nbsp;Server-side Connectors">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jmx-jsr160-server"></a>24.5.1&nbsp;Server-side Connectors</h3>
      </div>
     </div>
    </div> 
    <p>To have Spring JMX create, start and expose a JSR-160 <code class="literal">JMXConnectorServer</code> use the following configuration:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;serverConnector&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.support.ConnectorServerFactoryBean&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <p>By default <code class="literal">ConnectorServerFactoryBean</code> creates a <code class="literal">JMXConnectorServer</code> bound to <code class="literal">&quot;service:jmx:jmxmp://localhost:9875&quot;</code>. The <code class="literal">serverConnector</code> bean thus exposes the local <code class="literal">MBeanServer</code> to clients through the JMXMP protocol on localhost, port 9875. Note that the JMXMP protocol is marked as optional by the JSR 160 specification: currently, the main open-source JMX implementation, MX4J, and the one provided with J2SE 5.0 do <span class="emphasis"><em>not</em></span> support JMXMP.</p> 
    <p>To specify another URL and register the <code class="literal">JMXConnectorServer</code> itself with the <code class="literal">MBeanServer</code> use the <code class="literal">serviceUrl</code> and <code class="literal">ObjectName</code> properties respectively:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;serverConnector&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.support.ConnectorServerFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;objectName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;connector:name=rmi&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceUrl&quot;</span>
            <span class="hl-attribute">value</span>=<span class="hl-value">&quot;service:jmx:rmi://localhost/jndi/rmi://localhost:1099/myconnector&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>If the <code class="literal">ObjectName</code> property is set Spring will automatically register your connector with the <code class="literal">MBeanServer</code> under that <code class="literal">ObjectName</code>. The example below shows the full set of parameters which you can pass to the <code class="literal">ConnectorServerFactoryBean</code> when creating a JMXConnector:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;serverConnector&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.support.ConnectorServerFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;objectName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;connector:name=iiop&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceUrl&quot;</span>
        <span class="hl-attribute">value</span>=<span class="hl-value">&quot;service:jmx:iiop://localhost/jndi/iiop://localhost:900/myconnector&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;threaded&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;true&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;daemon&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;true&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;environment&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;map&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;someKey&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;someValue&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/map&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>Note that when using a RMI-based connector you need the lookup service (tnameserv or rmiregistry) to be started in order for the name registration to complete. If you are using Spring to export remote services for you via RMI, then Spring will already have constructed an RMI registry. If not, you can easily start a registry using the following snippet of configuration:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;registry&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.remoting.rmi.RmiRegistryFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;port&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;1099&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   </div> 
   <div class="section" title="24.5.2&nbsp;Client-side Connectors">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jmx-jsr160-client"></a>24.5.2&nbsp;Client-side Connectors</h3>
      </div>
     </div>
    </div> 
    <p>To create an <code class="literal">MBeanServerConnection</code> to a remote JSR-160 enabled <code class="literal">MBeanServer</code> use the <code class="literal">MBeanServerConnectionFactoryBean</code> as shown below:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;clientConnector&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.support.MBeanServerConnectionFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceUrl&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;service:jmx:rmi://localhost/jndi/rmi://localhost:1099/jmxrmi&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   </div> 
   <div class="section" title="24.5.3&nbsp;JMX over Burlap/Hessian/SOAP">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jmx-jsr160-protocols"></a>24.5.3&nbsp;JMX over Burlap/Hessian/SOAP</h3>
      </div>
     </div>
    </div> 
    <p>JSR-160 permits extensions to the way in which communication is done between the client and the server. The examples above are using the mandatory RMI-based implementation required by the JSR-160 specification (IIOP and JRMP) and the (optional) JMXMP. By using other providers or JMX implementations (such as <a class="ulink" href="http://mx4j.sourceforge.net/" target="_top">MX4J</a>) you can take advantage of protocols like SOAP, Hessian, Burlap over simple HTTP or SSL and others:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;serverConnector&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.support.ConnectorServerFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;objectName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;connector:name=burlap&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceUrl&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;service:jmx:burlap://localhost:9874&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>In the case of the above example, MX4J 3.0.0 was used; see the official MX4J documentation for more information.</p> 
   </div> 
  </div> 
  <div class="section" title="24.6&nbsp;Accessing MBeans via Proxies">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="jmx-proxy"></a>24.6&nbsp;Accessing MBeans via Proxies</h2>
     </div>
    </div>
   </div> 
   <p>Spring JMX allows you to create proxies that re-route calls to MBeans registered in a local or remote <code class="literal">MBeanServer</code>. These proxies provide you with a standard Java interface through which you can interact with your MBeans. The code below shows how to configure a proxy for an MBean running in a local <code class="literal">MBeanServer</code>:</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;proxy&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.access.MBeanProxyFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;objectName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;bean:name=testBean&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;proxyInterface&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;org.springframework.jmx.IJmxTestBean&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   <p>Here you can see that a proxy is created for the MBean registered under the <code class="literal">ObjectName</code>: <code class="literal">bean:name=testBean</code>. The set of interfaces that the proxy will implement is controlled by the <code class="literal">proxyInterfaces</code> property and the rules for mapping methods and properties on these interfaces to operations and attributes on the MBean are the same rules used by the <code class="literal">InterfaceBasedMBeanInfoAssembler</code>.</p> 
   <p>The <code class="literal">MBeanProxyFactoryBean</code> can create a proxy to any MBean that is accessible via an <code class="literal">MBeanServerConnection</code>. By default, the local <code class="literal">MBeanServer</code> is located and used, but you can override this and provide an <code class="literal">MBeanServerConnection</code> pointing to a remote <code class="literal">MBeanServer</code> to cater for proxies pointing to remote MBeans:</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;clientConnector&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.support.MBeanServerConnectionFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serviceUrl&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;service:jmx:rmi://remotehost:9875&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;proxy&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.access.MBeanProxyFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;objectName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;bean:name=testBean&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;proxyInterface&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;org.springframework.jmx.IJmxTestBean&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;server&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;clientConnector&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   <p>Here you can see that we create an <code class="literal">MBeanServerConnection</code> pointing to a remote machine using the <code class="literal">MBeanServerConnectionFactoryBean</code>. This <code class="literal">MBeanServerConnection</code> is then passed to the <code class="literal">MBeanProxyFactoryBean</code> via the <code class="literal">server</code> property. The proxy that is created will forward all invocations to the <code class="literal">MBeanServer</code> via this <code class="literal">MBeanServerConnection</code>.</p> 
  </div> 
  <div class="section" title="24.7&nbsp;Notifications">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="jmx-notifications"></a>24.7&nbsp;Notifications</h2>
     </div>
    </div>
   </div> 
   <p>Springs JMX offering includes comprehensive support for JMX notifications.</p> 
   <div class="section" title="24.7.1&nbsp;Registering Listeners for Notifications">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jmx-notifications-listeners"></a>24.7.1&nbsp;Registering Listeners for Notifications</h3>
      </div>
     </div>
    </div> 
    <p>Springs JMX support makes it very easy to register any number of <code class="literal">NotificationListeners</code> with any number of MBeans (this includes MBeans exported by Springs <code class="literal">MBeanExporter</code> and MBeans registered via some other mechanism). By way of an example, consider the scenario where one would like to be informed (via a <code class="literal">Notification</code>) each and every time an attribute of a target MBean changes.</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> com.example;

<span class="hl-keyword">import</span> javax.management.AttributeChangeNotification;
<span class="hl-keyword">import</span> javax.management.Notification;
<span class="hl-keyword">import</span> javax.management.NotificationFilter;
<span class="hl-keyword">import</span> javax.management.NotificationListener;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ConsoleLoggingNotificationListener
        <span class="hl-keyword">implements</span> NotificationListener, NotificationFilter {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> handleNotification(Notification notification, Object handback) {
        System.out.println(notification);
        System.out.println(handback);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> isNotificationEnabled(Notification notification) {
        <span class="hl-keyword">return</span> AttributeChangeNotification.<span class="hl-keyword">class</span>.isAssignableFrom(notification.getClass());
    }

}</pre> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exporter&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.MBeanExporter&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;beans&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;map&gt;</span>
                <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;bean:name=testBean1&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;testBean&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/map&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;notificationListenerMappings&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;map&gt;</span>
                <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;bean:name=testBean1&quot;</span><span class="hl-tag">&gt;</span>
                    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.example.ConsoleLoggingNotificationListener&quot;</span><span class="hl-tag">/&gt;</span>
                <span class="hl-tag">&lt;/entry&gt;</span>
            <span class="hl-tag">&lt;/map&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;testBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.JmxTestBean&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;TEST&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;age&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;100&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>With the above configuration in place, every time a JMX <code class="literal">Notification</code> is broadcast from the target MBean ( <code class="literal">bean:name=testBean1</code>), the <code class="literal">ConsoleLoggingNotificationListener</code> bean that was registered as a listener via the <code class="literal">notificationListenerMappings</code> property will be notified. The <code class="literal">ConsoleLoggingNotificationListener</code> bean can then take whatever action it deems appropriate in response to the <code class="literal">Notification</code>.</p> 
    <p>You can also use straight bean names as the link between exported beans and listeners:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exporter&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.MBeanExporter&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;beans&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;map&gt;</span>
                <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;bean:name=testBean1&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;testBean&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/map&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;notificationListenerMappings&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;map&gt;</span>
                <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;</span><span class="emphasis"><em>testBean</em></span>&quot;&gt;
                    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.example.ConsoleLoggingNotificationListener&quot;</span><span class="hl-tag">/&gt;</span>
                <span class="hl-tag">&lt;/entry&gt;</span>
            <span class="hl-tag">&lt;/map&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;</span><span class="emphasis"><em>testBean</em></span>&quot; class=&quot;org.springframework.jmx.JmxTestBean&quot;&gt;
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;TEST&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;age&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;100&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>If one wants to register a single <code class="literal">NotificationListener</code> instance for all of the beans that the enclosing <code class="literal">MBeanExporter</code> is exporting, one can use the special wildcard <code class="literal">'*'</code> (sans quotes) as the key for an entry in the <code class="literal">notificationListenerMappings</code> property map; for example:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;notificationListenerMappings&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;map&gt;</span>
        <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;*&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.example.ConsoleLoggingNotificationListener&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/entry&gt;</span>
    <span class="hl-tag">&lt;/map&gt;</span>
<span class="hl-tag">&lt;/property&gt;</span></pre> 
    <p>If one needs to do the inverse (that is, register a number of distinct listeners against an MBean), then one has to use the <code class="literal">notificationListeners</code> list property instead (and in preference to the <code class="literal">notificationListenerMappings</code> property). This time, instead of configuring simply a <code class="literal">NotificationListener</code> for a single MBean, one configures <code class="literal">NotificationListenerBean</code> instances a <code class="literal">NotificationListenerBean</code> encapsulates a <code class="literal">NotificationListener</code> and the <code class="literal">ObjectName</code> (or <code class="literal">ObjectNames</code>) that it is to be registered against in an <code class="literal">MBeanServer</code>. The <code class="literal">NotificationListenerBean</code> also encapsulates a number of other properties such as a <code class="literal">NotificationFilter</code> and an arbitrary handback object that can be used in advanced JMX notification scenarios.</p> 
    <p>The configuration when using <code class="literal">NotificationListenerBean</code> instances is not wildly different to what was presented previously:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exporter&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.MBeanExporter&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;beans&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;map&gt;</span>
                <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;bean:name=testBean1&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;testBean&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/map&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;notificationListeners&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;list&gt;</span>
                <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.NotificationListenerBean&quot;</span><span class="hl-tag">&gt;</span>
                    <span class="hl-tag">&lt;constructor-arg&gt;</span>
                        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.example.ConsoleLoggingNotificationListener&quot;</span><span class="hl-tag">/&gt;</span>
                    <span class="hl-tag">&lt;/constructor-arg&gt;</span>
                    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;mappedObjectNames&quot;</span><span class="hl-tag">&gt;</span>
                        <span class="hl-tag">&lt;list&gt;</span>
                            <span class="hl-tag">&lt;value&gt;</span>bean:name=testBean1<span class="hl-tag">&lt;/value&gt;</span>
                        <span class="hl-tag">&lt;/list&gt;</span>
                    <span class="hl-tag">&lt;/property&gt;</span>
                <span class="hl-tag">&lt;/bean&gt;</span>
            <span class="hl-tag">&lt;/list&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;testBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.JmxTestBean&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;TEST&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;age&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;100&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>The above example is equivalent to the first notification example. Lets assume then that we want to be given a handback object every time a <code class="literal">Notification</code> is raised, and that additionally we want to filter out extraneous <code class="literal">Notifications</code> by supplying a <code class="literal">NotificationFilter</code>. (For a full discussion of just what a handback object is, and indeed what a <code class="literal">NotificationFilter</code> is, please do consult that section of the JMX specification (1.2) entitled <span class="emphasis"><em>The JMX Notification Model</em></span>.)</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exporter&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.MBeanExporter&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;beans&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;map&gt;</span>
                <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;bean:name=testBean1&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;testBean1&quot;</span><span class="hl-tag">/&gt;</span>
                <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;bean:name=testBean2&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;testBean2&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/map&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;notificationListeners&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;list&gt;</span>
                <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.export.NotificationListenerBean&quot;</span><span class="hl-tag">&gt;</span>
                    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;customerNotificationListener&quot;</span><span class="hl-tag">/&gt;</span>
                    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;mappedObjectNames&quot;</span><span class="hl-tag">&gt;</span>
                        <span class="hl-tag">&lt;list&gt;</span>
                            <span class="hl-comment">&lt;!-- handles notifications from two distinct MBeans --&gt;</span>
                            <span class="hl-tag">&lt;value&gt;</span>bean:name=testBean1<span class="hl-tag">&lt;/value&gt;</span>
                            <span class="hl-tag">&lt;value&gt;</span>bean:name=testBean2<span class="hl-tag">&lt;/value&gt;</span>
                        <span class="hl-tag">&lt;/list&gt;</span>
                    <span class="hl-tag">&lt;/property&gt;</span>
                    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;handback&quot;</span><span class="hl-tag">&gt;</span>
                        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;java.lang.String&quot;</span><span class="hl-tag">&gt;</span>
                            <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;This could be anything...&quot;</span><span class="hl-tag">/&gt;</span>
                        <span class="hl-tag">&lt;/bean&gt;</span>
                    <span class="hl-tag">&lt;/property&gt;</span>
                    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;notificationFilter&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;customerNotificationListener&quot;</span><span class="hl-tag">/&gt;</span>
                <span class="hl-tag">&lt;/bean&gt;</span>
            <span class="hl-tag">&lt;/list&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- implements both the NotificationListener and NotificationFilter interfaces --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;customerNotificationListener&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.example.ConsoleLoggingNotificationListener&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;testBean1&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.JmxTestBean&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;TEST&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;age&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;100&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;testBean2&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jmx.JmxTestBean&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;ANOTHER TEST&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;age&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;200&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
   </div> 
   <div class="section" title="24.7.2&nbsp;Publishing Notifications">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="jmx-notifications-publishing"></a>24.7.2&nbsp;Publishing Notifications</h3>
      </div>
     </div>
    </div> 
    <p>Spring provides support not just for registering to receive <code class="literal">Notifications</code>, but also for publishing <code class="literal">Notifications</code>.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Please note that this section is really only relevant to Spring managed beans that have been exposed as MBeans via an <code class="literal">MBeanExporter</code>; any existing, user-defined MBeans should use the standard JMX APIs for notification publication.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>The key interface in Springs JMX notification publication support is the <code class="literal">NotificationPublisher</code> interface (defined in the <code class="literal">org.springframework.jmx.export.notification</code> package). Any bean that is going to be exported as an MBean via an <code class="literal">MBeanExporter</code> instance can implement the related <code class="literal">NotificationPublisherAware</code> interface to gain access to a <code class="literal">NotificationPublisher</code> instance. The <code class="literal">NotificationPublisherAware</code> interface simply supplies an instance of a <code class="literal">NotificationPublisher</code> to the implementing bean via a simple setter method, which the bean can then use to publish <code class="literal">Notifications</code>.</p> 
    <p>As stated in the Javadoc for the <code class="literal">NotificationPublisher</code> class, managed beans that are publishing events via the <code class="literal">NotificationPublisher</code> mechanism are <span class="emphasis"><em>not</em></span> responsible for the state management of any notification listeners and the like  Springs JMX support will take care of handling all the JMX infrastructure issues. All one need do as an application developer is implement the <code class="literal">NotificationPublisherAware</code> interface and start publishing events using the supplied <code class="literal">NotificationPublisher</code> instance. Note that the <code class="literal">NotificationPublisher</code> will be set <span class="emphasis"><em>after</em></span> the managed bean has been registered with an <code class="literal">MBeanServer</code>.</p> 
    <p>Using a <code class="literal">NotificationPublisher</code> instance is quite straightforward one simply creates a JMX <code class="literal">Notification</code> instance (or an instance of an appropriate <code class="literal">Notification</code> subclass), populates the notification with the data pertinent to the event that is to be published, and one then invokes the <code class="literal">sendNotification(Notification)</code> on the <code class="literal">NotificationPublisher</code> instance, passing in the <code class="literal">Notification</code>.</p> 
    <p>Find below a simple example in this scenario, exported instances of the <code class="literal">JmxTestBean</code> are going to publish a <code class="literal">NotificationEvent</code> every time the <code class="literal">add(int, int)</code> operation is invoked.</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.jmx;

<span class="hl-keyword">import</span> org.springframework.jmx.export.notification.NotificationPublisherAware;
<span class="hl-keyword">import</span> org.springframework.jmx.export.notification.NotificationPublisher;
<span class="hl-keyword">import</span> javax.management.Notification;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JmxTestBean <span class="hl-keyword">implements</span> IJmxTestBean, NotificationPublisherAware {

    <span class="hl-keyword">private</span> String name;
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> age;
    <span class="hl-keyword">private</span> <span class="hl-keyword">boolean</span> isSuperman;
    <span class="hl-keyword">private</span> NotificationPublisher publisher;

    <span class="hl-comment">// other getters and setters omitted for clarity</span>

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> add(<span class="hl-keyword">int</span> x, <span class="hl-keyword">int</span> y) {
        <span class="hl-keyword">int</span> answer = x + y;
        <span class="hl-keyword">this</span>.publisher.sendNotification(<span class="hl-keyword">new</span> Notification(<span class="hl-string">&quot;add&quot;</span>, <span class="hl-keyword">this</span>, <span class="hl-number">0</span>));
        <span class="hl-keyword">return</span> answer;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> dontExposeMe() {
        <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> RuntimeException();
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setNotificationPublisher(NotificationPublisher notificationPublisher) {
        <span class="hl-keyword">this</span>.publisher = notificationPublisher;
    }

}</pre> 
    <p>The <code class="literal">NotificationPublisher</code> interface and the machinery to get it all working is one of the nicer features of Springs JMX support. It does however come with the price tag of coupling your classes to both Spring and JMX; as always, the advice here is to be pragmatic if you need the functionality offered by the <code class="literal">NotificationPublisher</code> and you can accept the coupling to both Spring and JMX, then do so.</p> 
   </div> 
  </div> 
  <div class="section" title="24.8&nbsp;Further Resources">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="jmx-resources"></a>24.8&nbsp;Further Resources</h2>
     </div>
    </div>
   </div> 
   <p>This section contains links to further resources about JMX.</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem"> The <a class="ulink" href="http://www.oracle.com/technetwork/java/javase/tech/javamanagement-140525.html" target="_top">JMX homepage</a> at Oracle </li>
     <li class="listitem"> The <a class="ulink" href="http://jcp.org/aboutJava/communityprocess/final/jsr003/index3.html" target="_top">JMX specification</a> (JSR-000003) </li>
     <li class="listitem"> The <a class="ulink" href="http://jcp.org/aboutJava/communityprocess/final/jsr160/index.html" target="_top">JMX Remote API specification</a> (JSR-000160) </li>
     <li class="listitem"> The <a class="ulink" href="http://mx4j.sourceforge.net/" target="_top">MX4J homepage</a> (an Open Source implementation of various JMX specs) </li>
    </ul>
   </div> 
  </div> 
 </div> 
 <div class="chapter" title="25.&nbsp;JCA CCI">
  <div class="titlepage">
   <div>
    <div>
     <h2 class="title"><a name="cci"></a>25.&nbsp;JCA CCI</h2>
    </div>
   </div>
  </div> 
  <div class="section" title="25.1&nbsp;Introduction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="cci-introduction"></a>25.1&nbsp;Introduction</h2>
     </div>
    </div>
   </div> 
   <p>Java EE provides a specification to standardize access to enterprise information systems (EIS): the JCA (J2EE Connector Architecture). This specification is divided into several different parts:</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem"> SPI (Service provider interfaces) that the connector provider must implement. These interfaces constitute a resource adapter which can be deployed on a Java EE application server. In such a scenario, the server manages connection pooling, transaction and security (managed mode). The application server is also responsible for managing the configuration, which is held outside the client application. A connector can be used without an application server as well; in this case, the application must configure it directly (non-managed mode). </li>
     <li class="listitem"> CCI (Common Client Interface) that an application can use to interact with the connector and thus communicate with an EIS. An API for local transaction demarcation is provided as well. </li>
    </ul>
   </div> 
   <p>The aim of the Spring CCI support is to provide classes to access a CCI connector in typical Spring style, leveraging the Spring Frameworks general resource and transaction management facilities.</p> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>The client side of connectors doesnt alway use CCI. Some connectors expose their own APIs, only providing JCA resource adapter to use the system contracts of a Java EE container (connection pooling, global transactions, security). Spring does not offer special support for such connector-specific APIs.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
  </div> 
  <div class="section" title="25.2&nbsp;Configuring CCI">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="cci-config"></a>25.2&nbsp;Configuring CCI</h2>
     </div>
    </div>
   </div> 
   <div class="section" title="25.2.1&nbsp;Connector configuration">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cci-config-connector"></a>25.2.1&nbsp;Connector configuration</h3>
      </div>
     </div>
    </div> 
    <p>The base resource to use JCA CCI is the <code class="literal">ConnectionFactory</code> interface. The connector used must provide an implementation of this interface.</p> 
    <p>To use your connector, you can deploy it on your application server and fetch the <code class="literal">ConnectionFactory</code> from the servers JNDI environment (managed mode). The connector must be packaged as a RAR file (resource adapter archive) and contain a <code class="literal">ra.xml</code> file to describe its deployment characteristics. The actual name of the resource is specified when you deploy it. To access it within Spring, simply use Springs <code class="literal">JndiObjectFactoryBean</code> / <code class="literal">&lt;jee:jndi-lookup&gt;</code> fetch the factory by its JNDI name.</p> 
    <p>Another way to use a connector is to embed it in your application (non-managed mode), not using an application server to deploy and configure it. Spring offers the possibility to configure a connector as a bean, through a provided <code class="literal">FactoryBean</code> ( <code class="literal">LocalConnectionFactoryBean</code>). In this manner, you only need the connector library in the classpath (no RAR file and no <code class="literal">ra.xml</code> descriptor needed). The library must be extracted from the connectors RAR file, if necessary.</p> 
    <p>Once you have got access to your <code class="literal">ConnectionFactory</code> instance, you can inject it into your components. These components can either be coded against the plain CCI API or leverage Springs support classes for CCI access (e.g. <code class="literal">CciTemplate</code>).</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>When you use a connector in non-managed mode, you cant use global transactions because the resource is never enlisted / delisted in the current global transaction of the current thread. The resource is simply not aware of any global Java EE transactions that might be running.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="25.2.2&nbsp;ConnectionFactory configuration in Spring">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cci-config-connectionfactory"></a>25.2.2&nbsp;ConnectionFactory configuration in Spring</h3>
      </div>
     </div>
    </div> 
    <p>In order to make connections to the EIS, you need to obtain a <code class="literal">ConnectionFactory</code> from the application server if you are in a managed mode, or directly from Spring if you are in a non-managed mode.</p> 
    <p>In a managed mode, you access a <code class="literal">ConnectionFactory</code> from JNDI; its properties will be configured in the application server.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;eciConnectionFactory&quot;</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">&quot;eis/cicseci&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <p>In non-managed mode, you must configure the <code class="literal">ConnectionFactory</code> you want to use in the configuration of Spring as a JavaBean. The <code class="literal">LocalConnectionFactoryBean</code> class offers this setup style, passing in the <code class="literal">ManagedConnectionFactory</code> implementation of your connector, exposing the application-level CCI <code class="literal">ConnectionFactory</code>.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;eciManagedConnectionFactory&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.ibm.connector2.cics.ECIManagedConnectionFactory&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serverName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;TXSERIES&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionURL&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;tcp://localhost/&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;portNumber&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;2006&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;eciConnectionFactory&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jca.support.LocalConnectionFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;managedConnectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;eciManagedConnectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>You cant directly instantiate a specific <code class="literal">ConnectionFactory</code>. You need to go through the corresponding implementation of the <code class="literal">ManagedConnectionFactory</code> interface for your connector. This interface is part of the JCA SPI specification.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="25.2.3&nbsp;Configuring CCI connections">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cci-config-cci-connections"></a>25.2.3&nbsp;Configuring CCI connections</h3>
      </div>
     </div>
    </div> 
    <p>JCA CCI allow the developer to configure the connections to the EIS using the <code class="literal">ConnectionSpec</code> implementation of your connector. In order to configure its properties, you need to wrap the target connection factory with a dedicated adapter, <code class="literal">ConnectionSpecConnectionFactoryAdapter</code>. So, the dedicated <code class="literal">ConnectionSpec</code> can be configured with the property <code class="literal">connectionSpec</code> (as an inner bean).</p> 
    <p>This property is not mandatory because the CCI <code class="literal">ConnectionFactory</code> interface defines two different methods to obtain a CCI connection. Some of the <code class="literal">ConnectionSpec</code> properties can often be configured in the application server (in managed mode) or on the corresponding local <code class="literal">ManagedConnectionFactory</code> implementation.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ConnectionFactory <span class="hl-keyword">implements</span> Serializable, Referenceable {
    ...
    Connection getConnection() <span class="hl-keyword">throws</span> ResourceException;
    Connection getConnection(ConnectionSpec connectionSpec) <span class="hl-keyword">throws</span> ResourceException;
    ...
}</pre> 
    <p>Spring provides a <code class="literal">ConnectionSpecConnectionFactoryAdapter</code> that allows for specifying a <code class="literal">ConnectionSpec</code> instance to use for all operations on a given factory. If the adapters <code class="literal">connectionSpec</code> property is specified, the adapter uses the <code class="literal">getConnection</code> variant with the <code class="literal">ConnectionSpec</code> argument, otherwise the variant without argument.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;managedConnectionFactory&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.sun.connector.cciblackbox.CciLocalTxManagedConnectionFactory&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionURL&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;jdbc:hsqldb:hsql://localhost:9001&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;driverName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;org.hsqldb.jdbcDriver&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;targetConnectionFactory&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jca.support.LocalConnectionFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;managedConnectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;managedConnectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;connectionFactory&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jca.cci.connection.ConnectionSpecConnectionFactoryAdapter&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;targetConnectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;targetConnectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionSpec&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.sun.connector.cciblackbox.CciConnectionSpec&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;user&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;sa&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;password&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/bean&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   </div> 
   <div class="section" title="25.2.4&nbsp;Using a single CCI connection">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cci-config-single-connection"></a>25.2.4&nbsp;Using a single CCI connection</h3>
      </div>
     </div>
    </div> 
    <p>If you want to use a single CCI connection, Spring provides a further <code class="literal">ConnectionFactory</code> adapter to manage this. The <code class="literal">SingleConnectionFactory</code> adapter class will open a single connection lazily and close it when this bean is destroyed at application shutdown. This class will expose special <code class="literal">Connection</code> proxies that behave accordingly, all sharing the same underlying physical connection.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;eciManagedConnectionFactory&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.ibm.connector2.cics.ECIManagedConnectionFactory&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serverName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;TEST&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionURL&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;tcp://localhost/&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;portNumber&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;2006&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;targetEciConnectionFactory&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jca.support.LocalConnectionFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;managedConnectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;eciManagedConnectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;eciConnectionFactory&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jca.cci.connection.SingleConnectionFactory&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;targetConnectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;targetEciConnectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>This <code class="literal">ConnectionFactory</code> adapter cannot directly be configured with a <code class="literal">ConnectionSpec</code>. Use an intermediary <code class="literal">ConnectionSpecConnectionFactoryAdapter</code> that the <code class="literal">SingleConnectionFactory</code> talks to if you require a single connection for a specific <code class="literal">ConnectionSpec</code>.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
  </div> 
  <div class="section" title="25.3&nbsp;Using Springs CCI access support">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="cci-using"></a>25.3&nbsp;Using Springs CCI access support</h2>
     </div>
    </div>
   </div> 
   <div class="section" title="25.3.1&nbsp;Record conversion">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cci-record-creator"></a>25.3.1&nbsp;Record conversion</h3>
      </div>
     </div>
    </div> 
    <p>One of the aims of the JCA CCI support is to provide convenient facilities for manipulating CCI records. The developer can specify the strategy to create records and extract datas from records, for use with Springs <code class="literal">CciTemplate</code>. The following interfaces will configure the strategy to use input and output records if you dont want to work with records directly in your application.</p> 
    <p>In order to create an input <code class="literal">Record</code>, the developer can use a dedicated implementation of the <code class="literal">RecordCreator</code> interface.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> RecordCreator {

    Record createRecord(RecordFactory recordFactory) <span class="hl-keyword">throws</span> ResourceException, DataAccessException;

}</pre> 
    <p>As you can see, the <code class="literal">createRecord(..)</code> method receives a <code class="literal">RecordFactory</code> instance as parameter, which corresponds to the <code class="literal">RecordFactory</code> of the <code class="literal">ConnectionFactory</code> used. This reference can be used to create <code class="literal">IndexedRecord</code> or <code class="literal">MappedRecord</code> instances. The following sample shows how to use the <code class="literal">RecordCreator</code> interface and indexed/mapped records.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyRecordCreator <span class="hl-keyword">implements</span> RecordCreator {

    <span class="hl-keyword">public</span> Record createRecord(RecordFactory recordFactory) <span class="hl-keyword">throws</span> ResourceException {
        IndexedRecord input = recordFactory.createIndexedRecord(<span class="hl-string">&quot;input&quot;</span>);
        input.add(<span class="hl-keyword">new</span> Integer(id));
        <span class="hl-keyword">return</span> input;
    }

}</pre> 
    <p>An output <code class="literal">Record</code> can be used to receive data back from the EIS. Hence, a specific implementation of the <code class="literal">RecordExtractor</code> interface can be passed to Springs <code class="literal">CciTemplate</code> for extracting data from the output <code class="literal">Record</code>.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> RecordExtractor {

    Object extractData(Record record) <span class="hl-keyword">throws</span> ResourceException, SQLException, DataAccessException;

}</pre> 
    <p>The following sample shows how to use the <code class="literal">RecordExtractor</code> interface.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyRecordExtractor <span class="hl-keyword">implements</span> RecordExtractor {

    <span class="hl-keyword">public</span> Object extractData(Record record) <span class="hl-keyword">throws</span> ResourceException {
        CommAreaRecord commAreaRecord = (CommAreaRecord) record;
        String str = <span class="hl-keyword">new</span> String(commAreaRecord.toByteArray());
        String field1 = string.substring(<span class="hl-number">0</span>,<span class="hl-number">6</span>);
        String field2 = string.substring(<span class="hl-number">6</span>,<span class="hl-number">1</span>);
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> OutputObject(Long.parseLong(field1), field2);
    }

}</pre> 
   </div> 
   <div class="section" title="25.3.2&nbsp;the CciTemplate">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cci-using-template"></a>25.3.2&nbsp;the CciTemplate</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">CciTemplate</code> is the central class of the core CCI support package ( <code class="literal">org.springframework.jca.cci.core</code>). It simplifies the use of CCI since it handles the creation and release of resources. This helps to avoid common errors like forgetting to always close the connection. It cares for the lifecycle of connection and interaction objects, letting application code focus on generating input records from application data and extracting application data from output records.</p> 
    <p>The JCA CCI specification defines two distinct methods to call operations on an EIS. The CCI <code class="literal">Interaction</code> interface provides two execute method signatures:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> javax.resource.cci.Interaction {

    ...

    <span class="hl-keyword">boolean</span> execute(InteractionSpec spec, Record input, Record output) <span class="hl-keyword">throws</span> ResourceException;

    Record execute(InteractionSpec spec, Record input) <span class="hl-keyword">throws</span> ResourceException;

    ...

}</pre> 
    <p>Depending on the template method called, <code class="literal">CciTemplate</code> will know which <code class="literal">execute</code> method to call on the interaction. In any case, a correctly initialized <code class="literal">InteractionSpec</code> instance is mandatory.</p> 
    <p><code class="literal">CciTemplate.execute(..)</code> can be used in two ways:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> With direct <code class="literal">Record</code> arguments. In this case, you simply need to pass the CCI input record in, and the returned object be the corresponding CCI output record. </li>
      <li class="listitem"> With application objects, using record mapping. In this case, you need to provide corresponding <code class="literal">RecordCreator</code> and <code class="literal">RecordExtractor</code> instances. </li>
     </ul>
    </div> 
    <p>With the first approach, the following methods of the template will be used. These methods directly correspond to those on the <code class="literal">Interaction</code> interface.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CciTemplate <span class="hl-keyword">implements</span> CciOperations {

    <span class="hl-keyword">public</span> Record execute(InteractionSpec spec, Record inputRecord)
            <span class="hl-keyword">throws</span> DataAccessException { ... }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> execute(InteractionSpec spec, Record inputRecord, Record outputRecord)
            <span class="hl-keyword">throws</span> DataAccessException { ... }

}</pre> 
    <p>With the second approach, we need to specify the record creation and record extraction strategies as arguments. The interfaces used are those describe in the previous section on record conversion. The corresponding <code class="literal">CciTemplate</code> methods are the following:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CciTemplate <span class="hl-keyword">implements</span> CciOperations {

    <span class="hl-keyword">public</span> Record execute(InteractionSpec spec,
            RecordCreator inputCreator) <span class="hl-keyword">throws</span> DataAccessException {
        <span class="hl-comment">// ...</span>
    }

    <span class="hl-keyword">public</span> Object execute(InteractionSpec spec, Record inputRecord,
            RecordExtractor outputExtractor) <span class="hl-keyword">throws</span> DataAccessException {
        <span class="hl-comment">// ...</span>
    }

    <span class="hl-keyword">public</span> Object execute(InteractionSpec spec, RecordCreator creator,
            RecordExtractor extractor) <span class="hl-keyword">throws</span> DataAccessException {
        <span class="hl-comment">// ...</span>
    }

}</pre> 
    <p>Unless the <code class="literal">outputRecordCreator</code> property is set on the template (see the following section), every method will call the corresponding <code class="literal">execute</code> method of the CCI <code class="literal">Interaction</code> with two parameters: <code class="literal">InteractionSpec</code> and input <code class="literal">Record</code>, receiving an output <code class="literal">Record</code> as return value.</p> 
    <p><code class="literal">CciTemplate</code> also provides methods to create <code class="literal">IndexRecord</code> and <code class="literal">MappedRecord</code> outside a <code class="literal">RecordCreator</code> implementation, through its <code class="literal">createIndexRecord(..)</code> and <code class="literal">createMappedRecord(..)</code> methods. This can be used within DAO implementations to create <code class="literal">Record</code> instances to pass into corresponding <code class="literal">CciTemplate.execute(..)</code> methods.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CciTemplate <span class="hl-keyword">implements</span> CciOperations {

    <span class="hl-keyword">public</span> IndexedRecord createIndexedRecord(String name) <span class="hl-keyword">throws</span> DataAccessException { ... }

    <span class="hl-keyword">public</span> MappedRecord createMappedRecord(String name) <span class="hl-keyword">throws</span> DataAccessException { ... }

}</pre> 
   </div> 
   <div class="section" title="25.3.3&nbsp;DAO support">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cci-using-dao"></a>25.3.3&nbsp;DAO support</h3>
      </div>
     </div>
    </div> 
    <p>Springs CCI support provides a abstract class for DAOs, supporting injection of a <code class="literal">ConnectionFactory</code> or a <code class="literal">CciTemplate</code> instances. The name of the class is <code class="literal">CciDaoSupport</code>: It provides simple <code class="literal">setConnectionFactory</code> and <code class="literal">setCciTemplate</code> methods. Internally, this class will create a <code class="literal">CciTemplate</code> instance for a passed-in <code class="literal">ConnectionFactory</code>, exposing it to concrete data access implementations in subclasses.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> CciDaoSupport {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setConnectionFactory(ConnectionFactory connectionFactory) {
        <span class="hl-comment">// ...</span>
    }

    <span class="hl-keyword">public</span> ConnectionFactory getConnectionFactory() {
        <span class="hl-comment">// ...</span>
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setCciTemplate(CciTemplate cciTemplate) {
        <span class="hl-comment">// ...</span>
    }

    <span class="hl-keyword">public</span> CciTemplate getCciTemplate() {
        <span class="hl-comment">// ...</span>
    }

}</pre> 
   </div> 
   <div class="section" title="25.3.4&nbsp;Automatic output record generation">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="automatic-output-generation"></a>25.3.4&nbsp;Automatic output record generation</h3>
      </div>
     </div>
    </div> 
    <p>If the connector used only supports the <code class="literal">Interaction.execute(..)</code> method with input and output records as parameters (that is, it requires the desired output record to be passed in instead of returning an appropriate output record), you can set the <code class="literal">outputRecordCreator</code> property of the <code class="literal">CciTemplate</code> to automatically generate an output record to be filled by the JCA connector when the response is received. This record will be then returned to the caller of the template.</p> 
    <p>This property simply holds an implementation of the <code class="literal">RecordCreator</code> interface, used for that purpose. The <code class="literal">RecordCreator</code> interface has already been discussed in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#cci-record-creator" title="25.3.1&nbsp;Record conversion">Section&nbsp;25.3.1, Record conversion</a>. The <code class="literal">outputRecordCreator</code> property must be directly specified on the <code class="literal">CciTemplate</code>. This could be done in the application code like so:</p> 
    <pre class="programlisting">cciTemplate.setOutputRecordCreator(<span class="hl-keyword">new</span> EciOutputRecordCreator());</pre> 
    <p>Or (recommended) in the Spring configuration, if the <code class="literal">CciTemplate</code> is configured as a dedicated bean instance:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;eciOutputRecordCreator&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;eci.EciOutputRecordCreator&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;cciTemplate&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jca.cci.core.CciTemplate&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;eciConnectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;outputRecordCreator&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;eciOutputRecordCreator&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>As the <code class="literal">CciTemplate</code> class is thread-safe, it will usually be configured as a shared instance.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="25.3.5&nbsp;Summary">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="template-summary"></a>25.3.5&nbsp;Summary</h3>
      </div>
     </div>
    </div> 
    <p>The following table summarizes the mechanisms of the <code class="literal">CciTemplate</code> class and the corresponding methods called on the CCI <code class="literal">Interaction</code> interface:</p> 
    <div class="table">
     <a name="cci-interaction-execute-methods"></a>
     <p class="title"><b>Table&nbsp;25.1.&nbsp;Usage of Interaction execute methods</b></p>
     <div class="table-contents"> 
      <table summary="Usage of Interaction execute methods" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
       <colgroup>
        <col />
        <col />
        <col />
       </colgroup>
       <thead>
        <tr>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">CciTemplate method signature</th>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">CciTemplate outputRecordCreator property</th>
         <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">execute method called on the CCI Interaction</th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Record execute(InteractionSpec, Record)</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>not set</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Record execute(InteractionSpec, Record)</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Record execute(InteractionSpec, Record)</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>set</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>boolean execute(InteractionSpec, Record, Record)</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>void execute(InteractionSpec, Record, Record)</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>not set</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>void execute(InteractionSpec, Record, Record)</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>void execute(InteractionSpec, Record, Record)</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>set</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>void execute(InteractionSpec, Record, Record)</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Record execute(InteractionSpec, RecordCreator)</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>not set</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Record execute(InteractionSpec, Record)</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Record execute(InteractionSpec, RecordCreator)</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>set</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>void execute(InteractionSpec, Record, Record)</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Record execute(InteractionSpec, Record, RecordExtractor)</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>not set</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Record execute(InteractionSpec, Record)</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Record execute(InteractionSpec, Record, RecordExtractor)</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>set</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>void execute(InteractionSpec, Record, Record)</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Record execute(InteractionSpec, RecordCreator, RecordExtractor)</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>not set</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Record execute(InteractionSpec, Record)</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Record execute(InteractionSpec, RecordCreator, RecordExtractor)</p></td>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>set</p></td>
         <td style="" align="left" valign="top"><p>void execute(InteractionSpec, Record, Record)</p></td>
        </tr>
       </tbody>
      </table> 
     </div>
    </div>
    <br class="table-break" /> 
   </div> 
   <div class="section" title="25.3.6&nbsp;Using a CCI Connection and Interaction directly">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cci-straight"></a>25.3.6&nbsp;Using a CCI Connection and Interaction directly</h3>
      </div>
     </div>
    </div> 
    <p><code class="literal">CciTemplate</code> also offers the possibility to work directly with CCI connections and interactions, in the same manner as <code class="literal">JdbcTemplate</code> and <code class="literal">JmsTemplate</code>. This is useful when you want to perform multiple operations on a CCI connection or interaction, for example.</p> 
    <p>The interface <code class="literal">ConnectionCallback</code> provides a CCI <code class="literal">Connection</code> as argument, in order to perform custom operations on it, plus the CCI <code class="literal">ConnectionFactory</code> which the <code class="literal">Connection</code> was created with. The latter can be useful for example to get an associated <code class="literal">RecordFactory</code> instance and create indexed/mapped records, for example.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ConnectionCallback {

    Object doInConnection(Connection connection, ConnectionFactory connectionFactory)
            <span class="hl-keyword">throws</span> ResourceException, SQLException, DataAccessException;

}</pre> 
    <p>The interface <code class="literal">InteractionCallback</code> provides the CCI <code class="literal">Interaction</code>, in order to perform custom operations on it, plus the corresponding CCI <code class="literal">ConnectionFactory</code>.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> InteractionCallback {

    Object doInInteraction(Interaction interaction, ConnectionFactory connectionFactory)
        <span class="hl-keyword">throws</span> ResourceException, SQLException, DataAccessException;

}</pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p><code class="literal">InteractionSpec</code> objects can either be shared across multiple template calls or newly created inside every callback method. This is completely up to the DAO implementation.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="25.3.7&nbsp;Example for CciTemplate usage">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cci-template-example"></a>25.3.7&nbsp;Example for CciTemplate usage</h3>
      </div>
     </div>
    </div> 
    <p>In this section, the usage of the <code class="literal">CciTemplate</code> will be shown to acces to a CICS with ECI mode, with the IBM CICS ECI connector.</p> 
    <p>Firstly, some initializations on the CCI <code class="literal">InteractionSpec</code> must be done to specify which CICS program to access and how to interact with it.</p> 
    <pre class="programlisting">ECIInteractionSpec interactionSpec = <span class="hl-keyword">new</span> ECIInteractionSpec();
interactionSpec.setFunctionName(<span class="hl-string">&quot;MYPROG&quot;</span>);
interactionSpec.setInteractionVerb(ECIInteractionSpec.SYNC_SEND_RECEIVE);</pre> 
    <p>Then the program can use CCI via Springs template and specify mappings between custom objects and CCI <code class="literal">Records</code>.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyDaoImpl <span class="hl-keyword">extends</span> CciDaoSupport <span class="hl-keyword">implements</span> MyDao {

    <span class="hl-keyword">public</span> OutputObject getData(InputObject input) {
        ECIInteractionSpec interactionSpec = ...;

    OutputObject output = (ObjectOutput) getCciTemplate().execute(interactionSpec,
        <span class="hl-keyword">new</span> RecordCreator() {
            <span class="hl-keyword">public</span> Record createRecord(RecordFactory recordFactory) <span class="hl-keyword">throws</span> ResourceException {
                <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> CommAreaRecord(input.toString().getBytes());
            }
        },
        <span class="hl-keyword">new</span> RecordExtractor() {
            <span class="hl-keyword">public</span> Object extractData(Record record) <span class="hl-keyword">throws</span> ResourceException {
                CommAreaRecord commAreaRecord = (CommAreaRecord)record;
                String str = <span class="hl-keyword">new</span> String(commAreaRecord.toByteArray());
                String field1 = string.substring(<span class="hl-number">0</span>,<span class="hl-number">6</span>);
                String field2 = string.substring(<span class="hl-number">6</span>,<span class="hl-number">1</span>);
                <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> OutputObject(Long.parseLong(field1), field2);
            }
        });

        <span class="hl-keyword">return</span> output;
    }
}</pre> 
    <p>As discussed previously, callbacks can be used to work directly on CCI connections or interactions.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyDaoImpl <span class="hl-keyword">extends</span> CciDaoSupport <span class="hl-keyword">implements</span> MyDao {

    <span class="hl-keyword">public</span> OutputObject getData(InputObject input) {
        ObjectOutput output = (ObjectOutput) getCciTemplate().execute(
            <span class="hl-keyword">new</span> ConnectionCallback() {
                <span class="hl-keyword">public</span> Object doInConnection(Connection connection,
                        ConnectionFactory factory) <span class="hl-keyword">throws</span> ResourceException {

                    <span class="hl-comment">// do something...</span>

                }
            });
        }
        <span class="hl-keyword">return</span> output;
    }

}</pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>With a <code class="literal">ConnectionCallback</code>, the <code class="literal">Connection</code> used will be managed and closed by the <code class="literal">CciTemplate</code>, but any interactions created on the connection must be managed by the callback implementation.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>For a more specific callback, you can implement an <code class="literal">InteractionCallback</code>. The passed-in <code class="literal">Interaction</code> will be managed and closed by the <code class="literal">CciTemplate</code> in this case.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyDaoImpl <span class="hl-keyword">extends</span> CciDaoSupport <span class="hl-keyword">implements</span> MyDao {

    <span class="hl-keyword">public</span> String getData(String input) {
        ECIInteractionSpec interactionSpec = ...;
        String output = (String) getCciTemplate().execute(interactionSpec,
            <span class="hl-keyword">new</span> InteractionCallback() {
                <span class="hl-keyword">public</span> Object doInInteraction(Interaction interaction,
                        ConnectionFactory factory) <span class="hl-keyword">throws</span> ResourceException {
                    Record input = <span class="hl-keyword">new</span> CommAreaRecord(inputString.getBytes());
                    Record output = <span class="hl-keyword">new</span> CommAreaRecord();
                    interaction.execute(holder.getInteractionSpec(), input, output);
                    <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> String(output.toByteArray());
                }
            });
        <span class="hl-keyword">return</span> output;
    }

}</pre> 
    <p>For the examples above, the corresponding configuration of the involved Spring beans could look like this in non-managed mode:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;managedConnectionFactory&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.ibm.connector2.cics.ECIManagedConnectionFactory&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serverName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;TXSERIES&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionURL&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;local:&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;userName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;CICSUSER&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;password&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;CICS&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;connectionFactory&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jca.support.LocalConnectionFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;managedConnectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;managedConnectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;component&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;mypackage.MyDaoImpl&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;connectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>In managed mode (that is, in a Java EE environment), the configuration could look as follows:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;connectionFactory&quot;</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">&quot;eis/cicseci&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;component&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;MyDaoImpl&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;connectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   </div> 
  </div> 
  <div class="section" title="25.4&nbsp;Modeling CCI access as operation objects">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="cci-object"></a>25.4&nbsp;Modeling CCI access as operation objects</h2>
     </div>
    </div>
   </div> 
   <p>The <code class="literal">org.springframework.jca.cci.object</code> package contains support classes that allow you to access the EIS in a different style: through reusable operation objects, analogous to Springs JDBC operation objects (see JDBC chapter). This will usually encapsulate the CCI API: an application-level input object will be passed to the operation object, so it can construct the input record and then convert the received record data to an application-level output object and return it.</p> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>This approach is internally based on the <code class="literal">CciTemplate</code> class and the <code class="literal">RecordCreator</code> / <code class="literal">RecordExtractor</code> interfaces, reusing the machinery of Springs core CCI support.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <div class="section" title="25.4.1&nbsp;MappingRecordOperation">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cci-object-mapping-record"></a>25.4.1&nbsp;MappingRecordOperation</h3>
      </div>
     </div>
    </div> 
    <p><code class="literal">MappingRecordOperation</code> essentially performs the same work as <code class="literal">CciTemplate</code>, but represents a specific, pre-configured operation as an object. It provides two template methods to specify how to convert an input object to a input record, and how to convert an output record to an output object (record mapping):</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> <code class="literal">createInputRecord(..)</code> to specify how to convert an input object to an input <code class="literal">Record</code> </li>
      <li class="listitem"> <code class="literal">extractOutputData(..)</code> to specify how to extract an output object from an output <code class="literal">Record</code> </li>
     </ul>
    </div> 
    <p>Here are the signatures of these methods:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> MappingRecordOperation <span class="hl-keyword">extends</span> EisOperation {

    ...

    <span class="hl-keyword">protected</span> <span class="hl-keyword">abstract</span> Record createInputRecord(RecordFactory recordFactory,
            Object inputObject) <span class="hl-keyword">throws</span> ResourceException, DataAccessException {
        <span class="hl-comment">// ...</span>
    }

    <span class="hl-keyword">protected</span> <span class="hl-keyword">abstract</span> Object extractOutputData(Record outputRecord)
            <span class="hl-keyword">throws</span> ResourceException, SQLException, DataAccessException {
        <span class="hl-comment">// ...</span>
    }

    ...

}</pre> 
    <p>Thereafter, in order to execute an EIS operation, you need to use a single execute method, passing in an application-level input object and receiving an application-level output object as result:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> MappingRecordOperation <span class="hl-keyword">extends</span> EisOperation {

    ...

    <span class="hl-keyword">public</span> Object execute(Object inputObject) <span class="hl-keyword">throws</span> DataAccessException {
    }

    ...
}</pre> 
    <p>As you can see, contrary to the <code class="literal">CciTemplate</code> class, this <code class="literal">execute(..)</code> method does not have an <code class="literal">InteractionSpec</code> as argument. Instead, the <code class="literal">InteractionSpec</code> is global to the operation. The following constructor must be used to instantiate an operation object with a specific <code class="literal">InteractionSpec</code>:</p> 
    <pre class="programlisting">InteractionSpec spec = ...;
MyMappingRecordOperation eisOperation = <span class="hl-keyword">new</span> MyMappingRecordOperation(getConnectionFactory(), spec);
...</pre> 
   </div> 
   <div class="section" title="25.4.2&nbsp;MappingCommAreaOperation">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cci-object-mapping-comm-area"></a>25.4.2&nbsp;MappingCommAreaOperation</h3>
      </div>
     </div>
    </div> 
    <p>Some connectors use records based on a COMMAREA which represents an array of bytes containing parameters to send to the EIS and data returned by it. Spring provides a special operation class for working directly on COMMAREA rather than on records. The <code class="literal">MappingCommAreaOperation</code> class extends the <code class="literal">MappingRecordOperation</code> class to provide such special COMMAREA support. It implicitly uses the <code class="literal">CommAreaRecord</code> class as input and output record type, and provides two new methods to convert an input object into an input COMMAREA and the output COMMAREA into an output object.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> MappingCommAreaOperation <span class="hl-keyword">extends</span> MappingRecordOperation {

    ...

    <span class="hl-keyword">protected</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">byte</span>[] objectToBytes(Object inObject)
            <span class="hl-keyword">throws</span> IOException, DataAccessException;

    <span class="hl-keyword">protected</span> <span class="hl-keyword">abstract</span> Object bytesToObject(<span class="hl-keyword">byte</span>[] bytes)
        <span class="hl-keyword">throws</span> IOException, DataAccessException;

    ...

}</pre> 
   </div> 
   <div class="section" title="25.4.3&nbsp;Automatic output record generation">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cci-automatic-record-gen"></a>25.4.3&nbsp;Automatic output record generation</h3>
      </div>
     </div>
    </div> 
    <p>As every <code class="literal">MappingRecordOperation</code> subclass is based on CciTemplate internally, the same way to automatically generate output records as with <code class="literal">CciTemplate</code> is available. Every operation object provides a corresponding <code class="literal">setOutputRecordCreator(..)</code> method. For further information, see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#automatic-output-generation" title="25.3.4&nbsp;Automatic output record generation">Section&nbsp;25.3.4, Automatic output record generation</a>.</p> 
   </div> 
   <div class="section" title="25.4.4&nbsp;Summary">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cci-object-summary"></a>25.4.4&nbsp;Summary</h3>
      </div>
     </div>
    </div> 
    <p>The operation object approach uses records in the same manner as the <code class="literal">CciTemplate</code> class.</p> 
    <div class="table">
     <a name="cci-interaction-methods"></a>
     <p class="title"><b>Table&nbsp;25.2.&nbsp;Usage of Interaction execute methods</b></p>
     <div class="table-contents"> 
      <table summary="Usage of Interaction execute methods" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
       <colgroup>
        <col />
        <col />
        <col />
       </colgroup>
       <thead>
        <tr>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">MappingRecordOperation method signature</th>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">MappingRecordOperation outputRecordCreator property</th>
         <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">execute method called on the CCI Interaction</th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Object execute(Object)</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>not set</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Record execute(InteractionSpec, Record)</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Object execute(Object)</p></td>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>set</p></td>
         <td style="" align="left" valign="top"><p>boolean execute(InteractionSpec, Record, Record)</p></td>
        </tr>
       </tbody>
      </table> 
     </div>
    </div>
    <br class="table-break" /> 
   </div> 
   <div class="section" title="25.4.5&nbsp;Example for MappingRecordOperation usage">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cci-objects-mappring-record-example"></a>25.4.5&nbsp;Example for MappingRecordOperation usage</h3>
      </div>
     </div>
    </div> 
    <p>In this section, the usage of the <code class="literal">MappingRecordOperation</code> will be shown to access a database with the Blackbox CCI connector.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>The original version of this connector is provided by the Java EE SDK (version 1.3), available from Oracle.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>Firstly, some initializations on the CCI <code class="literal">InteractionSpec</code> must be done to specify which SQL request to execute. In this sample, we directly define the way to convert the parameters of the request to a CCI record and the way to convert the CCI result record to an instance of the <code class="literal">Person</code> class.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PersonMappingOperation <span class="hl-keyword">extends</span> MappingRecordOperation {

    <span class="hl-keyword">public</span> PersonMappingOperation(ConnectionFactory connectionFactory) {
        setConnectionFactory(connectionFactory);
        CciInteractionSpec interactionSpec = <span class="hl-keyword">new</span> CciConnectionSpec();
        interactionSpec.setSql(<span class="hl-string">&quot;select * from person where person_id=?&quot;</span>);
        setInteractionSpec(interactionSpec);
    }

    <span class="hl-keyword">protected</span> Record createInputRecord(RecordFactory recordFactory,
            Object inputObject) <span class="hl-keyword">throws</span> ResourceException {
        Integer id = (Integer) inputObject;
        IndexedRecord input = recordFactory.createIndexedRecord(<span class="hl-string">&quot;input&quot;</span>);
        input.add(<span class="hl-keyword">new</span> Integer(id));
        <span class="hl-keyword">return</span> input;
    }

    <span class="hl-keyword">protected</span> Object extractOutputData(Record outputRecord)
            <span class="hl-keyword">throws</span> ResourceException, SQLException {
        ResultSet rs = (ResultSet) outputRecord;
        Person person = null;
        <span class="hl-keyword">if</span> (rs.next()) {
            Person person = <span class="hl-keyword">new</span> Person();
            person.setId(rs.getInt(<span class="hl-string">&quot;person_id&quot;</span>));
            person.setLastName(rs.getString(<span class="hl-string">&quot;person_last_name&quot;</span>));
            person.setFirstName(rs.getString(<span class="hl-string">&quot;person_first_name&quot;</span>));
        }
        <span class="hl-keyword">return</span> person;
    }
}</pre> 
    <p>Then the application can execute the operation object, with the person identifier as argument. Note that operation object could be set up as shared instance, as it is thread-safe.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyDaoImpl <span class="hl-keyword">extends</span> CciDaoSupport <span class="hl-keyword">implements</span> MyDao {

    <span class="hl-keyword">public</span> Person getPerson(<span class="hl-keyword">int</span> id) {
        PersonMappingOperation query = <span class="hl-keyword">new</span> PersonMappingOperation(getConnectionFactory());
        Person person = (Person) query.execute(<span class="hl-keyword">new</span> Integer(id));
        <span class="hl-keyword">return</span> person;
    }
}</pre> 
    <p>The corresponding configuration of Spring beans could look as follows in non-managed mode:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;managedConnectionFactory&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.sun.connector.cciblackbox.CciLocalTxManagedConnectionFactory&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionURL&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;jdbc:hsqldb:hsql://localhost:9001&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;driverName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;org.hsqldb.jdbcDriver&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;targetConnectionFactory&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jca.support.LocalConnectionFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;managedConnectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;managedConnectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;connectionFactory&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jca.cci.connection.ConnectionSpecConnectionFactoryAdapter&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;targetConnectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;targetConnectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionSpec&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.sun.connector.cciblackbox.CciConnectionSpec&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;user&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;sa&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;password&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/bean&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;component&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;MyDaoImpl&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;connectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>In managed mode (that is, in a Java EE environment), the configuration could look as follows:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;targetConnectionFactory&quot;</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">&quot;eis/blackbox&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;connectionFactory&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jca.cci.connection.ConnectionSpecConnectionFactoryAdapter&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;targetConnectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;targetConnectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionSpec&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.sun.connector.cciblackbox.CciConnectionSpec&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;user&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;sa&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;password&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/bean&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;component&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;MyDaoImpl&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;connectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   </div> 
   <div class="section" title="25.4.6&nbsp;Example for MappingCommAreaOperation usage">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cci-objects-mapping-comm-area-example"></a>25.4.6&nbsp;Example for MappingCommAreaOperation usage</h3>
      </div>
     </div>
    </div> 
    <p>In this section, the usage of the <code class="literal">MappingCommAreaOperation</code> will be shown: accessing a CICS with ECI mode with the IBM CICS ECI connector.</p> 
    <p>Firstly, the CCI <code class="literal">InteractionSpec</code> needs to be initialized to specify which CICS program to access and how to interact with it.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> EciMappingOperation <span class="hl-keyword">extends</span> MappingCommAreaOperation {

    <span class="hl-keyword">public</span> EciMappingOperation(ConnectionFactory connectionFactory, String programName) {
        setConnectionFactory(connectionFactory);
        ECIInteractionSpec interactionSpec = <span class="hl-keyword">new</span> ECIInteractionSpec(),
        interactionSpec.setFunctionName(programName);
        interactionSpec.setInteractionVerb(ECIInteractionSpec.SYNC_SEND_RECEIVE);
        interactionSpec.setCommareaLength(<span class="hl-number">30</span>);
        setInteractionSpec(interactionSpec);
        setOutputRecordCreator(<span class="hl-keyword">new</span> EciOutputRecordCreator());
    }

    <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> <span class="hl-keyword">class</span> EciOutputRecordCreator <span class="hl-keyword">implements</span> RecordCreator {
        <span class="hl-keyword">public</span> Record createRecord(RecordFactory recordFactory) <span class="hl-keyword">throws</span> ResourceException {
            <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> CommAreaRecord();
        }
    }

}</pre> 
    <p>The abstract <code class="literal">EciMappingOperation</code> class can then be subclassed to specify mappings between custom objects and <code class="literal">Records</code>.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyDaoImpl <span class="hl-keyword">extends</span> CciDaoSupport <span class="hl-keyword">implements</span> MyDao {

    <span class="hl-keyword">public</span> OutputObject getData(Integer id) {
        EciMappingOperation query = <span class="hl-keyword">new</span> EciMappingOperation(getConnectionFactory(), <span class="hl-string">&quot;MYPROG&quot;</span>) {

            <span class="hl-keyword">protected</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">byte</span>[] objectToBytes(Object inObject) <span class="hl-keyword">throws</span> IOException {
                Integer id = (Integer) inObject;
                <span class="hl-keyword">return</span> String.valueOf(id);
            }

            <span class="hl-keyword">protected</span> <span class="hl-keyword">abstract</span> Object bytesToObject(<span class="hl-keyword">byte</span>[] bytes) <span class="hl-keyword">throws</span> IOException;
                String str = <span class="hl-keyword">new</span> String(bytes);
                String field1 = str.substring(<span class="hl-number">0</span>,<span class="hl-number">6</span>);
                String field2 = str.substring(<span class="hl-number">6</span>,<span class="hl-number">1</span>);
                String field3 = str.substring(<span class="hl-number">7</span>,<span class="hl-number">1</span>);
                <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> OutputObject(field1, field2, field3);
            }
        });

        <span class="hl-keyword">return</span> (OutputObject) query.execute(<span class="hl-keyword">new</span> Integer(id));
    }

}</pre> 
    <p>The corresponding configuration of Spring beans could look as follows in non-managed mode:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;managedConnectionFactory&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.ibm.connector2.cics.ECIManagedConnectionFactory&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;serverName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;TXSERIES&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionURL&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;local:&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;userName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;CICSUSER&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;password&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;CICS&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;connectionFactory&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jca.support.LocalConnectionFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;managedConnectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;managedConnectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;component&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;MyDaoImpl&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;connectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>In managed mode (that is, in a Java EE environment), the configuration could look as follows:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;connectionFactory&quot;</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">&quot;eis/cicseci&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;component&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;MyDaoImpl&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;connectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   </div> 
  </div> 
  <div class="section" title="25.5&nbsp;Transactions">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="cci-tx"></a>25.5&nbsp;Transactions</h2>
     </div>
    </div>
   </div> 
   <p>JCA specifies several levels of transaction support for resource adapters. The kind of transactions that your resource adapter supports is specified in its <code class="literal">ra.xml</code> file. There are essentially three options: none (for example with CICS EPI connector), local transactions (for example with a CICS ECI connector), global transactions (for example with an IMS connector).</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;connector&gt;</span>
    <span class="hl-tag">&lt;resourceadapter&gt;</span>
        <span class="hl-comment">&lt;!-- &lt;transaction-support&gt;NoTransaction&lt;/transaction-support&gt; --&gt;</span>
        <span class="hl-comment">&lt;!-- &lt;transaction-support&gt;LocalTransaction&lt;/transaction-support&gt; --&gt;</span>
        <span class="hl-tag">&lt;transaction-support&gt;</span>XATransaction<span class="hl-tag">&lt;/transaction-support&gt;</span>
    <span class="hl-tag">&lt;resourceadapter&gt;</span>
<span class="hl-tag">&lt;connector&gt;</span></pre> 
   <p>For global transactions, you can use Springs generic transaction infrastructure to demarcate transactions, with <code class="literal">JtaTransactionManager</code> as backend (delegating to the Java EE servers distributed transaction coordinator underneath).</p> 
   <p>For local transactions on a single CCI <code class="literal">ConnectionFactory</code>, Spring provides a specific transaction management strategy for CCI, analogous to the <code class="literal">DataSourceTransactionManager</code> for JDBC. The CCI API defines a local transaction object and corresponding local transaction demarcation methods. Springs <code class="literal">CciLocalTransactionManager</code> executes such local CCI transactions, fully compliant with Springs generic <code class="literal">PlatformTransactionManager</code> abstraction.</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;eciConnectionFactory&quot;</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">&quot;eis/cicseci&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;eciTransactionManager&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jca.cci.connection.CciLocalTransactionManager&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;connectionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;eciConnectionFactory&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   <p>Both transaction strategies can be used with any of Springs transaction demarcation facilities, be it declarative or programmatic. This is a consequence of Springs generic <code class="literal">PlatformTransactionManager</code> abstraction, which decouples transaction demarcation from the actual execution strategy. Simply switch between <code class="literal">JtaTransactionManager</code> and <code class="literal">CciLocalTransactionManager</code> as needed, keeping your transaction demarcation as-is.</p> 
   <p>For more information on Springs transaction facilities, see the chapter entitled <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#transaction" title="11.&nbsp;Transaction Management">Chapter&nbsp;11, <i>Transaction Management</i></a>.</p> 
  </div> 
 </div> 
 <div class="chapter" title="26.&nbsp;Email">
  <div class="titlepage">
   <div>
    <div>
     <h2 class="title"><a name="mail"></a>26.&nbsp;Email</h2>
    </div>
   </div>
  </div> 
  <div class="section" title="26.1&nbsp;Introduction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="mail-introduction"></a>26.1&nbsp;Introduction</h2>
     </div>
    </div>
   </div> 
   <div class="sidebar" title="Library dependencies">
    <p class="title"><b>Library dependencies</b></p> 
    <p>The following additional jars to be on the classpath of your application in order to be able to use the Spring Frameworks email library.</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> The <a class="ulink" href="https://java.net/projects/javamail/pages/Home" target="_top">JavaMail</a> <code class="literal">mail.jar</code> library </li>
      <li class="listitem"> The <a class="ulink" href="http://www.oracle.com/technetwork/java/jaf11-139815.html" target="_top">JAF</a> <code class="literal">activation.jar</code> library </li>
     </ul>
    </div> 
    <p>All of these libraries are freely available on the web.</p> 
   </div> 
   <p>The Spring Framework provides a helpful utility library for sending email that shields the user from the specifics of the underlying mailing system and is responsible for low level resource handling on behalf of the client.</p> 
   <p>The <code class="literal">org.springframework.mail</code> package is the root level package for the Spring Frameworks email support. The central interface for sending emails is the <code class="literal">MailSender</code> interface; a simple value object encapsulating the properties of a simple mail such as <span class="emphasis"><em>from</em></span> and <span class="emphasis"><em>to</em></span> (plus many others) is the <code class="literal">SimpleMailMessage</code> class. This package also contains a hierarchy of checked exceptions which provide a higher level of abstraction over the lower level mail system exceptions with the root exception being <code class="literal">MailException</code>. Please refer to the JavaDocs for more information on the rich mail exception hierarchy.</p> 
   <p>The <code class="literal">org.springframework.mail.javamail.JavaMailSender</code> interface adds specialized <span class="emphasis"><em>JavaMail</em></span> features such as MIME message support to the <code class="literal">MailSender</code> interface (from which it inherits). <code class="literal">JavaMailSender</code> also provides a callback interface for preparation of JavaMail MIME messages, called <code class="literal">org.springframework.mail.javamail.MimeMessagePreparator</code></p> 
  </div> 
  <div class="section" title="26.2&nbsp;Usage">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="mail-usage"></a>26.2&nbsp;Usage</h2>
     </div>
    </div>
   </div> 
   <p>Lets assume there is a business interface called <code class="literal">OrderManager</code>:</p> 
   <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> OrderManager {

    <span class="hl-keyword">void</span> placeOrder(Order order);

}</pre> 
   <p>Let us also assume that there is a requirement stating that an email message with an order number needs to be generated and sent to a customer placing the relevant order.</p> 
   <div class="section" title="26.2.1&nbsp;Basic MailSender and SimpleMailMessage usage">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mail-usage-simple"></a>26.2.1&nbsp;Basic MailSender and SimpleMailMessage usage</h3>
      </div>
     </div>
    </div> 
    <pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.mail.MailException;
<span class="hl-keyword">import</span> org.springframework.mail.MailSender;
<span class="hl-keyword">import</span> org.springframework.mail.SimpleMailMessage;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleOrderManager <span class="hl-keyword">implements</span> OrderManager {

    <span class="hl-keyword">private</span> MailSender mailSender;
    <span class="hl-keyword">private</span> SimpleMailMessage templateMessage;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMailSender(MailSender mailSender) {
        <span class="hl-keyword">this</span>.mailSender = mailSender;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setTemplateMessage(SimpleMailMessage templateMessage) {
        <span class="hl-keyword">this</span>.templateMessage = templateMessage;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> placeOrder(Order order) {

        <span class="hl-comment">// Do the business calculations...</span>

        <span class="hl-comment">// Call the collaborators to persist the order...</span>

        <span class="hl-comment">// Create a thread safe &quot;copy&quot; of the template message and customize it</span>
        SimpleMailMessage msg = <span class="hl-keyword">new</span> SimpleMailMessage(<span class="hl-keyword">this</span>.templateMessage);
        msg.setTo(order.getCustomer().getEmailAddress());
        msg.setText(
            <span class="hl-string">&quot;Dear &quot;</span> + order.getCustomer().getFirstName()
                + order.getCustomer().getLastName()
                + <span class="hl-string">&quot;, thank you for placing order. Your order number is &quot;</span>
                + order.getOrderNumber());
        <span class="hl-keyword">try</span>{
            <span class="hl-keyword">this</span>.mailSender.send(msg);
        }
        <span class="hl-keyword">catch</span> (MailException ex) {
            <span class="hl-comment">// simply log it and go on...</span>
            System.err.println(ex.getMessage());
        }
    }

}</pre> 
    <p>Find below the bean definitions for the above code:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;mailSender&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.mail.javamail.JavaMailSenderImpl&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;host&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;mail.mycompany.com&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-comment">&lt;!-- this is a template message that we can pre-load with default state --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;templateMessage&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.mail.SimpleMailMessage&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;from&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;customerservice@mycompany.com&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;subject&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Your order&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;orderManager&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.mycompany.businessapp.support.SimpleOrderManager&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;mailSender&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;mailSender&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;templateMessage&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;templateMessage&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   </div> 
   <div class="section" title="26.2.2&nbsp;Using the JavaMailSender and the MimeMessagePreparator">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mail-usage-mime"></a>26.2.2&nbsp;Using the JavaMailSender and the MimeMessagePreparator</h3>
      </div>
     </div>
    </div> 
    <p>Here is another implementation of <code class="literal">OrderManager</code> using the <code class="literal">MimeMessagePreparator</code> callback interface. Please note in this case that the <code class="literal">mailSender</code> property is of type <code class="literal">JavaMailSender</code> so that we are able to use the JavaMail <code class="literal">MimeMessage</code> class:</p> 
    <pre class="programlisting"><span class="hl-keyword">import</span> javax.mail.Message;
<span class="hl-keyword">import</span> javax.mail.MessagingException;
<span class="hl-keyword">import</span> javax.mail.internet.InternetAddress;
<span class="hl-keyword">import</span> javax.mail.internet.MimeMessage;

<span class="hl-keyword">import</span> javax.mail.internet.MimeMessage;
<span class="hl-keyword">import</span> org.springframework.mail.MailException;
<span class="hl-keyword">import</span> org.springframework.mail.javamail.JavaMailSender;
<span class="hl-keyword">import</span> org.springframework.mail.javamail.MimeMessagePreparator;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleOrderManager <span class="hl-keyword">implements</span> OrderManager {

    <span class="hl-keyword">private</span> JavaMailSender mailSender;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMailSender(JavaMailSender mailSender) {
        <span class="hl-keyword">this</span>.mailSender = mailSender;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> placeOrder(<span class="hl-keyword">final</span> Order order) {

        <span class="hl-comment">// Do the business calculations...</span>

        <span class="hl-comment">// Call the collaborators to persist the order...</span>

        MimeMessagePreparator preparator = <span class="hl-keyword">new</span> MimeMessagePreparator() {

            <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> prepare(MimeMessage mimeMessage) <span class="hl-keyword">throws</span> Exception {

                mimeMessage.setRecipient(Message.RecipientType.TO,
                        <span class="hl-keyword">new</span> InternetAddress(order.getCustomer().getEmailAddress()));
                mimeMessage.setFrom(<span class="hl-keyword">new</span> InternetAddress(<span class="hl-string">&quot;mail@mycompany.com&quot;</span>));
                mimeMessage.setText(
                        <span class="hl-string">&quot;Dear &quot;</span> + order.getCustomer().getFirstName() + <span class="hl-string">&quot; &quot;</span>
                            + order.getCustomer().getLastName()
                            + <span class="hl-string">&quot;, thank you for placing order. Your order number is &quot;</span>
                            + order.getOrderNumber());
            }
        };

        <span class="hl-keyword">try</span> {
            <span class="hl-keyword">this</span>.mailSender.send(preparator);
        }
        <span class="hl-keyword">catch</span> (MailException ex) {
            <span class="hl-comment">// simply log it and go on...</span>
            System.err.println(ex.getMessage());
        }
    }

}</pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>The mail code is a crosscutting concern and could well be a candidate for refactoring into a <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop" title="8.&nbsp;Aspect Oriented Programming with Spring">custom Spring AOP aspect</a>, which then could be executed at appropriate joinpoints on the <code class="literal">OrderManager</code> target.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>The Spring Frameworks mail support ships with the standard JavaMail implementation. Please refer to the relevant JavaDocs for more information.</p> 
   </div> 
  </div> 
  <div class="section" title="26.3&nbsp;Using the JavaMail MimeMessageHelper">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="mail-javamail-mime"></a>26.3&nbsp;Using the JavaMail MimeMessageHelper</h2>
     </div>
    </div>
   </div> 
   <p>A class that comes in pretty handy when dealing with JavaMail messages is the <code class="literal">org.springframework.mail.javamail.MimeMessageHelper</code> class, which shields you from having to use the verbose JavaMail API. Using the <code class="literal">MimeMessageHelper</code> it is pretty easy to create a <code class="literal">MimeMessage</code>:</p> 
   <pre class="programlisting"><span class="hl-comment">// of course you would use DI in any real-world cases</span>
JavaMailSenderImpl sender = <span class="hl-keyword">new</span> JavaMailSenderImpl();
sender.setHost(<span class="hl-string">&quot;mail.host.com&quot;</span>);

MimeMessage message = sender.createMimeMessage();
MimeMessageHelper helper = <span class="hl-keyword">new</span> MimeMessageHelper(message);
helper.setTo(<span class="hl-string">&quot;test@host.com&quot;</span>);
helper.setText(<span class="hl-string">&quot;Thank you for ordering!&quot;</span>);

sender.send(message);</pre> 
   <div class="section" title="26.3.1&nbsp;Sending attachments and inline resources">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mail-javamail-mime-attachments"></a>26.3.1&nbsp;Sending attachments and inline resources</h3>
      </div>
     </div>
    </div> 
    <p>Multipart email messages allow for both attachments and inline resources. Examples of inline resources would be images or a stylesheet you want to use in your message, but that you dont want displayed as an attachment.</p> 
    <div class="section" title="Attachments">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mail-javamail-mime-attachments-attachment"></a>Attachments</h4>
       </div>
      </div>
     </div> 
     <p>The following example shows you how to use the <code class="literal">MimeMessageHelper</code> to send an email along with a single JPEG image attachment.</p> 
     <pre class="programlisting">JavaMailSenderImpl sender = <span class="hl-keyword">new</span> JavaMailSenderImpl();
sender.setHost(<span class="hl-string">&quot;mail.host.com&quot;</span>);

MimeMessage message = sender.createMimeMessage();

<span class="hl-comment">// use the true flag to indicate you need a multipart message</span>
MimeMessageHelper helper = <span class="hl-keyword">new</span> MimeMessageHelper(message, true);
helper.setTo(<span class="hl-string">&quot;test@host.com&quot;</span>);

helper.setText(<span class="hl-string">&quot;Check out this image!&quot;</span>);

<span class="hl-comment">// let's attach the infamous windows Sample file (this time copied to c:/)</span>
FileSystemResource file = <span class="hl-keyword">new</span> FileSystemResource(<span class="hl-keyword">new</span> File(<span class="hl-string">&quot;c:/Sample.jpg&quot;</span>));
helper.addAttachment(<span class="hl-string">&quot;CoolImage.jpg&quot;</span>, file);

sender.send(message);</pre> 
    </div> 
    <div class="section" title="Inline resources">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mail-javamail-mime-attachments-inline"></a>Inline resources</h4>
       </div>
      </div>
     </div> 
     <p>The following example shows you how to use the <code class="literal">MimeMessageHelper</code> to send an email along with an inline image.</p> 
     <pre class="programlisting">JavaMailSenderImpl sender = <span class="hl-keyword">new</span> JavaMailSenderImpl();
sender.setHost(<span class="hl-string">&quot;mail.host.com&quot;</span>);

MimeMessage message = sender.createMimeMessage();

<span class="hl-comment">// use the true flag to indicate you need a multipart message</span>
MimeMessageHelper helper = <span class="hl-keyword">new</span> MimeMessageHelper(message, true);
helper.setTo(<span class="hl-string">&quot;test@host.com&quot;</span>);

<span class="hl-comment">// use the true flag to indicate the text included is HTML</span>
helper.setText(<span class="hl-string">&quot;&lt;html&gt;&lt;body&gt;&lt;img src=</span><span class="emphasis"><em>cid:identifier1234</em></span>&gt;&lt;/body&gt;&lt;/html&gt;<span class="hl-string">&quot;, true);
</span>
<span class="hl-comment">// let's include the infamous windows Sample file (this time copied to c:/)</span>
FileSystemResource res = <span class="hl-keyword">new</span> FileSystemResource(<span class="hl-keyword">new</span> File(<span class="hl-string">&quot;c:/Sample.jpg&quot;</span>));
helper.addInline(<span class="hl-string">&quot;identifier1234&quot;</span>, res);

sender.send(message);</pre> 
     <div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Warning">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="./Spring Framework Reference Documentation_files/warning.png" /></td>
         <th align="left">Warning</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>Inline resources are added to the mime message using the specified <code class="literal">Content-ID</code> ( <code class="literal">identifier1234</code> in the above example). The order in which you are adding the text and the resource are <span class="emphasis"><em>very</em></span> important. Be sure to <span class="emphasis"><em>first add the text</em></span> and after that the resources. If you are doing it the other way around, it wont work!</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
   </div> 
   <div class="section" title="26.3.2&nbsp;Creating email content using a templating library">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mail-templates"></a>26.3.2&nbsp;Creating email content using a templating library</h3>
      </div>
     </div>
    </div> 
    <p>The code in the previous examples explicitly created the content of the email message, using methods calls such as <code class="literal">message.setText(..)</code>. This is fine for simple cases, and it is okay in the context of the aforementioned examples, where the intent was to show you the very basics of the API.</p> 
    <p>In your typical enterprise application though, you are not going to create the content of your emails using the above approach for a number of reasons.</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> Creating HTML-based email content in Java code is tedious and error prone </li>
      <li class="listitem"> There is no clear separation between display logic and business logic </li>
      <li class="listitem"> Changing the display structure of the email content requires writing Java code, recompiling, redeploying </li>
     </ul>
    </div> 
    <p>Typically the approach taken to address these issues is to use a template library such as FreeMarker or Velocity to define the display structure of email content. This leaves your code tasked only with creating the data that is to be rendered in the email template and sending the email. It is definitely a best practice for when the content of your emails becomes even moderately complex, and with the Spring Frameworks support classes for FreeMarker and Velocity becomes quite easy to do. Find below an example of using the Velocity template library to create email content.</p> 
    <div class="section" title="A Velocity-based example">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mail-templates-example"></a>A Velocity-based example</h4>
       </div>
      </div>
     </div> 
     <p>To use <a class="ulink" href="http://velocity.apache.org/" target="_top">Velocity</a> to create your email template(s), you will need to have the Velocity libraries available on your classpath. You will also need to create one or more Velocity templates for the email content that your application needs. Find below the Velocity template that this example will be using. As you can see it is HTML-based, and since it is plain text it can be created using your favorite HTML or text editor.</p> 
     <pre class="programlisting"># in the com/foo/package
<span class="hl-tag">&lt;html&gt;</span>
    <span class="hl-tag">&lt;body&gt;</span>
        <span class="hl-tag">&lt;h3&gt;</span>Hi ${user.userName}, welcome to the Chipping Sodbury On-the-Hill message boards!<span class="hl-tag">&lt;/h3&gt;</span>

        <span class="hl-tag">&lt;div&gt;</span>
            Your email address is <span class="hl-tag">&lt;a</span> <span class="hl-attribute">href</span>=<span class="hl-value">&quot;mailto:${user.emailAddress}&quot;</span><span class="hl-tag">&gt;</span>${user.emailAddress}<span class="hl-tag">&lt;/a&gt;</span>.
        <span class="hl-tag">&lt;/div&gt;</span>
    <span class="hl-tag">&lt;/body&gt;</span>
<span class="hl-tag">&lt;/html&gt;</span></pre> 
     <p>Find below some simple code and Spring XML configuration that makes use of the above Velocity template to create email content and send email(s).</p> 
     <pre class="programlisting"><span class="hl-keyword">package</span> com.foo;

<span class="hl-keyword">import</span> org.apache.velocity.app.VelocityEngine;
<span class="hl-keyword">import</span> org.springframework.mail.javamail.JavaMailSender;
<span class="hl-keyword">import</span> org.springframework.mail.javamail.MimeMessageHelper;
<span class="hl-keyword">import</span> org.springframework.mail.javamail.MimeMessagePreparator;
<span class="hl-keyword">import</span> org.springframework.ui.velocity.VelocityEngineUtils;

<span class="hl-keyword">import</span> javax.mail.internet.MimeMessage;
<span class="hl-keyword">import</span> java.util.HashMap;
<span class="hl-keyword">import</span> java.util.Map;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleRegistrationService <span class="hl-keyword">implements</span> RegistrationService {

    <span class="hl-keyword">private</span> JavaMailSender mailSender;
    <span class="hl-keyword">private</span> VelocityEngine velocityEngine;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMailSender(JavaMailSender mailSender) {
        <span class="hl-keyword">this</span>.mailSender = mailSender;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setVelocityEngine(VelocityEngine velocityEngine) {
        <span class="hl-keyword">this</span>.velocityEngine = velocityEngine;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> register(User user) {

        <span class="hl-comment">// Do the registration logic...</span>

        sendConfirmationEmail(user);
    }

    <span class="hl-keyword">private</span> <span class="hl-keyword">void</span> sendConfirmationEmail(<span class="hl-keyword">final</span> User user) {
        MimeMessagePreparator preparator = <span class="hl-keyword">new</span> MimeMessagePreparator() {
            <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> prepare(MimeMessage mimeMessage) <span class="hl-keyword">throws</span> Exception {
                MimeMessageHelper message = <span class="hl-keyword">new</span> MimeMessageHelper(mimeMessage);
                message.setTo(user.getEmailAddress());
                message.setFrom(<span class="hl-string">&quot;webmaster@csonth.gov.uk&quot;</span>); <span class="hl-comment">// could be parameterized...</span>
                Map model = <span class="hl-keyword">new</span> HashMap();
                model.put(<span class="hl-string">&quot;user&quot;</span>, user);
                String text = VelocityEngineUtils.mergeTemplateIntoString(
                        velocityEngine, <span class="hl-string">&quot;com/dns/registration-confirmation.vm&quot;</span>, model);
                message.setText(text, true);
            }
        };
        <span class="hl-keyword">this</span>.mailSender.send(preparator);
    }

}</pre> 
     <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;mailSender&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.mail.javamail.JavaMailSenderImpl&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;host&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;mail.csonth.gov.uk&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;registrationService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.SimpleRegistrationService&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;mailSender&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;mailSender&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;velocityEngine&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;velocityEngine&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;velocityEngine&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.ui.velocity.VelocityEngineFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;velocityProperties&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>
                resource.loader=class
                class.resource.loader.class=org.apache.velocity.runtime.resource.loader.ClasspathResourceLoader
            <span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    </div> 
   </div> 
  </div> 
 </div> 
 <div class="chapter" title="27.&nbsp;Task Execution and Scheduling">
  <div class="titlepage">
   <div>
    <div>
     <h2 class="title"><a name="scheduling"></a>27.&nbsp;Task Execution and Scheduling</h2>
    </div>
   </div>
  </div> 
  <div class="section" title="27.1&nbsp;Introduction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="scheduling-introduction"></a>27.1&nbsp;Introduction</h2>
     </div>
    </div>
   </div> 
   <p>The Spring Framework provides abstractions for asynchronous execution and scheduling of tasks with the <code class="literal">TaskExecutor</code> and <code class="literal">TaskScheduler</code> interfaces, respectively. Spring also features implementations of those interfaces that support thread pools or delegation to CommonJ within an application server environment. Ultimately the use of these implementations behind the common interfaces abstracts away the differences between Java SE 5, Java SE 6 and Java EE environments.</p> 
   <p>Spring also features integration classes for supporting scheduling with the <code class="literal">Timer</code>, part of the JDK since 1.3, and the Quartz Scheduler ( <a class="ulink" href="http://quartz-scheduler.org/" target="_top">http://quartz-scheduler.org</a>). Both of those schedulers are set up using a <code class="literal">FactoryBean</code> with optional references to <code class="literal">Timer</code> or <code class="literal">Trigger</code> instances, respectively. Furthermore, a convenience class for both the Quartz Scheduler and the <code class="literal">Timer</code> is available that allows you to invoke a method of an existing target object (analogous to the normal <code class="literal">MethodInvokingFactoryBean</code> operation).</p> 
  </div> 
  <div class="section" title="27.2&nbsp;The Spring TaskExecutor abstraction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="scheduling-task-executor"></a>27.2&nbsp;The Spring TaskExecutor abstraction</h2>
     </div>
    </div>
   </div> 
   <p>Spring 2.0 introduces a new abstraction for dealing with executors. Executors are the Java 5 name for the concept of thread pools. The &quot;executor&quot; naming is due to the fact that there is no guarantee that the underlying implementation is actually a pool; an executor may be single-threaded or even synchronous. Springs abstraction hides implementation details between Java SE 1.4, Java SE 5 and Java EE environments.</p> 
   <p>Springs <code class="literal">TaskExecutor</code> interface is identical to the <code class="literal">java.util.concurrent.Executor</code> interface. In fact, its primary reason for existence is to abstract away the need for Java 5 when using thread pools. The interface has a single method <code class="literal">execute(Runnable task)</code> that accepts a task for execution based on the semantics and configuration of the thread pool.</p> 
   <p>The <code class="literal">TaskExecutor</code> was originally created to give other Spring components an abstraction for thread pooling where needed. Components such as the <code class="literal">ApplicationEventMulticaster</code>, JMSs <code class="literal">AbstractMessageListenerContainer</code>, and Quartz integration all use the <code class="literal">TaskExecutor</code> abstraction to pool threads. However, if your beans need thread pooling behavior, it is possible to use this abstraction for your own needs.</p> 
   <div class="section" title="27.2.1&nbsp;TaskExecutor types">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="scheduling-task-executor-types"></a>27.2.1&nbsp;TaskExecutor types</h3>
      </div>
     </div>
    </div> 
    <p>There are a number of pre-built implementations of <code class="literal">TaskExecutor</code> included with the Spring distribution. In all likelihood, you shouldnt ever need to implement your own.</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> <code class="literal">SimpleAsyncTaskExecutor</code> This implementation does not reuse any threads, rather it starts up a new thread for each invocation. However, it does support a concurrency limit which will block any invocations that are over the limit until a slot has been freed up. If youre looking for true pooling, keep scrolling further down the page. </li>
      <li class="listitem"> <code class="literal">SyncTaskExecutor</code> This implementation doesnt execute invocations asynchronously. Instead, each invocation takes place in the calling thread. It is primarily used in situations where multithreading isnt necessary such as simple test cases. </li>
      <li class="listitem"> <code class="literal">ConcurrentTaskExecutor</code> This implementation is a wrapper for a Java 5 <code class="literal">java.util.concurrent.Executor</code>. There is an alternative, <code class="literal">ThreadPoolTaskExecutor</code>, that exposes the <code class="literal">Executor</code> configuration parameters as bean properties. It is rare to need to use the <code class="literal">ConcurrentTaskExecutor</code> but if the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#"><code class="literal">ThreadPoolTaskExecutor</code></a> isnt robust enough for your needs, the <code class="literal">ConcurrentTaskExecutor</code> is an alternative. </li>
      <li class="listitem"> <code class="literal">SimpleThreadPoolTaskExecutor</code> This implementation is actually a subclass of Quartzs <code class="literal">SimpleThreadPool</code> which listens to Springs lifecycle callbacks. This is typically used when you have a thread pool that may need to be shared by both Quartz and non-Quartz components. </li>
      <li class="listitem"> <code class="literal">ThreadPoolTaskExecutor</code> </li>
     </ul>
    </div> 
    <p>This implementation can only be used in a Java 5 environment but is also the most commonly used one in that environment. It exposes bean properties for configuring a <code class="literal">java.util.concurrent.ThreadPoolExecutor</code> and wraps it in a <code class="literal">TaskExecutor</code>. If you need something advanced such as a <code class="literal">ScheduledThreadPoolExecutor</code>, it is recommended that you use a <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#"><code class="literal">ConcurrentTaskExecutor</code></a> instead.</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> <code class="literal">TimerTaskExecutor</code> This implementation uses a single <code class="literal">TimerTask</code> as its backing implementation. Its different from the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#"><code class="literal">SyncTaskExecutor</code></a> in that the method invocations are executed in a separate thread, although they are synchronous in that thread. </li>
      <li class="listitem"> <p class="simpara"><code class="literal">WorkManagerTaskExecutor</code></p> 
       <div class="sidebar">
        <p class="title"><b></b></p> 
        <p>CommonJ is a set of specifications jointly developed between BEA and IBM. These specifications are not Java EE standards, but are standard across BEAs and IBMs Application Server implementations.</p> 
       </div> <p class="simpara">This implementation uses the CommonJ WorkManager as its backing implementation and is the central convenience class for setting up a CommonJ WorkManager reference in a Spring context. Similar to the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#"><code class="literal">SimpleThreadPoolTaskExecutor</code></a>, this class implements the WorkManager interface and therefore can be used directly as a WorkManager as well.</p> </li>
     </ul>
    </div> 
   </div> 
   <div class="section" title="27.2.2&nbsp;Using a TaskExecutor">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="scheduling-task-executor-usage"></a>27.2.2&nbsp;Using a TaskExecutor</h3>
      </div>
     </div>
    </div> 
    <p>Springs <code class="literal">TaskExecutor</code> implementations are used as simple JavaBeans. In the example below, we define a bean that uses the <code class="literal">ThreadPoolTaskExecutor</code> to asynchronously print out a set of messages.</p> 
    <pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.core.task.TaskExecutor;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TaskExecutorExample {

    <span class="hl-keyword">private</span> <span class="hl-keyword">class</span> MessagePrinterTask <span class="hl-keyword">implements</span> Runnable {

        <span class="hl-keyword">private</span> String message;

        <span class="hl-keyword">public</span> MessagePrinterTask(String message) {
            <span class="hl-keyword">this</span>.message = message;
        }

        <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> run() {
            System.out.println(message);
        }

    }

    <span class="hl-keyword">private</span> TaskExecutor taskExecutor;

    <span class="hl-keyword">public</span> TaskExecutorExample(TaskExecutor taskExecutor) {
        <span class="hl-keyword">this</span>.taskExecutor = taskExecutor;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> printMessages() {
        <span class="hl-keyword">for</span>(<span class="hl-keyword">int</span> i = <span class="hl-number">0</span>; i &lt; <span class="hl-number">25</span>; i++) {
            taskExecutor.execute(<span class="hl-keyword">new</span> MessagePrinterTask(<span class="hl-string">&quot;Message&quot;</span> + i));
        }
    }

}</pre> 
    <p>As you can see, rather than retrieving a thread from the pool and executing yourself, you add your <code class="literal">Runnable</code> to the queue and the <code class="literal">TaskExecutor</code> uses its internal rules to decide when the task gets executed.</p> 
    <p>To configure the rules that the <code class="literal">TaskExecutor</code> will use, simple bean properties have been exposed.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;taskExecutor&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;corePoolSize&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;5&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;maxPoolSize&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;10&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;queueCapacity&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;25&quot;</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;taskExecutorExample&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;TaskExecutorExample&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;taskExecutor&quot;</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   </div> 
  </div> 
  <div class="section" title="27.3&nbsp;The Spring TaskScheduler abstraction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="scheduling-task-scheduler"></a>27.3&nbsp;The Spring TaskScheduler abstraction</h2>
     </div>
    </div>
   </div> 
   <p>In addition to the <code class="literal">TaskExecutor</code> abstraction, Spring 3.0 introduces a <code class="literal">TaskScheduler</code> with a variety of methods for scheduling tasks to run at some point in the future.</p> 
   <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> TaskScheduler {

    ScheduledFuture schedule(Runnable task, Trigger trigger);

    ScheduledFuture schedule(Runnable task, Date startTime);

    ScheduledFuture scheduleAtFixedRate(Runnable task, Date startTime, <span class="hl-keyword">long</span> period);

    ScheduledFuture scheduleAtFixedRate(Runnable task, <span class="hl-keyword">long</span> period);

    ScheduledFuture scheduleWithFixedDelay(Runnable task, Date startTime, <span class="hl-keyword">long</span> delay);

    ScheduledFuture scheduleWithFixedDelay(Runnable task, <span class="hl-keyword">long</span> delay);

}</pre> 
   <p>The simplest method is the one named <span class="emphasis"><em>schedule</em></span> that takes a <code class="literal">Runnable</code> and <code class="literal">Date</code> only. That will cause the task to run once after the specified time. All of the other methods are capable of scheduling tasks to run repeatedly. The fixed-rate and fixed-delay methods are for simple, periodic execution, but the method that accepts a Trigger is much more flexible.</p> 
   <div class="section" title="27.3.1&nbsp;the Trigger interface">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="scheduling-trigger-interface"></a>27.3.1&nbsp;the Trigger interface</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">Trigger</code> interface is essentially inspired by JSR-236, which, as of Spring 3.0, has not yet been officially implemented. The basic idea of the <code class="literal">Trigger</code> is that execution times may be determined based on past execution outcomes or even arbitrary conditions. If these determinations do take into account the outcome of the preceding execution, that information is available within a <code class="literal">TriggerContext</code>. The <code class="literal">Trigger</code> interface itself is quite simple:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Trigger {

    Date nextExecutionTime(TriggerContext triggerContext);

}</pre> 
    <p>As you can see, the <code class="literal">TriggerContext</code> is the most important part. It encapsulates all of the relevant data, and is open for extension in the future if necessary. The <code class="literal">TriggerContext</code> is an interface (a <code class="literal">SimpleTriggerContext</code> implementation is used by default). Here you can see what methods are available for <code class="literal">Trigger</code> implementations.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> TriggerContext {

    Date lastScheduledExecutionTime();

    Date lastActualExecutionTime();

    Date lastCompletionTime();

}</pre> 
   </div> 
   <div class="section" title="27.3.2&nbsp;Trigger implementations">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="scheduling-trigger-implementations"></a>27.3.2&nbsp;Trigger implementations</h3>
      </div>
     </div>
    </div> 
    <p>Spring provides two implementations of the <code class="literal">Trigger</code> interface. The most interesting one is the <code class="literal">CronTrigger</code>. It enables the scheduling of tasks based on cron expressions. For example the following task is being scheduled to run 15 minutes past each hour but only during the 9-to-5 &quot;business hours&quot; on weekdays.</p> 
    <pre class="programlisting">scheduler.schedule(task, <span class="hl-keyword">new</span> CronTrigger(<span class="hl-string">&quot;* 15 9-17 * * MON-FRI&quot;</span>));</pre> 
    <p>The other out-of-the-box implementation is a <code class="literal">PeriodicTrigger</code> that accepts a fixed period, an optional initial delay value, and a boolean to indicate whether the period should be interpreted as a fixed-rate or a fixed-delay. Since the <code class="literal">TaskScheduler</code> interface already defines methods for scheduling tasks at a fixed-rate or with a fixed-delay, those methods should be used directly whenever possible. The value of the <code class="literal">PeriodicTrigger</code> implementation is that it can be used within components that rely on the <code class="literal">Trigger</code> abstraction. For example, it may be convenient to allow periodic triggers, cron-based triggers, and even custom trigger implementations to be used interchangeably. Such a component could take advantage of dependency injection so that such <code class="literal">Triggers</code> could be configured externally.</p> 
   </div> 
   <div class="section" title="27.3.3&nbsp;TaskScheduler implementations">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="scheduling-task-scheduler-implementations"></a>27.3.3&nbsp;TaskScheduler implementations</h3>
      </div>
     </div>
    </div> 
    <p>As with Springs <code class="literal">TaskExecutor</code> abstraction, the primary benefit of the <code class="literal">TaskScheduler</code> is that code relying on scheduling behavior need not be coupled to a particular scheduler implementation. The flexibility this provides is particularly relevant when running within Application Server environments where threads should not be created directly by the application itself. For such cases, Spring provides a <code class="literal">TimerManagerTaskScheduler</code> that delegates to a CommonJ TimerManager instance, typically configured with a JNDI-lookup.</p> 
    <p>A simpler alternative, the <code class="literal">ThreadPoolTaskScheduler</code>, can be used whenever external thread management is not a requirement. Internally, it delegates to a <code class="literal">ScheduledExecutorService</code> instance. <code class="literal">ThreadPoolTaskScheduler</code> actually implements Springs <code class="literal">TaskExecutor</code> interface as well, so that a single instance can be used for asynchronous execution <span class="emphasis"><em>as soon as possible</em></span> as well as scheduled, and potentially recurring, executions.</p> 
   </div> 
  </div> 
  <div class="section" title="27.4&nbsp;Annotation Support for Scheduling and Asynchronous Execution">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="scheduling-annotation-support"></a>27.4&nbsp;Annotation Support for Scheduling and Asynchronous Execution</h2>
     </div>
    </div>
   </div> 
   <p>Spring provides annotation support for both task scheduling and asynchronous method execution.</p> 
   <div class="section" title="27.4.1&nbsp;Enable scheduling annotations">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="scheduling-enable-annotation-support"></a>27.4.1&nbsp;Enable scheduling annotations</h3>
      </div>
     </div>
    </div> 
    <p>To enable support for <code class="literal">@Scheduled</code> and <code class="literal">@Async</code> annotations add <code class="literal">@EnableScheduling</code> and <code class="literal">@EnableAsync</code> to one of your <code class="literal">@Configuration</code> classes:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableAsync</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableScheduling</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {
}</pre> 
    <p>You are free to pick and choose the relevant annotations for your application. For example, if you only need support for <code class="literal">@Scheduled</code>, simply omit <code class="literal">@EnableAsync</code>. For more fine-grained control you can additionally implement the <code class="literal">SchedulingConfigurer</code> and/or <code class="literal">AsyncConfigurer</code> interfaces. See the Javadoc for full details.</p> 
    <p>If you prefer XML configuration use the <code class="literal">&lt;task:annotation-driven&gt;</code> element.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;task:annotation-driven</span> <span class="hl-attribute">executor</span>=<span class="hl-value">&quot;myExecutor&quot;</span> <span class="hl-attribute">scheduler</span>=<span class="hl-value">&quot;myScheduler&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;task:executor</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myExecutor&quot;</span> <span class="hl-attribute">pool-size</span>=<span class="hl-value">&quot;5&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;task:scheduler</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myScheduler&quot;</span> <span class="hl-attribute">pool-size</span>=<span class="hl-value">&quot;10&quot;</span><span class="hl-tag">/&gt;</span>}</pre> 
    <p>Notice with the above XML that an executor reference is provided for handling those tasks that correspond to methods with the <code class="literal">@Async</code> annotation, and the scheduler reference is provided for managing those methods annotated with <code class="literal">@Scheduled</code>.</p> 
   </div> 
   <div class="section" title="27.4.2&nbsp;The @Scheduled Annotation">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="scheduling-annotation-support-scheduled"></a>27.4.2&nbsp;The @Scheduled Annotation</h3>
      </div>
     </div>
    </div> 
    <p>The @Scheduled annotation can be added to a method along with trigger metadata. For example, the following method would be invoked every 5 seconds with a fixed delay, meaning that the period will be measured from the completion time of each preceding invocation.</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Scheduled(fixedDelay=5000)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doSomething() {
    <span class="hl-comment">// something that should execute periodically</span>
}</pre> 
    <p>If a fixed rate execution is desired, simply change the property name specified within the annotation. The following would be executed every 5 seconds measured between the successive start times of each invocation.</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Scheduled(fixedRate=5000)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doSomething() {
    <span class="hl-comment">// something that should execute periodically</span>
}</pre> 
    <p>For fixed-delay and fixed-rate tasks, an initial delay may be specified indicating the number of milliseconds to wait before the first execution of the method.</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Scheduled(initialDelay=1000, fixedRate=5000)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doSomething() {
    <span class="hl-comment">// something that should execute periodically</span>
}</pre> 
    <p>If simple periodic scheduling is not expressive enough, then a cron expression may be provided. For example, the following will only execute on weekdays.</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Scheduled(cron=&quot;*/5 * * * * MON-FRI&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doSomething() {
    <span class="hl-comment">// something that should execute on weekdays only</span>
}</pre> 
    <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Tip">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
        <th align="left">Tip</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>You can additionally use the <code class="literal">zone</code> attribute to specify the time zone in which the cron expression will be resolved.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>Notice that the methods to be scheduled must have void returns and must not expect any arguments. If the method needs to interact with other objects from the Application Context, then those would typically have been provided through dependency injection.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Make sure that you are not initializing multiple instances of the same @Scheduled annotation class at runtime, unless you do want to schedule callbacks to each such instance. Related to this, make sure that you do not use @Configurable on bean classes which are annotated with @Scheduled and registered as regular Spring beans with the container: You would get double initialization otherwise, once through the container and once through the @Configurable aspect, with the consequence of each @Scheduled method being invoked twice.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="27.4.3&nbsp;The @Async Annotation">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="scheduling-annotation-support-async"></a>27.4.3&nbsp;The @Async Annotation</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">@Async</code> annotation can be provided on a method so that invocation of that method will occur asynchronously. In other words, the caller will return immediately upon invocation and the actual execution of the method will occur in a task that has been submitted to a Spring <code class="literal">TaskExecutor</code>. In the simplest case, the annotation may be applied to a <code class="literal">void</code>-returning method.</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Async</span></i>
<span class="hl-keyword">void</span> doSomething() {
    <span class="hl-comment">// this will be executed asynchronously</span>
}</pre> 
    <p>Unlike the methods annotated with the <code class="literal">@Scheduled</code> annotation, these methods can expect arguments, because they will be invoked in the &quot;normal&quot; way by callers at runtime rather than from a scheduled task being managed by the container. For example, the following is a legitimate application of the <code class="literal">@Async</code> annotation.</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Async</span></i>
<span class="hl-keyword">void</span> doSomething(String s) {
    <span class="hl-comment">// this will be executed asynchronously</span>
}</pre> 
    <p>Even methods that return a value can be invoked asynchronously. However, such methods are required to have a <code class="literal">Future</code> typed return value. This still provides the benefit of asynchronous execution so that the caller can perform other tasks prior to calling <code class="literal">get()</code> on that Future.</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Async</span></i>
Future&lt;String&gt; returnSomething(<span class="hl-keyword">int</span> i) {
    <span class="hl-comment">// this will be executed asynchronously</span>
}</pre> 
    <p><code class="literal">@Async</code> can not be used in conjunction with lifecycle callbacks such as <code class="literal">@PostConstruct</code>. To asynchronously initialize Spring beans you currently have to use a separate initializing Spring bean that invokes the <code class="literal">@Async</code> annotated method on the target then.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SampleBeanImpl <span class="hl-keyword">implements</span> SampleBean {

    <i><span class="hl-annotation" style="color: gray">@Async</span></i>
    <span class="hl-keyword">void</span> doSomething() {
        <span class="hl-comment">// ...</span>
    }

}

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SampleBeanInititalizer {

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> SampleBean bean;

    <span class="hl-keyword">public</span> SampleBeanInitializer(SampleBean bean) {
        <span class="hl-keyword">this</span>.bean = bean;
    }

    <i><span class="hl-annotation" style="color: gray">@PostConstruct</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> initialize() {
        bean.doSomething();
    }

}</pre> 
   </div> 
   <div class="section" title="27.4.4&nbsp;Executor qualification with @Async">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="scheduling-annotation-support-qualification"></a>27.4.4&nbsp;Executor qualification with @Async</h3>
      </div>
     </div>
    </div> 
    <p>By default when specifying <code class="literal">@Async</code> on a method, the executor that will be used is the one supplied to the <span class="emphasis"><em>annotation-driven</em></span> element as described above. However, the <code class="literal">value</code> attribute of the <code class="literal">@Async</code> annotation can be used when needing to indicate that an executor other than the default should be used when executing a given method.</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Async(&quot;otherExecutor&quot;)</span></i>
<span class="hl-keyword">void</span> doSomething(String s) {
    <span class="hl-comment">// this will be executed asynchronously by &quot;otherExecutor&quot;</span>
}</pre> 
    <p>In this case, &quot;otherExecutor&quot; may be the name of any <code class="literal">Executor</code> bean in the Spring container, or may be the name of a <span class="emphasis"><em>qualifier</em></span> associated with any <code class="literal">Executor</code>, e.g. as specified with the <code class="literal">&lt;qualifier&gt;</code> element or Springs <code class="literal">@Qualifier</code> annotation.</p> 
   </div> 
  </div> 
  <div class="section" title="27.5&nbsp;The Task Namespace">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="scheduling-task-namespace"></a>27.5&nbsp;The Task Namespace</h2>
     </div>
    </div>
   </div> 
   <p>Beginning with Spring 3.0, there is an XML namespace for configuring <code class="literal">TaskExecutor</code> and <code class="literal">TaskScheduler</code> instances. It also provides a convenient way to configure tasks to be scheduled with a trigger.</p> 
   <div class="section" title="27.5.1&nbsp;The scheduler element">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="scheduling-task-namespace-scheduler"></a>27.5.1&nbsp;The <span class="emphasis"><em>scheduler</em></span> element</h3>
      </div>
     </div>
    </div> 
    <p>The following element will create a <code class="literal">ThreadPoolTaskScheduler</code> instance with the specified thread pool size.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;task:scheduler</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;scheduler&quot;</span> <span class="hl-attribute">pool-size</span>=<span class="hl-value">&quot;10&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <p>The value provided for the <span class="emphasis"><em>id</em></span> attribute will be used as the prefix for thread names within the pool. The <span class="emphasis"><em>scheduler</em></span> element is relatively straightforward. If you do not provide a <span class="emphasis"><em>pool-size</em></span> attribute, the default thread pool will only have a single thread. There are no other configuration options for the scheduler.</p> 
   </div> 
   <div class="section" title="27.5.2&nbsp;The executor element">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="scheduling-task-namespace-executor"></a>27.5.2&nbsp;The <span class="emphasis"><em>executor</em></span> element</h3>
      </div>
     </div>
    </div> 
    <p>The following will create a <code class="literal">ThreadPoolTaskExecutor</code> instance:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;task:executor</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;executor&quot;</span> <span class="hl-attribute">pool-size</span>=<span class="hl-value">&quot;10&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <p>As with the scheduler above, the value provided for the <span class="emphasis"><em>id</em></span> attribute will be used as the prefix for thread names within the pool. As far as the pool size is concerned, the <span class="emphasis"><em>executor</em></span> element supports more configuration options than the <span class="emphasis"><em>scheduler</em></span> element. For one thing, the thread pool for a <code class="literal">ThreadPoolTaskExecutor</code> is itself more configurable. Rather than just a single size, an executors thread pool may have different values for the <span class="emphasis"><em>core</em></span> and the <span class="emphasis"><em>max</em></span> size. If a single value is provided then the executor will have a fixed-size thread pool (the core and max sizes are the same). However, the <span class="emphasis"><em>executor</em></span> elements <span class="emphasis"><em>pool-size</em></span> attribute also accepts a range in the form of &quot;min-max&quot;.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;task:executor</span>
        <span class="hl-attribute">id</span>=<span class="hl-value">&quot;executorWithPoolSizeRange&quot;</span>
        <span class="hl-attribute">pool-size</span>=<span class="hl-value">&quot;5-25&quot;</span>
        <span class="hl-attribute">queue-capacity</span>=<span class="hl-value">&quot;100&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <p>As you can see from that configuration, a <span class="emphasis"><em>queue-capacity</em></span> value has also been provided. The configuration of the thread pool should also be considered in light of the executors queue capacity. For the full description of the relationship between pool size and queue capacity, consult the documentation for <a class="ulink" href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ThreadPoolExecutor.html" target="_top">ThreadPoolExecutor</a>. The main idea is that when a task is submitted, the executor will first try to use a free thread if the number of active threads is currently less than the core size. If the core size has been reached, then the task will be added to the queue as long as its capacity has not yet been reached. Only then, if the queues capacity <span class="emphasis"><em>has</em></span> been reached, will the executor create a new thread beyond the core size. If the max size has also been reached, then the executor will reject the task.</p> 
    <p>By default, the queue is <span class="emphasis"><em>unbounded</em></span>, but this is rarely the desired configuration, because it can lead to <code class="literal">OutOfMemoryErrors</code> if enough tasks are added to that queue while all pool threads are busy. Furthermore, if the queue is unbounded, then the max size has no effect at all. Since the executor will always try the queue before creating a new thread beyond the core size, a queue must have a finite capacity for the thread pool to grow beyond the core size (this is why a <span class="emphasis"><em>fixed size</em></span> pool is the only sensible case when using an unbounded queue).</p> 
    <p>In a moment, we will review the effects of the keep-alive setting which adds yet another factor to consider when providing a pool size configuration. First, lets consider the case, as mentioned above, when a task is rejected. By default, when a task is rejected, a thread pool executor will throw a <code class="literal">TaskRejectedException</code>. However, the rejection policy is actually configurable. The exception is thrown when using the default rejection policy which is the <code class="literal">AbortPolicy</code> implementation. For applications where some tasks can be skipped under heavy load, either the <code class="literal">DiscardPolicy</code> or <code class="literal">DiscardOldestPolicy</code> may be configured instead. Another option that works well for applications that need to throttle the submitted tasks under heavy load is the <code class="literal">CallerRunsPolicy</code>. Instead of throwing an exception or discarding tasks, that policy will simply force the thread that is calling the submit method to run the task itself. The idea is that such a caller will be busy while running that task and not able to submit other tasks immediately. Therefore it provides a simple way to throttle the incoming load while maintaining the limits of the thread pool and queue. Typically this allows the executor to &quot;catch up&quot; on the tasks it is handling and thereby frees up some capacity on the queue, in the pool, or both. Any of these options can be chosen from an enumeration of values available for the <span class="emphasis"><em>rejection-policy</em></span> attribute on the <span class="emphasis"><em>executor</em></span> element.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;task:executor</span>
        <span class="hl-attribute">id</span>=<span class="hl-value">&quot;executorWithCallerRunsPolicy&quot;</span>
        <span class="hl-attribute">pool-size</span>=<span class="hl-value">&quot;5-25&quot;</span>
        <span class="hl-attribute">queue-capacity</span>=<span class="hl-value">&quot;100&quot;</span>
        <span class="hl-attribute">rejection-policy</span>=<span class="hl-value">&quot;CALLER_RUNS&quot;</span><span class="hl-tag">/&gt;</span></pre> 
   </div> 
   <div class="section" title="27.5.3&nbsp;The scheduled-tasks element">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="scheduling-task-namespace-scheduled-tasks"></a>27.5.3&nbsp;The <span class="emphasis"><em>scheduled-tasks</em></span> element</h3>
      </div>
     </div>
    </div> 
    <p>The most powerful feature of Springs task namespace is the support for configuring tasks to be scheduled within a Spring Application Context. This follows an approach similar to other &quot;method-invokers&quot; in Spring, such as that provided by the JMS namespace for configuring Message-driven POJOs. Basically a &quot;ref&quot; attribute can point to any Spring-managed object, and the &quot;method&quot; attribute provides the name of a method to be invoked on that object. Here is a simple example.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;task:scheduled-tasks</span> <span class="hl-attribute">scheduler</span>=<span class="hl-value">&quot;myScheduler&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;task:scheduled</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;beanA&quot;</span> <span class="hl-attribute">method</span>=<span class="hl-value">&quot;methodA&quot;</span> <span class="hl-attribute">fixed-delay</span>=<span class="hl-value">&quot;5000&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/task:scheduled-tasks&gt;</span>

<span class="hl-tag">&lt;task:scheduler</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myScheduler&quot;</span> <span class="hl-attribute">pool-size</span>=<span class="hl-value">&quot;10&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <p>As you can see, the scheduler is referenced by the outer element, and each individual task includes the configuration of its trigger metadata. In the preceding example, that metadata defines a periodic trigger with a fixed delay indicating the number of milliseconds to wait after each task execution has completed. Another option is <span class="emphasis"><em>fixed-rate</em></span>, indicating how often the method should be executed regardless of how long any previous execution takes. Additionally, for both fixed-delay and fixed-rate tasks an <span class="emphasis"><em>initial-delay</em></span> parameter may be specified indicating the number of milliseconds to wait before the first execution of the method. For more control, a &quot;cron&quot; attribute may be provided instead. Here is an example demonstrating these other options.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;task:scheduled-tasks</span> <span class="hl-attribute">scheduler</span>=<span class="hl-value">&quot;myScheduler&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;task:scheduled</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;beanA&quot;</span> <span class="hl-attribute">method</span>=<span class="hl-value">&quot;methodA&quot;</span> <span class="hl-attribute">fixed-delay</span>=<span class="hl-value">&quot;5000&quot;</span> <span class="hl-attribute">initial-delay</span>=<span class="hl-value">&quot;1000&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;task:scheduled</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;beanB&quot;</span> <span class="hl-attribute">method</span>=<span class="hl-value">&quot;methodB&quot;</span> <span class="hl-attribute">fixed-rate</span>=<span class="hl-value">&quot;5000&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;task:scheduled</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;beanC&quot;</span> <span class="hl-attribute">method</span>=<span class="hl-value">&quot;methodC&quot;</span> <span class="hl-attribute">cron</span>=<span class="hl-value">&quot;*/5 * * * * MON-FRI&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/task:scheduled-tasks&gt;</span>

<span class="hl-tag">&lt;task:scheduler</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myScheduler&quot;</span> <span class="hl-attribute">pool-size</span>=<span class="hl-value">&quot;10&quot;</span><span class="hl-tag">/&gt;</span></pre> 
   </div> 
  </div> 
  <div class="section" title="27.6&nbsp;Using the Quartz Scheduler">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="scheduling-quartz"></a>27.6&nbsp;Using the Quartz Scheduler</h2>
     </div>
    </div>
   </div> 
   <p>Quartz uses <code class="literal">Trigger</code>, <code class="literal">Job</code> and <code class="literal">JobDetail</code> objects to realize scheduling of all kinds of jobs. For the basic concepts behind Quartz, have a look at <a class="ulink" href="http://quartz-scheduler.org/" target="_top">http://quartz-scheduler.org</a>. For convenience purposes, Spring offers a couple of classes that simplify the usage of Quartz within Spring-based applications.</p> 
   <div class="section" title="27.6.1&nbsp;Using the JobDetailBean">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="scheduling-quartz-jobdetail"></a>27.6.1&nbsp;Using the JobDetailBean</h3>
      </div>
     </div>
    </div> 
    <p><code class="literal">JobDetail</code> objects contain all information needed to run a job. The Spring Framework provides a <code class="literal">JobDetailBean</code> that makes the <code class="literal">JobDetail</code> more of an actual JavaBean with sensible defaults. Lets have a look at an example:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;exampleJob&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.scheduling.quartz.JobDetailBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;jobClass&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;example.ExampleJob&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;jobDataAsMap&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;map&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;timeout&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;5&quot;</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;/map&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>The job detail bean has all information it needs to run the job ( <code class="literal">ExampleJob</code>). The timeout is specified in the job data map. The job data map is available through the <code class="literal">JobExecutionContext</code> (passed to you at execution time), but the <code class="literal">JobDetailBean</code> also maps the properties from the job data map to properties of the actual job. So in this case, if the <code class="literal">ExampleJob</code> contains a property named <code class="literal">timeout</code>, the <code class="literal">JobDetailBean</code> will automatically apply it:</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> example;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleJob <span class="hl-keyword">extends</span> QuartzJobBean {

    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> timeout;

    <b class="hl-tag" style="color: blue">/**
     * Setter called after the ExampleJob is instantiated
     * with the value from the JobDetailBean (5)
     */</b>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setTimeout(<span class="hl-keyword">int</span> timeout) {
        <span class="hl-keyword">this</span>.timeout = timeout;
    }

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> executeInternal(JobExecutionContext ctx) <span class="hl-keyword">throws</span> JobExecutionException {
        <span class="hl-comment">// do the actual work</span>
    }

}</pre> 
    <p>All additional settings from the job detail bean are of course available to you as well.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Using the <code class="literal">name</code> and <code class="literal">group</code> properties, you can modify the name and the group of the job, respectively. By default, the name of the job matches the bean name of the job detail bean (in the example above, this is <code class="literal">exampleJob</code>).</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="27.6.2&nbsp;Using the MethodInvokingJobDetailFactoryBean">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="scheduling-quartz-method-invoking-job"></a>27.6.2&nbsp;Using the MethodInvokingJobDetailFactoryBean</h3>
      </div>
     </div>
    </div> 
    <p>Often you just need to invoke a method on a specific object. Using the <code class="literal">MethodInvokingJobDetailFactoryBean</code> you can do exactly this:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;jobDetail&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;targetObject&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;exampleBusinessObject&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;targetMethod&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;doIt&quot;</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>The above example will result in the <code class="literal">doIt</code> method being called on the <code class="literal">exampleBusinessObject</code> method (see below):</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBusinessObject {

    <span class="hl-comment">// properties and collaborators</span>

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doIt() {
        <span class="hl-comment">// do the actual work</span>
    }
}</pre> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exampleBusinessObject&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.ExampleBusinessObject&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <p>Using the <code class="literal">MethodInvokingJobDetailFactoryBean</code>, you dont need to create one-line jobs that just invoke a method, and you only need to create the actual business object and wire up the detail object.</p> 
    <p>By default, Quartz Jobs are stateless, resulting in the possibility of jobs interfering with each other. If you specify two triggers for the same <code class="literal">JobDetail</code>, it might be possible that before the first job has finished, the second one will start. If <code class="literal">JobDetail</code> classes implement the <code class="literal">Stateful</code> interface, this wont happen. The second job will not start before the first one has finished. To make jobs resulting from the <code class="literal">MethodInvokingJobDetailFactoryBean</code> non-concurrent, set the <code class="literal">concurrent</code> flag to <code class="literal">false</code>.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;jobDetail&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.scheduling.quartz.MethodInvokingJobDetailFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;targetObject&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;exampleBusinessObject&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;targetMethod&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;doIt&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;concurrent&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;false&quot;</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>By default, jobs will run in a concurrent fashion.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="27.6.3&nbsp;Wiring up jobs using triggers and the SchedulerFactoryBean">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="scheduling-quartz-cron"></a>27.6.3&nbsp;Wiring up jobs using triggers and the SchedulerFactoryBean</h3>
      </div>
     </div>
    </div> 
    <p>Weve created job details and jobs. Weve also reviewed the convenience bean that allows you to invoke a method on a specific object. Of course, we still need to schedule the jobs themselves. This is done using triggers and a <code class="literal">SchedulerFactoryBean</code>. Several triggers are available within Quartz and Spring offers two Quartz <code class="literal">FactoryBean</code> implementations with convenient defaults: <code class="literal">CronTriggerFactoryBean</code> and <code class="literal">SimpleTriggerFactoryBean</code>.</p> 
    <p>Triggers need to be scheduled. Spring offers a <code class="literal">SchedulerFactoryBean</code> that exposes triggers to be set as properties. <code class="literal">SchedulerFactoryBean</code> schedules the actual jobs with those triggers.</p> 
    <p>Find below a couple of examples:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;simpleTrigger&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.scheduling.quartz.SimpleTriggerFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- see the example of method invoking job above --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;jobDetail&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;jobDetail&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-comment">&lt;!-- 10 seconds --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;startDelay&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;10000&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-comment">&lt;!-- repeat every 50 seconds --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;repeatInterval&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;50000&quot;</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;cronTrigger&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.scheduling.quartz.CronTriggerFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;jobDetail&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;exampleJob&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-comment">&lt;!-- run every morning at 6 AM --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;cronExpression&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;0 0 6 * * ?&quot;</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>Now weve set up two triggers, one running every 50 seconds with a starting delay of 10 seconds and one every morning at 6 AM. To finalize everything, we need to set up the <code class="literal">SchedulerFactoryBean</code>:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.scheduling.quartz.SchedulerFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;triggers&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">&quot;cronTrigger&quot;</span><span class="hl-tag"> /&gt;</span>
            <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">&quot;simpleTrigger&quot;</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>More properties are available for the <code class="literal">SchedulerFactoryBean</code> for you to set, such as the calendars used by the job details, properties to customize Quartz with, etc. Have a look at the <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/scheduling/quartz/SchedulerFactoryBean.html" target="_top"><code class="literal">SchedulerFactoryBean Javadoc</code></a> for more information.</p> 
   </div> 
  </div> 
 </div> 
 <div class="chapter" title="28.&nbsp;Dynamic language support">
  <div class="titlepage">
   <div>
    <div>
     <h2 class="title"><a name="dynamic-language"></a>28.&nbsp;Dynamic language support</h2>
    </div>
   </div>
  </div> 
  <div class="section" title="28.1&nbsp;Introduction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="dynamic-language-introduction"></a>28.1&nbsp;Introduction</h2>
     </div>
    </div>
   </div> 
   <p>Spring 2.0 introduces comprehensive support for using classes and objects that have been defined using a dynamic language (such as JRuby) with Spring. This support allows you to write any number of classes in a supported dynamic language, and have the Spring container transparently instantiate, configure and dependency inject the resulting objects.</p> 
   <p>The dynamic languages currently supported are:</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem"> JRuby 1.5+ </li>
     <li class="listitem"> Groovy 1.8+ </li>
     <li class="listitem"> BeanShell 2.0 </li>
    </ul>
   </div> 
   <div class="sidebar" title="Why only these languages?">
    <p class="title"><b>Why only these languages?</b></p> 
    <p>The supported languages were chosen because <span class="emphasis"><em>a)</em></span> the languages have a lot of traction in the Java enterprise community, <span class="emphasis"><em>b)</em></span> no requests were made for other languages at the time that this support was added, and <span class="emphasis"><em>c)</em></span> the Spring developers were most familiar with them.</p> 
    <p>There is nothing stopping the inclusion of further languages though. If you want to see support for &lt;<span class="emphasis"><em>insert your favourite dynamic language here</em></span>&gt;, you can always raise an issue on Springs <a class="ulink" href="http://opensource.atlassian.com/projects/spring/secure/Dashboard.jspa" target="_top">JIRA</a> page (or implement such support yourself).</p> 
   </div> 
   <p>Fully working examples of where this dynamic language support can be immediately useful are described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#dynamic-language-scenarios" title="28.4&nbsp;Scenarios">Section&nbsp;28.4, Scenarios</a>.</p> 
  </div> 
  <div class="section" title="28.2&nbsp;A first example">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="dynamic-language-a-first-example"></a>28.2&nbsp;A first example</h2>
     </div>
    </div>
   </div> 
   <p>This bulk of this chapter is concerned with describing the dynamic language support in detail. Before diving into all of the ins and outs of the dynamic language support, lets look at a quick example of a bean defined in a dynamic language. The dynamic language for this first bean is Groovy (the basis of this example was taken from the Spring test suite, so if you want to see equivalent examples in any of the other supported languages, take a look at the source code).</p> 
   <p>Find below the <code class="literal">Messenger</code> interface that the Groovy bean is going to be implementing, and note that this interface is defined in plain Java. Dependent objects that are injected with a reference to the <code class="literal">Messenger</code> wont know that the underlying implementation is a Groovy script.</p> 
   <pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.scripting;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Messenger {

    String getMessage();

}</pre> 
   <p>Here is the definition of a class that has a dependency on the <code class="literal">Messenger</code> interface.</p> 
   <pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.scripting;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultBookingService <span class="hl-keyword">implements</span> BookingService {

    <span class="hl-keyword">private</span> Messenger messenger;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMessenger(Messenger messenger) {
        <span class="hl-keyword">this</span>.messenger = messenger;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> processBooking() {
        <span class="hl-comment">// use the injected Messenger object...</span>
    }

}</pre> 
   <p>Here is an implementation of the <code class="literal">Messenger</code> interface in Groovy.</p> 
   <pre class="programlisting"><span class="hl-comment">// from the file </span><span class="emphasis"><em>Messenger.groovy</em></span>
<span class="hl-keyword">package</span> org.springframework.scripting.groovy;

<span class="hl-comment">// import the Messenger interface (written in Java) that is to be implemented</span>
<span class="hl-keyword">import</span> org.springframework.scripting.Messenger

<span class="hl-comment">// define the implementation in Groovy</span>
<span class="hl-keyword">class</span> GroovyMessenger <span class="hl-keyword">implements</span> Messenger {

    String message

}</pre> 
   <p>Finally, here are the bean definitions that will effect the injection of the Groovy-defined <code class="literal">Messenger</code> implementation into an instance of the <code class="literal">DefaultBookingService</code> class.</p> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>To use the custom dynamic language tags to define dynamic-language-backed beans, you need to have the XML Schema preamble at the top of your Spring XML configuration file. You also need to be using a Spring <code class="literal">ApplicationContext</code> implementation as your IoC container. Using the dynamic-language-backed beans with a plain <code class="literal">BeanFactory</code> implementation is supported, but you have to manage the plumbing of the Spring internals to do so.</p> <p>For more information on schema-based configuration, see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#xsd-config" title="33.&nbsp;XML Schema-based configuration">Chapter&nbsp;33, <i>XML Schema-based configuration</i></a>.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span> <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:lang</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/lang&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- this is the bean definition for the Groovy-backed Messenger implementation --&gt;</span>
    <span class="hl-tag">&lt;lang:groovy</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;messenger&quot;</span> <span class="hl-attribute">script-source</span>=<span class="hl-value">&quot;classpath:Messenger.groovy&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;lang:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;message&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;I Can Do The Frug&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/lang:groovy&gt;</span>

    <span class="hl-comment">&lt;!-- an otherwise normal bean that will be injected by the Groovy-backed Messenger --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;bookingService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;x.y.DefaultBookingService&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;messenger&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;messenger&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
   <p>The <code class="literal">bookingService</code> bean (a <code class="literal">DefaultBookingService</code>) can now use its private <code class="literal">messenger</code> member variable as normal because the <code class="literal">Messenger</code> instance that was injected into it <span class="emphasis"><em>is</em></span> a <code class="literal">Messenger</code> instance. There is nothing special going on here, just plain Java and plain Groovy.</p> 
   <p>Hopefully the above XML snippet is self-explanatory, but dont worry unduly if it isnt. Keep reading for the in-depth detail on the whys and wherefores of the above configuration.</p> 
  </div> 
  <div class="section" title="28.3&nbsp;Defining beans that are backed by dynamic languages">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="dynamic-language-beans"></a>28.3&nbsp;Defining beans that are backed by dynamic languages</h2>
     </div>
    </div>
   </div> 
   <p>This section describes exactly how you define Spring managed beans in any of the supported dynamic languages.</p> 
   <p>Please note that this chapter does not attempt to explain the syntax and idioms of the supported dynamic languages. For example, if you want to use Groovy to write certain of the classes in your application, then the assumption is that you already know Groovy. If you need further details about the dynamic languages themselves, please consult <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#dynamic-language-resources" title="28.6&nbsp;Further Resources">Section&nbsp;28.6, Further Resources</a> at the end of this chapter.</p> 
   <div class="section" title="28.3.1&nbsp;Common concepts">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="dynamic-language-beans-concepts"></a>28.3.1&nbsp;Common concepts</h3>
      </div>
     </div>
    </div> 
    <p>The steps involved in using dynamic-language-backed beans are as follows:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> Write the test for the dynamic language source code (naturally) </li>
      <li class="listitem"> <span class="emphasis"><em>Then</em></span> write the dynamic language source code itself :) </li>
      <li class="listitem"> Define your dynamic-language-backed beans using the appropriate <code class="literal">&lt;lang:language/&gt;</code> element in the XML configuration (you can of course define such beans programmatically using the Spring API - although you will have to consult the source code for directions on how to do this as this type of advanced configuration is not covered in this chapter). Note this is an iterative step. You will need at least one bean definition per dynamic language source file (although the same dynamic language source file can of course be referenced by multiple bean definitions). </li>
     </ul>
    </div> 
    <p>The first two steps (testing and writing your dynamic language source files) are beyond the scope of this chapter. Refer to the language specification and / or reference manual for your chosen dynamic language and crack on with developing your dynamic language source files. You <span class="emphasis"><em>will</em></span> first want to read the rest of this chapter though, as Springs dynamic language support does make some (small) assumptions about the contents of your dynamic language source files.</p> 
    <div class="section" title="The &lt;lang:language/&gt; element">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="dynamic-language-beans-concepts-xml-language-element"></a>The &lt;lang:language/&gt; element</h4>
       </div>
      </div>
     </div> 
     <p>The final step involves defining dynamic-language-backed bean definitions, one for each bean that you want to configure (this is no different from normal JavaBean configuration). However, instead of specifying the fully qualified classname of the class that is to be instantiated and configured by the container, you use the <code class="literal">&lt;lang:language/&gt;</code> element to define the dynamic language-backed bean.</p> 
     <p>Each of the supported languages has a corresponding <code class="literal">&lt;lang:language/&gt;</code> element:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> <code class="literal">&lt;lang:jruby/&gt;</code> (JRuby) </li>
       <li class="listitem"> <code class="literal">&lt;lang:groovy/&gt;</code> (Groovy) </li>
       <li class="listitem"> <code class="literal">&lt;lang:bsh/&gt;</code> (BeanShell) </li>
      </ul>
     </div> 
     <p>The exact attributes and child elements that are available for configuration depends on exactly which language the bean has been defined in (the language-specific sections below provide the full lowdown on this).</p> 
    </div> 
    <div class="section" title="Refreshable beans">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="dynamic-language-refreshable-beans"></a>Refreshable beans</h4>
       </div>
      </div>
     </div> 
     <p>One of the (if not <span class="emphasis"><em>the</em></span>) most compelling value adds of the dynamic language support in Spring is the<span class="emphasis"><em>'refreshable bean'</em></span> feature.</p> 
     <p>A refreshable bean is a dynamic-language-backed bean that with a small amount of configuration, a dynamic-language-backed bean can monitor changes in its underlying source file resource, and then reload itself when the dynamic language source file is changed (for example when a developer edits and saves changes to the file on the filesystem).</p> 
     <p>This allows a developer to deploy any number of dynamic language source files as part of an application, configure the Spring container to create beans backed by dynamic language source files (using the mechanisms described in this chapter), and then later, as requirements change or some other external factor comes into play, simply edit a dynamic language source file and have any change they make reflected in the bean that is backed by the changed dynamic language source file. There is no need to shut down a running application (or redeploy in the case of a web application). The dynamic-language-backed bean so amended will pick up the new state and logic from the changed dynamic language source file.</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>Please note that this feature is <span class="emphasis"><em>off</em></span> by default.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <p>Lets take a look at an example to see just how easy it is to start using refreshable beans. To <span class="emphasis"><em>turn on</em></span> the refreshable beans feature, you simply have to specify exactly <span class="emphasis"><em>one</em></span> additional attribute on the <code class="literal">&lt;lang:language/&gt;</code> element of your bean definition. So if we stick with <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#dynamic-language-a-first-example" title="28.2&nbsp;A first example">the example</a> from earlier in this chapter, heres what we would change in the Spring XML configuration to effect refreshable beans:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>

    <span class="hl-comment">&lt;!-- this bean is now </span><span class="emphasis"><em>refreshable</em></span> due to the presence of the <span class="emphasis"><em>refresh-check-delay</em></span> attribute --&gt;
    <span class="hl-tag">&lt;lang:groovy</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;messenger&quot;</span>
            <span class="hl-attribute">refresh-check-delay</span>=<span class="hl-value">&quot;5000&quot;</span> <span class="hl-attribute">&lt;!--</span> <span class="hl-attribute">switches</span> <span class="hl-attribute">refreshing</span> <span class="hl-attribute">on</span> <span class="hl-attribute">with</span> <span class="hl-attribute">5</span> <span class="hl-attribute">seconds</span> <span class="hl-attribute">between</span> <span class="hl-attribute">checks</span> <span class="hl-attribute">--&gt;</span>
            <span class="hl-attribute">script-source</span>=<span class="hl-value">&quot;classpath:Messenger.groovy&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;lang:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;message&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;I Can Do The Frug&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/lang:groovy&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;bookingService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;x.y.DefaultBookingService&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;messenger&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;messenger&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
     <p>That really is all you have to do. The <code class="literal">'refresh-check-delay'</code> attribute defined on the <code class="literal">'messenger'</code> bean definition is the number of milliseconds after which the bean will be refreshed with any changes made to the underlying dynamic language source file. You can turn off the refresh behavior by assigning a negative value to the <code class="literal">'refresh-check-delay'</code> attribute. Remember that, by default, the refresh behavior is disabled. If you dont want the refresh behavior, then simply dont define the attribute.</p> 
     <p>If we then run the following application we can exercise the refreshable feature; please do excuse the <span class="emphasis"><em>'jumping-through-hoops-to-pause-the-execution'</em></span> shenanigans in this next slice of code. The <code class="literal">System.in.read()</code> call is only there so that the execution of the program pauses while I (the author) go off and edit the underlying dynamic language source file so that the refresh will trigger on the dynamic-language-backed bean when the program resumes execution.</p> 
     <pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.context.ApplicationContext;
<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;
<span class="hl-keyword">import</span> org.springframework.scripting.Messenger;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> Boot {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(<span class="hl-keyword">final</span> String[] args) <span class="hl-keyword">throws</span> Exception {
        ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">&quot;beans.xml&quot;</span>);
        Messenger messenger = (Messenger) ctx.getBean(<span class="hl-string">&quot;messenger&quot;</span>);
        System.out.println(messenger.getMessage());
        <span class="hl-comment">// pause execution while I go off and make changes to the source file...</span>
        System.in.read();
        System.out.println(messenger.getMessage());
    }
}</pre> 
     <p>Lets assume then, for the purposes of this example, that all calls to the <code class="literal">getMessage()</code> method of <code class="literal">Messenger</code> implementations have to be changed such that the message is surrounded by quotes. Below are the changes that I (the author) make to the <code class="literal">Messenger.groovy</code> source file when the execution of the program is paused.</p> 
     <pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.scripting

<span class="hl-keyword">class</span> GroovyMessenger <span class="hl-keyword">implements</span> Messenger {

    <span class="hl-keyword">private</span> String message = <span class="hl-string">&quot;Bingo&quot;</span>

    <span class="hl-keyword">public</span> String getMessage() {
        <span class="hl-comment">// change the implementation to surround the message in quotes</span>
        <span class="hl-keyword">return</span> <span class="hl-string">&quot;</span><span class="emphasis"><em>&quot; + this.message + &quot;</em></span><span class="hl-string">&quot;
</span>    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMessage(String message) {
        <span class="hl-keyword">this</span>.message = message
    }
}</pre> 
     <p>When the program executes, the output before the input pause will be <span class="emphasis"><em>I Can Do The Frug</em></span>. After the change to the source file is made and saved, and the program resumes execution, the result of calling the <code class="literal">getMessage()</code> method on the dynamic-language-backed <code class="literal">Messenger</code> implementation will be <span class="emphasis"><em>'I Can Do The Frug'</em></span> (notice the inclusion of the additional quotes).</p> 
     <p>It is important to understand that changes to a script will <span class="emphasis"><em>not</em></span> trigger a refresh if the changes occur within the window of the <code class="literal">'refresh-check-delay'</code> value. It is equally important to understand that changes to the script are <span class="emphasis"><em>not</em></span> actually <span class="emphasis"><em>picked up</em></span> until a method is called on the dynamic-language-backed bean. It is only when a method is called on a dynamic-language-backed bean that it checks to see if its underlying script source has changed. Any exceptions relating to refreshing the script (such as encountering a compilation error, or finding that the script file has been deleted) will result in a <span class="emphasis"><em>fatal</em></span> exception being propagated to the calling code.</p> 
     <p>The refreshable bean behavior described above does <span class="emphasis"><em>not</em></span> apply to dynamic language source files defined using the <code class="literal">&lt;lang:inline-script/&gt;</code> element notation (see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#dynamic-language-beans-inline" title="Inline dynamic language source files">the section called Inline dynamic language source files</a>). Additionally, it <span class="emphasis"><em>only</em></span> applies to beans where changes to the underlying source file can actually be detected; for example, by code that checks the last modified date of a dynamic language source file that exists on the filesystem.</p> 
    </div> 
    <div class="section" title="Inline dynamic language source files">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="dynamic-language-beans-inline"></a>Inline dynamic language source files</h4>
       </div>
      </div>
     </div> 
     <p>The dynamic language support can also cater for dynamic language source files that are embedded directly in Spring bean definitions. More specifically, the <code class="literal">&lt;lang:inline-script/&gt;</code> element allows you to define dynamic language source immediately inside a Spring configuration file. An example will perhaps make the inline script feature crystal clear:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;lang:groovy</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;messenger&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;lang:inline-script&gt;</span>

package org.springframework.scripting.groovy;

import org.springframework.scripting.Messenger

class GroovyMessenger implements Messenger {
    String message
}

    <span class="hl-tag">&lt;/lang:inline-script&gt;</span>
    <span class="hl-tag">&lt;lang:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;message&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;I Can Do The Frug&quot;</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/lang:groovy&gt;</span></pre> 
     <p>If we put to one side the issues surrounding whether it is good practice to define dynamic language source inside a Spring configuration file, the <code class="literal">&lt;lang:inline-script/&gt;</code> element can be useful in some scenarios. For instance, we might want to quickly add a Spring <code class="literal">Validator</code> implementation to a Spring MVC <code class="literal">Controller</code>. This is but a moments work using inline source. (See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#dynamic-language-scenarios-validators" title="28.4.2&nbsp;Scripted Validators">Section&nbsp;28.4.2, Scripted Validators</a> for such an example.)</p> 
     <p>Find below an example of defining the source for a JRuby-based bean directly in a Spring XML configuration file using the <code class="literal">inline:</code> notation. (Notice the use of the &lt; characters to denote a <code class="literal">'&lt;'</code> character. In such a case surrounding the inline source in a <code class="literal">&lt;![CDATA[]]&gt;</code> region might be better.)</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;lang:jruby</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;messenger&quot;</span> <span class="hl-attribute">script-interfaces</span>=<span class="hl-value">&quot;org.springframework.scripting.Messenger&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;lang:inline-script&gt;</span>

require <span class="emphasis"><em>java</em></span>

include_class <span class="emphasis"><em>org.springframework.scripting.Messenger</em></span>

class RubyMessenger &amp;lt; Messenger

    def setMessage(message)
        @@message = message
    end

    def getMessage
        @@message
    end

end

        <span class="hl-tag">&lt;/lang:inline-script&gt;</span>
    <span class="hl-tag">&lt;lang:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;message&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Hello World!&quot;</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/lang:jruby&gt;</span></pre> 
    </div> 
    <div class="section" title="Understanding Constructor Injection in the context of dynamic-language-backed beans">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="dynamic-language-beans-ctor-injection"></a>Understanding Constructor Injection in the context of dynamic-language-backed beans</h4>
       </div>
      </div>
     </div> 
     <p>There is one <span class="emphasis"><em>very</em></span> important thing to be aware of with regard to Springs dynamic language support. Namely, it is not (currently) possible to supply constructor arguments to dynamic-language-backed beans (and hence constructor-injection is not available for dynamic-language-backed beans). In the interests of making this special handling of constructors and properties 100% clear, the following mixture of code and configuration will <span class="emphasis"><em>not</em></span> work.</p> 
     <pre class="programlisting"><span class="hl-comment">// from the file </span><span class="emphasis"><em>Messenger.groovy</em></span>
<span class="hl-keyword">package</span> org.springframework.scripting.groovy;

<span class="hl-keyword">import</span> org.springframework.scripting.Messenger

<span class="hl-keyword">class</span> GroovyMessenger <span class="hl-keyword">implements</span> Messenger {

    GroovyMessenger() {}

    <span class="hl-comment">// this constructor is not available for Constructor Injection</span>
    GroovyMessenger(String message) {
        <span class="hl-keyword">this</span>.message = message;
    }

    String message

    String anotherMessage

}</pre> 
     <pre class="programlisting"><span class="hl-tag">&lt;lang:groovy</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;badMessenger&quot;</span>
    <span class="hl-attribute">script-source</span>=<span class="hl-value">&quot;classpath:Messenger.groovy&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- this next constructor argument will </span><span class="strong"><strong>not</strong></span> be injected into the GroovyMessenger --&gt;
    <span class="hl-comment">&lt;!-- in fact, this isn't even allowed according to the schema --&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;This will </span><span class="strong"><strong>not</strong></span> work&quot; /&gt;

    <span class="hl-comment">&lt;!-- only property values are injected into the dynamic-language-backed object --&gt;</span>
    <span class="hl-tag">&lt;lang:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;anotherMessage&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Passed straight through to the dynamic-language-backed object&quot;</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;/lang&gt;</span></pre> 
     <p>In practice this limitation is not as significant as it first appears since setter injection is the injection style favored by the overwhelming majority of developers anyway (lets leave the discussion as to whether that is a good thing to another day).</p> 
    </div> 
   </div> 
   <div class="section" title="28.3.2&nbsp;JRuby beans">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="dynamic-language-beans-jruby"></a>28.3.2&nbsp;JRuby beans</h3>
      </div>
     </div>
    </div> 
    <div class="sidebar" title="The JRuby library dependencies">
     <p class="title"><b>The JRuby library dependencies</b></p> 
     <p>The JRuby scripting support in Spring requires the following libraries to be on the classpath of your application.</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> <code class="literal">jruby.jar</code> </li>
      </ul>
     </div> 
    </div> 
    <p>From the JRuby homepage</p> 
    <p>&quot;<span class="emphasis"><em>JRuby is an 100% pure-Java implementation of the Ruby programming language.</em></span>&quot;</p> 
    <p>In keeping with the Spring philosophy of offering choice, Springs dynamic language support also supports beans defined in the JRuby language. The JRuby language is based on the quite intuitive Ruby language, and has support for inline regular expressions, blocks (closures), and a whole host of other features that do make solutions for some domain problems a whole lot easier to develop.</p> 
    <p>The implementation of the JRuby dynamic language support in Spring is interesting in that what happens is this: Spring creates a JDK dynamic proxy implementing all of the interfaces that are specified in the <code class="literal">'script-interfaces'</code> attribute value of the <code class="literal">&lt;lang:ruby&gt;</code> element (this is why you <span class="emphasis"><em>must</em></span> supply at least one interface in the value of the attribute, and (accordingly) program to interfaces when using JRuby-backed beans).</p> 
    <p>Let us look at a fully working example of using a JRuby-based bean. Here is the JRuby implementation of the <code class="literal">Messenger</code> interface that was defined earlier in this chapter (for your convenience it is repeated below).</p> 
    <pre class="programlisting">package org.springframework.scripting;

public interface Messenger {

    String getMessage();

}</pre> 
    <pre class="programlisting">require <span class="emphasis"><em>java</em></span>

<span class="hl-keyword">class</span> RubyMessenger
    include org.springframework.scripting.Messenger

    <span class="hl-keyword">def</span> setMessage(message)
        @@message = message
    <span class="hl-keyword">end</span>

    <span class="hl-keyword">def</span> getMessage
        @@message
    <span class="hl-keyword">end</span>
<span class="hl-keyword">end</span>

<span class="hl-comment"># this last line is not essential (but see below)</span>
RubyMessenger.new</pre> 
    <p>And here is the Spring XML that defines an instance of the <code class="literal">RubyMessenger</code> JRuby bean.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;lang:jruby</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;messageService&quot;</span>
        <span class="hl-attribute">script-interfaces</span>=<span class="hl-value">&quot;org.springframework.scripting.Messenger&quot;</span>
        <span class="hl-attribute">script-source</span>=<span class="hl-value">&quot;classpath:RubyMessenger.rb&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;lang:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;message&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Hello World!&quot;</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;/lang:jruby&gt;</span></pre> 
    <p>Take note of the last line of that JRuby source ( <code class="literal">'RubyMessenger.new'</code>). When using JRuby in the context of Springs dynamic language support, you are encouraged to instantiate and return a new instance of the JRuby class that you want to use as a dynamic-language-backed bean as the result of the execution of your JRuby source. You can achieve this by simply instantiating a new instance of your JRuby class on the last line of the source file like so:</p> 
    <pre class="programlisting">require <span class="emphasis"><em>java</em></span>

include_class <span class="emphasis"><em>org.springframework.scripting.Messenger</em></span>

<span class="hl-comment"># class definition same as above...</span>

<span class="hl-comment"># instantiate and return a new instance of the RubyMessenger class</span>
RubyMessenger.new</pre> 
    <p>If you forget to do this, it is not the end of the world; this will however result in Spring having to trawl (reflectively) through the type representation of your JRuby class looking for a class to instantiate. In the grand scheme of things this will be so fast that youll never notice it, but it is something that can be avoided by simply having a line such as the one above as the last line of your JRuby script. If you dont supply such a line, or if Spring cannot find a JRuby class in your script to instantiate then an opaque <code class="literal">ScriptCompilationException</code> will be thrown immediately after the source is executed by the JRuby interpreter. The key text that identifies this as the root cause of an exception can be found immediately below (so if your Spring container throws the following exception when creating your dynamic-language-backed bean and the following text is there in the corresponding stacktrace, this will hopefully allow you to identify and then easily rectify the issue):</p> 
    <pre class="literallayout">org.springframework.scripting.ScriptCompilationException: Compilation of JRuby script returned ''</pre> 
    <p>To rectify this, simply instantiate a new instance of whichever class you want to expose as a JRuby-dynamic-language-backed bean (as shown above). Please also note that you can actually define as many classes and objects as you want in your JRuby script; what is important is that the source file as a whole must return an object (for Spring to configure).</p> 
    <p>See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#dynamic-language-scenarios" title="28.4&nbsp;Scenarios">Section&nbsp;28.4, Scenarios</a> for some scenarios where you might want to use JRuby-based beans.</p> 
   </div> 
   <div class="section" title="28.3.3&nbsp;Groovy beans">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="dynamic-language-beans-groovy"></a>28.3.3&nbsp;Groovy beans</h3>
      </div>
     </div>
    </div> 
    <div class="sidebar" title="The Groovy library dependencies">
     <p class="title"><b>The Groovy library dependencies</b></p> 
     <p>The Groovy scripting support in Spring requires the following libraries to be on the classpath of your application.</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> <code class="literal">groovy-1.8.jar</code> </li>
       <li class="listitem"> <code class="literal">asm-3.2.jar</code> </li>
       <li class="listitem"> <code class="literal">antlr-2.7.7.jar</code> </li>
      </ul>
     </div> 
    </div> 
    <p>From the Groovy homepage</p> 
    <p>&quot;<span class="emphasis"><em>Groovy is an agile dynamic language for the Java 2 Platform that has many of the features that people like so much in languages like Python, Ruby and Smalltalk, making them available to Java developers using a Java-like syntax. </em></span>&quot;</p> 
    <p>If you have read this chapter straight from the top, you will already have <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#dynamic-language-a-first-example" title="28.2&nbsp;A first example">seen an example</a> of a Groovy-dynamic-language-backed bean. Lets look at another example (again using an example from the Spring test suite).</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.scripting;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Calculator {

    <span class="hl-keyword">int</span> add(<span class="hl-keyword">int</span> x, <span class="hl-keyword">int</span> y);

}</pre> 
    <p>Here is an implementation of the <code class="literal">Calculator</code> interface in Groovy.</p> 
    <pre class="programlisting">// from the file <span class="emphasis"><em>calculator.groovy</em></span>
package org.springframework.scripting.groovy

class GroovyCalculator implements Calculator {

    int add(int x, int y) {
        x + y
    }

}</pre> 
    <pre class="programlisting"><span class="hl-tag">&lt;--</span> <span class="hl-attribute">from</span> <span class="hl-attribute">the</span> <span class="hl-attribute">file</span> <span class="emphasis"><em>beans.xml</em></span> --&gt;
<span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;lang:groovy</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;calculator&quot;</span> <span class="hl-attribute">script-source</span>=<span class="hl-value">&quot;classpath:calculator.groovy&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>Lastly, here is a small application to exercise the above configuration.</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.scripting;

<span class="hl-keyword">import</span> org.springframework.context.ApplicationContext;
<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Main {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> Main(String[] args) {
        ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">&quot;beans.xml&quot;</span>);
        Calculator calc = (Calculator) ctx.getBean(<span class="hl-string">&quot;calculator&quot;</span>);
        System.out.println(calc.add(<span class="hl-number">2</span>, <span class="hl-number">8</span>));
    }
}</pre> 
    <p>The resulting output from running the above program will be (unsurprisingly) <span class="emphasis"><em>10</em></span>. (Exciting example, huh? Remember that the intent is to illustrate the concept. Please consult the dynamic language showcase project for a more complex example, or indeed <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#dynamic-language-scenarios" title="28.4&nbsp;Scenarios">Section&nbsp;28.4, Scenarios</a> later in this chapter).</p> 
    <p>It is important that you <span class="emphasis"><em>do not</em></span> define more than one class per Groovy source file. While this is perfectly legal in Groovy, it is (arguably) a bad practice: in the interests of a consistent approach, you should (in the opinion of this author) respect the standard Java conventions of one (public) class per source file.</p> 
    <div class="section" title="Customising Groovy objects via a callback">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="dynamic-language-beans-groovy-customizer"></a>Customising Groovy objects via a callback</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">GroovyObjectCustomizer</code> interface is a callback that allows you to hook additional creation logic into the process of creating a Groovy-backed bean. For example, implementations of this interface could invoke any required initialization method(s), or set some default property values, or specify a custom <code class="literal">MetaClass</code>.</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> GroovyObjectCustomizer {

    <span class="hl-keyword">void</span> customize(GroovyObject goo);

}</pre> 
     <p>The Spring Framework will instantiate an instance of your Groovy-backed bean, and will then pass the created <code class="literal">GroovyObject</code> to the specified <code class="literal">GroovyObjectCustomizer</code> if one has been defined. You can do whatever you like with the supplied <code class="literal">GroovyObject</code> reference: it is expected that the setting of a custom <code class="literal">MetaClass</code> is what most folks will want to do with this callback, and you can see an example of doing that below.</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> SimpleMethodTracingCustomizer <span class="hl-keyword">implements</span> GroovyObjectCustomizer {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> customize(GroovyObject goo) {
        DelegatingMetaClass metaClass = <span class="hl-keyword">new</span> DelegatingMetaClass(goo.getMetaClass()) {

            <span class="hl-keyword">public</span> Object invokeMethod(Object object, String methodName, Object[] arguments) {
                System.out.println(<span class="hl-string">&quot;Invoking </span><span class="emphasis"><em>&quot; + methodName + &quot;</em></span>.<span class="hl-string">&quot;);
</span>                <span class="hl-keyword">return</span> <span class="hl-keyword">super</span>.invokeMethod(object, methodName, arguments);
            }
        };
        metaClass.initialize();
        goo.setMetaClass(metaClass);
    }

}</pre> 
     <p>A full discussion of meta-programming in Groovy is beyond the scope of the Spring reference manual. Consult the relevant section of the Groovy reference manual, or do a search online: there are plenty of articles concerning this topic. Actually making use of a <code class="literal">GroovyObjectCustomizer</code> is easy if you are using the Spring namespace support.</p> 
     <pre class="programlisting"><span class="hl-comment">&lt;!-- define the GroovyObjectCustomizer just like any other bean --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;tracingCustomizer&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.SimpleMethodTracingCustomizer&quot;</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-comment">&lt;!-- ... and plug it into the desired Groovy bean via the </span><span class="emphasis"><em>customizer-ref</em></span> attribute --&gt;
    <span class="hl-tag">&lt;lang:groovy</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;calculator&quot;</span>
        <span class="hl-attribute">script-source</span>=<span class="hl-value">&quot;classpath:org/springframework/scripting/groovy/Calculator.groovy&quot;</span>
        <span class="hl-attribute">customizer-ref</span>=<span class="hl-value">&quot;tracingCustomizer&quot;</span><span class="hl-tag"> /&gt;</span></pre> 
     <p>If you are not using the Spring namespace support, you can still use the <code class="literal">GroovyObjectCustomizer</code> functionality.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;calculator&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.scripting.groovy.GroovyScriptFactory&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;classpath:org/springframework/scripting/groovy/Calculator.groovy&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-comment">&lt;!-- define the GroovyObjectCustomizer (as an inner bean) --&gt;</span>
    <span class="hl-tag">&lt;constructor-arg&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;tracingCustomizer&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.SimpleMethodTracingCustomizer&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/constructor-arg&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.scripting.support.ScriptFactoryPostProcessor&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    </div> 
   </div> 
   <div class="section" title="28.3.4&nbsp;BeanShell beans">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="dynamic-language-beans-bsh"></a>28.3.4&nbsp;BeanShell beans</h3>
      </div>
     </div>
    </div> 
    <div class="sidebar" title="The BeanShell library dependencies">
     <p class="title"><b>The BeanShell library dependencies</b></p> 
     <p>The BeanShell scripting support in Spring requires the following libraries to be on the classpath of your application.</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> <code class="literal">bsh-2.0b4.jar</code> </li>
      </ul>
     </div> 
    </div> 
    <p>From the BeanShell homepage</p> 
    <p>&quot;<span class="emphasis"><em>BeanShell is a small, free, embeddable Java source interpreter with dynamic language features, written in Java. BeanShell dynamically executes standard Java syntax and extends it with common scripting conveniences such as loose types, commands, and method closures like those in Perl and JavaScript.</em></span>&quot;</p> 
    <p>In contrast to Groovy, BeanShell-backed bean definitions require some (small) additional configuration. The implementation of the BeanShell dynamic language support in Spring is interesting in that what happens is this: Spring creates a JDK dynamic proxy implementing all of the interfaces that are specified in the <code class="literal">'script-interfaces'</code> attribute value of the <code class="literal">&lt;lang:bsh&gt;</code> element (this is why you <span class="emphasis"><em>must</em></span> supply at least one interface in the value of the attribute, and (accordingly) program to interfaces when using BeanShell-backed beans). This means that every method call on a BeanShell-backed object is going through the JDK dynamic proxy invocation mechanism.</p> 
    <p>Lets look at a fully working example of using a BeanShell-based bean that implements the <code class="literal">Messenger</code> interface that was defined earlier in this chapter (repeated below for your convenience).</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.scripting;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Messenger {

    String getMessage();

}</pre> 
    <p>Here is the BeanShell <span class="emphasis"><em>implementation</em></span> (the term is used loosely here) of the <code class="literal">Messenger</code> interface.</p> 
    <pre class="programlisting">String message;

String getMessage() {
    <span class="hl-keyword">return</span> message;
}

<span class="hl-keyword">void</span> setMessage(String aMessage) {
    message = aMessage;
}</pre> 
    <p>And here is the Spring XML that defines an <span class="emphasis"><em>instance</em></span> of the above <span class="emphasis"><em>class</em></span> (again, the term is used very loosely here).</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;lang:bsh</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;messageService&quot;</span> <span class="hl-attribute">script-source</span>=<span class="hl-value">&quot;classpath:BshMessenger.bsh&quot;</span>
    <span class="hl-attribute">script-interfaces</span>=<span class="hl-value">&quot;org.springframework.scripting.Messenger&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;lang:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;message&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Hello World!&quot;</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/lang:bsh&gt;</span></pre> 
    <p>See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#dynamic-language-scenarios" title="28.4&nbsp;Scenarios">Section&nbsp;28.4, Scenarios</a> for some scenarios where you might want to use BeanShell-based beans.</p> 
   </div> 
  </div> 
  <div class="section" title="28.4&nbsp;Scenarios">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="dynamic-language-scenarios"></a>28.4&nbsp;Scenarios</h2>
     </div>
    </div>
   </div> 
   <p>The possible scenarios where defining Spring managed beans in a scripting language would be beneficial are, of course, many and varied. This section describes two possible use cases for the dynamic language support in Spring.</p> 
   <div class="section" title="28.4.1&nbsp;Scripted Spring MVC Controllers">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="dynamic-language-scenarios-controllers"></a>28.4.1&nbsp;Scripted Spring MVC Controllers</h3>
      </div>
     </div>
    </div> 
    <p>One group of classes that may benefit from using dynamic-language-backed beans is that of Spring MVC controllers. In pure Spring MVC applications, the navigational flow through a web application is to a large extent determined by code encapsulated within your Spring MVC controllers. As the navigational flow and other presentation layer logic of a web application needs to be updated to respond to support issues or changing business requirements, it may well be easier to effect any such required changes by editing one or more dynamic language source files and seeing those changes being immediately reflected in the state of a running application.</p> 
    <p>Remember that in the lightweight architectural model espoused by projects such as Spring, you are typically aiming to have a really <span class="emphasis"><em>thin</em></span> presentation layer, with all the meaty business logic of an application being contained in the domain and service layer classes. Developing Spring MVC controllers as dynamic-language-backed beans allows you to change presentation layer logic by simply editing and saving text files; any changes to such dynamic language source files will (depending on the configuration) automatically be reflected in the beans that are backed by dynamic language source files.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>In order to effect this automatic <span class="emphasis"><em>pickup</em></span> of any changes to dynamic-language-backed beans, you will have had to enable the <span class="emphasis"><em>refreshable beans</em></span> functionality. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#dynamic-language-refreshable-beans" title="Refreshable beans">the section called Refreshable beans</a> for a full treatment of this feature.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>Find below an example of an <code class="literal">org.springframework.web.servlet.mvc.Controller</code> implemented using the Groovy dynamic language.</p> 
    <pre class="programlisting"><span class="hl-comment">// from the file </span><span class="emphasis"><em>/WEB-INF/groovy/FortuneController.groovy</em></span>
<span class="hl-keyword">package</span> org.springframework.showcase.fortune.web

<span class="hl-keyword">import</span> org.springframework.showcase.fortune.service.FortuneService
<span class="hl-keyword">import</span> org.springframework.showcase.fortune.domain.Fortune
<span class="hl-keyword">import</span> org.springframework.web.servlet.ModelAndView
<span class="hl-keyword">import</span> org.springframework.web.servlet.mvc.Controller

<span class="hl-keyword">import</span> javax.servlet.http.HttpServletRequest
<span class="hl-keyword">import</span> javax.servlet.http.HttpServletResponse

<span class="hl-keyword">class</span> FortuneController <span class="hl-keyword">implements</span> Controller {

    <i><span class="hl-annotation" style="color: gray">@Property</span></i> FortuneService fortuneService

    ModelAndView handleRequest(HttpServletRequest request,
            HttpServletResponse httpServletResponse) {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> ModelAndView(<span class="hl-string">&quot;tell&quot;</span>, <span class="hl-string">&quot;fortune&quot;</span>, <span class="hl-keyword">this</span>.fortuneService.tellFortune())
    }

}</pre> 
    <pre class="programlisting"><span class="hl-tag">&lt;lang:groovy</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;fortune&quot;</span>
        <span class="hl-attribute">refresh-check-delay</span>=<span class="hl-value">&quot;3000&quot;</span>
        <span class="hl-attribute">script-source</span>=<span class="hl-value">&quot;/WEB-INF/groovy/FortuneController.groovy&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;lang:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;fortuneService&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;fortuneService&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/lang:groovy&gt;</span></pre> 
   </div> 
   <div class="section" title="28.4.2&nbsp;Scripted Validators">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="dynamic-language-scenarios-validators"></a>28.4.2&nbsp;Scripted Validators</h3>
      </div>
     </div>
    </div> 
    <p>Another area of application development with Spring that may benefit from the flexibility afforded by dynamic-language-backed beans is that of validation. It <span class="emphasis"><em>may</em></span> be easier to express complex validation logic using a loosely typed dynamic language (that may also have support for inline regular expressions) as opposed to regular Java.</p> 
    <p>Again, developing validators as dynamic-language-backed beans allows you to change validation logic by simply editing and saving a simple text file; any such changes will (depending on the configuration) automatically be reflected in the execution of a running application and would not require the restart of an application.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Please note that in order to effect the automatic <span class="emphasis"><em>pickup</em></span> of any changes to dynamic-language-backed beans, you will have had to enable the <span class="emphasis"><em>refreshable beans</em></span> feature. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#dynamic-language-refreshable-beans" title="Refreshable beans">the section called Refreshable beans</a> for a full and detailed treatment of this feature.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>Find below an example of a Spring <code class="literal">org.springframework.validation.Validator</code> implemented using the Groovy dynamic language. (See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#validator" title="6.2&nbsp;Validation using Springs Validator interface">Section&nbsp;6.2, Validation using Springs Validator interface</a> for a discussion of the <code class="literal">Validator</code> interface.)</p> 
    <pre class="programlisting">import org.springframework.validation.Validator
import org.springframework.validation.Errors
import org.springframework.beans.TestBean

class TestBeanValidator implements Validator {

    boolean supports(Class clazz) {
        return TestBean.class.isAssignableFrom(clazz)
    }

    void validate(Object bean, Errors errors) {
        if(bean.name?.trim()?.size() &gt; 0) {
            return
        }
        errors.reject(&quot;whitespace&quot;, &quot;Cannot be composed wholly of whitespace.&quot;)
    }

}</pre> 
   </div> 
  </div> 
  <div class="section" title="28.5&nbsp;Bits and bobs">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="dynamic-language-final-notes"></a>28.5&nbsp;Bits and bobs</h2>
     </div>
    </div>
   </div> 
   <p>This last section contains some bits and bobs related to the dynamic language support.</p> 
   <div class="section" title="28.5.1&nbsp;AOP - advising scripted beans">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="dynamic-language-final-notes-aop"></a>28.5.1&nbsp;AOP - advising scripted beans</h3>
      </div>
     </div>
    </div> 
    <p>It is possible to use the Spring AOP framework to advise scripted beans. The Spring AOP framework actually is unaware that a bean that is being advised might be a scripted bean, so all of the AOP use cases and functionality that you may be using or aim to use will work with scripted beans. There is just one (small) thing that you need to be aware of when advising scripted beans you cannot use class-based proxies, you must use <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-proxying" title="8.6&nbsp;Proxying mechanisms">interface-based proxies</a>.</p> 
    <p>You are of course not just limited to advising scripted beans you can also write aspects themselves in a supported dynamic language and use such beans to advise other Spring beans. This really would be an advanced use of the dynamic language support though.</p> 
   </div> 
   <div class="section" title="28.5.2&nbsp;Scoping">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="dynamic-language-final-notes-scopes"></a>28.5.2&nbsp;Scoping</h3>
      </div>
     </div>
    </div> 
    <p>In case it is not immediately obvious, scripted beans can of course be scoped just like any other bean. The <code class="literal">scope</code> attribute on the various <code class="literal">&lt;lang:language/&gt;</code> elements allows you to control the scope of the underlying scripted bean, just as it does with a regular bean. (The default scope is <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes-singleton" title="4.5.1&nbsp;The singleton scope">singleton</a>, just as it is with <span class="emphasis"><em>regular</em></span> beans.)</p> 
    <p>Find below an example of using the <code class="literal">scope</code> attribute to define a Groovy bean scoped as a <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes-prototype" title="4.5.2&nbsp;The prototype scope">prototype</a>.</p> 
    <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span> <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:lang</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/lang&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/lang http://www.springframework.org/schema/lang/spring-lang.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;lang:groovy</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;messenger&quot;</span> <span class="hl-attribute">script-source</span>=<span class="hl-value">&quot;classpath:Messenger.groovy&quot;</span> <span class="hl-attribute">scope</span>=<span class="hl-value">&quot;prototype&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;lang:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;message&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;I Can Do The RoboCop&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/lang:groovy&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;bookingService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;x.y.DefaultBookingService&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;messenger&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;messenger&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes" title="4.5&nbsp;Bean scopes">Section&nbsp;4.5, Bean scopes</a> in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans" title="4.&nbsp;The IoC container">Chapter&nbsp;4, <i>The IoC container</i></a> for a fuller discussion of the scoping support in the Spring Framework.</p> 
   </div> 
  </div> 
  <div class="section" title="28.6&nbsp;Further Resources">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="dynamic-language-resources"></a>28.6&nbsp;Further Resources</h2>
     </div>
    </div>
   </div> 
   <p>Find below links to further resources about the various dynamic languages described in this chapter.</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem"> The <a class="ulink" href="http://jruby.codehaus.org/" target="_top">JRuby</a> homepage </li>
     <li class="listitem"> The <a class="ulink" href="http://groovy.codehaus.org/" target="_top">Groovy</a> homepage </li>
     <li class="listitem"> The <a class="ulink" href="http://www.beanshell.org/" target="_top">BeanShell</a> homepage </li>
    </ul>
   </div> 
   <p>Some of the more active members of the Spring community have also added support for a number of additional dynamic languages above and beyond the ones covered in this chapter. While it is possible that such third party contributions may be added to the list of languages supported by the main Spring distribution, your best bet for seeing if your favourite scripting language is supported is the <a class="ulink" href="https://springmodules.dev.java.net/" target="_top">Spring Modules project</a>.</p> 
  </div> 
 </div> 
 <div class="chapter" title="29.&nbsp;Cache Abstraction">
  <div class="titlepage">
   <div>
    <div>
     <h2 class="title"><a name="cache"></a>29.&nbsp;Cache Abstraction</h2>
    </div>
   </div>
  </div> 
  <div class="section" title="29.1&nbsp;Introduction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="cache-introduction"></a>29.1&nbsp;Introduction</h2>
     </div>
    </div>
   </div> 
   <p>Since version 3.1, Spring Framework provides support for transparently adding caching into an existing Spring application. Similar to the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#transaction" title="11.&nbsp;Transaction Management">transaction</a> support, the caching abstraction allows consistent use of various caching solutions with minimal impact on the code.</p> 
  </div> 
  <div class="section" title="29.2&nbsp;Understanding the cache abstraction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="cache-strategies"></a>29.2&nbsp;Understanding the cache abstraction</h2>
     </div>
    </div>
   </div> 
   <div class="sidebar" title="Cache vs Buffer">
    <p class="title"><b>Cache vs Buffer</b></p> 
    <p>The terms &quot;buffer&quot; and &quot;cache&quot; tend to be used interchangeably; note however they represent different things. A buffer is used traditionally as an intermediate temporary store for data between a fast and a slow entity. As one party would have to <span class="emphasis"><em>wait</em></span> for the other affecting performance, the buffer alleviates this by allowing entire blocks of data to move at once rather then in small chunks. The data is written and read only once from the buffer. Furthermore, the buffers are <span class="emphasis"><em>visible</em></span> to at least one party which is aware of it.</p> 
    <p>A cache on the other hand by definition is hidden and neither party is aware that caching occurs.It as well improves performance but does that by allowing the same data to be read multiple times in a fast fashion.</p> 
    <p>A further explanation of the differences between two can be found <a class="ulink" href="http://en.wikipedia.org/wiki/Cache#The_difference_between_buffer_and_cache" target="_top">here</a>.</p> 
   </div> 
   <p>At its core, the abstraction applies caching to Java methods, reducing thus the number of executions based on the information available in the cache. That is, each time a <span class="emphasis"><em>targeted</em></span> method is invoked, the abstraction will apply a caching behavior checking whether the method has been already executed for the given arguments. If it has, then the cached result is returned without having to execute the actual method; if it has not, then method is executed, the result cached and returned to the user so that, the next time the method is invoked, the cached result is returned. This way, expensive methods (whether CPU or IO bound) can be executed only once for a given set of parameters and the result reused without having to actually execute the method again. The caching logic is applied transparently without any interference to the invoker.</p> 
   <div class="important" title="Important" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Important">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="./Spring Framework Reference Documentation_files/important.png" /></td>
       <th align="left">Important</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>Obviously this approach works only for methods that are guaranteed to return the same output (result) for a given input (or arguments) no matter how many times it is being executed.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <p>To use the cache abstraction, the developer needs to take care of two aspects:</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem"> caching declaration - identify the methods that need to be cached and their policy </li>
     <li class="listitem"> cache configuration - the backing cache where the data is stored and read from </li>
    </ul>
   </div> 
   <p>Note that just like other services in Spring Framework, the caching service is an abstraction (not a cache implementation) and requires the use of an actual storage to store the cache data - that is, the abstraction frees the developer from having to write the caching logic but does not provide the actual stores. There are two integrations available out of the box, for JDK <code class="literal">java.util.concurrent.ConcurrentMap</code> and <a class="ulink" href="http://ehcache.org/" target="_top">EhCache</a> - see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#cache-plug" title="29.6&nbsp;Plugging-in different back-end caches">Section&nbsp;29.6, Plugging-in different back-end caches</a> for more information on plugging in other cache stores/providers.</p> 
  </div> 
  <div class="section" title="29.3&nbsp;Declarative annotation-based caching">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="cache-annotations"></a>29.3&nbsp;Declarative annotation-based caching</h2>
     </div>
    </div>
   </div> 
   <p>For caching declaration, the abstraction provides two Java annotations: <code class="literal">@Cacheable</code> and <code class="literal">@CacheEvict</code> which allow methods to trigger cache population or cache eviction. Let us take a closer look at each annotation:</p> 
   <div class="section" title="29.3.1&nbsp;@Cacheable annotation">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cache-annotations-cacheable"></a>29.3.1&nbsp;@Cacheable annotation</h3>
      </div>
     </div>
    </div> 
    <p>As the name implies, <code class="literal">@Cacheable</code> is used to demarcate methods that are cacheable - that is, methods for whom the result is stored into the cache so on subsequent invocations (with the same arguments), the value in the cache is returned without having to actually execute the method. In its simplest form, the annotation declaration requires the name of the cache associated with the annotated method:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Cacheable(&quot;books&quot;)</span></i>
<span class="hl-keyword">public</span> Book findBook(ISBN isbn) {...}</pre> 
    <p>In the snippet above, the method <code class="literal">findBook</code> is associated with the cache named <code class="literal">books</code>. Each time the method is called, the cache is checked to see whether the invocation has been already executed and does not have to be repeated. While in most cases, only one cache is declared, the annotation allows multiple names to be specified so that more then one cache are being used. In this case, each of the caches will be checked before executing the method - if at least one cache is hit, then the associated value will be returned:</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>All the other caches that do not contain the method will be updated as well even though the cached method was not actually executed.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Cacheable({ &quot;books&quot;, &quot;isbns&quot; })</span></i>
<span class="hl-keyword">public</span> Book findBook(ISBN isbn) {...}</pre> 
    <div class="section" title="Default Key Generation">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="cache-annotations-cacheable-default-key"></a>Default Key Generation</h4>
       </div>
      </div>
     </div> 
     <p>Since caches are essentially key-value stores, each invocation of a cached method needs to be translated into a suitable key for cache access. Out of the box, the caching abstraction uses a simple <code class="literal">KeyGenerator</code> based on the following algorithm:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> If no params are given, return <code class="literal">SimpleKey.EMPTY</code>. </li>
       <li class="listitem"> If only one param is given, return that instance. </li>
       <li class="listitem"> If more the one param is given, return a <code class="literal">SimpleKey</code> containing all parameters. </li>
      </ul>
     </div> 
     <p>This approach works well for most use-cases; As long as parameters have <span class="emphasis"><em>natural keys</em></span> and implement valid <code class="literal">hashCode()</code> and <code class="literal">equals()</code> methods. If that is not the case the the strategy needs to be changed.</p> 
     <p>To provide a different <span class="emphasis"><em>default</em></span> key generator, one needs to implement the <code class="literal">org.springframework.cache.KeyGenerator</code> interface. Once configured, the generator will be used for each declaration that does not specify its own key generation strategy (see below).</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>The default key generation strategy changed with the release of Spring 4.0. Earlier versions of Spring used a key generation strategy that, for multiple key parameters, only considered the <code class="literal">hashCode()</code> of parameters and not <code class="literal">equals()</code>; this could cause unexpected key collisions (see <a class="ulink" href="https://jira.springsource.org/browse/SPR-10237" target="_top">SPR-10237</a> for background). The new <span class="emphasis"><em>SimpleKeyGenerator</em></span> uses a compound key for such scenarios.</p> <p>If you want to keep using the previous key strategy, you can configure the deprecated <code class="literal">org.springframework.cache.interceptor.DefaultKeyGenerator</code> class or create a custom hash-based <span class="emphasis"><em>KeyGenerator</em></span> implementation.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="Custom Key Generation Declaration">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="cache-annotations-cacheable-key"></a>Custom Key Generation Declaration</h4>
       </div>
      </div>
     </div> 
     <p>Since caching is generic, it is quite likely the target methods have various signatures that cannot be simply mapped on top of the cache structure. This tends to become obvious when the target method has multiple arguments out of which only some are suitable for caching (while the rest are used only by the method logic). For example:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Cacheable(&quot;books&quot;)</span></i>
<span class="hl-keyword">public</span> Book findBook(ISBN isbn, <span class="hl-keyword">boolean</span> checkWarehouse, <span class="hl-keyword">boolean</span> includeUsed)</pre> 
     <p>At first glance, while the two <code class="literal">boolean</code> arguments influence the way the book is found, they are no use for the cache. Further more what if only one of the two is important while the other is not?</p> 
     <p>For such cases, the <code class="literal">@Cacheable</code> annotation allows the user to specify how the key is generated through its <code class="literal">key</code> attribute. The developer can use <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#expressions" title="7.&nbsp;Spring Expression Language (SpEL)">SpEL</a> to pick the arguments of interest (or their nested properties), perform operations or even invoke arbitrary methods without having to write any code or implement any interface. This is the recommended approach over the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#cache-annotations-cacheable-default-key" title="Default Key Generation">default</a> generator since methods tend to be quite different in signatures as the code base grows; while the default strategy might work for some methods, it rarely does for all methods.</p> 
     <p>Below are some examples of various SpEL declarations - if you are not familiar with it, do yourself a favour and read <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#expressions" title="7.&nbsp;Spring Expression Language (SpEL)">Chapter&nbsp;7, <i>Spring Expression Language (SpEL)</i></a>:</p> 
     <pre class="programlisting">@Cacheable(value=<span class="hl-string">&quot;books&quot;</span>, <span class="strong"><strong>key=&quot;#isbn&quot;)</strong></span>
<span class="hl-keyword">public</span> Book findBook(ISBN isbn, <span class="hl-keyword">boolean</span> checkWarehouse, <span class="hl-keyword">boolean</span> includeUsed)

@Cacheable(value=<span class="hl-string">&quot;books&quot;</span>, <span class="strong"><strong>key=&quot;#isbn.rawNumber&quot;</strong></span>)
<span class="hl-keyword">public</span> Book findBook(ISBN isbn, <span class="hl-keyword">boolean</span> checkWarehouse, <span class="hl-keyword">boolean</span> includeUsed)

@Cacheable(value=<span class="hl-string">&quot;books&quot;</span>, <span class="strong"><strong>key=&quot;T(someType).hash(#isbn)&quot;</strong></span>)
<span class="hl-keyword">public</span> Book findBook(ISBN isbn, <span class="hl-keyword">boolean</span> checkWarehouse, <span class="hl-keyword">boolean</span> includeUsed)</pre> 
     <p>The snippets above, show how easy it is to select a certain argument, one of its properties or even an arbitrary (static) method.</p> 
    </div> 
    <div class="section" title="Conditional caching">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="cache-annotations-cacheable-condition"></a>Conditional caching</h4>
       </div>
      </div>
     </div> 
     <p>Sometimes, a method might not be suitable for caching all the time (for example, it might depend on the given arguments). The cache annotations support such functionality through the <code class="literal">conditional</code> parameter which takes a <code class="literal">SpEL</code> expression that is evaluated to either <code class="literal">true</code> or <code class="literal">false</code>. If <code class="literal">true</code>, the method is cached - if not, it behaves as if the method is not cached, that is executed every since time no matter what values are in the cache or what arguments are used. A quick example - the following method will be cached, only if the argument <code class="literal">name</code> has a length shorter then 32:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Cacheable(value=&quot;book&quot;, condition=&quot;#name.length &lt; 32&quot;)</span></i>
<span class="hl-keyword">public</span> Book findBook(String name)</pre> 
     <p>In addition the <code class="literal">conditional</code> parameter, the <code class="literal">unless</code> parameter can be used to veto the adding of a value to the cache. Unlike <code class="literal">conditional</code>, <code class="literal">unless</code> expressions are evaluated <span class="emphasis"><em>after</em></span> the method has been called. Expanding on the previous example - perhaps we only want to cache paperback books:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Cacheable(value=&quot;book&quot;, condition=&quot;#name.length &lt; 32&quot;, unless=&quot;#result.hardback&quot;)</span></i>
<span class="hl-keyword">public</span> Book findBook(String name)</pre> 
    </div> 
    <div class="section" title="Available caching SpEL evaluation context">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="cache-spel-context"></a>Available caching SpEL evaluation context</h4>
       </div>
      </div>
     </div> 
     <p>Each <code class="literal">SpEL</code> expression evaluates again a dedicated <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#expressions-language-ref" title="7.5&nbsp;Language Reference"><code class="literal">context</code></a>. In addition to the build in parameters, the framework provides dedicated caching related metadata such as the argument names. The next table lists the items made available to the context so one can use them for key and conditional(see next section) computations:</p> 
     <div class="table">
      <a name="cache-spel-context-tbl"></a>
      <p class="title"><b>Table&nbsp;29.1.&nbsp;Cache SpEL available metadata</b></p>
      <div class="table-contents"> 
       <table summary="Cache SpEL available metadata" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
        <colgroup>
         <col />
         <col />
         <col />
         <col />
        </colgroup>
        <thead>
         <tr>
          <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Name</th>
          <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Location</th>
          <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th>
          <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Example</th>
         </tr>
        </thead>
        <tbody>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>methodName</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>root object</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The name of the method being invoked</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">#root.methodName</code></p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>method</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>root object</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The method being invoked</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">#root.method.name</code></p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>target</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>root object</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The target object being invoked</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">#root.target</code></p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>targetClass</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>root object</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The class of the target being invoked</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">#root.targetClass</code></p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>args</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>root object</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The arguments (as array) used for invoking the target</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">#root.args[0]</code></p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>caches</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>root object</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Collection of caches against which the current method is executed</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">#root.caches[0].name</code></p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><span class="emphasis"><em>argument name</em></span></p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>evaluation context</p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of any of the method argument. If for some reason the names are not available (ex: no debug information), the argument names are also available under the <code class="literal">a&lt;#arg&gt;</code> where <span class="emphasis"><em>#arg</em></span> stands for the argument index (starting from 0).</p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">iban</code> or <code class="literal">a0</code> (one can also use <code class="literal">p0</code> or <code class="literal">p&lt;#arg&gt;</code> notation as an alias).</p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>result</p></td>
          <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>evaluation context</p></td>
          <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>The result of the method call (the value to be cached). Only available in ' <code class="literal">unless</code>' expressions and ' <code class="literal">cache evict</code>' expression (when <code class="literal">beforeInvocation</code> is <code class="literal">false</code>).</p></td>
          <td style="" align="left" valign="top"><p><code class="literal">#result</code></p></td>
         </tr>
        </tbody>
       </table> 
      </div>
     </div>
     <br class="table-break" /> 
    </div> 
   </div> 
   <div class="section" title="29.3.2&nbsp;@CachePut annotation">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cache-annotations-put"></a>29.3.2&nbsp;@CachePut annotation</h3>
      </div>
     </div>
    </div> 
    <p>For cases where the cache needs to be updated without interfering with the method execution, one can use the <code class="literal">@CachePut</code> annotation. That is, the method will always be executed and its result placed into the cache (according to the <code class="literal">@CachePut</code> options). It supports the same options as <code class="literal">@Cacheable</code> and should be used for cache population rather then method flow optimization.</p> 
    <p>Note that using <code class="literal">@CachePut</code> and <code class="literal">@Cacheable</code> annotations on the same method is generally discouraged because they have different behaviors. While the latter causes the method execution to be skipped by using the cache, the former forces the execution in order to execute a cache update. This leads to unexpected behavior and with the exception of specific corner-cases (such as annotations having conditions that exclude them from each other), such declarations should be avoided.</p> 
   </div> 
   <div class="section" title="29.3.3&nbsp;@CacheEvict annotation">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cache-annotations-evict"></a>29.3.3&nbsp;@CacheEvict annotation</h3>
      </div>
     </div>
    </div> 
    <p>The cache abstraction allows not just population of a cache store but also eviction. This process is useful for removing stale or unused data from the cache. Opposed to <code class="literal">@Cacheable</code>, annotation <code class="literal">@CacheEvict</code> demarcates methods that perform cache <span class="emphasis"><em>eviction</em></span>, that is methods that act as triggers for removing data from the cache. Just like its sibling, <code class="literal">@CacheEvict</code> requires one to specify one (or multiple) caches that are affected by the action, allows a key or a condition to be specified but in addition, features an extra parameter <code class="literal">allEntries</code> which indicates whether a cache-wide eviction needs to be performed rather then just an entry one (based on the key):</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@CacheEvict(value = &quot;books&quot;, allEntries=true)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> loadBooks(InputStream batch)</pre> 
    <p>This option comes in handy when an entire cache region needs to be cleared out - rather then evicting each entry (which would take a long time since it is inefficient), all the entires are removed in one operation as shown above. Note that the framework will ignore any key specified in this scenario as it does not apply (the entire cache is evicted not just one entry).</p> 
    <p>One can also indicate whether the eviction should occur after (the default) or before the method executes through the <code class="literal">beforeInvocation</code> attribute. The former provides the same semantics as the rest of the annotations - once the method completes successfully, an action (in this case eviction) on the cache is executed. If the method does not execute (as it might be cached) or an exception is thrown, the eviction does not occur. The latter ( <code class="literal">beforeInvocation=true</code>) causes the eviction to occur always, before the method is invoked - this is useful in cases where the eviction does not need to be tied to the method outcome.</p> 
    <p>It is important to note that void methods can be used with <code class="literal">@CacheEvict</code> - as the methods act as triggers, the return values are ignored (as they dont interact with the cache) - this is not the case with <code class="literal">@Cacheable</code> which adds/update data into the cache and thus requires a result.</p> 
   </div> 
   <div class="section" title="29.3.4&nbsp;@Caching annotation">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cache-annotations-caching"></a>29.3.4&nbsp;@Caching annotation</h3>
      </div>
     </div>
    </div> 
    <p>There are cases when multiple annotations of the same type, such as <code class="literal">@CacheEvict</code> or <code class="literal">@CachePut</code> need to be specified, for example because the condition or the key expression is different between different caches. Unfortunately Java does not support such declarations however there is a workaround - using a <span class="emphasis"><em>enclosing</em></span> annotation, in this case, <code class="literal">@Caching</code>. <code class="literal">@Caching</code> allows multiple nested <code class="literal">@Cacheable</code>, <code class="literal">@CachePut</code> and <code class="literal">@CacheEvict</code> to be used on the same method:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Caching(evict = { @CacheEvict(&quot;primary&quot;), @CacheEvict(value = &quot;secondary&quot;, key = &quot;#p0&quot;) })</span></i>
<span class="hl-keyword">public</span> Book importBooks(String deposit, Date date)</pre> 
   </div> 
   <div class="section" title="29.3.5&nbsp;Enable caching annotations">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cache-annotation-enable"></a>29.3.5&nbsp;Enable caching annotations</h3>
      </div>
     </div>
    </div> 
    <p>It is important to note that even though declaring the cache annotations does not automatically triggers their actions - like many things in Spring, the feature has to be declaratively enabled (which means if you ever suspect caching is to blame, you can disable it by removing only one configuration line rather then all the annotations in your code).</p> 
    <p>To enable caching annotations add the annotation <code class="literal">@EnableCaching</code> to one of your <code class="literal">@Configuration</code> classes:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableCaching</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {
}</pre> 
    <p>Alternatively for XML configuration use the <code class="literal">cache:annotation-driven</code> element:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:cache</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/cache&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/cache http://www.springframework.org/schema/cache/spring-cache.xsd&quot;</span><span class="hl-tag">&gt;</span>

        <span class="hl-tag">&lt;cache:annotation-driven /&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>Both the <code class="literal">cache:annotation-driven</code> element and <code class="literal">@EnableCaching</code> annotation allow various options to be specified that influence the way the caching behavior is added to the application through AOP. The configuration is intentionally similar with that of <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#tx-annotation-driven-settings" title="Table&nbsp;11.2.&nbsp;Annotation driven transaction settings"><code class="literal">@Transactional</code></a>:</p> 
    <div class="table">
     <a name="cache-annotation-driven-settings"></a>
     <p class="title"><b>Table&nbsp;29.2.&nbsp;Cache annotation settings</b></p>
     <div class="table-contents"> 
      <table summary="Cache annotation settings" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
       <colgroup>
        <col />
        <col />
        <col />
        <col />
       </colgroup>
       <thead>
        <tr>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">XML Attribute</th>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Annotation Attribute</th>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Default</th>
         <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">cache-manager</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>N/A (See <code class="literal">CachingConfigurer</code> Javadoc)</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>cacheManager</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of cache manager to use. Only required if the name of the cache manager is not <code class="literal">cacheManager</code>, as in the example above.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">mode</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">mode</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>proxy</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The default mode &quot;proxy&quot; processes annotated beans to be proxied using Springs AOP framework (following proxy semantics, as discussed above, applying to method calls coming in through the proxy only). The alternative mode &quot;aspectj&quot; instead weaves the affected classes with Springs AspectJ caching aspect, modifying the target class byte code to apply to any kind of method call. AspectJ weaving requires spring-aspects.jar in the classpath as well as load-time weaving (or compile-time weaving) enabled. (See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-aj-ltw-spring" title="Spring configuration">the section called Spring configuration</a> for details on how to set up load-time weaving.)</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">proxy-target-class</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">proxyTargetClass</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>false</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Applies to proxy mode only. Controls what type of caching proxies are created for classes annotated with the <code class="literal">@Cacheable</code> or <code class="literal">@CacheEvict</code> annotations. If the <code class="literal">proxy-target-class</code> attribute is set to <code class="literal">true</code>, then class-based proxies are created. If <code class="literal">proxy-target-class</code> is <code class="literal">false</code> or if the attribute is omitted, then standard JDK interface-based proxies are created. (See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-proxying" title="8.6&nbsp;Proxying mechanisms">Section&nbsp;8.6, Proxying mechanisms</a> for a detailed examination of the different proxy types.)</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">order</code></p></td>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">order</code></p></td>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Ordered.LOWEST_PRECEDENCE</p></td>
         <td style="" align="left" valign="top"><p>Defines the order of the cache advice that is applied to beans annotated with <code class="literal">@Cacheable</code> or <code class="literal">@CacheEvict</code>. (For more information about the rules related to ordering of AOP advice, see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-ataspectj-advice-ordering" title="Advice ordering">the section called Advice ordering</a>.) No specified ordering means that the AOP subsystem determines the order of the advice.</p></td>
        </tr>
       </tbody>
      </table> 
     </div>
    </div>
    <br class="table-break" /> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p><code class="literal">&lt;cache:annotation-driven/&gt;</code> only looks for <code class="literal">@Cacheable/@CacheEvict</code> on beans in the same application context it is defined in. This means that, if you put <code class="literal">&lt;cache:annotation-driven/&gt;</code> in a <code class="literal">WebApplicationContext</code> for a <code class="literal">DispatcherServlet</code>, it only checks for <code class="literal">@Cacheable/@CacheEvict</code> beans in your controllers, and not your services. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-servlet" title="16.2&nbsp;The DispatcherServlet">Section&nbsp;16.2, The DispatcherServlet</a> for more information.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <div class="sidebar" title="Method visibility and @Cacheable / @CachePut / @CacheEvict">
     <p class="title"><b>Method visibility and @Cacheable / @CachePut / @CacheEvict</b></p> 
     <p>When using proxies, you should apply the <code class="literal">@Cache*</code> annotations only to methods with <span class="emphasis"><em>public</em></span> visibility. If you do annotate protected, private or package-visible methods with these annotations, no error is raised, but the annotated method does not exhibit the configured caching settings. Consider the use of AspectJ (see below) if you need to annotate non-public methods as it changes the bytecode itself.</p> 
    </div> 
    <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Tip">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
        <th align="left">Tip</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Spring recommends that you only annotate concrete classes (and methods of concrete classes) with the <code class="literal">@Cache*</code> annotation, as opposed to annotating interfaces. You certainly can place the <code class="literal">@Cache*</code> annotation on an interface (or an interface method), but this works only as you would expect it to if you are using interface-based proxies. The fact that Java annotations are <span class="emphasis"><em>not inherited from interfaces</em></span> means that if you are using class-based proxies ( <code class="literal">proxy-target-class=&quot;true&quot;</code>) or the weaving-based aspect ( <code class="literal">mode=&quot;aspectj&quot;</code>), then the caching settings are not recognized by the proxying and weaving infrastructure, and the object will not be wrapped in a caching proxy, which would be decidedly <span class="emphasis"><em>bad</em></span>.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>In proxy mode (which is the default), only external method calls coming in through the proxy are intercepted. This means that self-invocation, in effect, a method within the target object calling another method of the target object, will not lead to an actual caching at runtime even if the invoked method is marked with <code class="literal">@Cacheable</code> - considering using the aspectj mode in this case.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="29.3.6&nbsp;Using custom annotations">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cache-annotation-stereotype"></a>29.3.6&nbsp;Using custom annotations</h3>
      </div>
     </div>
    </div> 
    <p>The caching abstraction allows you to use your own annotations to identify what method trigger cache population or eviction. This is quite handy as a template mechanism as it eliminates the need to duplicate cache annotation declarations (especially useful if the key or condition are specified) or if the foreign imports (<code class="literal">org.springframework</code>) are not allowed in your code base. Similar to the rest of the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-stereotype-annotations" title="4.10.1&nbsp;@Component and further stereotype annotations">stereotype</a> annotations, both <code class="literal">@Cacheable</code> and <code class="literal">@CacheEvict</code> can be used as <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-meta-annotations" title="4.10.2&nbsp;Meta-annotations">meta-annotations</a>, that is annotations that can annotate other annotations. To wit, let us replace a common <code class="literal">@Cacheable</code> declaration with our own, custom annotation:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></i>
<i><span class="hl-annotation" style="color: gray">@Target({ElementType.METHOD})</span></i>
<i><span class="hl-annotation" style="color: gray">@Cacheable(value=&quot;books&quot;, key=&quot;#isbn&quot;)</span></i>
<span class="hl-keyword">public</span> <i><span class="hl-annotation" style="color: gray">@interface</span></i> SlowService {
}</pre> 
    <p>Above, we have defined our own <code class="literal">SlowService</code> annotation which itself is annotated with <code class="literal">@Cacheable</code> - now we can replace the following code:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Cacheable(value=&quot;books&quot;, key=&quot;#isbn&quot;)</span></i>
<span class="hl-keyword">public</span> Book findBook(ISBN isbn, <span class="hl-keyword">boolean</span> checkWarehouse, <span class="hl-keyword">boolean</span> includeUsed)</pre> 
    <p>with:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@SlowService</span></i>
<span class="hl-keyword">public</span> Book findBook(ISBN isbn, <span class="hl-keyword">boolean</span> checkWarehouse, <span class="hl-keyword">boolean</span> includeUsed)</pre> 
    <p>Even though <code class="literal">@SlowService</code> is not a Spring annotation, the container automatically picks up its declaration at runtime and understands its meaning. Note that as mentioned <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#cache-annotation-enable" title="29.3.5&nbsp;Enable caching annotations">above</a>, the annotation-driven behavior needs to be enabled.</p> 
   </div> 
  </div> 
  <div class="section" title="29.4&nbsp;Declarative XML-based caching">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="cache-declarative-xml"></a>29.4&nbsp;Declarative XML-based caching</h2>
     </div>
    </div>
   </div> 
   <p>If annotations are not an option (no access to the sources or no external code), one can use XML for declarative caching. So instead of annotating the methods for caching, one specifies the target method and the caching directives externally (similar to the declarative transaction management <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#transaction-declarative-first-example" title="11.5.2&nbsp;Example of declarative transaction implementation">advice</a>). The previous example can be translated into:</p> 
   <pre class="programlisting"><span class="hl-comment">&lt;!-- the service we want to make cacheable --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;bookService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;x.y.service.DefaultBookService&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-comment">&lt;!-- cache definitions --&gt;</span>
<span class="hl-tag">&lt;cache:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;cacheAdvice&quot;</span> <span class="hl-attribute">cache-manager</span>=<span class="hl-value">&quot;cacheManager&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;cache:caching</span> <span class="hl-attribute">cache</span>=<span class="hl-value">&quot;books&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;cache:cacheable</span> <span class="hl-attribute">method</span>=<span class="hl-value">&quot;findBook&quot;</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;#isbn&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;cache:cache-evict</span> <span class="hl-attribute">method</span>=<span class="hl-value">&quot;loadBooks&quot;</span> <span class="hl-attribute">all-entries</span>=<span class="hl-value">&quot;true&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/cache:caching&gt;</span>
<span class="hl-tag">&lt;/cache:advice&gt;</span>

<span class="hl-comment">&lt;!-- apply the cacheable behavior to all BookService interfaces --&gt;</span>
<span class="hl-tag">&lt;aop:config&gt;</span>
    <span class="hl-tag">&lt;aop:advisor</span> <span class="hl-attribute">advice-ref</span>=<span class="hl-value">&quot;cacheAdvice&quot;</span> <span class="hl-attribute">pointcut</span>=<span class="hl-value">&quot;execution(* x.y.BookService.*(..))&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/aop:config&gt;</span>

<span class="hl-comment">&lt;!-- cache manager definition omitted --&gt;</span></pre> 
   <p>In the configuration above, the <code class="literal">bookService</code> is made cacheable. The caching semantics to apply are encapsulated in the <code class="literal">cache:advice</code> definition which instructs method <code class="literal">findBooks</code> to be used for putting data into the cache while method <code class="literal">loadBooks</code> for evicting data. Both definitions are working against the <code class="literal">books</code> cache.</p> 
   <p>The <code class="literal">aop:config</code> definition applies the cache advice to the appropriate points in the program by using the AspectJ pointcut expression (more information is available in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop" title="8.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;8, <i>Aspect Oriented Programming with Spring</i></a>). In the example above, all methods from the <code class="literal">BookService</code> are considered and the cache advice applied to them.</p> 
   <p>The declarative XML caching supports all of the annotation-based model so moving between the two should be fairly easy - further more both can be used inside the same application. The XML based approach does not touch the target code however it is inherently more verbose; when dealing with classes with overloaded methods that are targeted for caching, identifying the proper methods does take an extra effort since the <code class="literal">method</code> argument is not a good discriminator - in these cases, the AspectJ pointcut can be used to cherry pick the target methods and apply the appropriate caching functionality. However through XML, it is easier to apply a package/group/interface-wide caching (again due to the AspectJ pointcut) and to create template-like definitions (as we did in the example above by defining the target cache through the <code class="literal">cache:definitions</code> <code class="literal">cache</code> attribute).</p> 
  </div> 
  <div class="section" title="29.5&nbsp;Configuring the cache storage">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="cache-store-configuration"></a>29.5&nbsp;Configuring the cache storage</h2>
     </div>
    </div>
   </div> 
   <p>Out of the box, the cache abstraction provides integration with two storages - one on top of the JDK <code class="literal">ConcurrentMap</code> and one for <a class="ulink" href="http://ehcache.org/" target="_top">EhCache</a> library. To use them, one needs to simply declare an appropriate <code class="literal">CacheManager</code> - an entity that controls and manages <code class="literal">Cache</code> s and can be used to retrieve these for storage.</p> 
   <div class="section" title="29.5.1&nbsp;JDK ConcurrentMap-based Cache">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cache-store-configuration-jdk"></a>29.5.1&nbsp;JDK ConcurrentMap-based Cache</h3>
      </div>
     </div>
    </div> 
    <p>The JDK-based <code class="literal">Cache</code> implementation resides under <code class="literal">org.springframework.cache.concurrent</code> package. It allows one to use <code class="literal">ConcurrentHashMap</code> as a backing <code class="literal">Cache</code> store.</p> 
    <pre class="programlisting"><span class="hl-comment">&lt;!-- generic cache manager --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;cacheManager&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.cache.support.SimpleCacheManager&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;caches&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;set&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.cache.concurrent.ConcurrentMapCacheFactoryBean&quot;</span> <span class="hl-attribute">p:name</span>=<span class="hl-value">&quot;default&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.cache.concurrent.ConcurrentMapCacheFactoryBean&quot;</span> <span class="hl-attribute">p:name</span>=<span class="hl-value">&quot;books&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/set&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>The snippet above uses the <code class="literal">SimpleCacheManager</code> to create a <code class="literal">CacheManager</code> for the two nested <code class="literal">ConcurrentMapCache</code> instances named <span class="emphasis"><em>default</em></span> and <span class="emphasis"><em>books</em></span>. Note that the names are configured directly for each cache.</p> 
    <p>As the cache is created by the application, it is bound to its lifecycle, making it suitable for basic use cases, tests or simple applications. The cache scales well and is very fast but it does not provide any management or persistence capabilities nor eviction contracts.</p> 
   </div> 
   <div class="section" title="29.5.2&nbsp;EhCache-based Cache">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cache-store-configuration-ehcache"></a>29.5.2&nbsp;EhCache-based Cache</h3>
      </div>
     </div>
    </div> 
    <p>The EhCache implementation is located under <code class="literal">org.springframework.cache.ehcache</code> package. Again, to use it, one simply needs to declare the appropriate <code class="literal">CacheManager</code>:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;cacheManager&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.cache.ehcache.EhCacheCacheManager&quot;</span> <span class="hl-attribute">p:cache-manager-ref</span>=<span class="hl-value">&quot;ehcache&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-comment">&lt;!-- EhCache library setup --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;ehcache&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.cache.ehcache.EhCacheManagerFactoryBean&quot;</span> <span class="hl-attribute">p:config-location</span>=<span class="hl-value">&quot;ehcache.xml&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <p>This setup bootstraps ehcache library inside Spring IoC (through bean <code class="literal">ehcache</code>) which is then wired into the dedicated <code class="literal">CacheManager</code> implementation. Note the entire ehcache-specific configuration is read from the resource <code class="literal">ehcache.xml</code>.</p> 
   </div> 
   <div class="section" title="29.5.3&nbsp;GemFire-based Cache">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cache-store-configuration-gemfire"></a>29.5.3&nbsp;GemFire-based Cache</h3>
      </div>
     </div>
    </div> 
    <p>GemFire is a memory-oriented/disk-backed, elastically scalable, continuously available, active (with built-in pattern-based subscription notifications), globally replicated database and provides fully-featured edge caching. For further information on how to use GemFire as a CacheManager (and more), please refer to the <a class="ulink" href="http://docs.spring.io/spring-gemfire/docs/current/reference/htmlsingle/" target="_top">Spring GemFire reference documentation</a>.</p> 
   </div> 
   <div class="section" title="29.5.4&nbsp;Dealing with caches without a backing store">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="cache-store-configuration-noop"></a>29.5.4&nbsp;Dealing with caches without a backing store</h3>
      </div>
     </div>
    </div> 
    <p>Sometimes when switching environments or doing testing, one might have cache declarations without an actual backing cache configured. As this is an invalid configuration, at runtime an exception will be through since the caching infrastructure is unable to find a suitable store. In situations like this, rather then removing the cache declarations (which can prove tedious), one can wire in a simple, dummy cache that performs no caching - that is, forces the cached methods to be executed every time:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;cacheManager&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.cache.support.CompositeCacheManager&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;cacheManagers&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">&quot;jdkCache&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">&quot;gemfireCache&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/