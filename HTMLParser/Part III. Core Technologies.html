<div class="part" title="Part&nbsp;III.&nbsp;Core Technologies">
 <div class="titlepage">
  <div>
   <div>
    <h1 class="title"><a name="spring-core"></a>Part&nbsp;III.&nbsp;Core Technologies</h1>
   </div>
  </div>
 </div> 
 <div class="partintro" title="Core Technologies">
  <div></div> 
  <p>This part of the reference documentation covers all of those technologies that are absolutely integral to the Spring Framework.</p> 
  <p>Foremost amongst these is the Spring Frameworks Inversion of Control (IoC) container. A thorough treatment of the Spring Frameworks IoC container is closely followed by comprehensive coverage of Springs Aspect-Oriented Programming (AOP) technologies. The Spring Framework has its own AOP framework, which is conceptually easy to understand, and which successfully addresses the 80% sweet spot of AOP requirements in Java enterprise programming.</p> 
  <p>Coverage of Springs integration with AspectJ (currently the richest - in terms of features - and certainly most mature AOP implementation in the Java enterprise space) is also provided.</p> 
  <p>Finally, the adoption of the test-driven-development (TDD) approach to software development is certainly advocated by the Spring team, and so coverage of Springs support for integration testing is covered (alongside best practices for unit testing). The Spring team has found that the correct use of IoC certainly does make both unit and integration testing easier (in that the presence of setter methods and appropriate constructors on classes makes them easier to wire together in a test without having to set up service locator registries and suchlike) the chapter dedicated solely to testing will hopefully convince you of this as well.</p> 
  <div class="itemizedlist">
   <ul class="itemizedlist" type="disc">
    <li class="listitem"> <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans" title="4.&nbsp;The IoC container">Chapter&nbsp;4, <i>The IoC container</i></a> </li>
    <li class="listitem"> <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#resources" title="5.&nbsp;Resources">Chapter&nbsp;5, <i>Resources</i></a> </li>
    <li class="listitem"> <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#validation" title="6.&nbsp;Validation, Data Binding, and Type Conversion">Chapter&nbsp;6, <i>Validation, Data Binding, and Type Conversion</i></a> </li>
    <li class="listitem"> <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#expressions" title="7.&nbsp;Spring Expression Language (SpEL)">Chapter&nbsp;7, <i>Spring Expression Language (SpEL)</i></a> </li>
    <li class="listitem"> <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop" title="8.&nbsp;Aspect Oriented Programming with Spring">Chapter&nbsp;8, <i>Aspect Oriented Programming with Spring</i></a> </li>
    <li class="listitem"> <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-api" title="9.&nbsp;Spring AOP APIs">Chapter&nbsp;9, <i>Spring AOP APIs</i></a> </li>
    <li class="listitem"> <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testing" title="10.&nbsp;Testing">Chapter&nbsp;10, <i>Testing</i></a> </li>
   </ul>
  </div> 
 </div> 
 <div class="chapter" title="4.&nbsp;The IoC container">
  <div class="titlepage">
   <div>
    <div>
     <h2 class="title"><a name="beans"></a>4.&nbsp;The IoC container</h2>
    </div>
   </div>
  </div> 
  <div class="section" title="4.1&nbsp;Introduction to the Spring IoC container and beans">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="beans-introduction"></a>4.1&nbsp;Introduction to the Spring IoC container and beans</h2>
     </div>
    </div>
   </div> 
   <p>This chapter covers the Spring Framework implementation of the Inversion of Control (IoC) <sup>[<a name="d4e640" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#ftn.d4e640" class="footnote">1</a>]</sup> principle. IoC is also known as <span class="emphasis"><em>dependency injection</em></span> (DI). It is a process whereby objects define their dependencies, that is, the other objects they work with, only through constructor arguments, arguments to a factory method, or properties that are set on the object instance after it is constructed or returned from a factory method. The container then <span class="emphasis"><em>injects</em></span> those dependencies when it creates the bean. This process is fundamentally the inverse, hence the name <span class="emphasis"><em>Inversion of Control</em></span> (IoC), of the bean itself controlling the instantiation or location of its dependencies by using direct construction of classes, or a mechanism such as the <span class="emphasis"><em>Service Locator</em></span> pattern.</p> 
   <p>The <code class="literal">org.springframework.beans</code> and <code class="literal">org.springframework.context</code> packages are the basis for Spring Frameworks IoC container. The <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/beans/factory/BeanFactory.html" target="_top"><code class="literal">BeanFactory</code></a> interface provides an advanced configuration mechanism capable of managing any type of object. <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/context/ApplicationContext.html" target="_top"><code class="literal">ApplicationContext</code></a> is a sub-interface of <code class="literal">BeanFactory</code>. It adds easier integration with Springs AOP features; message resource handling (for use in internationalization), event publication; and application-layer specific contexts such as the <code class="literal">WebApplicationContext</code> for use in web applications.</p> 
   <p>In short, the <code class="literal">BeanFactory</code> provides the configuration framework and basic functionality, and the <code class="literal">ApplicationContext</code> adds more enterprise-specific functionality. The <code class="literal">ApplicationContext</code> is a complete superset of the <code class="literal">BeanFactory</code>, and is used exclusively in this chapter in descriptions of Springs IoC container. For more information on using the <code class="literal">BeanFactory</code> instead of the <code class="literal">ApplicationContext,</code> refer to <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-beanfactory" title="4.17&nbsp;The BeanFactory">Section&nbsp;4.17, The BeanFactory</a>.</p> 
   <p>In Spring, the objects that form the backbone of your application and that are managed by the Spring IoC <span class="emphasis"><em>container</em></span> are called <span class="emphasis"><em>beans</em></span>. A bean is an object that is instantiated, assembled, and otherwise managed by a Spring IoC container. Otherwise, a bean is simply one of many objects in your application. Beans, and the <span class="emphasis"><em>dependencies</em></span> among them, are reflected in the <span class="emphasis"><em>configuration metadata</em></span> used by a container.</p> 
  </div> 
  <div class="section" title="4.2&nbsp;Container overview">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="beans-basics"></a>4.2&nbsp;Container overview</h2>
     </div>
    </div>
   </div> 
   <p>The interface <code class="literal">org.springframework.context.ApplicationContext</code> represents the Spring IoC container and is responsible for instantiating, configuring, and assembling the aforementioned beans. The container gets its instructions on what objects to instantiate, configure, and assemble by reading configuration metadata. The configuration metadata is represented in XML, Java annotations, or Java code. It allows you to express the objects that compose your application and the rich interdependencies between such objects.</p> 
   <p>Several implementations of the <code class="literal">ApplicationContext</code> interface are supplied out-of-the-box with Spring. In standalone applications it is common to create an instance of <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/context/support/ClassPathXmlApplicationContext.html" target="_top"><code class="literal">ClassPathXmlApplicationContext</code></a> or <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/context/support/FileSystemXmlApplicationContext.html" target="_top"><code class="literal">FileSystemXmlApplicationContext</code></a>. While XML has been the traditional format for defining configuration metadata you can instruct the container to use Java annotations or code as the metadata format by providing a small amount of XML configuration to declaratively enable support for these additional metadata formats.</p> 
   <p>In most application scenarios, explicit user code is not required to instantiate one or more instances of a Spring IoC container. For example, in a web application scenario, a simple eight (or so) lines of boilerplate web descriptor XML in the <code class="literal">web.xml</code> file of the application will typically suffice (see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#context-create" title="4.16.4&nbsp;Convenient ApplicationContext instantiation for web applications">Section&nbsp;4.16.4, Convenient ApplicationContext instantiation for web applications</a>). If you are using the <a class="ulink" href="http://spring.io/tools/sts" target="_top">SpringSource Tool Suite</a> Eclipse-powered development environment this boilerplate configuration can be easily created with few mouse clicks or keystrokes.</p> 
   <p>The following diagram is a high-level view of how Spring works. Your application classes are combined with configuration metadata so that after the <code class="literal">ApplicationContext</code> is created and initialized, you have a fully configured and executable system or application.</p> 
   <div class="figure">
    <a name="d4e685"></a>
    <p class="title"><b>Figure&nbsp;4.1.&nbsp;The Spring IoC container</b></p>
    <div class="figure-contents"> 
     <div class="mediaobject">
      <img src="./Spring Framework Reference Documentation_files/container-magic.png" alt="container magic" />
     </div> 
    </div>
   </div>
   <br class="figure-break" /> 
   <div class="section" title="4.2.1&nbsp;Configuration metadata">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-factory-metadata"></a>4.2.1&nbsp;Configuration metadata</h3>
      </div>
     </div>
    </div> 
    <p>As the preceding diagram shows, the Spring IoC container consumes a form of <span class="emphasis"><em>configuration metadata</em></span>; this configuration metadata represents how you as an application developer tell the Spring container to instantiate, configure, and assemble the objects in your application.</p> 
    <p>Configuration metadata is traditionally supplied in a simple and intuitive XML format, which is what most of this chapter uses to convey key concepts and features of the Spring IoC container.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>XML-based metadata is <span class="emphasis"><em>not</em></span> the only allowed form of configuration metadata. The Spring IoC container itself is <span class="emphasis"><em>totally</em></span> decoupled from the format in which this configuration metadata is actually written. These days many developers choose <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-java" title="4.12&nbsp;Java-based container configuration">Java-based configuration</a> for their Spring applications.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>For information about using other forms of metadata with the Spring container, see:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-annotation-config" title="4.9&nbsp;Annotation-based container configuration">Annotation-based configuration</a>: Spring 2.5 introduced support for annotation-based configuration metadata. </li>
      <li class="listitem"> <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-java" title="4.12&nbsp;Java-based container configuration">Java-based configuration</a>: Starting with Spring 3.0, many features provided by the Spring JavaConfig project became part of the core Spring Framework. Thus you can define beans external to your application classes by using Java rather than XML files. To use these new features, see the <code class="literal">@Configuration</code>, <code class="literal">@Bean</code>, <code class="literal">@Import</code> and <code class="literal">@DependsOn</code> annotations. </li>
     </ul>
    </div> 
    <p>Spring configuration consists of at least one and typically more than one bean definition that the container must manage. XML-based configuration metadata shows these beans configured as <code class="literal">&lt;bean/&gt;</code> elements inside a top-level <code class="literal">&lt;beans/&gt;</code> element. Java configuration typically uses <code class="literal">@Bean</code> annotated methods within a <code class="literal">@Configuration</code> class.</p> 
    <p>These bean definitions correspond to the actual objects that make up your application. Typically you define service layer objects, data access objects (DAOs), presentation objects such as Struts <code class="literal">Action</code> instances, infrastructure objects such as Hibernate <code class="literal">SessionFactories</code>, JMS <code class="literal">Queues</code>, and so forth. Typically one does not configure fine-grained domain objects in the container, because it is usually the responsibility of DAOs and business logic to create and load domain objects. However, you can use Springs integration with AspectJ to configure objects that have been created outside the control of an IoC container. See <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-atconfigurable" title="8.8.1&nbsp;Using AspectJ to dependency inject domain objects with Spring">Using AspectJ to dependency-inject domain objects with Spring</a>.</p> 
    <p>The following example shows the basic structure of XML-based configuration metadata:</p> 
    <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;...&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;...&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- collaborators and configuration for this bean go here --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;...&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;...&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- collaborators and configuration for this bean go here --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- more bean definitions go here --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>The <code class="literal">id</code> attribute is a string that you use to identify the individual bean definition. The <code class="literal">class</code> attribute defines the type of the bean and uses the fully qualified classname. The value of the id attribute refers to collaborating objects. The XML for referring to collaborating objects is not shown in this example; see <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-dependencies" title="4.4&nbsp;Dependencies">Dependencies</a> for more information.</p> 
   </div> 
   <div class="section" title="4.2.2&nbsp;Instantiating a container">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-factory-instantiation"></a>4.2.2&nbsp;Instantiating a container</h3>
      </div>
     </div>
    </div> 
    <p>Instantiating a Spring IoC container is straightforward. The location path or paths supplied to an <code class="literal">ApplicationContext</code> constructor are actually resource strings that allow the container to load configuration metadata from a variety of external resources such as the local file system, from the Java <code class="literal">CLASSPATH</code>, and so on.</p> 
    <pre class="programlisting">ApplicationContext context =
    <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-keyword">new</span> String[] {<span class="hl-string">&quot;services.xml&quot;</span>, <span class="hl-string">&quot;daos.xml&quot;</span>});</pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>After you learn about Springs IoC container, you may want to know more about Springs <code class="literal">Resource</code> abstraction, as described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#resources" title="5.&nbsp;Resources">Chapter&nbsp;5, <i>Resources</i></a>, which provides a convenient mechanism for reading an InputStream from locations defined in a URI syntax. In particular, <code class="literal">Resource</code> paths are used to construct applications contexts as described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#resources-app-ctx" title="5.7&nbsp;Application contexts and Resource paths">Section&nbsp;5.7, Application contexts and Resource paths</a>.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>The following example shows the service layer objects <code class="literal">(services.xml)</code> configuration file:</p> 
    <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- services --&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;petStore&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.samples.jpetstore.services.PetStoreServiceImpl&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;accountDao&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;accountDao&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;itemDao&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;itemDao&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- more bean definitions for services go here --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>The following example shows the data access objects <code class="literal">daos.xml</code> file:</p> 
    <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;accountDao&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.samples.jpetstore.dao.jpa.JpaAccountDao&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;itemDao&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.samples.jpetstore.dao.jpa.JapItemDao&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- additional collaborators and configuration for this bean go here --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- more bean definitions for data access objects go here --&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>In the preceding example, the service layer consists of the class <code class="literal">PetStoreServiceImpl</code>, and two data access objects of the type <code class="literal">JpaAccountDao</code> and <code class="literal">JpaItemDao</code> (based on the JPA Object/Relational mapping standard). The <code class="literal">property name</code> element refers to the name of the JavaBean property, and the <code class="literal">ref</code> element refers to the name of another bean definition. This linkage between <code class="literal">id</code> and <code class="literal">ref</code> elements expresses the dependency between collaborating objects. For details of configuring an objects dependencies, see <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-dependencies" title="4.4&nbsp;Dependencies">Dependencies</a>.</p> 
    <div class="section" title="Composing XML-based configuration metadata">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-xml-import"></a>Composing XML-based configuration metadata</h4>
       </div>
      </div>
     </div> 
     <p>It can be useful to have bean definitions span multiple XML files. Often each individual XML configuration file represents a logical layer or module in your architecture.</p> 
     <p>You can use the application context constructor to load bean definitions from all these XML fragments. This constructor takes multiple <code class="literal">Resource</code> locations, as was shown in the previous section. Alternatively, use one or more occurrences of the <code class="literal">&lt;import/&gt;</code> element to load bean definitions from another file or files. For example:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;import</span> <span class="hl-attribute">resource</span>=<span class="hl-value">&quot;services.xml&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;import</span> <span class="hl-attribute">resource</span>=<span class="hl-value">&quot;resources/messageSource.xml&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;import</span> <span class="hl-attribute">resource</span>=<span class="hl-value">&quot;/resources/themeSource.xml&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;bean1&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;...&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;bean2&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;...&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
     <p>In the preceding example, external bean definitions are loaded from three files, <code class="literal">services.xml</code>, <code class="literal">messageSource.xml</code>, and <code class="literal">themeSource.xml</code>. All location paths are relative to the definition file doing the importing, so <code class="literal">services.xml</code> must be in the same directory or classpath location as the file doing the importing, while <code class="literal">messageSource.xml</code> and <code class="literal">themeSource.xml</code> must be in a <code class="literal">resources</code> location below the location of the importing file. As you can see, a leading slash is ignored, but given that these paths are relative, it is better form not to use the slash at all. The contents of the files being imported, including the top level <code class="literal">&lt;beans/&gt;</code> element, must be valid XML bean definitions according to the Spring Schema.</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>It is possible, but not recommended, to reference files in parent directories using a relative &quot;../&quot; path. Doing so creates a dependency on a file that is outside the current application. In particular, this reference is not recommended for &quot;classpath:&quot; URLs (for example, &quot;classpath:../services.xml&quot;), where the runtime resolution process chooses the &quot;nearest&quot; classpath root and then looks into its parent directory. Classpath configuration changes may lead to the choice of a different, incorrect directory.</p> <p>You can always use fully qualified resource locations instead of relative paths: for example, &quot;file:C:/config/services.xml&quot; or &quot;classpath:/config/services.xml&quot;. However, be aware that you are coupling your applications configuration to specific absolute locations. It is generally preferable to keep an indirection for such absolute locations, for example, through &quot;${}&quot; placeholders that are resolved against JVM system properties at runtime.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
   </div> 
   <div class="section" title="4.2.3&nbsp;Using the container">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-factory-client"></a>4.2.3&nbsp;Using the container</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">ApplicationContext</code> is the interface for an advanced factory capable of maintaining a registry of different beans and their dependencies. Using the method <code class="literal">T getBean(String name, Class&lt;T&gt; requiredType)</code> you can retrieve instances of your beans.</p> 
    <p>The <code class="literal">ApplicationContext</code> enables you to read bean definitions and access them as follows:</p> 
    <pre class="programlisting"><span class="hl-comment">// create and configure beans</span>
ApplicationContext context =
    <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-keyword">new</span> String[] {<span class="hl-string">&quot;services.xml&quot;</span>, <span class="hl-string">&quot;daos.xml&quot;</span>});

<span class="hl-comment">// retrieve configured instance</span>
PetStoreService service = context.getBean(<span class="hl-string">&quot;petStore&quot;</span>, PetStoreService.<span class="hl-keyword">class</span>);

<span class="hl-comment">// use configured instance</span>
List&lt;String&gt; userList = service.getUsernameList();</pre> 
    <p>You use <code class="literal">getBean()</code> to retrieve instances of your beans. The <code class="literal">ApplicationContext</code> interface has a few other methods for retrieving beans, but ideally your application code should never use them. Indeed, your application code should have no calls to the <code class="literal">getBean()</code> method at all, and thus no dependency on Spring APIs at all. For example, Springs integration with web frameworks provides for dependency injection for various web framework classes such as controllers and JSF-managed beans.</p> 
   </div> 
  </div> 
  <div class="section" title="4.3&nbsp;Bean overview">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="beans-definition"></a>4.3&nbsp;Bean overview</h2>
     </div>
    </div>
   </div> 
   <p>A Spring IoC container manages one or more <span class="emphasis"><em>beans</em></span>. These beans are created with the configuration metadata that you supply to the container, for example, in the form of XML <code class="literal">&lt;bean/&gt;</code> definitions.</p> 
   <p>Within the container itself, these bean definitions are represented as <code class="literal">BeanDefinition</code> objects, which contain (among other information) the following metadata:</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem"> <span class="emphasis"><em>A package-qualified class name:</em></span> typically the actual implementation class of the bean being defined. </li>
     <li class="listitem"> Bean behavioral configuration elements, which state how the bean should behave in the container (scope, lifecycle callbacks, and so forth). </li>
     <li class="listitem"> References to other beans that are needed for the bean to do its work; these references are also called <span class="emphasis"><em>collaborators</em></span> or <span class="emphasis"><em>dependencies</em></span>. </li>
     <li class="listitem"> Other configuration settings to set in the newly created object, for example, the number of connections to use in a bean that manages a connection pool, or the size limit of the pool. </li>
    </ul>
   </div> 
   <p>This metadata translates to a set of properties that make up each bean definition.</p> 
   <div class="table">
    <a name="beans-factory-bean-definition-tbl"></a>
    <p class="title"><b>Table&nbsp;4.1.&nbsp;The bean definition</b></p>
    <div class="table-contents"> 
     <table summary="The bean definition" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
      <colgroup>
       <col />
       <col />
      </colgroup>
      <thead>
       <tr>
        <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Property</th>
        <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explained in</th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>class</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-class" title="4.3.2&nbsp;Instantiating beans">Section&nbsp;4.3.2, Instantiating beans</a></p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>name</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-beanname" title="4.3.1&nbsp;Naming beans">Section&nbsp;4.3.1, Naming beans</a></p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>scope</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes" title="4.5&nbsp;Bean scopes">Section&nbsp;4.5, Bean scopes</a></p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>constructor arguments</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-collaborators" title="4.4.1&nbsp;Dependency injection">Section&nbsp;4.4.1, Dependency injection</a></p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>properties</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-collaborators" title="4.4.1&nbsp;Dependency injection">Section&nbsp;4.4.1, Dependency injection</a></p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>autowiring mode</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-autowire" title="4.4.5&nbsp;Autowiring collaborators">Section&nbsp;4.4.5, Autowiring collaborators</a></p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>lazy-initialization mode</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-lazy-init" title="4.4.4&nbsp;Lazy-initialized beans">Section&nbsp;4.4.4, Lazy-initialized beans</a></p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>initialization method</p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-initializingbean" title="Initialization callbacks">the section called Initialization callbacks</a></p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>destruction method</p></td>
        <td style="" align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-disposablebean" title="Destruction callbacks">the section called Destruction callbacks</a></p></td>
       </tr>
      </tbody>
     </table> 
    </div>
   </div>
   <br class="table-break" /> 
   <p>In addition to bean definitions that contain information on how to create a specific bean, the <code class="literal">ApplicationContext</code> implementations also permit the registration of existing objects that are created outside the container, by users. This is done by accessing the ApplicationContexts BeanFactory via the method <code class="literal">getBeanFactory()</code> which returns the BeanFactory implementation <code class="literal">DefaultListableBeanFactory</code>. <code class="literal">DefaultListableBeanFactory</code> supports this registration through the methods <code class="literal">registerSingleton(..)</code> and <code class="literal">registerBeanDefinition(..)</code>. However, typical applications work solely with beans defined through metadata bean definitions.</p> 
   <div class="section" title="4.3.1&nbsp;Naming beans">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-beanname"></a>4.3.1&nbsp;Naming beans</h3>
      </div>
     </div>
    </div> 
    <p>Every bean has one or more identifiers. These identifiers must be unique within the container that hosts the bean. A bean usually has only one identifier, but if it requires more than one, the extra ones can be considered aliases.</p> 
    <p>In XML-based configuration metadata, you use the <code class="literal">id</code> and/or <code class="literal">name</code> attributes to specify the bean identifier(s). The <code class="literal">id</code> attribute allows you to specify exactly one id. Conventionally these names are alphanumeric (<span class="emphasis"><em>myBean</em></span>, <span class="emphasis"><em>fooService</em></span>, etc), but may special characters as well. If you want to introduce other aliases to the bean, you can also specify them in the <code class="literal">name</code> attribute, separated by a comma (<code class="literal">,</code>), semicolon (<code class="literal">;</code>), or white space. As a historical note, in versions prior to Spring 3.1, the <code class="literal">id</code> attribute was typed as an <code class="literal">xsd:ID</code>, which constrained possible characters. As of 3.1, it is now <code class="literal">xsd:string</code>. Note that bean id uniqueness is still enforced by the container, though no longer by XML parsers.</p> 
    <p>You are not required to supply a name or id for a bean. If no name or id is supplied explicitly, the container generates a unique name for that bean. However, if you want to refer to that bean by name, through the use of the <code class="literal">ref</code> element or <a class="link" href="./Spring Framework Reference Documentation_files/Spring Framework Reference Documentation.htm" title="4.17.2&nbsp;Glue code and the evil singleton">Service Locator</a> style lookup, you must provide a name. Motivations for not supplying a name are related to using <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-inner-beans" title="Inner beans">inner beans</a> and <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-autowire" title="4.4.5&nbsp;Autowiring collaborators">autowiring collaborators</a>.</p> 
    <div class="sidebar" title="Bean Naming Conventions">
     <p class="title"><b>Bean Naming Conventions</b></p> 
     <p>The convention is to use the standard Java convention for instance field names when naming beans. That is, bean names start with a lowercase letter, and are camel-cased from then on. Examples of such names would be (without quotes) <code class="literal">'accountManager'</code>, <code class="literal">'accountService'</code>, <code class="literal">'userDao'</code>, <code class="literal">'loginController'</code>, and so forth.</p> 
     <p>Naming beans consistently makes your configuration easier to read and understand, and if you are using Spring AOP it helps a lot when applying advice to a set of beans related by name.</p> 
    </div> 
    <div class="section" title="Aliasing a bean outside the bean definition">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-beanname-alias"></a>Aliasing a bean outside the bean definition</h4>
       </div>
      </div>
     </div> 
     <p>In a bean definition itself, you can supply more than one name for the bean, by using a combination of up to one name specified by the <code class="literal">id</code> attribute, and any number of other names in the <code class="literal">name</code> attribute. These names can be equivalent aliases to the same bean, and are useful for some situations, such as allowing each component in an application to refer to a common dependency by using a bean name that is specific to that component itself.</p> 
     <p>Specifying all aliases where the bean is actually defined is not always adequate, however. It is sometimes desirable to introduce an alias for a bean that is defined elsewhere. This is commonly the case in large systems where configuration is split amongst each subsystem, each subsystem having its own set of object definitions. In XML-based configuration metadata, you can use the <code class="literal">&lt;alias/&gt;</code> element to accomplish this.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;alias</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;fromName&quot;</span> <span class="hl-attribute">alias</span>=<span class="hl-value">&quot;toName&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <p>In this case, a bean in the same container which is named <code class="literal">fromName</code>, may also after the use of this alias definition, be referred to as <code class="literal">toName</code>.</p> 
     <p>For example, the configuration metadata for subsystem A may refer to a DataSource via the name <code class="literal">subsystemA-dataSource</code>. The configuration metadata for subsystem B may refer to a DataSource via the name <code class="literal">subsystemB-dataSource</code>. When composing the main application that uses both these subsystems the main application refers to the DataSource via the name <code class="literal">myApp-dataSource</code>. To have all three names refer to the same object you add to the MyApp configuration metadata the following aliases definitions:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;alias</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;subsystemA-dataSource&quot;</span> <span class="hl-attribute">alias</span>=<span class="hl-value">&quot;subsystemB-dataSource&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;alias</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;subsystemA-dataSource&quot;</span> <span class="hl-attribute">alias</span>=<span class="hl-value">&quot;myApp-dataSource&quot;</span><span class="hl-tag"> /&gt;</span></pre> 
     <p>Now each component and the main application can refer to the dataSource through a name that is unique and guaranteed not to clash with any other definition (effectively creating a namespace), yet they refer to the same bean.</p> 
     <div class="sidebar" title="Java-configuration">
      <p class="title"><b>Java-configuration</b></p> 
      <p>If you are using Java-configuration, the <code class="literal">@Bean</code> annotation can be used to provide aliases see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-java-bean-annotation" title="4.12.3&nbsp;Using the @Bean annotation">Section&nbsp;4.12.3, Using the @Bean annotation</a> for details.</p> 
     </div> 
    </div> 
   </div> 
   <div class="section" title="4.3.2&nbsp;Instantiating beans">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-factory-class"></a>4.3.2&nbsp;Instantiating beans</h3>
      </div>
     </div>
    </div> 
    <p>A bean definition essentially is a recipe for creating one or more objects. The container looks at the recipe for a named bean when asked, and uses the configuration metadata encapsulated by that bean definition to create (or acquire) an actual object.</p> 
    <p>If you use XML-based configuration metadata, you specify the type (or class) of object that is to be instantiated in the <code class="literal">class</code> attribute of the <code class="literal">&lt;bean/&gt;</code> element. This <code class="literal">class</code> attribute, which internally is a <code class="literal">Class</code> property on a <code class="literal">BeanDefinition</code> instance, is usually mandatory. (For exceptions, see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-class-instance-factory-method" title="Instantiation using an instance factory method">the section called Instantiation using an instance factory method</a> and <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-child-bean-definitions" title="4.7&nbsp;Bean definition inheritance">Section&nbsp;4.7, Bean definition inheritance</a>.) You use the <code class="literal">Class</code> property in one of two ways:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> Typically, to specify the bean class to be constructed in the case where the container itself directly creates the bean by calling its constructor reflectively, somewhat equivalent to Java code using the <code class="literal">new</code> operator. </li>
      <li class="listitem"> To specify the actual class containing the <code class="literal">static</code> factory method that will be invoked to create the object, in the less common case where the container invokes a <code class="literal">static</code>, <span class="emphasis"><em>factory</em></span> method on a class to create the bean. The object type returned from the invocation of the <code class="literal">static</code> factory method may be the same class or another class entirely. </li>
     </ul>
    </div> 
    <div class="sidebar">
     <p class="title"><b></b></p> 
     <p title="Inner class names"> <b>Inner class names.&nbsp;</b> If you want to configure a bean definition for a <code class="literal">static</code> nested class, you have to use the <span class="emphasis"><em>binary</em></span> name of the inner class. </p> 
     <p>For example, if you have a class called <code class="literal">Foo</code> in the <code class="literal">com.example</code> package, and this <code class="literal">Foo</code> class has a <code class="literal">static</code> inner class called <code class="literal">Bar</code>, the value of the <code class="literal">'class'</code> attribute on a bean definition would be</p> 
     <p><code class="literal">com.example.Foo$Bar</code></p> 
     <p>Notice the use of the <code class="literal">$</code> character in the name to separate the inner class name from the outer class name.</p> 
    </div> 
    <div class="section" title="Instantiation with a constructor">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-class-ctor"></a>Instantiation with a constructor</h4>
       </div>
      </div>
     </div> 
     <p>When you create a bean by the constructor approach, all normal classes are usable by and compatible with Spring. That is, the class being developed does not need to implement any specific interfaces or to be coded in a specific fashion. Simply specifying the bean class should suffice. However, depending on what type of IoC you use for that specific bean, you may need a default (empty) constructor.</p> 
     <p>The Spring IoC container can manage virtually <span class="emphasis"><em>any</em></span> class you want it to manage; it is not limited to managing true JavaBeans. Most Spring users prefer actual JavaBeans with only a default (no-argument) constructor and appropriate setters and getters modeled after the properties in the container. You can also have more exotic non-bean-style classes in your container. If, for example, you need to use a legacy connection pool that absolutely does not adhere to the JavaBean specification, Spring can manage it as well.</p> 
     <p>With XML-based configuration metadata you can specify your bean class as follows:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exampleBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.ExampleBean&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;anotherExample&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.ExampleBeanTwo&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <p>For details about the mechanism for supplying arguments to the constructor (if required) and setting object instance properties after the object is constructed, see <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-collaborators" title="4.4.1&nbsp;Dependency injection">Injecting Dependencies</a>.</p> 
    </div> 
    <div class="section" title="Instantiation with a static factory method">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-class-static-factory-method"></a>Instantiation with a static factory method</h4>
       </div>
      </div>
     </div> 
     <p>When defining a bean that you create with a static factory method, you use the <code class="literal">class</code> attribute to specify the class containing the <code class="literal">static</code> factory method and an attribute named <code class="literal">factory-method</code> to specify the name of the factory method itself. You should be able to call this method (with optional arguments as described later) and return a live object, which subsequently is treated as if it had been created through a constructor. One use for such a bean definition is to call <code class="literal">static</code> factories in legacy code.</p> 
     <p>The following bean definition specifies that the bean will be created by calling a factory-method. The definition does not specify the type (class) of the returned object, only the class containing the factory method. In this example, the <code class="literal">createInstance()</code> method must be a <span class="emphasis"><em>static</em></span> method.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;clientService&quot;</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.ClientService&quot;</span>
    <span class="hl-attribute">factory-method</span>=<span class="hl-value">&quot;createInstance&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ClientService {
    <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> ClientService clientService = <span class="hl-keyword">new</span> ClientService();
    <span class="hl-keyword">private</span> ClientService() {}

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> ClientService createInstance() {
        <span class="hl-keyword">return</span> clientService;
    }
}</pre> 
     <p>For details about the mechanism for supplying (optional) arguments to the factory method and setting object instance properties after the object is returned from the factory, see <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-properties-detailed" title="4.4.2&nbsp;Dependencies and configuration in detail">Dependencies and configuration in detail</a>.</p> 
    </div> 
    <div class="section" title="Instantiation using an instance factory method">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-class-instance-factory-method"></a>Instantiation using an instance factory method</h4>
       </div>
      </div>
     </div> 
     <p>Similar to instantiation through a <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-class-static-factory-method" title="Instantiation with a static factory method">static factory method</a>, instantiation with an instance factory method invokes a non-static method of an existing bean from the container to create a new bean. To use this mechanism, leave the <code class="literal">class</code> attribute empty, and in the <code class="literal">factory-bean</code> attribute, specify the name of a bean in the current (or parent/ancestor) container that contains the instance method that is to be invoked to create the object. Set the name of the factory method itself with the <code class="literal">factory-method</code> attribute.</p> 
     <pre class="programlisting"><span class="hl-comment">&lt;!-- the factory bean, which contains a method called createInstance() --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;serviceLocator&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.DefaultServiceLocator&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- inject any dependencies required by this locator bean --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-comment">&lt;!-- the bean to be created via the factory bean --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;clientService&quot;</span>
    <span class="hl-attribute">factory-bean</span>=<span class="hl-value">&quot;serviceLocator&quot;</span>
    <span class="hl-attribute">factory-method</span>=<span class="hl-value">&quot;createClientServiceInstance&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultServiceLocator {

    <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> ClientService clientService = <span class="hl-keyword">new</span> ClientServiceImpl();
    <span class="hl-keyword">private</span> DefaultServiceLocator() {}

    <span class="hl-keyword">public</span> ClientService createClientServiceInstance() {
        <span class="hl-keyword">return</span> clientService;
    }
}</pre> 
     <p>One factory class can also hold more than one factory method as shown here:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;serviceLocator&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.DefaultServiceLocator&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- inject any dependencies required by this locator bean --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;clientService&quot;</span>
    <span class="hl-attribute">factory-bean</span>=<span class="hl-value">&quot;serviceLocator&quot;</span>
    <span class="hl-attribute">factory-method</span>=<span class="hl-value">&quot;createClientServiceInstance&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;accountService&quot;</span>
    <span class="hl-attribute">factory-bean</span>=<span class="hl-value">&quot;serviceLocator&quot;</span>
    <span class="hl-attribute">factory-method</span>=<span class="hl-value">&quot;createAccountServiceInstance&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultServiceLocator {

    <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> ClientService clientService = <span class="hl-keyword">new</span> ClientServiceImpl();
    <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> AccountService accountService = <span class="hl-keyword">new</span> AccountServiceImpl();

    <span class="hl-keyword">private</span> DefaultServiceLocator() {}

    <span class="hl-keyword">public</span> ClientService createClientServiceInstance() {
        <span class="hl-keyword">return</span> clientService;
    }

    <span class="hl-keyword">public</span> AccountService createAccountServiceInstance() {
        <span class="hl-keyword">return</span> accountService;
    }

}</pre> 
     <p>This approach shows that the factory bean itself can be managed and configured through dependency injection (DI). See <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-properties-detailed" title="4.4.2&nbsp;Dependencies and configuration in detail">Dependencies and configuration in detail</a>.</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>In Spring documentation,<span class="emphasis"><em> factory bean</em></span> refers to a bean that is configured in the Spring container that will create objects through an <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-class-instance-factory-method" title="Instantiation using an instance factory method">instance</a> or <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-class-static-factory-method" title="Instantiation with a static factory method">static</a> factory method. By contrast, <code class="literal">FactoryBean</code> (notice the capitalization) refers to a Spring-specific <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-extension-factorybean" title="4.8.3&nbsp;Customizing instantiation logic with a FactoryBean"><code class="literal">FactoryBean</code></a>.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
   </div> 
  </div> 
  <div class="section" title="4.4&nbsp;Dependencies">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="beans-dependencies"></a>4.4&nbsp;Dependencies</h2>
     </div>
    </div>
   </div> 
   <p>A typical enterprise application does not consist of a single object (or bean in the Spring parlance). Even the simplest application has a few objects that work together to present what the end-user sees as a coherent application. This next section explains how you go from defining a number of bean definitions that stand alone to a fully realized application where objects collaborate to achieve a goal.</p> 
   <div class="section" title="4.4.1&nbsp;Dependency injection">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-factory-collaborators"></a>4.4.1&nbsp;Dependency injection</h3>
      </div>
     </div>
    </div> 
    <p><span class="emphasis"><em>Dependency injection</em></span> (DI) is a process whereby objects define their dependencies, that is, the other objects they work with, only through constructor arguments, arguments to a factory method, or properties that are set on the object instance after it is constructed or returned from a factory method. The container then <span class="emphasis"><em>injects</em></span> those dependencies when it creates the bean. This process is fundamentally the inverse, hence the name <span class="emphasis"><em>Inversion of Control</em></span> (IoC), of the bean itself controlling the instantiation or location of its dependencies on its own by using direct construction of classes, or the <span class="emphasis"><em>Service Locator</em></span> pattern.</p> 
    <p>Code is cleaner with the DI principle and decoupling is more effective when objects are provided with their dependencies. The object does not look up its dependencies, and does not know the location or class of the dependencies. As such, your classes become easier to test, in particular when the dependencies are on interfaces or abstract base classes, which allow for stub or mock implementations to be used in unit tests.</p> 
    <p>DI exists in two major variants, <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-constructor-injection" title="Constructor-based dependency injection">Constructor-based dependency injection</a> and <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-setter-injection" title="Setter-based dependency injection">Setter-based dependency injection</a>.</p> 
    <div class="section" title="Constructor-based dependency injection">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-constructor-injection"></a>Constructor-based dependency injection</h4>
       </div>
      </div>
     </div> 
     <p><span class="emphasis"><em>Constructor-based</em></span> DI is accomplished by the container invoking a constructor with a number of arguments, each representing a dependency. Calling a <code class="literal">static</code> factory method with specific arguments to construct the bean is nearly equivalent, and this discussion treats arguments to a constructor and to a <code class="literal">static</code> factory method similarly. The following example shows a class that can only be dependency-injected with constructor injection. Notice that there is nothing <span class="emphasis"><em>special</em></span> about this class, it is a POJO that has no dependencies on container specific interfaces, base classes or annotations.</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-comment">// the SimpleMovieLister has a dependency on a MovieFinder</span>
    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <span class="hl-comment">// a constructor so that the Spring container can </span><span class="emphasis"><em>inject</em></span> a MovieFinder
    <span class="hl-keyword">public</span> SimpleMovieLister(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

    <span class="hl-comment">// business logic that actually </span><span class="emphasis"><em>uses</em></span> the injected MovieFinder is omitted...

}</pre> 
     <div class="section" title="Constructor argument resolution">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="beans-factory-ctor-arguments-resolution"></a>Constructor argument resolution</h5>
        </div>
       </div>
      </div> 
      <p>Constructor argument resolution matching occurs using the arguments type. If no potential ambiguity exists in the constructor arguments of a bean definition, then the order in which the constructor arguments are defined in a bean definition is the order in which those arguments are supplied to the appropriate constructor when the bean is being instantiated. Consider the following class:</p> 
      <pre class="programlisting"><span class="hl-keyword">package</span> x.y;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Foo {

    <span class="hl-keyword">public</span> Foo(Bar bar, Baz baz) {
        <span class="hl-comment">// ...</span>
    }

}</pre> 
      <p>No potential ambiguity exists, assuming that <code class="literal">Bar</code> and <code class="literal">Baz</code> classes are not related by inheritance. Thus the following configuration works fine, and you do not need to specify the constructor argument indexes and/or types explicitly in the <code class="literal">&lt;constructor-arg/&gt;</code> element.</p> 
      <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;foo&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;x.y.Foo&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;bar&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;baz&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;bar&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;x.y.Bar&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;baz&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;x.y.Baz&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
      <p>When another bean is referenced, the type is known, and matching can occur (as was the case with the preceding example). When a simple type is used, such as <code class="literal">&lt;value&gt;true&lt;/value&gt;</code>, Spring cannot determine the type of the value, and so cannot match by type without help. Consider the following class:</p> 
      <pre class="programlisting"><span class="hl-keyword">package</span> examples;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBean {

    <span class="hl-comment">// No. of years to the calculate the Ultimate Answer</span>
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> years;

    <span class="hl-comment">// The Answer to Life, the Universe, and Everything</span>
    <span class="hl-keyword">private</span> String ultimateAnswer;

    <span class="hl-keyword">public</span> ExampleBean(<span class="hl-keyword">int</span> years, String ultimateAnswer) {
        <span class="hl-keyword">this</span>.years = years;
        <span class="hl-keyword">this</span>.ultimateAnswer = ultimateAnswer;
    }

}</pre> 
      <p>In the preceding scenario, the container <span class="emphasis"><em>can</em></span> use type matching with simple types if you explicitly specify the type of the constructor argument using the <code class="literal">type</code> attribute. For example:</p> 
      <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exampleBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.ExampleBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;int&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;7500000&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;java.lang.String&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;42&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
      <p>Use the <code class="literal">index</code> attribute to specify explicitly the index of constructor arguments. For example:</p> 
      <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exampleBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.ExampleBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">index</span>=<span class="hl-value">&quot;0&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;7500000&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">index</span>=<span class="hl-value">&quot;1&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;42&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
      <p>In addition to resolving the ambiguity of multiple simple values, specifying an index resolves ambiguity where a constructor has two arguments of the same type. Note that the <span class="emphasis"><em>index is 0 based</em></span>.</p> 
      <p>You can also use the constructor parameter name for value disambiguation:</p> 
      <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exampleBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.ExampleBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;years&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;7500000&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;ultimateanswer&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;42&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
      <p>Keep in mind that to make this work out of the box your code must be compiled with the debug flag enabled so that Spring can look up the parameter name from the constructor. If you cant compile your code with debug flag (or dont want to) you can use <a class="ulink" href="http://download.oracle.com/javase/6/docs/api/java/beans/ConstructorProperties.html" target="_top">@ConstructorProperties</a> JDK annotation to explicitly name your constructor arguments. The sample class would then have to look as follows:</p> 
      <pre class="programlisting"><span class="hl-keyword">package</span> examples;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBean {

    <span class="hl-comment">// Fields omitted</span>

    <i><span class="hl-annotation" style="color: gray">@ConstructorProperties({&quot;years&quot;, &quot;ultimateAnswer&quot;})</span></i>
    <span class="hl-keyword">public</span> ExampleBean(<span class="hl-keyword">int</span> years, String ultimateAnswer) {
        <span class="hl-keyword">this</span>.years = years;
        <span class="hl-keyword">this</span>.ultimateAnswer = ultimateAnswer;
    }

}</pre> 
     </div> 
    </div> 
    <div class="section" title="Setter-based dependency injection">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-setter-injection"></a>Setter-based dependency injection</h4>
       </div>
      </div>
     </div> 
     <p><span class="emphasis"><em>Setter-based</em></span> DI is accomplished by the container calling setter methods on your beans after invoking a no-argument constructor or no-argument <code class="literal">static</code> factory method to instantiate your bean.</p> 
     <p>The following example shows a class that can only be dependency-injected using pure setter injection. This class is conventional Java. It is a POJO that has no dependencies on container specific interfaces, base classes or annotations.</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-comment">// the SimpleMovieLister has a dependency on the MovieFinder</span>
    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <span class="hl-comment">// a setter method so that the Spring container can </span><span class="emphasis"><em>inject</em></span> a MovieFinder
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

    <span class="hl-comment">// business logic that actually </span><span class="emphasis"><em>uses</em></span> the injected MovieFinder is omitted...

}</pre> 
     <p>The <code class="literal">ApplicationContext</code> supports constructor- and setter-based DI for the beans it manages. It also supports setter-based DI after some dependencies are already injected through the constructor approach. You configure the dependencies in the form of a <code class="literal">BeanDefinition</code>, which you use with <code class="literal">PropertyEditor</code> instances to convert properties from one format to another. However, most Spring users do not work with these classes directly (programmatically), but rather with an XML definition file that is then converted internally into instances of these classes, and used to load an entire Spring IoC container instance.</p> 
     <div class="sidebar" title="Constructor-based or setter-based DI?">
      <p class="title"><b>Constructor-based or setter-based DI?</b></p> 
      <p>Since you can mix both, Constructor- and Setter-based DI, it is a good rule of thumb to use constructor arguments for mandatory dependencies and setters for optional dependencies. Note that the use of a <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-required-annotation" title="4.9.1&nbsp;@Required">@Required</a> annotation on a setter can be used to make setters required dependencies.</p> 
      <p>The Spring team generally advocates setter injection, because large numbers of constructor arguments can get unwieldy, especially when properties are optional. Setter methods also make objects of that class amenable to reconfiguration or re-injection later. Management through <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#jmx" title="24.&nbsp;JMX">JMX MBeans</a> is a compelling use case.</p> 
      <p>Some purists favor constructor-based injection. Supplying all object dependencies means that the object is always returned to client (calling) code in a totally initialized state. The disadvantage is that the object becomes less amenable to reconfiguration and re-injection.</p> 
      <p>Use the DI that makes the most sense for a particular class. Sometimes, when dealing with third-party classes to which you do not have the source, the choice is made for you. A legacy class may not expose any setter methods, and so constructor injection is the only available DI.</p> 
     </div> 
    </div> 
    <div class="section" title="Dependency resolution process">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-dependency-resolution"></a>Dependency resolution process</h4>
       </div>
      </div>
     </div> 
     <p>The container performs bean dependency resolution as follows:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> The <code class="literal">ApplicationContext</code> is created and initialized with configuration metadata that describes all the beans. Configuration metadata can be specified via XML, Java code or annotations. </li>
       <li class="listitem"> For each bean, its dependencies are expressed in the form of properties, constructor arguments, or arguments to the static-factory method if you are using that instead of a normal constructor. These dependencies are provided to the bean,<span class="emphasis"><em>when the bean is actually created</em></span>. </li>
       <li class="listitem"> Each property or constructor argument is an actual definition of the value to set, or a reference to another bean in the container. </li>
       <li class="listitem"> Each property or constructor argument which is a value is converted from its specified format to the actual type of that property or constructor argument. By default Spring can convert a value supplied in string format to all built-in types, such as <code class="literal">int</code>, <code class="literal">long</code>, <code class="literal">String</code>, <code class="literal">boolean</code>, etc. </li>
      </ul>
     </div> 
     <p>The Spring container validates the configuration of each bean as the container is created, including the validation of whether bean reference properties refer to valid beans. However, the bean properties themselves are not set until the bean <span class="emphasis"><em>is actually created</em></span>. Beans that are singleton-scoped and set to be pre-instantiated (the default) are created when the container is created. Scopes are defined in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes" title="4.5&nbsp;Bean scopes">Section&nbsp;4.5, Bean scopes</a> Otherwise, the bean is created only when it is requested. Creation of a bean potentially causes a graph of beans to be created, as the beans dependencies and its dependencies' dependencies (and so on) are created and assigned.</p> 
     <div class="sidebar" title="Circular dependencies">
      <p class="title"><b>Circular dependencies</b></p> 
      <p>If you use predominantly constructor injection, it is possible to create an unresolvable circular dependency scenario.</p> 
      <p>For example: Class A requires an instance of class B through constructor injection, and class B requires an instance of class A through constructor injection. If you configure beans for classes A and B to be injected into each other, the Spring IoC container detects this circular reference at runtime, and throws a <code class="literal">BeanCurrentlyInCreationException</code>.</p> 
      <p>One possible solution is to edit the source code of some classes to be configured by setters rather than constructors. Alternatively, avoid constructor injection and use setter injection only. In other words, although it is not recommended, you can configure circular dependencies with setter injection.</p> 
      <p>Unlike the <span class="emphasis"><em>typical</em></span> case (with no circular dependencies), a circular dependency between bean A and bean B forces one of the beans to be injected into the other prior to being fully initialized itself (a classic chicken/egg scenario).</p> 
     </div> 
     <p>You can generally trust Spring to do the right thing. It detects configuration problems, such as references to non-existent beans and circular dependencies, at container load-time. Spring sets properties and resolves dependencies as late as possible, when the bean is actually created. This means that a Spring container which has loaded correctly can later generate an exception when you request an object if there is a problem creating that object or one of its dependencies. For example, the bean throws an exception as a result of a missing or invalid property. This potentially delayed visibility of some configuration issues is why <code class="literal">ApplicationContext</code> implementations by default pre-instantiate singleton beans. At the cost of some upfront time and memory to create these beans before they are actually needed, you discover configuration issues when the <code class="literal">ApplicationContext</code> is created, not later. You can still override this default behavior so that singleton beans will lazy-initialize, rather than be pre-instantiated.</p> 
     <p>If no circular dependencies exist, when one or more collaborating beans are being injected into a dependent bean, each collaborating bean is <span class="emphasis"><em>totally</em></span> configured prior to being injected into the dependent bean. This means that if bean A has a dependency on bean B, the Spring IoC container completely configures bean B prior to invoking the setter method on bean A. In other words, the bean is instantiated (if not a pre-instantiated singleton), its dependencies are set, and the relevant lifecycle methods (such as a <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-initializingbean" title="Initialization callbacks">configured init method</a> or the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-initializingbean" title="Initialization callbacks">InitializingBean callback method</a>) are invoked.</p> 
    </div> 
    <div class="section" title="Examples of dependency injection">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-some-examples"></a>Examples of dependency injection</h4>
       </div>
      </div>
     </div> 
     <p>The following example uses XML-based configuration metadata for setter-based DI. A small part of a Spring XML configuration file specifies some bean definitions:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exampleBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.ExampleBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- setter injection using the nested &lt;ref/&gt; element --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;beanOne&quot;</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">&quot;anotherExampleBean&quot;</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/property&gt;</span>

    <span class="hl-comment">&lt;!-- setter injection using the neater </span><span class="emphasis"><em>ref</em></span> attribute --&gt;
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;beanTwo&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;yetAnotherBean&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;integerProperty&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;1&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;anotherExampleBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.AnotherBean&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;yetAnotherBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.YetAnotherBean&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBean {

    <span class="hl-keyword">private</span> AnotherBean beanOne;
    <span class="hl-keyword">private</span> YetAnotherBean beanTwo;
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> i;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setBeanOne(AnotherBean beanOne) {
        <span class="hl-keyword">this</span>.beanOne = beanOne;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setBeanTwo(YetAnotherBean beanTwo) {
        <span class="hl-keyword">this</span>.beanTwo = beanTwo;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setIntegerProperty(<span class="hl-keyword">int</span> i) {
        <span class="hl-keyword">this</span>.i = i;
    }

}</pre> 
     <p>In the preceding example, setters are declared to match against the properties specified in the XML file. The following example uses constructor-based DI:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exampleBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.ExampleBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- constructor injection using the nested &lt;ref/&gt; element --&gt;</span>
    <span class="hl-tag">&lt;constructor-arg&gt;</span>
        <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">&quot;anotherExampleBean&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/constructor-arg&gt;</span>

    <span class="hl-comment">&lt;!-- constructor injection using the neater </span><span class="emphasis"><em>ref</em></span> attribute --&gt;
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;yetAnotherBean&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;int&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;1&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;anotherExampleBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.AnotherBean&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;yetAnotherBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.YetAnotherBean&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBean {

    <span class="hl-keyword">private</span> AnotherBean beanOne;
    <span class="hl-keyword">private</span> YetAnotherBean beanTwo;
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> i;

    <span class="hl-keyword">public</span> ExampleBean(
        AnotherBean anotherBean, YetAnotherBean yetAnotherBean, <span class="hl-keyword">int</span> i) {
        <span class="hl-keyword">this</span>.beanOne = anotherBean;
        <span class="hl-keyword">this</span>.beanTwo = yetAnotherBean;
        <span class="hl-keyword">this</span>.i = i;
    }

}</pre> 
     <p>The constructor arguments specified in the bean definition will be used as arguments to the constructor of the <code class="literal">ExampleBean</code>.</p> 
     <p>Now consider a variant of this example, where instead of using a constructor, Spring is told to call a <code class="literal">static</code> factory method to return an instance of the object:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exampleBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.ExampleBean&quot;</span> <span class="hl-attribute">factory-method</span>=<span class="hl-value">&quot;createInstance&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;anotherExampleBean&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;yetAnotherBean&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;1&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;anotherExampleBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.AnotherBean&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;yetAnotherBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.YetAnotherBean&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBean {

    <span class="hl-comment">// a private constructor</span>
    <span class="hl-keyword">private</span> ExampleBean(...) {
        ...
    }

    <span class="hl-comment">// a static factory method; the arguments to this method can be</span>
    <span class="hl-comment">// considered the dependencies of the bean that is returned,</span>
    <span class="hl-comment">// regardless of how those arguments are actually used.</span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> ExampleBean createInstance (
        AnotherBean anotherBean, YetAnotherBean yetAnotherBean, <span class="hl-keyword">int</span> i) {

        ExampleBean eb = <span class="hl-keyword">new</span> ExampleBean (...);
        <span class="hl-comment">// some other operations...</span>
        <span class="hl-keyword">return</span> eb;
    }

}</pre> 
     <p>Arguments to the <code class="literal">static</code> factory method are supplied via <code class="literal">&lt;constructor-arg/&gt;</code> elements, exactly the same as if a constructor had actually been used. The type of the class being returned by the factory method does not have to be of the same type as the class that contains the <code class="literal">static</code> factory method, although in this example it is. An instance (non-static) factory method would be used in an essentially identical fashion (aside from the use of the <code class="literal">factory-bean</code> attribute instead of the <code class="literal">class</code> attribute), so details will not be discussed here.</p> 
    </div> 
   </div> 
   <div class="section" title="4.4.2&nbsp;Dependencies and configuration in detail">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-factory-properties-detailed"></a>4.4.2&nbsp;Dependencies and configuration in detail</h3>
      </div>
     </div>
    </div> 
    <p>As mentioned in the previous section, you can define bean properties and constructor arguments as references to other managed beans (collaborators), or as values defined inline. Springs XML-based configuration metadata supports sub-element types within its <code class="literal">&lt;property/&gt;</code> and <code class="literal">&lt;constructor-arg/&gt;</code> elements for this purpose.</p> 
    <div class="section" title="Straight values (primitives, Strings, and so on)">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-value-element"></a>Straight values (primitives, Strings, and so on)</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">value</code> attribute of the <code class="literal">&lt;property/&gt;</code> element specifies a property or constructor argument as a human-readable string representation. Springs <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#core-convert-ConversionService-API" title="6.5.4&nbsp;ConversionService API">conversion service</a> is used to convert these values from a <code class="literal">String</code> to the actual type of the property or argument.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myDataSource&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">&quot;close&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- results in a setDriverClassName(String) call --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;driverClassName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;com.mysql.jdbc.Driver&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;url&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;jdbc:mysql://localhost:3306/mydb&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;username&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;root&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;password&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;masterkaoli&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
     <p>The following example uses the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-p-namespace" title="XML shortcut with the p-namespace">p-namespace</a> for even more succinct XML configuration.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:p</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/p&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans
    http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myDataSource&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span>
        <span class="hl-attribute">destroy-method</span>=<span class="hl-value">&quot;close&quot;</span>
        <span class="hl-attribute">p:driverClassName</span>=<span class="hl-value">&quot;com.mysql.jdbc.Driver&quot;</span>
        <span class="hl-attribute">p:url</span>=<span class="hl-value">&quot;jdbc:mysql://localhost:3306/mydb&quot;</span>
        <span class="hl-attribute">p:username</span>=<span class="hl-value">&quot;root&quot;</span>
        <span class="hl-attribute">p:password</span>=<span class="hl-value">&quot;masterkaoli&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
     <p>The preceding XML is more succinct; however, typos are discovered at runtime rather than design time, unless you use an IDE such as <a class="ulink" href="http://www.jetbrains.com/idea/" target="_top">IntelliJ IDEA</a> or the <a class="ulink" href="http://www.springsource.com/products/sts" target="_top">SpringSource Tool Suite</a> (STS) that support automatic property completion when you create bean definitions. Such IDE assistance is highly recommended.</p> 
     <p>You can also configure a <code class="literal">java.util.Properties</code> instance as:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;mappings&quot;</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- typed as a java.util.Properties --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;properties&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;value&gt;</span>
            jdbc.driver.className=com.mysql.jdbc.Driver
            jdbc.url=jdbc:mysql://localhost:3306/mydb
        <span class="hl-tag">&lt;/value&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
     <p>The Spring container converts the text inside the <code class="literal">&lt;value/&gt;</code> element into a <code class="literal">java.util.Properties</code> instance by using the JavaBeans <code class="literal">PropertyEditor</code> mechanism. This is a nice shortcut, and is one of a few places where the Spring team do favor the use of the nested <code class="literal">&lt;value/&gt;</code> element over the <code class="literal">value</code> attribute style.</p> 
     <div class="section" title="The idref element">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="beans-idref-element"></a>The idref element</h5>
        </div>
       </div>
      </div> 
      <p>The <code class="literal">idref</code> element is simply an error-proof way to pass the <span class="emphasis"><em>id</em></span> (string value - not a reference) of another bean in the container to a <code class="literal">&lt;constructor-arg/&gt;</code> or <code class="literal">&lt;property/&gt;</code> element.</p> 
      <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;theTargetBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;...&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;theClientBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;...&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;targetName&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;idref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">&quot;theTargetBean&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
      <p>The above bean definition snippet is <span class="emphasis"><em>exactly</em></span> equivalent (at runtime) to the following snippet:</p> 
      <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;theTargetBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;...&quot;</span><span class="hl-tag"> /&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;client&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;...&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;targetName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;theTargetBean&quot;</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
      <p>The first form is preferable to the second, because using the <code class="literal">idref</code> tag allows the container to validate <span class="emphasis"><em>at deployment time</em></span> that the referenced, named bean actually exists. In the second variation, no validation is performed on the value that is passed to the <code class="literal">targetName</code> property of the <code class="literal">client</code> bean. Typos are only discovered (with most likely fatal results) when the <code class="literal">client</code> bean is actually instantiated. If the <code class="literal">client</code> bean is a <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes" title="4.5&nbsp;Bean scopes">prototype</a> bean, this typo and the resulting exception may only be discovered long after the container is deployed.</p> 
      <p>Additionally, if the referenced bean is in the same XML unit, and the bean name is the bean <span class="emphasis"><em>id</em></span>, you can use the <code class="literal">local</code> attribute, which allows the XML parser itself to validate the bean id earlier, at XML document parse time.</p> 
      <pre class="programlisting"><span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;targetName&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- a bean with id </span><span class="emphasis"><em>theTargetBean</em></span> must exist; otherwise an exception will be thrown --&gt;
    <span class="hl-tag">&lt;idref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">&quot;theTargetBean&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/property&gt;</span></pre> 
      <p>A common place (at least in versions earlier than Spring 2.0) where the <code class="literal">&lt;idref/&gt;</code> element brings value is in the configuration of <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-pfb-1" title="9.5.1&nbsp;Basics">AOP interceptors</a> in a <code class="literal">ProxyFactoryBean</code> bean definition. Using <code class="literal">&lt;idref/&gt;</code> elements when you specify the interceptor names prevents you from misspelling an interceptor id.</p> 
     </div> 
    </div> 
    <div class="section" title="References to other beans (collaborators)">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-ref-element"></a>References to other beans (collaborators)</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">ref</code> element is the final element inside a <code class="literal">&lt;constructor-arg/&gt;</code> or <code class="literal">&lt;property/&gt;</code> definition element. Here you set the value of the specified property of a bean to be a reference to another bean (a collaborator) managed by the container. The referenced bean is a dependency of the bean whose property will be set, and it is initialized on demand as needed before the property is set. (If the collaborator is a singleton bean, it may be initialized already by the container.) All references are ultimately a reference to another object. Scoping and validation depend on whether you specify the id/name of the other object through the <code class="literal">bean</code>, <code class="literal">local,</code> or <code class="literal">parent</code> attributes.</p> 
     <p>Specifying the target bean through the <code class="literal">bean</code> attribute of the <code class="literal">&lt;ref/&gt;</code> tag is the most general form, and allows creation of a reference to any bean in the same container or parent container, regardless of whether it is in the same XML file. The value of the <code class="literal">bean</code> attribute may be the same as the <code class="literal">id</code> attribute of the target bean, or as one of the values in the <code class="literal">name</code> attribute of the target bean.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">&quot;someBean&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <p>Specifying the target bean through the <code class="literal">local</code> attribute leverages the ability of the XML parser to validate XML id references within the same file. The value of the <code class="literal">local</code> attribute must be the same as the <code class="literal">id</code> attribute of the target bean. The XML parser issues an error if no matching element is found in the same file. As such, using the local variant is the best choice (in order to know about errors as early as possible) if the target bean is in the same XML file.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">&quot;someBean&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <p>Specifying the target bean through the <code class="literal">parent</code> attribute creates a reference to a bean that is in a parent container of the current container. The value of the <code class="literal">parent</code> attribute may be the same as either the <code class="literal">id</code> attribute of the target bean, or one of the values in the <code class="literal">name</code> attribute of the target bean, and the target bean must be in a parent container of the current one. You use this bean reference variant mainly when you have a hierarchy of containers and you want to wrap an existing bean in a parent container with a proxy that will have the same name as the parent bean.</p> 
     <pre class="programlisting"><span class="hl-comment">&lt;!-- in the parent context --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;accountService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.SimpleAccountService&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- insert dependencies as required as here --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
     <pre class="programlisting"><span class="hl-comment">&lt;!-- in the child (descendant) context --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;accountService&quot;</span> <span class="hl-attribute">&lt;--</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">name</span> <span class="hl-attribute">is</span> <span class="hl-attribute">the</span> <span class="hl-attribute">same</span> <span class="hl-attribute">as</span> <span class="hl-attribute">the</span> <span class="hl-attribute">parent</span> <span class="hl-attribute">bean</span> <span class="hl-attribute">--&gt;</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;target&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">parent</span>=<span class="hl-value">&quot;accountService&quot;</span><span class="hl-tag">/&gt;</span> <span class="hl-comment">&lt;!-- notice how we refer to the parent bean --&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-comment">&lt;!-- insert other configuration and dependencies as required here --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    </div> 
    <div class="section" title="Inner beans">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-inner-beans"></a>Inner beans</h4>
       </div>
      </div>
     </div> 
     <p>A <code class="literal">&lt;bean/&gt;</code> element inside the <code class="literal">&lt;property/&gt;</code> or <code class="literal">&lt;constructor-arg/&gt;</code> elements defines a so-called <span class="emphasis"><em>inner bean</em></span>.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;outer&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;...&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- instead of using a reference to a target bean, simply define the target bean inline --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;target&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.example.Person&quot;</span><span class="hl-tag">&gt;</span> <span class="hl-comment">&lt;!-- this is the inner bean --&gt;</span>
            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Fiona Apple&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;age&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;25&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/bean&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
     <p>An inner bean definition does not require a defined id or name; the container ignores these values. It also ignores the <code class="literal">scope</code> flag. Inner beans are <span class="emphasis"><em>always</em></span> anonymous and they are <span class="emphasis"><em>always</em></span> created with the outer bean. It is <span class="emphasis"><em>not</em></span> possible to inject inner beans into collaborating beans other than into the enclosing bean.</p> 
    </div> 
    <div class="section" title="Collections">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-collection-elements"></a>Collections</h4>
       </div>
      </div>
     </div> 
     <p>In the <code class="literal">&lt;list/&gt;</code>, <code class="literal">&lt;set/&gt;</code>, <code class="literal">&lt;map/&gt;</code>, and <code class="literal">&lt;props/&gt;</code> elements, you set the properties and arguments of the Java <code class="literal">Collection</code> types <code class="literal">List</code>, <code class="literal">Set</code>, <code class="literal">Map</code>, and <code class="literal">Properties</code>, respectively.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;moreComplexObject&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.ComplexObject&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- results in a setAdminEmails(java.util.Properties) call --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;adminEmails&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;props&gt;</span>
            <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;administrator&quot;</span><span class="hl-tag">&gt;</span>administrator@example.org<span class="hl-tag">&lt;/prop&gt;</span>
            <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;support&quot;</span><span class="hl-tag">&gt;</span>support@example.org<span class="hl-tag">&lt;/prop&gt;</span>
            <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;development&quot;</span><span class="hl-tag">&gt;</span>development@example.org<span class="hl-tag">&lt;/prop&gt;</span>
        <span class="hl-tag">&lt;/props&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-comment">&lt;!-- results in a setSomeList(java.util.List) call --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;someList&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>a list element followed by a reference<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">&quot;myDataSource&quot;</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-comment">&lt;!-- results in a setSomeMap(java.util.Map) call --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;someMap&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;map&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;an entry&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;just some string&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span> =<span class="hl-value">&quot;a ref&quot;</span> <span class="hl-attribute">value-ref</span>=<span class="hl-value">&quot;myDataSource&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/map&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-comment">&lt;!-- results in a setSomeSet(java.util.Set) call --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;someSet&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;set&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>just some string<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">&quot;myDataSource&quot;</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;/set&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
     <p><span class="emphasis"><em>The value of a map key or value, or a set value, can also again be any of the following elements:</em></span></p> 
     <pre class="programlisting">bean | ref | idref | list | set | map | props | value | null</pre> 
     <div class="section" title="Collection merging">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="beans-collection-elements-merging"></a>Collection merging</h5>
        </div>
       </div>
      </div> 
      <p>The Spring container also supports the <span class="emphasis"><em>merging</em></span> of collections. An application developer can define a parent-style <code class="literal">&lt;list/&gt;</code>, <code class="literal">&lt;map/&gt;</code>, <code class="literal">&lt;set/&gt;</code> or <code class="literal">&lt;props/&gt;</code> element, and have child-style <code class="literal">&lt;list/&gt;</code>, <code class="literal">&lt;map/&gt;</code>, <code class="literal">&lt;set/&gt;</code> or <code class="literal">&lt;props/&gt;</code> elements inherit and override values from the parent collection. That is, the child collections values are the result of merging the elements of the parent and child collections, with the childs collection elements overriding values specified in the parent collection.</p> 
      <p><span class="emphasis"><em>This section on merging discusses the parent-child bean mechanism. Readers unfamiliar with parent and child bean definitions may wish to read the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-child-bean-definitions" title="4.7&nbsp;Bean definition inheritance">relevant section</a> before continuing.</em></span></p> 
      <p>The following example demonstrates collection merging:</p> 
      <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;parent&quot;</span> <span class="hl-attribute">abstract</span>=<span class="hl-value">&quot;true&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.ComplexObject&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;adminEmails&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;props&gt;</span>
                <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;administrator&quot;</span><span class="hl-tag">&gt;</span>administrator@example.com<span class="hl-tag">&lt;/prop&gt;</span>
                <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;support&quot;</span><span class="hl-tag">&gt;</span>support@example.com<span class="hl-tag">&lt;/prop&gt;</span>
            <span class="hl-tag">&lt;/props&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;child&quot;</span> <span class="hl-attribute">parent</span>=<span class="hl-value">&quot;parent&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;adminEmails&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-comment">&lt;!-- the merge is specified on the </span><span class="strong"><strong>child</strong></span> collection definition --&gt;
            <span class="hl-tag">&lt;props</span> <span class="hl-attribute">merge</span>=<span class="hl-value">&quot;true&quot;</span><span class="hl-tag">&gt;</span>
                <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;sales&quot;</span><span class="hl-tag">&gt;</span>sales@example.com<span class="hl-tag">&lt;/prop&gt;</span>
                <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;support&quot;</span><span class="hl-tag">&gt;</span>support@example.co.uk<span class="hl-tag">&lt;/prop&gt;</span>
            <span class="hl-tag">&lt;/props&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;beans&gt;</span></pre> 
      <p>Notice the use of the <code class="literal">merge=true</code> attribute on the <code class="literal">&lt;props/&gt;</code> element of the <code class="literal">adminEmails</code> property of the <code class="literal">child</code> bean definition. When the <code class="literal">child</code> bean is resolved and instantiated by the container, the resulting instance has an <code class="literal">adminEmails</code> <code class="literal">Properties</code> collection that contains the result of the merging of the childs <code class="literal">adminEmails</code> collection with the parents <code class="literal">adminEmails</code> collection.</p> 
      <pre class="literallayout">administrator=administrator@example.com
sales=sales@example.com
support=support@example.co.uk</pre> 
      <p>The child <code class="literal">Properties</code> collections value set inherits all property elements from the parent <code class="literal">&lt;props/&gt;</code>, and the childs value for the <code class="literal">support</code> value overrides the value in the parent collection.</p> 
      <p>This merging behavior applies similarly to the <code class="literal">&lt;list/&gt;</code>, <code class="literal">&lt;map/&gt;</code>, and <code class="literal">&lt;set/&gt;</code> collection types. In the specific case of the <code class="literal">&lt;list/&gt;</code> element, the semantics associated with the <code class="literal">List</code> collection type, that is, the notion of an <code class="literal">ordered</code> collection of values, is maintained; the parents values precede all of the child lists values. In the case of the <code class="literal">Map</code>, <code class="literal">Set</code>, and <code class="literal">Properties</code> collection types, no ordering exists. Hence no ordering semantics are in effect for the collection types that underlie the associated <code class="literal">Map</code>, <code class="literal">Set</code>, and <code class="literal">Properties</code> implementation types that the container uses internally.</p> 
     </div> 
     <div class="section" title="Limitations of collection merging">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="beans-collection-merge-limitations"></a>Limitations of collection merging</h5>
        </div>
       </div>
      </div> 
      <p>You cannot merge different collection types (such as a <code class="literal">Map</code> and a <code class="literal">List</code>), and if you do attempt to do so an appropriate <code class="literal">Exception</code> is thrown. The <code class="literal">merge</code> attribute must be specified on the lower, inherited, child definition; specifying the <code class="literal">merge</code> attribute on a parent collection definition is redundant and will not result in the desired merging.</p> 
     </div> 
     <div class="section" title="Strongly-typed collection">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="beans-collection-elements-strongly-typed"></a>Strongly-typed collection</h5>
        </div>
       </div>
      </div> 
      <p>With the introduction of generic types in Java 5, you can use strongly typed collections. That is, it is possible to declare a <code class="literal">Collection</code> type such that it can only contain <code class="literal">String</code> elements (for example). If you are using Spring to dependency-inject a strongly-typed <code class="literal">Collection</code> into a bean, you can take advantage of Springs type-conversion support such that the elements of your strongly-typed <code class="literal">Collection</code> instances are converted to the appropriate type prior to being added to the <code class="literal">Collection</code>.</p> 
      <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Foo {

    <span class="hl-keyword">private</span> Map&lt;String, Float&gt; accounts;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setAccounts(Map&lt;String, Float&gt; accounts) {
        <span class="hl-keyword">this</span>.accounts = accounts;
    }
}</pre> 
      <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;foo&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;x.y.Foo&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;accounts&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;map&gt;</span>
                <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;one&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;9.99&quot;</span><span class="hl-tag">/&gt;</span>
                <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;two&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;2.75&quot;</span><span class="hl-tag">/&gt;</span>
                <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;six&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;3.99&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/map&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
      <p>When the <code class="literal">accounts</code> property of the <code class="literal">foo</code> bean is prepared for injection, the generics information about the element type of the strongly-typed <code class="literal">Map&lt;String, Float&gt;</code> is available by reflection. Thus Springs type conversion infrastructure recognizes the various value elements as being of type <code class="literal">Float</code>, and the string values <code class="literal">9.99, 2.75</code>, and <code class="literal">3.99</code> are converted into an actual <code class="literal">Float</code> type.</p> 
     </div> 
    </div> 
    <div class="section" title="Null and empty string values">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-null-element"></a>Null and empty string values</h4>
       </div>
      </div>
     </div> 
     <p>Spring treats empty arguments for properties and the like as empty <code class="literal">Strings</code>. The following XML-based configuration metadata snippet sets the email property to the empty <code class="literal">String</code> value (&quot;&quot;)</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;ExampleBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;email&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
     <p>The preceding example is equivalent to the following Java code: <code class="literal">exampleBean.setEmail(&quot;&quot;)</code>. The <code class="literal">&lt;null/&gt;</code> element handles <code class="literal">null</code> values. For example:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;ExampleBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;email&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;null/&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
     <p>The above configuration is equivalent to the following Java code: <code class="literal">exampleBean.setEmail(null)</code>.</p> 
    </div> 
    <div class="section" title="XML shortcut with the p-namespace">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-p-namespace"></a>XML shortcut with the p-namespace</h4>
       </div>
      </div>
     </div> 
     <p>The p-namespace enables you to use the <code class="literal">bean</code> elements attributes, instead of nested <code class="literal">&lt;property/&gt;</code> elements, to describe your property values and/or collaborating beans.</p> 
     <p>Spring supports extensible configuration formats <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#xsd-config" title="33.&nbsp;XML Schema-based configuration">with namespaces</a>, which are based on an XML Schema definition. The <code class="literal">beans</code> configuration format discussed in this chapter is defined in an XML Schema document. However, the p-namespace is not defined in an XSD file and exists only in the core of Spring.</p> 
     <p>The following example shows two XML snippets that resolve to the same result: The first uses standard XML format and the second uses the p-namespace.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:p</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/p&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;classic&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.example.ExampleBean&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;email&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;foo@bar.com&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;p-namespace&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.example.ExampleBean&quot;</span>
        <span class="hl-attribute">p:email</span>=<span class="hl-value">&quot;foo@bar.com&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
     <p>The example shows an attribute in the p-namespace called email in the bean definition. This tells Spring to include a property declaration. As previously mentioned, the p-namespace does not have a schema definition, so you can set the name of the attribute to the property name.</p> 
     <p>This next example includes two more bean definitions that both have a reference to another bean:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:p</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/p&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;john-classic&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.example.Person&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;John Doe&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;spouse&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;jane&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;john-modern&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.example.Person&quot;</span>
        <span class="hl-attribute">p:name</span>=<span class="hl-value">&quot;John Doe&quot;</span>
        <span class="hl-attribute">p:spouse-ref</span>=<span class="hl-value">&quot;jane&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;jane&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.example.Person&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Jane Doe&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
     <p>As you can see, this example includes not only a property value using the p-namespace, but also uses a special format to declare property references. Whereas the first bean definition uses <code class="literal">&lt;property name=&quot;spouse&quot; ref=&quot;jane&quot;/&gt;</code> to create a reference from bean <code class="literal">john</code> to bean <code class="literal">jane</code>, the second bean definition uses <code class="literal">p:spouse-ref=&quot;jane&quot;</code> as an attribute to do the exact same thing. In this case <code class="literal">spouse</code> is the property name, whereas the <code class="literal">-ref</code> part indicates that this is not a straight value but rather a reference to another bean.</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>The p-namespace is not as flexible as the standard XML format. For example, the format for declaring property references clashes with properties that end in <code class="literal">Ref</code>, whereas the standard XML format does not. We recommend that you choose your approach carefully and communicate this to your team members, to avoid producing XML documents that use all three approaches at the same time.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="XML shortcut with the c-namespace">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-c-namespace"></a>XML shortcut with the c-namespace</h4>
       </div>
      </div>
     </div> 
     <p>Similar to the <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-p-namespace" title="XML shortcut with the p-namespace">the section called XML shortcut with the p-namespace</a>, the <span class="emphasis"><em>c-namespace</em></span>, newly introduced in Spring 3.1, allows usage of inlined attributes for configuring the constructor arguments rather then nested <code class="literal">constructor-arg</code> elements.</p> 
     <p>Lets review the examples from <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-constructor-injection" title="Constructor-based dependency injection">the section called Constructor-based dependency injection</a> with the <code class="literal">c</code> namespace:</p> 
     <pre class="programlisting">&lt;beans xmlns=<span class="hl-string">&quot;http://www.springframework.org/schema/beans&quot;</span>
    xmlns:xsi=<span class="hl-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    xmlns:c=<span class="hl-string">&quot;http://www.springframework.org/schema/c&quot;</span>
    xsi:schemaLocation=<span class="hl-string">&quot;http://www.springframework.org/schema/beans
</span>        http:<span class="hl-comment">//www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;</span>

    &lt;bean id=<span class="hl-string">&quot;bar&quot;</span> <span class="hl-keyword">class</span>=<span class="hl-string">&quot;x.y.Bar&quot;</span>/&gt;
    &lt;bean id=<span class="hl-string">&quot;baz&quot;</span> <span class="hl-keyword">class</span>=<span class="hl-string">&quot;x.y.Baz&quot;</span>/&gt;

    &lt;-- <span class="emphasis"><em>traditional</em></span> declaration --&gt;
    &lt;bean id=<span class="hl-string">&quot;foo&quot;</span> <span class="hl-keyword">class</span>=<span class="hl-string">&quot;x.y.Foo&quot;</span>&gt;
        &lt;constructor-arg ref=<span class="hl-string">&quot;bar&quot;</span>/&gt;
        &lt;constructor-arg ref=<span class="hl-string">&quot;baz&quot;</span>/&gt;
        &lt;constructor-arg value=<span class="hl-string">&quot;foo@bar.com&quot;</span>/&gt;
    &lt;/bean&gt;

    &lt;-- <span class="emphasis"><em>c-namespace</em></span> declaration --&gt;
    &lt;bean id=<span class="hl-string">&quot;foo&quot;</span> <span class="hl-keyword">class</span>=<span class="hl-string">&quot;x.y.Foo&quot;</span> c:bar-ref=<span class="hl-string">&quot;bar&quot;</span> c:baz-ref=<span class="hl-string">&quot;baz&quot;</span> c:email=<span class="hl-string">&quot;foo@bar.com&quot;</span>&gt;

&lt;/beans&gt;</pre> 
     <p>The <code class="literal">c:</code> namespace uses the same conventions as the <code class="literal">p:</code> one (trailing <code class="literal">-ref</code> for bean references) for setting the constructor arguments by their names. And just as well, it needs to be declared even though it is not defined in an XSD schema (but it exists inside the Spring core).</p> 
     <p>For the rare cases where the constructor argument names are not available (usually if the bytecode was compiled without debugging information), one can use fallback to the argument indexes:</p> 
     <pre class="programlisting">&lt;-- <span class="emphasis"><em>c-namespace</em></span> index declaration --&gt;
&lt;bean id=<span class="hl-string">&quot;foo&quot;</span> <span class="hl-keyword">class</span>=<span class="hl-string">&quot;x.y.Foo&quot;</span> c:_<span class="hl-number">0</span>-ref=<span class="hl-string">&quot;bar&quot;</span> c:_<span class="hl-number">1</span>-ref=<span class="hl-string">&quot;baz&quot;</span>&gt;</pre> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>Due to the XML grammar, the index notation requires the presence of the leading <code class="literal">_</code> as XML attribute names cannot start with a number (even though some IDE allow it).</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <p>In practice, the constructor resolution <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-ctor-arguments-resolution" title="Constructor argument resolution">mechanism</a> is quite efficient in matching arguments so unless one really needs to, we recommend using the name notation through-out your configuration.</p> 
    </div> 
    <div class="section" title="Compound property names">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-compound-property-names"></a>Compound property names</h4>
       </div>
      </div>
     </div> 
     <p>You can use compound or nested property names when you set bean properties, as long as all components of the path except the final property name are not <code class="literal">null</code>. Consider the following bean definition.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;foo&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;foo.Bar&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;fred.bob.sammy&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;123&quot;</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
     <p>The <code class="literal">foo</code> bean has a <code class="literal">fred</code> property, which has a <code class="literal">bob</code> property, which has a <code class="literal">sammy</code> property, and that final <code class="literal">sammy</code> property is being set to the value <code class="literal">123</code>. In order for this to work, the <code class="literal">fred</code> property of <code class="literal">foo</code>, and the <code class="literal">bob</code> property of <code class="literal">fred</code> must not be <code class="literal">null</code> after the bean is constructed, or a <code class="literal">NullPointerException</code> is thrown.</p> 
    </div> 
   </div> 
   <div class="section" title="4.4.3&nbsp;Using depends-on">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-factory-dependson"></a>4.4.3&nbsp;Using depends-on</h3>
      </div>
     </div>
    </div> 
    <p>If a bean is a dependency of another that usually means that one bean is set as a property of another. Typically you accomplish this with the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-ref-element" title="References to other beans (collaborators)"><code class="literal">&lt;ref/&gt;</code> element</a> in XML-based configuration metadata. However, sometimes dependencies between beans are less direct; for example, a static initializer in a class needs to be triggered, such as database driver registration. The <code class="literal">depends-on</code> attribute can explicitly force one or more beans to be initialized before the bean using this element is initialized. The following example uses the <code class="literal">depends-on</code> attribute to express a dependency on a single bean:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;beanOne&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;ExampleBean&quot;</span> <span class="hl-attribute">depends-on</span>=<span class="hl-value">&quot;</span><span class="strong"><strong>manager</strong></span>&quot;/&gt;
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;</span><span class="strong"><strong>manager</strong></span>&quot; class=&quot;ManagerBean&quot; /&gt;</pre> 
    <p>To express a dependency on multiple beans, supply a list of bean names as the value of the <code class="literal">depends-on</code> attribute, with commas, whitespace and semicolons, used as valid delimiters:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;beanOne&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;ExampleBean&quot;</span> <span class="hl-attribute">depends-on</span>=<span class="hl-value">&quot;manager,accountDao&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;manager&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;manager&quot;</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;manager&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;ManagerBean&quot;</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;accountDao&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;x.y.jdbc.JdbcAccountDao&quot;</span><span class="hl-tag"> /&gt;</span></pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>The <code class="literal">depends-on</code> attribute in the bean definition can specify both an initialization time dependency and, in the case of <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes-singleton" title="4.5.1&nbsp;The singleton scope">singleton</a> beans only, a corresponding destroy time dependency. Dependent beans that define a <code class="literal">depends-on</code> relationship with a given bean are destroyed first, prior to the given bean itself being destroyed. Thus <code class="literal">depends-on</code> can also control shutdown order.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="4.4.4&nbsp;Lazy-initialized beans">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-factory-lazy-init"></a>4.4.4&nbsp;Lazy-initialized beans</h3>
      </div>
     </div>
    </div> 
    <p>By default, <code class="literal">ApplicationContext</code> implementations eagerly create and configure all <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes-singleton" title="4.5.1&nbsp;The singleton scope">singleton</a> beans as part of the initialization process. Generally, this pre-instantiation is desirable, because errors in the configuration or surrounding environment are discovered immediately, as opposed to hours or even days later. When this behavior is <span class="emphasis"><em>not</em></span> desirable, you can prevent pre-instantiation of a singleton bean by marking the bean definition as lazy-initialized. A lazy-initialized bean tells the IoC container to create a bean instance when it is first requested, rather than at startup.</p> 
    <p>In XML, this behavior is controlled by the <code class="literal">lazy-init</code> attribute on the <code class="literal">&lt;bean/&gt;</code> element; for example:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;lazy&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.ExpensiveToCreateBean&quot;</span> <span class="strong"><strong>lazy-init=&quot;true&quot;</strong></span>/&gt;
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;not.lazy&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.AnotherBean&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <p>When the preceding configuration is consumed by an <code class="literal">ApplicationContext</code>, the bean named <code class="literal">lazy</code> is not eagerly pre-instantiated when the <code class="literal">ApplicationContext</code> is starting up, whereas the <code class="literal">not.lazy</code> bean is eagerly pre-instantiated.</p> 
    <p>However, when a lazy-initialized bean is a dependency of a singleton bean that is <span class="emphasis"><em>not</em></span> lazy-initialized, the <code class="literal">ApplicationContext</code> creates the lazy-initialized bean at startup, because it must satisfy the singletons dependencies. The lazy-initialized bean is injected into a singleton bean elsewhere that is not lazy-initialized.</p> 
    <p>You can also control lazy-initialization at the container level by using the <code class="literal">default-lazy-init</code> attribute on the <code class="literal">&lt;beans/&gt;</code> element; for example:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">default-lazy-init</span>=<span class="hl-value">&quot;true&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- no beans will be pre-instantiated... --&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
   </div> 
   <div class="section" title="4.4.5&nbsp;Autowiring collaborators">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-factory-autowire"></a>4.4.5&nbsp;Autowiring collaborators</h3>
      </div>
     </div>
    </div> 
    <p>The Spring container can <span class="emphasis"><em>autowire</em></span> relationships between collaborating beans. You can allow Spring to resolve collaborators (other beans) automatically for your bean by inspecting the contents of the <code class="literal">ApplicationContext</code>. Autowiring has the following advantages:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> Autowiring can significantly reduce the need to specify properties or constructor arguments. (Other mechanisms such as a bean template <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-child-bean-definitions" title="4.7&nbsp;Bean definition inheritance">discussed elsewhere in this chapter</a> are also valuable in this regard.) </li>
      <li class="listitem"> Autowiring can update a configuration as your objects evolve. For example, if you need to add a dependency to a class, that dependency can be satisfied automatically without you needing to modify the configuration. Thus autowiring can be especially useful during development, without negating the option of switching to explicit wiring when the code base becomes more stable. </li>
     </ul>
    </div> 
    <p>When using XML-based configuration metadata <sup>[<a name="d4e1460" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#ftn.d4e1460" class="footnote">2</a>]</sup>, you specify autowire mode for a bean definition with the <code class="literal">autowire</code> attribute of the <code class="literal">&lt;bean/&gt;</code> element. The autowiring functionality has five modes. You specify autowiring <span class="emphasis"><em>per</em></span> bean and thus can choose which ones to autowire.</p> 
    <div class="table">
     <a name="beans-factory-autowiring-modes-tbl"></a>
     <p class="title"><b>Table&nbsp;4.2.&nbsp;Autowiring modes</b></p>
     <div class="table-contents"> 
      <table summary="Autowiring modes" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
       <colgroup>
        <col />
        <col />
       </colgroup>
       <thead>
        <tr>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Mode</th>
         <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explanation</th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>no</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>(Default) No autowiring. Bean references must be defined via a <code class="literal">ref</code> element. Changing the default setting is not recommended for larger deployments, because specifying collaborators explicitly gives greater control and clarity. To some extent, it documents the structure of a system.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>byName</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Autowiring by property name. Spring looks for a bean with the same name as the property that needs to be autowired. For example, if a bean definition is set to autowire by name, and it contains a <span class="emphasis"><em>master</em></span> property (that is, it has a <span class="emphasis"><em>setMaster(..)</em></span> method), Spring looks for a bean definition named <code class="literal">master</code>, and uses it to set the property.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>byType</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Allows a property to be autowired if exactly one bean of the property type exists in the container. If more than one exists, a fatal exception is thrown, which indicates that you may not use <span class="emphasis"><em>byType</em></span> autowiring for that bean. If there are no matching beans, nothing happens; the property is not set.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>constructor</p></td>
         <td style="" align="left" valign="top"><p>Analogous to <span class="emphasis"><em>byType</em></span>, but applies to constructor arguments. If there is not exactly one bean of the constructor argument type in the container, a fatal error is raised.</p></td>
        </tr>
       </tbody>
      </table> 
     </div>
    </div>
    <br class="table-break" /> 
    <p>With <span class="emphasis"><em>byType</em></span> or <span class="emphasis"><em>constructor</em></span> autowiring mode, you can wire arrays and typed-collections. In such cases <span class="emphasis"><em>all</em></span> autowire candidates within the container that match the expected type are provided to satisfy the dependency. You can autowire strongly-typed Maps if the expected key type is <code class="literal">String</code>. An autowired Maps values will consist of all bean instances that match the expected type, and the Maps keys will contain the corresponding bean names.</p> 
    <p>You can combine autowire behavior with dependency checking, which is performed after autowiring completes.</p> 
    <div class="section" title="Limitations and disadvantages of autowiring">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-autowired-exceptions"></a>Limitations and disadvantages of autowiring</h4>
       </div>
      </div>
     </div> 
     <p>Autowiring works best when it is used consistently across a project. If autowiring is not used in general, it might be confusing to developers to use it to wire only one or two bean definitions.</p> 
     <p>Consider the limitations and disadvantages of autowiring:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> Explicit dependencies in <code class="literal">property</code> and <code class="literal">constructor-arg</code> settings always override autowiring. You cannot autowire so-called <span class="emphasis"><em>simple</em></span> properties such as primitives, <code class="literal">Strings</code>, and <code class="literal">Classes</code> (and arrays of such simple properties). This limitation is by-design. </li>
       <li class="listitem"> Autowiring is less exact than explicit wiring. Although, as noted in the above table, Spring is careful to avoid guessing in case of ambiguity that might have unexpected results, the relationships between your Spring-managed objects are no longer documented explicitly. </li>
       <li class="listitem"> Wiring information may not be available to tools that may generate documentation from a Spring container. </li>
       <li class="listitem"> Multiple bean definitions within the container may match the type specified by the setter method or constructor argument to be autowired. For arrays, collections, or Maps, this is not necessarily a problem. However for dependencies that expect a single value, this ambiguity is not arbitrarily resolved. If no unique bean definition is available, an exception is thrown. </li>
      </ul>
     </div> 
     <p>In the latter scenario, you have several options:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> Abandon autowiring in favor of explicit wiring. </li>
       <li class="listitem"> Avoid autowiring for a bean definition by setting its <code class="literal">autowire-candidate</code> attributes to <code class="literal">false</code> as described in the next section. </li>
       <li class="listitem"> Designate a single bean definition as the <span class="emphasis"><em>primary</em></span> candidate by setting the <code class="literal">primary</code> attribute of its <code class="literal">&lt;bean/&gt;</code> element to <code class="literal">true</code>. </li>
       <li class="listitem"> Implement the more fine-grained control available with annotation-based configuration, as described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-annotation-config" title="4.9&nbsp;Annotation-based container configuration">Section&nbsp;4.9, Annotation-based container configuration</a>. </li>
      </ul>
     </div> 
    </div> 
    <div class="section" title="Excluding a bean from autowiring">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-autowire-candidate"></a>Excluding a bean from autowiring</h4>
       </div>
      </div>
     </div> 
     <p>On a per-bean basis, you can exclude a bean from autowiring. In Springs XML format, set the <code class="literal">autowire-candidate</code> attribute of the <code class="literal">&lt;bean/&gt;</code> element to <code class="literal">false</code>; the container makes that specific bean definition unavailable to the autowiring infrastructure (including annotation style configurations such as <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-autowired-annotation" title="4.9.2&nbsp;@Autowired"><code class="literal">@Autowired</code></a>).</p> 
     <p>You can also limit autowire candidates based on pattern-matching against bean names. The top-level <code class="literal">&lt;beans/&gt;</code> element accepts one or more patterns within its <code class="literal">default-autowire-candidates</code> attribute. For example, to limit autowire candidate status to any bean whose name ends with <span class="emphasis"><em>Repository,</em></span> provide a value of *Repository. To provide multiple patterns, define them in a comma-separated list. An explicit value of <code class="literal">true</code> or <code class="literal">false</code> for a bean definitions <code class="literal">autowire-candidate</code> attribute always takes precedence, and for such beans, the pattern matching rules do not apply.</p> 
     <p>These techniques are useful for beans that you never want to be injected into other beans by autowiring. It does not mean that an excluded bean cannot itself be configured using autowiring. Rather, the bean itself is not a candidate for autowiring other beans.</p> 
    </div> 
   </div> 
   <div class="section" title="4.4.6&nbsp;Method injection">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-factory-method-injection"></a>4.4.6&nbsp;Method injection</h3>
      </div>
     </div>
    </div> 
    <p>In most application scenarios, most beans in the container are <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes-singleton" title="4.5.1&nbsp;The singleton scope">singletons</a>. When a singleton bean needs to collaborate with another singleton bean, or a non-singleton bean needs to collaborate with another non-singleton bean, you typically handle the dependency by defining one bean as a property of the other. A problem arises when the bean lifecycles are different. Suppose singleton bean A needs to use non-singleton (prototype) bean B, perhaps on each method invocation on A. The container only creates the singleton bean A once, and thus only gets one opportunity to set the properties. The container cannot provide bean A with a new instance of bean B every time one is needed.</p> 
    <p>A solution is to forego some inversion of control. You can <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-aware" title="4.6.2&nbsp;ApplicationContextAware and BeanNameAware">make bean A aware of the container</a> by implementing the <code class="literal">ApplicationContextAware</code> interface, and by <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-client" title="4.2.3&nbsp;Using the container">making a getBean(&quot;B&quot;) call to the container</a> ask for (a typically new) bean B instance every time bean A needs it. The following is an example of this approach:</p> 
    <pre class="programlisting"><span class="hl-comment">// a class that uses a stateful Command-style class to perform some processing</span>
<span class="hl-keyword">package</span> fiona.apple;

<span class="hl-comment">// Spring-API imports</span>
<span class="hl-keyword">import</span> org.springframework.beans.BeansException;
<span class="hl-keyword">import</span> org.springframework.context.ApplicationContext;
<span class="hl-keyword">import</span> org.springframework.context.ApplicationContextAware;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CommandManager <span class="hl-keyword">implements</span> ApplicationContextAware {

    <span class="hl-keyword">private</span> ApplicationContext applicationContext;

    <span class="hl-keyword">public</span> Object process(Map commandState) {
        <span class="hl-comment">// grab a new instance of the appropriate Command</span>
        Command command = createCommand();
        <span class="hl-comment">// set the state on the (hopefully brand new) Command instance</span>
        command.setState(commandState);
        <span class="hl-keyword">return</span> command.execute();
    }

    <span class="hl-keyword">protected</span> Command createCommand() {
        <span class="hl-comment">// notice the Spring API dependency!</span>
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.applicationContext.getBean(<span class="hl-string">&quot;command&quot;</span>, Command.<span class="hl-keyword">class</span>);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setApplicationContext(
            ApplicationContext applicationContext) <span class="hl-keyword">throws</span> BeansException {
        <span class="hl-keyword">this</span>.applicationContext = applicationContext;
    }
}</pre> 
    <p>The preceding is not desirable, because the business code is aware of and coupled to the Spring Framework. Method Injection, a somewhat advanced feature of the Spring IoC container, allows this use case to be handled in a clean fashion.</p> 
    <div class="sidebar">
     <p class="title"><b></b></p> 
     <p>You can read more about the motivation for Method Injection in <a class="ulink" href="http://blog.springsource.com/2004/08/06/method-injection/" target="_top">this blog entry</a>.</p> 
    </div> 
    <div class="section" title="Lookup method injection">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-lookup-method-injection"></a>Lookup method injection</h4>
       </div>
      </div>
     </div> 
     <p>Lookup method injection is the ability of the container to override methods on <span class="emphasis"><em>container managed beans</em></span>, to return the lookup result for another named bean in the container. The lookup typically involves a prototype bean as in the scenario described in the preceding section. The Spring Framework implements this method injection by using bytecode generation from the CGLIB library to generate dynamically a subclass that overrides the method.</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>For this dynamic subclassing to work, the class that the Spring container will subclass cannot be <code class="literal">final</code>, and the method to be overridden cannot be <code class="literal">final</code> either. Also, testing a class that has an <code class="literal">abstract</code> method requires you to subclass the class yourself and to supply a stub implementation of the <code class="literal">abstract</code> method. Finally, objects that have been the target of method injection cannot be serialized. As of Spring 3.2 it is no longer necessary to add CGLIB to your classpath, because CGLIB classes are repackaged under org.springframework and distributed within the spring-core JAR. This is done both for convenience as well as to avoid potential conflicts with other projects that use differing versions of CGLIB.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <p>Looking at the <code class="literal">CommandManager</code> class in the previous code snippet, you see that the Spring container will dynamically override the implementation of the <code class="literal">createCommand()</code> method. Your <code class="literal">CommandManager</code> class will not have any Spring dependencies, as can be seen in the reworked example:</p> 
     <pre class="programlisting"><span class="hl-keyword">package</span> fiona.apple;

<span class="hl-comment">// no more Spring imports!</span>

<span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> CommandManager {

    <span class="hl-keyword">public</span> Object process(Object commandState) {
        <span class="hl-comment">// grab a new instance of the appropriate Command interface</span>
        Command command = createCommand();
        <span class="hl-comment">// set the state on the (hopefully brand new) Command instance</span>
        command.setState(commandState);
        <span class="hl-keyword">return</span> command.execute();
    }

    <span class="hl-comment">// okay... but where is the implementation of this method?</span>
    <span class="hl-keyword">protected</span> <span class="hl-keyword">abstract</span> Command createCommand();
}</pre> 
     <p>In the client class containing the method to be injected (the <code class="literal">CommandManager</code> in this case), the method to be injected requires a signature of the following form:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;public|protected&gt;</span> [abstract] <span class="hl-tag">&lt;return-type&gt;</span> theMethodName(no-arguments);</pre> 
     <p>If the method is <code class="literal">abstract</code>, the dynamically-generated subclass implements the method. Otherwise, the dynamically-generated subclass overrides the concrete method defined in the original class. For example:</p> 
     <pre class="programlisting"><span class="hl-comment">&lt;!-- a stateful bean deployed as a prototype (non-singleton) --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;command&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;fiona.apple.AsyncCommand&quot;</span> <span class="hl-attribute">scope</span>=<span class="hl-value">&quot;prototype&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- inject dependencies here as required --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-comment">&lt;!-- commandProcessor uses statefulCommandHelper --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;commandManager&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;fiona.apple.CommandManager&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;lookup-method</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;createCommand&quot;</span> <span class="hl-attribute">bean</span>=<span class="hl-value">&quot;command&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
     <p>The bean identified as <span class="emphasis"><em>commandManager</em></span> calls its own method <code class="literal">createCommand()</code> whenever it needs a new instance of the <span class="emphasis"><em>command</em></span> bean. You must be careful to deploy the <code class="literal">command</code> bean as a prototype, if that is actually what is needed. If it is deployed as a <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes-singleton" title="4.5.1&nbsp;The singleton scope">singleton</a>, the same instance of the <code class="literal">command</code> bean is returned each time.</p> 
     <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Tip">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
         <th align="left">Tip</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>The interested reader may also find the <code class="literal">ServiceLocatorFactoryBean</code> (in the <code class="literal">org.springframework.beans.factory.config</code> package) to be of use. The approach used in ServiceLocatorFactoryBean is similar to that of another utility class, <code class="literal">ObjectFactoryCreatingFactoryBean</code>, but it allows you to specify your own lookup interface as opposed to a Spring-specific lookup interface. Consult the JavaDocs for these classes for additional information.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="Arbitrary method replacement">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-arbitrary-method-replacement"></a>Arbitrary method replacement</h4>
       </div>
      </div>
     </div> 
     <p>A less useful form of method injection than lookup method Injection is the ability to replace arbitrary methods in a managed bean with another method implementation. Users may safely skip the rest of this section until the functionality is actually needed.</p> 
     <p>With XML-based configuration metadata, you can use the <code class="literal">replaced-method</code> element to replace an existing method implementation with another, for a deployed bean. Consider the following class, with a method computeValue, which we want to override:</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyValueCalculator {

    <span class="hl-keyword">public</span> String computeValue(String input) {
        <span class="hl-comment">// some real code...</span>
    }

    <span class="hl-comment">// some other methods...</span>

}</pre> 
     <p>A class implementing the <code class="literal">org.springframework.beans.factory.support.MethodReplacer</code> interface provides the new method definition.</p> 
     <pre class="programlisting"><b class="hl-tag" style="color: blue">/**
 * meant to be used to override the existing computeValue(String)
 * implementation in MyValueCalculator
 */</b>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ReplacementComputeValue <span class="hl-keyword">implements</span> MethodReplacer {

    <span class="hl-keyword">public</span> Object reimplement(Object o, Method m, Object[] args) <span class="hl-keyword">throws</span> Throwable {
        <span class="hl-comment">// get the input value, work with it, and return a computed result</span>
        String input = (String) args[<span class="hl-number">0</span>];
        ...
        <span class="hl-keyword">return</span> ...;
    }
}</pre> 
     <p>The bean definition to deploy the original class and specify the method override would look like this:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myValueCalculator&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;x.y.z.MyValueCalculator&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- arbitrary method replacement --&gt;</span>
    <span class="hl-tag">&lt;replaced-method</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;computeValue&quot;</span> <span class="hl-attribute">replacer</span>=<span class="hl-value">&quot;replacementComputeValue&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;arg-type&gt;</span>String<span class="hl-tag">&lt;/arg-type&gt;</span>
    <span class="hl-tag">&lt;/replaced-method&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;replacementComputeValue&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;a.b.c.ReplacementComputeValue&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <p>You can use one or more contained <code class="literal">&lt;arg-type/&gt;</code> elements within the <code class="literal">&lt;replaced-method/&gt;</code> element to indicate the method signature of the method being overridden. The signature for the arguments is necessary only if the method is overloaded and multiple variants exist within the class. For convenience, the type string for an argument may be a substring of the fully qualified type name. For example, the following all match <code class="literal">java.lang.String</code>:</p> 
     <pre class="programlisting">java.lang.String
String
Str</pre> 
     <p>Because the number of arguments is often enough to distinguish between each possible choice, this shortcut can save a lot of typing, by allowing you to type only the shortest string that will match an argument type.</p> 
    </div> 
   </div> 
  </div> 
  <div class="section" title="4.5&nbsp;Bean scopes">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="beans-factory-scopes"></a>4.5&nbsp;Bean scopes</h2>
     </div>
    </div>
   </div> 
   <p>When you create a bean definition, you create a <span class="emphasis"><em>recipe</em></span> for creating actual instances of the class defined by that bean definition. The idea that a bean definition is a recipe is important, because it means that, as with a class, you can create many object instances from a single recipe.</p> 
   <p>You can control not only the various dependencies and configuration values that are to be plugged into an object that is created from a particular bean definition, but also the <span class="emphasis"><em>scope</em></span> of the objects created from a particular bean definition. This approach is powerful and flexible in that you can <span class="emphasis"><em>choose</em></span> the scope of the objects you create through configuration instead of having to bake in the scope of an object at the Java class level. Beans can be defined to be deployed in one of a number of scopes: out of the box, the Spring Framework supports five scopes, three of which are available only if you use a web-aware <code class="literal">ApplicationContext</code>.</p> 
   <p>The following scopes are supported out of the box. You can also create <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes-custom" title="4.5.5&nbsp;Custom scopes">a custom scope.</a></p> 
   <div class="table">
    <a name="beans-factory-scopes-tbl"></a>
    <p class="title"><b>Table&nbsp;4.3.&nbsp;Bean scopesThread-scoped beans</b></p>
    <div class="table-contents"> 
     <table summary="Bean scopesThread-scoped beans" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
      <colgroup>
       <col />
       <col />
      </colgroup>
      <thead>
       <tr>
        <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Scope</th>
        <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes-singleton" title="4.5.1&nbsp;The singleton scope">singleton</a></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>(Default) Scopes a single bean definition to a single object instance per Spring IoC container.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes-prototype" title="4.5.2&nbsp;The prototype scope">prototype</a></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Scopes a single bean definition to any number of object instances.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes-request" title="Request scope">request</a></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Scopes a single bean definition to the lifecycle of a single HTTP request; that is, each HTTP request has its own instance of a bean created off the back of a single bean definition. Only valid in the context of a web-aware Spring <code class="literal">ApplicationContext</code>.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes-session" title="Session scope">session</a></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Scopes a single bean definition to the lifecycle of an HTTP <code class="literal">Session</code>. Only valid in the context of a web-aware Spring <code class="literal">ApplicationContext</code>.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes-global-session" title="Global session scope">global session</a></p></td>
        <td style="" align="left" valign="top"><p>Scopes a single bean definition to the lifecycle of a global HTTP <code class="literal">Session</code>. Typically only valid when used in a portlet context. Only valid in the context of a web-aware Spring <code class="literal">ApplicationContext</code>.</p></td>
       </tr>
      </tbody>
     </table> 
    </div>
   </div>
   <br class="table-break" /> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>As of Spring 3.0, a <span class="emphasis"><em>thread scope</em></span> is available, but is not registered by default. For more information, see the documentation for <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/context/support/SimpleThreadScope.html" target="_top"><code class="literal">SimpleThreadScope</code></a>. For instructions on how to register this or any other custom scope, see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes-custom-using" title="Using a custom scope">the section called Using a custom scope</a>.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <div class="section" title="4.5.1&nbsp;The singleton scope">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-factory-scopes-singleton"></a>4.5.1&nbsp;The singleton scope</h3>
      </div>
     </div>
    </div> 
    <p>Only one <span class="emphasis"><em>shared</em></span> instance of a singleton bean is managed, and all requests for beans with an id or ids matching that bean definition result in that one specific bean instance being returned by the Spring container.</p> 
    <p>To put it another way, when you define a bean definition and it is scoped as a singleton, the Spring IoC container creates <span class="emphasis"><em>exactly one</em></span> instance of the object defined by that bean definition. This single instance is stored in a cache of such singleton beans, and <span class="emphasis"><em>all subsequent requests and references</em></span> for that named bean return the cached object.</p> 
    <div class="figure">
     <a name="d4e1690"></a>
     <p class="title"><b>Figure&nbsp;4.2.&nbsp;</b></p>
     <div class="figure-contents"> 
      <div class="mediaobject">
       <img src="./Spring Framework Reference Documentation_files/singleton.png" alt="singleton" />
      </div> 
     </div>
    </div>
    <br class="figure-break" /> 
    <p>Springs concept of a singleton bean differs from the Singleton pattern as defined in the Gang of Four (GoF) patterns book. The GoF Singleton hard-codes the scope of an object such that one <span class="emphasis"><em>and only one</em></span> instance of a particular class is created <span class="emphasis"><em>per ClassLoader</em></span>. The scope of the Spring singleton is best described as <span class="emphasis"><em>per container and per bean</em></span>. This means that if you define one bean for a particular class in a single Spring container, then the Spring container creates one <span class="emphasis"><em>and only one</em></span> instance of the class defined by that bean definition. <span class="emphasis"><em>The singleton scope is the default scope in Spring</em></span>. To define a bean as a singleton in XML, you would write, for example:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;accountService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.DefaultAccountService&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-comment">&lt;!-- the following is equivalent, though redundant (singleton scope is the default) --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;accountService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.DefaultAccountService&quot;</span> <span class="hl-attribute">scope</span>=<span class="hl-value">&quot;singleton&quot;</span><span class="hl-tag">/&gt;</span></pre> 
   </div> 
   <div class="section" title="4.5.2&nbsp;The prototype scope">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-factory-scopes-prototype"></a>4.5.2&nbsp;The prototype scope</h3>
      </div>
     </div>
    </div> 
    <p>The non-singleton, prototype scope of bean deployment results in the <span class="emphasis"><em>creation of a new bean instance</em></span> every time a request for that specific bean is made. That is, the bean is injected into another bean or you request it through a <code class="literal">getBean()</code> method call on the container. As a rule, use the prototype scope for all stateful beans and the singleton scope for stateless beans.</p> 
    <p>The following diagram illustrates the Spring prototype scope. <span class="emphasis"><em>A data access object (DAO) is not typically configured as a prototype, because a typical DAO does not hold any conversational state; it was just easier for this author to reuse the core of the singleton diagram.</em></span></p> 
    <div class="figure">
     <a name="d4e1710"></a>
     <p class="title"><b>Figure&nbsp;4.3.&nbsp;</b></p>
     <div class="figure-contents"> 
      <div class="mediaobject">
       <img src="./Spring Framework Reference Documentation_files/prototype.png" alt="prototype" />
      </div> 
     </div>
    </div>
    <br class="figure-break" /> 
    <p>The following example defines a bean as a prototype in XML:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;accountService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.DefaultAccountService&quot;</span> <span class="hl-attribute">scope</span>=<span class="hl-value">&quot;prototype&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <p>In contrast to the other scopes, Spring does not manage the complete lifecycle of a prototype bean: the container instantiates, configures, and otherwise assembles a prototype object, and hands it to the client, with no further record of that prototype instance. Thus, although<span class="emphasis"><em> initialization</em></span> lifecycle callback methods are called on all objects regardless of scope, in the case of prototypes, configured <span class="emphasis"><em>destruction</em></span> lifecycle callbacks are <span class="emphasis"><em>not</em></span> called. The client code must clean up prototype-scoped objects and release expensive resources that the prototype bean(s) are holding. To get the Spring container to release resources held by prototype-scoped beans, try using a custom <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-extension-bpp" title="4.8.1&nbsp;Customizing beans using a BeanPostProcessor">bean post-processor</a>, which holds a reference to beans that need to be cleaned up.</p> 
    <p>In some respects, the Spring containers role in regard to a prototype-scoped bean is a replacement for the Java <code class="literal">new</code> operator. All lifecycle management past that point must be handled by the client. (For details on the lifecycle of a bean in the Spring container, see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-lifecycle" title="4.6.1&nbsp;Lifecycle callbacks">Section&nbsp;4.6.1, Lifecycle callbacks</a>.)</p> 
   </div> 
   <div class="section" title="4.5.3&nbsp;Singleton beans with prototype-bean dependencies">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-factory-scopes-sing-prot-interaction"></a>4.5.3&nbsp;Singleton beans with prototype-bean dependencies</h3>
      </div>
     </div>
    </div> 
    <p>When you use singleton-scoped beans with dependencies on prototype beans, be aware that <span class="emphasis"><em>dependencies are resolved at instantiation time</em></span>. Thus if you dependency-inject a prototype-scoped bean into a singleton-scoped bean, a new prototype bean is instantiated and then dependency-injected into the singleton bean. The prototype instance is the sole instance that is ever supplied to the singleton-scoped bean.</p> 
    <p>However, suppose you want the singleton-scoped bean to acquire a new instance of the prototype-scoped bean repeatedly at runtime. You cannot dependency-inject a prototype-scoped bean into your singleton bean, because that injection occurs only <span class="emphasis"><em>once</em></span>, when the Spring container is instantiating the singleton bean and resolving and injecting its dependencies. If you need a new instance of a prototype bean at runtime more than once, see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-method-injection" title="4.4.6&nbsp;Method injection">Section&nbsp;4.4.6, Method injection</a></p> 
   </div> 
   <div class="section" title="4.5.4&nbsp;Request, session, and global session scopes">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-factory-scopes-other"></a>4.5.4&nbsp;Request, session, and global session scopes</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">request</code>, <code class="literal">session</code>, and <code class="literal">global session</code> scopes are <span class="emphasis"><em>only</em></span> available if you use a web-aware Spring <code class="literal">ApplicationContext</code> implementation (such as <code class="literal">XmlWebApplicationContext</code>). If you use these scopes with regular Spring IoC containers such as the <code class="literal">ClassPathXmlApplicationContext</code>, you get an <code class="literal">IllegalStateException</code> complaining about an unknown bean scope.</p> 
    <div class="section" title="Initial web configuration">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-scopes-other-web-configuration"></a>Initial web configuration</h4>
       </div>
      </div>
     </div> 
     <p>To support the scoping of beans at the <code class="literal">request</code>, <code class="literal">session</code>, and <code class="literal">global session</code> levels (web-scoped beans), some minor initial configuration is required before you define your beans. (This initial setup is <span class="emphasis"><em>not</em></span> required for the standard scopes, singleton and prototype.)</p> 
     <p>How you accomplish this initial setup depends on your particular Servlet environment..</p> 
     <p>If you access scoped beans within Spring Web MVC, in effect, within a request that is processed by the Spring <code class="literal">DispatcherServlet</code>, or <code class="literal">DispatcherPortlet</code>, then no special setup is necessary: <code class="literal">DispatcherServlet</code> and <code class="literal">DispatcherPortlet</code> already expose all relevant state.</p> 
     <p>If you use a Servlet 2.4+ web container, with requests processed outside of Springs DispatcherServlet (for example, when using JSF or Struts), you need to register the <code class="literal">org.springframework.web.context.request.RequestContextListener</code> <code class="literal">ServletRequestListener</code>. For Servlet 3.0+, this can done programmatically via the <code class="literal">WebApplicationInitializer</code> interface. Alternatively, or for older containers, add the following declaration to your web applications <code class="literal">web.xml</code> file:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;web-app&gt;</span>
    ...
    <span class="hl-tag">&lt;listener&gt;</span>
        <span class="hl-tag">&lt;listener-class&gt;</span>
            org.springframework.web.context.request.RequestContextListener
        <span class="hl-tag">&lt;/listener-class&gt;</span>
    <span class="hl-tag">&lt;/listener&gt;</span>
    ...
<span class="hl-tag">&lt;/web-app&gt;</span></pre> 
     <p>If you use an older web container (Servlet 2.3), use the provided <code class="literal">javax.servlet.Filter</code> implementation. The following snippet of XML configuration must be included in the <code class="literal">web.xml</code> file of your web application if you want to access web-scoped beans in requests outside of Springs DispatcherServlet on a Servlet 2.3 container. (The filter mapping depends on the surrounding web application configuration, so you must change it as appropriate.)</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;web-app&gt;</span>
    ...
    <span class="hl-tag">&lt;filter&gt;</span>
        <span class="hl-tag">&lt;filter-name&gt;</span>requestContextFilter<span class="hl-tag">&lt;/filter-name&gt;</span>
        <span class="hl-tag">&lt;filter-class&gt;</span>org.springframework.web.filter.RequestContextFilter<span class="hl-tag">&lt;/filter-class&gt;</span>
    <span class="hl-tag">&lt;/filter&gt;</span>
    <span class="hl-tag">&lt;filter-mapping&gt;</span>
        <span class="hl-tag">&lt;filter-name&gt;</span>requestContextFilter<span class="hl-tag">&lt;/filter-name&gt;</span>
        <span class="hl-tag">&lt;url-pattern&gt;</span>/*<span class="hl-tag">&lt;/url-pattern&gt;</span>
    <span class="hl-tag">&lt;/filter-mapping&gt;</span>
    ...
<span class="hl-tag">&lt;/web-app&gt;</span></pre> 
     <p><code class="literal">DispatcherServlet</code>, <code class="literal">RequestContextListener</code> and <code class="literal">RequestContextFilter</code> all do exactly the same thing, namely bind the HTTP request object to the <code class="literal">Thread</code> that is servicing that request. This makes beans that are request- and session-scoped available further down the call chain.</p> 
    </div> 
    <div class="section" title="Request scope">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-scopes-request"></a>Request scope</h4>
       </div>
      </div>
     </div> 
     <p>Consider the following bean definition:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;loginAction&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.LoginAction&quot;</span> <span class="hl-attribute">scope</span>=<span class="hl-value">&quot;request&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <p>The Spring container creates a new instance of the <code class="literal">LoginAction</code> bean by using the <code class="literal">loginAction</code> bean definition for each and every HTTP request. That is, the <code class="literal">loginAction</code> bean is scoped at the HTTP request level. You can change the internal state of the instance that is created as much as you want, because other instances created from the same <code class="literal">loginAction</code> bean definition will not see these changes in state; they are particular to an individual request. When the request completes processing, the bean that is scoped to the request is discarded.</p> 
    </div> 
    <div class="section" title="Session scope">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-scopes-session"></a>Session scope</h4>
       </div>
      </div>
     </div> 
     <p>Consider the following bean definition:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;userPreferences&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.UserPreferences&quot;</span> <span class="hl-attribute">scope</span>=<span class="hl-value">&quot;session&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <p>The Spring container creates a new instance of the <code class="literal">UserPreferences</code> bean by using the <code class="literal">userPreferences</code> bean definition for the lifetime of a single HTTP <code class="literal">Session</code>. In other words, the <code class="literal">userPreferences</code> bean is effectively scoped at the HTTP <code class="literal">Session</code> level. As with <code class="literal">request-scoped</code> beans, you can change the internal state of the instance that is created as much as you want, knowing that other HTTP <code class="literal">Session</code> instances that are also using instances created from the same <code class="literal">userPreferences</code> bean definition do not see these changes in state, because they are particular to an individual HTTP <code class="literal">Session</code>. When the HTTP <code class="literal">Session</code> is eventually discarded, the bean that is scoped to that particular HTTP <code class="literal">Session</code> is also discarded.</p> 
    </div> 
    <div class="section" title="Global session scope">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-scopes-global-session"></a>Global session scope</h4>
       </div>
      </div>
     </div> 
     <p>Consider the following bean definition:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;userPreferences&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.UserPreferences&quot;</span> <span class="hl-attribute">scope</span>=<span class="hl-value">&quot;globalSession&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <p>The <code class="literal">global session</code> scope is similar to the standard HTTP <code class="literal">Session</code> scope (<a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes-session" title="Session scope">described above</a>), and applies only in the context of portlet-based web applications. The portlet specification defines the notion of a global <code class="literal">Session</code> that is shared among all portlets that make up a single portlet web application. Beans defined at the <code class="literal">global session</code> scope are scoped (or bound) to the lifetime of the global portlet <code class="literal">Session</code>.</p> 
     <p>If you write a standard Servlet-based web application and you define one or more beans as having <code class="literal">global session</code> scope, the standard HTTP <code class="literal">Session</code> scope is used, and no error is raised.</p> 
    </div> 
    <div class="section" title="Scoped beans as dependencies">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-scopes-other-injection"></a>Scoped beans as dependencies</h4>
       </div>
      </div>
     </div> 
     <p>The Spring IoC container manages not only the instantiation of your objects (beans), but also the wiring up of collaborators (or dependencies). If you want to inject (for example) an HTTP request scoped bean into another bean, you must inject an AOP proxy in place of the scoped bean. That is, you need to inject a proxy object that exposes the same public interface as the scoped object but that can also retrieve the real, target object from the relevant scope (for example, an HTTP request) and delegate method calls onto the real object.</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>You <span class="emphasis"><em>do not</em></span> need to use the <code class="literal">&lt;aop:scoped-proxy/&gt;</code> in conjunction with beans that are scoped as <code class="literal">singletons</code> or <code class="literal">prototypes</code>.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <p>The configuration in the following example is only one line, but it is important to understand the &quot;why&quot; as well as the &quot;how&quot; behind it.</p> 
     <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/aop&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- an HTTP Session-scoped bean exposed as a proxy --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;userPreferences&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.UserPreferences&quot;</span> <span class="hl-attribute">scope</span>=<span class="hl-value">&quot;session&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- instructs the container to proxy the surrounding bean --&gt;</span>
        <span class="hl-tag">&lt;aop:scoped-proxy/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- a singleton-scoped bean injected with a proxy to the above bean --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;userService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.SimpleUserService&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- a reference to the proxied userPreferences bean --&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;userPreferences&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;userPreferences&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
     <p>To create such a proxy, you insert a child <code class="literal">&lt;aop:scoped-proxy/&gt;</code> element into a scoped bean definition. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes-other-injection-proxies" title="Choosing the type of proxy to create">the section called Choosing the type of proxy to create</a> and <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#xsd-config" title="33.&nbsp;XML Schema-based configuration">Chapter&nbsp;33, <i>XML Schema-based configuration</i></a>.) Why do definitions of beans scoped at the <code class="literal">request</code>, <code class="literal">session</code>, <code class="literal">globalSession</code> and custom-scope levels require the <code class="literal">&lt;aop:scoped-proxy/&gt;</code> element ? Lets examine the following singleton bean definition and contrast it with what you need to define for the aforementioned scopes. (The following <code class="literal">userPreferences</code> bean definition as it stands is <span class="emphasis"><em>incomplete.)</em></span></p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;userPreferences&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.UserPreferences&quot;</span> <span class="hl-attribute">scope</span>=<span class="hl-value">&quot;session&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;userManager&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.UserManager&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;userPreferences&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;userPreferences&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
     <p>In the preceding example, the singleton bean <code class="literal">userManager</code> is injected with a reference to the HTTP <code class="literal">Session</code>-scoped bean <code class="literal">userPreferences</code>. The salient point here is that the <code class="literal">userManager</code> bean is a singleton: it will be instantiated <span class="emphasis"><em>exactly once</em></span> per container, and its dependencies (in this case only one, the <code class="literal">userPreferences</code> bean) are also injected only once. This means that the <code class="literal">userManager</code> bean will only operate on the exact same <code class="literal">userPreferences</code> object, that is, the one that it was originally injected with.</p> 
     <p>This is <span class="emphasis"><em>not</em></span> the behavior you want when injecting a shorter-lived scoped bean into a longer-lived scoped bean, for example injecting an HTTP <code class="literal">Session</code>-scoped collaborating bean as a dependency into singleton bean. Rather, you need a single <code class="literal">userManager</code> object, and for the lifetime of an HTTP <code class="literal">Session</code>, you need a <code class="literal">userPreferences</code> object that is specific to said HTTP <code class="literal">Session</code>. Thus the container creates an object that exposes the exact same public interface as the <code class="literal">UserPreferences</code> class (ideally an object that <span class="emphasis"><em>is a</em></span> <code class="literal">UserPreferences</code> instance) which can fetch the real <code class="literal">UserPreferences</code> object from the scoping mechanism (HTTP request, <code class="literal">Session</code>, etc.). The container injects this proxy object into the <code class="literal">userManager</code> bean, which is unaware that this <code class="literal">UserPreferences</code> reference is a proxy. In this example, when a <code class="literal">UserManager</code> instance invokes a method on the dependency-injected <code class="literal">UserPreferences</code> object, it actually is invoking a method on the proxy. The proxy then fetches the real <code class="literal">UserPreferences</code> object from (in this case) the HTTP <code class="literal">Session</code>, and delegates the method invocation onto the retrieved real <code class="literal">UserPreferences</code> object.</p> 
     <p>Thus you need the following, correct and complete, configuration when injecting <code class="literal">request-</code>, <code class="literal">session-</code>, and <code class="literal">globalSession-scoped</code> beans into collaborating objects:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;userPreferences&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.UserPreferences&quot;</span> <span class="hl-attribute">scope</span>=<span class="hl-value">&quot;session&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;aop:scoped-proxy/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;userManager&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.UserManager&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;userPreferences&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;userPreferences&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
     <div class="section" title="Choosing the type of proxy to create">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="beans-factory-scopes-other-injection-proxies"></a>Choosing the type of proxy to create</h5>
        </div>
       </div>
      </div> 
      <p>By default, when the Spring container creates a proxy for a bean that is marked up with the <code class="literal">&lt;aop:scoped-proxy/&gt;</code> element, <span class="emphasis"><em>a CGLIB-based class proxy is created</em></span>.</p> 
      <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
       <table border="0" summary="Note">
        <tbody>
         <tr>
          <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
          <th align="left">Note</th>
         </tr>
         <tr>
          <td align="left" valign="top"> <p>CGLIB proxies only intercept public method calls! Do not call non-public methods on such a proxy; they will not be delegated to the scoped target object.</p> </td>
         </tr>
        </tbody>
       </table>
      </div> 
      <p>Alternatively, you can configure the Spring container to create standard JDK interface-based proxies for such scoped beans, by specifying <code class="literal">false</code> for the value of the <code class="literal">proxy-target-class</code> attribute of the <code class="literal">&lt;aop:scoped-proxy/&gt;</code> element. Using JDK interface-based proxies means that you do not need additional libraries in your application classpath to effect such proxying. However, it also means that the class of the scoped bean must implement at least one interface, and <span class="emphasis"><em>that all</em></span> collaborators into which the scoped bean is injected must reference the bean through one of its interfaces.</p> 
      <pre class="programlisting"><span class="hl-comment">&lt;!-- DefaultUserPreferences implements the UserPreferences interface --&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;userPreferences&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.DefaultUserPreferences&quot;</span> <span class="hl-attribute">scope</span>=<span class="hl-value">&quot;session&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;aop:scoped-proxy</span> <span class="hl-attribute">proxy-target-class</span>=<span class="hl-value">&quot;false&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;userManager&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.UserManager&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;userPreferences&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;userPreferences&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
      <p>For more detailed information about choosing class-based or interface-based proxying, see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-proxying" title="8.6&nbsp;Proxying mechanisms">Section&nbsp;8.6, Proxying mechanisms</a>.</p> 
     </div> 
    </div> 
   </div> 
   <div class="section" title="4.5.5&nbsp;Custom scopes">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-factory-scopes-custom"></a>4.5.5&nbsp;Custom scopes</h3>
      </div>
     </div>
    </div> 
    <p>The bean scoping mechanism is extensible; You can define your own scopes, or even redefine existing scopes, although the latter is considered bad practice and you <span class="emphasis"><em>cannot</em></span> override the built-in <code class="literal">singleton</code> and <code class="literal">prototype</code> scopes.</p> 
    <div class="section" title="Creating a custom scope">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-scopes-custom-creating"></a>Creating a custom scope</h4>
       </div>
      </div>
     </div> 
     <p>To integrate your custom scope(s) into the Spring container, you need to implement the <code class="literal">org.springframework.beans.factory.config.Scope</code> interface, which is described in this section. For an idea of how to implement your own scopes, see the <code class="literal">Scope</code> implementations that are supplied with the Spring Framework itself and the <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/beans/factory/config/Scope.html" target="_top"><code class="literal">Scope</code> Javadoc</a>, which explains the methods you need to implement in more detail.</p> 
     <p>The <code class="literal">Scope</code> interface has four methods to get objects from the scope, remove them from the scope, and allow them to be destroyed.</p> 
     <p>The following method returns the object from the underlying scope. The session scope implementation, for example, returns the session-scoped bean (and if it does not exist, the method returns a new instance of the bean, after having bound it to the session for future reference).</p> 
     <pre class="programlisting">Object get(String name, ObjectFactory objectFactory)</pre> 
     <p>The following method removes the object from the underlying scope. The session scope implementation for example, removes the session-scoped bean from the underlying session. The object should be returned, but you can return null if the object with the specified name is not found.</p> 
     <pre class="programlisting">Object remove(String name)</pre> 
     <p>The following method registers the callbacks the scope should execute when it is destroyed or when the specified object in the scope is destroyed. Refer to the Javadoc or a Spring scope implementation for more information on destruction callbacks.</p> 
     <pre class="programlisting"><span class="hl-keyword">void</span> registerDestructionCallback(String name, Runnable destructionCallback)</pre> 
     <p>The following method obtains the conversation identifier for the underlying scope. This identifier is different for each scope. For a session scoped implementation, this identifier can be the session identifier.</p> 
     <pre class="programlisting">String getConversationId()</pre> 
    </div> 
    <div class="section" title="Using a custom scope">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-scopes-custom-using"></a>Using a custom scope</h4>
       </div>
      </div>
     </div> 
     <p>After you write and test one or more custom <code class="literal">Scope</code> implementations, you need to make the Spring container aware of your new scope(s). The following method is the central method to register a new <code class="literal">Scope</code> with the Spring container:</p> 
     <pre class="programlisting"><span class="hl-keyword">void</span> registerScope(String scopeName, Scope scope);</pre> 
     <p>This method is declared on the <code class="literal">ConfigurableBeanFactory</code> interface, which is available on most of the concrete <code class="literal">ApplicationContext</code> implementations that ship with Spring via the BeanFactory property.</p> 
     <p>The first argument to the <code class="literal">registerScope(..)</code> method is the unique name associated with a scope; examples of such names in the Spring container itself are <code class="literal">singleton</code> and <code class="literal">prototype</code>. The second argument to the <code class="literal">registerScope(..)</code> method is an actual instance of the custom <code class="literal">Scope</code> implementation that you wish to register and use.</p> 
     <p>Suppose that you write your custom <code class="literal">Scope</code> implementation, and then register it as below.</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>The example below uses <code class="literal">SimpleThreadScope</code> which is included with Spring, but not registered by default. The instructions would be the same for your own custom <code class="literal">Scope</code> implementations.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <pre class="programlisting">Scope threadScope = <span class="hl-keyword">new</span> SimpleThreadScope();
beanFactory.registerScope(<span class="hl-string">&quot;thread&quot;</span>, threadScope);</pre> 
     <p>You then create bean definitions that adhere to the scoping rules of your custom <code class="literal">Scope</code>:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;...&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;...&quot;</span> <span class="hl-attribute">scope</span>=<span class="hl-value">&quot;thread&quot;</span><span class="hl-tag">&gt;</span></pre> 
     <p>With a custom <code class="literal">Scope</code> implementation, you are not limited to programmatic registration of the scope. You can also do the <code class="literal">Scope</code> registration declaratively, using the <code class="literal">CustomScopeConfigurer</code> class:</p> 
     <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/aop&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop
        http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.beans.factory.config.CustomScopeConfigurer&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;scopes&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;map&gt;</span>
                <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;thread&quot;</span><span class="hl-tag">&gt;</span>
                    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.context.support.SimpleThreadScope&quot;</span><span class="hl-tag">/&gt;</span>
                <span class="hl-tag">&lt;/entry&gt;</span>
            <span class="hl-tag">&lt;/map&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;bar&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;x.y.Bar&quot;</span> <span class="hl-attribute">scope</span>=<span class="hl-value">&quot;thread&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Rick&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;aop:scoped-proxy/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;foo&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;x.y.Foo&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;bar&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;bar&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>When you place &lt;aop:scoped-proxy/&gt; in a <code class="literal">FactoryBean</code> implementation, it is the factory bean itself that is scoped, not the object returned from <code class="literal">getObject()</code>.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
   </div> 
  </div> 
  <div class="section" title="4.6&nbsp;Customizing the nature of a bean">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="beans-factory-nature"></a>4.6&nbsp;Customizing the nature of a bean</h2>
     </div>
    </div>
   </div> 
   <div class="section" title="4.6.1&nbsp;Lifecycle callbacks">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-factory-lifecycle"></a>4.6.1&nbsp;Lifecycle callbacks</h3>
      </div>
     </div>
    </div> 
    <p>To interact with the containers management of the bean lifecycle, you can implement the Spring <code class="literal">InitializingBean</code> and <code class="literal">DisposableBean</code> interfaces. The container calls <code class="literal">afterPropertiesSet()</code> for the former and <code class="literal">destroy()</code> for the latter to allow the bean to perform certain actions upon initialization and destruction of your beans.</p> 
    <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Tip">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
        <th align="left">Tip</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>The JSR-250 <code class="literal">@PostConstruct</code> and <code class="literal">@PreDestroy</code> annotations are generally considered best practice for receiving lifecycle callbacks in a modern Spring application. Using these annotations means that your beans are not coupled to Spring specific interfaces. For details see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-postconstruct-and-predestroy-annotations" title="4.9.7&nbsp;@PostConstruct and @PreDestroy">Section&nbsp;4.9.7, @PostConstruct and @PreDestroy</a>.</p> <p>If you dont want to use the JSR-250 annotations but you are still looking to remove coupling consider the use of init-method and destroy-method object definition metadata.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>Internally, the Spring Framework uses <code class="literal">BeanPostProcessor</code> implementations to process any callback interfaces it can find and call the appropriate methods. If you need custom features or other lifecycle behavior Spring does not offer out-of-the-box, you can implement a <code class="literal">BeanPostProcessor</code> yourself. For more information, see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-extension" title="4.8&nbsp;Container Extension Points">Section&nbsp;4.8, Container Extension Points</a>.</p> 
    <p>In addition to the initialization and destruction callbacks, Spring-managed objects may also implement the <code class="literal">Lifecycle</code> interface so that those objects can participate in the startup and shutdown process as driven by the containers own lifecycle.</p> 
    <p>The lifecycle callback interfaces are described in this section.</p> 
    <div class="section" title="Initialization callbacks">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-lifecycle-initializingbean"></a>Initialization callbacks</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">org.springframework.beans.factory.InitializingBean</code> interface allows a bean to perform initialization work after all necessary properties on the bean have been set by the container. The <code class="literal">InitializingBean</code> interface specifies a single method:</p> 
     <pre class="programlisting"><span class="hl-keyword">void</span> afterPropertiesSet() <span class="hl-keyword">throws</span> Exception;</pre> 
     <p>It is recommended that you do not use the <code class="literal">InitializingBean</code> interface because it unnecessarily couples the code to Spring. Alternatively, use the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-postconstruct-and-predestroy-annotations" title="4.9.7&nbsp;@PostConstruct and @PreDestroy"><code class="literal">@PostConstruct</code></a> annotation or specify a POJO initialization method. In the case of XML-based configuration metadata, you use the <code class="literal">init-method</code> attribute to specify the name of the method that has a void no-argument signature. For example, the following definition:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exampleInitBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.ExampleBean&quot;</span> <span class="hl-attribute">init-method</span>=<span class="hl-value">&quot;init&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBean {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> init() {
        <span class="hl-comment">// do some initialization work</span>
    }

}</pre> 
     <p>is exactly the same as</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exampleInitBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.AnotherExampleBean&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AnotherExampleBean <span class="hl-keyword">implements</span> InitializingBean {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterPropertiesSet() {
        <span class="hl-comment">// do some initialization work</span>
    }

}</pre> 
     <p>but does not couple the code to Spring.</p> 
    </div> 
    <div class="section" title="Destruction callbacks">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-lifecycle-disposablebean"></a>Destruction callbacks</h4>
       </div>
      </div>
     </div> 
     <p>Implementing the <code class="literal">org.springframework.beans.factory.DisposableBean</code> interface allows a bean to get a callback when the container containing it is destroyed. The <code class="literal">DisposableBean</code> interface specifies a single method:</p> 
     <pre class="programlisting"><span class="hl-keyword">void</span> destroy() <span class="hl-keyword">throws</span> Exception;</pre> 
     <p>It is recommended that you do not use the <code class="literal">DisposableBean</code> callback interface because it unnecessarily couples the code to Spring. Alternatively, use the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-postconstruct-and-predestroy-annotations" title="4.9.7&nbsp;@PostConstruct and @PreDestroy"><code class="literal">@PreDestroy</code></a> annotation or specify a generic method that is supported by bean definitions. With XML-based configuration metadata, you use the <code class="literal">destroy-method</code> attribute on the <code class="literal">&lt;bean/&gt;</code>. For example, the following definition:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exampleInitBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.ExampleBean&quot;</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">&quot;cleanup&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleBean {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> cleanup() {
        <span class="hl-comment">// do some destruction work (like releasing pooled connections)</span>
    }

}</pre> 
     <p>is exactly the same as:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;exampleInitBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;examples.AnotherExampleBean&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AnotherExampleBean <span class="hl-keyword">implements</span> DisposableBean {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> destroy() {
        <span class="hl-comment">// do some destruction work (like releasing pooled connections)</span>
    }

}</pre> 
     <p>but does not couple the code to Spring.</p> 
    </div> 
    <div class="section" title="Default initialization and destroy methods">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-lifecycle-default-init-destroy-methods"></a>Default initialization and destroy methods</h4>
       </div>
      </div>
     </div> 
     <p>When you write initialization and destroy method callbacks that do not use the Spring-specific <code class="literal">InitializingBean</code> and <code class="literal">DisposableBean</code> callback interfaces, you typically write methods with names such as <code class="literal">init()</code>, <code class="literal">initialize()</code>, <code class="literal">dispose()</code>, and so on. Ideally, the names of such lifecycle callback methods are standardized across a project so that all developers use the same method names and ensure consistency.</p> 
     <p>You can configure the Spring container to <code class="literal">look</code> for named initialization and destroy callback method names on <span class="emphasis"><em>every</em></span> bean. This means that you, as an application developer, can write your application classes and use an initialization callback called <code class="literal">init()</code>, without having to configure an <code class="literal">init-method=&quot;init&quot;</code> attribute with each bean definition. The Spring IoC container calls that method when the bean is created (and in accordance with the standard lifecycle callback contract described previously). This feature also enforces a consistent naming convention for initialization and destroy method callbacks.</p> 
     <p>Suppose that your initialization callback methods are named <code class="literal">init()</code> and destroy callback methods are named <code class="literal">destroy()</code>. Your class will resemble the class in the following example.</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultBlogService <span class="hl-keyword">implements</span> BlogService {

    <span class="hl-keyword">private</span> BlogDao blogDao;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setBlogDao(BlogDao blogDao) {
        <span class="hl-keyword">this</span>.blogDao = blogDao;
    }

    <span class="hl-comment">// this is (unsurprisingly) the initialization callback method</span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> init() {
        <span class="hl-keyword">if</span> (<span class="hl-keyword">this</span>.blogDao == null) {
            <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> IllegalStateException(<span class="hl-string">&quot;The [blogDao] property must be set.&quot;</span>);
        }
    }

}</pre> 
     <pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">default-init-method</span>=<span class="hl-value">&quot;init&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;blogService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.DefaultBlogService&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;blogDao&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;blogDao&quot;</span><span class="hl-tag"> /&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
     <p>The presence of the <code class="literal">default-init-method</code> attribute on the top-level <code class="literal">&lt;beans/&gt;</code> element attribute causes the Spring IoC container to recognize a method called <code class="literal">init</code> on beans as the initialization method callback. When a bean is created and assembled, if the bean class has such a method, it is invoked at the appropriate time.</p> 
     <p>You configure destroy method callbacks similarly (in XML, that is) by using the <code class="literal">default-destroy-method</code> attribute on the top-level <code class="literal">&lt;beans/&gt;</code> element.</p> 
     <p>Where existing bean classes already have callback methods that are named at variance with the convention, you can override the default by specifying (in XML, that is) the method name using the <code class="literal">init-method</code> and <code class="literal">destroy-method</code> attributes of the &lt;bean/&gt; itself.</p> 
     <p>The Spring container guarantees that a configured initialization callback is called immediately after a bean is supplied with all dependencies. Thus the initialization callback is called on the raw bean reference, which means that AOP interceptors and so forth are not yet applied to the bean. A target bean is fully created <span class="emphasis"><em>first</em></span>, <span class="emphasis"><em>then</em></span> an AOP proxy (for example) with its interceptor chain is applied. If the target bean and the proxy are defined separately, your code can even interact with the raw target bean, bypassing the proxy. Hence, it would be inconsistent to apply the interceptors to the init method, because doing so would couple the lifecycle of the target bean with its proxy/interceptors and leave strange semantics when your code interacts directly to the raw target bean.</p> 
    </div> 
    <div class="section" title="Combining lifecycle mechanisms">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-lifecycle-combined-effects"></a>Combining lifecycle mechanisms</h4>
       </div>
      </div>
     </div> 
     <p>As of Spring 2.5, you have three options for controlling bean lifecycle behavior: the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-initializingbean" title="Initialization callbacks"><code class="literal">InitializingBean</code></a> and <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-disposablebean" title="Destruction callbacks"><code class="literal">DisposableBean</code></a> callback interfaces; custom <code class="literal">init()</code> and <code class="literal">destroy()</code> methods; and the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-postconstruct-and-predestroy-annotations" title="4.9.7&nbsp;@PostConstruct and @PreDestroy"><code class="literal">@PostConstruct</code> and <code class="literal">@PreDestroy</code> annotations</a>. You can combine these mechanisms to control a given bean.</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>If multiple lifecycle mechanisms are configured for a bean, and each mechanism is configured with a different method name, then each configured method is executed in the order listed below. However, if the same method name is configured - for example, <code class="literal">init()</code> for an initialization method - for more than one of these lifecycle mechanisms, that method is executed once, as explained in the preceding section.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <p>Multiple lifecycle mechanisms configured for the same bean, with different initialization methods, are called as follows:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> Methods annotated with <code class="literal">@PostConstruct</code> </li>
       <li class="listitem"> <code class="literal">afterPropertiesSet()</code> as defined by the <code class="literal">InitializingBean</code> callback interface </li>
       <li class="listitem"> A custom configured <code class="literal">init()</code> method </li>
      </ul>
     </div> 
     <p>Destroy methods are called in the same order:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> Methods annotated with <code class="literal">@PreDestroy</code> </li>
       <li class="listitem"> <code class="literal">destroy()</code> as defined by the <code class="literal">DisposableBean</code> callback interface </li>
       <li class="listitem"> A custom configured <code class="literal">destroy()</code> method </li>
      </ul>
     </div> 
    </div> 
    <div class="section" title="Startup and shutdown callbacks">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-lifecycle-processor"></a>Startup and shutdown callbacks</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">Lifecycle</code> interface defines the essential methods for any object that has its own lifecycle requirements (e.g. starts and stops some background process):</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Lifecycle {

    <span class="hl-keyword">void</span> start();

    <span class="hl-keyword">void</span> stop();

    <span class="hl-keyword">boolean</span> isRunning();

}</pre> 
     <p>Any Spring-managed object may implement that interface. Then, when the ApplicationContext itself starts and stops, it will cascade those calls to all Lifecycle implementations defined within that context. It does this by delegating to a <code class="literal">LifecycleProcessor</code>:</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> LifecycleProcessor <span class="hl-keyword">extends</span> Lifecycle {

    <span class="hl-keyword">void</span> onRefresh();

    <span class="hl-keyword">void</span> onClose();

}</pre> 
     <p>Notice that the <code class="literal">LifecycleProcessor</code> is itself an extension of the <code class="literal">Lifecycle</code> interface. It also adds two other methods for reacting to the context being refreshed and closed.</p> 
     <p>The order of startup and shutdown invocations can be important. If a &quot;depends-on&quot; relationship exists between any two objects, the dependent side will start <span class="emphasis"><em>after</em></span> its dependency, and it will stop <span class="emphasis"><em>before</em></span> its dependency. However, at times the direct dependencies are unknown. You may only know that objects of a certain type should start prior to objects of another type. In those cases, the <code class="literal">SmartLifecycle</code> interface defines another option, namely the <code class="literal">getPhase()</code> method as defined on its super-interface, <code class="literal">Phased</code>.</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Phased {

    <span class="hl-keyword">int</span> getPhase();

}</pre> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> SmartLifecycle <span class="hl-keyword">extends</span> Lifecycle, Phased {

    <span class="hl-keyword">boolean</span> isAutoStartup();

    <span class="hl-keyword">void</span> stop(Runnable callback);

}</pre> 
     <p>When starting, the objects with the lowest phase start first, and when stopping, the reverse order is followed. Therefore, an object that implements <code class="literal">SmartLifecycle</code> and whose getPhase() method returns <code class="literal">Integer.MIN_VALUE</code> would be among the first to start and the last to stop. At the other end of the spectrum, a phase value of <code class="literal">Integer.MAX_VALUE</code> would indicate that the object should be started last and stopped first (likely because it depends on other processes to be running). When considering the phase value, its also important to know that the default phase for any &quot;normal&quot; <code class="literal">Lifecycle</code> object that does not implement <code class="literal">SmartLifecycle</code> would be 0. Therefore, any negative phase value would indicate that an object should start before those standard components (and stop after them), and vice versa for any positive phase value.</p> 
     <p>As you can see the stop method defined by <code class="literal">SmartLifecycle</code> accepts a callback. Any implementation <span class="emphasis"><em>must</em></span> invoke that callbacks run() method after that implementations shutdown process is complete. That enables asynchronous shutdown where necessary since the default implementation of the <code class="literal">LifecycleProcessor</code> interface, <code class="literal">DefaultLifecycleProcessor</code>, will wait up to its timeout value for the group of objects within each phase to invoke that callback. The default per-phase timeout is 30 seconds. You can override the default lifecycle processor instance by defining a bean named &quot;lifecycleProcessor&quot; within the context. If you only want to modify the timeout, then defining the following would be sufficient:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;lifecycleProcessor&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.context.support.DefaultLifecycleProcessor&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- timeout value in milliseconds --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;timeoutPerShutdownPhase&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;10000&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
     <p>As mentioned, the <code class="literal">LifecycleProcessor</code> interface defines callback methods for the refreshing and closing of the context as well. The latter will simply drive the shutdown process as if stop() had been called explicitly, but it will happen when the context is closing. The <span class="emphasis"><em>refresh</em></span> callback on the other hand enables another feature of <code class="literal">SmartLifecycle</code> beans. When the context is refreshed (after all objects have been instantiated and initialized), that callback will be invoked, and at that point the default lifecycle processor will check the boolean value returned by each <code class="literal">SmartLifecycle</code> objects <code class="literal">isAutoStartup()</code> method. If &quot;true&quot;, then that object will be started at that point rather than waiting for an explicit invocation of the contexts or its own start() method (unlike the context refresh, the context start does not happen automatically for a standard context implementation). The &quot;phase&quot; value as well as any &quot;depends-on&quot; relationships will determine the startup order in the same way as described above.</p> 
    </div> 
    <div class="section" title="Shutting down the Spring IoC container gracefully in non-web applications">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-shutdown"></a>Shutting down the Spring IoC container gracefully in non-web applications</h4>
       </div>
      </div>
     </div> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>This section applies only to non-web applications. Springs web-based <code class="literal">ApplicationContext</code> implementations already have code in place to shut down the Spring IoC container gracefully when the relevant web application is shut down.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <p>If you are using Springs IoC container in a non-web application environment; for example, in a rich client desktop environment; you register a shutdown hook with the JVM. Doing so ensures a graceful shutdown and calls the relevant destroy methods on your singleton beans so that all resources are released. Of course, you must still configure and implement these destroy callbacks correctly.</p> 
     <p>To register a shutdown hook, you call the <code class="literal">registerShutdownHook()</code> method that is declared on the <code class="literal">AbstractApplicationContext</code> class:</p> 
     <pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.context.support.AbstractApplicationContext;
<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> Boot {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(<span class="hl-keyword">final</span> String[] args) <span class="hl-keyword">throws</span> Exception {

        AbstractApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(
                <span class="hl-keyword">new</span> String []{<span class="hl-string">&quot;beans.xml&quot;</span>});

        <span class="hl-comment">// add a shutdown hook for the above context...</span>
        ctx.registerShutdownHook();

        <span class="hl-comment">// app runs here...</span>

        <span class="hl-comment">// main method exits, hook is called prior to the app shutting down...</span>

    }
}</pre> 
    </div> 
   </div> 
   <div class="section" title="4.6.2&nbsp;ApplicationContextAware and BeanNameAware">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-factory-aware"></a>4.6.2&nbsp;ApplicationContextAware and BeanNameAware</h3>
      </div>
     </div>
    </div> 
    <p>When an <code class="literal">ApplicationContext</code> creates a class that implements the <code class="literal">org.springframework.context.ApplicationContextAware</code> interface, the class is provided with a reference to that <code class="literal">ApplicationContext</code>.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ApplicationContextAware {

    <span class="hl-keyword">void</span> setApplicationContext(ApplicationContext applicationContext) <span class="hl-keyword">throws</span> BeansException;

}</pre> 
    <p>Thus beans can manipulate programmatically the <code class="literal">ApplicationContext</code> that created them, through the <code class="literal">ApplicationContext</code> interface, or by casting the reference to a known subclass of this interface, such as <code class="literal">ConfigurableApplicationContext</code>, which exposes additional functionality. One use would be the programmatic retrieval of other beans. Sometimes this capability is useful; however, in general you should avoid it, because it couples the code to Spring and does not follow the Inversion of Control style, where collaborators are provided to beans as properties. Other methods of the ApplicationContext provide access to file resources, publishing application events, and accessing a MessageSource. These additional features are described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#context-introduction" title="4.16&nbsp;Additional Capabilities of the ApplicationContext">Section&nbsp;4.16, Additional Capabilities of the ApplicationContext</a></p> 
    <p>As of Spring 2.5, autowiring is another alternative to obtain reference to the <code class="literal">ApplicationContext</code>. The &quot;traditional&quot; <code class="literal">constructor</code> and <code class="literal">byType</code> autowiring modes (as described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-autowire" title="4.4.5&nbsp;Autowiring collaborators">Section&nbsp;4.4.5, Autowiring collaborators</a>) can provide a dependency of type <code class="literal">ApplicationContext</code> for a constructor argument or setter method parameter, respectively. For more flexibility, including the ability to autowire fields and multiple parameter methods, use the new annotation-based autowiring features. If you do, the <code class="literal">ApplicationContext</code> is autowired into a field, constructor argument, or method parameter that is expecting the <code class="literal">ApplicationContext</code> type if the field, constructor, or method in question carries the <code class="literal">@Autowired</code> annotation. For more information, see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-autowired-annotation" title="4.9.2&nbsp;@Autowired">Section&nbsp;4.9.2, @Autowired</a>.</p> 
    <p>When an ApplicationContext creates a class that implements the <code class="literal">org.springframework.beans.factory.BeanNameAware</code> interface, the class is provided with a reference to the name defined in its associated object definition.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> BeanNameAware {

    <span class="hl-keyword">void</span> setBeanName(string name) <span class="hl-keyword">throws</span> BeansException;

}</pre> 
    <p>The callback is invoked after population of normal bean properties but before an initialization callback such as <code class="literal">InitializingBean</code> <span class="emphasis"><em>afterPropertiesSet</em></span> or a custom init-method.</p> 
   </div> 
   <div class="section" title="4.6.3&nbsp;Other Aware interfaces">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aware-list"></a>4.6.3&nbsp;Other Aware interfaces</h3>
      </div>
     </div>
    </div> 
    <p>Besides <code class="literal">ApplicationContextAware</code> and <code class="literal">BeanNameAware</code> discussed above, Spring offers a range of <code class="literal">Aware</code> interfaces that allow beans to indicate to the container that they require a certain <span class="emphasis"><em>infrastructure</em></span> dependency. The most important <code class="literal">Aware</code> interfaces are summarized below - as a general rule, the name is a good indication of the dependency type:</p> 
    <div class="table">
     <a name="beans-factory-nature-aware-list"></a>
     <p class="title"><b>Table&nbsp;4.4.&nbsp;Aware interfaces</b></p>
     <div class="table-contents"> 
      <table summary="Aware interfaces" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
       <colgroup>
        <col />
        <col />
        <col />
       </colgroup>
       <thead>
        <tr>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Name</th>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Injected Dependency</th>
         <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explained in</th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ApplicationContextAware</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Declaring <code class="literal">ApplicationContext</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-aware" title="4.6.2&nbsp;ApplicationContextAware and BeanNameAware">Section&nbsp;4.6.2, ApplicationContextAware and BeanNameAware</a></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ApplicationEventPublisherAware</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Event publisher of the enclosing <code class="literal">ApplicationContext</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#context-introduction" title="4.16&nbsp;Additional Capabilities of the ApplicationContext">Section&nbsp;4.16, Additional Capabilities of the ApplicationContext</a></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">BeanClassLoaderAware</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Class loader used to load the bean classes.</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-class" title="4.3.2&nbsp;Instantiating beans">Section&nbsp;4.3.2, Instantiating beans</a></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">BeanFactoryAware</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Declaring <code class="literal">BeanFactory</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-aware" title="4.6.2&nbsp;ApplicationContextAware and BeanNameAware">Section&nbsp;4.6.2, ApplicationContextAware and BeanNameAware</a></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">BeanNameAware</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Name of the declaring bean</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-aware" title="4.6.2&nbsp;ApplicationContextAware and BeanNameAware">Section&nbsp;4.6.2, ApplicationContextAware and BeanNameAware</a></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">BootstrapContextAware</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Resource adapter <code class="literal">BootstrapContext</code> the container runs in. Typically available only in JCA aware <code class="literal">ApplicationContext</code> s</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#cci" title="25.&nbsp;JCA CCI">Chapter&nbsp;25, <i>JCA CCI</i></a></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">LoadTimeWeaverAware</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Defined <span class="emphasis"><em>weaver</em></span> for processing class definition at load time</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-aj-ltw" title="8.8.4&nbsp;Load-time weaving with AspectJ in the Spring Framework">Section&nbsp;8.8.4, Load-time weaving with AspectJ in the Spring Framework</a></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">MessageSourceAware</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Configured strategy for resolving messages (with support for parametrization and internationalization)</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#context-introduction" title="4.16&nbsp;Additional Capabilities of the ApplicationContext">Section&nbsp;4.16, Additional Capabilities of the ApplicationContext</a></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">NotificationPublisherAware</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Spring JMX notification publisher</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#jmx-notifications" title="24.7&nbsp;Notifications">Section&nbsp;24.7, Notifications</a></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PortletConfigAware</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Current <code class="literal">PortletConfig</code> the container runs in. Valid only in a web-aware Spring <code class="literal">ApplicationContext</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#portlet" title="19.&nbsp;Portlet MVC Framework">Chapter&nbsp;19, <i>Portlet MVC Framework</i></a></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PortletContextAware</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Current <code class="literal">PortletContext</code> the container runs in. Valid only in a web-aware Spring <code class="literal">ApplicationContext</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#portlet" title="19.&nbsp;Portlet MVC Framework">Chapter&nbsp;19, <i>Portlet MVC Framework</i></a></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ResourceLoaderAware</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Configured loader for low-level access to resources</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#resources" title="5.&nbsp;Resources">Chapter&nbsp;5, <i>Resources</i></a></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ServletConfigAware</code></p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Current <code class="literal">ServletConfig</code> the container runs in. Valid only in a web-aware Spring <code class="literal">ApplicationContext</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc" title="16.&nbsp;Web MVC framework">Chapter&nbsp;16, <i>Web MVC framework</i></a></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ServletContextAware</code></p></td>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Current <code class="literal">ServletContext</code> the container runs in. Valid only in a web-aware Spring <code class="literal">ApplicationContext</code></p></td>
         <td style="" align="left" valign="top"><p><a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc" title="16.&nbsp;Web MVC framework">Chapter&nbsp;16, <i>Web MVC framework</i></a></p></td>
        </tr>
       </tbody>
      </table> 
     </div>
    </div>
    <br class="table-break" /> 
    <p>Note again that usage of these interfaces ties your code to the Spring API and does not follow the Inversion of Control style. As such, they are recommended for infrastructure beans that require programmatic access to the container.</p> 
   </div> 
  </div> 
  <div class="section" title="4.7&nbsp;Bean definition inheritance">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="beans-child-bean-definitions"></a>4.7&nbsp;Bean definition inheritance</h2>
     </div>
    </div>
   </div> 
   <p>A bean definition can contain a lot of configuration information, including constructor arguments, property values, and container-specific information such as initialization method, static factory method name, and so on. A child bean definition inherits configuration data from a parent definition. The child definition can override some values, or add others, as needed. Using parent and child bean definitions can save a lot of typing. Effectively, this is a form of templating.</p> 
   <p>If you work with an <code class="literal">ApplicationContext</code> interface programmatically, child bean definitions are represented by the <code class="literal">ChildBeanDefinition</code> class. Most users do not work with them on this level, instead configuring bean definitions declaratively in something like the <code class="literal">ClassPathXmlApplicationContext</code>. When you use XML-based configuration metadata, you indicate a child bean definition by using the <code class="literal">parent</code> attribute, specifying the parent bean as the value of this attribute.</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;inheritedTestBean&quot;</span> <span class="hl-attribute">abstract</span>=<span class="hl-value">&quot;true&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.beans.TestBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;parent&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;age&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;1&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;inheritsWithDifferentClass&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.beans.DerivedTestBean&quot;</span>
        <span class="strong"><strong>parent=&quot;inheritedTestBean&quot;</strong></span> init-method=&quot;initialize&quot;&gt;
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;override&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-comment">&lt;!-- the age property value of 1 will be inherited from parent --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   <p>A child bean definition uses the bean class from the parent definition if none is specified, but can also override it. In the latter case, the child bean class must be compatible with the parent, that is, it must accept the parents property values.</p> 
   <p>A child bean definition inherits constructor argument values, property values, and method overrides from the parent, with the option to add new values. Any initialization method, destroy method, and/or <code class="literal">static</code> factory method settings that you specify will override the corresponding parent settings.</p> 
   <p>The remaining settings are <span class="emphasis"><em>always</em></span> taken from the child definition: <span class="emphasis"><em>depends on</em></span>, <span class="emphasis"><em>autowire mode</em></span>, <span class="emphasis"><em>dependency check</em></span>, <span class="emphasis"><em>singleton</em></span>, <span class="emphasis"><em>scope</em></span>, <span class="emphasis"><em>lazy init</em></span>.</p> 
   <p>The preceding example explicitly marks the parent bean definition as abstract by using the <code class="literal">abstract</code> attribute. If the parent definition does not specify a class, explicitly marking the parent bean definition as <code class="literal">abstract</code> is required, as follows:</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;inheritedTestBeanWithoutClass&quot;</span> <span class="hl-attribute">abstract</span>=<span class="hl-value">&quot;true&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;parent&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;age&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;1&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;inheritsWithClass&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.beans.DerivedTestBean&quot;</span>
        <span class="hl-attribute">parent</span>=<span class="hl-value">&quot;inheritedTestBeanWithoutClass&quot;</span> <span class="hl-attribute">init-method</span>=<span class="hl-value">&quot;initialize&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;override&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-comment">&lt;!-- age will inherit the value of 1 from the parent bean definition--&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   <p>The parent bean cannot be instantiated on its own because it is incomplete, and it is also explicitly marked as <code class="literal">abstract</code>. When a definition is <code class="literal">abstract</code> like this, it is usable only as a pure template bean definition that serves as a parent definition for child definitions. Trying to use such an <code class="literal">abstract</code> parent bean on its own, by referring to it as a ref property of another bean or doing an explicit <code class="literal">getBean()</code> call with the parent bean id, returns an error. Similarly, the containers internal <code class="literal">preInstantiateSingletons()</code> method ignores bean definitions that are defined as abstract.</p> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p><code class="literal">ApplicationContext</code> pre-instantiates all singletons by default. Therefore, it is important (at least for singleton beans) that if you have a (parent) bean definition which you intend to use only as a template, and this definition specifies a class, you must make sure to set the <span class="emphasis"><em>abstract</em></span> attribute to <span class="emphasis"><em>true</em></span>, otherwise the application context will actually (attempt to) pre-instantiate the <code class="literal">abstract</code> bean.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
  </div> 
  <div class="section" title="4.8&nbsp;Container Extension Points">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="beans-factory-extension"></a>4.8&nbsp;Container Extension Points</h2>
     </div>
    </div>
   </div> 
   <p>Typically, an application developer does not need to subclass <code class="literal">ApplicationContext</code> implementation classes. Instead, the Spring IoC container can be extended by plugging in implementations of special integration interfaces. The next few sections describe these integration interfaces.</p> 
   <div class="section" title="4.8.1&nbsp;Customizing beans using a BeanPostProcessor">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-factory-extension-bpp"></a>4.8.1&nbsp;Customizing beans using a BeanPostProcessor</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">BeanPostProcessor</code> interface defines <span class="emphasis"><em>callback methods</em></span> that you can implement to provide your own (or override the containers default) instantiation logic, dependency-resolution logic, and so forth. If you want to implement some custom logic after the Spring container finishes instantiating, configuring, and initializing a bean, you can plug in one or more <code class="literal">BeanPostProcessor</code> implementations.</p> 
    <p>You can configure multiple <code class="literal">BeanPostProcessor</code> instances, and you can control the order in which these <code class="literal">BeanPostProcessor</code> s execute by setting the <code class="literal">order</code> property. You can set this property only if the <code class="literal">BeanPostProcessor</code> implements the <code class="literal">Ordered</code> interface; if you write your own <code class="literal">BeanPostProcessor</code> you should consider implementing the <code class="literal">Ordered</code> interface too. For further details, consult the Javadoc for the <code class="literal">BeanPostProcessor</code> and <code class="literal">Ordered</code> interfaces. See also the note below on <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#">programmatic registration of <code class="literal">BeanPostProcessors</code></a></p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p><code class="literal">BeanPostProcessor</code> s operate on bean (or object) <span class="emphasis"><em>instances</em></span>; that is to say, the Spring IoC container instantiates a bean instance and <span class="emphasis"><em>then</em></span> <code class="literal">BeanPostProcessor</code> s do their work.</p> <p><code class="literal">BeanPostProcessor</code> s are scoped <span class="emphasis"><em>per-container</em></span>. This is only relevant if you are using container hierarchies. If you define a <code class="literal">BeanPostProcessor</code> in one container, it will <span class="emphasis"><em>only</em></span> post-process the beans in that container. In other words, beans that are defined in one container are not post-processed by a <code class="literal">BeanPostProcessor</code> defined in another container, even if both containers are part of the same hierarchy.</p> <p>To change the actual bean definition (i.e., the <span class="emphasis"><em>blueprint</em></span> that defines the bean), you instead need to use a <code class="literal">BeanFactoryPostProcessor</code> as described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-extension-factory-postprocessors" title="4.8.2&nbsp;Customizing configuration metadata with a BeanFactoryPostProcessor">Section&nbsp;4.8.2, Customizing configuration metadata with a BeanFactoryPostProcessor</a>.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>The <code class="literal">org.springframework.beans.factory.config.BeanPostProcessor</code> interface consists of exactly two callback methods. When such a class is registered as a post-processor with the container, for each bean instance that is created by the container, the post-processor gets a callback from the container both <span class="emphasis"><em>before</em></span> container initialization methods (such as InitializingBeans <span class="emphasis"><em>afterPropertiesSet()</em></span> and any declared init method) are called as well as <span class="emphasis"><em>after</em></span> any bean initialization callbacks. The post-processor can take any action with the bean instance, including ignoring the callback completely. A bean post-processor typically checks for callback interfaces or may wrap a bean with a proxy. Some Spring AOP infrastructure classes are implemented as bean post-processors in order to provide proxy-wrapping logic.</p> 
    <p>An <code class="literal">ApplicationContext</code> <span class="emphasis"><em>automatically detects</em></span> any beans that are defined in the configuration metadata which implement the <code class="literal">BeanPostProcessor</code> interface. The <code class="literal">ApplicationContext</code> registers these beans as post-processors so that they can be called later upon bean creation. Bean post-processors can be deployed in the container just like any other beans.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p><span class="strong"><strong>Programmatically registering BeanPostProcessors</strong></span></p> <p>While the recommended approach for <code class="literal">BeanPostProcessor</code> registration is through <code class="literal">ApplicationContext</code> auto-detection (as described above), it is also possible to register them <span class="emphasis"><em>programmatically</em></span> against a <code class="literal">ConfigurableBeanFactory</code> using the <code class="literal">addBeanPostProcessor</code> method. This can be useful when needing to evaluate conditional logic before registration, or even for copying bean post processors across contexts in a hierarchy. Note however that <code class="literal">BeanPostProcessors</code> added programmatically <span class="emphasis"><em>do not respect the <code class="literal">Ordered</code> interface</em></span>. Here it is the <span class="emphasis"><em>order of registration</em></span> that dictates the order of execution. Note also that <code class="literal">BeanPostProcessors</code> registered programmatically are always processed before those registered through auto-detection, regardless of any explicit ordering.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p><span class="strong"><strong>BeanPostProcessors and AOP auto-proxying</strong></span></p> <p>Classes that implement the <code class="literal">BeanPostProcessor</code> interface are <span class="emphasis"><em>special</em></span> and are treated differently by the container. All <code class="literal">BeanPostProcessors</code> <span class="emphasis"><em>and beans that they reference directly</em></span> are instantiated on startup, as part of the special startup phase of the <code class="literal">ApplicationContext</code>. Next, all <code class="literal">BeanPostProcessors</code> are registered in a sorted fashion and applied to all further beans in the container. Because AOP auto-proxying is implemented as a <code class="literal">BeanPostProcessor</code> itself, neither <code class="literal">BeanPostProcessors</code> nor the beans they reference directly are eligible for auto-proxying, and thus do not have aspects woven into them.</p> <p>For any such bean, you should see an informational log message: &quot;<span class="emphasis"><em>Bean foo is not eligible for getting processed by all BeanPostProcessor interfaces (for example: not eligible for auto-proxying)</em></span>&quot;.</p> <p>Note that if you have beans wired into your <code class="literal">BeanPostProcessor</code> using autowiring or <code class="literal">@Resource</code> (which may fall back to autowiring), Spring might access unexpected beans when searching for type-matching dependency candidates, and therefore make them ineligible for auto-proxying or other kinds of bean post-processing. For example, if you have a dependency annotated with <code class="literal">@Resource</code> where the field/setter name does not directly correspond to the declared name of a bean and no name attribute is used, then Spring will access other beans for matching them by type.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>The following examples show how to write, register, and use <code class="literal">BeanPostProcessors</code> in an <code class="literal">ApplicationContext</code>.</p> 
    <div class="section" title="Example: Hello World, BeanPostProcessor-style">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-extension-bpp-examples-hw"></a>Example: Hello World, BeanPostProcessor-style</h4>
       </div>
      </div>
     </div> 
     <p>This first example illustrates basic usage. The example shows a custom <code class="literal">BeanPostProcessor</code> implementation that invokes the <code class="literal">toString()</code> method of each bean as it is created by the container and prints the resulting string to the system console.</p> 
     <p>Find below the custom <code class="literal">BeanPostProcessor</code> implementation class definition:</p> 
     <pre class="programlisting"><span class="hl-keyword">package</span> scripting;

<span class="hl-keyword">import</span> org.springframework.beans.factory.config.BeanPostProcessor;
<span class="hl-keyword">import</span> org.springframework.beans.BeansException;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> InstantiationTracingBeanPostProcessor <span class="hl-keyword">implements</span> BeanPostProcessor {

    <span class="hl-comment">// simply return the instantiated bean as-is</span>
    <span class="hl-keyword">public</span> Object postProcessBeforeInitialization(Object bean,
            String beanName) <span class="hl-keyword">throws</span> BeansException {
        <span class="hl-keyword">return</span> bean; <span class="hl-comment">// we could potentially return any object reference here...</span>
    }

    <span class="hl-keyword">public</span> Object postProcessAfterInitialization(Object bean,
            String beanName) <span class="hl-keyword">throws</span> BeansException {
        System.out.println(<span class="hl-string">&quot;Bean </span><span class="emphasis"><em>&quot; + beanName + &quot;</em></span> created : <span class="hl-string">&quot; + bean.toString());
</span>        <span class="hl-keyword">return</span> bean;
    }

}</pre> 
     <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:lang</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/lang&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/lang
        http://www.springframework.org/schema/lang/spring-lang.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;lang:groovy</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;messenger&quot;</span>
            <span class="hl-attribute">script-source</span>=<span class="hl-value">&quot;classpath:org/springframework/scripting/groovy/Messenger.groovy&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;lang:property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;message&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Fiona Apple Is Just So Dreamy.&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/lang:groovy&gt;</span>

    <span class="hl-comment">&lt;!--
    when the above bean (messenger) is instantiated, this custom
    BeanPostProcessor implementation will output the fact to the system console
    --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;scripting.InstantiationTracingBeanPostProcessor&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
     <p>Notice how the <code class="literal">InstantiationTracingBeanPostProcessor</code> is simply defined. It does not even have a name, and because it is a bean it can be dependency-injected just like any other bean. (The preceding configuration also defines a bean that is backed by a Groovy script. The Spring dynamic language support is detailed in the chapter entitled <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#dynamic-language" title="28.&nbsp;Dynamic language support">Chapter&nbsp;28, <i>Dynamic language support</i></a>.)</p> 
     <p>The following simple Java application executes the preceding code and configuration:</p> 
     <pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.context.ApplicationContext;
<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;
<span class="hl-keyword">import</span> org.springframework.scripting.Messenger;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> Boot {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(<span class="hl-keyword">final</span> String[] args) <span class="hl-keyword">throws</span> Exception {
        ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">&quot;scripting/beans.xml&quot;</span>);
        Messenger messenger = (Messenger) ctx.getBean(<span class="hl-string">&quot;messenger&quot;</span>);
        System.out.println(messenger);
    }

}</pre> 
     <p>The output of the preceding application resembles the following:</p> 
     <pre class="literallayout">Bean <span class="emphasis"><em>messenger</em></span> created : org.springframework.scripting.groovy.GroovyMessenger@272961
org.springframework.scripting.groovy.GroovyMessenger@272961</pre> 
    </div> 
    <div class="section" title="Example: The RequiredAnnotationBeanPostProcessor">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-extension-bpp-examples-rabpp"></a>Example: The RequiredAnnotationBeanPostProcessor</h4>
       </div>
      </div>
     </div> 
     <p>Using callback interfaces or annotations in conjunction with a custom <code class="literal">BeanPostProcessor</code> implementation is a common means of extending the Spring IoC container. An example is Springs <code class="literal">RequiredAnnotationBeanPostProcessor</code> - a <code class="literal">BeanPostProcessor</code> implementation that ships with the Spring distribution which ensures that JavaBean properties on beans that are marked with an (arbitrary) annotation are actually (configured to be) dependency-injected with a value.</p> 
    </div> 
   </div> 
   <div class="section" title="4.8.2&nbsp;Customizing configuration metadata with a BeanFactoryPostProcessor">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-factory-extension-factory-postprocessors"></a>4.8.2&nbsp;Customizing configuration metadata with a BeanFactoryPostProcessor</h3>
      </div>
     </div>
    </div> 
    <p>The next extension point that we will look at is the <code class="literal">org.springframework.beans.factory.config.BeanFactoryPostProcessor</code>. The semantics of this interface are similar to those of the <code class="literal">BeanPostProcessor</code>, with one major difference: <code class="literal">BeanFactoryPostProcessor</code> operates on the <span class="emphasis"><em>bean configuration metadata</em></span>; that is, the Spring IoC container allows a <code class="literal">BeanFactoryPostProcessor</code> to read the configuration metadata and potentially change it <span class="emphasis"><em>before</em></span> the container instantiates any beans other than <code class="literal">BeanFactoryPostProcessors</code>.</p> 
    <p>You can configure multiple <code class="literal">BeanFactoryPostProcessors</code>, and you can control the order in which these <code class="literal">BeanFactoryPostProcessors</code> execute by setting the <code class="literal">order</code> property. However, you can only set this property if the <code class="literal">BeanFactoryPostProcessor</code> implements the <code class="literal">Ordered</code> interface. If you write your own <code class="literal">BeanFactoryPostProcessor</code>, you should consider implementing the <code class="literal">Ordered</code> interface too. Consult the Javadoc for the <code class="literal">BeanFactoryPostProcessor</code> and <code class="literal">Ordered</code> interfaces for more details.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>If you want to change the actual bean <span class="emphasis"><em>instances</em></span> (i.e., the objects that are created from the configuration metadata), then you instead need to use a <code class="literal">BeanPostProcessor</code> (described above in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-extension-bpp" title="4.8.1&nbsp;Customizing beans using a BeanPostProcessor">Section&nbsp;4.8.1, Customizing beans using a BeanPostProcessor</a>). While it is technically possible to work with bean instances within a <code class="literal">BeanFactoryPostProcessor</code> (e.g., using <code class="literal">BeanFactory.getBean()</code>), doing so causes premature bean instantiation, violating the standard container lifecycle. This may cause negative side effects such as bypassing bean post processing.</p> <p>Also, <code class="literal">BeanFactoryPostProcessors</code> are scoped <span class="emphasis"><em>per-container</em></span>. This is only relevant if you are using container hierarchies. If you define a <code class="literal">BeanFactoryPostProcessor</code> in one container, it will <span class="emphasis"><em>only</em></span> be applied to the bean definitions in that container. Bean definitions in one container will not be post-processed by <code class="literal">BeanFactoryPostProcessors</code> in another container, even if both containers are part of the same hierarchy.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>A bean factory post-processor is executed automatically when it is declared inside an <code class="literal">ApplicationContext</code>, in order to apply changes to the configuration metadata that define the container. Spring includes a number of predefined bean factory post-processors, such as <code class="literal">PropertyOverrideConfigurer</code> and <code class="literal">PropertyPlaceholderConfigurer</code>. A custom <code class="literal">BeanFactoryPostProcessor</code> can also be used, for example, to register custom property editors.</p> 
    <p><a name="null"></a>An <code class="literal">ApplicationContext</code> automatically detects any beans that are deployed into it that implement the <code class="literal">BeanFactoryPostProcessor</code> interface. It uses these beans as bean factory post-processors, at the appropriate time. You can deploy these post-processor beans as you would any other bean.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>As with <code class="literal">BeanPostProcessor</code> s , you typically do not want to configure <code class="literal">BeanFactoryPostProcessor</code> s for lazy initialization. If no other bean references a <code class="literal">Bean(Factory)PostProcessor</code>, that post-processor will not get instantiated at all. Thus, marking it for lazy initialization will be ignored, and the <code class="literal">Bean(Factory)PostProcessor</code> will be instantiated eagerly even if you set the <code class="literal">default-lazy-init</code> attribute to <code class="literal">true</code> on the declaration of your <code class="literal">&lt;beans /&gt;</code> element.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <div class="section" title="Example: the Class name substitution PropertyPlaceholderConfigurer">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-placeholderconfigurer"></a>Example: the Class name substitution PropertyPlaceholderConfigurer</h4>
       </div>
      </div>
     </div> 
     <p>You use the <code class="literal">PropertyPlaceholderConfigurer</code> to externalize property values from a bean definition in a separate file using the standard Java <code class="literal">Properties</code> format. Doing so enables the person deploying an application to customize environment-specific properties such as database URLs and passwords, without the complexity or risk of modifying the main XML definition file or files for the container.</p> 
     <p>Consider the following XML-based configuration metadata fragment, where a <code class="literal">DataSource</code> with placeholder values is defined. The example shows properties configured from an external <code class="literal">Properties</code> file. At runtime, a <code class="literal">PropertyPlaceholderConfigurer</code> is applied to the metadata that will replace some properties of the DataSource. The values to replace are specified as <span class="emphasis"><em>placeholders</em></span> of the form <code class="literal">${property-name}</code> which follows the Ant / log4j / JSP EL style.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;locations&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;classpath:com/foo/jdbc.properties&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;dataSource&quot;</span> <span class="hl-attribute">destroy-method</span>=<span class="hl-value">&quot;close&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;driverClassName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;${jdbc.driverClassName}&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;url&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;${jdbc.url}&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;username&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;${jdbc.username}&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;password&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;${jdbc.password}&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
     <p>The actual values come from another file in the standard Java <code class="literal">Properties</code> format:</p> 
     <pre class="literallayout">jdbc.driverClassName=org.hsqldb.jdbcDriver
jdbc.url=jdbc:hsqldb:hsql://production:9002
jdbc.username=sa
jdbc.password=root</pre> 
     <p>Therefore, the string <code class="literal">${jdbc.username}</code> is replaced at runtime with the value <span class="emphasis"><em>sa</em></span>, and the same applies for other placeholder values that match keys in the properties file. The <code class="literal">PropertyPlaceholderConfigurer</code> checks for placeholders in most properties and attributes of a bean definition. Furthermore, the placeholder prefix and suffix can be customized.</p> 
     <p>With the <code class="literal">context</code> namespace introduced in Spring 2.5, it is possible to configure property placeholders with a dedicated configuration element. One or more locations can be provided as a comma-separated list in the <code class="literal">location</code> attribute.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;context:property-placeholder</span> <span class="hl-attribute">location</span>=<span class="hl-value">&quot;classpath:com/foo/jdbc.properties&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <p>The <code class="literal">PropertyPlaceholderConfigurer</code> not only looks for properties in the <code class="literal">Properties</code> file you specify. By default it also checks against the Java <code class="literal">System</code> properties if it cannot find a property in the specified properties files. You can customize this behavior by setting the <code class="literal">systemPropertiesMode</code> property of the configurer with one of the following three supported integer values:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> <span class="emphasis"><em>never</em></span> (0): Never check system properties </li>
       <li class="listitem"> <span class="emphasis"><em>fallback</em></span> (1): Check system properties if not resolvable in the specified properties files. This is the default. </li>
       <li class="listitem"> <span class="emphasis"><em>override</em></span> (2): Check system properties first, before trying the specified properties files. This allows system properties to override any other property source. </li>
      </ul>
     </div> 
     <p>Consult the Javadoc for the <code class="literal">PropertyPlaceholderConfigurer</code> for more information.</p> 
     <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Tip">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
         <th align="left">Tip</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>You can use the <code class="literal">PropertyPlaceholderConfigurer</code> to substitute class names, which is sometimes useful when you have to pick a particular implementation class at runtime. For example:</p> <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;locations&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;value&gt;</span>classpath:com/foo/strategy.properties<span class="hl-tag">&lt;/value&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;properties&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;value&gt;</span>custom.strategy.class=com.foo.DefaultStrategy<span class="hl-tag">&lt;/value&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;serviceStrategy&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;${custom.strategy.class}&quot;</span><span class="hl-tag">/&gt;</span></pre> <p>If the class cannot be resolved at runtime to a valid class, resolution of the bean fails when it is about to be created, which is during the <code class="literal">preInstantiateSingletons()</code> phase of an <code class="literal">ApplicationContext</code> for a non-lazy-init bean.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="Example: the PropertyOverrideConfigurer">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-factory-overrideconfigurer"></a>Example: the PropertyOverrideConfigurer</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">PropertyOverrideConfigurer</code>, another bean factory post-processor, resembles the <code class="literal">PropertyPlaceholderConfigurer</code>, but unlike the latter, the original definitions can have default values or no values at all for bean properties. If an overriding <code class="literal">Properties</code> file does not have an entry for a certain bean property, the default context definition is used.</p> 
     <p>Note that the bean definition is <span class="emphasis"><em>not</em></span> aware of being overridden, so it is not immediately obvious from the XML definition file that the override configurer is being used. In case of multiple <code class="literal">PropertyOverrideConfigurer</code> instances that define different values for the same bean property, the last one wins, due to the overriding mechanism.</p> 
     <p>Properties file configuration lines take this format:</p> 
     <pre class="literallayout">beanName.property=value</pre> 
     <p>For example:</p> 
     <pre class="literallayout">dataSource.driverClassName=com.mysql.jdbc.Driver
dataSource.url=jdbc:mysql:mydb</pre> 
     <p>This example file can be used with a container definition that contains a bean called <span class="emphasis"><em>dataSource</em></span>, which has <span class="emphasis"><em>driver</em></span> and <span class="emphasis"><em>url</em></span> properties.</p> 
     <p>Compound property names are also supported, as long as every component of the path except the final property being overridden is already non-null (presumably initialized by the constructors). In this example</p> 
     <pre class="literallayout">foo.fred.bob.sammy=123</pre> 
     <div class="orderedlist">
      <ol class="orderedlist" type="i">
       <li class="listitem"> the <code class="literal">sammy</code> property of the <code class="literal">bob</code> property of the <code class="literal">fred</code> property of the <code class="literal">foo</code> bean is set to the scalar value <code class="literal">123</code>. </li>
      </ol>
     </div> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>Specified override values are always <span class="emphasis"><em>literal</em></span> values; they are not translated into bean references. This convention also applies when the original value in the XML bean definition specifies a bean reference.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <p>With the <code class="literal">context</code> namespace introduced in Spring 2.5, it is possible to configure property overriding with a dedicated configuration element:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;context:property-override</span> <span class="hl-attribute">location</span>=<span class="hl-value">&quot;classpath:override.properties&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    </div> 
   </div> 
   <div class="section" title="4.8.3&nbsp;Customizing instantiation logic with a FactoryBean">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-factory-extension-factorybean"></a>4.8.3&nbsp;Customizing instantiation logic with a FactoryBean</h3>
      </div>
     </div>
    </div> 
    <p>Implement the <code class="literal">org.springframework.beans.factory.FactoryBean</code> interface for objects that <span class="emphasis"><em>are themselves factories</em></span>.</p> 
    <p>The <code class="literal">FactoryBean</code> interface is a point of pluggability into the Spring IoC containers instantiation logic. If you have complex initialization code that is better expressed in Java as opposed to a (potentially) verbose amount of XML, you can create your own <code class="literal">FactoryBean</code>, write the complex initialization inside that class, and then plug your custom <code class="literal">FactoryBean</code> into the container.</p> 
    <p>The <code class="literal">FactoryBean</code> interface provides three methods:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> <code class="literal">Object getObject()</code>: returns an instance of the object this factory creates. The instance can possibly be shared, depending on whether this factory returns singletons or prototypes. </li>
      <li class="listitem"> <code class="literal">boolean isSingleton()</code>: returns <code class="literal">true</code> if this <code class="literal">FactoryBean</code> returns singletons, <code class="literal">false</code> otherwise. </li>
      <li class="listitem"> <code class="literal">Class getObjectType()</code>: returns the object type returned by the <code class="literal">getObject()</code> method or <code class="literal">null</code> if the type is not known in advance. </li>
     </ul>
    </div> 
    <p>The <code class="literal">FactoryBean</code> concept and interface is used in a number of places within the Spring Framework; more than 50 implementations of the <code class="literal">FactoryBean</code> interface ship with Spring itself.</p> 
    <p>When you need to ask a container for an actual <code class="literal">FactoryBean</code> instance itself instead of the bean it produces, preface the beans id with the ampersand symbol ( <code class="literal">&amp;</code>) when calling the <code class="literal">getBean()</code> method of the <code class="literal">ApplicationContext</code>. So for a given <code class="literal">FactoryBean</code> with an id of <code class="literal">myBean</code>, invoking <code class="literal">getBean(&quot;myBean&quot;)</code> on the container returns the product of the <code class="literal">FactoryBean</code>; whereas, invoking <code class="literal">getBean(&quot;&amp;myBean&quot;)</code> returns the <code class="literal">FactoryBean</code> instance itself.</p> 
   </div> 
  </div> 
  <div class="section" title="4.9&nbsp;Annotation-based container configuration">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="beans-annotation-config"></a>4.9&nbsp;Annotation-based container configuration</h2>
     </div>
    </div>
   </div> 
   <div class="sidebar" title="Are annotations better than XML for configuring Spring?">
    <p class="title"><b>Are annotations better than XML for configuring Spring?</b></p> 
    <p>The introduction of annotation-based configurations raised the question of whether this approach is <span class="emphasis"><em>better</em></span> than XML. The short answer is <span class="emphasis"><em>it depends</em></span>. The long answer is that each approach has its pros and cons, and usually it is up to the developer to decide which strategy suits them better. Due to the way they are defined, annotations provide a lot of context in their declaration, leading to shorter and more concise configuration. However, XML excels at wiring up components without touching their source code or recompiling them. Some developers prefer having the wiring close to the source while others argue that annotated classes are no longer POJOs and, furthermore, that the configuration becomes decentralized and harder to control.</p> 
    <p>No matter the choice, Spring can accommodate both styles and even mix them together. Its worth pointing out that through its <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-java" title="4.12&nbsp;Java-based container configuration">JavaConfig</a> option, Spring allows annotations to be used in a non-invasive way, without touching the target components source code and that in terms of tooling, all configuration styles are supported by the <a class="ulink" href="http://www.springsource.com/products/sts" target="_top">SpringSource Tool Suite</a>.</p> 
   </div> 
   <p>An alternative to XML setups is provided by annotation-based configuration which rely on the bytecode metadata for wiring up components instead of angle-bracket declarations. Instead of using XML to describe a bean wiring, the developer moves the configuration into the component class itself by using annotations on the relevant class, method, or field declaration. As mentioned in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-extension-bpp-examples-rabpp" title="Example: The RequiredAnnotationBeanPostProcessor">the section called Example: The RequiredAnnotationBeanPostProcessor</a>, using a <code class="literal">BeanPostProcessor</code> in conjunction with annotations is a common means of extending the Spring IoC container. For example, Spring 2.0 introduced the possibility of enforcing required properties with the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-required-annotation" title="4.9.1&nbsp;@Required">@Required</a> annotation. Spring 2.5 made it possible to follow that same general approach to drive Springs dependency injection. Essentially, the <code class="literal">@Autowired</code> annotation provides the same capabilities as described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-autowire" title="4.4.5&nbsp;Autowiring collaborators">Section&nbsp;4.4.5, Autowiring collaborators</a> but with more fine-grained control and wider applicability. Spring 2.5 also added support for JSR-250 annotations such as <code class="literal">@PostConstruct</code>, and <code class="literal">@PreDestroy</code>. Spring 3.0 added support for JSR-330 (Dependency Injection for Java) annotations contained in the javax.inject package such as <code class="literal">@Inject</code> and <code class="literal">@Named</code>. Details about those annotations can be found in the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-standard-annotations" title="4.11&nbsp;Using JSR 330 Standard Annotations">relevant section</a>.</p> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>Annotation injection is performed <span class="emphasis"><em>before</em></span> XML injection, thus the latter configuration will override the former for properties wired through both approaches.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <p>As always, you can register them as individual bean definitions, but they can also be implicitly registered by including the following tag in an XML-based Spring configuration (notice the inclusion of the <code class="literal">context</code> namespace):</p> 
   <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/context&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;context:annotation-config/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
   <p>(The implicitly registered post-processors include <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/beans/factory/annotation/AutowiredAnnotationBeanPostProcessor.html" target="_top"><code class="literal">AutowiredAnnotationBeanPostProcessor</code></a>, <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/context/annotation/CommonAnnotationBeanPostProcessor.html" target="_top"><code class="literal">CommonAnnotationBeanPostProcessor</code></a>, <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/orm/jpa/support/PersistenceAnnotationBeanPostProcessor.html" target="_top"><code class="literal">PersistenceAnnotationBeanPostProcessor</code></a>, as well as the aforementioned <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/beans/factory/annotation/RequiredAnnotationBeanPostProcessor.html" target="_top"><code class="literal">RequiredAnnotationBeanPostProcessor</code></a>.)</p> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p><code class="literal">&lt;context:annotation-config/&gt;</code> only looks for annotations on beans in the same application context in which it is defined. This means that, if you put <code class="literal">&lt;context:annotation-config/&gt;</code> in a <code class="literal">WebApplicationContext</code> for a <code class="literal">DispatcherServlet</code>, it only checks for <code class="literal">@Autowired</code> beans in your controllers, and not your services. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc-servlet" title="16.2&nbsp;The DispatcherServlet">Section&nbsp;16.2, The DispatcherServlet</a> for more information.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <div class="section" title="4.9.1&nbsp;@Required">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-required-annotation"></a>4.9.1&nbsp;@Required</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">@Required</code> annotation applies to bean property setter methods, as in the following example:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <i><span class="hl-annotation" style="color: gray">@Required</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

    <span class="hl-comment">// ...</span>

}</pre> 
    <p>This annotation simply indicates that the affected bean property must be populated at configuration time, through an explicit property value in a bean definition or through autowiring. The container throws an exception if the affected bean property has not been populated; this allows for eager and explicit failure, avoiding <code class="literal">NullPointerException</code> s or the like later on. It is still recommended that you put assertions into the bean class itself, for example, into an init method. Doing so enforces those required references and values even when you use the class outside of a container.</p> 
   </div> 
   <div class="section" title="4.9.2&nbsp;@Autowired">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-autowired-annotation"></a>4.9.2&nbsp;@Autowired</h3>
      </div>
     </div>
    </div> 
    <p>As expected, you can apply the <code class="literal">@Autowired</code> annotation to &quot;traditional&quot; setter methods:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

    <span class="hl-comment">// ...</span>

}</pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>JSR 330s @Inject annotation can be used in place of Springs <code class="literal">@Autowired</code> annotation in the examples below. See <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-standard-annotations" title="4.11&nbsp;Using JSR 330 Standard Annotations">here</a> for more details</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>You can also apply the annotation to methods with arbitrary names and/or multiple arguments:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <span class="hl-keyword">private</span> MovieCatalog movieCatalog;

    <span class="hl-keyword">private</span> CustomerPreferenceDao customerPreferenceDao;

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> prepare(MovieCatalog movieCatalog,
            CustomerPreferenceDao customerPreferenceDao) {
        <span class="hl-keyword">this</span>.movieCatalog = movieCatalog;
        <span class="hl-keyword">this</span>.customerPreferenceDao = customerPreferenceDao;
    }

    <span class="hl-comment">// ...</span>

}</pre> 
    <p>You can apply <code class="literal">@Autowired</code> to constructors and fields:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> MovieCatalog movieCatalog;

    <span class="hl-keyword">private</span> CustomerPreferenceDao customerPreferenceDao;

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">public</span> MovieRecommender(CustomerPreferenceDao customerPreferenceDao) {
        <span class="hl-keyword">this</span>.customerPreferenceDao = customerPreferenceDao;
    }

    <span class="hl-comment">// ...</span>

}</pre> 
    <p>It is also possible to provide <span class="emphasis"><em>all</em></span> beans of a particular type from the <code class="literal">ApplicationContext</code> by adding the annotation to a field or method that expects an array of that type:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> MovieCatalog[] movieCatalogs;

    <span class="hl-comment">// ...</span>

}</pre> 
    <p>The same applies for typed collections:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <span class="hl-keyword">private</span> Set&lt;MovieCatalog&gt; movieCatalogs;

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieCatalogs(Set&lt;MovieCatalog&gt; movieCatalogs) {
        <span class="hl-keyword">this</span>.movieCatalogs = movieCatalogs;
    }

    <span class="hl-comment">// ...</span>

}</pre> 
    <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Tip">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
        <th align="left">Tip</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Your beans can implement the <code class="literal">org.springframework.core.Ordered</code> interface or use the the <code class="literal">@Ordered</code> annotation if you want items in the array or list to be sorted into a specific order.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>Even typed Maps can be autowired as long as the expected key type is <code class="literal">String</code>. The Map values will contain all beans of the expected type, and the keys will contain the corresponding bean names:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <span class="hl-keyword">private</span> Map&lt;String, MovieCatalog&gt; movieCatalogs;

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieCatalogs(Map&lt;String, MovieCatalog&gt; movieCatalogs) {
        <span class="hl-keyword">this</span>.movieCatalogs = movieCatalogs;
    }

    <span class="hl-comment">// ...</span>

}</pre> 
    <p>By default, the autowiring fails whenever <span class="emphasis"><em>zero</em></span> candidate beans are available; the default behavior is to treat annotated methods, constructors, and fields as indicating <span class="emphasis"><em>required</em></span> dependencies. This behavior can be changed as demonstrated below.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <i><span class="hl-annotation" style="color: gray">@Autowired(required=false)</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

    <span class="hl-comment">// ...</span>

}</pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Only <span class="emphasis"><em>one annotated constructor per-class</em></span> can be marked as <span class="emphasis"><em>required</em></span>, but multiple non-required constructors can be annotated. In that case, each is considered among the candidates and Spring uses the <span class="emphasis"><em>greediest</em></span> constructor whose dependencies can be satisfied, that is the constructor that has the largest number of arguments.</p> <p><code class="literal">@Autowired</code>'s <span class="emphasis"><em>required</em></span> attribute is recommended over the <code class="literal">@Required</code> annotation. The <span class="emphasis"><em>required</em></span> attribute indicates that the property is not required for autowiring purposes, the property is ignored if it cannot be autowired. <code class="literal">@Required</code>, on the other hand, is stronger in that it enforces the property that was set by any means supported by the container. If no value is injected, a corresponding exception is raised.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>You can also use <code class="literal">@Autowired</code> for interfaces that are well-known resolvable dependencies: <code class="literal">BeanFactory</code>, <code class="literal">ApplicationContext</code>, <code class="literal">Environment</code>, <code class="literal">ResourceLoader</code>, <code class="literal">ApplicationEventPublisher</code>, and <code class="literal">MessageSource</code>. These interfaces and their extended interfaces, such as <code class="literal">ConfigurableApplicationContext</code> or <code class="literal">ResourcePatternResolver</code>, are automatically resolved, with no special setup necessary.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> ApplicationContext context;

    <span class="hl-keyword">public</span> MovieRecommender() {
    }

    <span class="hl-comment">// ...</span>

}</pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p><code class="literal">@Autowired</code>, <code class="literal">@Inject</code>, <code class="literal">@Resource</code>, and <code class="literal">@Value</code> annotations are handled by a Spring <code class="literal">BeanPostProcessor</code> implementations which in turn means that you <span class="emphasis"><em>cannot</em></span> apply these annotations within your own <code class="literal">BeanPostProcessor</code> or <code class="literal">BeanFactoryPostProcessor</code> types (if any). These types must be <span class="emphasis"><em>wired up</em></span> explicitly via XML or using a Spring <code class="literal">@Bean</code> method.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="4.9.3&nbsp;Fine-tuning annotation-based autowiring with qualifiers">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-autowired-annotation-qualifiers"></a>4.9.3&nbsp;Fine-tuning annotation-based autowiring with qualifiers</h3>
      </div>
     </div>
    </div> 
    <p>Because autowiring by type may lead to multiple candidates, it is often necessary to have more control over the selection process. One way to accomplish this is with Springs <code class="literal">@Qualifier</code> annotation. You can associate qualifier values with specific arguments, narrowing the set of type matches so that a specific bean is chosen for each argument. In the simplest case, this can be a plain descriptive value:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="strong"><strong>@Qualifier(&quot;main&quot;)</strong></span>
    <span class="hl-keyword">private</span> MovieCatalog movieCatalog;

    <span class="hl-comment">// ...</span>

}</pre> 
    <p>The <code class="literal">@Qualifier</code> annotation can also be specified on individual constructor arguments or method parameters:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <span class="hl-keyword">private</span> MovieCatalog movieCatalog;

    <span class="hl-keyword">private</span> CustomerPreferenceDao customerPreferenceDao;

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> prepare(<span class="strong"><strong>@Qualifier(&quot;main&quot;)</strong></span>MovieCatalog movieCatalog,
            CustomerPreferenceDao customerPreferenceDao) {
        <span class="hl-keyword">this</span>.movieCatalog = movieCatalog;
        <span class="hl-keyword">this</span>.customerPreferenceDao = customerPreferenceDao;
    }

    <span class="hl-comment">// ...</span>

}</pre> 
    <p>The corresponding bean definitions appear as follows. The bean with qualifier value &quot;main&quot; is wired with the constructor argument that is qualified with the same value.</p> 
    <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/context&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;context:annotation-config/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.SimpleMovieCatalog&quot;</span><span class="hl-tag">&gt;</span>
        <span class="strong"><strong>&lt;qualifier value=&quot;main&quot;/&gt;</strong></span>

        <span class="hl-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.SimpleMovieCatalog&quot;</span><span class="hl-tag">&gt;</span>
        <span class="strong"><strong>&lt;qualifier value=&quot;action&quot;/&gt;</strong></span>

        <span class="hl-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;movieRecommender&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.MovieRecommender&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>For a fallback match, the bean name is considered a default qualifier value. Thus you can define the bean with an id &quot;main&quot; instead of the nested qualifier element, leading to the same matching result. However, although you can use this convention to refer to specific beans by name, <code class="literal">@Autowired</code> is fundamentally about type-driven injection with optional semantic qualifiers. This means that qualifier values, even with the bean name fallback, always have narrowing semantics within the set of type matches; they do not semantically express a reference to a unique bean id. Good qualifier values are &quot;main&quot; or &quot;EMEA&quot; or &quot;persistent&quot;, expressing characteristics of a specific component that are independent from the bean id, which may be auto-generated in case of an anonymous bean definition like the one in the preceding example.</p> 
    <p>Qualifiers also apply to typed collections, as discussed above, for example, to <code class="literal">Set&lt;MovieCatalog&gt;</code>. In this case, all matching beans according to the declared qualifiers are injected as a collection. This implies that qualifiers do not have to be unique; they rather simply constitute filtering criteria. For example, you can define multiple <code class="literal">MovieCatalog</code> beans with the same qualifier value &quot;action&quot;; all of which would be injected into a <code class="literal">Set&lt;MovieCatalog&gt;</code> annotated with <code class="literal">@Qualifier(&quot;action&quot;)</code>.</p> 
    <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Tip">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
        <th align="left">Tip</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>If you intend to express annotation-driven injection by name, do not primarily use <code class="literal">@Autowired</code>, even if is technically capable of referring to a bean name through <code class="literal">@Qualifier</code> values. Instead, use the JSR-250 <code class="literal">@Resource</code> annotation, which is semantically defined to identify a specific target component by its unique name, with the declared type being irrelevant for the matching process.</p> <p>As a specific consequence of this semantic difference, beans that are themselves defined as a collection or map type cannot be injected through <code class="literal">@Autowired</code>, because type matching is not properly applicable to them. Use <code class="literal">@Resource</code> for such beans, referring to the specific collection or map bean by unique name.</p> <p><code class="literal">@Autowired</code> applies to fields, constructors, and multi-argument methods, allowing for narrowing through qualifier annotations at the parameter level. By contrast, <code class="literal">@Resource</code> is supported only for fields and bean property setter methods with a single argument. As a consequence, stick with qualifiers if your injection target is a constructor or a multi-argument method.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>You can create your own custom qualifier annotations. Simply define an annotation and provide the <code class="literal">@Qualifier</code> annotation within your definition:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Target({ElementType.FIELD, ElementType.PARAMETER})</span></i>
<i><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></i>
<span class="strong"><strong>@Qualifier</strong></span>
<span class="hl-keyword">public</span> <i><span class="hl-annotation" style="color: gray">@interface</span></i> Genre {

    String value();
}</pre> 
    <p>Then you can provide the custom qualifier on autowired fields and parameters:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="strong"><strong>@Genre(&quot;Action&quot;)</strong></span>
    <span class="hl-keyword">private</span> MovieCatalog actionCatalog;
    <span class="hl-keyword">private</span> MovieCatalog comedyCatalog;

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setComedyCatalog(<span class="strong"><strong>@Genre(&quot;Comedy&quot;)</strong></span> MovieCatalog comedyCatalog) {
        <span class="hl-keyword">this</span>.comedyCatalog = comedyCatalog;
    }

    <span class="hl-comment">// ...</span>

}</pre> 
    <p>Next, provide the information for the candidate bean definitions. You can add <code class="literal">&lt;qualifier/&gt;</code> tags as sub-elements of the <code class="literal">&lt;bean/&gt;</code> tag and then specify the <code class="literal">type</code> and <code class="literal">value</code> to match your custom qualifier annotations. The type is matched against the fully-qualified class name of the annotation. Or, as a convenience if no risk of conflicting names exists, you can use the short class name. Both approaches are demonstrated in the following example.</p> 
    <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/context&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;context:annotation-config/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.SimpleMovieCatalog&quot;</span><span class="hl-tag">&gt;</span>
        <span class="strong"><strong>&lt;qualifier type=&quot;Genre&quot; value=&quot;Action&quot;/&gt;</strong></span>
        <span class="hl-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.SimpleMovieCatalog&quot;</span><span class="hl-tag">&gt;</span>
        <span class="strong"><strong>_&lt;qualifier type=&quot;example.Genre&quot; value=&quot;Comedy&quot;/&gt;</strong></span>
        <span class="hl-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;movieRecommender&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.MovieRecommender&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>In <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-classpath-scanning" title="4.10&nbsp;Classpath scanning and managed components">Section&nbsp;4.10, Classpath scanning and managed components</a>, you will see an annotation-based alternative to providing the qualifier metadata in XML. Specifically, see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-scanning-qualifiers" title="4.10.8&nbsp;Providing qualifier metadata with annotations">Section&nbsp;4.10.8, Providing qualifier metadata with annotations</a>.</p> 
    <p>In some cases, it may be sufficient to use an annotation without a value. This may be useful when the annotation serves a more generic purpose and can be applied across several different types of dependencies. For example, you may provide an <span class="emphasis"><em>offline</em></span> catalog that would be searched when no Internet connection is available. First define the simple annotation:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Target({ElementType.FIELD, ElementType.PARAMETER})</span></i>
<i><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></i>
<i><span class="hl-annotation" style="color: gray">@Qualifier</span></i>
<span class="hl-keyword">public</span> <i><span class="hl-annotation" style="color: gray">@interface</span></i> Offline {

}</pre> 
    <p>Then add the annotation to the field or property to be autowired:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="strong"><strong>@Offline</strong></span>
    <span class="hl-keyword">private</span> MovieCatalog offlineCatalog;

    <span class="hl-comment">// ...</span>

}</pre> 
    <p>Now the bean definition only needs a qualifier <code class="literal">type</code>:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.SimpleMovieCatalog&quot;</span><span class="hl-tag">&gt;</span>
    <span class="strong"><strong>&lt;qualifier type=&quot;Offline&quot;/&gt;</strong></span>
    <span class="hl-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>You can also define custom qualifier annotations that accept named attributes in addition to or instead of the simple <code class="literal">value</code> attribute. If multiple attribute values are then specified on a field or parameter to be autowired, a bean definition must match <span class="emphasis"><em>all</em></span> such attribute values to be considered an autowire candidate. As an example, consider the following annotation definition:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Target({ElementType.FIELD, ElementType.PARAMETER})</span></i>
<i><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></i>
<i><span class="hl-annotation" style="color: gray">@Qualifier</span></i>
<span class="hl-keyword">public</span> <i><span class="hl-annotation" style="color: gray">@interface</span></i> MovieQualifier {

    String genre();

    Format format();

}</pre> 
    <p>In this case <code class="literal">Format</code> is an enum:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> enum Format {
    VHS, DVD, BLURAY
}</pre> 
    <p>The fields to be autowired are annotated with the custom qualifier and include values for both attributes: <code class="literal">genre</code> and <code class="literal">format</code>.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <i><span class="hl-annotation" style="color: gray">@MovieQualifier(format=Format.VHS, genre=&quot;Action&quot;)</span></i>
    <span class="hl-keyword">private</span> MovieCatalog actionVhsCatalog;

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <i><span class="hl-annotation" style="color: gray">@MovieQualifier(format=Format.VHS, genre=&quot;Comedy&quot;)</span></i>
    <span class="hl-keyword">private</span> MovieCatalog comedyVhsCatalog;

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <i><span class="hl-annotation" style="color: gray">@MovieQualifier(format=Format.DVD, genre=&quot;Action&quot;)</span></i>
    <span class="hl-keyword">private</span> MovieCatalog actionDvdCatalog;

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <i><span class="hl-annotation" style="color: gray">@MovieQualifier(format=Format.BLURAY, genre=&quot;Comedy&quot;)</span></i>
    <span class="hl-keyword">private</span> MovieCatalog comedyBluRayCatalog;

    <span class="hl-comment">// ...</span>

}</pre> 
    <p>Finally, the bean definitions should contain matching qualifier values. This example also demonstrates that bean <span class="emphasis"><em>meta</em></span> attributes may be used instead of the <code class="literal">&lt;qualifier/&gt;</code> sub-elements. If available, the <code class="literal">&lt;qualifier/&gt;</code> and its attributes take precedence, but the autowiring mechanism falls back on the values provided within the <code class="literal">&lt;meta/&gt;</code> tags if no such qualifier is present, as in the last two bean definitions in the following example.</p> 
    <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/context&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;context:annotation-config/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.SimpleMovieCatalog&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;qualifier</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;MovieQualifier&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;attribute</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;format&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;VHS&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;attribute</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;genre&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Action&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/qualifier&gt;</span>
        <span class="hl-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.SimpleMovieCatalog&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;qualifier</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;MovieQualifier&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;attribute</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;format&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;VHS&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;attribute</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;genre&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Comedy&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/qualifier&gt;</span>
        <span class="hl-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.SimpleMovieCatalog&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;meta</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;format&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;DVD&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;meta</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;genre&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Action&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.SimpleMovieCatalog&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;meta</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;format&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;BLURAY&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;meta</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;genre&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Comedy&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-comment">&lt;!-- inject any dependencies required by this bean --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
   </div> 
   <div class="section" title="4.9.4&nbsp;Using generics as autowiring qualifiers">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-generics-as-qualifiers"></a>4.9.4&nbsp;Using generics as autowiring qualifiers</h3>
      </div>
     </div>
    </div> 
    <p>In addition to the <code class="literal">@Qualifier</code> annotation, it is also possible to use Java generic types as an implicit form of qualification. For example, suppose you have the following configuration:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyConfiguration {

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> StringStore stringStore() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> StringStore();
    }

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> IntegerStore integerStore() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> IntegerStore();
    }

}</pre> 
    <p>Assuming that beans above implement a generic interface, i.e. <code class="literal">Store&lt;String&gt;</code> and <code class="literal">Store&lt;Integer&gt;</code>, you can <code class="literal">@Autowire</code> the <code class="literal">Store</code> interface and the <span class="emphasis"><em>generic</em></span> will be used as a qualifier:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
<span class="hl-keyword">private</span> Store&lt;String&gt; s1; <span class="hl-comment">// &lt;String&gt; qualifier, injects the stringStore bean</span>

<i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
<span class="hl-keyword">private</span> Store&lt;Integer&gt; s2; <span class="hl-comment">// &lt;Integer&gt; qualifier, injects the integerStore bean</span></pre> 
    <p>Generic qualifiers also apply when autowiring Lists, Maps and Arrays:</p> 
    <pre class="programlisting"><span class="hl-comment">// Inject all Store beans as long as they have an &lt;Integer&gt; generic</span>
<span class="hl-comment">// Store&lt;String&gt; beans will not appear in this list</span>
<i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
<span class="hl-keyword">private</span> List&lt;Store&lt;Integer&gt;&gt; s;</pre> 
   </div> 
   <div class="section" title="4.9.5&nbsp;CustomAutowireConfigurer">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-custom-autowire-configurer"></a>4.9.5&nbsp;CustomAutowireConfigurer</h3>
      </div>
     </div>
    </div> 
    <p>The <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/beans/factory/annotation/CustomAutowireConfigurer.html" target="_top"><code class="literal">CustomAutowireConfigurer</code></a> is a <code class="literal">BeanFactoryPostProcessor</code> that enables you to register your own custom qualifier annotation types even if they are not annotated with Springs <code class="literal">@Qualifier</code> annotation.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;customAutowireConfigurer&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.beans.factory.annotation.CustomAutowireConfigurer&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;customQualifierTypes&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;set&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>example.CustomQualifier<span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/set&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>The <code class="literal">AutowireCandidateResolver</code> determines autowire candidates by:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> the <code class="literal">autowire-candidate</code> value of each bean definition </li>
      <li class="listitem"> any <code class="literal">default-autowire-candidates</code> pattern(s) available on the <code class="literal">&lt;beans/&gt;</code> element </li>
      <li class="listitem"> the presence of <code class="literal">@Qualifier</code> annotations and any custom annotations registered with the <code class="literal">CustomAutowireConfigurer</code> </li>
     </ul>
    </div> 
    <p>When multiple beans qualify as autowire candidates, the determination of a &quot;primary&quot; is the following: if exactly one bean definition among the candidates has a <code class="literal">primary</code> attribute set to <code class="literal">true</code>, it will be selected.</p> 
   </div> 
   <div class="section" title="4.9.6&nbsp;@Resource">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-resource-annotation"></a>4.9.6&nbsp;@Resource</h3>
      </div>
     </div>
    </div> 
    <p>Spring also supports injection using the JSR-250 <code class="literal">@Resource</code> annotation on fields or bean property setter methods. This is a common pattern in Java EE 5 and 6, for example in JSF 1.2 managed beans or JAX-WS 2.0 endpoints. Spring supports this pattern for Spring-managed objects as well.</p> 
    <p><code class="literal">@Resource</code> takes a name attribute, and by default Spring interprets that value as the bean name to be injected. In other words, it follows <span class="emphasis"><em>by-name</em></span> semantics, as demonstrated in this example:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <span class="strong"><strong>@Resource(name=&quot;myMovieFinder&quot;)</strong></span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

}</pre> 
    <p>If no name is specified explicitly, the default name is derived from the field name or setter method. In case of a field, it takes the field name; in case of a setter method, it takes the bean property name. So the following example is going to have the bean with name &quot;movieFinder&quot; injected into its setter method:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <span class="strong"><strong>@Resource</strong></span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

}</pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>The name provided with the annotation is resolved as a bean name by the <code class="literal">ApplicationContext</code> of which the <code class="literal">CommonAnnotationBeanPostProcessor</code> is aware. The names can be resolved through JNDI if you configure Springs <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/jndi/support/SimpleJndiBeanFactory.html" target="_top"><code class="literal">SimpleJndiBeanFactory</code></a> explicitly. However, it is recommended that you rely on the default behavior and simply use Springs JNDI lookup capabilities to preserve the level of indirection.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>In the exclusive case of <code class="literal">@Resource</code> usage with no explicit name specified, and similar to <code class="literal">@Autowired</code>, <code class="literal">@Resource</code> finds a primary type match instead of a specific named bean and resolves well-known resolvable dependencies: the <code class="literal">BeanFactory</code>, <code class="literal">ApplicationContext</code>, <code class="literal">ResourceLoader</code>, <code class="literal">ApplicationEventPublisher</code>, and <code class="literal">MessageSource</code> interfaces.</p> 
    <p>Thus in the following example, the <code class="literal">customerPreferenceDao</code> field first looks for a bean named customerPreferenceDao, then falls back to a primary type match for the type <code class="literal">CustomerPreferenceDao</code>. The &quot;context&quot; field is injected based on the known resolvable dependency type <code class="literal">ApplicationContext</code>.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <i><span class="hl-annotation" style="color: gray">@Resource</span></i>
    <span class="hl-keyword">private</span> CustomerPreferenceDao customerPreferenceDao;

    <i><span class="hl-annotation" style="color: gray">@Resource</span></i>
    <span class="hl-keyword">private</span> ApplicationContext context;

    <span class="hl-keyword">public</span> MovieRecommender() {
    }

    <span class="hl-comment">// ...</span>

}</pre> 
   </div> 
   <div class="section" title="4.9.7&nbsp;@PostConstruct and @PreDestroy">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-postconstruct-and-predestroy-annotations"></a>4.9.7&nbsp;@PostConstruct and @PreDestroy</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">CommonAnnotationBeanPostProcessor</code> not only recognizes the <code class="literal">@Resource</code> annotation but also the JSR-250 <span class="emphasis"><em>lifecycle</em></span> annotations. Introduced in Spring 2.5, the support for these annotations offers yet another alternative to those described in <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-initializingbean" title="Initialization callbacks">initialization callbacks</a> and <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-disposablebean" title="Destruction callbacks">destruction callbacks</a>. Provided that the <code class="literal">CommonAnnotationBeanPostProcessor</code> is registered within the Spring <code class="literal">ApplicationContext</code>, a method carrying one of these annotations is invoked at the same point in the lifecycle as the corresponding Spring lifecycle interface method or explicitly declared callback method. In the example below, the cache will be pre-populated upon initialization and cleared upon destruction.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CachingMovieLister {

    <i><span class="hl-annotation" style="color: gray">@PostConstruct</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> populateMovieCache() {
        <span class="hl-comment">// populates the movie cache upon initialization...</span>
    }

    <i><span class="hl-annotation" style="color: gray">@PreDestroy</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> clearMovieCache() {
        <span class="hl-comment">// clears the movie cache upon destruction...</span>
    }

}</pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>For details about the effects of combining various lifecycle mechanisms, see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-combined-effects" title="Combining lifecycle mechanisms">the section called Combining lifecycle mechanisms</a>.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
  </div> 
  <div class="section" title="4.10&nbsp;Classpath scanning and managed components">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="beans-classpath-scanning"></a>4.10&nbsp;Classpath scanning and managed components</h2>
     </div>
    </div>
   </div> 
   <p>Most examples in this chapter use XML to specify the configuration metadata that produces each <code class="literal">BeanDefinition</code> within the Spring container. The previous section (<a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-annotation-config" title="4.9&nbsp;Annotation-based container configuration">Section&nbsp;4.9, Annotation-based container configuration</a>) demonstrates how to provide a lot of the configuration metadata through source-level annotations. Even in those examples, however, the &quot;base&quot; bean definitions are explicitly defined in the XML file, while the annotations only drive the dependency injection. This section describes an option for implicitly detecting the <span class="emphasis"><em>candidate components</em></span> by scanning the classpath. Candidate components are classes that match against a filter criteria and have a corresponding bean definition registered with the container. This removes the need to use XML to perform bean registration, instead you can use annotations (for example @Component), AspectJ type expressions, or your own custom filter criteria to select which classes will have bean definitions registered with the container.</p> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>Starting with Spring 3.0, many features provided by the Spring JavaConfig project are part of the core Spring Framework. This allows you to define beans using Java rather than using the traditional XML files. Take a look at the <code class="literal">@Configuration</code>, <code class="literal">@Bean</code>, <code class="literal">@Import</code>, and <code class="literal">@DependsOn</code> annotations for examples of how to use these new features.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <div class="section" title="4.10.1&nbsp;@Component and further stereotype annotations">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-stereotype-annotations"></a>4.10.1&nbsp;@Component and further stereotype annotations</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">@Repository</code> annotation is a marker for any class that fulfills the role or <span class="emphasis"><em>stereotype</em></span> (also known as Data Access Object or DAO) of a repository. Among the uses of this marker is the automatic translation of exceptions as described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#orm-exception-translation" title="14.2.2&nbsp;Exception translation">Section&nbsp;14.2.2, Exception translation</a>.</p> 
    <p>Spring provides further stereotype annotations: <code class="literal">@Component</code>, <code class="literal">@Service</code>, and <code class="literal">@Controller</code>. <code class="literal">@Component</code> is a generic stereotype for any Spring-managed component. <code class="literal">@Repository</code>, <code class="literal">@Service</code>, and <code class="literal">@Controller</code> are specializations of <code class="literal">@Component</code> for more specific use cases, for example, in the persistence, service, and presentation layers, respectively. Therefore, you can annotate your component classes with <code class="literal">@Component</code>, but by annotating them with <code class="literal">@Repository</code>, <code class="literal">@Service</code>, or <code class="literal">@Controller</code> instead, your classes are more properly suited for processing by tools or associating with aspects. For example, these stereotype annotations make ideal targets for pointcuts. It is also possible that <code class="literal">@Repository</code>, <code class="literal">@Service</code>, and <code class="literal">@Controller</code> may carry additional semantics in future releases of the Spring Framework. Thus, if you are choosing between using <code class="literal">@Component</code> or <code class="literal">@Service</code> for your service layer, <code class="literal">@Service</code> is clearly the better choice. Similarly, as stated above, <code class="literal">@Repository</code> is already supported as a marker for automatic exception translation in your persistence layer.</p> 
   </div> 
   <div class="section" title="4.10.2&nbsp;Meta-annotations">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-meta-annotations"></a>4.10.2&nbsp;Meta-annotations</h3>
      </div>
     </div>
    </div> 
    <p>Many of the annotations provided by Spring can be used as &quot;meta-annotations&quot; in your own code. A meta-annotation is simply an annotation, that can be applied to another annotation. For example, The <code class="literal">@Service</code> annotation mentioned above is meta-annotated with with <code class="literal">@Component</code>:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Target({ElementType.TYPE})</span></i>
<i><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></i>
<i><span class="hl-annotation" style="color: gray">@Documented</span></i>
<span class="strong"><strong>@Component</strong></span> <span class="hl-comment">// Spring will see this and treat @Service in the same way as @Component</span>
<span class="hl-keyword">public</span> <i><span class="hl-annotation" style="color: gray">@interface</span></i> Service {

    <span class="hl-comment">// ....</span>

}</pre> 
    <p>Meta-annotations can also be combined together to create <span class="emphasis"><em>composed annotations</em></span>. For example, the <code class="literal">@RestController</code> annotation from Spring MVC is <span class="emphasis"><em>composed</em></span> of <code class="literal">@Controller</code> and <code class="literal">@ResponseBody</code>.</p> 
    <p>With the exception of <code class="literal">value()</code>, meta-annotated types may redeclare attributes from the source annotation to allow user customization. This can be particularly useful when you want to only expose a subset of the source annotation attributes. For example, here is a custom <code class="literal">@Scope</code> annotation that defines <code class="literal">session</code> scope, but still allows customization of the <code class="literal">proxyMode</code>.</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Target({ElementType.TYPE})</span></i>
<i><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></i>
<i><span class="hl-annotation" style="color: gray">@Documented</span></i>
<span class="strong"><strong>@Scope(&quot;session&quot;)</strong></span>
<span class="hl-keyword">public</span> <i><span class="hl-annotation" style="color: gray">@interface</span></i> SessionScope {

    ScopedProxyMode proxyMode() <span class="hl-keyword">default</span> ScopedProxyMode.DEFAULT

}</pre> 
   </div> 
   <div class="section" title="4.10.3&nbsp;Automatically detecting classes and registering bean definitions">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-scanning-autodetection"></a>4.10.3&nbsp;Automatically detecting classes and registering bean definitions</h3>
      </div>
     </div>
    </div> 
    <p>Spring can automatically detect stereotyped classes and register corresponding <code class="literal">BeanDefinition</code> s with the <code class="literal">ApplicationContext</code>. For example, the following two classes are eligible for such autodetection:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Service</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">public</span> SimpleMovieLister(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

}</pre> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Repository</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JpaMovieFinder <span class="hl-keyword">implements</span> MovieFinder {
    <span class="hl-comment">// implementation elided for clarity</span>
}</pre> 
    <p>To autodetect these classes and register the corresponding beans, you need to include the following element in XML, where the base-package element is a common parent package for the two classes. (Alternatively, you can specify a comma-separated list that includes the parent package of each class.)</p> 
    <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/context&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">&quot;org.example&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Tip">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
        <th align="left">Tip</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>The use of <code class="literal">&lt;context:component-scan&gt;</code> implicitly enables the functionality of <code class="literal">&lt;context:annotation-config&gt;</code>. There is usually no need to include the <code class="literal">&lt;context:annotation-config&gt;</code> element when using <code class="literal">&lt;context:component-scan&gt;</code>.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>The scanning of classpath packages requires the presence of corresponding directory entries in the classpath. When you build JARs with Ant, make sure that you do <span class="emphasis"><em>not</em></span> activate the files-only switch of the JAR task.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>Furthermore, the <code class="literal">AutowiredAnnotationBeanPostProcessor</code> and <code class="literal">CommonAnnotationBeanPostProcessor</code> are both included implicitly when you use the component-scan element. That means that the two components are autodetected <span class="emphasis"><em>and</em></span> wired together - all without any bean configuration metadata provided in XML.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>You can disable the registration of <code class="literal">AutowiredAnnotationBeanPostProcessor</code> and <code class="literal">CommonAnnotationBeanPostProcessor</code> by including the <span class="emphasis"><em>annotation-config</em></span> attribute with a value of false.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="4.10.4&nbsp;Using filters to customize scanning">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-scanning-filters"></a>4.10.4&nbsp;Using filters to customize scanning</h3>
      </div>
     </div>
    </div> 
    <p>By default, classes annotated with <code class="literal">@Component</code>, <code class="literal">@Repository</code>, <code class="literal">@Service</code>, <code class="literal">@Controller</code>, or a custom annotation that itself is annotated with <code class="literal">@Component</code> are the only detected candidate components. However, you can modify and extend this behavior simply by applying custom filters. Add them as <span class="emphasis"><em>include-filter</em></span> or <span class="emphasis"><em>exclude-filter</em></span> sub-elements of the <code class="literal">component-scan</code> element. Each filter element requires the <code class="literal">type</code> and <code class="literal">expression</code> attributes. The following table describes the filtering options.</p> 
    <div class="table">
     <a name="beans-scanning-filters-tbl"></a>
     <p class="title"><b>Table&nbsp;4.5.&nbsp;Filter Types</b></p>
     <div class="table-contents"> 
      <table summary="Filter Types" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
       <colgroup>
        <col />
        <col />
        <col />
       </colgroup>
       <thead>
        <tr>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Filter Type</th>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Example Expression</th>
         <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Description</th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>annotation</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">org.example.SomeAnnotation</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>An annotation to be present at the type level in target components.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>assignable</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">org.example.SomeClass</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>A class (or interface) that the target components are assignable to (extend/implement).</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>aspectj</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">org.example..*Service+</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>An AspectJ type expression to be matched by the target components.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>regex</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">org\.example\.Default.*</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>A regex expression to be matched by the target components class names.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>custom</p></td>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">org.example.MyTypeFilter</code></p></td>
         <td style="" align="left" valign="top"><p>A custom implementation of the <code class="literal">org.springframework.core.type .TypeFilter</code> interface.</p></td>
        </tr>
       </tbody>
      </table> 
     </div>
    </div>
    <br class="table-break" /> 
    <p>The following example shows the XML configuration ignoring all <code class="literal">@Repository</code> annotations and using &quot;stub&quot; repositories instead.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">&quot;org.example&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;context:include-filter</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;regex&quot;</span>
                <span class="hl-attribute">expression</span>=<span class="hl-value">&quot;.*Stub.*Repository&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;context:exclude-filter</span> <span class="hl-attribute">type</span>=<span class="hl-value">&quot;annotation&quot;</span>
                <span class="hl-attribute">expression</span>=<span class="hl-value">&quot;org.springframework.stereotype.Repository&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/context:component-scan&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>You can also disable the default filters by providing <span class="emphasis"><em>use-default-filters=&quot;false&quot;</em></span> as an attribute of the &lt;component-scan/&gt; element. This will in effect disable automatic detection of classes annotated with <code class="literal">@Component</code>, <code class="literal">@Repository</code>, <code class="literal">@Service</code>, or <code class="literal">@Controller</code>.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="4.10.5&nbsp;Defining bean metadata within components">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-factorybeans-annotations"></a>4.10.5&nbsp;Defining bean metadata within components</h3>
      </div>
     </div>
    </div> 
    <p>Spring components can also contribute bean definition metadata to the container. You do this with the same <code class="literal">@Bean</code> annotation used to define bean metadata within <code class="literal">@Configuration</code> annotated classes. Here is a simple example:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Component</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FactoryMethodComponent {

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <i><span class="hl-annotation" style="color: gray">@Qualifier(&quot;public&quot;)</span></i>
    <span class="hl-keyword">public</span> TestBean publicInstance() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TestBean(<span class="hl-string">&quot;publicInstance&quot;</span>);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doWork() {
        <span class="hl-comment">// Component method implementation omitted</span>
    }

}</pre> 
    <p>This class is a Spring component that has application-specific code contained in its <code class="literal">doWork()</code> method. However, it also contributes a bean definition that has a factory method referring to the method <code class="literal">publicInstance()</code>. The <code class="literal">@Bean</code> annotation identifies the factory method and other bean definition properties, such as a qualifier value through the <code class="literal">@Qualifier</code> annotation. Other method level annotations that can be specified are <code class="literal">@Scope</code>, <code class="literal">@Lazy</code>, and custom qualifier annotations.</p> 
    <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Tip">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
        <th align="left">Tip</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>In addition to its role for component initialization, the <code class="literal">@Lazy</code> annotation may also be placed on injection points marked with <code class="literal">@Autowired</code> or <code class="literal">@Inject</code>. In this context, it leads to the injection of a lazy-resolution proxy.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>Autowired fields and methods are supported as previously discussed, with additional support for autowiring of <code class="literal">@Bean</code> methods:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Component</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FactoryMethodComponent {

    <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> <span class="hl-keyword">int</span> i;

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <i><span class="hl-annotation" style="color: gray">@Qualifier(&quot;public&quot;)</span></i>
    <span class="hl-keyword">public</span> TestBean publicInstance() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TestBean(<span class="hl-string">&quot;publicInstance&quot;</span>);
    }

    <span class="hl-comment">// use of a custom qualifier and autowiring of method parameters</span>

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">protected</span> TestBean protectedInstance(
            <i><span class="hl-annotation" style="color: gray">@Qualifier(&quot;public&quot;)</span></i> TestBean spouse,
            <i><span class="hl-annotation" style="color: gray">@Value(&quot;#{privateInstance.age}&quot;)</span></i> String country) {
        TestBean tb = <span class="hl-keyword">new</span> TestBean(<span class="hl-string">&quot;protectedInstance&quot;</span>, <span class="hl-number">1</span>);
        tb.setSpouse(tb);
        tb.setCountry(country);
        <span class="hl-keyword">return</span> tb;
    }

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <i><span class="hl-annotation" style="color: gray">@Scope(BeanDefinition.SCOPE_SINGLETON)</span></i>
    <span class="hl-keyword">private</span> TestBean privateInstance() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TestBean(<span class="hl-string">&quot;privateInstance&quot;</span>, i++);
    }

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <i><span class="hl-annotation" style="color: gray">@Scope(value = WebApplicationContext.SCOPE_SESSION, proxyMode = ScopedProxyMode.TARGET_CLASS)</span></i>
    <span class="hl-keyword">public</span> TestBean requestScopedInstance() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TestBean(<span class="hl-string">&quot;requestScopedInstance&quot;</span>, <span class="hl-number">3</span>);
    }

}</pre> 
    <p>The example autowires the <code class="literal">String</code> method parameter <code class="literal">country</code> to the value of the <code class="literal">Age</code> property on another bean named <code class="literal">privateInstance</code>. A Spring Expression Language element defines the value of the property through the notation <code class="literal">#{ &lt;expression&gt; }</code>. For <code class="literal">@Value</code> annotations, an expression resolver is preconfigured to look for bean names when resolving expression text.</p> 
    <p>The <code class="literal">@Bean</code> methods in a Spring component are processed differently than their counterparts inside a Spring <code class="literal">@Configuration</code> class. The difference is that <code class="literal">@Component</code> classes are not enhanced with CGLIB to intercept the invocation of methods and fields. CGLIB proxying is the means by which invoking methods or fields within <code class="literal">@Configuration</code> classes <code class="literal">@Bean</code> methods create bean metadata references to collaborating objects. Methods are <span class="emphasis"><em>not</em></span> invoked with normal Java semantics. In contrast, calling a method or field within a <code class="literal">@Component</code> classes <code class="literal">@Bean</code> method <span class="emphasis"><em>has</em></span> standard Java semantics.</p> 
   </div> 
   <div class="section" title="4.10.6&nbsp;Naming autodetected components">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-scanning-name-generator"></a>4.10.6&nbsp;Naming autodetected components</h3>
      </div>
     </div>
    </div> 
    <p>When a component is autodetected as part of the scanning process, its bean name is generated by the <code class="literal">BeanNameGenerator</code> strategy known to that scanner. By default, any Spring stereotype annotation ( <code class="literal">@Component</code>, <code class="literal">@Repository</code>, <code class="literal">@Service</code>, and <code class="literal">@Controller</code>) that contains a <code class="literal">name</code> value will thereby provide that name to the corresponding bean definition.</p> 
    <p>If such an annotation contains no <code class="literal">name</code> value or for any other detected component (such as those discovered by custom filters), the default bean name generator returns the uncapitalized non-qualified class name. For example, if the following two components were detected, the names would be myMovieLister and movieFinderImpl:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Service(&quot;myMovieLister&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {
    <span class="hl-comment">// ...</span>
}</pre> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Repository</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieFinderImpl <span class="hl-keyword">implements</span> MovieFinder {
    <span class="hl-comment">// ...</span>
}</pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>If you do not want to rely on the default bean-naming strategy, you can provide a custom bean-naming strategy. First, implement the <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/beans/factory/support/BeanNameGenerator.html" target="_top"><code class="literal">BeanNameGenerator</code></a> interface, and be sure to include a default no-arg constructor. Then, provide the fully-qualified class name when configuring the scanner:</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">&quot;org.example&quot;</span>
        <span class="hl-attribute">name-generator</span>=<span class="hl-value">&quot;org.example.MyNameGenerator&quot;</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>As a general rule, consider specifying the name with the annotation whenever other components may be making explicit references to it. On the other hand, the auto-generated names are adequate whenever the container is responsible for wiring.</p> 
   </div> 
   <div class="section" title="4.10.7&nbsp;Providing a scope for autodetected components">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-scanning-scope-resolver"></a>4.10.7&nbsp;Providing a scope for autodetected components</h3>
      </div>
     </div>
    </div> 
    <p>As with Spring-managed components in general, the default and most common scope for autodetected components is singleton. However, sometimes you need other scopes, which Spring 2.5 provides with a new <code class="literal">@Scope</code> annotation. Simply provide the name of the scope within the annotation:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Scope(&quot;prototype&quot;)</span></i>
<i><span class="hl-annotation" style="color: gray">@Repository</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieFinderImpl <span class="hl-keyword">implements</span> MovieFinder {
    <span class="hl-comment">// ...</span>
}</pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>To provide a custom strategy for scope resolution rather than relying on the annotation-based approach, implement the <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/context/annotation/ScopeMetadataResolver.html" target="_top"><code class="literal">ScopeMetadataResolver</code></a> interface, and be sure to include a default no-arg constructor. Then, provide the fully-qualified class name when configuring the scanner:</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">&quot;org.example&quot;</span>
            <span class="hl-attribute">scope-resolver</span>=<span class="hl-value">&quot;org.example.MyScopeResolver&quot;</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>When using certain non-singleton scopes, it may be necessary to generate proxies for the scoped objects. The reasoning is described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes-other-injection" title="Scoped beans as dependencies">the section called Scoped beans as dependencies</a>. For this purpose, a <span class="emphasis"><em>scoped-proxy</em></span> attribute is available on the component-scan element. The three possible values are: no, interfaces, and targetClass. For example, the following configuration will result in standard JDK dynamic proxies:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">&quot;org.example&quot;</span>
        <span class="hl-attribute">scoped-proxy</span>=<span class="hl-value">&quot;interfaces&quot;</span><span class="hl-tag"> /&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
   </div> 
   <div class="section" title="4.10.8&nbsp;Providing qualifier metadata with annotations">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-scanning-qualifiers"></a>4.10.8&nbsp;Providing qualifier metadata with annotations</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">@Qualifier</code> annotation is discussed in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-autowired-annotation-qualifiers" title="4.9.3&nbsp;Fine-tuning annotation-based autowiring with qualifiers">Section&nbsp;4.9.3, Fine-tuning annotation-based autowiring with qualifiers</a>. The examples in that section demonstrate the use of the <code class="literal">@Qualifier</code> annotation and custom qualifier annotations to provide fine-grained control when you resolve autowire candidates. Because those examples were based on XML bean definitions, the qualifier metadata was provided on the candidate bean definitions using the <code class="literal">qualifier</code> or <code class="literal">meta</code> sub-elements of the <code class="literal">bean</code> element in the XML. When relying upon classpath scanning for autodetection of components, you provide the qualifier metadata with type-level annotations on the candidate class. The following three examples demonstrate this technique:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Component</span></i>
<span class="strong"><strong>@Qualifier(&quot;Action&quot;)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ActionMovieCatalog <span class="hl-keyword">implements</span> MovieCatalog {
    <span class="hl-comment">// ...</span>
}</pre> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Component</span></i>
<span class="strong"><strong>@Genre(&quot;Action&quot;)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ActionMovieCatalog <span class="hl-keyword">implements</span> MovieCatalog {
    <span class="hl-comment">// ...</span>
}</pre> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Component</span></i>
<span class="strong"><strong>@Offline</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CachingMovieCatalog <span class="hl-keyword">implements</span> MovieCatalog {
    <span class="hl-comment">// ...</span>
}</pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>As with most annotation-based alternatives, keep in mind that the annotation metadata is bound to the class definition itself, while the use of XML allows for multiple beans <span class="emphasis"><em>of the same type</em></span> to provide variations in their qualifier metadata, because that metadata is provided per-instance rather than per-class.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
  </div> 
  <div class="section" title="4.11&nbsp;Using JSR 330 Standard Annotations">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="beans-standard-annotations"></a>4.11&nbsp;Using JSR 330 Standard Annotations</h2>
     </div>
    </div>
   </div> 
   <p>Starting with Spring 3.0, Spring offers support for JSR-330 standard annotations (Dependency Injection). Those annotations are scanned in the same way as the Spring annotations. You just need to have the relevant jars in your classpath.</p> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>If you are using Maven, the <code class="literal">javax.inject</code> artifact is available in the standard Maven repository ( <a class="ulink" href="http://repo1.maven.org/maven2/javax/inject/javax.inject/1/" target="_top">http://repo1.maven.org/maven2/javax/inject/javax.inject/1/</a>). You can add the following dependency to your file pom.xml:</p> <pre class="programlisting"><span class="hl-tag">&lt;dependency&gt;</span>
    <span class="hl-tag">&lt;groupId&gt;</span>javax.inject<span class="hl-tag">&lt;/groupId&gt;</span>
    <span class="hl-tag">&lt;artifactId&gt;</span>javax.inject<span class="hl-tag">&lt;/artifactId&gt;</span>
    <span class="hl-tag">&lt;version&gt;</span>1<span class="hl-tag">&lt;/version&gt;</span>
<span class="hl-tag">&lt;/dependency&gt;</span></pre> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <div class="section" title="4.11.1&nbsp;Dependency Injection with @Inject and @Named">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-inject-named"></a>4.11.1&nbsp;Dependency Injection with @Inject and @Named</h3>
      </div>
     </div>
    </div> 
    <p>Instead of <code class="literal">@Autowired</code>, <code class="literal">@javax.inject.Inject</code> may be used as follows:</p> 
    <pre class="programlisting"><span class="hl-keyword">import</span> javax.inject.Inject;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <i><span class="hl-annotation" style="color: gray">@Inject</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

    <span class="hl-comment">// ...</span>

}</pre> 
    <p>As with <code class="literal">@Autowired</code>, it is possible to use <code class="literal">@Inject</code> at the class-level, field-level, method-level and constructor-argument level. If you would like to use a qualified name for the dependency that should be injected, you should use the <code class="literal">@Named</code> annotation as follows:</p> 
    <pre class="programlisting"><span class="hl-keyword">import</span> javax.inject.Inject;
<span class="hl-keyword">import</span> javax.inject.Named;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <i><span class="hl-annotation" style="color: gray">@Inject</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(<i><span class="hl-annotation" style="color: gray">@Named(&quot;main&quot;)</span></i> MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

    <span class="hl-comment">// ...</span>

}</pre> 
   </div> 
   <div class="section" title="4.11.2&nbsp;@Named: a standard equivalent to the @Component annotation">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-named"></a>4.11.2&nbsp;@Named: a standard equivalent to the @Component annotation</h3>
      </div>
     </div>
    </div> 
    <p>Instead of <code class="literal">@Component</code>, <code class="literal">@javax.inject.Named</code> may be used as follows:</p> 
    <pre class="programlisting"><span class="hl-keyword">import</span> javax.inject.Inject;
<span class="hl-keyword">import</span> javax.inject.Named;

<i><span class="hl-annotation" style="color: gray">@Named(&quot;movieListener&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <i><span class="hl-annotation" style="color: gray">@Inject</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

    <span class="hl-comment">// ...</span>

}</pre> 
    <p>It is very common to use <code class="literal">@Component</code> without specifying a name for the component. <code class="literal">@Named</code> can be used in a similar fashion:</p> 
    <pre class="programlisting"><span class="hl-keyword">import</span> javax.inject.Inject;
<span class="hl-keyword">import</span> javax.inject.Named;

<i><span class="hl-annotation" style="color: gray">@Named</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;

    <i><span class="hl-annotation" style="color: gray">@Inject</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMovieFinder(MovieFinder movieFinder) {
        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
    }

    <span class="hl-comment">// ...</span>

}</pre> 
    <p>When using <code class="literal">@Named</code>, it is possible to use component-scanning in the exact same way as when using Spring annotations:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">&quot;org.example&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
   </div> 
   <div class="section" title="4.11.3&nbsp;Limitations of the standard approach">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-standard-annotations-limitations"></a>4.11.3&nbsp;Limitations of the standard approach</h3>
      </div>
     </div>
    </div> 
    <p>When working with standard annotations, it is important to know that some significant features are not available as shown in the table below:</p> 
    <div class="table">
     <a name="annotations-comparison"></a>
     <p class="title"><b>Table&nbsp;4.6.&nbsp;Spring annotations vs. standard annotations</b></p>
     <div class="table-contents"> 
      <table summary="Spring annotations vs. standard annotations" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
       <colgroup>
        <col />
        <col />
        <col />
       </colgroup>
       <thead>
        <tr>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Spring</th>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">javax.inject.*</th>
         <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">javax.inject restrictions / comments</th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Autowired</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Inject</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Inject has no <span class="emphasis"><em>required</em></span> attribute</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Component</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Named</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>-</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Scope(&quot;singleton&quot;)</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Singleton</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>The JSR-330 default scope is like Springs <code class="literal">prototype</code>. However, in order to keep it consistent with Springs general defaults, a JSR-330 bean declared in the Spring container is a <code class="literal">singleton</code> by default. In order to use a scope other than <code class="literal">singleton</code>, you should use Springs <code class="literal">@Scope</code> annotation. </p><p><code class="literal">javax.inject</code> also provides a <a class="ulink" href="http://download.oracle.com/javaee/6/api/javax/inject/Scope.html" target="_top">@Scope</a> annotation. Nevertheless, this one is only intended to be used for creating your own annotations.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Qualifier</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Named</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>-</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Value</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>-</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>no equivalent</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>@Required</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>-</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>no equivalent</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>@Lazy</p></td>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>-</p></td>
         <td style="" align="left" valign="top"><p>no equivalent</p></td>
        </tr>
       </tbody>
      </table> 
     </div>
    </div>
    <br class="table-break" /> 
   </div> 
  </div> 
  <div class="section" title="4.12&nbsp;Java-based container configuration">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="beans-java"></a>4.12&nbsp;Java-based container configuration</h2>
     </div>
    </div>
   </div> 
   <div class="section" title="4.12.1&nbsp;Basic concepts: @Bean and @Configuration">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-java-basic-concepts"></a>4.12.1&nbsp;Basic concepts: @Bean and @Configuration</h3>
      </div>
     </div>
    </div> 
    <p>The central artifacts in Springs new Java-configuration support are <code class="literal">@Configuration</code>-annotated classes and <code class="literal">@Bean</code>-annotated methods.</p> 
    <p>The <code class="literal">@Bean</code> annotation is used to indicate that a method instantiates, configures and initializes a new object to be managed by the Spring IoC container. For those familiar with Springs <code class="literal">&lt;beans/&gt;</code> XML configuration the <code class="literal">@Bean</code> annotation plays the same role as the <code class="literal">&lt;bean/&gt;</code> element. You can use <code class="literal">@Bean</code> annotated methods with any Spring <code class="literal">@Component</code>, however, they are most often used with <code class="literal">@Configuration</code> beans.</p> 
    <p>Annotating a class with <code class="literal">@Configuration</code> indicates that its primary purpose is as a source of bean definitions. Furthermore, <code class="literal">@Configuration</code> classes allow inter-bean dependencies to be defined by simply calling other <code class="literal">@Bean</code> methods in the same class. The simplest possible <code class="literal">@Configuration</code> class would read as follows:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> MyService myService() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> MyServiceImpl();
    }

}</pre> 
    <p>The <code class="literal">AppConfig</code> class above would be equivalent to the following Spring <code class="literal">&lt;beans/&gt;</code> XML:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.acme.services.MyServiceImpl&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>The <code class="literal">@Bean</code> and <code class="literal">@Configuration</code> annotations will be discussed in depth in the sections below. First, however, well cover the various ways of creating a spring container using Java-based configuration.</p> 
    <div class="sidebar" title="Full @Configuration vs lite @Beans mode?">
     <p class="title"><b>Full @Configuration vs <span class="emphasis"><em>lite</em></span> @Beans mode?</b></p> 
     <p>When <code class="literal">@Bean</code> methods are declared within classes that are <span class="emphasis"><em>not</em></span> annotated with <code class="literal">@Configuration</code> they are referred to as being processed in a <span class="emphasis"><em>lite</em></span> mode. For example, bean methods declared in a <code class="literal">@Component</code> or even in a <span class="emphasis"><em>plain old class</em></span> will be considered <span class="emphasis"><em>lite</em></span>.</p> 
     <p>Unlike full <code class="literal">@Configuration</code>, lite <code class="literal">@Bean</code> methods cannot easily declare inter-bean dependencies. Usually one <code class="literal">@Bean</code> method should not invoke another <code class="literal">@Bean</code> method when operating in <span class="emphasis"><em>lite</em></span> mode.</p> 
     <p>Only using <code class="literal">@Bean</code> methods within <code class="literal">@Configuration</code> classes is a recommended approach of ensuring that <span class="emphasis"><em>full</em></span> mode is always used. This will prevent the same <code class="literal">@Bean</code> method from accidentally being invoked multiple times and helps to reduce subtle bugs that can be hard to track down when operating in <span class="emphasis"><em>lite</em></span> mode.</p> 
    </div> 
   </div> 
   <div class="section" title="4.12.2&nbsp;Instantiating the Spring container using AnnotationConfigApplicationContext">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-java-instantiating-container"></a>4.12.2&nbsp;Instantiating the Spring container using AnnotationConfigApplicationContext</h3>
      </div>
     </div>
    </div> 
    <p>The sections below document Springs <code class="literal">AnnotationConfigApplicationContext</code>, new in Spring 3.0. This versatile <code class="literal">ApplicationContext</code> implementation is capable of accepting not only <code class="literal">@Configuration</code> classes as input, but also plain <code class="literal">@Component</code> classes and classes annotated with JSR-330 metadata.</p> 
    <p>When <code class="literal">@Configuration</code> classes are provided as input, the <code class="literal">@Configuration</code> class itself is registered as a bean definition, and all declared <code class="literal">@Bean</code> methods within the class are also registered as bean definitions.</p> 
    <p>When <code class="literal">@Component</code> and JSR-330 classes are provided, they are registered as bean definitions, and it is assumed that DI metadata such as <code class="literal">@Autowired</code> or <code class="literal">@Inject</code> are used within those classes where necessary.</p> 
    <div class="section" title="Simple construction">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-java-instantiating-container-contstructor"></a>Simple construction</h4>
       </div>
      </div>
     </div> 
     <p>In much the same way that Spring XML files are used as input when instantiating a <code class="literal">ClassPathXmlApplicationContext</code>, <code class="literal">@Configuration</code> classes may be used as input when instantiating an <code class="literal">AnnotationConfigApplicationContext</code>. This allows for completely XML-free usage of the Spring container:</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    ApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext(AppConfig.<span class="hl-keyword">class</span>);
    MyService myService = ctx.getBean(MyService.<span class="hl-keyword">class</span>);
    myService.doStuff();
}</pre> 
     <p>As mentioned above, <code class="literal">AnnotationConfigApplicationContext</code> is not limited to working only with <code class="literal">@Configuration</code> classes. Any <code class="literal">@Component</code> or JSR-330 annotated class may be supplied as input to the constructor. For example:</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    ApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext(MyServiceImpl.<span class="hl-keyword">class</span>, Dependency1.<span class="hl-keyword">class</span>, Dependency2.<span class="hl-keyword">class</span>);
    MyService myService = ctx.getBean(MyService.<span class="hl-keyword">class</span>);
    myService.doStuff();
}</pre> 
     <p>The above assumes that <code class="literal">MyServiceImpl</code>, <code class="literal">Dependency1</code> and <code class="literal">Dependency2</code> use Spring dependency injection annotations such as <code class="literal">@Autowired</code>.</p> 
    </div> 
    <div class="section" title="Building the container programmatically using register(Class&lt;?&gt;)">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-java-instantiating-container-register"></a>Building the container programmatically using register(Class&lt;?&gt;)</h4>
       </div>
      </div>
     </div> 
     <p>An <code class="literal">AnnotationConfigApplicationContext</code> may be instantiated using a no-arg constructor and then configured using the <code class="literal">register()</code> method. This approach is particularly useful when programmatically building an <code class="literal">AnnotationConfigApplicationContext</code>.</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    AnnotationConfigApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext();
    ctx.register(AppConfig.<span class="hl-keyword">class</span>, OtherConfig.<span class="hl-keyword">class</span>);
    ctx.register(AdditionalConfig.<span class="hl-keyword">class</span>);
    ctx.refresh();
    MyService myService = ctx.getBean(MyService.<span class="hl-keyword">class</span>);
    myService.doStuff();
}</pre> 
    </div> 
    <div class="section" title="Enabling component scanning with scan(String)">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-java-instantiating-container-scan"></a>Enabling component scanning with scan(String)</h4>
       </div>
      </div>
     </div> 
     <p>Experienced Spring users will be familiar with the following commonly-used XML declaration from Springs <code class="literal">context:</code> namespace</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">&quot;com.acme&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
     <p>In the example above, the <code class="literal">com.acme</code> package will be scanned, looking for any <code class="literal">@Component</code>-annotated classes, and those classes will be registered as Spring bean definitions within the container. <code class="literal">AnnotationConfigApplicationContext</code> exposes the <code class="literal">scan(String...)</code> method to allow for the same component-scanning functionality:</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    AnnotationConfigApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext();
    ctx.scan(<span class="hl-string">&quot;com.acme&quot;</span>);
    ctx.refresh();
    MyService myService = ctx.getBean(MyService.<span class="hl-keyword">class</span>);
}</pre> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>Remember that <code class="literal">@Configuration</code> classes are <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-meta-annotations" title="4.10.2&nbsp;Meta-annotations">meta-annotated</a> with <code class="literal">@Component</code>, so they are candidates for component-scanning! In the example above, assuming that <code class="literal">AppConfig</code> is declared within the <code class="literal">com.acme</code> package (or any package underneath), it will be picked up during the call to <code class="literal">scan()</code>, and upon <code class="literal">refresh()</code> all its <code class="literal">@Bean</code> methods will be processed and registered as bean definitions within the container.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="Support for web applications with AnnotationConfigWebApplicationContext">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-java-instantiating-container-web"></a>Support for web applications with AnnotationConfigWebApplicationContext</h4>
       </div>
      </div>
     </div> 
     <p>A <code class="literal">WebApplicationContext</code> variant of <code class="literal">AnnotationConfigApplicationContext</code> is available with <code class="literal">AnnotationConfigWebApplicationContext</code>. This implementation may be used when configuring the Spring <code class="literal">ContextLoaderListener</code> servlet listener, Spring MVC <code class="literal">DispatcherServlet</code>, etc. What follows is a <code class="literal">web.xml</code> snippet that configures a typical Spring MVC web application. Note the use of the <code class="literal">contextClass</code> context-param and init-param:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;web-app&gt;</span>
    <span class="hl-comment">&lt;!-- Configure ContextLoaderListener to use AnnotationConfigWebApplicationContext
        instead of the default XmlWebApplicationContext --&gt;</span>
    <span class="hl-tag">&lt;context-param&gt;</span>
        <span class="hl-tag">&lt;param-name&gt;</span>contextClass<span class="hl-tag">&lt;/param-name&gt;</span>
        <span class="hl-tag">&lt;param-value&gt;</span>
            org.springframework.web.context.support.AnnotationConfigWebApplicationContext
        <span class="hl-tag">&lt;/param-value&gt;</span>
    <span class="hl-tag">&lt;/context-param&gt;</span>

    <span class="hl-comment">&lt;!-- Configuration locations must consist of one or more comma- or space-delimited
        fully-qualified @Configuration classes. Fully-qualified packages may also be
        specified for component-scanning --&gt;</span>
    <span class="hl-tag">&lt;context-param&gt;</span>
        <span class="hl-tag">&lt;param-name&gt;</span>contextConfigLocation<span class="hl-tag">&lt;/param-name&gt;</span>
        <span class="hl-tag">&lt;param-value&gt;</span>com.acme.AppConfig<span class="hl-tag">&lt;/param-value&gt;</span>
    <span class="hl-tag">&lt;/context-param&gt;</span>

    <span class="hl-comment">&lt;!-- Bootstrap the root application context as usual using ContextLoaderListener --&gt;</span>
    <span class="hl-tag">&lt;listener&gt;</span>
        <span class="hl-tag">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="hl-tag">&lt;/listener-class&gt;</span>
    <span class="hl-tag">&lt;/listener&gt;</span>

    <span class="hl-comment">&lt;!-- Declare a Spring MVC DispatcherServlet as usual --&gt;</span>
    <span class="hl-tag">&lt;servlet&gt;</span>
        <span class="hl-tag">&lt;servlet-name&gt;</span>dispatcher<span class="hl-tag">&lt;/servlet-name&gt;</span>
        <span class="hl-tag">&lt;servlet-class&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="hl-tag">&lt;/servlet-class&gt;</span>
        <span class="hl-comment">&lt;!-- Configure DispatcherServlet to use AnnotationConfigWebApplicationContext
            instead of the default XmlWebApplicationContext --&gt;</span>
        <span class="hl-tag">&lt;init-param&gt;</span>
            <span class="hl-tag">&lt;param-name&gt;</span>contextClass<span class="hl-tag">&lt;/param-name&gt;</span>
            <span class="hl-tag">&lt;param-value&gt;</span>
                org.springframework.web.context.support.AnnotationConfigWebApplicationContext
            <span class="hl-tag">&lt;/param-value&gt;</span>
        <span class="hl-tag">&lt;/init-param&gt;</span>
        <span class="hl-comment">&lt;!-- Again, config locations must consist of one or more comma- or space-delimited
            and fully-qualified @Configuration classes --&gt;</span>
        <span class="hl-tag">&lt;init-param&gt;</span>
            <span class="hl-tag">&lt;param-name&gt;</span>contextConfigLocation<span class="hl-tag">&lt;/param-name&gt;</span>
            <span class="hl-tag">&lt;param-value&gt;</span>com.acme.web.MvcConfig<span class="hl-tag">&lt;/param-value&gt;</span>
        <span class="hl-tag">&lt;/init-param&gt;</span>
    <span class="hl-tag">&lt;/servlet&gt;</span>

    <span class="hl-comment">&lt;!-- map all requests for /app/* to the dispatcher servlet --&gt;</span>
    <span class="hl-tag">&lt;servlet-mapping&gt;</span>
        <span class="hl-tag">&lt;servlet-name&gt;</span>dispatcher<span class="hl-tag">&lt;/servlet-name&gt;</span>
        <span class="hl-tag">&lt;url-pattern&gt;</span>/app/*<span class="hl-tag">&lt;/url-pattern&gt;</span>
    <span class="hl-tag">&lt;/servlet-mapping&gt;</span>
<span class="hl-tag">&lt;/web-app&gt;</span></pre> 
    </div> 
   </div> 
   <div class="section" title="4.12.3&nbsp;Using the @Bean annotation">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-java-bean-annotation"></a>4.12.3&nbsp;Using the @Bean annotation</h3>
      </div>
     </div>
    </div> 
    <p><code class="literal">@Bean</code> is a method-level annotation and a direct analog of the XML <code class="literal">&lt;bean/&gt;</code> element. The annotation supports some of the attributes offered by <code class="literal">&lt;bean/&gt;</code>, such as: <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-initializingbean" title="Initialization callbacks">init-method</a>, <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-lifecycle-disposablebean" title="Destruction callbacks">destroy-method</a>, <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-autowire" title="4.4.5&nbsp;Autowiring collaborators">autowiring</a> and <code class="literal">name</code>.</p> 
    <p>You can use the <code class="literal">@Bean</code> annotation in a <code class="literal">@Configuration</code>-annotated or in a <code class="literal">@Component</code>-annotated class.</p> 
    <div class="section" title="Declaring a bean">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-java-declaring-a-bean"></a>Declaring a bean</h4>
       </div>
      </div>
     </div> 
     <p>To declare a bean, simply annotate a method with the <code class="literal">@Bean</code> annotation. You use this method to register a bean definition within an <code class="literal">ApplicationContext</code> of the type specified as the methods return value. By default, the bean name will be the same as the method name. The following is a simple example of a <code class="literal">@Bean</code> method declaration:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> TransferService transferService() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TransferServiceImpl();
    }

}</pre> 
     <p>The preceding configuration is exactly equivalent to the following Spring XML:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;transferService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.acme.TransferServiceImpl&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
     <p>Both declarations make a bean named <code class="literal">transferService</code> available in the <code class="literal">ApplicationContext</code>, bound to an object instance of type <code class="literal">TransferServiceImpl</code>:</p> 
     <pre class="literallayout">transferService -&gt; com.acme.TransferServiceImpl</pre> 
    </div> 
    <div class="section" title="Receiving lifecycle callbacks">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-java-lifecycle-callbacks"></a>Receiving lifecycle callbacks</h4>
       </div>
      </div>
     </div> 
     <p>Any classes defined with the <code class="literal">@Bean</code> annotation support the regular lifecycle callbacks and can use the <code class="literal">@PostConstruct</code> and <code class="literal">@PreDestroy</code> annotations from JSR-250, see <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-postconstruct-and-predestroy-annotations" title="4.9.7&nbsp;@PostConstruct and @PreDestroy">JSR-250 annotations</a> for further details.</p> 
     <p>The regular Spring <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-nature" title="4.6&nbsp;Customizing the nature of a bean">lifecycle</a> callbacks are fully supported as well. If a bean implements <code class="literal">InitializingBean</code>, <code class="literal">DisposableBean</code>, or <code class="literal">Lifecycle</code>, their respective methods are called by the container.</p> 
     <p>The standard set of <code class="literal">*Aware</code> interfaces such as <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-beanfactory" title="4.17&nbsp;The BeanFactory">BeanFactoryAware</a>, <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-aware" title="4.6.2&nbsp;ApplicationContextAware and BeanNameAware">BeanNameAware</a>, <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#context-functionality-messagesource" title="4.16.1&nbsp;Internationalization using MessageSource">MessageSourceAware</a>, <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-aware" title="4.6.2&nbsp;ApplicationContextAware and BeanNameAware">ApplicationContextAware</a>, and so on are also fully supported.</p> 
     <p>The <code class="literal">@Bean</code> annotation supports specifying arbitrary initialization and destruction callback methods, much like Spring XMLs <code class="literal">init-method</code> and <code class="literal">destroy-method</code> attributes on the <code class="literal">bean</code> element:</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Foo {
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> init() {
        <span class="hl-comment">// initialization logic</span>
    }
}

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Bar {
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> cleanup() {
        <span class="hl-comment">// destruction logic</span>
    }
}

<i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <i><span class="hl-annotation" style="color: gray">@Bean(initMethod = &quot;init&quot;)</span></i>
    <span class="hl-keyword">public</span> Foo foo() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Foo();
    }

    <i><span class="hl-annotation" style="color: gray">@Bean(destroyMethod = &quot;cleanup&quot;)</span></i>
    <span class="hl-keyword">public</span> Bar bar() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Bar();
    }

}</pre> 
     <p>Of course, in the case of <code class="literal">Foo</code> above, it would be equally as valid to call the <code class="literal">init()</code> method directly during construction:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {
    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> Foo foo() {
        Foo foo = <span class="hl-keyword">new</span> Foo();
        foo.init();
    <span class="hl-keyword">return</span> foo;
    }

    <span class="hl-comment">// ...</span>

}</pre> 
     <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Tip">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
         <th align="left">Tip</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>When you work directly in Java, you can do anything you like with your objects and do not always need to rely on the container lifecycle!</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="Specifying bean scope">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-java-specifying-bean-scope"></a>Specifying bean scope</h4>
       </div>
      </div>
     </div> 
     <div class="section" title="Using the @Scope annotation">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="beans-java-available-scopes"></a>Using the @Scope annotation</h5>
        </div>
       </div>
      </div> 
      <p>You can specify that your beans defined with the <code class="literal">@Bean</code> annotation should have a specific scope. You can use any of the standard scopes specified in the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes" title="4.5&nbsp;Bean scopes">Bean Scopes</a> section.</p> 
      <p>The default scope is <code class="literal">singleton</code>, but you can override this with the <code class="literal">@Scope</code> annotation:</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyConfiguration {

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="strong"><strong>@Scope(&quot;prototype&quot;)</strong></span>
    <span class="hl-keyword">public</span> Encryptor encryptor() {
        <span class="hl-comment">// ...</span>
    }

}</pre> 
     </div> 
     <div class="section" title="@Scope and scoped-proxy">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="beans-java-scoped-proxy"></a>@Scope and scoped-proxy</h5>
        </div>
       </div>
      </div> 
      <p>Spring offers a convenient way of working with scoped dependencies through <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes-other-injection" title="Scoped beans as dependencies">scoped proxies</a>. The easiest way to create such a proxy when using the XML configuration is the <code class="literal">&lt;aop:scoped-proxy/&gt;</code> element. Configuring your beans in Java with a @Scope annotation offers equivalent support with the proxyMode attribute. The default is no proxy ( <code class="literal">ScopedProxyMode.NO</code>), but you can specify <code class="literal">ScopedProxyMode.TARGET_CLASS</code> or <code class="literal">ScopedProxyMode.INTERFACES</code>.</p> 
      <p>If you port the scoped proxy example from the XML reference documentation (see preceding link) to our <code class="literal">@Bean</code> using Java, it would look like the following:</p> 
      <pre class="programlisting"><span class="hl-comment">// an HTTP Session-scoped bean exposed as a proxy</span>
<i><span class="hl-annotation" style="color: gray">@Bean</span></i>
<span class="strong"><strong>@Scope(value = &quot;session&quot;, proxyMode = ScopedProxyMode.TARGET_CLASS)</strong></span>
<span class="hl-keyword">public</span> UserPreferences userPreferences() {
    <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> UserPreferences();
}

<i><span class="hl-annotation" style="color: gray">@Bean</span></i>
<span class="hl-keyword">public</span> Service userService() {
    UserService service = <span class="hl-keyword">new</span> SimpleUserService();
    <span class="hl-comment">// a reference to the proxied userPreferences bean</span>
    service.setUserPreferences(userPreferences());
    <span class="hl-keyword">return</span> service;
}</pre> 
     </div> 
    </div> 
    <div class="section" title="Customizing bean naming">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-java-customizing-bean-naming"></a>Customizing bean naming</h4>
       </div>
      </div>
     </div> 
     <p>By default, configuration classes use a <code class="literal">@Bean</code> methods name as the name of the resulting bean. This functionality can be overridden, however, with the <code class="literal">name</code> attribute.</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <i><span class="hl-annotation" style="color: gray">@Bean(name = &quot;myFoo&quot;)</span></i>
    <span class="hl-keyword">public</span> Foo foo() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Foo();
    }

}</pre> 
    </div> 
    <div class="section" title="Bean aliasing">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-java-bean-aliasing"></a>Bean aliasing</h4>
       </div>
      </div>
     </div> 
     <p>As discussed in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-beanname" title="4.3.1&nbsp;Naming beans">Section&nbsp;4.3.1, Naming beans</a>, it is sometimes desirable to give a single bean multiple names, otherwise known as<span class="emphasis"><em>bean aliasing</em></span>. The <code class="literal">name</code> attribute of the <code class="literal">@Bean</code> annotation accepts a String array for this purpose.</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <i><span class="hl-annotation" style="color: gray">@Bean(name = { &quot;dataSource&quot;, &quot;subsystemA-dataSource&quot;, &quot;subsystemB-dataSource&quot; })</span></i>
    <span class="hl-keyword">public</span> DataSource dataSource() {
        <span class="hl-comment">// instantiate, configure and return DataSource bean...</span>
    }

}</pre> 
    </div> 
    <div class="section" title="Bean description">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-java-bean-description"></a>Bean description</h4>
       </div>
      </div>
     </div> 
     <p>Sometimes it is helpful to provide a more detailed textual description of a bean. This can be particularly useful when beans are exposed (perhaps via JMX) for monitoring purposes.</p> 
     <p>To add a description to a <code class="literal">@Bean</code> the <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/context/annotation/Description.html" target="_top"><code class="literal">@Description</code></a> annotation can be used:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="strong"><strong>@Desciption(&quot;Provides a basic example of a bean&quot;)</strong></span>
    <span class="hl-keyword">public</span> Foo foo() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Foo();
    }

}</pre> 
    </div> 
   </div> 
   <div class="section" title="4.12.4&nbsp;Using the @Configuration annotation">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-java-configuration-annotation"></a>4.12.4&nbsp;Using the @Configuration annotation</h3>
      </div>
     </div>
    </div> 
    <p><code class="literal">@Configuration</code> is a class-level annotation indicating that an object is a source of bean definitions. <code class="literal">@Configuration</code> classes declare beans via public <code class="literal">@Bean</code> annotated methods. Calls to <code class="literal">@Bean</code> methods on <code class="literal">@Configuration</code> classes can also be used to define inter-bean dependencies. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-java-basic-concepts" title="4.12.1&nbsp;Basic concepts: @Bean and @Configuration">Section&nbsp;4.12.1, Basic concepts: @Bean and @Configuration</a> for a general introduction.</p> 
    <div class="section" title="Injecting inter-bean dependencies">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-java-injecting-dependencies"></a>Injecting inter-bean dependencies</h4>
       </div>
      </div>
     </div> 
     <p>When <code class="literal">@Bean</code> s have dependencies on one another, expressing that dependency is as simple as having one bean method call another:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> Foo foo() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Foo(bar());
    }

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> Bar bar() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Bar();
    }

}</pre> 
     <p>In the example above, the <code class="literal">foo</code> bean receives a reference to <code class="literal">bar</code> via constructor injection.</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>This method of declaring inter-bean dependencies only works when the <code class="literal">@Bean</code> method is declared within a <code class="literal">@Configuration</code> class. You cannot declare inter-bean dependencies using plain <code class="literal">@Component</code> classes.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="Lookup method injection">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-java-method-injection"></a>Lookup method injection</h4>
       </div>
      </div>
     </div> 
     <p>As noted earlier, <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-method-injection" title="4.4.6&nbsp;Method injection">lookup method injection</a> is an advanced feature that you should use rarely. It is useful in cases where a singleton-scoped bean has a dependency on a prototype-scoped bean. Using Java for this type of configuration provides a natural means for implementing this pattern.</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> CommandManager {
    <span class="hl-keyword">public</span> Object process(Object commandState) {
        <span class="hl-comment">// grab a new instance of the appropriate Command interface</span>
        Command command = createCommand();

        <span class="hl-comment">// set the state on the (hopefully brand new) Command instance</span>
        command.setState(commandState);
    <span class="hl-keyword">return</span> command.execute();
    }

    <span class="hl-comment">// okay... but where is the implementation of this method?</span>
    <span class="hl-keyword">protected</span> <span class="hl-keyword">abstract</span> Command createCommand();
}</pre> 
     <p>Using Java-configuration support , you can create a subclass of <code class="literal">CommandManager</code> where the abstract <code class="literal">createCommand()</code> method is overridden in such a way that it looks up a new (prototype) command object:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Bean</span></i>
<i><span class="hl-annotation" style="color: gray">@Scope(&quot;prototype&quot;)</span></i>
<span class="hl-keyword">public</span> AsyncCommand asyncCommand() {
    AsyncCommand command = <span class="hl-keyword">new</span> AsyncCommand();
    <span class="hl-comment">// inject dependencies here as required</span>
    <span class="hl-keyword">return</span> command;
}

<i><span class="hl-annotation" style="color: gray">@Bean</span></i>
<span class="hl-keyword">public</span> CommandManager commandManager() {
    <span class="hl-comment">// return new anonymous implementation of CommandManager with command() overridden</span>
    <span class="hl-comment">// to return a new prototype Command object</span>
    <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> CommandManager() {
        <span class="hl-keyword">protected</span> Command createCommand() {
            <span class="hl-keyword">return</span> asyncCommand();
        }
    }
}</pre> 
    </div> 
    <div class="section" title="Further information about how Java-based configuration works internally">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-java-further-information-java-config"></a>Further information about how Java-based configuration works internally</h4>
       </div>
      </div>
     </div> 
     <p>The following example shows a <code class="literal">@Bean</code> annotated method being called twice:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> ClientService clientService1() {
        ClientServiceImpl clientService = <span class="hl-keyword">new</span> ClientServiceImpl();
        clientService.setClientDao(clientDao());
        <span class="hl-keyword">return</span> clientService;
    }

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> ClientService clientService2() {
        ClientServiceImpl clientService = <span class="hl-keyword">new</span> ClientServiceImpl();
        clientService.setClientDao(clientDao());
        <span class="hl-keyword">return</span> clientService;
    }

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> ClientDao clientDao() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> ClientDaoImpl();
    }

}</pre> 
     <p><code class="literal">clientDao()</code> has been called once in <code class="literal">clientService1()</code> and once in <code class="literal">clientService2()</code>. Since this method creates a new instance of <code class="literal">ClientDaoImpl</code> and returns it, you would normally expect having 2 instances (one for each service). That definitely would be problematic: in Spring, instantiated beans have a <code class="literal">singleton</code> scope by default. This is where the magic comes in: All <code class="literal">@Configuration</code> classes are subclassed at startup-time with <code class="literal">CGLIB</code>. In the subclass, the child method checks the container first for any cached (scoped) beans before it calls the parent method and creates a new instance. Note that as of Spring 3.2, it is no longer necessary to add CGLIB to your classpath because CGLIB classes have been repackaged under org.springframework and included directly within the spring-core JAR.</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>The behavior could be different according to the scope of your bean. We are talking about singletons here.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>There are a few restrictions due to the fact that CGLIB dynamically adds features at startup-time:</p> 
          <div class="itemizedlist">
           <ul class="itemizedlist" type="disc">
            <li class="listitem"> Configuration classes should not be final </li>
            <li class="listitem"> They should have a constructor with no arguments </li>
           </ul>
          </div> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
   </div> 
   <div class="section" title="4.12.5&nbsp;Composing Java-based configurations">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-java-composing-configuration-classes"></a>4.12.5&nbsp;Composing Java-based configurations</h3>
      </div>
     </div>
    </div> 
    <div class="section" title="Using the @Import annotation">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-java-using-import"></a>Using the @Import annotation</h4>
       </div>
      </div>
     </div> 
     <p>Much as the <code class="literal">&lt;import/&gt;</code> element is used within Spring XML files to aid in modularizing configurations, the <code class="literal">@Import</code> annotation allows for loading <code class="literal">@Bean</code> definitions from another configuration class:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ConfigA {

     <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> A a() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> A();
    }

}

<i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@Import(ConfigA.class)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ConfigB {

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> B b() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> B();
    }

}</pre> 
     <p>Now, rather than needing to specify both <code class="literal">ConfigA.class</code> and <code class="literal">ConfigB.class</code> when instantiating the context, only <code class="literal">ConfigB</code> needs to be supplied explicitly:</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    ApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext(ConfigB.<span class="hl-keyword">class</span>);

    <span class="hl-comment">// now both beans A and B will be available...</span>
    A a = ctx.getBean(A.<span class="hl-keyword">class</span>);
    B b = ctx.getBean(B.<span class="hl-keyword">class</span>);
}</pre> 
     <p>This approach simplifies container instantiation, as only one class needs to be dealt with, rather than requiring the developer to remember a potentially large number of <code class="literal">@Configuration</code> classes during construction.</p> 
     <div class="section" title="Injecting dependencies on imported @Bean definitions">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="beans-java-injecting-imported-beans"></a>Injecting dependencies on imported @Bean definitions</h5>
        </div>
       </div>
      </div> 
      <p>The example above works, but is simplistic. In most practical scenarios, beans will have dependencies on one another across configuration classes. When using XML, this is not an issue, per se, because there is no compiler involved, and one can simply declare <code class="literal">ref=&quot;someBean&quot;</code> and trust that Spring will work it out during container initialization. Of course, when using <code class="literal">@Configuration</code> classes, the Java compiler places constraints on the configuration model, in that references to other beans must be valid Java syntax.</p> 
      <p>Fortunately, solving this problem is simple. Remember that <code class="literal">@Configuration</code> classes are ultimately just another bean in the container - this means that they can take advantage of <code class="literal">@Autowired</code> injection metadata just like any other bean!</p> 
      <p>Lets consider a more real-world scenario with several <code class="literal">@Configuration</code> classes, each depending on beans declared in the others:</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ServiceConfig {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> AccountRepository accountRepository;

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> TransferService transferService() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TransferServiceImpl(accountRepository);
    }

}

<i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RepositoryConfig {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> DataSource dataSource;

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> AccountRepository accountRepository() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> JdbcAccountRepository(dataSource);
    }

}

<i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@Import({ServiceConfig.class, RepositoryConfig.class})</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SystemTestConfig {

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> DataSource dataSource() {
        <span class="hl-comment">// return new DataSource</span>
    }

}

<span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    ApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext(SystemTestConfig.<span class="hl-keyword">class</span>);
    <span class="hl-comment">// everything wires up across configuration classes...</span>
    TransferService transferService = ctx.getBean(TransferService.<span class="hl-keyword">class</span>);
    transferService.transfer(<span class="hl-number">100.00</span>, <span class="hl-string">&quot;A123&quot;</span>, <span class="hl-string">&quot;C456&quot;</span>);
}</pre> 
      <p>In the scenario above, using <code class="literal">@Autowired</code> works well and provides the desired modularity, but determining exactly where the autowired bean definitions are declared is still somewhat ambiguous. For example, as a developer looking at <code class="literal">ServiceConfig</code>, how do you know exactly where the <code class="literal">@Autowired AccountRepository</code> bean is declared? Its not explicit in the code, and this may be just fine. Remember that the <a class="ulink" href="http://www.springsource.com/products/sts" target="_top">SpringSource Tool Suite</a> provides tooling that can render graphs showing how everything is wired up - that may be all you need. Also, your Java IDE can easily find all declarations and uses of the <code class="literal">AccountRepository</code> type, and will quickly show you the location of <code class="literal">@Bean</code> methods that return that type.</p> 
      <p>In cases where this ambiguity is not acceptable and you wish to have direct navigation from within your IDE from one <code class="literal">@Configuration</code> class to another, consider autowiring the configuration classes themselves:</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ServiceConfig {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> RepositoryConfig repositoryConfig;

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> TransferService transferService() {
        <span class="hl-comment">// navigate </span><span class="emphasis"><em>through</em></span> the config <span class="hl-keyword">class</span> to the <i><span class="hl-annotation" style="color: gray">@Bean</span></i> method!
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TransferServiceImpl(repositoryConfig.accountRepository());
    }

}</pre> 
      <p>In the situation above, it is completely explicit where <code class="literal">AccountRepository</code> is defined. However, <code class="literal">ServiceConfig</code> is now tightly coupled to <code class="literal">RepositoryConfig</code>; thats the tradeoff. This tight coupling can be somewhat mitigated by using interface-based or abstract class-based <code class="literal">@Configuration</code> classes. Consider the following:</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ServiceConfig {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> RepositoryConfig repositoryConfig;

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> TransferService transferService() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TransferServiceImpl(repositoryConfig.accountRepository());
    }
}

<i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> RepositoryConfig {

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    AccountRepository accountRepository();

}

<i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultRepositoryConfig <span class="hl-keyword">implements</span> RepositoryConfig {

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> AccountRepository accountRepository() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> JdbcAccountRepository(...);
    }

}

<i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@Import({ServiceConfig.class, DefaultRepositoryConfig.class})</span></i> <span class="hl-comment">// import the concrete config!</span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SystemTestConfig {

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> DataSource dataSource() {
        <span class="hl-comment">// return DataSource</span>
    }

}

<span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    ApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext(SystemTestConfig.<span class="hl-keyword">class</span>);
    TransferService transferService = ctx.getBean(TransferService.<span class="hl-keyword">class</span>);
    transferService.transfer(<span class="hl-number">100.00</span>, <span class="hl-string">&quot;A123&quot;</span>, <span class="hl-string">&quot;C456&quot;</span>);
}</pre> 
      <p>Now <code class="literal">ServiceConfig</code> is loosely coupled with respect to the concrete <code class="literal">DefaultRepositoryConfig</code>, and built-in IDE tooling is still useful: it will be easy for the developer to get a type hierarchy of <code class="literal">RepositoryConfig</code> implementations. In this way, navigating <code class="literal">@Configuration</code> classes and their dependencies becomes no different than the usual process of navigating interface-based code.</p> 
     </div> 
    </div> 
    <div class="section" title="Conditionally including @Configuration classes or @Beans">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-java-conditional"></a>Conditionally including @Configuration classes or @Beans</h4>
       </div>
      </div>
     </div> 
     <p>It is often useful to conditionally enable to disable a complete <code class="literal">@Configuration</code> class, or even individual <code class="literal">@Bean</code> methods, based on some arbitrary system state. One common example of this it to use the <code class="literal">@Profile</code> annotation to active beans only when a specific profile has been enabled in the Spring <code class="literal">Environment</code> (see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-definition-profiles" title="4.13&nbsp;Bean definition profiles and environment abstraction">Section&nbsp;4.13, Bean definition profiles and environment abstraction</a> for details).</p> 
     <p>The <code class="literal">@Profile</code> annotation is actually implemented using a much more flexible annotation called <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/context/annotation/Conditional.html" target="_top"><code class="literal">@Conditional</code></a>. The <code class="literal">@Conditional</code> annotation indicates specific <code class="literal">org.springframework.context.annotation.Condition</code> implementations that should be consulted before a <code class="literal">@Bean</code> is registered.</p> 
     <p>Implementations of the <code class="literal">Condition</code> interface simply provide a <code class="literal">matches(...)</code> method that returns <code class="literal">true</code> or <code class="literal">false</code>. For example, here is the actual <code class="literal">Condition</code> implementation used for <code class="literal">@Profile</code>:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Override</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> matches(ConditionContext context, AnnotatedTypeMetadata metadata) {
    <span class="hl-keyword">if</span> (context.getEnvironment() != null) {
        <span class="hl-comment">// Read the @Profile annotation attributes</span>
        MultiValueMap&lt;String, Object&gt; attrs = metadata.getAllAnnotationAttributes(Profile.<span class="hl-keyword">class</span>.getName());
        <span class="hl-keyword">if</span> (attrs != null) {
            <span class="hl-keyword">for</span> (Object value : attrs.get(<span class="hl-string">&quot;value&quot;</span>)) {
                <span class="hl-keyword">if</span> (context.getEnvironment().acceptsProfiles(((String[]) value))) {
                    <span class="hl-keyword">return</span> true;
                }
            }
            <span class="hl-keyword">return</span> false;
        }
    }
    <span class="hl-keyword">return</span> true;
}</pre> 
     <p>See the <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/context/annotation/Conditional.html" target="_top"> <code class="literal">@Conditional</code> Javadoc</a> for more detail.</p> 
    </div> 
    <div class="section" title="Combining Java and XML configuration">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-java-combining"></a>Combining Java and XML configuration</h4>
       </div>
      </div>
     </div> 
     <p>Springs <code class="literal">@Configuration</code> class support does not aim to be a 100% complete replacement for Spring XML. Some facilities such as Spring XML namespaces remain an ideal way to configure the container. In cases where XML is convenient or necessary, you have a choice: either instantiate the container in an &quot;XML-centric&quot; way using, for example, <code class="literal">ClassPathXmlApplicationContext</code>, or in a &quot;Java-centric&quot; fashion using <code class="literal">AnnotationConfigApplicationContext</code> and the <code class="literal">@ImportResource</code> annotation to import XML as needed.</p> 
     <div class="section" title="XML-centric use of @Configuration classes">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="beans-java-combining-xml-centric"></a>XML-centric use of @Configuration classes</h5>
        </div>
       </div>
      </div> 
      <p>It may be preferable to bootstrap the Spring container from XML and include <code class="literal">@Configuration</code> classes in an ad-hoc fashion. For example, in a large existing codebase that uses Spring XML, it will be easier to create <code class="literal">@Configuration</code> classes on an as-needed basis and include them from the existing XML files. Below youll find the options for using <code class="literal">@Configuration</code> classes in this kind of &quot;XML-centric&quot; situation.</p> 
      <p>Remember that <code class="literal">@Configuration</code> classes are ultimately just bean definitions in the container. In this example, we create a <code class="literal">@Configuration</code> class named <code class="literal">AppConfig</code> and include it within <code class="literal">system-test-config.xml</code> as a <code class="literal">&lt;bean/&gt;</code> definition. Because <code class="literal">&lt;context:annotation-config/&gt;</code> is switched on, the container will recognize the <code class="literal">@Configuration</code> annotation, and process the <code class="literal">@Bean</code> methods declared in <code class="literal">AppConfig</code> properly.</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> DataSource dataSource;

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> AccountRepository accountRepository() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> JdbcAccountRepository(dataSource);
    }

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> TransferService transferService() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> TransferService(accountRepository());
    }

}</pre> 
      <pre class="programlisting">system-test-config.xml
<span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-comment">&lt;!-- enable processing of annotations such as @Autowired and @Configuration --&gt;</span>
    <span class="hl-tag">&lt;context:annotation-config/&gt;</span>
    <span class="hl-tag">&lt;context:property-placeholder</span> <span class="hl-attribute">location</span>=<span class="hl-value">&quot;classpath:/com/acme/jdbc.properties&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.acme.AppConfig&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;url&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;${jdbc.url}&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;username&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;${jdbc.username}&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;password&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;${jdbc.password}&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
      <pre class="literallayout">jdbc.properties
jdbc.url=jdbc:hsqldb:hsql://localhost/xdb
jdbc.username=sa
jdbc.password=</pre> 
      <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">&quot;classpath:/com/acme/system-test-config.xml&quot;</span>);
    TransferService transferService = ctx.getBean(TransferService.<span class="hl-keyword">class</span>);
    <span class="hl-comment">// ...</span>
}</pre> 
      <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
       <table border="0" summary="Note">
        <tbody>
         <tr>
          <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
          <th align="left">Note</th>
         </tr>
         <tr>
          <td align="left" valign="top"> <p>In <code class="literal">system-test-config.xml</code> above, the <code class="literal">AppConfig&lt;bean/&gt;</code> does not declare an <code class="literal">id</code> element. While it would be acceptable to do so, it is unnecessary given that no other bean will ever refer to it, and it is unlikely that it will be explicitly fetched from the container by name. Likewise with the <code class="literal">DataSource</code> bean - it is only ever autowired by type, so an explicit bean id is not strictly required.</p> </td>
         </tr>
        </tbody>
       </table>
      </div> 
      <p>Because <code class="literal">@Configuration</code> is meta-annotated with <code class="literal">@Component</code>, <code class="literal">@Configuration</code>-annotated classes are automatically candidates for component scanning. Using the same scenario as above, we can redefine <code class="literal">system-test-config.xml</code> to take advantage of component-scanning. Note that in this case, we dont need to explicitly declare <code class="literal">&lt;context:annotation-config/&gt;</code>, because <code class="literal">&lt;context:component-scan/&gt;</code> enables all the same functionality.</p> 
      <pre class="programlisting">system-test-config.xml
<span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-comment">&lt;!-- picks up and registers AppConfig as a bean definition --&gt;</span>
    <span class="hl-tag">&lt;context:component-scan</span> <span class="hl-attribute">base-package</span>=<span class="hl-value">&quot;com.acme&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;context:property-placeholder</span> <span class="hl-attribute">location</span>=<span class="hl-value">&quot;classpath:/com/acme/jdbc.properties&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.jdbc.datasource.DriverManagerDataSource&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;url&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;${jdbc.url}&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;username&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;${jdbc.username}&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;password&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;${jdbc.password}&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
     </div> 
     <div class="section" title="@Configuration class-centric use of XML with @ImportResource">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="beans-java-combining-java-centric"></a>@Configuration class-centric use of XML with @ImportResource</h5>
        </div>
       </div>
      </div> 
      <p>In applications where <code class="literal">@Configuration</code> classes are the primary mechanism for configuring the container, it will still likely be necessary to use at least some XML. In these scenarios, simply use <code class="literal">@ImportResource</code> and define only as much XML as is needed. Doing so achieves a &quot;Java-centric&quot; approach to configuring the container and keeps XML to a bare minimum.</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@ImportResource(&quot;classpath:/com/acme/properties-config.xml&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <i><span class="hl-annotation" style="color: gray">@Value(&quot;${jdbc.url}&quot;)</span></i>
    <span class="hl-keyword">private</span> String url;

    <i><span class="hl-annotation" style="color: gray">@Value(&quot;${jdbc.username}&quot;)</span></i>
    <span class="hl-keyword">private</span> String username;

    <i><span class="hl-annotation" style="color: gray">@Value(&quot;${jdbc.password}&quot;)</span></i>
    <span class="hl-keyword">private</span> String password;

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> DataSource dataSource() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> DriverManagerDataSource(url, username, password);
    }

}</pre> 
      <pre class="programlisting">properties-config.xml
<span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;context:property-placeholder</span> <span class="hl-attribute">location</span>=<span class="hl-value">&quot;classpath:/com/acme/jdbc.properties&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
      <pre class="literallayout">jdbc.properties
jdbc.url=jdbc:hsqldb:hsql://localhost/xdb
jdbc.username=sa
jdbc.password=</pre> 
      <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    ApplicationContext ctx = <span class="hl-keyword">new</span> AnnotationConfigApplicationContext(AppConfig.<span class="hl-keyword">class</span>);
    TransferService transferService = ctx.getBean(TransferService.<span class="hl-keyword">class</span>);
    <span class="hl-comment">// ...</span>
}</pre> 
     </div> 
    </div> 
   </div> 
  </div> 
  <div class="section" title="4.13&nbsp;Bean definition profiles and environment abstraction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="beans-definition-profiles"></a>4.13&nbsp;Bean definition profiles and environment abstraction</h2>
     </div>
    </div>
   </div> 
   <p>Bean definition profiles is a mechanism in the core container that allows for registration of different beans in different environments. This feature can help with many use cases, including:</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem"> working against an in-memory datasource in development vs looking up that same datasource from JNDI when in QA or production </li>
     <li class="listitem"> registering monitoring infrastructure only when deploying an application into a performance environment </li>
     <li class="listitem"> registering customized implementations of beans for customer A vs. customer B deployments </li>
    </ul>
   </div> 
   <p>Find out more about <a class="ulink" href="http://spring.io/blog/2011/02/11/spring-framework-3-1-m1-released/" target="_top">Environment, XML Profiles</a> and the <a class="ulink" href="http://spring.io/blog/2011/02/14/spring-3-1-m1-introducing-profile/" target="_top">@Profile annotation</a>.</p> 
  </div> 
  <div class="section" title="4.14&nbsp;PropertySource Abstraction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="beans-property-source-abstraction"></a>4.14&nbsp;PropertySource Abstraction</h2>
     </div>
    </div>
   </div> 
   <p>Springs <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-definition-profiles" title="4.13&nbsp;Bean definition profiles and environment abstraction">Environment abstraction</a> provides search operations over a configurable hierarchy of property sources.</p> 
   <p>You can find out more about <a class="ulink" href="http://spring.io/blog/2011/02/15/spring-3-1-m1-unified-property-management/" target="_top">Unified Property Management</a>, the <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/core/env/PropertySource.html" target="_top"><code class="literal">PropertySource</code> class</a> and the <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-apiorg/springframework/context/annotation/PropertySource.html" target="_top"><code class="literal">@PropertySource</code> annotation</a>.</p> 
  </div> 
  <div class="section" title="4.15&nbsp;Registering a LoadTimeWeaver">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="context-load-time-weaver"></a>4.15&nbsp;Registering a LoadTimeWeaver</h2>
     </div>
    </div>
   </div> 
   <p>The <code class="literal">LoadTimeWeaver</code> is used by Spring to dynamically transform classes as they are loaded into the Java virtual machine (JVM).</p> 
   <p>To enable load-time weaving add the <code class="literal">@EnableLoadTimeWeaving</code> to one of your <code class="literal">@Configuration</code> classes:</p> 
   <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableLoadTimeWeaving</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

}</pre> 
   <p>Alternatively for XML configuration use the <code class="literal">context:load-time-weaver</code> element:</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;context:load-time-weaver/&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
   <p>Once configured for the <code class="literal">ApplicationContext</code>. Any bean within that <code class="literal">ApplicationContext</code> may implement <code class="literal">LoadTimeWeaverAware</code>, thereby receiving a reference to the load-time weaver instance. This is particularly useful in combination with <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#orm-jpa" title="14.5&nbsp;JPA">Springs JPA support</a> where load-time weaving may be necessary for JPA class transformation. Consult the <code class="literal">LocalContainerEntityManagerFactoryBean</code> Javadoc for more detail. For more on AspectJ load-time weaving, see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-aj-ltw" title="8.8.4&nbsp;Load-time weaving with AspectJ in the Spring Framework">Section&nbsp;8.8.4, Load-time weaving with AspectJ in the Spring Framework</a>.</p> 
  </div> 
  <div class="section" title="4.16&nbsp;Additional Capabilities of the ApplicationContext">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="context-introduction"></a>4.16&nbsp;Additional Capabilities of the ApplicationContext</h2>
     </div>
    </div>
   </div> 
   <p>As was discussed in the chapter introduction, the <code class="literal">org.springframework.beans.factory</code> package provides basic functionality for managing and manipulating beans, including in a programmatic way. The <code class="literal">org.springframework.context</code> package adds the <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/context/ApplicationContext.html" target="_top"><code class="literal">ApplicationContext</code></a> interface, which extends the <code class="literal">BeanFactory</code> interface, in addition to extending other interfaces to provide additional functionality in a more <span class="emphasis"><em>application framework-oriented style</em></span>. Many people use the <code class="literal">ApplicationContext</code> in a completely declarative fashion, not even creating it programmatically, but instead relying on support classes such as <code class="literal">ContextLoader</code> to automatically instantiate an <code class="literal">ApplicationContext</code> as part of the normal startup process of a J2EE web application.</p> 
   <p>To enhance <code class="literal">BeanFactory</code> functionality in a more framework-oriented style the context package also provides the following functionality:</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem"> <span class="emphasis"><em>Access to messages in i18n-style</em></span>, through the <code class="literal">MessageSource</code> interface. </li>
     <li class="listitem"> <span class="emphasis"><em>Access to resources</em></span>, such as URLs and files, through the <code class="literal">ResourceLoader</code> interface. </li>
     <li class="listitem"> <span class="emphasis"><em>Event publication</em></span> to beans implementing the <code class="literal">ApplicationListener</code> interface, through the use of the <code class="literal">ApplicationEventPublisher</code> interface. </li>
     <li class="listitem"> <span class="emphasis"><em>Loading of multiple (hierarchical) contexts</em></span>, allowing each to be focused on one particular layer, such as the web layer of an application, through the <code class="literal">HierarchicalBeanFactory</code> interface. </li>
    </ul>
   </div> 
   <div class="section" title="4.16.1&nbsp;Internationalization using MessageSource">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="context-functionality-messagesource"></a>4.16.1&nbsp;Internationalization using MessageSource</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">ApplicationContext</code> interface extends an interface called <code class="literal">MessageSource</code>, and therefore provides internationalization (i18n) functionality. Spring also provides the interface <code class="literal">HierarchicalMessageSource</code>, which can resolve messages hierarchically. Together these interfaces provide the foundation upon which Spring effects message resolution. The methods defined on these interfaces include:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> <code class="literal">String getMessage(String code, Object[] args, String default, Locale loc)</code>: The basic method used to retrieve a message from the <code class="literal">MessageSource</code>. When no message is found for the specified locale, the default message is used. Any arguments passed in become replacement values, using the <code class="literal">MessageFormat</code> functionality provided by the standard library. </li>
      <li class="listitem"> <code class="literal">String getMessage(String code, Object[] args, Locale loc)</code>: Essentially the same as the previous method, but with one difference: no default message can be specified; if the message cannot be found, a <code class="literal">NoSuchMessageException</code> is thrown. </li>
      <li class="listitem"> <code class="literal">String getMessage(MessageSourceResolvable resolvable, Locale locale)</code>: All properties used in the preceding methods are also wrapped in a class named <code class="literal">MessageSourceResolvable</code>, which you can use with this method. </li>
     </ul>
    </div> 
    <p>When an <code class="literal">ApplicationContext</code> is loaded, it automatically searches for a <code class="literal">MessageSource</code> bean defined in the context. The bean must have the name <code class="literal">messageSource</code>. If such a bean is found, all calls to the preceding methods are delegated to the message source. If no message source is found, the <code class="literal">ApplicationContext</code> attempts to find a parent containing a bean with the same name. If it does, it uses that bean as the <code class="literal">MessageSource</code>. If the <code class="literal">ApplicationContext</code> cannot find any source for messages, an empty <code class="literal">DelegatingMessageSource</code> is instantiated in order to be able to accept calls to the methods defined above.</p> 
    <p>Spring provides two <code class="literal">MessageSource</code> implementations, <code class="literal">ResourceBundleMessageSource</code> and <code class="literal">StaticMessageSource</code>. Both implement <code class="literal">HierarchicalMessageSource</code> in order to do nested messaging. The <code class="literal">StaticMessageSource</code> is rarely used but provides programmatic ways to add messages to the source. The <code class="literal">ResourceBundleMessageSource</code> is shown in the following example:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;messageSource&quot;</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.context.support.ResourceBundleMessageSource&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;basenames&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;list&gt;</span>
                <span class="hl-tag">&lt;value&gt;</span>format<span class="hl-tag">&lt;/value&gt;</span>
                <span class="hl-tag">&lt;value&gt;</span>exceptions<span class="hl-tag">&lt;/value&gt;</span>
                <span class="hl-tag">&lt;value&gt;</span>windows<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;/list&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>In the example it is assumed you have three resource bundles defined in your classpath called <code class="literal">format</code>, <code class="literal">exceptions</code> and <code class="literal">windows</code>. Any request to resolve a message will be handled in the JDK standard way of resolving messages through ResourceBundles. For the purposes of the example, assume the contents of two of the above resource bundle files are</p> 
    <pre class="programlisting"># in format.properties
message=Alligators rock!</pre> 
    <pre class="programlisting"># in exceptions.properties
argument.required=The <span class="emphasis"><em>{0}</em></span> argument is required.</pre> 
    <p>A program to execute the <code class="literal">MessageSource</code> functionality is shown in the next example. Remember that all <code class="literal">ApplicationContext</code> implementations are also <code class="literal">MessageSource</code> implementations and so can be cast to the <code class="literal">MessageSource</code> interface.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {
    MessageSource resources = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">&quot;beans.xml&quot;</span>);
    String message = resources.getMessage(<span class="hl-string">&quot;message&quot;</span>, null, <span class="hl-string">&quot;Default&quot;</span>, null);
    System.out.println(message);
}</pre> 
    <p>The resulting output from the above program will be</p> 
    <pre class="literallayout">Alligators rock!</pre> 
    <p>So to summarize, the <code class="literal">MessageSource</code> is defined in a file called <code class="literal">beans.xml</code>, which exists at the root of your classpath. The <code class="literal">messageSource</code> bean definition refers to a number of resource bundles through its <code class="literal">basenames</code> property. The three files that are passed in the list to the <code class="literal">basenames</code> property exist as files at the root of your classpath and are called <code class="literal">format.properties</code>, <code class="literal">exceptions.properties</code>, and <code class="literal">windows.properties</code> respectively.</p> 
    <p>The next example shows arguments passed to the message lookup; these arguments will be converted into Strings and inserted into placeholders in the lookup message.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>

    <span class="hl-comment">&lt;!-- this MessageSource is being used in a web application --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;messageSource&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.context.support.ResourceBundleMessageSource&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;basename&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;exceptions&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-comment">&lt;!-- lets inject the above MessageSource into this POJO --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;example&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.Example&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;messages&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;messageSource&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Example {

    <span class="hl-keyword">private</span> MessageSource messages;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMessages(MessageSource messages) {
        <span class="hl-keyword">this</span>.messages = messages;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> execute() {
        String message = <span class="hl-keyword">this</span>.messages.getMessage(<span class="hl-string">&quot;argument.required&quot;</span>,
            <span class="hl-keyword">new</span> Object [] {<span class="hl-string">&quot;userDao&quot;</span>}, <span class="hl-string">&quot;Required&quot;</span>, null);
        System.out.println(message);
    }

}</pre> 
    <p>The resulting output from the invocation of the <code class="literal">execute()</code> method will be</p> 
    <pre class="literallayout">The userDao argument is required.</pre> 
    <p>With regard to internationalization (i18n), Springs various <code class="literal">MessageResource</code> implementations follow the same locale resolution and fallback rules as the standard JDK <code class="literal">ResourceBundle</code>. In short, and continuing with the example <code class="literal">messageSource</code> defined previously, if you want to resolve messages against the British (<code class="literal">en-GB</code>) locale, you would create files called <code class="literal">format_en_GB.properties</code>, <code class="literal">exceptions_en_GB.properties</code>, and <code class="literal">windows_en_GB.properties</code> respectively.</p> 
    <p>Typically, locale resolution is managed by the surrounding environment of the application. In this example, the locale against which (British) messages will be resolved is specified manually.</p> 
    <pre class="literallayout"># in exceptions_en_GB.properties
argument.required=Ebagum lad, the <span class="emphasis"><em>{0}</em></span> argument is required, I say, required.</pre> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(<span class="hl-keyword">final</span> String[] args) {
    MessageSource resources = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">&quot;beans.xml&quot;</span>);
    String message = resources.getMessage(<span class="hl-string">&quot;argument.required&quot;</span>,
        <span class="hl-keyword">new</span> Object [] {<span class="hl-string">&quot;userDao&quot;</span>}, <span class="hl-string">&quot;Required&quot;</span>, Locale.UK);
    System.out.println(message);
}</pre> 
    <p>The resulting output from the running of the above program will be</p> 
    <pre class="literallayout">Ebagum lad, the <span class="emphasis"><em>userDao</em></span> argument is required, I say, required.</pre> 
    <p>You can also use the <code class="literal">MessageSourceAware</code> interface to acquire a reference to any <code class="literal">MessageSource</code> that has been defined. Any bean that is defined in an <code class="literal">ApplicationContext</code> that implements the <code class="literal">MessageSourceAware</code> interface is injected with the application contexts <code class="literal">MessageSource</code> when the bean is created and configured.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p><span class="emphasis"><em>As an alternative to <code class="literal">ResourceBundleMessageSource</code>, Spring provides a <code class="literal">ReloadableResourceBundleMessageSource</code> class. This variant supports the same bundle file format but is more flexible than the standard JDK based <code class="literal">ResourceBundleMessageSource</code> implementation.</em></span> In particular, it allows for reading files from any Spring resource location (not just from the classpath) and supports hot reloading of bundle property files (while efficiently caching them in between). Check out the <code class="literal">ReloadableResourceBundleMessageSource</code> javadoc for details.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="4.16.2&nbsp;Standard and Custom Events">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="context-functionality-events"></a>4.16.2&nbsp;Standard and Custom Events</h3>
      </div>
     </div>
    </div> 
    <p>Event handling in the <code class="literal">ApplicationContext</code> is provided through the <code class="literal">ApplicationEvent</code> class and <code class="literal">ApplicationListener</code> interface. If a bean that implements the <code class="literal">ApplicationListener</code> interface is deployed into the context, every time an <code class="literal">ApplicationEvent</code> gets published to the <code class="literal">ApplicationContext</code>, that bean is notified. Essentially, this is the standard <span class="emphasis"><em>Observer</em></span> design pattern. Spring provides the following standard events:</p> 
    <div class="table">
     <a name="beans-ctx-events-tbl"></a>
     <p class="title"><b>Table&nbsp;4.7.&nbsp;Built-in Events</b></p>
     <div class="table-contents"> 
      <table summary="Built-in Events" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
       <colgroup>
        <col />
        <col />
       </colgroup>
       <thead>
        <tr>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Event</th>
         <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explanation</th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ContextRefreshedEvent</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Published when the <code class="literal">ApplicationContext</code> is initialized or refreshed, for example, using the <code class="literal">refresh()</code> method on the <code class="literal">ConfigurableApplicationContext</code> interface. &quot;Initialized&quot; here means that all beans are loaded, post-processor beans are detected and activated, singletons are pre-instantiated, and the <code class="literal">ApplicationContext</code> object is ready for use. As long as the context has not been closed, a refresh can be triggered multiple times, provided that the chosen <code class="literal">ApplicationContext</code> actually supports such &quot;hot&quot; refreshes. For example, <code class="literal">XmlWebApplicationContext</code> supports hot refreshes, but <code class="literal">GenericApplicationContext</code> does not.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ContextStartedEvent</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Published when the <code class="literal">ApplicationContext</code> is started, using the <code class="literal">start()</code> method on the <code class="literal">ConfigurableApplicationContext</code> interface. &quot;Started&quot; here means that all <code class="literal">Lifecycle</code> beans receive an explicit start signal. Typically this signal is used to restart beans after an explicit stop, but it may also be used to start components that have not been configured for autostart , for example, components that have not already started on initialization.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ContextStoppedEvent</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Published when the <code class="literal">ApplicationContext</code> is stopped, using the <code class="literal">stop()</code> method on the <code class="literal">ConfigurableApplicationContext</code> interface. &quot;Stopped&quot; here means that all <code class="literal">Lifecycle</code> beans receive an explicit stop signal. A stopped context may be restarted through a <code class="literal">start()</code> call.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ContextClosedEvent</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Published when the <code class="literal">ApplicationContext</code> is closed, using the <code class="literal">close()</code> method on the <code class="literal">ConfigurableApplicationContext</code> interface. &quot;Closed&quot; here means that all singleton beans are destroyed. A closed context reaches its end of life; it cannot be refreshed or restarted.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">RequestHandledEvent</code></p></td>
         <td style="" align="left" valign="top"><p>A web-specific event telling all beans that an HTTP request has been serviced. This event is published <span class="emphasis"><em>after</em></span> the request is complete. This event is only applicable to web applications using Springs <code class="literal">DispatcherServlet</code>.</p></td>
        </tr>
       </tbody>
      </table> 
     </div>
    </div>
    <br class="table-break" /> 
    <p>You can also create and publish your own custom events. This example demonstrates a simple class that extends Springs <code class="literal">ApplicationEvent</code> base class:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BlackListEvent <span class="hl-keyword">extends</span> ApplicationEvent {

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> String address;
    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> String test;

    <span class="hl-keyword">public</span> BlackListEvent(Object source, String address, String test) {
        <span class="hl-keyword">super</span>(source);
        <span class="hl-keyword">this</span>.address = address;
        <span class="hl-keyword">this</span>.test = test;
    }

    <span class="hl-comment">// accessor and other methods...</span>

}</pre> 
    <p>To publish a custom <code class="literal">ApplicationEvent</code>, call the <code class="literal">publishEvent()</code> method on an <code class="literal">ApplicationEventPublisher</code>. Typically this is done by creating a class that implements <code class="literal">ApplicationEventPublisherAware</code> and registering it as a Spring bean. The following example demonstrates such a class:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> EmailService <span class="hl-keyword">implements</span> ApplicationEventPublisherAware {

    <span class="hl-keyword">private</span> List&lt;String&gt; blackList;
    <span class="hl-keyword">private</span> ApplicationEventPublisher publisher;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setBlackList(List&lt;String&gt; blackList) {
        <span class="hl-keyword">this</span>.blackList = blackList;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setApplicationEventPublisher(ApplicationEventPublisher publisher) {
        <span class="hl-keyword">this</span>.publisher = publisher;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> sendEmail(String address, String text) {
        <span class="hl-keyword">if</span> (blackList.contains(address)) {
            BlackListEvent event = <span class="hl-keyword">new</span> BlackListEvent(<span class="hl-keyword">this</span>, address, text);
            publisher.publishEvent(event);
            <span class="hl-keyword">return</span>;
        }
        <span class="hl-comment">// send email...</span>
    }

}</pre> 
    <p>At configuration time, the Spring container will detect that <code class="literal">EmailService</code> implements <code class="literal">ApplicationEventPublisherAware</code> and will automatically call <code class="literal">setApplicationEventPublisher()</code>. In reality, the parameter passed in will be the Spring container itself; youre simply interacting with the application context via its <code class="literal">ApplicationEventPublisher</code> interface.</p> 
    <p>To receive the custom <code class="literal">ApplicationEvent</code>, create a class that implements <code class="literal">ApplicationListener</code> and register it as a Spring bean. The following example demonstrates such a class:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BlackListNotifier <span class="hl-keyword">implements</span> ApplicationListener&lt;BlackListEvent&gt; {

    <span class="hl-keyword">private</span> String notificationAddress;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setNotificationAddress(String notificationAddress) {
        <span class="hl-keyword">this</span>.notificationAddress = notificationAddress;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> onApplicationEvent(BlackListEvent event) {
        <span class="hl-comment">// notify appropriate parties via notificationAddress...</span>
    }

}</pre> 
    <p>Notice that <code class="literal">ApplicationListener</code> is generically parameterized with the type of your custom event, <code class="literal">BlackListEvent</code>. This means that the <code class="literal">onApplicationEvent()</code> method can remain type-safe, avoiding any need for downcasting. You may register as many event listeners as you wish, but note that by default event listeners receive events synchronously. This means the <code class="literal">publishEvent()</code> method blocks until all listeners have finished processing the event. One advantage of this synchronous and single-threaded approach is that when a listener receives an event, it operates inside the transaction context of the publisher if a transaction context is available. If another strategy for event publication becomes necessary, refer to the JavaDoc for Springs <code class="literal">ApplicationEventMulticaster</code> interface.</p> 
    <p>The following example shows the bean definitions used to register and configure each of the classes above:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;emailService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.EmailService&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;blackList&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>known.spammer@example.org<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>known.hacker@example.org<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>john.doe@example.org<span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;blackListNotifier&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.BlackListNotifier&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;notificationAddress&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;blacklist@example.org&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>Putting it all together, when the <code class="literal">sendEmail()</code> method of the <code class="literal">emailService</code> bean is called, if there are any emails that should be blacklisted, a custom event of type <code class="literal">BlackListEvent</code> is published. The <code class="literal">blackListNotifier</code> bean is registered as an <code class="literal">ApplicationListener</code> and thus receives the <code class="literal">BlackListEvent</code>, at which point it can notify appropriate parties.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Springs eventing mechanism is designed for simple communication between Spring beans within the same application context. However, for more sophisticated enterprise integration needs, the separately-maintained <a class="ulink" href="http://projects.spring.io/spring-integration/" target="_top">Spring Integration</a> project provides complete support for building lightweight, <a class="ulink" href="http://www.enterpriseintegrationpatterns.com/" target="_top">pattern-oriented</a>, event-driven architectures that build upon the well-known Spring programming model.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="4.16.3&nbsp;Convenient access to low-level resources">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="context-functionality-resources"></a>4.16.3&nbsp;Convenient access to low-level resources</h3>
      </div>
     </div>
    </div> 
    <p>For optimal usage and understanding of application contexts, users should generally familiarize themselves with Springs <code class="literal">Resource</code> abstraction, as described in the chapter <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#resources" title="5.&nbsp;Resources">Chapter&nbsp;5, <i>Resources</i></a>.</p> 
    <p>An application context is a <code class="literal">ResourceLoader</code>, which can be used to load <code class="literal">Resource</code> s. A <code class="literal">Resource</code> is essentially a more feature rich version of the JDK class <code class="literal">java.net.URL</code>, in fact, the implementations of the <code class="literal">Resource</code> wrap an instance of <code class="literal">java.net.URL</code> where appropriate. A <code class="literal">Resource</code> can obtain low-level resources from almost any location in a transparent fashion, including from the classpath, a filesystem location, anywhere describable with a standard URL, and some other variations. If the resource location string is a simple path without any special prefixes, where those resources come from is specific and appropriate to the actual application context type.</p> 
    <p>You can configure a bean deployed into the application context to implement the special callback interface, <code class="literal">ResourceLoaderAware</code>, to be automatically called back at initialization time with the application context itself passed in as the <code class="literal">ResourceLoader</code>. You can also expose properties of type <code class="literal">Resource</code>, to be used to access static resources; they will be injected into it like any other properties. You can specify those <code class="literal">Resource</code> properties as simple String paths, and rely on a special JavaBean <code class="literal">PropertyEditor</code> that is automatically registered by the context, to convert those text strings to actual <code class="literal">Resource</code> objects when the bean is deployed.</p> 
    <p>The location path or paths supplied to an <code class="literal">ApplicationContext</code> constructor are actually resource strings, and in simple form are treated appropriately to the specific context implementation. <code class="literal">ClassPathXmlApplicationContext</code> treats a simple location path as a classpath location. You can also use location paths (resource strings) with special prefixes to force loading of definitions from the classpath or a URL, regardless of the actual context type.</p> 
   </div> 
   <div class="section" title="4.16.4&nbsp;Convenient ApplicationContext instantiation for web applications">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="context-create"></a>4.16.4&nbsp;Convenient ApplicationContext instantiation for web applications</h3>
      </div>
     </div>
    </div> 
    <p>You can create <code class="literal">ApplicationContext</code> instances declaratively by using, for example, a <code class="literal">ContextLoader</code>. Of course you can also create <code class="literal">ApplicationContext</code> instances programmatically by using one of the <code class="literal">ApplicationContext</code> implementations.</p> 
    <p>The <code class="literal">ContextLoader</code> mechanism comes in two flavors: the <code class="literal">ContextLoaderListener</code> and the <code class="literal">ContextLoaderServlet</code>. They have the same functionality but differ in that the listener version is not reliable in Servlet 2.3 containers. In the Servlet 2.4 specification, Servlet context listeners must execute immediately after the Servlet context for the web application is created and is available to service the first request (and also when the Servlet context is about to be shut down). As such a Servlet context listener is an ideal place to initialize the Spring <code class="literal">ApplicationContext</code>. All things being equal, you should probably prefer <code class="literal">ContextLoaderListener</code>; for more information on compatibility, have a look at the Javadoc for the <code class="literal">ContextLoaderServlet</code>.</p> 
    <p>You can register an <code class="literal">ApplicationContext</code> using the <code class="literal">ContextLoaderListener</code> as follows:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;context-param&gt;</span>
    <span class="hl-tag">&lt;param-name&gt;</span>contextConfigLocation<span class="hl-tag">&lt;/param-name&gt;</span>
    <span class="hl-tag">&lt;param-value&gt;</span>/WEB-INF/daoContext.xml /WEB-INF/applicationContext.xml<span class="hl-tag">&lt;/param-value&gt;</span>
<span class="hl-tag">&lt;/context-param&gt;</span>

<span class="hl-tag">&lt;listener&gt;</span>
    <span class="hl-tag">&lt;listener-class&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="hl-tag">&lt;/listener-class&gt;</span>
<span class="hl-tag">&lt;/listener&gt;</span>

<span class="hl-comment">&lt;!-- or use the ContextLoaderServlet instead of the above listener
</span><span class="emphasis"><em>&lt;servlet&gt; &lt;servlet-name&gt;context&lt;/servlet-name&gt; &lt;servlet-class&gt;org.springframework.web.context.ContextLoaderServlet&lt;/servlet-class&gt; &lt;load-on-startup&gt;1&lt;/load-on-startup&gt; &lt;/servlet&gt;</em></span>
--&gt;</pre> 
    <p>The listener inspects the <code class="literal">contextConfigLocation</code> parameter. If the parameter does not exist, the listener uses <code class="literal">/WEB-INF/applicationContext.xml</code> as a default. When the parameter <span class="emphasis"><em>does</em></span> exist, the listener separates the String by using predefined delimiters (comma, semicolon and whitespace) and uses the values as locations where application contexts will be searched. Ant-style path patterns are supported as well. Examples are <code class="literal">/WEB-INF/*Context.xml</code> for all files with names ending with &quot;Context.xml&quot;, residing in the &quot;WEB-INF&quot; directory, and <code class="literal">/WEB-INF/**/*Context.xml</code>, for all such files in any subdirectory of &quot;WEB-INF&quot;.</p> 
    <p>You can use <code class="literal">ContextLoaderServlet</code> instead of <code class="literal">ContextLoaderListener</code>. The Servlet uses the <code class="literal">contextConfigLocation</code> parameter just as the listener does.</p> 
   </div> 
   <div class="section" title="4.16.5&nbsp;Deploying a Spring ApplicationContext as a J2EE RAR file">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="context-deploy-rar"></a>4.16.5&nbsp;Deploying a Spring ApplicationContext as a J2EE RAR file</h3>
      </div>
     </div>
    </div> 
    <p>It is possible to deploy a Spring ApplicationContext as a RAR file, encapsulating the context and all of its required bean classes and library JARs in a J2EE RAR deployment unit. This is the equivalent of bootstrapping a standalone ApplicationContext, just hosted in J2EE environment, being able to access the J2EE servers facilities. RAR deployment is a more natural alternative to scenario of deploying a headless WAR file, in effect, a WAR file without any HTTP entry points that is used only for bootstrapping a Spring ApplicationContext in a J2EE environment.</p> 
    <p>RAR deployment is ideal for application contexts that do not need HTTP entry points but rather consist only of message endpoints and scheduled jobs. Beans in such a context can use application server resources such as the JTA transaction manager and JNDI-bound JDBC DataSources and JMS ConnectionFactory instances, and may also register with the platforms JMX server - all through Springs standard transaction management and JNDI and JMX support facilities. Application components can also interact with the application servers JCA WorkManager through Springs <code class="literal">TaskExecutor</code> abstraction.</p> 
    <p>Check out the JavaDoc of the <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/jca/context/SpringContextResourceAdapter.html" target="_top"><code class="literal">SpringContextResourceAdapter</code></a> class for the configuration details involved in RAR deployment.</p> 
    <p><span class="emphasis"><em>For a simple deployment of a Spring ApplicationContext as a J2EE RAR file:</em></span> package all application classes into a RAR file, which is a standard JAR file with a different file extension. Add all required library JARs into the root of the RAR archive. Add a &quot;META-INF/ra.xml&quot; deployment descriptor (as shown in <code class="literal">SpringContextResourceAdapter</code> s JavaDoc) and the corresponding Spring XML bean definition file(s) (typically &quot;META-INF/applicationContext.xml&quot;), and drop the resulting RAR file into your application servers deployment directory.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Such RAR deployment units are usually self-contained; they do not expose components to the outside world, not even to other modules of the same application. Interaction with a RAR-based ApplicationContext usually occurs through JMS destinations that it shares with other modules. A RAR-based ApplicationContext may also, for example, schedule some jobs, reacting to new files in the file system (or the like). If it needs to allow synchronous access from the outside, it could for example export RMI endpoints, which of course may be used by other application modules on the same machine.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
  </div> 
  <div class="section" title="4.17&nbsp;The BeanFactory">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="beans-beanfactory"></a>4.17&nbsp;The BeanFactory</h2>
     </div>
    </div>
   </div> 
   <p>The <code class="literal">BeanFactory</code> provides the underlying basis for Springs IoC functionality but it is only used directly in integration with other third-party frameworks and is now largely historical in nature for most users of Spring. The <code class="literal">BeanFactory</code> and related interfaces, such as <code class="literal">BeanFactoryAware</code>, <code class="literal">InitializingBean</code>, <code class="literal">DisposableBean</code>, are still present in Spring for the purposes of backward compatibility with the large number of third-party frameworks that integrate with Spring. Often third-party components that can not use more modern equivalents such as <code class="literal">@PostConstruct</code> or <code class="literal">@PreDestroy</code> in order to remain compatible with JDK 1.4 or to avoid a dependency on JSR-250.</p> 
   <p>This section provides additional background into the differences between the <code class="literal">BeanFactory</code> and <code class="literal">ApplicationContext</code> and how one might access the IoC container directly through a classic singleton lookup.</p> 
   <div class="section" title="4.17.1&nbsp;BeanFactory or ApplicationContext?">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="context-introduction-ctx-vs-beanfactory"></a>4.17.1&nbsp;BeanFactory or ApplicationContext?</h3>
      </div>
     </div>
    </div> 
    <p>Use an <code class="literal">ApplicationContext</code> unless you have a good reason for not doing so.</p> 
    <p>Because the <code class="literal">ApplicationContext</code> includes all functionality of the <code class="literal">BeanFactory</code>, it is generally recommended over the <code class="literal">BeanFactory</code>, except for a few situations such as in an <code class="literal">Applet</code> where memory consumption might be critical and a few extra kilobytes might make a difference. However, for most typical enterprise applications and systems, the <code class="literal">ApplicationContext</code> is what you will want to use. Spring makes <span class="emphasis"><em>heavy</em></span> use of the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-extension-bpp" title="4.8.1&nbsp;Customizing beans using a BeanPostProcessor"><code class="literal">BeanPostProcessor</code> extension point</a> (to effect proxying and so on). If you use only a plain <code class="literal">BeanFactory</code>, a fair amount of support such as transactions and AOP will not take effect, at least not without some extra steps on your part. This situation could be confusing because nothing is actually wrong with the configuration.</p> 
    <p>The following table lists features provided by the <code class="literal">BeanFactory</code> and <code class="literal">ApplicationContext</code> interfaces and implementations.</p> 
    <div class="table">
     <a name="context-introduction-ctx-vs-beanfactory-feature-matrix"></a>
     <p class="title"><b>Table&nbsp;4.8.&nbsp;Feature Matrix</b></p>
     <div class="table-contents"> 
      <table summary="Feature Matrix" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
       <colgroup>
        <col />
        <col />
        <col />
       </colgroup>
       <thead>
        <tr>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Feature</th>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><code class="literal">BeanFactory</code></th>
         <th style="border-bottom: 0.5pt solid ; " align="left" valign="top"><code class="literal">ApplicationContext</code></th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Bean instantiation/wiring</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Yes</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Yes</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Automatic <code class="literal">BeanPostProcessor</code> registration</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>No</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Yes</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Automatic <code class="literal">BeanFactoryPostProcessor</code> registration</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>No</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Yes</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Convenient <code class="literal">MessageSource</code> access (for i18n)</p></td>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>No</p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Yes</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ApplicationEvent</code> publication</p></td>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>No</p></td>
         <td style="" align="left" valign="top"><p>Yes</p></td>
        </tr>
       </tbody>
      </table> 
     </div>
    </div>
    <br class="table-break" /> 
    <p>To explicitly register a bean post-processor with a <code class="literal">BeanFactory</code> implementation, you must write code like this:</p> 
    <pre class="programlisting">ConfigurableBeanFactory factory = <span class="hl-keyword">new</span> XmlBeanFactory(...);

<span class="hl-comment">// now register any needed BeanPostProcessor instances</span>
MyBeanPostProcessor postProcessor = <span class="hl-keyword">new</span> MyBeanPostProcessor();
factory.addBeanPostProcessor(postProcessor);

<span class="hl-comment">// now start using the factory</span></pre> 
    <p>To explicitly register a <code class="literal">BeanFactoryPostProcessor</code> when using a <code class="literal">BeanFactory</code> implementation, you must write code like this:</p> 
    <pre class="programlisting">XmlBeanFactory factory = <span class="hl-keyword">new</span> XmlBeanFactory(<span class="hl-keyword">new</span> FileSystemResource(<span class="hl-string">&quot;beans.xml&quot;</span>));

<span class="hl-comment">// bring in some property values from a Properties file</span>
PropertyPlaceholderConfigurer cfg = <span class="hl-keyword">new</span> PropertyPlaceholderConfigurer();
cfg.setLocation(<span class="hl-keyword">new</span> FileSystemResource(<span class="hl-string">&quot;jdbc.properties&quot;</span>));

<span class="hl-comment">// now actually do the replacement</span>
cfg.postProcessBeanFactory(factory);</pre> 
    <p>In both cases, the explicit registration step is inconvenient, which is one reason why the various <code class="literal">ApplicationContext</code> implementations are preferred above plain <code class="literal">BeanFactory</code> implementations in the vast majority of Spring-backed applications, especially when using <code class="literal">BeanFactoryPostProcessors</code> and <code class="literal">BeanPostProcessors</code>. These mechanisms implement important functionality such as property placeholder replacement and AOP.</p> 
   </div> 
   <div class="section" title="4.17.2&nbsp;Glue code and the evil singleton">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-servicelocator"></a>4.17.2&nbsp;Glue code and the evil singleton</h3>
      </div>
     </div>
    </div> 
    <p>It is best to write most application code in a dependency-injection (DI) style, where that code is served out of a Spring IoC container, has its own dependencies supplied by the container when it is created, and is completely unaware of the container. However, for the small glue layers of code that are sometimes needed to tie other code together, you sometimes need a singleton (or quasi-singleton) style access to a Spring IoC container. For example, third-party code may try to construct new objects directly ( <code class="literal">Class.forName()</code> style), without the ability to get these objects out of a Spring IoC container.If the object constructed by the third-party code is a small stub or proxy, which then uses a singleton style access to a Spring IoC container to get a real object to delegate to, then inversion of control has still been achieved for the majority of the code (the object coming out of the container). Thus most code is still unaware of the container or how it is accessed, and remains decoupled from other code, with all ensuing benefits. EJBs may also use this stub/proxy approach to delegate to a plain Java implementation object, retrieved from a Spring IoC container. While the Spring IoC container itself ideally does not have to be a singleton, it may be unrealistic in terms of memory usage or initialization times (when using beans in the Spring IoC container such as a Hibernate <code class="literal">SessionFactory</code>) for each bean to use its own, non-singleton Spring IoC container.</p> 
    <p>Looking up the application context in a service locator style is sometimes the only option for accessing shared Spring-managed components, such as in an EJB 2.1 environment, or when you want to share a single ApplicationContext as a parent to WebApplicationContexts across WAR files. In this case you should look into using the utility class <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/context/access/ContextSingletonBeanFactoryLocator.html" target="_top"><code class="literal">ContextSingletonBeanFactoryLocator</code></a> locator that is described in this <a class="ulink" href="http://blog.springsource.com/2007/06/11/using-a-shared-parent-application-context-in-a-multi-war-spring-application/" target="_top">SpringSource team blog entry</a>.</p> 
   </div> 
  </div> 
  <div class="footnotes">
   <br />
   <hr width="100" align="left" />
   <div class="footnote">
    <p><sup>[<a name="ftn.d4e640" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#d4e640" class="simpara">1</a>] </sup>See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#background-ioc" title="Background">Background</a> </p>
   </div>
   <div class="footnote">
    <p><sup>[<a name="ftn.d4e1460" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#d4e1460" class="simpara">2</a>] </sup>See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-collaborators" title="4.4.1&nbsp;Dependency injection">Section&nbsp;4.4.1, Dependency injection</a></p>
   </div>
  </div>
 </div> 
 <div class="chapter" title="5.&nbsp;Resources">
  <div class="titlepage">
   <div>
    <div>
     <h2 class="title"><a name="resources"></a>5.&nbsp;Resources</h2>
    </div>
   </div>
  </div> 
  <div class="section" title="5.1&nbsp;Introduction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="resources-introduction"></a>5.1&nbsp;Introduction</h2>
     </div>
    </div>
   </div> 
   <p>Javas standard <code class="literal">java.net.URL</code> class and standard handlers for various URL prefixes unfortunately are not quite adequate enough for all access to low-level resources. For example, there is no standardized <code class="literal">URL</code> implementation that may be used to access a resource that needs to be obtained from the classpath, or relative to a <code class="literal">ServletContext</code>. While it is possible to register new handlers for specialized <code class="literal">URL</code> prefixes (similar to existing handlers for prefixes such as <code class="literal">http:</code>), this is generally quite complicated, and the <code class="literal">URL</code> interface still lacks some desirable functionality, such as a method to check for the existence of the resource being pointed to.</p> 
  </div> 
  <div class="section" title="5.2&nbsp;The Resource interface">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="resources-resource"></a>5.2&nbsp;The Resource interface</h2>
     </div>
    </div>
   </div> 
   <p>Springs <code class="literal">Resource</code> interface is meant to be a more capable interface for abstracting access to low-level resources.</p> 
   <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Resource <span class="hl-keyword">extends</span> InputStreamSource {

    <span class="hl-keyword">boolean</span> exists();

    <span class="hl-keyword">boolean</span> isOpen();

    URL getURL() <span class="hl-keyword">throws</span> IOException;

    File getFile() <span class="hl-keyword">throws</span> IOException;

    Resource createRelative(String relativePath) <span class="hl-keyword">throws</span> IOException;

    String getFilename();

    String getDescription();

}</pre> 
   <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> InputStreamSource {

    InputStream getInputStream() <span class="hl-keyword">throws</span> IOException;

}</pre> 
   <p>Some of the most important methods from the <code class="literal">Resource</code> interface are:</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem"> <code class="literal">getInputStream()</code>: locates and opens the resource, returning an <code class="literal">InputStream</code> for reading from the resource. It is expected that each invocation returns a fresh <code class="literal">InputStream</code>. It is the responsibility of the caller to close the stream. </li>
     <li class="listitem"> <code class="literal">exists()</code>: returns a <code class="literal">boolean</code> indicating whether this resource actually exists in physical form. </li>
     <li class="listitem"> <code class="literal">isOpen()</code>: returns a <code class="literal">boolean</code> indicating whether this resource represents a handle with an open stream. If <code class="literal">true</code>, the <code class="literal">InputStream</code> cannot be read multiple times, and must be read once only and then closed to avoid resource leaks. Will be <code class="literal">false</code> for all usual resource implementations, with the exception of <code class="literal">InputStreamResource</code>. </li>
     <li class="listitem"> <code class="literal">getDescription()</code>: returns a description for this resource, to be used for error output when working with the resource. This is often the fully qualified file name or the actual URL of the resource. </li>
    </ul>
   </div> 
   <p>Other methods allow you to obtain an actual <code class="literal">URL</code> or <code class="literal">File</code> object representing the resource (if the underlying implementation is compatible, and supports that functionality).</p> 
   <p>The <code class="literal">Resource</code> abstraction is used extensively in Spring itself, as an argument type in many method signatures when a resource is needed. Other methods in some Spring APIs (such as the constructors to various <code class="literal">ApplicationContext</code> implementations), take a <code class="literal">String</code> which in unadorned or simple form is used to create a <code class="literal">Resource</code> appropriate to that context implementation, or via special prefixes on the <code class="literal">String</code> path, allow the caller to specify that a specific <code class="literal">Resource</code> implementation must be created and used.</p> 
   <p>While the <code class="literal">Resource</code> interface is used a lot with Spring and by Spring, its actually very useful to use as a general utility class by itself in your own code, for access to resources, even when your code doesnt know or care about any other parts of Spring. While this couples your code to Spring, it really only couples it to this small set of utility classes, which are serving as a more capable replacement for <code class="literal">URL</code>, and can be considered equivalent to any other library you would use for this purpose.</p> 
   <p>It is important to note that the <code class="literal">Resource</code> abstraction does not replace functionality: it wraps it where possible. For example, a <code class="literal">UrlResource</code> wraps a URL, and uses the wrapped <code class="literal">URL</code> to do its work.</p> 
  </div> 
  <div class="section" title="5.3&nbsp;Built-in Resource implementations">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="resources-implementations"></a>5.3&nbsp;Built-in Resource implementations</h2>
     </div>
    </div>
   </div> 
   <p>There are a number of <code class="literal">Resource</code> implementations that come supplied straight out of the box in Spring:</p> 
   <div class="section" title="5.3.1&nbsp;UrlResource">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="resources-implementations-urlresource"></a>5.3.1&nbsp;UrlResource</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">UrlResource</code> wraps a <code class="literal">java.net.URL</code>, and may be used to access any object that is normally accessible via a URL, such as files, an HTTP target, an FTP target, etc. All URLs have a standardized <code class="literal">String</code> representation, such that appropriate standardized prefixes are used to indicate one URL type from another. This includes <code class="literal">file:</code> for accessing filesystem paths, <code class="literal">http:</code> for accessing resources via the HTTP protocol, <code class="literal">ftp:</code> for accessing resources via FTP, etc.</p> 
    <p>A <code class="literal">UrlResource</code> is created by Java code explicitly using the <code class="literal">UrlResource</code> constructor, but will often be created implicitly when you call an API method which takes a <code class="literal">String</code> argument which is meant to represent a path. For the latter case, a JavaBeans <code class="literal">PropertyEditor</code> will ultimately decide which type of <code class="literal">Resource</code> to create. If the path string contains a few well-known (to it, that is) prefixes such as <code class="literal">classpath:</code>, it will create an appropriate specialized <code class="literal">Resource</code> for that prefix. However, if it doesnt recognize the prefix, it will assume the this is just a standard URL string, and will create a <code class="literal">UrlResource</code>.</p> 
   </div> 
   <div class="section" title="5.3.2&nbsp;ClassPathResource">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="resources-implementations-classpathresource"></a>5.3.2&nbsp;ClassPathResource</h3>
      </div>
     </div>
    </div> 
    <p>This class represents a resource which should be obtained from the classpath. This uses either the thread context class loader, a given class loader, or a given class for loading resources.</p> 
    <p>This <code class="literal">Resource</code> implementation supports resolution as <code class="literal">java.io.File</code> if the class path resource resides in the file system, but not for classpath resources which reside in a jar and have not been expanded (by the servlet engine, or whatever the environment is) to the filesystem. To address this the various <code class="literal">Resource</code> implementations always support resolution as a <code class="literal">java.net.URL</code>.</p> 
    <p>A <code class="literal">ClassPathResource</code> is created by Java code explicitly using the <code class="literal">ClassPathResource</code> constructor, but will often be created implicitly when you call an API method which takes a <code class="literal">String</code> argument which is meant to represent a path. For the latter case, a JavaBeans <code class="literal">PropertyEditor</code> will recognize the special prefix <code class="literal">classpath:</code> on the string path, and create a <code class="literal">ClassPathResource</code> in that case.</p> 
   </div> 
   <div class="section" title="5.3.3&nbsp;FileSystemResource">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="resources-implementations-filesystemresource"></a>5.3.3&nbsp;FileSystemResource</h3>
      </div>
     </div>
    </div> 
    <p>This is a <code class="literal">Resource</code> implementation for <code class="literal">java.io.File</code> handles. It obviously supports resolution as a <code class="literal">File</code>, and as a <code class="literal">URL</code>.</p> 
   </div> 
   <div class="section" title="5.3.4&nbsp;ServletContextResource">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="resources-implementations-servletcontextresource"></a>5.3.4&nbsp;ServletContextResource</h3>
      </div>
     </div>
    </div> 
    <p>This is a <code class="literal">Resource</code> implementation for <code class="literal">ServletContext</code> resources, interpreting relative paths within the relevant web applications root directory.</p> 
    <p>This always supports stream access and URL access, but only allows <code class="literal">java.io.File</code> access when the web application archive is expanded and the resource is physically on the filesystem. Whether or not its expanded and on the filesystem like this, or accessed directly from the JAR or somewhere else like a DB (its conceivable) is actually dependent on the Servlet container.</p> 
   </div> 
   <div class="section" title="5.3.5&nbsp;InputStreamResource">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="resources-implementations-inputstreamresource"></a>5.3.5&nbsp;InputStreamResource</h3>
      </div>
     </div>
    </div> 
    <p>A <code class="literal">Resource</code> implementation for a given <code class="literal">InputStream</code>. This should only be used if no specific <code class="literal">Resource</code> implementation is applicable. In particular, prefer <code class="literal">ByteArrayResource</code> or any of the file-based <code class="literal">Resource</code> implementations where possible.</p> 
    <p>In contrast to other <code class="literal">Resource</code> implementations, this is a descriptor for an <span class="emphasis"><em>already</em></span> opened resource - therefore returning <code class="literal">true</code> from <code class="literal">isOpen()</code>. Do not use it if you need to keep the resource descriptor somewhere, or if you need to read a stream multiple times.</p> 
   </div> 
   <div class="section" title="5.3.6&nbsp;ByteArrayResource">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="resources-implementations-bytearrayresource"></a>5.3.6&nbsp;ByteArrayResource</h3>
      </div>
     </div>
    </div> 
    <p>This is a <code class="literal">Resource</code> implementation for a given byte array. It creates a <code class="literal">ByteArrayInputStream</code> for the given byte array.</p> 
    <p>Its useful for loading content from any given byte array, without having to resort to a single-use <code class="literal">InputStreamResource</code>.</p> 
   </div> 
  </div> 
  <div class="section" title="5.4&nbsp;The ResourceLoader">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="resources-resourceloader"></a>5.4&nbsp;The ResourceLoader</h2>
     </div>
    </div>
   </div> 
   <p>The <code class="literal">ResourceLoader</code> interface is meant to be implemented by objects that can return (i.e. load) <code class="literal">Resource</code> instances.</p> 
   <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ResourceLoader {

    Resource getResource(String location);

}</pre> 
   <p>All application contexts implement the <code class="literal">ResourceLoader</code> interface, and therefore all application contexts may be used to obtain <code class="literal">Resource</code> instances.</p> 
   <p>When you call <code class="literal">getResource()</code> on a specific application context, and the location path specified doesnt have a specific prefix, you will get back a <code class="literal">Resource</code> type that is appropriate to that particular application context. For example, assume the following snippet of code was executed against a <code class="literal">ClassPathXmlApplicationContext</code> instance:</p> 
   <pre class="programlisting">Resource template = ctx.getResource(<span class="hl-string">&quot;some/resource/path/myTemplate.txt&quot;</span>);</pre> 
   <p>What would be returned would be a <code class="literal">ClassPathResource</code>; if the same method was executed against a <code class="literal">FileSystemXmlApplicationContext</code> instance, youd get back a <code class="literal">FileSystemResource</code>. For a <code class="literal">WebApplicationContext</code>, youd get back a <code class="literal">ServletContextResource</code>, and so on.</p> 
   <p>As such, you can load resources in a fashion appropriate to the particular application context.</p> 
   <p>On the other hand, you may also force <code class="literal">ClassPathResource</code> to be used, regardless of the application context type, by specifying the special <code class="literal">classpath:</code> prefix:</p> 
   <pre class="programlisting">Resource template = ctx.getResource(<span class="hl-string">&quot;classpath:some/resource/path/myTemplate.txt&quot;</span>);</pre> 
   <p>Similarly, one can force a <code class="literal">UrlResource</code> to be used by specifying any of the standard <code class="literal">java.net.URL</code> prefixes:</p> 
   <pre class="programlisting">Resource template = ctx.getResource(<span class="hl-string">&quot;file:/some/resource/path/myTemplate.txt&quot;</span>);</pre> 
   <pre class="programlisting">Resource template = ctx.getResource(<span class="hl-string">&quot;http://myhost.com/resource/path/myTemplate.txt&quot;</span>);</pre> 
   <p>The following table summarizes the strategy for converting <code class="literal">String</code> s to <code class="literal">Resource</code> s:</p> 
   <div class="table">
    <a name="resources-resource-strings"></a>
    <p class="title"><b>Table&nbsp;5.1.&nbsp;Resource strings</b></p>
    <div class="table-contents"> 
     <table summary="Resource strings" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
      <colgroup>
       <col />
       <col />
       <col />
      </colgroup>
      <thead>
       <tr>
        <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Prefix</th>
        <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Example</th>
        <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explanation</th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>classpath:</p></td>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">classpath:com/myapp/config.xml</code></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Loaded from the classpath.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>file:</p></td>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">file:/data/config.xml</code></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Loaded as a <code class="literal">URL</code>, from the filesystem. <sup>[<a name="d4e4287" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#ftn.d4e4287" class="footnote">1</a>]</sup></p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>http:</p></td>
        <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal"><span><a class="smarterwiki-linkify" href="http://myserver/logo.png">http://myserver/logo.png</a></span></code></p></td>
        <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Loaded as a <code class="literal">URL</code>.</p></td>
       </tr>
       <tr>
        <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>(none)</p></td>
        <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">/data/config.xml</code></p></td>
        <td style="" align="left" valign="top"><p>Depends on the underlying <code class="literal">ApplicationContext</code>.</p></td>
       </tr>
      </tbody>
      <tbody class="footnotes">
       <tr>
        <td colspan="3">
         <div class="footnote">
          <p><sup>[<a name="ftn.d4e4287" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#d4e4287" class="simpara">1</a>] </sup>But see also <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#resources-filesystemresource-caveats" title="5.7.3&nbsp;FileSystemResource caveats">Section&nbsp;5.7.3, FileSystemResource caveats</a>.</p>
         </div></td>
       </tr>
      </tbody>
     </table> 
    </div>
   </div>
   <br class="table-break" /> 
  </div> 
  <div class="section" title="5.5&nbsp;The ResourceLoaderAware interface">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="resources-resourceloaderaware"></a>5.5&nbsp;The ResourceLoaderAware interface</h2>
     </div>
    </div>
   </div> 
   <p>The <code class="literal">ResourceLoaderAware</code> interface is a special marker interface, identifying objects that expect to be provided with a <code class="literal">ResourceLoader</code> reference.</p> 
   <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ResourceLoaderAware {

    <span class="hl-keyword">void</span> setResourceLoader(ResourceLoader resourceLoader);
}</pre> 
   <p>When a class implements <code class="literal">ResourceLoaderAware</code> and is deployed into an application context (as a Spring-managed bean), it is recognized as <code class="literal">ResourceLoaderAware</code> by the application context. The application context will then invoke the <code class="literal">setResourceLoader(ResourceLoader)</code>, supplying itself as the argument (remember, all application contexts in Spring implement the <code class="literal">ResourceLoader</code> interface).</p> 
   <p>Of course, since an <code class="literal">ApplicationContext</code> is a <code class="literal">ResourceLoader</code>, the bean could also implement the <code class="literal">ApplicationContextAware</code> interface and use the supplied application context directly to load resources, but in general, its better to use the specialized <code class="literal">ResourceLoader</code> interface if thats all thats needed. The code would just be coupled to the resource loading interface, which can be considered a utility interface, and not the whole Spring <code class="literal">ApplicationContext</code> interface.</p> 
   <p>As of Spring 2.5, you can rely upon autowiring of the <code class="literal">ResourceLoader</code> as an alternative to implementing the <code class="literal">ResourceLoaderAware</code> interface. The &quot;traditional&quot; <code class="literal">constructor</code> and <code class="literal">byType</code> autowiring modes (as described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-autowire" title="4.4.5&nbsp;Autowiring collaborators">Section&nbsp;4.4.5, Autowiring collaborators</a>) are now capable of providing a dependency of type <code class="literal">ResourceLoader</code> for either a constructor argument or setter method parameter respectively. For more flexibility (including the ability to autowire fields and multiple parameter methods), consider using the new annotation-based autowiring features. In that case, the <code class="literal">ResourceLoader</code> will be autowired into a field, constructor argument, or method parameter that is expecting the <code class="literal">ResourceLoader</code> type as long as the field, constructor, or method in question carries the <code class="literal">@Autowired</code> annotation. For more information, see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-autowired-annotation" title="4.9.2&nbsp;@Autowired">Section&nbsp;4.9.2, @Autowired</a>.</p> 
  </div> 
  <div class="section" title="5.6&nbsp;Resources as dependencies">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="resources-as-dependencies"></a>5.6&nbsp;Resources as dependencies</h2>
     </div>
    </div>
   </div> 
   <p>If the bean itself is going to determine and supply the resource path through some sort of dynamic process, it probably makes sense for the bean to use the <code class="literal">ResourceLoader</code> interface to load resources. Consider as an example the loading of a template of some sort, where the specific resource that is needed depends on the role of the user. If the resources are static, it makes sense to eliminate the use of the <code class="literal">ResourceLoader</code> interface completely, and just have the bean expose the <code class="literal">Resource</code> properties it needs, and expect that they will be injected into it.</p> 
   <p>What makes it trivial to then inject these properties, is that all application contexts register and use a special JavaBeans <code class="literal">PropertyEditor</code> which can convert <code class="literal">String</code> paths to <code class="literal">Resource</code> objects. So if <code class="literal">myBean</code> has a template property of type <code class="literal">Resource</code>, it can be configured with a simple string for that resource, as follows:</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;...&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;template&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;some/resource/path/myTemplate.txt&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   <p>Note that the resource path has no prefix, so because the application context itself is going to be used as the <code class="literal">ResourceLoader</code>, the resource itself will be loaded via a <code class="literal">ClassPathResource</code>, <code class="literal">FileSystemResource</code>, or <code class="literal">ServletContextResource</code> (as appropriate) depending on the exact type of the context.</p> 
   <p>If there is a need to force a specific <code class="literal">Resource</code> type to be used, then a prefix may be used. The following two examples show how to force a <code class="literal">ClassPathResource</code> and a <code class="literal">UrlResource</code> (the latter being used to access a filesystem file).</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;template&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;classpath:some/resource/path/myTemplate.txt&quot;</span><span class="hl-tag">&gt;</span></pre> 
   <pre class="programlisting"><span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;template&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;file:/some/resource/path/myTemplate.txt&quot;</span><span class="hl-tag">/&gt;</span></pre> 
  </div> 
  <div class="section" title="5.7&nbsp;Application contexts and Resource paths">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="resources-app-ctx"></a>5.7&nbsp;Application contexts and Resource paths</h2>
     </div>
    </div>
   </div> 
   <div class="section" title="5.7.1&nbsp;Constructing application contexts">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="resources-app-ctx-construction"></a>5.7.1&nbsp;Constructing application contexts</h3>
      </div>
     </div>
    </div> 
    <p>An application context constructor (for a specific application context type) generally takes a string or array of strings as the location path(s) of the resource(s) such as XML files that make up the definition of the context.</p> 
    <p>When such a location path doesnt have a prefix, the specific <code class="literal">Resource</code> type built from that path and used to load the bean definitions, depends on and is appropriate to the specific application context. For example, if you create a <code class="literal">ClassPathXmlApplicationContext</code> as follows:</p> 
    <pre class="programlisting">ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">&quot;conf/appContext.xml&quot;</span>);</pre> 
    <p>The bean definitions will be loaded from the classpath, as a <code class="literal">ClassPathResource</code> will be used. But if you create a <code class="literal">FileSystemXmlApplicationContext</code> as follows:</p> 
    <pre class="programlisting">ApplicationContext ctx =
    <span class="hl-keyword">new</span> FileSystemXmlApplicationContext(<span class="hl-string">&quot;conf/appContext.xml&quot;</span>);</pre> 
    <p>The bean definition will be loaded from a filesystem location, in this case relative to the current working directory.</p> 
    <p>Note that the use of the special classpath prefix or a standard URL prefix on the location path will override the default type of <code class="literal">Resource</code> created to load the definition. So this <code class="literal">FileSystemXmlApplicationContext</code></p> 
    <pre class="programlisting">ApplicationContext ctx =
    <span class="hl-keyword">new</span> FileSystemXmlApplicationContext(<span class="hl-string">&quot;classpath:conf/appContext.xml&quot;</span>);</pre> 
    <div class="orderedlist">
     <ol class="orderedlist" type="i">
      <li class="listitem"> will actually load its bean definitions from the classpath. However, it is still a <code class="literal">FileSystemXmlApplicationContext</code>. If it is subsequently used as a <code class="literal">ResourceLoader</code>, any unprefixed paths will still be treated as filesystem paths. </li>
     </ol>
    </div> 
    <div class="section" title="Constructing ClassPathXmlApplicationContext instances - shortcuts">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="resources-app-ctx-classpathxml"></a>Constructing ClassPathXmlApplicationContext instances - shortcuts</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">ClassPathXmlApplicationContext</code> exposes a number of constructors to enable convenient instantiation. The basic idea is that one supplies merely a string array containing just the filenames of the XML files themselves (without the leading path information), and one <span class="emphasis"><em>also</em></span> supplies a <code class="literal">Class</code>; the <code class="literal">ClassPathXmlApplicationContext</code> will derive the path information from the supplied class.</p> 
     <p>An example will hopefully make this clear. Consider a directory layout that looks like this:</p> 
     <pre class="literallayout">com/
  foo/
	services.xml
	daos.xml
    MessengerService.class</pre> 
     <p>A <code class="literal">ClassPathXmlApplicationContext</code> instance composed of the beans defined in the <code class="literal">'services.xml'</code> and <code class="literal">'daos.xml'</code> could be instantiated like so</p> 
     <pre class="programlisting">ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(
    <span class="hl-keyword">new</span> String[] {<span class="hl-string">&quot;services.xml&quot;</span>, <span class="hl-string">&quot;daos.xml&quot;</span>}, MessengerService.<span class="hl-keyword">class</span>);</pre> 
     <p>Please do consult the Javadocs for the <code class="literal">ClassPathXmlApplicationContext</code> class for details of the various constructors.</p> 
    </div> 
   </div> 
   <div class="section" title="5.7.2&nbsp;Wildcards in application context constructor resource paths">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="resources-app-ctx-wildcards-in-resource-paths"></a>5.7.2&nbsp;Wildcards in application context constructor resource paths</h3>
      </div>
     </div>
    </div> 
    <p>The resource paths in application context constructor values may be a simple path (as shown above) which has a one-to-one mapping to a target Resource, or alternately may contain the special &quot;classpath*:&quot; prefix and/or internal Ant-style regular expressions (matched using Springs <code class="literal">PathMatcher</code> utility). Both of the latter are effectively wildcards</p> 
    <p>One use for this mechanism is when doing component-style application assembly. All components can <span class="emphasis"><em>publish</em></span> context definition fragments to a well-known location path, and when the final application context is created using the same path prefixed via <code class="literal">classpath*:</code>, all component fragments will be picked up automatically.</p> 
    <p>Note that this wildcarding is specific to use of resource paths in application context constructors (or when using the <code class="literal">PathMatcher</code> utility class hierarchy directly), and is resolved at construction time. It has nothing to do with the <code class="literal">Resource</code> type itself. Its not possible to use the <code class="literal">classpath*:</code> prefix to construct an actual <code class="literal">Resource</code>, as a resource points to just one resource at a time.</p> 
    <div class="section" title="Ant-style Patterns">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="resources-app-ctx-ant-patterns-in-paths"></a>Ant-style Patterns</h4>
       </div>
      </div>
     </div> 
     <p>When the path location contains an Ant-style pattern, for example:</p> 
     <pre class="literallayout">/WEB-INF/<span class="strong"><strong>-context.xml com/mycompany/<span class="strong"><strong>/applicationContext.xml file:C:/some/path/</strong></span>-context.xml classpath:com/mycompany/</strong></span>/applicationContext.xml</pre> 
     <div class="orderedlist">
      <ol class="orderedlist" type="i">
       <li class="listitem"> the resolver follows a more complex but defined procedure to try to resolve the wildcard. It produces a Resource for the path up to the last non-wildcard segment and obtains a URL from it. If this URL is not a &quot;jar:&quot; URL or container-specific variant (e.g. &quot; <code class="literal">zip:</code>&quot; in WebLogic, &quot; <code class="literal">wsjar</code>&quot; in WebSphere, etc.), then a <code class="literal">java.io.File</code> is obtained from it and used to resolve the wildcard by traversing the filesystem. In the case of a jar URL, the resolver either gets a <code class="literal">java.net.JarURLConnection</code> from it or manually parses the jar URL and then traverses the contents of the jar file to resolve the wildcards. </li>
      </ol>
     </div> 
     <div class="section" title="Implications on portability">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="resources-app-ctx-portability"></a>Implications on portability</h5>
        </div>
       </div>
      </div> 
      <p>If the specified path is already a file URL (either explicitly, or implicitly because the base <code class="literal">ResourceLoader</code> is a filesystem one, then wildcarding is guaranteed to work in a completely portable fashion.</p> 
      <p>If the specified path is a classpath location, then the resolver must obtain the last non-wildcard path segment URL via a <code class="literal">Classloader.getResource()</code> call. Since this is just a node of the path (not the file at the end) it is actually undefined (in the <code class="literal">ClassLoader</code> Javadocs) exactly what sort of a URL is returned in this case. In practice, it is always a <code class="literal">java.io.File</code> representing the directory, where the classpath resource resolves to a filesystem location, or a jar URL of some sort, where the classpath resource resolves to a jar location. Still, there is a portability concern on this operation.</p> 
      <p>If a jar URL is obtained for the last non-wildcard segment, the resolver must be able to get a <code class="literal">java.net.JarURLConnection</code> from it, or manually parse the jar URL, to be able to walk the contents of the jar, and resolve the wildcard. This will work in most environments, but will fail in others, and it is strongly recommended that the wildcard resolution of resources coming from jars be thoroughly tested in your specific environment before you rely on it.</p> 
     </div> 
    </div> 
    <div class="section" title="The Classpath*: portability classpath*: prefix">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="resources-classpath-wildcards"></a>The Classpath*: portability classpath*: prefix</h4>
       </div>
      </div>
     </div> 
     <p>When constructing an XML-based application context, a location string may use the special <code class="literal">classpath*:</code> prefix:</p> 
     <pre class="programlisting">ApplicationContext ctx =
    <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">&quot;classpath*:conf/appContext.xml&quot;</span>);</pre> 
     <p>This special prefix specifies that all classpath resources that match the given name must be obtained (internally, this essentially happens via a <code class="literal">ClassLoader.getResources(...)</code> call), and then merged to form the final application context definition.</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>The wildcard classpath relies on the <code class="literal">getResources()</code> method of the underlying classloader. As most application servers nowadays supply their own classloader implementation, the behavior might differ especially when dealing with jar files. A simple test to check if <code class="literal">classpath*</code> works is to use the classloader to load a file from within a jar on the classpath: <code class="literal">getClass().getClassLoader().getResources(&quot;&lt;someFileInsideTheJar&gt;&quot;)</code>. Try this test with files that have the same name but are placed inside two different locations. In case an inappropriate result is returned, check the application server documentation for settings that might affect the classloader behavior.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <p>The &quot; <code class="literal">classpath*:</code>&quot; prefix can also be combined with a <code class="literal">PathMatcher</code> pattern in the rest of the location path, for example &quot; <code class="literal">classpath*:META-INF/*-beans.xml</code>&quot;. In this case, the resolution strategy is fairly simple: a ClassLoader.getResources() call is used on the last non-wildcard path segment to get all the matching resources in the class loader hierarchy, and then off each resource the same PathMatcher resolution strategy described above is used for the wildcard subpath.</p> 
    </div> 
    <div class="section" title="Other notes relating to wildcards">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="resources-wildcards-in-path-other-stuff"></a>Other notes relating to wildcards</h4>
       </div>
      </div>
     </div> 
     <p>Please note that &quot; <code class="literal">classpath*:</code>&quot; when combined with Ant-style patterns will only work reliably with at least one root directory before the pattern starts, unless the actual target files reside in the file system. This means that a pattern like &quot; <code class="literal">classpath*:*.xml</code>&quot; will not retrieve files from the root of jar files but rather only from the root of expanded directories. This originates from a limitation in the JDKs <code class="literal">ClassLoader.getResources()</code> method which only returns file system locations for a passed-in empty string (indicating potential roots to search).</p> 
     <p>Ant-style patterns with &quot; <code class="literal">classpath:</code>&quot; resources are not guaranteed to find matching resources if the root package to search is available in multiple class path locations. This is because a resource such as</p> 
     <pre class="literallayout">com/mycompany/package1/service-context.xml</pre> 
     <p>may be in only one location, but when a path such as</p> 
     <pre class="literallayout">classpath:com/mycompany/**/service-context.xml</pre> 
     <p>is used to try to resolve it, the resolver will work off the (first) URL returned by <code class="literal">getResource(&quot;com/mycompany&quot;)</code>;. If this base package node exists in multiple classloader locations, the actual end resource may not be underneath. Therefore, preferably, use &quot; <code class="literal">classpath*:</code>&quot; with the same Ant-style pattern in such a case, which will search all class path locations that contain the root package.</p> 
    </div> 
   </div> 
   <div class="section" title="5.7.3&nbsp;FileSystemResource caveats">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="resources-filesystemresource-caveats"></a>5.7.3&nbsp;FileSystemResource caveats</h3>
      </div>
     </div>
    </div> 
    <p>A <code class="literal">FileSystemResource</code> that is not attached to a <code class="literal">FileSystemApplicationContext</code> (that is, a <code class="literal">FileSystemApplicationContext</code> is not the actual <code class="literal">ResourceLoader</code>) will treat absolute vs. relative paths as you would expect. Relative paths are relative to the current working directory, while absolute paths are relative to the root of the filesystem.</p> 
    <p>For backwards compatibility (historical) reasons however, this changes when the <code class="literal">FileSystemApplicationContext</code> is the <code class="literal">ResourceLoader</code>. The <code class="literal">FileSystemApplicationContext</code> simply forces all attached <code class="literal">FileSystemResource</code> instances to treat all location paths as relative, whether they start with a leading slash or not. In practice, this means the following are equivalent:</p> 
    <pre class="programlisting">ApplicationContext ctx =
    <span class="hl-keyword">new</span> FileSystemXmlApplicationContext(<span class="hl-string">&quot;conf/context.xml&quot;</span>);</pre> 
    <pre class="programlisting">ApplicationContext ctx =
    <span class="hl-keyword">new</span> FileSystemXmlApplicationContext(<span class="hl-string">&quot;/conf/context.xml&quot;</span>);</pre> 
    <p>As are the following: (Even though it would make sense for them to be different, as one case is relative and the other absolute.)</p> 
    <pre class="programlisting">FileSystemXmlApplicationContext ctx = ...;
ctx.getResource(<span class="hl-string">&quot;some/resource/path/myTemplate.txt&quot;</span>);</pre> 
    <pre class="programlisting">FileSystemXmlApplicationContext ctx = ...;
ctx.getResource(<span class="hl-string">&quot;/some/resource/path/myTemplate.txt&quot;</span>);</pre> 
    <p>In practice, if true absolute filesystem paths are needed, it is better to forgo the use of absolute paths with <code class="literal">FileSystemResource</code> / <code class="literal">FileSystemXmlApplicationContext</code>, and just force the use of a <code class="literal">UrlResource</code>, by using the <code class="literal">file:</code> URL prefix.</p> 
    <pre class="programlisting"><span class="hl-comment">// actual context type doesn't matter, the Resource will always be UrlResource</span>
ctx.getResource(<span class="hl-string">&quot;file:/some/resource/path/myTemplate.txt&quot;</span>);</pre> 
    <pre class="programlisting"><span class="hl-comment">// force this FileSystemXmlApplicationContext to load its definition via a UrlResource</span>
ApplicationContext ctx =
    <span class="hl-keyword">new</span> FileSystemXmlApplicationContext(<span class="hl-string">&quot;file:/conf/context.xml&quot;</span>);</pre> 
   </div> 
  </div> 
 </div> 
 <div class="chapter" title="6.&nbsp;Validation, Data Binding, and Type Conversion">
  <div class="titlepage">
   <div>
    <div>
     <h2 class="title"><a name="validation"></a>6.&nbsp;Validation, Data Binding, and Type Conversion</h2>
    </div>
   </div>
  </div> 
  <div class="section" title="6.1&nbsp;Introduction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="validation-introduction"></a>6.1&nbsp;Introduction</h2>
     </div>
    </div>
   </div> 
   <div class="sidebar" title="JSR-303/JSR-349 Bean Validation">
    <p class="title"><b>JSR-303/JSR-349 Bean Validation</b></p> 
    <p>Spring Framework 4.0 supports Bean Validation 1.0 (JSR-303) and Bean Validation 1.1 (JSR-349) in terms of setup support, also adapting it to Springs <code class="literal">Validator</code> interface.</p> 
    <p>An application can choose to enable Bean Validation once globally, as described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#validation-beanvalidation" title="6.8&nbsp;Spring Validation">Section&nbsp;6.8, Spring Validation</a>, and use it exclusively for all validation needs.</p> 
    <p>An application can also register additional Spring <code class="literal">Validator</code> instances per <code class="literal">DataBinder</code> instance, as described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#validation-binder" title="6.8.3&nbsp;Configuring a DataBinder">Section&nbsp;6.8.3, Configuring a DataBinder</a>. This may be useful for plugging in validation logic without the use of annotations.</p> 
   </div> 
   <p>There are pros and cons for considering validation as business logic, and Spring offers a design for validation (and data binding) that does not exclude either one of them. Specifically validation should not be tied to the web tier, should be easy to localize and it should be possible to plug in any validator available. Considering the above, Spring has come up with a <code class="literal">Validator</code> interface that is both basic ands eminently usable in every layer of an application.</p> 
   <p>Data binding is useful for allowing user input to be dynamically bound to the domain model of an application (or whatever objects you use to process user input). Spring provides the so-called <code class="literal">DataBinder</code> to do exactly that. The <code class="literal">Validator</code> and the <code class="literal">DataBinder</code> make up the <code class="literal">validation</code> package, which is primarily used in but not limited to the MVC framework.</p> 
   <p>The <code class="literal">BeanWrapper</code> is a fundamental concept in the Spring Framework and is used in a lot of places. However, you probably will not have the need to use the <code class="literal">BeanWrapper</code> directly. Because this is reference documentation however, we felt that some explanation might be in order. We will explain the <code class="literal">BeanWrapper</code> in this chapter since, if you were going to use it at all, you would most likely do so when trying to bind data to objects.</p> 
   <p>Springs DataBinder and the lower-level BeanWrapper both use PropertyEditors to parse and format property values. The <code class="literal">PropertyEditor</code> concept is part of the JavaBeans specification, and is also explained in this chapter. Spring 3 introduces a &quot;core.convert&quot; package that provides a general type conversion facility, as well as a higher-level &quot;format&quot; package for formatting UI field values. These new packages may be used as simpler alternatives to PropertyEditors, and will also be discussed in this chapter.</p> 
  </div> 
  <div class="section" title="6.2&nbsp;Validation using Springs Validator interface">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="validator"></a>6.2&nbsp;Validation using Springs Validator interface</h2>
     </div>
    </div>
   </div> 
   <p>Spring features a <code class="literal">Validator</code> interface that you can use to validate objects. The <code class="literal">Validator</code> interface works using an <code class="literal">Errors</code> object so that while validating, validators can report validation failures to the <code class="literal">Errors</code> object.</p> 
   <p>Lets consider a small data object:</p> 
   <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Person {

    <span class="hl-keyword">private</span> String name;
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> age;

    <span class="hl-comment">// the usual getters and setters...</span>
}</pre> 
   <p>Were going to provide validation behavior for the <code class="literal">Person</code> class by implementing the following two methods of the <code class="literal">org.springframework.validation.Validator</code> interface:</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem"> <code class="literal">supports(Class)</code> - Can this <code class="literal">Validator</code> validate instances of the supplied <code class="literal">Class</code>? </li>
     <li class="listitem"> <code class="literal">validate(Object, org.springframework.validation.Errors)</code> - validates the given object and in case of validation errors, registers those with the given <code class="literal">Errors</code> object </li>
    </ul>
   </div> 
   <p>Implementing a <code class="literal">Validator</code> is fairly straightforward, especially when you know of the <code class="literal">ValidationUtils</code> helper class that the Spring Framework also provides.</p> 
   <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PersonValidator <span class="hl-keyword">implements</span> Validator {

    /<span class="strong"><strong>* * This Validator validates *just</strong></span> Person instances
     */
    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> supports(Class clazz) {
        <span class="hl-keyword">return</span> Person.<span class="hl-keyword">class</span>.equals(clazz);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validate(Object obj, Errors e) {
        ValidationUtils.rejectIfEmpty(e, <span class="hl-string">&quot;name&quot;</span>, <span class="hl-string">&quot;name.empty&quot;</span>);
        Person p = (Person) obj;
        <span class="hl-keyword">if</span> (p.getAge() &lt; <span class="hl-number">0</span>) {
            e.rejectValue(<span class="hl-string">&quot;age&quot;</span>, <span class="hl-string">&quot;negativevalue&quot;</span>);
        } <span class="hl-keyword">else</span> <span class="hl-keyword">if</span> (p.getAge() &gt; <span class="hl-number">110</span>) {
            e.rejectValue(<span class="hl-string">&quot;age&quot;</span>, <span class="hl-string">&quot;too.darn.old&quot;</span>);
        }
    }
}</pre> 
   <p>As you can see, the <code class="literal">static</code> <code class="literal">rejectIfEmpty(..)</code> method on the <code class="literal">ValidationUtils</code> class is used to reject the <code class="literal">'name'</code> property if it is <code class="literal">null</code> or the empty string. Have a look at the Javadoc for the <code class="literal">ValidationUtils</code> class to see what functionality it provides besides the example shown previously.</p> 
   <p>While it is certainly possible to implement a single <code class="literal">Validator</code> class to validate each of the nested objects in a rich object, it may be better to encapsulate the validation logic for each nested class of object in its own <code class="literal">Validator</code> implementation. A simple example of a <span class="emphasis"><em>'rich'</em></span> object would be a <code class="literal">Customer</code> that is composed of two <code class="literal">String</code> properties (a first and second name) and a complex <code class="literal">Address</code> object. <code class="literal">Address</code> objects may be used independently of <code class="literal">Customer</code> objects, and so a distinct <code class="literal">AddressValidator</code> has been implemented. If you want your <code class="literal">CustomerValidator</code> to reuse the logic contained within the <code class="literal">AddressValidator</code> class without resorting to copy-and-paste, you can dependency-inject or instantiate an <code class="literal">AddressValidator</code> within your <code class="literal">CustomerValidator</code>, and use it like so:</p> 
   <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CustomerValidator <span class="hl-keyword">implements</span> Validator {

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> Validator addressValidator;

    <span class="hl-keyword">public</span> CustomerValidator(Validator addressValidator) {
        <span class="hl-keyword">if</span> (addressValidator == null) {
            <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> IllegalArgumentException(<span class="hl-string">&quot;The supplied [Validator] is &quot;</span> +
                <span class="hl-string">&quot;required and must not be null.&quot;</span>);
        }
        <span class="hl-keyword">if</span> (!addressValidator.supports(Address.<span class="hl-keyword">class</span>)) {
            <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> IllegalArgumentException(<span class="hl-string">&quot;The supplied [Validator] must &quot;</span> +
                support the validation of [Address] instances.<span class="hl-string">&quot;);
</span>        }
        <span class="hl-keyword">this</span>.addressValidator = addressValidator;
    }

    <b class="hl-tag" style="color: blue">/**
     * This Validator validates Customer instances, and any subclasses of Customer too
     */</b>
    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> supports(Class clazz) {
        <span class="hl-keyword">return</span> Customer.<span class="hl-keyword">class</span>.isAssignableFrom(clazz);
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validate(Object target, Errors errors) {
        ValidationUtils.rejectIfEmptyOrWhitespace(errors, <span class="hl-string">&quot;firstName&quot;</span>, <span class="hl-string">&quot;field.required&quot;</span>);
        ValidationUtils.rejectIfEmptyOrWhitespace(errors, <span class="hl-string">&quot;surname&quot;</span>, <span class="hl-string">&quot;field.required&quot;</span>);
        Customer customer = (Customer) target;
        <span class="hl-keyword">try</span> {
            errors.pushNestedPath(<span class="hl-string">&quot;address&quot;</span>);
            ValidationUtils.invokeValidator(<span class="hl-keyword">this</span>.addressValidator, customer.getAddress(), errors);
        } <span class="hl-keyword">finally</span> {
            errors.popNestedPath();
        }
    }
}</pre> 
   <p>Validation errors are reported to the <code class="literal">Errors</code> object passed to the validator. In case of Spring Web MVC you can use <code class="literal">&lt;spring:bind/&gt;</code> tag to inspect the error messages, but of course you can also inspect the errors object yourself. More information about the methods it offers can be found from the Javadoc.</p> 
  </div> 
  <div class="section" title="6.3&nbsp;Resolving codes to error messages">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="validation-conversion"></a>6.3&nbsp;Resolving codes to error messages</h2>
     </div>
    </div>
   </div> 
   <p>Weve talked about databinding and validation. Outputting messages corresponding to validation errors is the last thing we need to discuss. In the example weve shown above, we rejected the <code class="literal">name</code> and the <code class="literal">age</code> field. If were going to output the error messages by using a <code class="literal">MessageSource</code>, we will do so using the error code weve given when rejecting the field (<span class="emphasis"><em>name</em></span> and <span class="emphasis"><em>age</em></span> in this case). When you call (either directly, or indirectly, using for example the <code class="literal">ValidationUtils</code> class) <code class="literal">rejectValue</code> or one of the other <code class="literal">reject</code> methods from the <code class="literal">Errors</code> interface, the underlying implementation will not only register the code youve passed in, but also a number of additional error codes. What error codes it registers is determined by the <code class="literal">MessageCodesResolver</code> that is used. By default, the <code class="literal">DefaultMessageCodesResolver</code> is used, which for example not only registers a message with the code you gave, but also messages that include the field name you passed to the reject method. So in case you reject a field using <code class="literal">rejectValue(&quot;age&quot;, &quot;too.darn.old&quot;)</code>, apart from the <code class="literal">too.darn.old</code> code, Spring will also register <code class="literal">too.darn.old.age</code> and <code class="literal">too.darn.old.age.int</code> (so the first will include the field name and the second will include the type of the field); this is done as a convenience to aid developers in targeting error messages and suchlike.</p> 
   <p>More information on the <code class="literal">MessageCodesResolver</code> and the default strategy can be found online with the Javadocs for <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/validation/MessageCodesResolver.html" target="_top"><code class="literal">MessageCodesResolver</code></a> and <a class="ulink" href="http://docs.spring.io/spring/docs/current/javadoc-api/org/springframework/validation/DefaultMessageCodesResolver.html" target="_top"><code class="literal">DefaultMessageCodesResolver</code></a> respectively.</p> 
  </div> 
  <div class="section" title="6.4&nbsp;Bean manipulation and the BeanWrapper">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="beans-beans"></a>6.4&nbsp;Bean manipulation and the BeanWrapper</h2>
     </div>
    </div>
   </div> 
   <p>The <code class="literal">org.springframework.beans</code> package adheres to the JavaBeans standard provided by Oracle. A JavaBean is simply a class with a default no-argument constructor, which follows a naming convention where (by way of an example) a property named <code class="literal">bingoMadness</code> would have a setter method <code class="literal">setBingoMadness(..)</code> and a getter method <code class="literal">getBingoMadness()</code>. For more information about JavaBeans and the specification, please refer to Oracles website ( <a class="ulink" href="http://docs.oracle.com/javase/6/docs/api/java/beans/package-summary.html" target="_top">javabeans</a>).</p> 
   <p>One quite important class in the beans package is the <code class="literal">BeanWrapper</code> interface and its corresponding implementation ( <code class="literal">BeanWrapperImpl</code>). As quoted from the Javadoc, the <code class="literal">BeanWrapper</code> offers functionality to set and get property values (individually or in bulk), get property descriptors, and to query properties to determine if they are readable or writable. Also, the <code class="literal">BeanWrapper</code> offers support for nested properties, enabling the setting of properties on sub-properties to an unlimited depth. Then, the <code class="literal">BeanWrapper</code> supports the ability to add standard JavaBeans <code class="literal">PropertyChangeListeners</code> and <code class="literal">VetoableChangeListeners</code>, without the need for supporting code in the target class. Last but not least, the <code class="literal">BeanWrapper</code> provides support for the setting of indexed properties. The <code class="literal">BeanWrapper</code> usually isnt used by application code directly, but by the <code class="literal">DataBinder</code> and the <code class="literal">BeanFactory</code>.</p> 
   <p>The way the <code class="literal">BeanWrapper</code> works is partly indicated by its name: <span class="emphasis"><em>it wraps a bean</em></span> to perform actions on that bean, like setting and retrieving properties.</p> 
   <div class="section" title="6.4.1&nbsp;Setting and getting basic and nested properties">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-beans-conventions"></a>6.4.1&nbsp;Setting and getting basic and nested properties</h3>
      </div>
     </div>
    </div> 
    <p>Setting and getting properties is done using the <code class="literal">setPropertyValue(s)</code> and <code class="literal">getPropertyValue(s)</code> methods that both come with a couple of overloaded variants. Theyre all described in more detail in the Javadoc Spring comes with. Whats important to know is that there are a couple of conventions for indicating properties of an object. A couple of examples:</p> 
    <div class="table">
     <a name="beans-beans-conventions-properties-tbl"></a>
     <p class="title"><b>Table&nbsp;6.1.&nbsp;Examples of properties</b></p>
     <div class="table-contents"> 
      <table summary="Examples of properties" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
       <colgroup>
        <col />
        <col />
       </colgroup>
       <thead>
        <tr>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Expression</th>
         <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explanation</th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">name</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Indicates the property <code class="literal">name</code> corresponding to the methods <code class="literal">getName()</code> or <code class="literal">isName()</code> and <code class="literal">setName(..)</code></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">account.name</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Indicates the nested property <code class="literal">name</code> of the property <code class="literal">account</code> corresponding e.g. to the methods <code class="literal">getAccount().setName()</code> or <code class="literal">getAccount().getName()</code></p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">account[2]</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Indicates the <span class="emphasis"><em>third</em></span> element of the indexed property <code class="literal">account</code>. Indexed properties can be of type <code class="literal">array</code>, <code class="literal">list</code> or other <span class="emphasis"><em>naturally ordered</em></span> collection</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">account[COMPANYNAME]</code></p></td>
         <td style="" align="left" valign="top"><p>Indicates the value of the map entry indexed by the key <span class="emphasis"><em>COMPANYNAME</em></span> of the Map property <code class="literal">account</code></p></td>
        </tr>
       </tbody>
      </table> 
     </div>
    </div>
    <br class="table-break" /> 
    <p>Below youll find some examples of working with the <code class="literal">BeanWrapper</code> to get and set properties.</p> 
    <p><span class="emphasis"><em>(This next section is not vitally important to you if youre not planning to work with the <code class="literal">BeanWrapper</code> directly. If youre just using the <code class="literal">DataBinder</code> and the <code class="literal">BeanFactory</code> and their out-of-the-box implementation, you should skip ahead to the section about <code class="literal">PropertyEditors</code>.)</em></span></p> 
    <p>Consider the following two classes:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Company {

    <span class="hl-keyword">private</span> String name;
    <span class="hl-keyword">private</span> Employee managingDirector;

    <span class="hl-keyword">public</span> String getName() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.name;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(String name) {
        <span class="hl-keyword">this</span>.name = name;
    }

    <span class="hl-keyword">public</span> Employee getManagingDirector() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.managingDirector;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setManagingDirector(Employee managingDirector) {
        <span class="hl-keyword">this</span>.managingDirector = managingDirector;
    }
}</pre> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Employee {

    <span class="hl-keyword">private</span> String name;

    <span class="hl-keyword">private</span> <span class="hl-keyword">float</span> salary;

    <span class="hl-keyword">public</span> String getName() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.name;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(String name) {
        <span class="hl-keyword">this</span>.name = name;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">float</span> getSalary() {
        <span class="hl-keyword">return</span> salary;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setSalary(<span class="hl-keyword">float</span> salary) {
        <span class="hl-keyword">this</span>.salary = salary;
    }
}</pre> 
    <p>The following code snippets show some examples of how to retrieve and manipulate some of the properties of instantiated <code class="literal">Companies</code> and <code class="literal">Employees</code>:</p> 
    <pre class="programlisting">BeanWrapper company = BeanWrapperImpl(<span class="hl-keyword">new</span> Company());
<span class="hl-comment">// setting the company name..</span>
company.setPropertyValue(<span class="hl-string">&quot;name&quot;</span>, <span class="hl-string">&quot;Some Company Inc.&quot;</span>);
<span class="hl-comment">// ... can also be done like this:</span>
PropertyValue value = <span class="hl-keyword">new</span> PropertyValue(<span class="hl-string">&quot;name&quot;</span>, <span class="hl-string">&quot;Some Company Inc.&quot;</span>);
company.setPropertyValue(value);

<span class="hl-comment">// ok, let's create the director and tie it to the company:</span>
BeanWrapper jim = BeanWrapperImpl(<span class="hl-keyword">new</span> Employee());
jim.setPropertyValue(<span class="hl-string">&quot;name&quot;</span>, <span class="hl-string">&quot;Jim Stravinsky&quot;</span>);
company.setPropertyValue(<span class="hl-string">&quot;managingDirector&quot;</span>, jim.getWrappedInstance());

<span class="hl-comment">// retrieving the salary of the managingDirector through the company</span>
Float salary = (Float) company.getPropertyValue(<span class="hl-string">&quot;managingDirector.salary&quot;</span>);</pre> 
   </div> 
   <div class="section" title="6.4.2&nbsp;Built-in PropertyEditor implementations">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="beans-beans-conversion"></a>6.4.2&nbsp;Built-in PropertyEditor implementations</h3>
      </div>
     </div>
    </div> 
    <p>Spring uses the concept of <code class="literal">PropertyEditors</code> to effect the conversion between an <code class="literal">Object</code> and a <code class="literal">String</code>. If you think about it, it sometimes might be handy to be able to represent properties in a different way than the object itself. For example, a <code class="literal">Date</code> can be represented in a human readable way (as the <code class="literal">String</code> ' <code class="literal">2007-14-09</code>'), while were still able to convert the human readable form back to the original date (or even better: convert any date entered in a human readable form, back to <code class="literal">Date</code> objects). This behavior can be achieved by <span class="emphasis"><em>registering custom editors</em></span>, of type <code class="literal">java.beans.PropertyEditor</code>. Registering custom editors on a <code class="literal">BeanWrapper</code> or alternately in a specific IoC container as mentioned in the previous chapter, gives it the knowledge of how to convert properties to the desired type. Read more about <code class="literal">PropertyEditors</code> in the Javadoc of the <code class="literal">java.beans</code> package provided by Oracle.</p> 
    <p>A couple of examples where property editing is used in Spring:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> <span class="emphasis"><em>setting properties on beans</em></span> is done using <code class="literal">PropertyEditors</code>. When mentioning <code class="literal">java.lang.String</code> as the value of a property of some bean youre declaring in XML file, Spring will (if the setter of the corresponding property has a <code class="literal">Class</code>-parameter) use the <code class="literal">ClassEditor</code> to try to resolve the parameter to a <code class="literal">Class</code> object. </li>
      <li class="listitem"> <span class="emphasis"><em>parsing HTTP request parameters</em></span> in Springs MVC framework is done using all kinds of <code class="literal">PropertyEditors</code> that you can manually bind in all subclasses of the <code class="literal">CommandController</code>. </li>
     </ul>
    </div> 
    <p>Spring has a number of built-in <code class="literal">PropertyEditors</code> to make life easy. Each of those is listed below and they are all located in the <code class="literal">org.springframework.beans.propertyeditors</code> package. Most, but not all (as indicated below), are registered by default by <code class="literal">BeanWrapperImpl</code>. Where the property editor is configurable in some fashion, you can of course still register your own variant to override the default one:</p> 
    <div class="table">
     <a name="beans-beans-property-editors-tbl"></a>
     <p class="title"><b>Table&nbsp;6.2.&nbsp;Built-in PropertyEditors</b></p>
     <div class="table-contents"> 
      <table summary="Built-in PropertyEditors" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
       <colgroup>
        <col />
        <col />
       </colgroup>
       <thead>
        <tr>
         <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Class</th>
         <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explanation</th>
        </tr>
       </thead>
       <tbody>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ByteArrayPropertyEditor</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Editor for byte arrays. Strings will simply be converted to their corresponding byte representations. Registered by default by <code class="literal">BeanWrapperImpl</code>.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ClassEditor</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Parses Strings representing classes to actual classes and the other way around. When a class is not found, an <code class="literal">IllegalArgumentException</code> is thrown. Registered by default by <code class="literal">BeanWrapperImpl</code>.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">CustomBooleanEditor</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Customizable property editor for <code class="literal">Boolean</code> properties. Registered by default by <code class="literal">BeanWrapperImpl</code>, but, can be overridden by registering custom instance of it as custom editor.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">CustomCollectionEditor</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Property editor for Collections, converting any source <code class="literal">Collection</code> to a given target <code class="literal">Collection</code> type.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">CustomDateEditor</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Customizable property editor for java.util.Date, supporting a custom DateFormat. NOT registered by default. Must be user registered as needed with appropriate format.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">CustomNumberEditor</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Customizable property editor for any Number subclass like <code class="literal">Integer</code>, <code class="literal">Long</code>, <code class="literal">Float</code>, <code class="literal">Double</code>. Registered by default by <code class="literal">BeanWrapperImpl</code>, but can be overridden by registering custom instance of it as a custom editor.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">FileEditor</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Capable of resolving Strings to <code class="literal">java.io.File</code> objects. Registered by default by <code class="literal">BeanWrapperImpl</code>.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">InputStreamEditor</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>One-way property editor, capable of taking a text string and producing (via an intermediate <code class="literal">ResourceEditor</code> and <code class="literal">Resource</code>) an <code class="literal">InputStream</code>, so <code class="literal">InputStream</code> properties may be directly set as Strings. Note that the default usage will not close the <code class="literal">InputStream</code> for you! Registered by default by <code class="literal">BeanWrapperImpl</code>.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">LocaleEditor</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Capable of resolving Strings to <code class="literal">Locale</code> objects and vice versa (the String format is <span class="emphasis"><em><span class="language">[country]</span></em></span>[variant], which is the same thing the toString() method of Locale provides). Registered by default by <code class="literal">BeanWrapperImpl</code>.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PatternEditor</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Capable of resolving Strings to JDK 1.5 <code class="literal">Pattern</code> objects and vice versa.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">PropertiesEditor</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Capable of converting Strings (formatted using the format as defined in the Javadoc for the java.lang.Properties class) to <code class="literal">Properties</code> objects. Registered by default by <code class="literal">BeanWrapperImpl</code>.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">StringTrimmerEditor</code></p></td>
         <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Property editor that trims Strings. Optionally allows transforming an empty string into a <code class="literal">null</code> value. NOT registered by default; must be user registered as needed.</p></td>
        </tr>
        <tr>
         <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">URLEditor</code></p></td>
         <td style="" align="left" valign="top"><p>Capable of resolving a String representation of a URL to an actual <code class="literal">URL</code> object. Registered by default by <code class="literal">BeanWrapperImpl</code>.</p></td>
        </tr>
       </tbody>
      </table> 
     </div>
    </div>
    <br class="table-break" /> 
    <p>Spring uses the <code class="literal">java.beans.PropertyEditorManager</code> to set the search path for property editors that might be needed. The search path also includes <code class="literal">sun.bean.editors</code>, which includes <code class="literal">PropertyEditor</code> implementations for types such as <code class="literal">Font</code>, <code class="literal">Color</code>, and most of the primitive types. Note also that the standard JavaBeans infrastructure will automatically discover <code class="literal">PropertyEditor</code> classes (without you having to register them explicitly) if they are in the same package as the class they handle, and have the same name as that class, with <code class="literal">'Editor'</code> appended; for example, one could have the following class and package structure, which would be sufficient for the <code class="literal">FooEditor</code> class to be recognized and used as the <code class="literal">PropertyEditor</code> for <code class="literal">Foo</code>-typed properties.</p> 
    <pre class="literallayout">com
  chank
    pop
      Foo
      FooEditor // the PropertyEditor for the Foo class</pre> 
    <p>Note that you can also use the standard <code class="literal">BeanInfo</code> JavaBeans mechanism here as well (described <a class="ulink" href="http://docs.oracle.com/javase/tutorial/javabeans/advanced/customization.html" target="_top">in not-amazing-detail here</a>). Find below an example of using the <code class="literal">BeanInfo</code> mechanism for explicitly registering one or more <code class="literal">PropertyEditor</code> instances with the properties of an associated class.</p> 
    <pre class="literallayout">com
  chank
    pop
      Foo
      FooBeanInfo // the BeanInfo for the Foo class</pre> 
    <p>Here is the Java source code for the referenced <code class="literal">FooBeanInfo</code> class. This would associate a <code class="literal">CustomNumberEditor</code> with the <code class="literal">age</code> property of the <code class="literal">Foo</code> class.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FooBeanInfo <span class="hl-keyword">extends</span> SimpleBeanInfo {

    <span class="hl-keyword">public</span> PropertyDescriptor[] getPropertyDescriptors() {
        <span class="hl-keyword">try</span> {
            <span class="hl-keyword">final</span> PropertyEditor numberPE = <span class="hl-keyword">new</span> CustomNumberEditor(Integer.<span class="hl-keyword">class</span>, true);
            PropertyDescriptor ageDescriptor = <span class="hl-keyword">new</span> PropertyDescriptor(<span class="hl-string">&quot;age&quot;</span>, Foo.<span class="hl-keyword">class</span>) {
                <span class="hl-keyword">public</span> PropertyEditor createPropertyEditor(Object bean) {
                    <span class="hl-keyword">return</span> numberPE;
                };
            };
            <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> PropertyDescriptor[] { ageDescriptor };
        }
        <span class="hl-keyword">catch</span> (IntrospectionException ex) {
            <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> Error(ex.toString());
        }
    }
}</pre> 
    <div class="section" title="Registering additional custom PropertyEditors">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="beans-beans-conversion-customeditor-registration"></a>Registering additional custom PropertyEditors</h4>
       </div>
      </div>
     </div> 
     <p>When setting bean properties as a string value, a Spring IoC container ultimately uses standard JavaBeans <code class="literal">PropertyEditors</code> to convert these Strings to the complex type of the property. Spring pre-registers a number of custom <code class="literal">PropertyEditors</code> (for example, to convert a classname expressed as a string into a real <code class="literal">Class</code> object). Additionally, Javas standard JavaBeans <code class="literal">PropertyEditor</code> lookup mechanism allows a <code class="literal">PropertyEditor</code> for a class simply to be named appropriately and placed in the same package as the class it provides support for, to be found automatically.</p> 
     <p>If there is a need to register other custom <code class="literal">PropertyEditors</code>, there are several mechanisms available. The most manual approach, which is not normally convenient or recommended, is to simply use the <code class="literal">registerCustomEditor()</code> method of the <code class="literal">ConfigurableBeanFactory</code> interface, assuming you have a <code class="literal">BeanFactory</code> reference. Another, slightly more convenient, mechanism is to use a special bean factory post-processor called <code class="literal">CustomEditorConfigurer</code>. Although bean factory post-processors can be used with <code class="literal">BeanFactory</code> implementations, the <code class="literal">CustomEditorConfigurer</code> has a nested property setup, so it is strongly recommended that it is used with the <code class="literal">ApplicationContext</code>, where it may be deployed in similar fashion to any other bean, and automatically detected and applied.</p> 
     <p>Note that all bean factories and application contexts automatically use a number of built-in property editors, through their use of something called a <code class="literal">BeanWrapper</code> to handle property conversions. The standard property editors that the <code class="literal">BeanWrapper</code> registers are listed in <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-beans-conversion" title="6.4.2&nbsp;Built-in PropertyEditor implementations">the previous section</a>. Additionally, <code class="literal">ApplicationContexts</code> also override or add an additional number of editors to handle resource lookups in a manner appropriate to the specific application context type.</p> 
     <p>Standard JavaBeans <code class="literal">PropertyEditor</code> instances are used to convert property values expressed as strings to the actual complex type of the property. <code class="literal">CustomEditorConfigurer</code>, a bean factory post-processor, may be used to conveniently add support for additional <code class="literal">PropertyEditor</code> instances to an <code class="literal">ApplicationContext</code>.</p> 
     <p>Consider a user class <code class="literal">ExoticType</code>, and another class <code class="literal">DependsOnExoticType</code> which needs <code class="literal">ExoticType</code> set as a property:</p> 
     <pre class="programlisting"><span class="hl-keyword">package</span> example;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExoticType {

    <span class="hl-keyword">private</span> String name;

    <span class="hl-keyword">public</span> ExoticType(String name) {
        <span class="hl-keyword">this</span>.name = name;
    }
}

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DependsOnExoticType {

    <span class="hl-keyword">private</span> ExoticType type;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setType(ExoticType type) {
        <span class="hl-keyword">this</span>.type = type;
    }
}</pre> 
     <p>When things are properly set up, we want to be able to assign the type property as a string, which a <code class="literal">PropertyEditor</code> will behind the scenes convert into an actual <code class="literal">ExoticType</code> instance:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;sample&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.DependsOnExoticType&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;type&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;aNameForExoticType&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
     <p>The <code class="literal">PropertyEditor</code> implementation could look similar to this:</p> 
     <pre class="programlisting"><span class="hl-comment">// converts string representation to ExoticType object</span>
<span class="hl-keyword">package</span> example;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExoticTypeEditor <span class="hl-keyword">extends</span> PropertyEditorSupport {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setAsText(String text) {
        setValue(<span class="hl-keyword">new</span> ExoticType(text.toUpperCase()));
    }
}</pre> 
     <p>Finally, we use <code class="literal">CustomEditorConfigurer</code> to register the new <code class="literal">PropertyEditor</code> with the <code class="literal">ApplicationContext</code>, which will then be able to use it as needed:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.beans.factory.config.CustomEditorConfigurer&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;customEditors&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;map&gt;</span>
            <span class="hl-tag">&lt;entry</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;example.ExoticType&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;example.ExoticTypeEditor&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/map&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
     <div class="section" title="Using PropertyEditorRegistrars">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="beans-beans-conversion-customeditor-registration-per"></a>Using PropertyEditorRegistrars</h5>
        </div>
       </div>
      </div> 
      <p>Another mechanism for registering property editors with the Spring container is to create and use a <code class="literal">PropertyEditorRegistrar</code>. This interface is particularly useful when you need to use the same set of property editors in several different situations: write a corresponding registrar and reuse that in each case. <code class="literal">PropertyEditorRegistrars</code> work in conjunction with an interface called <code class="literal">PropertyEditorRegistry</code>, an interface that is implemented by the Spring <code class="literal">BeanWrapper</code> (and <code class="literal">DataBinder</code>). <code class="literal">PropertyEditorRegistrars</code> are particularly convenient when used in conjunction with the <code class="literal">CustomEditorConfigurer</code> (introduced <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-beans-conversion-customeditor-registration" title="Registering additional custom PropertyEditors">here</a>), which exposes a property called <code class="literal">setPropertyEditorRegistrars(..)</code>: <code class="literal">PropertyEditorRegistrars</code> added to a <code class="literal">CustomEditorConfigurer</code> in this fashion can easily be shared with <code class="literal">DataBinder</code> and Spring MVC <code class="literal">Controllers</code>. Furthermore, it avoids the need for synchronization on custom editors: a <code class="literal">PropertyEditorRegistrar</code> is expected to create fresh <code class="literal">PropertyEditor</code> instances for each bean creation attempt.</p> 
      <p>Using a <code class="literal">PropertyEditorRegistrar</code> is perhaps best illustrated with an example. First off, you need to create your own <code class="literal">PropertyEditorRegistrar</code> implementation:</p> 
      <pre class="programlisting"><span class="hl-keyword">package</span> com.foo.editors.spring;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> CustomPropertyEditorRegistrar <span class="hl-keyword">implements</span> PropertyEditorRegistrar {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> registerCustomEditors(PropertyEditorRegistry registry) {

        <span class="hl-comment">// it is expected that new PropertyEditor instances are created</span>
        registry.registerCustomEditor(ExoticType.<span class="hl-keyword">class</span>, <span class="hl-keyword">new</span> ExoticTypeEditor());

        <span class="hl-comment">// you could register as many custom property editors as are required here...</span>
    }
}</pre> 
      <p>See also the <code class="literal">org.springframework.beans.support.ResourceEditorRegistrar</code> for an example <code class="literal">PropertyEditorRegistrar</code> implementation. Notice how in its implementation of the <code class="literal">registerCustomEditors(..)</code> method it creates new instances of each property editor.</p> 
      <p>Next we configure a <code class="literal">CustomEditorConfigurer</code> and inject an instance of our <code class="literal">CustomPropertyEditorRegistrar</code> into it:</p> 
      <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.beans.factory.config.CustomEditorConfigurer&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;propertyEditorRegistrars&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">&quot;customPropertyEditorRegistrar&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;customPropertyEditorRegistrar&quot;</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.foo.editors.spring.CustomPropertyEditorRegistrar&quot;</span><span class="hl-tag">/&gt;</span></pre> 
      <p>Finally, and in a bit of a departure from the focus of this chapter, for those of you using <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mvc" title="16.&nbsp;Web MVC framework">Springs MVC web framework</a>, using <code class="literal">PropertyEditorRegistrars</code> in conjunction with data-binding <code class="literal">Controllers</code> (such as <code class="literal">SimpleFormController</code>) can be very convenient. Find below an example of using a <code class="literal">PropertyEditorRegistrar</code> in the implementation of an <code class="literal">initBinder(..)</code> method:</p> 
      <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> RegisterUserController <span class="hl-keyword">extends</span> SimpleFormController {

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> PropertyEditorRegistrar customPropertyEditorRegistrar;

    <span class="hl-keyword">public</span> RegisterUserController(PropertyEditorRegistrar propertyEditorRegistrar) {
        <span class="hl-keyword">this</span>.customPropertyEditorRegistrar = propertyEditorRegistrar;
    }

    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> initBinder(HttpServletRequest request,
            ServletRequestDataBinder binder) <span class="hl-keyword">throws</span> Exception {
        <span class="strong"><strong>this.customPropertyEditorRegistrar.registerCustomEditors(binder);</strong></span>
    }

    <span class="hl-comment">// other methods to do with registering a User</span>
}</pre> 
      <p>This style of <code class="literal">PropertyEditor</code> registration can lead to concise code (the implementation of <code class="literal">initBinder(..)</code> is just one line long!), and allows common <code class="literal">PropertyEditor</code> registration code to be encapsulated in a class and then shared amongst as many <code class="literal">Controllers</code> as needed.</p> 
     </div> 
    </div> 
   </div> 
  </div> 
  <div class="section" title="6.5&nbsp;Spring Type Conversion">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="core-convert"></a>6.5&nbsp;Spring Type Conversion</h2>
     </div>
    </div>
   </div> 
   <p>Spring 3 introduces a <code class="literal">core.convert</code> package that provides a general type conversion system. The system defines an SPI to implement type conversion logic, as well as an API to execute type conversions at runtime. Within a Spring container, this system can be used as an alternative to PropertyEditors to convert externalized bean property value strings to required property types. The public API may also be used anywhere in your application where type conversion is needed.</p> 
   <div class="section" title="6.5.1&nbsp;Converter SPI">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="core-convert-Converter-API"></a>6.5.1&nbsp;Converter SPI</h3>
      </div>
     </div>
    </div> 
    <p>The SPI to implement type conversion logic is simple and strongly typed:</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.core.convert.converter;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Converter&lt;S, T&gt; {

    T convert(S source);

}</pre> 
    <p>To create your own Converter, simply implement the interface above. Parameterize S as the type you are converting from, and T as the type you are converting to. For each call to convert(S), the source argument is guaranteed to be NOT null. Your Converter may throw any Exception if conversion fails. An IllegalArgumentException should be thrown to report an invalid source value. Take care to ensure your Converter implementation is thread-safe.</p> 
    <p>Several converter implementations are provided in the <code class="literal">core.convert.support</code> package as a convenience. These include converters from Strings to Numbers and other common types. Consider <code class="literal">StringToInteger</code> as an example Converter implementation:</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.core.convert.support;

<span class="hl-keyword">final</span> <span class="hl-keyword">class</span> StringToInteger <span class="hl-keyword">implements</span> Converter&lt;String, Integer&gt; {

    <span class="hl-keyword">public</span> Integer convert(String source) {
        <span class="hl-keyword">return</span> Integer.valueOf(source);
    }

}</pre> 
   </div> 
   <div class="section" title="6.5.2&nbsp;ConverterFactory">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="core-convert-ConverterFactory-SPI"></a>6.5.2&nbsp;ConverterFactory</h3>
      </div>
     </div>
    </div> 
    <p>When you need to centralize the conversion logic for an entire class hierarchy, for example, when converting from String to java.lang.Enum objects, implement <code class="literal">ConverterFactory</code>:</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.core.convert.converter;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ConverterFactory&lt;S, R&gt; {

    &lt;T <span class="hl-keyword">extends</span> R&gt; Converter&lt;S, T&gt; getConverter(Class&lt;T&gt; targetType);

}</pre> 
    <p>Parameterize S to be the type you are converting from and R to be the base type defining the <span class="emphasis"><em>range</em></span> of classes you can convert to. Then implement getConverter(Class&lt;T&gt;), where T is a subclass of R.</p> 
    <p>Consider the <code class="literal">StringToEnum</code> ConverterFactory as an example:</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.core.convert.support;

<span class="hl-keyword">final</span> <span class="hl-keyword">class</span> StringToEnumConverterFactory <span class="hl-keyword">implements</span> ConverterFactory&lt;String, Enum&gt; {

    <span class="hl-keyword">public</span> &lt;T <span class="hl-keyword">extends</span> Enum&gt; Converter&lt;String, T&gt; getConverter(Class&lt;T&gt; targetType) {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> StringToEnumConverter(targetType);
    }

    <span class="hl-keyword">private</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> StringToEnumConverter&lt;T <span class="hl-keyword">extends</span> Enum&gt; <span class="hl-keyword">implements</span> Converter&lt;String, T&gt; {

        <span class="hl-keyword">private</span> Class&lt;T&gt; enumType;

        <span class="hl-keyword">public</span> StringToEnumConverter(Class&lt;T&gt; enumType) {
            <span class="hl-keyword">this</span>.enumType = enumType;
        }

        <span class="hl-keyword">public</span> T convert(String source) {
            <span class="hl-keyword">return</span> (T) Enum.valueOf(<span class="hl-keyword">this</span>.enumType, source.trim());
        }
    }
}</pre> 
   </div> 
   <div class="section" title="6.5.3&nbsp;GenericConverter">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="core-convert-GenericConverter-SPI"></a>6.5.3&nbsp;GenericConverter</h3>
      </div>
     </div>
    </div> 
    <p>When you require a sophisticated Converter implementation, consider the GenericConverter interface. With a more flexible but less strongly typed signature, a GenericConverter supports converting between multiple source and target types. In addition, a GenericConverter makes available source and target field context you can use when implementing your conversion logic. Such context allows a type conversion to be driven by a field annotation, or generic information declared on a field signature.</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.core.convert.converter;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> GenericConverter {

    <span class="hl-keyword">public</span> Set&lt;ConvertiblePair&gt; getConvertibleTypes();

    Object convert(Object source, TypeDescriptor sourceType, TypeDescriptor targetType);

}</pre> 
    <p>To implement a GenericConverter, have getConvertibleTypes() return the supported source&#x2192;target type pairs. Then implement convert(Object, TypeDescriptor, TypeDescriptor) to implement your conversion logic. The source TypeDescriptor provides access to the source field holding the value being converted. The target TypeDescriptor provides access to the target field where the converted value will be set.</p> 
    <p>A good example of a GenericConverter is a converter that converts between a Java Array and a Collection. Such an ArrayToCollectionConverter introspects the field that declares the target Collection type to resolve the Collections element type. This allows each element in the source array to be converted to the Collection element type before the Collection is set on the target field.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Because GenericConverter is a more complex SPI interface, only use it when you need it. Favor Converter or ConverterFactory for basic type conversion needs.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <div class="section" title="ConditionalGenericConverter">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="core-convert-ConditionalGenericConverter-SPI"></a>ConditionalGenericConverter</h4>
       </div>
      </div>
     </div> 
     <p>Sometimes you only want a Converter to execute if a specific condition holds true. For example, you might only want to execute a Converter if a specific annotation is present on the target field. Or you might only want to execute a Converter if a specific method, such as static valueOf method, is defined on the target class. ConditionalGenericConverter is an subinterface of GenericConverter that allows you to define such custom matching criteria:</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ConditionalGenericConverter <span class="hl-keyword">extends</span> GenericConverter {

    <span class="hl-keyword">boolean</span> matches(TypeDescriptor sourceType, TypeDescriptor targetType);

}</pre> 
     <p>A good example of a ConditionalGenericConverter is an EntityConverter that converts between an persistent entity identifier and an entity reference. Such a EntityConverter might only match if the target entity type declares a static finder method e.g. findAccount(Long). You would perform such a finder method check in the implementation of matches(TypeDescriptor, TypeDescriptor).</p> 
    </div> 
   </div> 
   <div class="section" title="6.5.4&nbsp;ConversionService API">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="core-convert-ConversionService-API"></a>6.5.4&nbsp;ConversionService API</h3>
      </div>
     </div>
    </div> 
    <p>The ConversionService defines a unified API for executing type conversion logic at runtime. Converters are often executed behind this facade interface:</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.core.convert;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ConversionService {

    <span class="hl-keyword">boolean</span> canConvert(Class&lt;?&gt; sourceType, Class&lt;?&gt; targetType);

    &lt;T&gt; T convert(Object source, Class&lt;T&gt; targetType);

    <span class="hl-keyword">boolean</span> canConvert(TypeDescriptor sourceType, TypeDescriptor targetType);

    Object convert(Object source, TypeDescriptor sourceType, TypeDescriptor targetType);

}</pre> 
    <p>Most ConversionService implementations also implement <code class="literal">ConverterRegistry</code>, which provides an SPI for registering converters. Internally, a ConversionService implementation delegates to its registered converters to carry out type conversion logic.</p> 
    <p>A robust ConversionService implementation is provided in the <code class="literal">core.convert.support</code> package. <code class="literal">GenericConversionService</code> is the general-purpose implementation suitable for use in most environments. <code class="literal">ConversionServiceFactory</code> provides a convenient factory for creating common ConversionService configurations.</p> 
   </div> 
   <div class="section" title="6.5.5&nbsp;Configuring a ConversionService">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="core-convert-Spring-config"></a>6.5.5&nbsp;Configuring a ConversionService</h3>
      </div>
     </div>
    </div> 
    <p>A ConversionService is a stateless object designed to be instantiated at application startup, then shared between multiple threads. In a Spring application, you typically configure a ConversionService instance per Spring container (or ApplicationContext). That ConversionService will be picked up by Spring and then used whenever a type conversion needs to be performed by the framework. You may also inject this ConversionService into any of your beans and invoke it directly.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>If no ConversionService is registered with Spring, the original PropertyEditor-based system is used.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>To register a default ConversionService with Spring, add the following bean definition with id <code class="literal">conversionService</code>:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;conversionService&quot;</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <p>A default ConversionService can convert between strings, numbers, enums, collections, maps, and other common types. To supplement or override the default converters with your own custom converter(s), set the <code class="literal">converters</code> property. Property values may implement either of the Converter, ConverterFactory, or GenericConverter interfaces.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;conversionService&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.context.support.ConversionServiceFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;converters&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;set&gt;</span>
            <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;example.MyCustomConverter&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/set&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>It is also common to use a ConversionService within a Spring MVC application. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#format-configuring-formatting-mvc" title="6.6.5&nbsp;Configuring Formatting in Spring MVC">Section&nbsp;6.6.5, Configuring Formatting in Spring MVC</a> for details on use with <code class="literal">&lt;mvc:annotation-driven/&gt;</code>.</p> 
    <p>In certain situations you may wish to apply formatting during conversion. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#format-FormatterRegistry-SPI" title="6.6.3&nbsp;FormatterRegistry SPI">Section&nbsp;6.6.3, FormatterRegistry SPI</a> for details on using <code class="literal">FormattingConversionServiceFactoryBean</code>.</p> 
   </div> 
   <div class="section" title="6.5.6&nbsp;Using a ConversionService programmatically">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="core-convert-programmatic-usage"></a>6.5.6&nbsp;Using a ConversionService programmatically</h3>
      </div>
     </div>
    </div> 
    <p>To work with a ConversionService instance programmatically, simply inject a reference to it like you would for any other bean:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Service</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyService {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">public</span> MyService(ConversionService conversionService) {
        <span class="hl-keyword">this</span>.conversionService = conversionService;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doIt() {
        <span class="hl-keyword">this</span>.conversionService.convert(...)
    }
}</pre> 
   </div> 
  </div> 
  <div class="section" title="6.6&nbsp;Spring Field Formatting">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="format"></a>6.6&nbsp;Spring Field Formatting</h2>
     </div>
    </div>
   </div> 
   <p>As discussed in the previous section, <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#core-convert" title="6.5&nbsp;Spring Type Conversion"><code class="literal">core.convert</code></a> is a general-purpose type conversion system. It provides a unified ConversionService API as well as a strongly-typed Converter SPI for implementing conversion logic from one type to another. A Spring Container uses this system to bind bean property values. In addition, both the Spring Expression Language (SpEL) and DataBinder use this system to bind field values. For example, when SpEL needs to coerce a <code class="literal">Short</code> to a <code class="literal">Long</code> to complete an <code class="literal">expression.setValue(Object bean, Object value)</code> attempt, the core.convert system performs the coercion.</p> 
   <p>Now consider the type conversion requirements of a typical client environment such as a web or desktop application. In such environments, you typically convert <span class="emphasis"><em>from String</em></span> to support the client postback process, as well as back <span class="emphasis"><em>to String</em></span> to support the view rendering process. In addition, you often need to localize String values. The more general <span class="emphasis"><em>core.convert</em></span> Converter SPI does not address such <span class="emphasis"><em>formatting</em></span> requirements directly. To directly address them, Spring 3 introduces a convenient Formatter SPI that provides a simple and robust alternative to PropertyEditors for client environments.</p> 
   <p>In general, use the Converter SPI when you need to implement general-purpose type conversion logic; for example, for converting between a java.util.Date and and java.lang.Long. Use the Formatter SPI when youre working in a client environment, such as a web application, and need to parse and print localized field values. The ConversionService provides a unified type conversion API for both SPIs.</p> 
   <div class="section" title="6.6.1&nbsp;Formatter SPI">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="format-Formatter-SPI"></a>6.6.1&nbsp;Formatter SPI</h3>
      </div>
     </div>
    </div> 
    <p>The Formatter SPI to implement field formatting logic is simple and strongly typed:</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.format;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Formatter&lt;T&gt; <span class="hl-keyword">extends</span> Printer&lt;T&gt;, Parser&lt;T&gt; {
}</pre> 
    <p>Where Formatter extends from the Printer and Parser building-block interfaces:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Printer&lt;T&gt; {
    String print(T fieldValue, Locale locale);
}</pre> 
    <pre class="programlisting"><span class="hl-keyword">import</span> java.text.ParseException;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Parser&lt;T&gt; {
    T parse(String clientValue, Locale locale) <span class="hl-keyword">throws</span> ParseException;
}</pre> 
    <p>To create your own Formatter, simply implement the Formatter interface above. Parameterize T to be the type of object you wish to format, for example, <code class="literal">java.util.Date</code>. Implement the <code class="literal">print()</code> operation to print an instance of T for display in the client locale. Implement the <code class="literal">parse()</code> operation to parse an instance of T from the formatted representation returned from the client locale. Your Formatter should throw a ParseException or IllegalArgumentException if a parse attempt fails. Take care to ensure your Formatter implementation is thread-safe.</p> 
    <p>Several Formatter implementations are provided in <code class="literal">format</code> subpackages as a convenience. The <code class="literal">number</code> package provides a <code class="literal">NumberFormatter</code>, <code class="literal">CurrencyFormatter</code>, and <code class="literal">PercentFormatter</code> to format <code class="literal">java.lang.Number</code> objects using a <code class="literal">java.text.NumberFormat</code>. The <code class="literal">datetime</code> package provides a <code class="literal">DateFormatter</code> to format <code class="literal">java.util.Date</code> objects with a <code class="literal">java.text.DateFormat</code>. The <code class="literal">datetime.joda</code> package provides comprehensive datetime formatting support based on the <a class="ulink" href="http://joda-time.sourceforge.net/" target="_top">Joda Time library</a>.</p> 
    <p>Consider <code class="literal">DateFormatter</code> as an example <code class="literal">Formatter</code> implementation:</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.format.datetime;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> DateFormatter <span class="hl-keyword">implements</span> Formatter&lt;Date&gt; {

    <span class="hl-keyword">private</span> String pattern;

    <span class="hl-keyword">public</span> DateFormatter(String pattern) {
        <span class="hl-keyword">this</span>.pattern = pattern;
    }

    <span class="hl-keyword">public</span> String print(Date date, Locale locale) {
        <span class="hl-keyword">if</span> (date == null) {
            <span class="hl-keyword">return</span> <span class="hl-string">&quot;&quot;</span>;
        }
        <span class="hl-keyword">return</span> getDateFormat(locale).format(date);
    }

    <span class="hl-keyword">public</span> Date parse(String formatted, Locale locale) <span class="hl-keyword">throws</span> ParseException {
        <span class="hl-keyword">if</span> (formatted.length() == <span class="hl-number">0</span>) {
            <span class="hl-keyword">return</span> null;
        }
        <span class="hl-keyword">return</span> getDateFormat(locale).parse(formatted);
    }

    <span class="hl-keyword">protected</span> DateFormat getDateFormat(Locale locale) {
        DateFormat dateFormat = <span class="hl-keyword">new</span> SimpleDateFormat(<span class="hl-keyword">this</span>.pattern, locale);
        dateFormat.setLenient(false);
        <span class="hl-keyword">return</span> dateFormat;
    }

}</pre> 
    <p>The Spring team welcomes community-driven Formatter contributions; see <a class="ulink" href="http://jira.springframework.org/" target="_top">http://jira.springframework.org</a> to contribute.</p> 
   </div> 
   <div class="section" title="6.6.2&nbsp;Annotation-driven Formatting">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="format-CustomFormatAnnotations"></a>6.6.2&nbsp;Annotation-driven Formatting</h3>
      </div>
     </div>
    </div> 
    <p>As you will see, field formatting can be configured by field type or annotation. To bind an Annotation to a formatter, implement AnnotationFormatterFactory:</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.format;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> AnnotationFormatterFactory&lt;A <span class="hl-keyword">extends</span> Annotation&gt; {

    Set&lt;Class&lt;?&gt;&gt; getFieldTypes();

    Printer&lt;?&gt; getPrinter(A annotation, Class&lt;?&gt; fieldType);

    Parser&lt;?&gt; getParser(A annotation, Class&lt;?&gt; fieldType);

}</pre> 
    <p>Parameterize A to be the field annotationType you wish to associate formatting logic with, for example <code class="literal">org.springframework.format.annotation.DateTimeFormat</code>. Have <code class="literal">getFieldTypes()</code> return the types of fields the annotation may be used on. Have <code class="literal">getPrinter()</code> return a Printer to print the value of an annotated field. Have <code class="literal">getParser()</code> return a Parser to parse a clientValue for an annotated field.</p> 
    <p>The example AnnotationFormatterFactory implementation below binds the @NumberFormat Annotation to a formatter. This annotation allows either a number style or pattern to be specified:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> NumberFormatAnnotationFormatterFactory
        <span class="hl-keyword">implements</span> AnnotationFormatterFactory&lt;NumberFormat&gt; {

    <span class="hl-keyword">public</span> Set&lt;Class&lt;?&gt;&gt; getFieldTypes() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> HashSet&lt;Class&lt;?&gt;&gt;(asList(<span class="hl-keyword">new</span> Class&lt;?&gt;[] {
            Short.<span class="hl-keyword">class</span>, Integer.<span class="hl-keyword">class</span>, Long.<span class="hl-keyword">class</span>, Float.<span class="hl-keyword">class</span>,
            Double.<span class="hl-keyword">class</span>, BigDecimal.<span class="hl-keyword">class</span>, BigInteger.<span class="hl-keyword">class</span> }));
    }

    <span class="hl-keyword">public</span> Printer&lt;Number&gt; getPrinter(NumberFormat annotation, Class&lt;?&gt; fieldType) {
        <span class="hl-keyword">return</span> configureFormatterFrom(annotation, fieldType);
    }

    <span class="hl-keyword">public</span> Parser&lt;Number&gt; getParser(NumberFormat annotation, Class&lt;?&gt; fieldType) {
        <span class="hl-keyword">return</span> configureFormatterFrom(annotation, fieldType);
    }

    <span class="hl-keyword">private</span> Formatter&lt;Number&gt; configureFormatterFrom(NumberFormat annotation,
            Class&lt;?&gt; fieldType) {
        <span class="hl-keyword">if</span> (!annotation.pattern().isEmpty()) {
            <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> NumberFormatter(annotation.pattern());
        } <span class="hl-keyword">else</span> {
            Style style = annotation.style();
            <span class="hl-keyword">if</span> (style == Style.PERCENT) {
                <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> PercentFormatter();
            } <span class="hl-keyword">else</span> <span class="hl-keyword">if</span> (style == Style.CURRENCY) {
                <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> CurrencyFormatter();
            } <span class="hl-keyword">else</span> {
                <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> NumberFormatter();
            }
        }
    }
}</pre> 
    <p>To trigger formatting, simply annotate fields with @NumberFormat:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyModel {

    <i><span class="hl-annotation" style="color: gray">@NumberFormat(style=Style.CURRENCY)</span></i>
    <span class="hl-keyword">private</span> BigDecimal decimal;

}</pre> 
    <div class="section" title="Format Annotation API">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="format-annotations-api"></a>Format Annotation API</h4>
       </div>
      </div>
     </div> 
     <p>A portable format annotation API exists in the <code class="literal">org.springframework.format.annotation</code> package. Use @NumberFormat to format java.lang.Number fields. Use @DateTimeFormat to format java.util.Date, java.util.Calendar, java.util.Long, or Joda Time fields.</p> 
     <p>The example below uses @DateTimeFormat to format a java.util.Date as a ISO Date (yyyy-MM-dd):</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyModel {

    <i><span class="hl-annotation" style="color: gray">@DateTimeFormat(iso=ISO.DATE)</span></i>
    <span class="hl-keyword">private</span> Date date;

}</pre> 
    </div> 
   </div> 
   <div class="section" title="6.6.3&nbsp;FormatterRegistry SPI">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="format-FormatterRegistry-SPI"></a>6.6.3&nbsp;FormatterRegistry SPI</h3>
      </div>
     </div>
    </div> 
    <p>The FormatterRegistry is an SPI for registering formatters and converters. <code class="literal">FormattingConversionService</code> is an implementation of FormatterRegistry suitable for most environments. This implementation may be configured programmatically or declaratively as a Spring bean using <code class="literal">FormattingConversionServiceFactoryBean</code>. Because this implementation also implements <code class="literal">ConversionService</code>, it can be directly configured for use with Springs DataBinder and the Spring Expression Language (SpEL).</p> 
    <p>Review the FormatterRegistry SPI below:</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.format;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> FormatterRegistry <span class="hl-keyword">extends</span> ConverterRegistry {

    <span class="hl-keyword">void</span> addFormatterForFieldType(Class&lt;?&gt; fieldType, Printer&lt;?&gt; printer, Parser&lt;?&gt; parser);

    <span class="hl-keyword">void</span> addFormatterForFieldType(Class&lt;?&gt; fieldType, Formatter&lt;?&gt; formatter);

    <span class="hl-keyword">void</span> addFormatterForFieldType(Formatter&lt;?&gt; formatter);

    <span class="hl-keyword">void</span> addFormatterForAnnotation(AnnotationFormatterFactory&lt;?, ?&gt; factory);

}</pre> 
    <p>As shown above, Formatters can be registered by fieldType or annotation.</p> 
    <p>The FormatterRegistry SPI allows you to configure Formatting rules centrally, instead of duplicating such configuration across your Controllers. For example, you might want to enforce that all Date fields are formatted a certain way, or fields with a specific annotation are formatted in a certain way. With a shared FormatterRegistry, you define these rules once and they are applied whenever formatting is needed.</p> 
   </div> 
   <div class="section" title="6.6.4&nbsp;FormatterRegistrar SPI">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="format-FormatterRegistrar-SPI"></a>6.6.4&nbsp;FormatterRegistrar SPI</h3>
      </div>
     </div>
    </div> 
    <p>The FormatterRegistrar is an SPI for registering formatters and converters through the FormatterRegistry:</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> org.springframework.format;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> FormatterRegistrar {

    <span class="hl-keyword">void</span> registerFormatters(FormatterRegistry registry);

}</pre> 
    <p>A FormatterRegistrar is useful when registering multiple related converters and formatters for a given formatting category, such as Date formatting. It can also be useful where declarative registration is insufficient. For example when a formatter needs to be indexed under a specific field type different from its own &lt;T&gt; or when registering a Printer/Parser pair. The next section provides more information on converter and formatter registration.</p> 
   </div> 
   <div class="section" title="6.6.5&nbsp;Configuring Formatting in Spring MVC">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="format-configuring-formatting-mvc"></a>6.6.5&nbsp;Configuring Formatting in Spring MVC</h3>
      </div>
     </div>
    </div> 
    <p>In a Spring MVC application, you may configure a custom ConversionService instance explicitly as an attribute of the <code class="literal">annotation-driven</code> element of the MVC namespace. This ConversionService will then be used anytime a type conversion is required during Controller model binding. If not configured explicitly, Spring MVC will automatically register default formatters and converters for common types such as numbers and dates.</p> 
    <p>To rely on default formatting rules, no custom configuration is required in your Spring MVC config XML:</p> 
    <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:mvc</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/mvc&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;mvc:annotation-driven/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <p>With this one-line of configuration, default formatters for Numbers and Date types will be installed, including support for the @NumberFormat and @DateTimeFormat annotations. Full support for the Joda Time formatting library is also installed if Joda Time is present on the classpath.</p> 
    <p>To inject a ConversionService instance with custom formatters and converters registered, set the conversion-service attribute and then specify custom converters, formatters, or FormatterRegistrars as properties of the FormattingConversionServiceFactoryBean:</p> 
    <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:mvc</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/mvc&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;mvc:annotation-driven</span> <span class="hl-attribute">conversion-service</span>=<span class="hl-value">&quot;conversionService&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;conversionService&quot;</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;converters&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;set&gt;</span>
                <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.example.MyConverter&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/set&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;formatters&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;set&gt;</span>
                <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.example.MyFormatter&quot;</span><span class="hl-tag">/&gt;</span>
                <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.example.MyAnnotationFormatterFactory&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/set&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;formatterRegistrars&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;set&gt;</span>
                <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.example.MyFormatterRegistrar&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;/set&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#format-FormatterRegistrar-SPI" title="6.6.4&nbsp;FormatterRegistrar SPI">Section&nbsp;6.6.4, FormatterRegistrar SPI</a> and the <code class="literal">FormattingConversionServiceFactoryBean</code> for more information on when to use FormatterRegistrars.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
  </div> 
  <div class="section" title="6.7&nbsp;Configuring a global date &amp; time format">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="format-configuring-formatting-globaldatetimeformat"></a>6.7&nbsp;Configuring a global date &amp; time format</h2>
     </div>
    </div>
   </div> 
   <p>By default, date and time fields that are not annotated with <code class="literal">@DateTimeFormat</code> are converted from strings using the the <code class="literal">DateFormat.SHORT</code> style. If you prefer, you can change this by defining your own global format.</p> 
   <p>You will need to ensure that Spring does not register default formatters, and instead you should register all formatters manually. Use the <code class="literal">org.springframework.format.datetime.joda.JodaTimeFormatterRegistrar</code> or <code class="literal">org.springframework.format.datetime.DateFormatterRegistrar</code> class depending on whether you use the Joda Time library.</p> 
   <p>For example, the following Java configuration will register a global ' <code class="literal">yyyyMMdd</code>' format. This example does not depend on the Joda Time library:</p> 
   <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> FormattingConversionService conversionService() {

        <span class="hl-comment">// Use the DefaultFormattingConversionService but do not register defaults</span>
        DefaultFormattingConversionService conversionService = <span class="hl-keyword">new</span> DefaultFormattingConversionService(false);

        <span class="hl-comment">// Ensure @NumberFormat is still supported</span>
        conversionService.addFormatterForFieldAnnotation(<span class="hl-keyword">new</span> NumberFormatAnnotationFormatterFactory());

        <span class="hl-comment">// Register date conversion with a specific global format</span>
        DateFormatterRegistrar registrar = <span class="hl-keyword">new</span> DateFormatterRegistrar();
        registrar.setFormatter(<span class="hl-keyword">new</span> DateFormatter(<span class="hl-string">&quot;yyyyMMdd&quot;</span>));
        registrar.registerFormatters(conversionService);

        <span class="hl-keyword">return</span> conversionService;
    }
}</pre> 
   <p>If you prefer XML based configuration you can use a <code class="literal">FormattingConversionServiceFactoryBean</code>. Here is the same example, this time using Joda Time:</p> 
   <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd&gt;

    &lt;bean id=&quot;</span><span class="hl-attribute">conversionService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.format.support.FormattingConversionServiceFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;registerDefaultFormatters&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;false&quot;</span><span class="hl-tag"> /&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;formatters&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;set&gt;</span>
                <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.format.number.NumberFormatAnnotationFormatterFactory&quot;</span><span class="hl-tag"> /&gt;</span>
            <span class="hl-tag">&lt;/set&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;formatterRegistrars&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;set&gt;</span>
                <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.format.datetime.joda.JodaTimeFormatterRegistrar&quot;</span><span class="hl-tag">&gt;</span>
                    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;dateFormatter&quot;</span><span class="hl-tag">&gt;</span>
                        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.format.datetime.joda.DateTimeFormatterFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
                            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;pattern&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;yyyyMMdd&quot;</span><span class="hl-tag">/&gt;</span>
                        <span class="hl-tag">&lt;/bean&gt;</span>
                    <span class="hl-tag">&lt;/property&gt;</span>
                <span class="hl-tag">&lt;/bean&gt;</span>
            <span class="hl-tag">&lt;/set&gt;</span>
        <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>Joda Time provides separate distinct types to represent <code class="literal">date</code>, <code class="literal">time</code> and <code class="literal">date-time</code> values. The <code class="literal">dateFormatter</code>, <code class="literal">timeFormatter</code> and <code class="literal">dateTimeFormatter</code> properties of the <code class="literal">JodaTimeFormatterRegistrar</code> should be used to configure the different formats for each type. The <code class="literal">DateTimeFormatterFactoryBean</code> provides a convenient way to create formatters.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <p>If you are using Spring MVC remember to explicitly configure the conversion service that is used. For Java based <code class="literal">@Configuration</code> this means extending the <code class="literal">WebMvcConfigurationSupport</code> class and overriding the <code class="literal">mvcConversionService()</code> method. For XML you should use the <code class="literal">'conversion-service'</code> attribute of the <code class="literal">mvc:annotation-driven</code> element. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#format-configuring-formatting-mvc" title="6.6.5&nbsp;Configuring Formatting in Spring MVC">Section&nbsp;6.6.5, Configuring Formatting in Spring MVC</a> for details.</p> 
  </div> 
  <div class="section" title="6.8&nbsp;Spring Validation">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="validation-beanvalidation"></a>6.8&nbsp;Spring Validation</h2>
     </div>
    </div>
   </div> 
   <p>Spring 3 introduces several enhancements to its validation support. First, the JSR-303 Bean Validation API is now fully supported. Second, when used programmatically, Springs DataBinder can now validate objects as well as bind to them. Third, Spring MVC now has support for declaratively validating @Controller inputs.</p> 
   <div class="section" title="6.8.1&nbsp;Overview of the JSR-303 Bean Validation API">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="validation-beanvalidation-overview"></a>6.8.1&nbsp;Overview of the JSR-303 Bean Validation API</h3>
      </div>
     </div>
    </div> 
    <p>JSR-303 standardizes validation constraint declaration and metadata for the Java platform. Using this API, you annotate domain model properties with declarative validation constraints and the runtime enforces them. There are a number of built-in constraints you can take advantage of. You may also define your own custom constraints.</p> 
    <p>To illustrate, consider a simple PersonForm model with two properties:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PersonForm {
    <span class="hl-keyword">private</span> String name;
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> age;
}</pre> 
    <p>JSR-303 allows you to define declarative validation constraints against such properties:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PersonForm {

    <i><span class="hl-annotation" style="color: gray">@NotNull</span></i>
    <i><span class="hl-annotation" style="color: gray">@Size(max=64)</span></i>
    <span class="hl-keyword">private</span> String name;

    <i><span class="hl-annotation" style="color: gray">@Min(0)</span></i>
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> age;

}</pre> 
    <p>When an instance of this class is validated by a JSR-303 Validator, these constraints will be enforced.</p> 
    <p>For general information on JSR-303/JSR-349, see the <a class="ulink" href="http://beanvalidation.org/" target="_top">Bean Validation website</a>. For information on the specific capabilities of the default reference implementation, see the <a class="ulink" href="https://www.hibernate.org/412.html" target="_top">Hibernate Validator</a> documentation. To learn how to setup a Bean Validation provider as a Spring bean, keep reading.</p> 
   </div> 
   <div class="section" title="6.8.2&nbsp;Configuring a Bean Validation Provider">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="validation-beanvalidation-spring"></a>6.8.2&nbsp;Configuring a Bean Validation Provider</h3>
      </div>
     </div>
    </div> 
    <p>Spring provides full support for the Bean Validation API. This includes convenient support for bootstrapping a JSR-303/JSR-349 Bean Validation provider as a Spring bean. This allows for a <code class="literal">javax.validation.ValidatorFactory</code> or <code class="literal">javax.validation.Validator</code> to be injected wherever validation is needed in your application.</p> 
    <p>Use the <code class="literal">LocalValidatorFactoryBean</code> to configure a default Validator as a Spring bean:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;validator&quot;</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.validation.beanvalidation.LocalValidatorFactoryBean&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <p>The basic configuration above will trigger Bean Validation to initialize using its default bootstrap mechanism. A JSR-303/JSR-349 provider, such as Hibernate Validator, is expected to be present in the classpath and will be detected automatically.</p> 
    <div class="section" title="Injecting a Validator">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="validation-beanvalidation-spring-inject"></a>Injecting a Validator</h4>
       </div>
      </div>
     </div> 
     <p><code class="literal">LocalValidatorFactoryBean</code> implements both <code class="literal">javax.validation.ValidatorFactory</code> and <code class="literal">javax.validation.Validator</code>, as well as Springs <code class="literal">org.springframework.validation.Validator</code>. You may inject a reference to either of these interfaces into beans that need to invoke validation logic.</p> 
     <p>Inject a reference to <code class="literal">javax.validation.Validator</code> if you prefer to work with the Bean Validation API directly:</p> 
     <pre class="programlisting"><span class="hl-keyword">import</span> javax.validation.Validator;

<i><span class="hl-annotation" style="color: gray">@Service</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyService {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> Validator validator;</pre> 
     <p>Inject a reference to <code class="literal">org.springframework.validation.Validator</code> if your bean requires the Spring Validation API:</p> 
     <pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.validation.Validator;

<i><span class="hl-annotation" style="color: gray">@Service</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyService {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> Validator validator;

}</pre> 
    </div> 
    <div class="section" title="Configuring Custom Constraints">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="validation-beanvalidation-spring-constraints"></a>Configuring Custom Constraints</h4>
       </div>
      </div>
     </div> 
     <p>Each Bean Validation constraint consists of two parts. First, a @Constraint annotation that declares the constraint and its configurable properties. Second, an implementation of the <code class="literal">javax.validation.ConstraintValidator</code> interface that implements the constraints behavior. To associate a declaration with an implementation, each @Constraint annotation references a corresponding ValidationConstraint implementation class. At runtime, a <code class="literal">ConstraintValidatorFactory</code> instantiates the referenced implementation when the constraint annotation is encountered in your domain model.</p> 
     <p>By default, the <code class="literal">LocalValidatorFactoryBean</code> configures a <code class="literal">SpringConstraintValidatorFactory</code> that uses Spring to create ConstraintValidator instances. This allows your custom ConstraintValidators to benefit from dependency injection like any other Spring bean.</p> 
     <p>Shown below is an example of a custom @Constraint declaration, followed by an associated <code class="literal">ConstraintValidator</code> implementation that uses Spring for dependency injection:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Target({ElementType.METHOD, ElementType.FIELD})</span></i>
<i><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></i>
<i><span class="hl-annotation" style="color: gray">@Constraint(validatedBy=MyConstraintValidator.class)</span></i>
<span class="hl-keyword">public</span> <i><span class="hl-annotation" style="color: gray">@interface</span></i> MyConstraint {
}</pre> 
     <pre class="programlisting"><span class="hl-keyword">import</span> javax.validation.ConstraintValidator;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyConstraintValidator <span class="hl-keyword">implements</span> ConstraintValidator {

    <i><span class="hl-annotation" style="color: gray">@Autowired;</span></i>
    <span class="hl-keyword">private</span> Foo aDependency;

    ...
}</pre> 
     <p>As you can see, a ConstraintValidator implementation may have its dependencies @Autowired like any other Spring bean.</p> 
    </div> 
    <div class="section" title="Additional Configuration Options">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="validation-beanvalidation-spring-other"></a>Additional Configuration Options</h4>
       </div>
      </div>
     </div> 
     <p>The default <code class="literal">LocalValidatorFactoryBean</code> configuration should prove sufficient for most cases. There are a number of configuration options for various Bean Validation constructs, from message interpolation to traversal resolution. See the JavaDocs of <code class="literal">LocalValidatorFactoryBean</code> for more information on these options.</p> 
    </div> 
   </div> 
   <div class="section" title="6.8.3&nbsp;Configuring a DataBinder">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="validation-binder"></a>6.8.3&nbsp;Configuring a DataBinder</h3>
      </div>
     </div>
    </div> 
    <p>Since Spring 3, a DataBinder instance can be configured with a Validator. Once configured, the Validator may be invoked by calling <code class="literal">binder.validate()</code>. Any validation Errors are automatically added to the binders BindingResult.</p> 
    <p>When working with the DataBinder programmatically, this can be used to invoke validation logic after binding to a target object:</p> 
    <pre class="programlisting">Foo target = <span class="hl-keyword">new</span> Foo();
DataBinder binder = <span class="hl-keyword">new</span> DataBinder(target);
binder.setValidator(<span class="hl-keyword">new</span> FooValidator());

<span class="hl-comment">// bind to the target object</span>
binder.bind(propertyValues);

<span class="hl-comment">// validate the target object</span>
binder.validate();

<span class="hl-comment">// get BindingResult that includes any validation errors</span>
BindingResult results = binder.getBindingResult();</pre> 
    <p>A DataBinder can also be configured with multiple <code class="literal">Validator</code> instances via <code class="literal">dataBinder.addValidators</code> and <code class="literal">dataBinder.replaceValidators</code>. This is useful when combining globally configured Bean Validation with a Spring <code class="literal">Validator</code> configured locally on a DataBinder instance. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#validation-mvc-configuring" title="Configuring a Validator for use by Spring MVC">the section called Configuring a Validator for use by Spring MVC</a>.</p> 
   </div> 
   <div class="section" title="6.8.4&nbsp;Spring MVC 3 Validation">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="validation-mvc"></a>6.8.4&nbsp;Spring MVC 3 Validation</h3>
      </div>
     </div>
    </div> 
    <p>Beginning with Spring 3, Spring MVC has the ability to automatically validate @Controller inputs. In previous versions it was up to the developer to manually invoke validation logic.</p> 
    <div class="section" title="Triggering @Controller Input Validation">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="validation-mvc-triggering"></a>Triggering @Controller Input Validation</h4>
       </div>
      </div>
     </div> 
     <p>To trigger validation of a @Controller input, simply annotate the input argument as @Valid:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyController {

    <i><span class="hl-annotation" style="color: gray">@RequestMapping(&quot;/foo&quot;, method=RequestMethod.POST)</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> processFoo(<span class="strong"><strong>@Valid</strong></span> Foo foo) { <span class="hl-comment">/* ... */</span> }</pre> 
     <p>Spring MVC will validate a @Valid object after binding so-long as an appropriate Validator has been configured.</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>The @Valid annotation is part of the standard JSR-303 Bean Validation API, and is not a Spring-specific construct.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="Configuring a Validator for use by Spring MVC">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="validation-mvc-configuring"></a>Configuring a Validator for use by Spring MVC</h4>
       </div>
      </div>
     </div> 
     <p>The Validator instance invoked when a @Valid method argument is encountered may be configured in two ways. First, you may call binder.setValidator(Validator) within a @Controllers @InitBinder callback. This allows you to configure a Validator instance per @Controller class:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyController {

    <i><span class="hl-annotation" style="color: gray">@InitBinder</span></i>
    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> initBinder(WebDataBinder binder) {
        binder.setValidator(<span class="hl-keyword">new</span> FooValidator());
    }

    <i><span class="hl-annotation" style="color: gray">@RequestMapping(&quot;/foo&quot;, method=RequestMethod.POST)</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> processFoo(<i><span class="hl-annotation" style="color: gray">@Valid</span></i> Foo foo) { ... }

}</pre> 
     <p>Second, you may call setValidator(Validator) on the global WebBindingInitializer. This allows you to configure a Validator instance across all @Controllers. This can be achieved easily by using the Spring MVC namespace:</p> 
     <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:mvc</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/mvc&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;mvc:annotation-driven</span> <span class="hl-attribute">validator</span>=<span class="hl-value">&quot;globalValidator&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
     <p>To combine a global and a local validator, configure the global validator as shown above and then add a local validator:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Controller</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyController {

    <i><span class="hl-annotation" style="color: gray">@InitBinder</span></i>
    <span class="hl-keyword">protected</span> <span class="hl-keyword">void</span> initBinder(WebDataBinder binder) {
        binder.addValidators(<span class="hl-keyword">new</span> FooValidator());
    }

}</pre> 
    </div> 
    <div class="section" title="Configuring a JSR-303/JSR-349 Validator for use by Spring MVC">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="validation-mvc-jsr303"></a>Configuring a JSR-303/JSR-349 Validator for use by Spring MVC</h4>
       </div>
      </div>
     </div> 
     <p>With Bean Validation, a single <code class="literal">javax.validation.Validator</code> instance typically validates <span class="emphasis"><em>all</em></span> model objects that declare validation constraints. To configure such a JSR-303 backed Validator with Spring MVC, simply add a Bean Validation provider, such as Hibernate Validator, to your classpath. Spring MVC will detect it and automatically enable Bean Validation support across all Controllers.</p> 
     <p>The Spring MVC configuration required to enable Bean Validation support is shown below:</p> 
     <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:mvc</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/mvc&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/mvc
        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- JSR-303/JSR-349 support will be detected on classpath and enabled automatically --&gt;</span>
    <span class="hl-tag">&lt;mvc:annotation-driven/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
     <p>With this minimal configuration, anytime a @Valid @Controller input is encountered, it will be validated by the Bean Validation provider. That provider, in turn, will enforce any constraints declared against the input. Any ConstraintViolations will automatically be exposed as errors in the BindingResult renderable by standard Spring MVC form tags.</p> 
    </div> 
   </div> 
  </div> 
 </div> 
 <div class="chapter" title="7.&nbsp;Spring Expression Language (SpEL)">
  <div class="titlepage">
   <div>
    <div>
     <h2 class="title"><a name="expressions"></a>7.&nbsp;Spring Expression Language (SpEL)</h2>
    </div>
   </div>
  </div> 
  <div class="section" title="7.1&nbsp;Introduction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="expressions-intro"></a>7.1&nbsp;Introduction</h2>
     </div>
    </div>
   </div> 
   <p>The Spring Expression Language (SpEL for short) is a powerful expression language that supports querying and manipulating an object graph at runtime. The language syntax is similar to Unified EL but offers additional features, most notably method invocation and basic string templating functionality.</p> 
   <p>While there are several other Java expression languages available, OGNL, MVEL, and JBoss EL, to name a few, the Spring Expression Language was created to provide the Spring community with a single well supported expression language that can be used across all the products in the Spring portfolio. Its language features are driven by the requirements of the projects in the Spring portfolio, including tooling requirements for code completion support within the eclipse based SpringSource Tool Suite. That said, SpEL is based on a technology agnostic API allowing other expression language implementations to be integrated should the need arise.</p> 
   <p>While SpEL serves as the foundation for expression evaluation within the Spring portfolio, it is not directly tied to Spring and can be used independently. In order to be self contained, many of the examples in this chapter use SpEL as if it were an independent expression language. This requires creating a few bootstrapping infrastructure classes such as the parser. Most Spring users will not need to deal with this infrastructure and will instead only author expression strings for evaluation. An example of this typical use is the integration of SpEL into creating XML or annotated based bean definitions as shown in the section <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#expressions-beandef" title="7.4&nbsp;Expression support for defining bean definitions">Expression support for defining bean definitions.</a></p> 
   <p>This chapter covers the features of the expression language, its API, and its language syntax. In several places an Inventor and Inventors Society class are used as the target objects for expression evaluation. These class declarations and the data used to populate them are listed at the end of the chapter.</p> 
  </div> 
  <div class="section" title="7.2&nbsp;Feature Overview">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="expressions-features"></a>7.2&nbsp;Feature Overview</h2>
     </div>
    </div>
   </div> 
   <p>The expression language supports the following functionality</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem"> Literal expressions </li>
     <li class="listitem"> Boolean and relational operators </li>
     <li class="listitem"> Regular expressions </li>
     <li class="listitem"> Class expressions </li>
     <li class="listitem"> Accessing properties, arrays, lists, maps </li>
     <li class="listitem"> Method invocation </li>
     <li class="listitem"> Relational operators </li>
     <li class="listitem"> Assignment </li>
     <li class="listitem"> Calling constructors </li>
     <li class="listitem"> Bean references </li>
     <li class="listitem"> Array construction </li>
     <li class="listitem"> Inline lists </li>
     <li class="listitem"> Ternary operator </li>
     <li class="listitem"> Variables </li>
     <li class="listitem"> User defined functions </li>
     <li class="listitem"> Collection projection </li>
     <li class="listitem"> Collection selection </li>
     <li class="listitem"> Templated expressions </li>
    </ul>
   </div> 
  </div> 
  <div class="section" title="7.3&nbsp;Expression Evaluation using Springs Expression Interface">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="expressions-evaluation"></a>7.3&nbsp;Expression Evaluation using Springs Expression Interface</h2>
     </div>
    </div>
   </div> 
   <p>This section introduces the simple use of SpEL interfaces and its expression language. The complete language reference can be found in the section <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#expressions-language-ref" title="7.5&nbsp;Language Reference">Language Reference</a>.</p> 
   <p>The following code introduces the SpEL API to evaluate the literal string expression <span class="emphasis"><em>Hello World</em></span>.</p> 
   <pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
Expression exp = parser.parseExpression(<span class="hl-string">&quot;</span><span class="strong"><strong>'Hello World'</strong></span><span class="hl-string">&quot;);
</span>String message = (String) exp.getValue();</pre> 
   <p>The value of the message variable is simply <span class="emphasis"><em>Hello World</em></span>.</p> 
   <p>The SpEL classes and interfaces you are most likely to use are located in the packages <code class="literal">org.springframework.expression</code> and its sub packages and <code class="literal">spel.support</code>.</p> 
   <p>The interface <code class="literal">ExpressionParser</code> is responsible for parsing an expression string. In this example the expression string is a string literal denoted by the surrounding single quotes. The interface <code class="literal">Expression</code> is responsible for evaluating the previously defined expression string. There are two exceptions that can be thrown, <code class="literal">ParseException</code> and <code class="literal">EvaluationException</code> when calling ' <code class="literal">parser.parseExpression</code>' and ' <code class="literal">exp.getValue</code>' respectively.</p> 
   <p>SpEL supports a wide range of features, such as calling methods, accessing properties, and calling constructors.</p> 
   <p>As an example of method invocation, we call the <span class="emphasis"><em>concat</em></span> method on the string literal.</p> 
   <pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
Expression exp = parser.parseExpression(<span class="hl-string">&quot;</span><span class="strong"><strong>'Hello World'.concat('!')</strong></span><span class="hl-string">&quot;);
</span>String message = (String) exp.getValue();</pre> 
   <p>The value of message is now <span class="emphasis"><em>Hello World!</em></span>.</p> 
   <p>As an example of calling a JavaBean property, the String property <span class="emphasis"><em>Bytes</em></span> can be called as shown below.</p> 
   <pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();

<span class="hl-comment">// invokes </span><span class="emphasis"><em>getBytes()</em></span>
Expression exp = parser.parseExpression(<span class="hl-string">&quot;</span><span class="strong"><strong>'Hello World'.bytes</strong></span><span class="hl-string">&quot;);
</span><span class="hl-keyword">byte</span>[] bytes = (<span class="hl-keyword">byte</span>[]) exp.getValue();</pre> 
   <p>SpEL also supports nested properties using standard <span class="emphasis"><em>dot</em></span> notation, i.e. prop1.prop2.prop3 and the setting of property values</p> 
   <p>Public fields may also be accessed.</p> 
   <pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();

<span class="hl-comment">// invokes </span><span class="emphasis"><em>getBytes().length</em></span>
Expression exp = parser.parseExpression(<span class="hl-string">&quot;</span><span class="strong"><strong>'Hello World'.bytes.length</strong></span><span class="hl-string">&quot;);
</span><span class="hl-keyword">int</span> length = (Integer) exp.getValue();</pre> 
   <p>The Strings constructor can be called instead of using a string literal.</p> 
   <pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
Expression exp = parser.parseExpression(<span class="hl-string">&quot;</span><span class="strong"><strong>new String('hello world').toUpperCase()</strong></span><span class="hl-string">&quot;);
</span>String message = exp.getValue(String.<span class="hl-keyword">class</span>);</pre> 
   <p>Note the use of the generic method <code class="literal">public &lt;T&gt; T getValue(Class&lt;T&gt; desiredResultType)</code>. Using this method removes the need to cast the value of the expression to the desired result type. An <code class="literal">EvaluationException</code> will be thrown if the value cannot be cast to the type <code class="literal">T</code> or converted using the registered type converter.</p> 
   <p>The more common usage of SpEL is to provide an expression string that is evaluated against a specific object instance (called the root object). There are two options here and which to choose depends on whether the object against which the expression is being evaluated will be changing with each call to evaluate the expression. In the following example we retrieve the <code class="literal">name</code> property from an instance of the Inventor class.</p> 
   <pre class="programlisting"><span class="hl-comment">// Create and set a calendar</span>
GregorianCalendar c = <span class="hl-keyword">new</span> GregorianCalendar();
c.set(<span class="hl-number">1856</span>, <span class="hl-number">7</span>, <span class="hl-number">9</span>);

<span class="hl-comment">// The constructor arguments are name, birthday, and nationality.</span>
Inventor tesla = <span class="hl-keyword">new</span> Inventor(<span class="hl-string">&quot;Nikola Tesla&quot;</span>, c.getTime(), <span class="hl-string">&quot;Serbian&quot;</span>);

ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
Expression exp = parser.parseExpression(<span class="hl-string">&quot;</span><span class="strong"><strong>name</strong></span><span class="hl-string">&quot;);
</span>
EvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext(tesla);
String name = (String) exp.getValue(context);</pre> 
   <p>In the last line, the value of the string variable <span class="emphasis"><em>name</em></span> will be set to &quot;Nikola Tesla&quot;. The class StandardEvaluationContext is where you can specify which object the &quot;name&quot; property will be evaluated against. This is the mechanism to use if the root object is unlikely to change, it can simply be set once in the evaluation context. If the root object is likely to change repeatedly, it can be supplied on each call to <code class="literal">getValue</code>, as this next example shows:</p> 
   <pre class="programlisting">/ Create and set a calendar
GregorianCalendar c = <span class="hl-keyword">new</span> GregorianCalendar();
c.set(<span class="hl-number">1856</span>, <span class="hl-number">7</span>, <span class="hl-number">9</span>);

<span class="hl-comment">// The constructor arguments are name, birthday, and nationality.</span>
Inventor tesla = <span class="hl-keyword">new</span> Inventor(<span class="hl-string">&quot;Nikola Tesla&quot;</span>, c.getTime(), <span class="hl-string">&quot;Serbian&quot;</span>);

ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
Expression exp = parser.parseExpression(<span class="hl-string">&quot;</span><span class="strong"><strong>name</strong></span><span class="hl-string">&quot;);
</span>String name = (String) exp.getValue(tesla);</pre> 
   <p>In this case the inventor <code class="literal">tesla</code> has been supplied directly to <code class="literal">getValue</code> and the expression evaluation infrastructure creates and manages a default evaluation context internally - it did not require one to be supplied.</p> 
   <p>The StandardEvaluationContext is relatively expensive to construct and during repeated usage it builds up cached state that enables subsequent expression evaluations to be performed more quickly. For this reason it is better to cache and reuse them where possible, rather than construct a new one for each expression evaluation.</p> 
   <p>In some cases it can be desirable to use a configured evaluation context and yet still supply a different root object on each call to <code class="literal">getValue</code>. <code class="literal">getValue</code> allows both to be specified on the same call. In these situations the root object passed on the call is considered to override any (which maybe null) specified on the evaluation context.</p> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>In standalone usage of SpEL there is a need to create the parser, parse expressions and perhaps provide evaluation contexts and a root context object. However, more common usage is to provide only the SpEL expression string as part of a configuration file, for example for Spring bean or Spring Web Flow definitions. In this case, the parser, evaluation context, root object and any predefined variables are all set up implicitly, requiring the user to specify nothing other than the expressions.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <p>As a final introductory example, the use of a boolean operator is shown using the Inventor object in the previous example.</p> 
   <pre class="programlisting">Expression exp = parser.parseExpression(<span class="hl-string">&quot;name == </span><span class="emphasis"><em>Nikola Tesla</em></span><span class="hl-string">&quot;);
</span><span class="hl-keyword">boolean</span> result = exp.getValue(context, Boolean.<span class="hl-keyword">class</span>); <span class="hl-comment">// evaluates to true</span></pre> 
   <div class="section" title="7.3.1&nbsp;The EvaluationContext interface">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="expressions-evaluation-context"></a>7.3.1&nbsp;The EvaluationContext interface</h3>
      </div>
     </div>
    </div> 
    <p>The interface <code class="literal">EvaluationContext</code> is used when evaluating an expression to resolve properties, methods, fields, and to help perform type conversion. The out-of-the-box implementation, <code class="literal">StandardEvaluationContext</code>, uses reflection to manipulate the object, caching <code class="literal">java.lang.reflect</code>'s <code class="literal">Method</code>, <code class="literal">Field</code>, and <code class="literal">Constructor</code> instances for increased performance.</p> 
    <p>The <code class="literal">StandardEvaluationContext</code> is where you may specify the root object to evaluate against via the method <code class="literal">setRootObject()</code> or passing the root object into the constructor. You can also specify variables and functions that will be used in the expression using the methods <code class="literal">setVariable()</code> and <code class="literal">registerFunction()</code>. The use of variables and functions are described in the language reference sections <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#expressions-ref-variables" title="7.5.10&nbsp;Variables">Variables</a> and <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#expressions-ref-functions" title="7.5.11&nbsp;Functions">Functions</a>. The <code class="literal">StandardEvaluationContext</code> is also where you can register custom <code class="literal">ConstructorResolver</code> s, <code class="literal">MethodResolver</code> s, and <code class="literal">PropertyAccessor</code> s to extend how SpEL evaluates expressions. Please refer to the JavaDoc of these classes for more details.</p> 
    <div class="section" title="Type Conversion">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="expressions-type-conversion"></a>Type Conversion</h4>
       </div>
      </div>
     </div> 
     <p>By default SpEL uses the conversion service available in Spring core ( <code class="literal">org.springframework.core.convert.ConversionService</code>). This conversion service comes with many converters built in for common conversions but is also fully extensible so custom conversions between types can be added. Additionally it has the key capability that it is generics aware. This means that when working with generic types in expressions, SpEL will attempt conversions to maintain type correctness for any objects it encounters.</p> 
     <p>What does this mean in practice? Suppose assignment, using <code class="literal">setValue()</code>, is being used to set a <code class="literal">List</code> property. The type of the property is actually <code class="literal">List&lt;Boolean&gt;</code>. SpEL will recognize that the elements of the list need to be converted to <code class="literal">Boolean</code> before being placed in it. A simple example:</p> 
     <pre class="programlisting"><span class="hl-keyword">class</span> Simple {
    <span class="hl-keyword">public</span> List&lt;Boolean&gt; booleanList = <span class="hl-keyword">new</span> ArrayList&lt;Boolean&gt;();
}

Simple simple = <span class="hl-keyword">new</span> Simple();

simple.booleanList.add(true);

StandardEvaluationContext simpleContext = <span class="hl-keyword">new</span> StandardEvaluationContext(simple);

<span class="hl-comment">// false is passed in here as a string. SpEL and the conversion service will</span>
<span class="hl-comment">// correctly recognize that it needs to be a Boolean and convert it</span>
parser.parseExpression(<span class="hl-string">&quot;booleanList[0]&quot;</span>).setValue(simpleContext, <span class="hl-string">&quot;false&quot;</span>);

<span class="hl-comment">// b will be false</span>
Boolean b = simple.booleanList.get(<span class="hl-number">0</span>);</pre> 
    </div> 
   </div> 
  </div> 
  <div class="section" title="7.4&nbsp;Expression support for defining bean definitions">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="expressions-beandef"></a>7.4&nbsp;Expression support for defining bean definitions</h2>
     </div>
    </div>
   </div> 
   <p>SpEL expressions can be used with XML or annotation based configuration metadata for defining BeanDefinitions. In both cases the syntax to define the expression is of the form <code class="literal">#{ &lt;expression string&gt; }</code>.</p> 
   <div class="section" title="7.4.1&nbsp;XML based configuration">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="expressions-beandef-xml-based"></a>7.4.1&nbsp;XML based configuration</h3>
      </div>
     </div>
    </div> 
    <p>A property or constructor-arg value can be set using expressions as shown below</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;numberGuess&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.spring.samples.NumberGuess&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;randomNumber&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;#{ T(java.lang.Math).random() * 100.0 }&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- other properties --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>The variable <span class="emphasis"><em>systemProperties</em></span> is predefined, so you can use it in your expressions as shown below. Note that you do not have to prefix the predefined variable with the <span class="emphasis"><em>#</em></span> symbol in this context.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;taxCalculator&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.spring.samples.TaxCalculator&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;defaultLocale&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;#{ systemProperties[</span><span class="emphasis"><em>user.region</em></span>] }&quot;/&gt;

    <span class="hl-comment">&lt;!-- other properties --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>You can also refer to other bean properties by name, for example.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;numberGuess&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.spring.samples.NumberGuess&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;randomNumber&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;{ T(java.lang.Math).random() * 100.0 }&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- other properties --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;shapeGuess&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.spring.samples.ShapeGuess&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;initialShapeSeed&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;{ numberGuess.randomNumber }&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- other properties --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   </div> 
   <div class="section" title="7.4.2&nbsp;Annotation-based configuration">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="expressions-beandef-annotation-based"></a>7.4.2&nbsp;Annotation-based configuration</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">@Value</code> annotation can be placed on fields, methods and method/constructor parameters to specify a default value.</p> 
    <p>Here is an example to set the default value of a field variable.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">class</span> FieldValueTestBean

    @Value(<span class="hl-string">&quot;#{ systemProperties[</span><span class="emphasis"><em>user.region</em></span>] }<span class="hl-string">&quot;)
</span>    <span class="hl-keyword">private</span> String defaultLocale;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDefaultLocale(String defaultLocale) {
        <span class="hl-keyword">this</span>.defaultLocale = defaultLocale;
    }

    <span class="hl-keyword">public</span> String getDefaultLocale() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.defaultLocale;
    }

}</pre> 
    <p>The equivalent but on a property setter method is shown below.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">class</span> PropertyValueTestBean

    <span class="hl-keyword">private</span> String defaultLocale;

    @Value(<span class="hl-string">&quot;#{ systemProperties[</span><span class="emphasis"><em>user.region</em></span>] }<span class="hl-string">&quot;)
</span>    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDefaultLocale(String defaultLocale) {
        <span class="hl-keyword">this</span>.defaultLocale = defaultLocale;
    }

    <span class="hl-keyword">public</span> String getDefaultLocale() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.defaultLocale;
    }

}</pre> 
    <p>Autowired methods and constructors can also use the <code class="literal">@Value</code> annotation.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleMovieLister {

    <span class="hl-keyword">private</span> MovieFinder movieFinder;
    <span class="hl-keyword">private</span> String defaultLocale;

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> configure(MovieFinder movieFinder,
            @Value(<span class="hl-string">&quot;#{ systemProperties[</span><span class="emphasis"><em>user.region</em></span>] }<span class="hl-string">&quot;) String defaultLocale) {
</span>        <span class="hl-keyword">this</span>.movieFinder = movieFinder;
        <span class="hl-keyword">this</span>.defaultLocale = defaultLocale;
    }

    <span class="hl-comment">// ...</span>
}</pre> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MovieRecommender {

    <span class="hl-keyword">private</span> String defaultLocale;

    <span class="hl-keyword">private</span> CustomerPreferenceDao customerPreferenceDao;

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">public</span> MovieRecommender(CustomerPreferenceDao customerPreferenceDao,
            @Value(<span class="hl-string">&quot;#{systemProperties[</span><span class="emphasis"><em>user.country</em></span>]}<span class="hl-string">&quot;) String defaultLocale) {
</span>        <span class="hl-keyword">this</span>.customerPreferenceDao = customerPreferenceDao;
        <span class="hl-keyword">this</span>.defaultLocale = defaultLocale;
    }

    <span class="hl-comment">// ...</span>
}</pre> 
   </div> 
  </div> 
  <div class="section" title="7.5&nbsp;Language Reference">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="expressions-language-ref"></a>7.5&nbsp;Language Reference</h2>
     </div>
    </div>
   </div> 
   <div class="section" title="7.5.1&nbsp;Literal expressions">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="expressions-ref-literal"></a>7.5.1&nbsp;Literal expressions</h3>
      </div>
     </div>
    </div> 
    <p>The types of literal expressions supported are strings, dates, numeric values (int, real, and hex), boolean and null. Strings are delimited by single quotes. To put a single quote itself in a string use two single quote characters. The following listing shows simple usage of literals. Typically they would not be used in isolation like this, but as part of a more complex expression, for example using a literal on one side of a logical comparison operator.</p> 
    <pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();

<span class="hl-comment">// evals to &quot;Hello World&quot;</span>
String helloWorld = (String) parser.parseExpression(<span class="hl-string">&quot;</span><span class="emphasis"><em>Hello World</em></span><span class="hl-string">&quot;).getValue();
</span>
<span class="hl-keyword">double</span> avogadrosNumber = (Double) parser.parseExpression(<span class="hl-string">&quot;6.0221415E+23&quot;</span>).getValue();

<span class="hl-comment">// evals to 2147483647</span>
<span class="hl-keyword">int</span> maxValue = (Integer) parser.parseExpression(<span class="hl-string">&quot;0x7FFFFFFF&quot;</span>).getValue();

<span class="hl-keyword">boolean</span> trueValue = (Boolean) parser.parseExpression(<span class="hl-string">&quot;true&quot;</span>).getValue();

Object nullValue = parser.parseExpression(<span class="hl-string">&quot;null&quot;</span>).getValue();</pre> 
    <p>Numbers support the use of the negative sign, exponential notation, and decimal points. By default real numbers are parsed using Double.parseDouble().</p> 
   </div> 
   <div class="section" title="7.5.2&nbsp;Properties, Arrays, Lists, Maps, Indexers">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="expressions-properties-arrays"></a>7.5.2&nbsp;Properties, Arrays, Lists, Maps, Indexers</h3>
      </div>
     </div>
    </div> 
    <p>Navigating with property references is easy, just use a period to indicate a nested property value. The instances of Inventor class, pupin and tesla, were populated with data listed in the section <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#expressions-example-classes" title="7.6&nbsp;Classes used in the examples">Classes used in the examples</a>. To navigate &quot;down&quot; and get Teslas year of birth and Pupins city of birth the following expressions are used.</p> 
    <pre class="programlisting"><span class="hl-comment">// evals to 1856</span>
<span class="hl-keyword">int</span> year = (Integer) parser.parseExpression(<span class="hl-string">&quot;Birthdate.Year + 1900&quot;</span>).getValue(context);

String city = (String) parser.parseExpression(<span class="hl-string">&quot;placeOfBirth.City&quot;</span>).getValue(context);</pre> 
    <p>Case insensitivity is allowed for the first letter of property names. The contents of arrays and lists are obtained using square bracket notation.</p> 
    <pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();

<span class="hl-comment">// Inventions Array</span>
StandardEvaluationContext teslaContext = <span class="hl-keyword">new</span> StandardEvaluationContext(tesla);

<span class="hl-comment">// evaluates to &quot;Induction motor&quot;</span>
String invention = parser.parseExpression(<span class="hl-string">&quot;inventions[3]&quot;</span>).getValue(
        teslaContext, String.<span class="hl-keyword">class</span>);

<span class="hl-comment">// Members List</span>
StandardEvaluationContext societyContext = <span class="hl-keyword">new</span> StandardEvaluationContext(ieee);

<span class="hl-comment">// evaluates to &quot;Nikola Tesla&quot;</span>
String name = parser.parseExpression(<span class="hl-string">&quot;Members[0].Name&quot;</span>).getValue(
        societyContext, String.<span class="hl-keyword">class</span>);

<span class="hl-comment">// List and Array navigation</span>
<span class="hl-comment">// evaluates to &quot;Wireless communication&quot;</span>
String invention = parser.parseExpression(<span class="hl-string">&quot;Members[0].Inventions[6]&quot;</span>).getValue(
        societyContext, String.<span class="hl-keyword">class</span>);</pre> 
    <p>The contents of maps are obtained by specifying the literal key value within the brackets. In this case, because keys for the Officers map are strings, we can specify string literals.</p> 
    <pre class="programlisting"><span class="hl-comment">// Officer's Dictionary</span>

Inventor pupin = parser.parseExpression(<span class="hl-string">&quot;Officers[</span><span class="emphasis"><em>president</em></span>]<span class="hl-string">&quot;).getValue(
</span>        societyContext, Inventor.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to &quot;Idvor&quot;</span>
String city = parser.parseExpression(<span class="hl-string">&quot;Officers[</span><span class="emphasis"><em>president</em></span>].PlaceOfBirth.City<span class="hl-string">&quot;).getValue(
</span>        societyContext, String.<span class="hl-keyword">class</span>);

<span class="hl-comment">// setting values</span>
parser.parseExpression(<span class="hl-string">&quot;Officers[</span><span class="emphasis"><em>advisors</em></span>][<span class="hl-number">0</span>].PlaceOfBirth.Country<span class="hl-string">&quot;).setValue(
</span>        societyContext, <span class="hl-string">&quot;Croatia&quot;</span>);</pre> 
   </div> 
   <div class="section" title="7.5.3&nbsp;Inline lists">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="expressions-inline-lists"></a>7.5.3&nbsp;Inline lists</h3>
      </div>
     </div>
    </div> 
    <p>Lists can be expressed directly in an expression using {} notation.</p> 
    <pre class="programlisting"><span class="hl-comment">// evaluates to a Java list containing the four numbers</span>
List numbers = (List) parser.parseExpression(<span class="hl-string">&quot;{1,2,3,4}&quot;</span>).getValue(context);

List listOfLists = (List) parser.parseExpression(<span class="hl-string">&quot;{{</span><span class="emphasis"><em>a</em></span>,<span class="emphasis"><em>b</em></span>},{<span class="emphasis"><em>x</em></span>,<span class="emphasis"><em>y</em></span>}}<span class="hl-string">&quot;).getValue(context);</span></pre> 
    <p>{} by itself means an empty list. For performance reasons, if the list is itself entirely composed of fixed literals then a constant list is created to represent the expression, rather than building a new list on each evaluation.</p> 
   </div> 
   <div class="section" title="7.5.4&nbsp;Array construction">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="expressions-array-construction"></a>7.5.4&nbsp;Array construction</h3>
      </div>
     </div>
    </div> 
    <p>Arrays can be built using the familiar Java syntax, optionally supplying an initializer to have the array populated at construction time.</p> 
    <pre class="programlisting"><span class="hl-keyword">int</span>[] numbers1 = (<span class="hl-keyword">int</span>[]) parser.parseExpression(<span class="hl-string">&quot;new int[4]&quot;</span>).getValue(context);

<span class="hl-comment">// Array with initializer</span>
<span class="hl-keyword">int</span>[] numbers2 = (<span class="hl-keyword">int</span>[]) parser.parseExpression(<span class="hl-string">&quot;new int[]{1,2,3}&quot;</span>).getValue(context);

<span class="hl-comment">// Multi dimensional array</span>
<span class="hl-keyword">int</span>[][] numbers3 = (<span class="hl-keyword">int</span>[][]) parser.parseExpression(<span class="hl-string">&quot;new int[4][5]&quot;</span>).getValue(context);</pre> 
    <p>It is not currently allowed to supply an initializer when constructing a multi-dimensional array.</p> 
   </div> 
   <div class="section" title="7.5.5&nbsp;Methods">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="expressions-methods"></a>7.5.5&nbsp;Methods</h3>
      </div>
     </div>
    </div> 
    <p>Methods are invoked using typical Java programming syntax. You may also invoke methods on literals. Varargs are also supported.</p> 
    <pre class="programlisting"><span class="hl-comment">// string literal, evaluates to &quot;bc&quot;</span>
String c = parser.parseExpression(<span class="hl-string">&quot;</span><span class="emphasis"><em>abc</em></span>.substring(<span class="hl-number">2</span>, <span class="hl-number">3</span>)<span class="hl-string">&quot;).getValue(String.class);
</span>
<span class="hl-comment">// evaluates to true</span>
<span class="hl-keyword">boolean</span> isMember = parser.parseExpression(<span class="hl-string">&quot;isMember(</span><span class="emphasis"><em>Mihajlo Pupin</em></span>)<span class="hl-string">&quot;).getValue(
</span>        societyContext, Boolean.<span class="hl-keyword">class</span>);</pre> 
   </div> 
   <div class="section" title="7.5.6&nbsp;Operators">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="expressions-operators"></a>7.5.6&nbsp;Operators</h3>
      </div>
     </div>
    </div> 
    <div class="section" title="Relational operators">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="expressions-operators-relational"></a>Relational operators</h4>
       </div>
      </div>
     </div> 
     <p>The relational operators; equal, not equal, less than, less than or equal, greater than, and greater than or equal are supported using standard operator notation.</p> 
     <pre class="programlisting"><span class="hl-comment">// evaluates to true</span>
<span class="hl-keyword">boolean</span> trueValue = parser.parseExpression(<span class="hl-string">&quot;2 == 2&quot;</span>).getValue(Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to false</span>
<span class="hl-keyword">boolean</span> falseValue = parser.parseExpression(<span class="hl-string">&quot;2 &lt; -5.0&quot;</span>).getValue(Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to true</span>
<span class="hl-keyword">boolean</span> trueValue = parser.parseExpression(<span class="hl-string">&quot;</span><span class="emphasis"><em>black</em></span> &lt; <span class="emphasis"><em>block</em></span><span class="hl-string">&quot;).getValue(Boolean.class);</span></pre> 
     <p>In addition to standard relational operators SpEL supports the <span class="emphasis"><em>instanceof</em></span> and regular expression based <span class="emphasis"><em>matches</em></span> operator.</p> 
     <pre class="programlisting"><span class="hl-comment">// evaluates to false</span>
<span class="hl-keyword">boolean</span> falseValue = parser.parseExpression(
        <span class="hl-string">&quot;'xyz' instanceof T(int)&quot;</span>).getValue(Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to true</span>
<span class="hl-keyword">boolean</span> trueValue = parser.parseExpression(
        <span class="hl-string">&quot;'5.00' matches '^-?\\d+(\\.\\d{2})?$'&quot;</span>).getValue(Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">//evaluates to false</span>
<span class="hl-keyword">boolean</span> falseValue = parser.parseExpression(
        <span class="hl-string">&quot;'5.0067' matches '^-?\\d+(\\.\\d{2})?$'&quot;</span>).getValue(Boolean.<span class="hl-keyword">class</span>);</pre> 
     <p>Each symbolic operator can also be specified as a purely alphabetic equivalent. This avoids problems where the symbols used have special meaning for the document type in which the expression is embedded (eg. an XML document). The textual equivalents are shown here: lt (<span class="emphasis"><em>&lt;</em></span>), gt (<span class="emphasis"><em>&gt;</em></span>), le (<span class="emphasis"><em>&#x21d0;</em></span>), ge (<span class="emphasis"><em>&gt;=</em></span>), eq (<span class="emphasis"><em>==</em></span>), ne (<span class="emphasis"><em>!=</em></span>), div (<span class="emphasis"><em>/</em></span>), mod (<span class="emphasis"><em>%</em></span>), not (<span class="emphasis"><em>!</em></span>). These are case insensitive.</p> 
    </div> 
    <div class="section" title="Logical operators">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="expressions-operators-logical"></a>Logical operators</h4>
       </div>
      </div>
     </div> 
     <p>The logical operators that are supported are and, or, and not. Their use is demonstrated below.</p> 
     <pre class="programlisting"><span class="hl-comment">// -- AND --</span>

<span class="hl-comment">// evaluates to false</span>
<span class="hl-keyword">boolean</span> falseValue = parser.parseExpression(<span class="hl-string">&quot;true and false&quot;</span>).getValue(Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to true</span>
String expression = <span class="hl-string">&quot;isMember(</span><span class="emphasis"><em>Nikola Tesla</em></span>) and isMember(<span class="emphasis"><em>Mihajlo Pupin</em></span>)<span class="hl-string">&quot;;
</span><span class="hl-keyword">boolean</span> trueValue = parser.parseExpression(expression).getValue(societyContext, Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// -- OR --</span>

<span class="hl-comment">// evaluates to true</span>
<span class="hl-keyword">boolean</span> trueValue = parser.parseExpression(<span class="hl-string">&quot;true or false&quot;</span>).getValue(Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to true</span>
String expression = <span class="hl-string">&quot;isMember(</span><span class="emphasis"><em>Nikola Tesla</em></span>) or isMember(<span class="emphasis"><em>Albert Einstein</em></span>)<span class="hl-string">&quot;;
</span><span class="hl-keyword">boolean</span> trueValue = parser.parseExpression(expression).getValue(societyContext, Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// -- NOT --</span>

<span class="hl-comment">// evaluates to false</span>
<span class="hl-keyword">boolean</span> falseValue = parser.parseExpression(<span class="hl-string">&quot;!true&quot;</span>).getValue(Boolean.<span class="hl-keyword">class</span>);

<span class="hl-comment">// -- AND and NOT --</span>
String expression = <span class="hl-string">&quot;isMember(</span><span class="emphasis"><em>Nikola Tesla</em></span>) and !isMember(<span class="emphasis"><em>Mihajlo Pupin</em></span>)<span class="hl-string">&quot;;
</span><span class="hl-keyword">boolean</span> falseValue = parser.parseExpression(expression).getValue(societyContext, Boolean.<span class="hl-keyword">class</span>);</pre> 
    </div> 
    <div class="section" title="Mathematical operators">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="expressions-operators-mathematical"></a>Mathematical operators</h4>
       </div>
      </div>
     </div> 
     <p>The addition operator can be used on both numbers and strings. Subtraction, multiplication and division can be used only on numbers. Other mathematical operators supported are modulus (%) and exponential power (^). Standard operator precedence is enforced. These operators are demonstrated below.</p> 
     <pre class="programlisting"><span class="hl-comment">// Addition</span>
<span class="hl-keyword">int</span> two = parser.parseExpression(<span class="hl-string">&quot;1 + 1&quot;</span>).getValue(Integer.<span class="hl-keyword">class</span>); <span class="hl-comment">// 2</span>

String testString = parser.parseExpression(
        <span class="hl-string">&quot;</span><span class="emphasis"><em>test</em></span> + <span class="hl-string">' '</span> + <span class="emphasis"><em>string</em></span><span class="hl-string">&quot;).getValue(String.class); // </span><span class="emphasis"><em>test string</em></span>

<span class="hl-comment">// Subtraction</span>
<span class="hl-keyword">int</span> four = parser.parseExpression(<span class="hl-string">&quot;1 - -3&quot;</span>).getValue(Integer.<span class="hl-keyword">class</span>); <span class="hl-comment">// 4</span>

<span class="hl-keyword">double</span> d = parser.parseExpression(<span class="hl-string">&quot;1000.00 - 1e4&quot;</span>).getValue(Double.<span class="hl-keyword">class</span>); <span class="hl-comment">// -9000</span>

<span class="hl-comment">// Multiplication</span>
<span class="hl-keyword">int</span> six = parser.parseExpression(<span class="hl-string">&quot;-2 * -3&quot;</span>).getValue(Integer.<span class="hl-keyword">class</span>); <span class="hl-comment">// 6</span>

<span class="hl-keyword">double</span> twentyFour = parser.parseExpression(<span class="hl-string">&quot;2.0 * 3e0 * 4&quot;</span>).getValue(Double.<span class="hl-keyword">class</span>); <span class="hl-comment">// 24.0</span>

<span class="hl-comment">// Division</span>
<span class="hl-keyword">int</span> minusTwo = parser.parseExpression(<span class="hl-string">&quot;6 / -3&quot;</span>).getValue(Integer.<span class="hl-keyword">class</span>); <span class="hl-comment">// -2</span>

<span class="hl-keyword">double</span> one = parser.parseExpression(<span class="hl-string">&quot;8.0 / 4e0 / 2&quot;</span>).getValue(Double.<span class="hl-keyword">class</span>); <span class="hl-comment">// 1.0</span>

<span class="hl-comment">// Modulus</span>
<span class="hl-keyword">int</span> three = parser.parseExpression(<span class="hl-string">&quot;7 % 4&quot;</span>).getValue(Integer.<span class="hl-keyword">class</span>); <span class="hl-comment">// 3</span>

<span class="hl-keyword">int</span> one = parser.parseExpression(<span class="hl-string">&quot;8 / 5 % 2&quot;</span>).getValue(Integer.<span class="hl-keyword">class</span>); <span class="hl-comment">// 1</span>

<span class="hl-comment">// Operator precedence</span>
<span class="hl-keyword">int</span> minusTwentyOne = parser.parseExpression(<span class="hl-string">&quot;1+2-3*8&quot;</span>).getValue(Integer.<span class="hl-keyword">class</span>); <span class="hl-comment">// -21</span></pre> 
    </div> 
   </div> 
   <div class="section" title="7.5.7&nbsp;Assignment">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="expressions-assignment"></a>7.5.7&nbsp;Assignment</h3>
      </div>
     </div>
    </div> 
    <p>Setting of a property is done by using the assignment operator. This would typically be done within a call to <code class="literal">setValue</code> but can also be done inside a call to <code class="literal">getValue</code>.</p> 
    <pre class="programlisting">Inventor inventor = <span class="hl-keyword">new</span> Inventor();
StandardEvaluationContext inventorContext = <span class="hl-keyword">new</span> StandardEvaluationContext(inventor);

parser.parseExpression(<span class="hl-string">&quot;Name&quot;</span>).setValue(inventorContext, <span class="hl-string">&quot;Alexander Seovic2&quot;</span>);

<span class="hl-comment">// alternatively</span>

String aleks = parser.parseExpression(
        <span class="hl-string">&quot;Name = </span><span class="emphasis"><em>Alexandar Seovic</em></span><span class="hl-string">&quot;).getValue(inventorContext, String.class);</span></pre> 
   </div> 
   <div class="section" title="7.5.8&nbsp;Types">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="expressions-types"></a>7.5.8&nbsp;Types</h3>
      </div>
     </div>
    </div> 
    <p>The special <span class="emphasis"><em>T</em></span> operator can be used to specify an instance of java.lang.Class (the <span class="emphasis"><em>type</em></span>). Static methods are invoked using this operator as well. The <code class="literal">StandardEvaluationContext</code> uses a <code class="literal">TypeLocator</code> to find types and the <code class="literal">StandardTypeLocator</code> (which can be replaced) is built with an understanding of the java.lang package. This means T() references to types within java.lang do not need to be fully qualified, but all other type references must be.</p> 
    <pre class="programlisting">Class dateClass = parser.parseExpression(<span class="hl-string">&quot;T(java.util.Date)&quot;</span>).getValue(Class.<span class="hl-keyword">class</span>);

Class stringClass = parser.parseExpression(<span class="hl-string">&quot;T(String)&quot;</span>).getValue(Class.<span class="hl-keyword">class</span>);

<span class="hl-keyword">boolean</span> trueValue = parser.parseExpression(
        <span class="hl-string">&quot;T(java.math.RoundingMode).CEILING &lt; T(java.math.RoundingMode).FLOOR&quot;</span>)
        .getValue(Boolean.<span class="hl-keyword">class</span>);</pre> 
   </div> 
   <div class="section" title="7.5.9&nbsp;Constructors">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="expressions-constructors"></a>7.5.9&nbsp;Constructors</h3>
      </div>
     </div>
    </div> 
    <p>Constructors can be invoked using the new operator. The fully qualified class name should be used for all but the primitive type and String (where int, float, etc, can be used).</p> 
    <pre class="programlisting">Inventor einstein = p.parseExpression(
        <span class="hl-string">&quot;new org.spring.samples.spel.inventor.Inventor(</span><span class="emphasis"><em>Albert Einstein</em></span>, <span class="emphasis"><em>German</em></span>)<span class="hl-string">&quot;)
</span>        .getValue(Inventor.<span class="hl-keyword">class</span>);

<span class="hl-comment">//create new inventor instance within add method of List</span>
p.parseExpression(
        <span class="hl-string">&quot;Members.add(new org.spring.samples.spel.inventor.Inventor(
</span>            <span class="emphasis"><em>Albert Einstein</em></span>, <span class="emphasis"><em>German</em></span>))<span class="hl-string">&quot;).getValue(societyContext);</span></pre> 
   </div> 
   <div class="section" title="7.5.10&nbsp;Variables">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="expressions-ref-variables"></a>7.5.10&nbsp;Variables</h3>
      </div>
     </div>
    </div> 
    <p>Variables can be referenced in the expression using the syntax #variableName. Variables are set using the method setVariable on the StandardEvaluationContext.</p> 
    <pre class="programlisting">Inventor tesla = <span class="hl-keyword">new</span> Inventor(<span class="hl-string">&quot;Nikola Tesla&quot;</span>, <span class="hl-string">&quot;Serbian&quot;</span>);
StandardEvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext(tesla);
context.setVariable(<span class="hl-string">&quot;newName&quot;</span>, <span class="hl-string">&quot;Mike Tesla&quot;</span>);

parser.parseExpression(<span class="hl-string">&quot;Name = #newName&quot;</span>).getValue(context);

System.out.println(tesla.getName()) <span class="hl-comment">// &quot;Mike Tesla&quot;</span></pre> 
    <div class="section" title="The #this and #root variables">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="expressions-this-root"></a>The #this and #root variables</h4>
       </div>
      </div>
     </div> 
     <p>The variable #this is always defined and refers to the current evaluation object (against which unqualified references are resolved). The variable #root is always defined and refers to the root context object. Although #this may vary as components of an expression are evaluated, #root always refers to the root.</p> 
     <pre class="programlisting"><span class="hl-comment">// create an array of integers</span>
List&lt;Integer&gt; primes = <span class="hl-keyword">new</span> ArrayList&lt;Integer&gt;();
primes.addAll(Arrays.asList(<span class="hl-number">2</span>,<span class="hl-number">3</span>,<span class="hl-number">5</span>,<span class="hl-number">7</span>,<span class="hl-number">11</span>,<span class="hl-number">13</span>,<span class="hl-number">17</span>));

<span class="hl-comment">// create parser and set variable </span><span class="emphasis"><em>primes</em></span> as the array of integers
ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
StandardEvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext();
context.setVariable(<span class="hl-string">&quot;primes&quot;</span>,primes);

<span class="hl-comment">// all prime numbers &gt; 10 from the list (using selection ?{...})</span>
<span class="hl-comment">// evaluates to [11, 13, 17]</span>
List&lt;Integer&gt; primesGreaterThanTen = (List&lt;Integer&gt;) parser.parseExpression(
        <span class="hl-string">&quot;#primes.?[#this&gt;10]&quot;</span>).getValue(context);</pre> 
    </div> 
   </div> 
   <div class="section" title="7.5.11&nbsp;Functions">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="expressions-ref-functions"></a>7.5.11&nbsp;Functions</h3>
      </div>
     </div>
    </div> 
    <p>You can extend SpEL by registering user defined functions that can be called within the expression string. The function is registered with the <code class="literal">StandardEvaluationContext</code> using the method.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">void</span> registerFunction(String name, Method m)</pre> 
    <p>A reference to a Java Method provides the implementation of the function. For example, a utility method to reverse a string is shown below.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> StringUtils {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> String reverseString(String input) {
        StringBuilder backwards = <span class="hl-keyword">new</span> StringBuilder();
        <span class="hl-keyword">for</span> (<span class="hl-keyword">int</span> i = <span class="hl-number">0</span>; i &lt; input.length(); i++)
            backwards.append(input.charAt(input.length() - <span class="hl-number">1</span> - i));
        }
        <span class="hl-keyword">return</span> backwards.toString();
    }
}</pre> 
    <p>This method is then registered with the evaluation context and can be used within an expression string.</p> 
    <pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
StandardEvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext();

context.registerFunction(<span class="hl-string">&quot;reverseString&quot;</span>,
    StringUtils.<span class="hl-keyword">class</span>.getDeclaredMethod(<span class="hl-string">&quot;reverseString&quot;</span>, <span class="hl-keyword">new</span> Class[] { String.<span class="hl-keyword">class</span> }));

String helloWorldReversed = parser.parseExpression(
    <span class="hl-string">&quot;#reverseString(</span><span class="emphasis"><em>hello</em></span>)<span class="hl-string">&quot;).getValue(context, String.class);</span></pre> 
   </div> 
   <div class="section" title="7.5.12&nbsp;Bean references">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="expressions-bean-references"></a>7.5.12&nbsp;Bean references</h3>
      </div>
     </div>
    </div> 
    <p>If the evaluation context has been configured with a bean resolver it is possible to lookup beans from an expression using the (@) symbol.</p> 
    <pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();
StandardEvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext();
context.setBeanResolver(<span class="hl-keyword">new</span> MyBeanResolver());

<span class="hl-comment">// This will end up calling resolve(context,&quot;foo&quot;) on MyBeanResolver during evaluation</span>
Object bean = parser.parseExpression(<span class="hl-string">&quot;@foo&quot;</span>).getValue(context);</pre> 
   </div> 
   <div class="section" title="7.5.13&nbsp;Ternary Operator (If-Then-Else)">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="expressions-operator-ternary"></a>7.5.13&nbsp;Ternary Operator (If-Then-Else)</h3>
      </div>
     </div>
    </div> 
    <p>You can use the ternary operator for performing if-then-else conditional logic inside the expression. A minimal example is:</p> 
    <pre class="programlisting">String falseString = parser.parseExpression(
        <span class="hl-string">&quot;false ? </span><span class="emphasis"><em>trueExp</em></span> : <span class="emphasis"><em>falseExp</em></span><span class="hl-string">&quot;).getValue(String.class);</span></pre> 
    <p>In this case, the boolean false results in returning the string value <span class="emphasis"><em>falseExp</em></span>. A more realistic example is shown below.</p> 
    <pre class="programlisting">parser.parseExpression(<span class="hl-string">&quot;Name&quot;</span>).setValue(societyContext, <span class="hl-string">&quot;IEEE&quot;</span>);
societyContext.setVariable(<span class="hl-string">&quot;queryName&quot;</span>, <span class="hl-string">&quot;Nikola Tesla&quot;</span>);

expression = <span class="hl-string">&quot;isMember(#queryName)? #queryName + ' is a member of the ' &quot;</span> +
        <span class="hl-string">&quot;+ Name + ' Society' : #queryName + ' is not a member of the ' + Name + ' Society'&quot;</span>;

String queryResultString = parser.parseExpression(expression)
        .getValue(societyContext, String.<span class="hl-keyword">class</span>);
<span class="hl-comment">// queryResultString = &quot;Nikola Tesla is a member of the IEEE Society&quot;</span></pre> 
    <p>Also see the next section on the Elvis operator for an even shorter syntax for the ternary operator.</p> 
   </div> 
   <div class="section" title="7.5.14&nbsp;The Elvis Operator">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="expressions-operator-elvis"></a>7.5.14&nbsp;The Elvis Operator</h3>
      </div>
     </div>
    </div> 
    <p>The Elvis operator is a shortening of the ternary operator syntax and is used in the <a class="ulink" href="http://groovy.codehaus.org/Operators#Operators-ElvisOperator(%3F%3A)" target="_top">Groovy</a> language. With the ternary operator syntax you usually have to repeat a variable twice, for example:</p> 
    <pre class="programlisting">String name = &quot;Elvis Presley&quot;;
String displayName = name != null ? name : &quot;Unknown&quot;;</pre> 
    <p>Instead you can use the Elvis operator, named for the resemblance to Elvis' hair style.</p> 
    <pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();

String name = parser.parseExpression(<span class="hl-string">&quot;null?:'Unknown'&quot;</span>).getValue(String.<span class="hl-keyword">class</span>);

System.out.println(name); <span class="hl-comment">// </span><span class="emphasis"><em>Unknown</em></span></pre> 
    <p>Here is a more complex example.</p> 
    <pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();

Inventor tesla = <span class="hl-keyword">new</span> Inventor(<span class="hl-string">&quot;Nikola Tesla&quot;</span>, <span class="hl-string">&quot;Serbian&quot;</span>);
StandardEvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext(tesla);

String name = parser.parseExpression(<span class="hl-string">&quot;Name?:'Elvis Presley'&quot;</span>).getValue(context, String.<span class="hl-keyword">class</span>);

System.out.println(name); <span class="hl-comment">// Nikola Tesla</span>

tesla.setName(null);

name = parser.parseExpression(<span class="hl-string">&quot;Name?:'Elvis Presley'&quot;</span>).getValue(context, String.<span class="hl-keyword">class</span>);

System.out.println(name); <span class="hl-comment">// Elvis Presley</span></pre> 
   </div> 
   <div class="section" title="7.5.15&nbsp;Safe Navigation operator">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="expressions-operator-safe-navigation"></a>7.5.15&nbsp;Safe Navigation operator</h3>
      </div>
     </div>
    </div> 
    <p>The Safe Navigation operator is used to avoid a <code class="literal">NullPointerException</code> and comes from the <a class="ulink" href="http://groovy.codehaus.org/Operators#Operators-SafeNavigationOperator(%3F.)" target="_top">Groovy</a> language. Typically when you have a reference to an object you might need to verify that it is not null before accessing methods or properties of the object. To avoid this, the safe navigation operator will simply return null instead of throwing an exception.</p> 
    <pre class="programlisting">ExpressionParser parser = <span class="hl-keyword">new</span> SpelExpressionParser();

Inventor tesla = <span class="hl-keyword">new</span> Inventor(<span class="hl-string">&quot;Nikola Tesla&quot;</span>, <span class="hl-string">&quot;Serbian&quot;</span>);
tesla.setPlaceOfBirth(<span class="hl-keyword">new</span> PlaceOfBirth(<span class="hl-string">&quot;Smiljan&quot;</span>));

StandardEvaluationContext context = <span class="hl-keyword">new</span> StandardEvaluationContext(tesla);

String city = parser.parseExpression(<span class="hl-string">&quot;PlaceOfBirth?.City&quot;</span>).getValue(context, String.<span class="hl-keyword">class</span>);
System.out.println(city); <span class="hl-comment">// Smiljan</span>

tesla.setPlaceOfBirth(null);

city = parser.parseExpression(<span class="hl-string">&quot;PlaceOfBirth?.City&quot;</span>).getValue(context, String.<span class="hl-keyword">class</span>);

System.out.println(city); <span class="hl-comment">// null - does not throw NullPointerException!!!</span></pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>The Elvis operator can be used to apply default values in expressions, e.g. in an <code class="literal">@Value</code> expression:</p> <pre class="programlisting">@Value(<span class="hl-string">&quot;#{systemProperties[</span><span class="emphasis"><em>pop3.port</em></span>] ?: <span class="hl-number">25</span>}<span class="hl-string">&quot;)</span></pre> <p>This will inject a system property <code class="literal">pop3.port</code> if it is defined or 25 if not.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="7.5.16&nbsp;Collection Selection">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="expressions-collection-selection"></a>7.5.16&nbsp;Collection Selection</h3>
      </div>
     </div>
    </div> 
    <p>Selection is a powerful expression language feature that allows you to transform some source collection into another by selecting from its entries.</p> 
    <p>Selection uses the syntax <code class="literal">?[selectionExpression]</code>. This will filter the collection and return a new collection containing a subset of the original elements. For example, selection would allow us to easily get a list of Serbian inventors:</p> 
    <pre class="programlisting">List&lt;Inventor&gt; list = (List&lt;Inventor&gt;) parser.parseExpression(
        <span class="hl-string">&quot;Members.?[Nationality == </span><span class="emphasis"><em>Serbian</em></span>]<span class="hl-string">&quot;).getValue(societyContext);</span></pre> 
    <p>Selection is possible upon both lists and maps. In the former case the selection criteria is evaluated against each individual list element whilst against a map the selection criteria is evaluated against each map entry (objects of the Java type <code class="literal">Map.Entry</code>). Map entries have their key and value accessible as properties for use in the selection.</p> 
    <p>This expression will return a new map consisting of those elements of the original map where the entry value is less than 27.</p> 
    <pre class="programlisting">Map newMap = parser.parseExpression(<span class="hl-string">&quot;map.?[value&lt;27]&quot;</span>).getValue();</pre> 
    <p>In addition to returning all the selected elements, it is possible to retrieve just the first or the last value. To obtain the first entry matching the selection the syntax is <code class="literal">^[...]</code> whilst to obtain the last matching selection the syntax is <code class="literal">$[...]</code>.</p> 
   </div> 
   <div class="section" title="7.5.17&nbsp;Collection Projection">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="expressions-collection-projection"></a>7.5.17&nbsp;Collection Projection</h3>
      </div>
     </div>
    </div> 
    <p>Projection allows a collection to drive the evaluation of a sub-expression and the result is a new collection. The syntax for projection is <code class="literal">![projectionExpression]</code>. Most easily understood by example, suppose we have a list of inventors but want the list of cities where they were born. Effectively we want to evaluate <span class="emphasis"><em>placeOfBirth.city</em></span> for every entry in the inventor list. Using projection:</p> 
    <pre class="programlisting"><span class="hl-comment">// returns [</span><span class="emphasis"><em>Smiljan</em></span>, <span class="emphasis"><em>Idvor</em></span> ]
List placesOfBirth = (List)parser.parseExpression(<span class="hl-string">&quot;Members.![placeOfBirth.city]&quot;</span>);</pre> 
    <p>A map can also be used to drive projection and in this case the projection expression is evaluated against each entry in the map (represented as a Java <code class="literal">Map.Entry</code>). The result of a projection across a map is a list consisting of the evaluation of the projection expression against each map entry.</p> 
   </div> 
   <div class="section" title="7.5.18&nbsp;Expression templating">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="expressions-templating"></a>7.5.18&nbsp;Expression templating</h3>
      </div>
     </div>
    </div> 
    <p>Expression templates allow a mixing of literal text with one or more evaluation blocks. Each evaluation block is delimited with prefix and suffix characters that you can define, a common choice is to use <code class="literal">#{ }</code> as the delimiters. For example,</p> 
    <pre class="programlisting">String randomPhrase = parser.parseExpression(
        <span class="hl-string">&quot;random number is #{T(java.lang.Math).random()}&quot;</span>,
        <span class="hl-keyword">new</span> TemplateParserContext()).getValue(String.<span class="hl-keyword">class</span>);

<span class="hl-comment">// evaluates to &quot;random number is 0.7038186818312008&quot;</span></pre> 
    <p>The string is evaluated by concatenating the literal text 'random number is ' with the result of evaluating the expression inside the #{ } delimiter, in this case the result of calling that random() method. The second argument to the method <code class="literal">parseExpression()</code> is of the type <code class="literal">ParserContext</code>. The <code class="literal">ParserContext</code> interface is used to influence how the expression is parsed in order to support the expression templating functionality. The definition of <code class="literal">TemplateParserContext</code> is shown below.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TemplateParserContext <span class="hl-keyword">implements</span> ParserContext {

    <span class="hl-keyword">public</span> String getExpressionPrefix() {
        <span class="hl-keyword">return</span> <span class="hl-string">&quot;#{&quot;</span>;
    }

    <span class="hl-keyword">public</span> String getExpressionSuffix() {
        <span class="hl-keyword">return</span> <span class="hl-string">&quot;}&quot;</span>;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> isTemplate() {
        <span class="hl-keyword">return</span> true;
    }
}</pre> 
   </div> 
  </div> 
  <div class="section" title="7.6&nbsp;Classes used in the examples">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="expressions-example-classes"></a>7.6&nbsp;Classes used in the examples</h2>
     </div>
    </div>
   </div> 
   <p>Inventor.java</p> 
   <pre class="programlisting"><span class="hl-keyword">package</span> org.spring.samples.spel.inventor;

<span class="hl-keyword">import</span> java.util.Date;
<span class="hl-keyword">import</span> java.util.GregorianCalendar;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Inventor {

    <span class="hl-keyword">private</span> String name;
    <span class="hl-keyword">private</span> String nationality;
    <span class="hl-keyword">private</span> String[] inventions;
    <span class="hl-keyword">private</span> Date birthdate;
    <span class="hl-keyword">private</span> PlaceOfBirth placeOfBirth;

    <span class="hl-keyword">public</span> Inventor(String name, String nationality) {
        GregorianCalendar c= <span class="hl-keyword">new</span> GregorianCalendar();
        <span class="hl-keyword">this</span>.name = name;
        <span class="hl-keyword">this</span>.nationality = nationality;
        <span class="hl-keyword">this</span>.birthdate = c.getTime();
    }

    <span class="hl-keyword">public</span> Inventor(String name, Date birthdate, String nationality) {
        <span class="hl-keyword">this</span>.name = name;
        <span class="hl-keyword">this</span>.nationality = nationality;
        <span class="hl-keyword">this</span>.birthdate = birthdate;
    }

    <span class="hl-keyword">public</span> Inventor() {
    }

    <span class="hl-keyword">public</span> String getName() {
        <span class="hl-keyword">return</span> name;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(String name) {
        <span class="hl-keyword">this</span>.name = name;
    }

    <span class="hl-keyword">public</span> String getNationality() {
        <span class="hl-keyword">return</span> nationality;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setNationality(String nationality) {
        <span class="hl-keyword">this</span>.nationality = nationality;
    }

    <span class="hl-keyword">public</span> Date getBirthdate() {
        <span class="hl-keyword">return</span> birthdate;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setBirthdate(Date birthdate) {
        <span class="hl-keyword">this</span>.birthdate = birthdate;
    }

    <span class="hl-keyword">public</span> PlaceOfBirth getPlaceOfBirth() {
        <span class="hl-keyword">return</span> placeOfBirth;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setPlaceOfBirth(PlaceOfBirth placeOfBirth) {
        <span class="hl-keyword">this</span>.placeOfBirth = placeOfBirth;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setInventions(String[] inventions) {
        <span class="hl-keyword">this</span>.inventions = inventions;
    }

    <span class="hl-keyword">public</span> String[] getInventions() {
        <span class="hl-keyword">return</span> inventions;
    }
}</pre> 
   <p>PlaceOfBirth.java</p> 
   <pre class="programlisting"><span class="hl-keyword">package</span> org.spring.samples.spel.inventor;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> PlaceOfBirth {

    <span class="hl-keyword">private</span> String city;
    <span class="hl-keyword">private</span> String country;

    <span class="hl-keyword">public</span> PlaceOfBirth(String city) {
        <span class="hl-keyword">this</span>.city=city;
    }

    <span class="hl-keyword">public</span> PlaceOfBirth(String city, String country) {
        <span class="hl-keyword">this</span>(city);
        <span class="hl-keyword">this</span>.country = country;
    }

    <span class="hl-keyword">public</span> String getCity() {
        <span class="hl-keyword">return</span> city;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setCity(String s) {
        <span class="hl-keyword">this</span>.city = s;
    }

    <span class="hl-keyword">public</span> String getCountry() {
        <span class="hl-keyword">return</span> country;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setCountry(String country) {
        <span class="hl-keyword">this</span>.country = country;
    }

}</pre> 
   <p>Society.java</p> 
   <pre class="programlisting"><span class="hl-keyword">package</span> org.spring.samples.spel.inventor;

<span class="hl-keyword">import</span> java.util.*;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Society {

    <span class="hl-keyword">private</span> String name;

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> String Advisors = <span class="hl-string">&quot;advisors&quot;</span>;
    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> String President = <span class="hl-string">&quot;president&quot;</span>;

    <span class="hl-keyword">private</span> List&lt;Inventor&gt; members = <span class="hl-keyword">new</span> ArrayList&lt;Inventor&gt;();
    <span class="hl-keyword">private</span> Map officers = <span class="hl-keyword">new</span> HashMap();

    <span class="hl-keyword">public</span> List getMembers() {
        <span class="hl-keyword">return</span> members;
    }

    <span class="hl-keyword">public</span> Map getOfficers() {
        <span class="hl-keyword">return</span> officers;
    }

    <span class="hl-keyword">public</span> String getName() {
        <span class="hl-keyword">return</span> name;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setName(String name) {
        <span class="hl-keyword">this</span>.name = name;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> isMember(String name) {
        <span class="hl-keyword">for</span> (Inventor inventor : members) {
            <span class="hl-keyword">if</span> (inventor.getName().equals(name)) {
                <span class="hl-keyword">return</span> true;
            }
        }
        <span class="hl-keyword">return</span> false;
    }

}</pre> 
  </div> 
 </div> 
 <div class="chapter" title="8.&nbsp;Aspect Oriented Programming with Spring">
  <div class="titlepage">
   <div>
    <div>
     <h2 class="title"><a name="aop"></a>8.&nbsp;Aspect Oriented Programming with Spring</h2>
    </div>
   </div>
  </div> 
  <div class="section" title="8.1&nbsp;Introduction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="aop-introduction"></a>8.1&nbsp;Introduction</h2>
     </div>
    </div>
   </div> 
   <p><span class="emphasis"><em>Aspect-Oriented Programming</em></span> (AOP) complements Object-Oriented Programming (OOP) by providing another way of thinking about program structure. The key unit of modularity in OOP is the class, whereas in AOP the unit of modularity is the <span class="emphasis"><em>aspect</em></span>. Aspects enable the modularization of concerns such as transaction management that cut across multiple types and objects. (Such concerns are often termed <span class="emphasis"><em>crosscutting</em></span> concerns in AOP literature.)</p> 
   <p>One of the key components of Spring is the <span class="emphasis"><em>AOP framework</em></span>. While the Spring IoC container does not depend on AOP, meaning you do not need to use AOP if you dont want to, AOP complements Spring IoC to provide a very capable middleware solution.</p> 
   <div class="sidebar" title="Spring 2.0 AOP">
    <p class="title"><b>Spring 2.0 AOP</b></p> 
    <p>Spring 2.0 introduces a simpler and more powerful way of writing custom aspects using either a <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-schema" title="8.3&nbsp;Schema-based AOP support">schema-based approach</a> or the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-ataspectj" title="8.2&nbsp;@AspectJ support">@AspectJ annotation style</a>. Both of these styles offer fully typed advice and use of the AspectJ pointcut language, while still using Spring AOP for weaving.</p> 
    <p>The Spring 2.0 schema- and @AspectJ-based AOP support is discussed in this chapter. Spring 2.0 AOP remains fully backwards compatible with Spring 1.2 AOP, and the lower-level AOP support offered by the Spring 1.2 APIs is discussed in <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-api" title="9.&nbsp;Spring AOP APIs">the following chapter</a>.</p> 
   </div> 
   <p>AOP is used in the Spring Framework to</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem">  provide declarative enterprise services, especially as a replacement for EJB declarative services. The most important such service is <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#transaction-declarative" title="11.5&nbsp;Declarative transaction management"><span class="emphasis"><em>declarative transaction management</em></span></a>. </li>
     <li class="listitem">  allow users to implement custom aspects, complementing their use of OOP with AOP. </li>
    </ul>
   </div> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>If you are interested only in generic declarative services or other pre-packaged declarative middleware services such as pooling, you do not need to work directly with Spring AOP, and can skip most of this chapter.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <div class="section" title="8.1.1&nbsp;AOP concepts">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-introduction-defn"></a>8.1.1&nbsp;AOP concepts</h3>
      </div>
     </div>
    </div> 
    <p>Let us begin by defining some central AOP concepts and terminology. These terms are not Spring-specific unfortunately, AOP terminology is not particularly intuitive; however, it would be even more confusing if Spring used its own terminology.</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> <span class="emphasis"><em>Aspect</em></span>: a modularization of a concern that cuts across multiple classes. Transaction management is a good example of a crosscutting concern in enterprise Java applications. In Spring AOP, aspects are implemented using regular classes (the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-schema" title="8.3&nbsp;Schema-based AOP support">schema-based approach</a>) or regular classes annotated with the <code class="literal">@Aspect</code> annotation (the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-ataspectj" title="8.2&nbsp;@AspectJ support"><code class="literal">@AspectJ</code> style</a>). </li>
      <li class="listitem"> <span class="emphasis"><em>Join point</em></span>: a point during the execution of a program, such as the execution of a method or the handling of an exception. In Spring AOP, a join point <span class="emphasis"><em>always</em></span> represents a method execution. </li>
      <li class="listitem"> <span class="emphasis"><em>Advice</em></span>: action taken by an aspect at a particular join point. Different types of advice include &quot;around,&quot; &quot;before&quot; and &quot;after&quot; advice. (Advice types are discussed below.) Many AOP frameworks, including Spring, model an advice as an <span class="emphasis"><em>interceptor</em></span>, maintaining a chain of interceptors <span class="emphasis"><em>around</em></span> the join point. </li>
      <li class="listitem"> <span class="emphasis"><em>Pointcut</em></span>: a predicate that matches join points. Advice is associated with a pointcut expression and runs at any join point matched by the pointcut (for example, the execution of a method with a certain name). The concept of join points as matched by pointcut expressions is central to AOP, and Spring uses the AspectJ pointcut expression language by default. </li>
      <li class="listitem"> <span class="emphasis"><em>Introduction</em></span>: declaring additional methods or fields on behalf of a type. Spring AOP allows you to introduce new interfaces (and a corresponding implementation) to any advised object. For example, you could use an introduction to make a bean implement an <code class="literal">IsModified</code> interface, to simplify caching. (An introduction is known as an inter-type declaration in the AspectJ community.) </li>
      <li class="listitem"> <span class="emphasis"><em>Target object</em></span>: object being advised by one or more aspects. Also referred to as the <span class="emphasis"><em>advised</em></span> object. Since Spring AOP is implemented using runtime proxies, this object will always be a <span class="emphasis"><em>proxied</em></span> object. </li>
      <li class="listitem"> <span class="emphasis"><em>AOP proxy</em></span>: an object created by the AOP framework in order to implement the aspect contracts (advise method executions and so on). In the Spring Framework, an AOP proxy will be a JDK dynamic proxy or a CGLIB proxy. </li>
      <li class="listitem"> <span class="emphasis"><em>Weaving</em></span>: linking aspects with other application types or objects to create an advised object. This can be done at compile time (using the AspectJ compiler, for example), load time, or at runtime. Spring AOP, like other pure Java AOP frameworks, performs weaving at runtime. </li>
     </ul>
    </div> 
    <p>Types of advice:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> <span class="emphasis"><em>Before advice</em></span>: Advice that executes before a join point, but which does not have the ability to prevent execution flow proceeding to the join point (unless it throws an exception). </li>
      <li class="listitem"> <span class="emphasis"><em>After returning advice</em></span>: Advice to be executed after a join point completes normally: for example, if a method returns without throwing an exception. </li>
      <li class="listitem"> <span class="emphasis"><em>After throwing advice</em></span>: Advice to be executed if a method exits by throwing an exception. </li>
      <li class="listitem"> <span class="emphasis"><em>After (finally) advice</em></span>: Advice to be executed regardless of the means by which a join point exits (normal or exceptional return). </li>
      <li class="listitem"> <span class="emphasis"><em>Around advice</em></span>: Advice that surrounds a join point such as a method invocation. This is the most powerful kind of advice. Around advice can perform custom behavior before and after the method invocation. It is also responsible for choosing whether to proceed to the join point or to shortcut the advised method execution by returning its own return value or throwing an exception. </li>
     </ul>
    </div> 
    <p>Around advice is the most general kind of advice. Since Spring AOP, like AspectJ, provides a full range of advice types, we recommend that you use the least powerful advice type that can implement the required behavior. For example, if you need only to update a cache with the return value of a method, you are better off implementing an after returning advice than an around advice, although an around advice can accomplish the same thing. Using the most specific advice type provides a simpler programming model with less potential for errors. For example, you do not need to invoke the <code class="literal">proceed()</code> method on the <code class="literal">JoinPoint</code> used for around advice, and hence cannot fail to invoke it.</p> 
    <p>In Spring 2.0, all advice parameters are statically typed, so that you work with advice parameters of the appropriate type (the type of the return value from a method execution for example) rather than <code class="literal">Object</code> arrays.</p> 
    <p>The concept of join points, matched by pointcuts, is the key to AOP which distinguishes it from older technologies offering only interception. Pointcuts enable advice to be targeted independently of the Object-Oriented hierarchy. For example, an around advice providing declarative transaction management can be applied to a set of methods spanning multiple objects (such as all business operations in the service layer).</p> 
   </div> 
   <div class="section" title="8.1.2&nbsp;Spring AOP capabilities and goals">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-introduction-spring-defn"></a>8.1.2&nbsp;Spring AOP capabilities and goals</h3>
      </div>
     </div>
    </div> 
    <p>Spring AOP is implemented in pure Java. There is no need for a special compilation process. Spring AOP does not need to control the class loader hierarchy, and is thus suitable for use in a Servlet container or application server.</p> 
    <p>Spring AOP currently supports only method execution join points (advising the execution of methods on Spring beans). Field interception is not implemented, although support for field interception could be added without breaking the core Spring AOP APIs. If you need to advise field access and update join points, consider a language such as AspectJ.</p> 
    <p>Spring AOPs approach to AOP differs from that of most other AOP frameworks. The aim is not to provide the most complete AOP implementation (although Spring AOP is quite capable); it is rather to provide a close integration between AOP implementation and Spring IoC to help solve common problems in enterprise applications.</p> 
    <p>Thus, for example, the Spring Frameworks AOP functionality is normally used in conjunction with the Spring IoC container. Aspects are configured using normal bean definition syntax (although this allows powerful &quot;autoproxying&quot; capabilities): this is a crucial difference from other AOP implementations. There are some things you cannot do easily or efficiently with Spring AOP, such as advise very fine-grained objects (such as domain objects typically): AspectJ is the best choice in such cases. However, our experience is that Spring AOP provides an excellent solution to most problems in enterprise Java applications that are amenable to AOP.</p> 
    <p>Spring AOP will never strive to compete with AspectJ to provide a comprehensive AOP solution. We believe that both proxy-based frameworks like Spring AOP and full-blown frameworks such as AspectJ are valuable, and that they are complementary, rather than in competition. Spring seamlessly integrates Spring AOP and IoC with AspectJ, to enable all uses of AOP to be catered for within a consistent Spring-based application architecture. This integration does not affect the Spring AOP API or the AOP Alliance API: Spring AOP remains backward-compatible. See <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-api" title="9.&nbsp;Spring AOP APIs">the following chapter</a> for a discussion of the Spring AOP APIs.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>One of the central tenets of the Spring Framework is that of <span class="emphasis"><em>non-invasiveness</em></span>; this is the idea that you should not be forced to introduce framework-specific classes and interfaces into your business/domain model. However, in some places the Spring Framework does give you the option to introduce Spring Framework-specific dependencies into your codebase: the rationale in giving you such options is because in certain scenarios it might be just plain easier to read or code some specific piece of functionality in such a way. The Spring Framework (almost) always offers you the choice though: you have the freedom to make an informed decision as to which option best suits your particular use case or scenario.</p> <p>One such choice that is relevant to this chapter is that of which AOP framework (and which AOP style) to choose. You have the choice of AspectJ and/or Spring AOP, and you also have the choice of either the @AspectJ annotation-style approach or the Spring XML configuration-style approach. The fact that this chapter chooses to introduce the @AspectJ-style approach first should not be taken as an indication that the Spring team favors the @AspectJ annotation-style approach over the Spring XML configuration-style.</p> <p>See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-choosing" title="8.4&nbsp;Choosing which AOP declaration style to use">Section&nbsp;8.4, Choosing which AOP declaration style to use</a> for a more complete discussion of the whys and wherefores of each style.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="8.1.3&nbsp;AOP Proxies">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-introduction-proxies"></a>8.1.3&nbsp;AOP Proxies</h3>
      </div>
     </div>
    </div> 
    <p>Spring AOP defaults to using standard J2SE <span class="emphasis"><em>dynamic proxies</em></span> for AOP proxies. This enables any interface (or set of interfaces) to be proxied.</p> 
    <p>Spring AOP can also use CGLIB proxies. This is necessary to proxy classes, rather than interfaces. CGLIB is used by default if a business object does not implement an interface. As it is good practice to program to interfaces rather than classes, business classes normally will implement one or more business interfaces. It is possible to <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#">force the use of CGLIB</a>, in those (hopefully rare) cases where you need to advise a method that is not declared on an interface, or where you need to pass a proxied object to a method as a concrete type.</p> 
    <p>It is important to grasp the fact that Spring AOP is <span class="emphasis"><em>proxy-based</em></span>. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-understanding-aop-proxies" title="8.6.1&nbsp;Understanding AOP proxies">Section&nbsp;8.6.1, Understanding AOP proxies</a> for a thorough examination of exactly what this implementation detail actually means.</p> 
   </div> 
  </div> 
  <div class="section" title="8.2&nbsp;@AspectJ support">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="aop-ataspectj"></a>8.2&nbsp;@AspectJ support</h2>
     </div>
    </div>
   </div> 
   <p>@AspectJ refers to a style of declaring aspects as regular Java classes annotated with annotations. The @AspectJ style was introduced by the <a class="ulink" href="http://www.eclipse.org/aspectj" target="_top">AspectJ project</a> as part of the AspectJ 5 release. Spring interprets the same annotations as AspectJ 5, using a library supplied by AspectJ for pointcut parsing and matching. The AOP runtime is still pure Spring AOP though, and there is no dependency on the AspectJ compiler or weaver.</p> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>Using the AspectJ compiler and weaver enables use of the full AspectJ language, and is discussed in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-using-aspectj" title="8.8&nbsp;Using AspectJ with Spring applications">Section&nbsp;8.8, Using AspectJ with Spring applications</a>.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <div class="section" title="8.2.1&nbsp;Enabling @AspectJ Support">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-aspectj-support"></a>8.2.1&nbsp;Enabling @AspectJ Support</h3>
      </div>
     </div>
    </div> 
    <p>To use @AspectJ aspects in a Spring configuration you need to enable Spring support for configuring Spring AOP based on @AspectJ aspects, and <span class="emphasis"><em>autoproxying</em></span> beans based on whether or not they are advised by those aspects. By autoproxying we mean that if Spring determines that a bean is advised by one or more aspects, it will automatically generate a proxy for that bean to intercept method invocations and ensure that advice is executed as needed.</p> 
    <p>The @AspectJ support can be enabled with XML or Java style configuration. In either case you will also need to ensure that AspectJs <code class="literal">aspectjweaver.jar</code> library is on the classpath of your application (version 1.6.8 or later). This library is available in the <code class="literal">'lib'</code> directory of an AspectJ distribution or via the Maven Central repository.</p> 
    <div class="section" title="Enabling @AspectJ Support with Java configuration">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-enable-aspectj-java"></a>Enabling @AspectJ Support with Java configuration</h4>
       </div>
      </div>
     </div> 
     <p>To enable @AspectJ support with Java <code class="literal">@Configuration</code> add the <code class="literal">@EnableAspectJAutoProxy</code> annotation:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableAspectJAutoProxy</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

}</pre> 
    </div> 
    <div class="section" title="Enabling @AspectJ Support with XML configuration">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-enable-aspectj-xml"></a>Enabling @AspectJ Support with XML configuration</h4>
       </div>
      </div>
     </div> 
     <p>To enable @AspectJ support with XML based configuration use the <code class="literal">aop:aspectj-autoproxy</code> element:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;aop:aspectj-autoproxy/&gt;</span></pre> 
     <p>This assumes that you are using schema support as described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#xsd-config" title="33.&nbsp;XML Schema-based configuration">Chapter&nbsp;33, <i>XML Schema-based configuration</i></a>. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-aop" title="33.2.7&nbsp;the aop schema">Section&nbsp;33.2.7, the aop schema</a> for how to import the tags in the aop namespace.</p> 
    </div> 
   </div> 
   <div class="section" title="8.2.2&nbsp;Declaring an aspect">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-at-aspectj"></a>8.2.2&nbsp;Declaring an aspect</h3>
      </div>
     </div>
    </div> 
    <p>With the @AspectJ support enabled, any bean defined in your application context with a class that is an @AspectJ aspect (has the <code class="literal">@Aspect</code> annotation) will be automatically detected by Spring and used to configure Spring AOP. The following example shows the minimal definition required for a not-very-useful aspect:</p> 
    <p>A regular bean definition in the application context, pointing to a bean class that has the <code class="literal">@Aspect</code> annotation:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myAspect&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.xyz.NotVeryUsefulAspect&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- configure properties of aspect here as normal --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>And the <code class="literal">NotVeryUsefulAspect</code> class definition, annotated with <code class="literal">org.aspectj.lang.annotation.Aspect</code> annotation;</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> org.xyz;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;

<i><span class="hl-annotation" style="color: gray">@Aspect</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> NotVeryUsefulAspect {

}</pre> 
    <p>Aspects (classes annotated with <code class="literal">@Aspect</code>) may have methods and fields just like any other class. They may also contain pointcut, advice, and introduction (inter-type) declarations.</p> 
    <div class="note" title="Autodetecting aspects through component scanning" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note: Autodetecting aspects through component scanning">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Autodetecting aspects through component scanning</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>You may register aspect classes as regular beans in your Spring XML configuration, or autodetect them through classpath scanning - just like any other Spring-managed bean. However, note that the <span class="emphasis"><em>@Aspect</em></span> annotation is <span class="emphasis"><em>not</em></span> sufficient for autodetection in the classpath: For that purpose, you need to add a separate <span class="emphasis"><em>@Component</em></span> annotation (or alternatively a custom stereotype annotation that qualifies, as per the rules of Springs component scanner).</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <div class="note" title="Advising aspects with other aspects?" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note: Advising aspects with other aspects?">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Advising aspects with other aspects?</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>In Spring AOP, it is <span class="emphasis"><em>not</em></span> possible to have aspects themselves be the target of advice from other aspects. The <span class="emphasis"><em>@Aspect</em></span> annotation on a class marks it as an aspect, and hence excludes it from auto-proxying.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="8.2.3&nbsp;Declaring a pointcut">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-pointcuts"></a>8.2.3&nbsp;Declaring a pointcut</h3>
      </div>
     </div>
    </div> 
    <p>Recall that pointcuts determine join points of interest, and thus enable us to control when advice executes. <span class="emphasis"><em>Spring AOP only supports method execution join points for Spring beans</em></span>, so you can think of a pointcut as matching the execution of methods on Spring beans. A pointcut declaration has two parts: a signature comprising a name and any parameters, and a pointcut expression that determines <span class="emphasis"><em>exactly</em></span> which method executions we are interested in. In the @AspectJ annotation-style of AOP, a pointcut signature is provided by a regular method definition, and the pointcut expression is indicated using the <code class="literal">@Pointcut</code> annotation (the method serving as the pointcut signature <span class="emphasis"><em>must</em></span> have a <code class="literal">void</code> return type).</p> 
    <p>An example will help make this distinction between a pointcut signature and a pointcut expression clear. The following example defines a pointcut named <code class="literal">'anyOldTransfer'</code> that will match the execution of any method named <code class="literal">'transfer'</code>:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Pointcut(&quot;execution(* transfer(..))&quot;)//</span></i> the pointcut expression
<span class="hl-keyword">private</span> <span class="hl-keyword">void</span> anyOldTransfer() {}<span class="hl-comment">// the pointcut signature</span></pre> 
    <p>The pointcut expression that forms the value of the <code class="literal">@Pointcut</code> annotation is a regular AspectJ 5 pointcut expression. For a full discussion of AspectJs pointcut language, see the <a class="ulink" href="http://www.eclipse.org/aspectj/doc/released/progguide/index.html" target="_top">AspectJ Programming Guide</a> (and for extensions, the <a class="ulink" href="http://www.eclipse.org/aspectj/doc/released/adk15notebook/index.html" target="_top">AspectJ 5 Developers Notebook</a>) or one of the books on AspectJ such as &quot;Eclipse AspectJ&quot; by Colyer et. al. or &quot;AspectJ in Action&quot; by Ramnivas Laddad.</p> 
    <div class="section" title="Supported Pointcut Designators">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-pointcuts-designators"></a>Supported Pointcut Designators</h4>
       </div>
      </div>
     </div> 
     <p>Spring AOP supports the following AspectJ pointcut designators (PCD) for use in pointcut expressions:</p> 
     <div class="sidebar" title="Other pointcut types">
      <p class="title"><b>Other pointcut types</b></p> 
      <p>The full AspectJ pointcut language supports additional pointcut designators that are not supported in Spring. These are: <code class="literal">call, get, set, preinitialization, staticinitialization, initialization, handler, adviceexecution, withincode, cflow, cflowbelow, if, @this</code>, and <code class="literal">@withincode</code>. Use of these pointcut designators in pointcut expressions interpreted by Spring AOP will result in an <code class="literal">IllegalArgumentException</code> being thrown.</p> 
      <p>The set of pointcut designators supported by Spring AOP may be extended in future releases to support more of the AspectJ pointcut designators.</p> 
     </div> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> <span class="emphasis"><em>execution</em></span> - for matching method execution join points, this is the primary pointcut designator you will use when working with Spring AOP </li>
       <li class="listitem"> <span class="emphasis"><em>within</em></span> - limits matching to join points within certain types (simply the execution of a method declared within a matching type when using Spring AOP) </li>
       <li class="listitem"> <span class="emphasis"><em>this</em></span> - limits matching to join points (the execution of methods when using Spring AOP) where the bean reference (Spring AOP proxy) is an instance of the given type </li>
       <li class="listitem"> <span class="emphasis"><em>target</em></span> - limits matching to join points (the execution of methods when using Spring AOP) where the target object (application object being proxied) is an instance of the given type </li>
       <li class="listitem"> <span class="emphasis"><em>args</em></span> - limits matching to join points (the execution of methods when using Spring AOP) where the arguments are instances of the given types </li>
       <li class="listitem"> <span class="emphasis"><em>@target</em></span> - limits matching to join points (the execution of methods when using Spring AOP) where the class of the executing object has an annotation of the given type </li>
       <li class="listitem"> <span class="emphasis"><em>@args</em></span> - limits matching to join points (the execution of methods when using Spring AOP) where the runtime type of the actual arguments passed have annotations of the given type(s) </li>
       <li class="listitem"> <span class="emphasis"><em>@within</em></span> - limits matching to join points within types that have the given annotation (the execution of methods declared in types with the given annotation when using Spring AOP) </li>
       <li class="listitem"> <span class="emphasis"><em>@annotation</em></span> - limits matching to join points where the subject of the join point (method being executed in Spring AOP) has the given annotation </li>
      </ul>
     </div> 
     <p>Because Spring AOP limits matching to only method execution join points, the discussion of the pointcut designators above gives a narrower definition than you will find in the AspectJ programming guide. In addition, AspectJ itself has type-based semantics and at an execution join point both ' <code class="literal">this</code>' and ' <code class="literal">target</code>' refer to the same object - the object executing the method. Spring AOP is a proxy-based system and differentiates between the proxy object itself (bound to ' <code class="literal">this</code><span class="emphasis"><em>) and the target object behind the proxy (bound to ' <code class="literal">target</code></em></span>).</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>Due to the proxy-based nature of Springs AOP framework, protected methods are by definition <span class="emphasis"><em>not</em></span> intercepted, neither for JDK proxies (where this isnt applicable) nor for CGLIB proxies (where this is technically possible but not recommendable for AOP purposes). As a consequence, any given pointcut will be matched against <span class="emphasis"><em>public methods only</em></span>!</p> <p>If your interception needs include protected/private methods or even constructors, consider the use of Spring-driven <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-aj-ltw" title="8.8.4&nbsp;Load-time weaving with AspectJ in the Spring Framework">native AspectJ weaving</a> instead of Springs proxy-based AOP framework. This constitutes a different mode of AOP usage with different characteristics, so be sure to make yourself familiar with weaving first before making a decision.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <p>Spring AOP also supports an additional PCD named ' <code class="literal">bean</code><span class="emphasis"><em>. This PCD allows you to limit the matching of join points to a particular named Spring bean, or to a set of named Spring beans (when using wildcards). The ' <code class="literal">bean</code></em></span> PCD has the following form:</p> 
     <pre class="programlisting">bean(idOrNameOfBean)</pre> 
     <p>The ' <code class="literal">idOrNameOfBean</code>' token can be the name of any Spring bean: limited wildcard support using the ' <code class="literal">*</code>' character is provided, so if you establish some naming conventions for your Spring beans you can quite easily write a ' <code class="literal">bean</code>' PCD expression to pick them out. As is the case with other pointcut designators, the ' <code class="literal">bean</code>' PCD can be &amp;&amp;'ed, ||'ed, and ! (negated) too.</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>Please note that the ' <code class="literal">bean</code>' PCD is <span class="emphasis"><em>only</em></span> supported in Spring AOP - and <span class="emphasis"><em>not</em></span> in native AspectJ weaving. It is a Spring-specific extension to the standard PCDs that AspectJ defines.</p> <p>The ' <code class="literal">bean</code>' PCD operates at the <span class="emphasis"><em>instance</em></span> level (building on the Spring bean name concept) rather than at the type level only (which is what weaving-based AOP is limited to). Instance-based pointcut designators are a special capability of Springs proxy-based AOP framework and its close integration with the Spring bean factory, where it is natural and straightforward to identify specific beans by name.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="Combining pointcut expressions">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-pointcuts-combining"></a>Combining pointcut expressions</h4>
       </div>
      </div>
     </div> 
     <p>Pointcut expressions can be combined using <span class="emphasis"><em>&amp;&amp;</em></span>, <span class="emphasis"><em>||</em></span> and <span class="emphasis"><em>!</em></span>. It is also possible to refer to pointcut expressions by name. The following example shows three pointcut expressions: <code class="literal">anyPublicOperation</code> (which matches if a method execution join point represents the execution of any public method); <code class="literal">inTrading</code> (which matches if a method execution is in the trading module), and <code class="literal">tradingOperation</code> (which matches if a method execution represents any public method in the trading module).</p> 
     <pre class="programlisting">@Pointcut(<span class="hl-string">&quot;execution(public * </span><span class="strong"><strong>(..))&quot;) private void anyPublicOperation() {} @Pointcut(&quot;within(com.xyz.someapp.trading..</strong></span>)<span class="hl-string">&quot;)
</span>    <span class="hl-keyword">private</span> <span class="hl-keyword">void</span> inTrading() {}

    <i><span class="hl-annotation" style="color: gray">@Pointcut(&quot;anyPublicOperation() &amp;&amp; inTrading()&quot;)</span></i>
    <span class="hl-keyword">private</span> <span class="hl-keyword">void</span> tradingOperation() {}</pre> 
     <p>It is a best practice to build more complex pointcut expressions out of smaller named components as shown above. When referring to pointcuts by name, normal Java visibility rules apply (you can see private pointcuts in the same type, protected pointcuts in the hierarchy, public pointcuts anywhere and so on). Visibility does not affect pointcut <span class="emphasis"><em>matching</em></span>.</p> 
    </div> 
    <div class="section" title="Sharing common pointcut definitions">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-common-pointcuts"></a>Sharing common pointcut definitions</h4>
       </div>
      </div>
     </div> 
     <p>When working with enterprise applications, you often want to refer to modules of the application and particular sets of operations from within several aspects. We recommend defining a &quot;SystemArchitecture&quot; aspect that captures common pointcut expressions for this purpose. A typical such aspect would look as follows:</p> 
     <pre class="programlisting"><span class="hl-keyword">package</span> com.xyz.someapp;

<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Pointcut;

<i><span class="hl-annotation" style="color: gray">@Aspect</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SystemArchitecture {

    /<span class="strong"><strong> * A join point is in the web layer if the method is defined * in a type in the com.xyz.someapp.web package or any sub-package * under that. <span class="strong"><strong>/ @Pointcut(&quot;within(com.xyz.someapp.web..</strong></span>)&quot;) public void inWebLayer() {} /</strong></span>
     * A join point is in the service layer <span class="hl-keyword">if</span> the method is defined
     * in a type in the com.xyz.someapp.service <span class="hl-keyword">package</span> or any sub-<span class="hl-keyword">package</span>
     * under that.
     <span class="strong"><strong>/ @Pointcut(&quot;within(com.xyz.someapp.service..</strong></span>)<span class="hl-string">&quot;)
</span>    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> inServiceLayer() {}

    /<span class="strong"><strong> * A join point is in the data access layer if the method is defined * in a type in the com.xyz.someapp.dao package or any sub-package * under that. <span class="strong"><strong>/ @Pointcut(&quot;within(com.xyz.someapp.dao..</strong></span>)&quot;) public void inDataAccessLayer() {} /</strong></span>
     * A business service is the execution of any method defined on a service
     * <span class="hl-keyword">interface</span>. This definition assumes that interfaces are placed in the
     * <span class="hl-string">&quot;service&quot;</span> <span class="hl-keyword">package</span>, and that implementation types are in sub-packages.
     *
     * If you group service interfaces by functional area (<span class="hl-keyword">for</span> example,
     * in packages com.xyz.someapp.abc.service and com.xyz.def.service) then
     * the pointcut expression <span class="hl-string">&quot;execution(* com.xyz.someapp..service.</span><span class="strong"><strong>.</strong></span>(..))<span class="hl-string">&quot;
</span>     * could be used instead.
     *
     * Alternatively, you can write the expression using the <span class="emphasis"><em>bean</em></span>
     * PCD, like so <span class="hl-string">&quot;bean(</span><span class="strong"><strong>Service)&quot;. (This assumes that you have * named your Spring service beans in a consistent fashion.) */ @Pointcut(&quot;execution(</strong></span> com.xyz.someapp.service.<span class="strong"><strong>.</strong></span>(..))<span class="hl-string">&quot;)
</span>    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> businessService() {}

    /<span class="strong"><strong>* * A data access operation is the execution of any method defined on a * dao interface. This definition assumes that interfaces are placed in the * &quot;dao&quot; package, and that implementation types are in sub-packages. */ @Pointcut(&quot;execution(</strong></span> com.xyz.someapp.dao.<span class="strong"><strong>.</strong></span>(..))<span class="hl-string">&quot;)
</span>    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> dataAccessOperation() {}

}</pre> 
     <p>The pointcuts defined in such an aspect can be referred to anywhere that you need a pointcut expression. For example, to make the service layer transactional, you could write:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;aop:config&gt;</span>
    <span class="hl-tag">&lt;aop:advisor</span>
        <span class="hl-attribute">pointcut</span>=<span class="hl-value">&quot;com.xyz.someapp.SystemArchitecture.businessService()&quot;</span>
        <span class="hl-attribute">advice-ref</span>=<span class="hl-value">&quot;tx-advice&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/aop:config&gt;</span>

<span class="hl-tag">&lt;tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;tx-advice&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;tx:attributes&gt;</span>
        <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;*&quot;</span> <span class="hl-attribute">propagation</span>=<span class="hl-value">&quot;REQUIRED&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/tx:attributes&gt;</span>
<span class="hl-tag">&lt;/tx:advice&gt;</span></pre> 
     <p>The <code class="literal">&lt;aop:config&gt;</code> and <code class="literal">&lt;aop:advisor&gt;</code> elements are discussed in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-schema" title="8.3&nbsp;Schema-based AOP support">Section&nbsp;8.3, Schema-based AOP support</a>. The transaction elements are discussed in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#transaction" title="11.&nbsp;Transaction Management">Chapter&nbsp;11, <i>Transaction Management</i></a>.</p> 
    </div> 
    <div class="section" title="Examples">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-pointcuts-examples"></a>Examples</h4>
       </div>
      </div>
     </div> 
     <p>Spring AOP users are likely to use the <code class="literal">execution</code> pointcut designator the most often. The format of an execution expression is:</p> 
     <pre class="programlisting">execution(modifiers-pattern? ret-type-pattern declaring-type-pattern? name-pattern(param-pattern)
            <span class="hl-keyword">throws</span>-pattern?)</pre> 
     <p>All parts except the returning type pattern (ret-type-pattern in the snippet above), name pattern, and parameters pattern are optional. The returning type pattern determines what the return type of the method must be in order for a join point to be matched. Most frequently you will use <code class="literal">*</code> as the returning type pattern, which matches any return type. A fully-qualified type name will match only when the method returns the given type. The name pattern matches the method name. You can use the <code class="literal">*</code> wildcard as all or part of a name pattern. The parameters pattern is slightly more complex: <code class="literal">()</code> matches a method that takes no parameters, whereas <code class="literal">(..)</code> matches any number of parameters (zero or more). The pattern <code class="literal">(*)</code> matches a method taking one parameter of any type, <code class="literal">(*,String)</code> matches a method taking two parameters, the first can be of any type, the second must be a String. Consult the <a class="ulink" href="http://www.eclipse.org/aspectj/doc/released/progguide/semantics-pointcuts.html" target="_top">Language Semantics</a> section of the AspectJ Programming Guide for more information.</p> 
     <p>Some examples of common pointcut expressions are given below.</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> the execution of any public method: </li>
      </ul>
     </div> 
     <pre class="programlisting">execution(<span class="hl-keyword">public</span> * *(..))</pre> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> the execution of any method with a name beginning with &quot;set&quot;: </li>
      </ul>
     </div> 
     <pre class="programlisting">execution(* set*(..))</pre> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> the execution of any method defined by the <code class="literal">AccountService</code> interface: </li>
      </ul>
     </div> 
     <pre class="programlisting">execution(* com.xyz.service.AccountService.*(..))</pre> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> the execution of any method defined in the service package: </li>
      </ul>
     </div> 
     <pre class="programlisting">execution(* com.xyz.service.<span class="strong"><strong>.</strong></span>(..))</pre> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> the execution of any method defined in the service package or a sub-package: </li>
      </ul>
     </div> 
     <pre class="programlisting">execution(* com.xyz.service..<span class="strong"><strong>.</strong></span>(..))</pre> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> any join point (method execution only in Spring AOP) within the service package: </li>
      </ul>
     </div> 
     <pre class="programlisting">within(com.xyz.service.*)</pre> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> any join point (method execution only in Spring AOP) within the service package or a sub-package: </li>
      </ul>
     </div> 
     <pre class="programlisting">within(com.xyz.service..*)</pre> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> any join point (method execution only in Spring AOP) where the proxy implements the <code class="literal">AccountService</code> interface: </li>
      </ul>
     </div> 
     <pre class="programlisting"><span class="hl-keyword">this</span>(com.xyz.service.AccountService)</pre> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p><span class="emphasis"><em>this</em></span> is more commonly used in a binding form :- see the following section on advice for how to make the proxy object available in the advice body.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> any join point (method execution only in Spring AOP) where the target object implements the <code class="literal">AccountService</code> interface: </li>
      </ul>
     </div> 
     <pre class="programlisting">target(com.xyz.service.AccountService)</pre> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p><span class="emphasis"><em>target</em></span> is more commonly used in a binding form :- see the following section on advice for how to make the target object available in the advice body.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> any join point (method execution only in Spring AOP) which takes a single parameter, and where the argument passed at runtime is <code class="literal">Serializable</code>: </li>
      </ul>
     </div> 
     <pre class="programlisting">args(java.io.Serializable)</pre> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p><span class="emphasis"><em>args</em></span> is more commonly used in a binding form :- see the following section on advice for how to make the method arguments available in the advice body.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <p>Note that the pointcut given in this example is different to <code class="literal">execution(* *(java.io.Serializable))</code>: the args version matches if the argument passed at runtime is Serializable, the execution version matches if the method signature declares a single parameter of type <code class="literal">Serializable</code>.</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> any join point (method execution only in Spring AOP) where the target object has an <code class="literal">@Transactional</code> annotation: </li>
      </ul>
     </div> 
     <pre class="programlisting">@target(org.springframework.transaction.annotation.Transactional)</pre> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p><span class="emphasis"><em>@target</em></span> can also be used in a binding form :- see the following section on advice for how to make the annotation object available in the advice body.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> any join point (method execution only in Spring AOP) where the declared type of the target object has an <code class="literal">@Transactional</code> annotation: </li>
      </ul>
     </div> 
     <pre class="programlisting">@within(org.springframework.transaction.annotation.Transactional)</pre> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p><span class="emphasis"><em>@within</em></span> can also be used in a binding form :- see the following section on advice for how to make the annotation object available in the advice body.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> any join point (method execution only in Spring AOP) where the executing method has an <code class="literal">@Transactional</code> annotation: </li>
      </ul>
     </div> 
     <pre class="programlisting">@annotation(org.springframework.transaction.annotation.Transactional)</pre> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p><span class="emphasis"><em>@annotation</em></span> can also be used in a binding form :- see the following section on advice for how to make the annotation object available in the advice body.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> any join point (method execution only in Spring AOP) which takes a single parameter, and where the runtime type of the argument passed has the <code class="literal">@Classified</code> annotation: </li>
      </ul>
     </div> 
     <pre class="programlisting">@args(com.xyz.security.Classified)</pre> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p><span class="emphasis"><em>@args</em></span> can also be used in a binding form :- see the following section on advice for how to make the annotation object(s) available in the advice body.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> any join point (method execution only in Spring AOP) on a Spring bean named ' <code class="literal">tradeService</code>': </li>
      </ul>
     </div> 
     <pre class="programlisting">bean(tradeService)</pre> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> any join point (method execution only in Spring AOP) on Spring beans having names that match the wildcard expression ' <code class="literal">*Service</code>': </li>
      </ul>
     </div> 
     <pre class="programlisting">bean(*Service)</pre> 
    </div> 
    <div class="section" title="Writing good pointcuts">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="writing-good-pointcuts"></a>Writing good pointcuts</h4>
       </div>
      </div>
     </div> 
     <p>During compilation, AspectJ processes pointcuts in order to try and optimize matching performance. Examining code and determining if each join point matches (statically or dynamically) a given pointcut is a costly process. (A dynamic match means the match cannot be fully determined from static analysis and a test will be placed in the code to determine if there is an actual match when the code is running). On first encountering a pointcut declaration, AspectJ will rewrite it into an optimal form for the matching process. What does this mean? Basically pointcuts are rewritten in DNF (Disjunctive Normal Form) and the components of the pointcut are sorted such that those components that are cheaper to evaluate are checked first. This means you do not have to worry about understanding the performance of various pointcut designators and may supply them in any order in a pointcut declaration.</p> 
     <p>However, AspectJ can only work with what it is told, and for optimal performance of matching you should think about what they are trying to achieve and narrow the search space for matches as much as possible in the definition. The existing designators naturally fall into one of three groups: kinded, scoping and context:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> Kinded designators are those which select a particular kind of join point. For example: execution, get, set, call, handler </li>
       <li class="listitem"> Scoping designators are those which select a group of join points of interest (of probably many kinds). For example: within, withincode </li>
       <li class="listitem"> Contextual designators are those that match (and optionally bind) based on context. For example: this, target, @annotation </li>
      </ul>
     </div> 
     <p>A well written pointcut should try and include at least the first two types (kinded and scoping), whilst the contextual designators may be included if wishing to match based on join point context, or bind that context for use in the advice. Supplying either just a kinded designator or just a contextual designator will work but could affect weaving performance (time and memory used) due to all the extra processing and analysis. Scoping designators are very fast to match and their usage means AspectJ can very quickly dismiss groups of join points that should not be further processed - that is why a good pointcut should always include one if possible.</p> 
    </div> 
   </div> 
   <div class="section" title="8.2.4&nbsp;Declaring advice">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-advice"></a>8.2.4&nbsp;Declaring advice</h3>
      </div>
     </div>
    </div> 
    <p>Advice is associated with a pointcut expression, and runs before, after, or around method executions matched by the pointcut. The pointcut expression may be either a simple reference to a named pointcut, or a pointcut expression declared in place.</p> 
    <div class="section" title="Before advice">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-advice-before"></a>Before advice</h4>
       </div>
      </div>
     </div> 
     <p>Before advice is declared in an aspect using the <code class="literal">@Before</code> annotation:</p> 
     <pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Before;

<i><span class="hl-annotation" style="color: gray">@Aspect</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BeforeExample {

    <i><span class="hl-annotation" style="color: gray">@Before(&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation()&quot;)</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doAccessCheck() {
        <span class="hl-comment">// ...</span>
    }

}</pre> 
     <p>If using an in-place pointcut expression we could rewrite the above example as:</p> 
     <pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Before;

<i><span class="hl-annotation" style="color: gray">@Aspect</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BeforeExample {

    @Before(<span class="hl-string">&quot;execution(* com.xyz.myapp.dao.</span><span class="strong"><strong>.</strong></span>(..))<span class="hl-string">&quot;)
</span>    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doAccessCheck() {
        <span class="hl-comment">// ...</span>
    }

}</pre> 
    </div> 
    <div class="section" title="After returning advice">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-advice-after-returning"></a>After returning advice</h4>
       </div>
      </div>
     </div> 
     <p>After returning advice runs when a matched method execution returns normally. It is declared using the <code class="literal">@AfterReturning</code> annotation:</p> 
     <pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.AfterReturning;

<i><span class="hl-annotation" style="color: gray">@Aspect</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AfterReturningExample {

    <i><span class="hl-annotation" style="color: gray">@AfterReturning(&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation()&quot;)</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doAccessCheck() {
        <span class="hl-comment">// ...</span>
    }

}</pre> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>Note: it is of course possible to have multiple advice declarations, and other members as well, all inside the same aspect. Were just showing a single advice declaration in these examples to focus on the issue under discussion at the time.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <p>Sometimes you need access in the advice body to the actual value that was returned. You can use the form of <code class="literal">@AfterReturning</code> that binds the return value for this:</p> 
     <pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.AfterReturning;

<i><span class="hl-annotation" style="color: gray">@Aspect</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AfterReturningExample {

    <i><span class="hl-annotation" style="color: gray">@AfterReturning( pointcut=&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation()&quot;, returning=&quot;retVal&quot;)</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doAccessCheck(Object retVal) {
        <span class="hl-comment">// ...</span>
    }

}</pre> 
     <p>The name used in the <code class="literal">returning</code> attribute must correspond to the name of a parameter in the advice method. When a method execution returns, the return value will be passed to the advice method as the corresponding argument value. A <code class="literal">returning</code> clause also restricts matching to only those method executions that return a value of the specified type ( <code class="literal">Object</code> in this case, which will match any return value).</p> 
     <p>Please note that it is <span class="emphasis"><em>not</em></span> possible to return a totally different reference when using after-returning advice.</p> 
    </div> 
    <div class="section" title="After throwing advice">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-advice-after-throwing"></a>After throwing advice</h4>
       </div>
      </div>
     </div> 
     <p>After throwing advice runs when a matched method execution exits by throwing an exception. It is declared using the <code class="literal">@AfterThrowing</code> annotation:</p> 
     <pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;

<i><span class="hl-annotation" style="color: gray">@Aspect</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AfterThrowingExample {

    <i><span class="hl-annotation" style="color: gray">@AfterThrowing(&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation()&quot;)</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doRecoveryActions() {
        <span class="hl-comment">// ...</span>
    }

}</pre> 
     <p>Often you want the advice to run only when exceptions of a given type are thrown, and you also often need access to the thrown exception in the advice body. Use the <code class="literal">throwing</code> attribute to both restrict matching (if desired, use <code class="literal">Throwable</code> as the exception type otherwise) and bind the thrown exception to an advice parameter.</p> 
     <pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.AfterThrowing;

<i><span class="hl-annotation" style="color: gray">@Aspect</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AfterThrowingExample {

    <i><span class="hl-annotation" style="color: gray">@AfterThrowing( pointcut=&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation()&quot;, throwing=&quot;ex&quot;)</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doRecoveryActions(DataAccessException ex) {
        <span class="hl-comment">// ...</span>
    }

}</pre> 
     <p>The name used in the <code class="literal">throwing</code> attribute must correspond to the name of a parameter in the advice method. When a method execution exits by throwing an exception, the exception will be passed to the advice method as the corresponding argument value. A <code class="literal">throwing</code> clause also restricts matching to only those method executions that throw an exception of the specified type ( <code class="literal">DataAccessException</code> in this case).</p> 
    </div> 
    <div class="section" title="After (finally) advice">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-advice-after-finally"></a>After (finally) advice</h4>
       </div>
      </div>
     </div> 
     <p>After (finally) advice runs however a matched method execution exits. It is declared using the <code class="literal">@After</code> annotation. After advice must be prepared to handle both normal and exception return conditions. It is typically used for releasing resources, etc.</p> 
     <pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.After;

<i><span class="hl-annotation" style="color: gray">@Aspect</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AfterFinallyExample {

    <i><span class="hl-annotation" style="color: gray">@After(&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation()&quot;)</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doReleaseLock() {
        <span class="hl-comment">// ...</span>
    }

}</pre> 
    </div> 
    <div class="section" title="Around advice">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-ataspectj-around-advice"></a>Around advice</h4>
       </div>
      </div>
     </div> 
     <p>The final kind of advice is around advice. Around advice runs &quot;around&quot; a matched method execution. It has the opportunity to do work both before and after the method executes, and to determine when, how, and even if, the method actually gets to execute at all. Around advice is often used if you need to share state before and after a method execution in a thread-safe manner (starting and stopping a timer for example). Always use the least powerful form of advice that meets your requirements (i.e. dont use around advice if simple before advice would do).</p> 
     <p>Around advice is declared using the <code class="literal">@Around</code> annotation. The first parameter of the advice method must be of type <code class="literal">ProceedingJoinPoint</code>. Within the body of the advice, calling <code class="literal">proceed()</code> on the <code class="literal">ProceedingJoinPoint</code> causes the underlying method to execute. The <code class="literal">proceed</code> method may also be called passing in an <code class="literal">Object[]</code> - the values in the array will be used as the arguments to the method execution when it proceeds.</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>The behavior of proceed when called with an Object[] is a little different than the behavior of proceed for around advice compiled by the AspectJ compiler. For around advice written using the traditional AspectJ language, the number of arguments passed to proceed must match the number of arguments passed to the around advice (not the number of arguments taken by the underlying join point), and the value passed to proceed in a given argument position supplants the original value at the join point for the entity the value was bound to (Dont worry if this doesnt make sense right now!). The approach taken by Spring is simpler and a better match to its proxy-based, execution only semantics. You only need to be aware of this difference if you are compiling @AspectJ aspects written for Spring and using proceed with arguments with the AspectJ compiler and weaver. There is a way to write such aspects that is 100% compatible across both Spring AOP and AspectJ, and this is discussed in the following section on advice parameters.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <pre class="programlisting"><span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Around;
<span class="hl-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;

<i><span class="hl-annotation" style="color: gray">@Aspect</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AroundExample {

    <i><span class="hl-annotation" style="color: gray">@Around(&quot;com.xyz.myapp.SystemArchitecture.businessService()&quot;)</span></i>
    <span class="hl-keyword">public</span> Object doBasicProfiling(ProceedingJoinPoint pjp) <span class="hl-keyword">throws</span> Throwable {
        <span class="hl-comment">// start stopwatch</span>
        Object retVal = pjp.proceed();
        <span class="hl-comment">// stop stopwatch</span>
        <span class="hl-keyword">return</span> retVal;
    }

}</pre> 
     <p>The value returned by the around advice will be the return value seen by the caller of the method. A simple caching aspect for example could return a value from a cache if it has one, and invoke proceed() if it does not. Note that proceed may be invoked once, many times, or not at all within the body of the around advice, all of these are quite legal.</p> 
    </div> 
    <div class="section" title="Advice parameters">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-ataspectj-advice-params"></a>Advice parameters</h4>
       </div>
      </div>
     </div> 
     <p>Spring offers fully typed advice - meaning that you declare the parameters you need in the advice signature (as we saw for the returning and throwing examples above) rather than work with <code class="literal">Object[]</code> arrays all the time. Well see how to make argument and other contextual values available to the advice body in a moment. First lets take a look at how to write generic advice that can find out about the method the advice is currently advising.</p> 
     <div class="section" title="Access to the current JoinPoint">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="aop-ataspectj-advice-params-the-joinpoint"></a>Access to the current JoinPoint</h5>
        </div>
       </div>
      </div> 
      <p>Any advice method may declare as its first parameter, a parameter of type <code class="literal">org.aspectj.lang.JoinPoint</code> (please note that around advice is <span class="emphasis"><em>required</em></span> to declare a first parameter of type <code class="literal">ProceedingJoinPoint</code>, which is a subclass of <code class="literal">JoinPoint</code>. The <code class="literal">JoinPoint</code> interface provides a number of useful methods such as <code class="literal">getArgs()</code> (returns the method arguments), <code class="literal">getThis()</code> (returns the proxy object), <code class="literal">getTarget()</code> (returns the target object), <code class="literal">getSignature()</code> (returns a description of the method that is being advised) and <code class="literal">toString()</code> (prints a useful description of the method being advised). Please do consult the Javadocs for full details.</p> 
     </div> 
     <div class="section" title="Passing parameters to advice">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="aop-ataspectj-advice-params-passing"></a>Passing parameters to advice</h5>
        </div>
       </div>
      </div> 
      <p>Weve already seen how to bind the returned value or exception value (using after returning and after throwing advice). To make argument values available to the advice body, you can use the binding form of <code class="literal">args</code>. If a parameter name is used in place of a type name in an args expression, then the value of the corresponding argument will be passed as the parameter value when the advice is invoked. An example should make this clearer. Suppose you want to advise the execution of dao operations that take an Account object as the first parameter, and you need access to the account in the advice body. You could write the following:</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Before(&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation() &amp;&amp; args(account,..)&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validateAccount(Account account) {
    <span class="hl-comment">// ...</span>
}</pre> 
      <p>The <code class="literal">args(account,..)</code> part of the pointcut expression serves two purposes: firstly, it restricts matching to only those method executions where the method takes at least one parameter, and the argument passed to that parameter is an instance of <code class="literal">Account</code>; secondly, it makes the actual <code class="literal">Account</code> object available to the advice via the <code class="literal">account</code> parameter.</p> 
      <p>Another way of writing this is to declare a pointcut that &quot;provides&quot; the <code class="literal">Account</code> object value when it matches a join point, and then just refer to the named pointcut from the advice. This would look as follows:</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Pointcut(&quot;com.xyz.myapp.SystemArchitecture.dataAccessOperation() &amp;&amp; args(account,..)&quot;)</span></i>
<span class="hl-keyword">private</span> <span class="hl-keyword">void</span> accountDataAccessOperation(Account account) {}

<i><span class="hl-annotation" style="color: gray">@Before(&quot;accountDataAccessOperation(account)&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> validateAccount(Account account) {
    <span class="hl-comment">// ...</span>
}</pre> 
      <p>The interested reader is once more referred to the AspectJ programming guide for more details.</p> 
      <p>The proxy object ( <code class="literal">this</code>), target object ( <code class="literal">target</code>), and annotations ( <code class="literal">@within, @target, @annotation, @args</code>) can all be bound in a similar fashion. The following example shows how you could match the execution of methods annotated with an <code class="literal">@Auditable</code> annotation, and extract the audit code.</p> 
      <p>First the definition of the <code class="literal">@Auditable</code> annotation:</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></i>
<i><span class="hl-annotation" style="color: gray">@Target(ElementType.METHOD)</span></i>
<span class="hl-keyword">public</span> <i><span class="hl-annotation" style="color: gray">@interface</span></i> Auditable {
    AuditCode value();
}</pre> 
      <p>And then the advice that matches the execution of <code class="literal">@Auditable</code> methods:</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Before(&quot;com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; @annotation(auditable)&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> audit(Auditable auditable) {
    AuditCode code = auditable.value();
    <span class="hl-comment">// ...</span>
}</pre> 
     </div> 
     <div class="section" title="Advice parameters and generics">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="aop-ataspectj-advice-params-generics"></a>Advice parameters and generics</h5>
        </div>
       </div>
      </div> 
      <p>Spring AOP can handle generics used in class declarations and method parameters. Suppose you have a generic type like this:</p> 
      <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Sample&lt;T&gt; {
    <span class="hl-keyword">void</span> sampleGenericMethod(T param);
    <span class="hl-keyword">void</span> sampleGenericCollectionMethod(Collection&gt;T&gt; param);
}</pre> 
      <p>You can restrict interception of method types to certain parameter types by simply typing the advice parameter to the parameter type you want to intercept the method for:</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Before(&quot;execution(* ..Sample+.sampleGenericMethod(*)) &amp;&amp; args(param)&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> beforeSampleMethod(MyType param) {
    <span class="hl-comment">// Advice implementation</span>
}</pre> 
      <p>That this works is pretty obvious as we already discussed above. However, its worth pointing out that this wont work for generic collections. So you cannot define a pointcut like this:</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Before(&quot;execution(* ..Sample+.sampleGenericCollectionMethod(*)) &amp;&amp; args(param)&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> beforeSampleMethod(Collection&lt;MyType&gt; param) {
    <span class="hl-comment">// Advice implementation</span>
}</pre> 
      <p>To make this work we would have to inspect every element of the collection, which is not reasonable as we also cannot decide how to treat <code class="literal">null</code> values in general. To achieve something similar to this you have to type the parameter to <code class="literal">Collection&lt;?&gt;</code> and manually check the type of the elements.</p> 
     </div> 
     <div class="section" title="Determining argument names">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="aop-ataspectj-advice-params-names"></a>Determining argument names</h5>
        </div>
       </div>
      </div> 
      <p>The parameter binding in advice invocations relies on matching names used in pointcut expressions to declared parameter names in (advice and pointcut) method signatures. Parameter names are <span class="emphasis"><em>not</em></span> available through Java reflection, so Spring AOP uses the following strategies to determine parameter names:</p> 
      <div class="itemizedlist">
       <ul class="itemizedlist" type="disc">
        <li class="listitem"> If the parameter names have been specified by the user explicitly, then the specified parameter names are used: both the advice and the pointcut annotations have an optional &quot;argNames&quot; attribute which can be used to specify the argument names of the annotated method - these argument names <span class="emphasis"><em>are</em></span> available at runtime. For example: </li>
       </ul>
      </div> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Before(value=&quot;com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; target(bean) &amp;&amp; @annotation(auditable)&quot;, argNames=&quot;bean,auditable&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> audit(Object bean, Auditable auditable) {
    AuditCode code = auditable.value();
    <span class="hl-comment">// ... use code and bean</span>
}</pre> 
      <p>If the first parameter is of the <code class="literal">JoinPoint</code>, <code class="literal">ProceedingJoinPoint</code>, or <code class="literal">JoinPoint.StaticPart</code> type, you may leave out the name of the parameter from the value of the &quot;argNames&quot; attribute. For example, if you modify the preceding advice to receive the join point object, the &quot;argNames&quot; attribute need not include it:</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Before(value=&quot;com.xyz.lib.Pointcuts.anyPublicMethod() &amp;&amp; target(bean) &amp;&amp; @annotation(auditable)&quot;, argNames=&quot;bean,auditable&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> audit(JoinPoint jp, Object bean, Auditable auditable) {
    AuditCode code = auditable.value();
    <span class="hl-comment">// ... use code, bean, and jp</span>
}</pre> 
      <p>The special treatment given to the first parameter of the <code class="literal">JoinPoint</code>, <code class="literal">ProceedingJoinPoint</code>, and <code class="literal">JoinPoint.StaticPart</code> types is particularly convenient for advice that do not collect any other join point context. In such situations, you may simply omit the &quot;argNames&quot; attribute. For example, the following advice need not declare the &quot;argNames&quot; attribute:</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Before(&quot;com.xyz.lib.Pointcuts.anyPublicMethod()&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> audit(JoinPoint jp) {
    <span class="hl-comment">// ... use jp</span>
}</pre> 
      <div class="itemizedlist">
       <ul class="itemizedlist" type="disc">
        <li class="listitem"> Using the <code class="literal">'argNames'</code> attribute is a little clumsy, so if the <code class="literal">'argNames'</code> attribute has not been specified, then Spring AOP will look at the debug information for the class and try to determine the parameter names from the local variable table. This information will be present as long as the classes have been compiled with debug information ( <code class="literal">'-g:vars'</code> at a minimum). The consequences of compiling with this flag on are: (1) your code will be slightly easier to understand (reverse engineer), (2) the class file sizes will be very slightly bigger (typically inconsequential), (3) the optimization to remove unused local variables will not be applied by your compiler. In other words, you should encounter no difficulties building with this flag on. </li>
       </ul>
      </div> 
      <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
       <table border="0" summary="Note">
        <tbody>
         <tr>
          <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
          <th align="left">Note</th>
         </tr>
         <tr>
          <td align="left" valign="top"> <p>If an @AspectJ aspect has been compiled by the AspectJ compiler (ajc) even without the debug information then there is no need to add the argNames attribute as the compiler will retain the needed information.</p> </td>
         </tr>
        </tbody>
       </table>
      </div> 
      <div class="itemizedlist">
       <ul class="itemizedlist" type="disc">
        <li class="listitem"> If the code has been compiled without the necessary debug information, then Spring AOP will attempt to deduce the pairing of binding variables to parameters (for example, if only one variable is bound in the pointcut expression, and the advice method only takes one parameter, the pairing is obvious!). If the binding of variables is ambiguous given the available information, then an <code class="literal">AmbiguousBindingException</code> will be thrown. </li>
        <li class="listitem"> If all of the above strategies fail then an <code class="literal">IllegalArgumentException</code> will be thrown. </li>
       </ul>
      </div> 
     </div> 
     <div class="section" title="Proceeding with arguments">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="aop-ataspectj-advice-proceeding-with-the-call"></a>Proceeding with arguments</h5>
        </div>
       </div>
      </div> 
      <p>We remarked earlier that we would describe how to write a proceed call <span class="emphasis"><em>with arguments</em></span> that works consistently across Spring AOP and AspectJ. The solution is simply to ensure that the advice signature binds each of the method parameters in order. For example:</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Around(&quot;execution(List&lt;Account&gt; find*(..)) &amp;&amp; &quot; + &quot;com.xyz.myapp.SystemArchitecture.inDataAccessLayer() &amp;&amp; &quot; + &quot;args(accountHolderNamePattern)&quot;)</span></i>
<span class="hl-keyword">public</span> Object preProcessQueryPattern(ProceedingJoinPoint pjp,
        String accountHolderNamePattern) <span class="hl-keyword">throws</span> Throwable {
    String newPattern = preProcess(accountHolderNamePattern);
    <span class="hl-keyword">return</span> pjp.proceed(<span class="hl-keyword">new</span> Object[] {newPattern});
}</pre> 
      <p>In many cases you will be doing this binding anyway (as in the example above).</p> 
     </div> 
    </div> 
    <div class="section" title="Advice ordering">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-ataspectj-advice-ordering"></a>Advice ordering</h4>
       </div>
      </div>
     </div> 
     <p>What happens when multiple pieces of advice all want to run at the same join point? Spring AOP follows the same precedence rules as AspectJ to determine the order of advice execution. The highest precedence advice runs first &quot;on the way in&quot; (so given two pieces of before advice, the one with highest precedence runs first). &quot;On the way out&quot; from a join point, the highest precedence advice runs last (so given two pieces of after advice, the one with the highest precedence will run second).</p> 
     <p>When two pieces of advice defined in <span class="emphasis"><em>different</em></span> aspects both need to run at the same join point, unless you specify otherwise the order of execution is undefined. You can control the order of execution by specifying precedence. This is done in the normal Spring way by either implementing the <code class="literal">org.springframework.core.Ordered</code> interface in the aspect class or annotating it with the <code class="literal">Order</code> annotation. Given two aspects, the aspect returning the lower value from <code class="literal">Ordered.getValue()</code> (or the annotation value) has the higher precedence.</p> 
     <p>When two pieces of advice defined in <span class="emphasis"><em>the same</em></span> aspect both need to run at the same join point, the ordering is undefined (since there is no way to retrieve the declaration order via reflection for javac-compiled classes). Consider collapsing such advice methods into one advice method per join point in each aspect class, or refactor the pieces of advice into separate aspect classes - which can be ordered at the aspect level.</p> 
    </div> 
   </div> 
   <div class="section" title="8.2.5&nbsp;Introductions">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-introductions"></a>8.2.5&nbsp;Introductions</h3>
      </div>
     </div>
    </div> 
    <p>Introductions (known as inter-type declarations in AspectJ) enable an aspect to declare that advised objects implement a given interface, and to provide an implementation of that interface on behalf of those objects.</p> 
    <p>An introduction is made using the <code class="literal">@DeclareParents</code> annotation. This annotation is used to declare that matching types have a new parent (hence the name). For example, given an interface <code class="literal">UsageTracked</code>, and an implementation of that interface <code class="literal">DefaultUsageTracked</code>, the following aspect declares that all implementors of service interfaces also implement the <code class="literal">UsageTracked</code> interface. (In order to expose statistics via JMX for example.)</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Aspect</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> UsageTracking {

    <i><span class="hl-annotation" style="color: gray">@DeclareParents(value=&quot;com.xzy.myapp.service.*+&quot;, defaultImpl=DefaultUsageTracked.class)</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> UsageTracked mixin;

    <i><span class="hl-annotation" style="color: gray">@Before(&quot;com.xyz.myapp.SystemArchitecture.businessService() &amp;&amp; this(usageTracked)&quot;)</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> recordUsage(UsageTracked usageTracked) {
        usageTracked.incrementUseCount();
    }

}</pre> 
    <p>The interface to be implemented is determined by the type of the annotated field. The <code class="literal">value</code> attribute of the <code class="literal">@DeclareParents</code> annotation is an AspectJ type pattern :- any bean of a matching type will implement the UsageTracked interface. Note that in the before advice of the above example, service beans can be directly used as implementations of the <code class="literal">UsageTracked</code> interface. If accessing a bean programmatically you would write the following:</p> 
    <pre class="programlisting">UsageTracked usageTracked = (UsageTracked) context.getBean(<span class="hl-string">&quot;myService&quot;</span>);</pre> 
   </div> 
   <div class="section" title="8.2.6&nbsp;Aspect instantiation models">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-instantiation-models"></a>8.2.6&nbsp;Aspect instantiation models</h3>
      </div>
     </div>
    </div> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>(This is an advanced topic, so if you are just starting out with AOP you can safely skip it until later.)</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>By default there will be a single instance of each aspect within the application context. AspectJ calls this the singleton instantiation model. It is possible to define aspects with alternate lifecycles :- Spring supports AspectJs <code class="literal">perthis</code> and <code class="literal">pertarget</code> instantiation models ( <code class="literal">percflow, percflowbelow,</code> and <code class="literal">pertypewithin</code> are not currently supported).</p> 
    <p>A &quot;perthis&quot; aspect is declared by specifying a <code class="literal">perthis</code> clause in the <code class="literal">@Aspect</code> annotation. Lets look at an example, and then well explain how it works.</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Aspect(&quot;perthis(com.xyz.myapp.SystemArchitecture.businessService())&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyAspect {

    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> someState;

    <i><span class="hl-annotation" style="color: gray">@Before(com.xyz.myapp.SystemArchitecture.businessService())</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> recordServiceUsage() {
        <span class="hl-comment">// ...</span>
    }

}</pre> 
    <p>The effect of the <code class="literal">'perthis'</code> clause is that one aspect instance will be created for each unique service object executing a business service (each unique object bound to <span class="emphasis"><em>this</em></span> at join points matched by the pointcut expression). The aspect instance is created the first time that a method is invoked on the service object. The aspect goes out of scope when the service object goes out of scope. Before the aspect instance is created, none of the advice within it executes. As soon as the aspect instance has been created, the advice declared within it will execute at matched join points, but only when the service object is the one this aspect is associated with. See the AspectJ programming guide for more information on per-clauses.</p> 
    <p>The <code class="literal">'pertarget'</code> instantiation model works in exactly the same way as perthis, but creates one aspect instance for each unique target object at matched join points.</p> 
   </div> 
   <div class="section" title="8.2.7&nbsp;Example">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-ataspectj-example"></a>8.2.7&nbsp;Example</h3>
      </div>
     </div>
    </div> 
    <p>Now that you have seen how all the constituent parts work, lets put them together to do something useful!</p> 
    <p>The execution of business services can sometimes fail due to concurrency issues (for example, deadlock loser). If the operation is retried, it is quite likely to succeed next time round. For business services where it is appropriate to retry in such conditions (idempotent operations that dont need to go back to the user for conflict resolution), wed like to transparently retry the operation to avoid the client seeing a <code class="literal">PessimisticLockingFailureException</code>. This is a requirement that clearly cuts across multiple services in the service layer, and hence is ideal for implementing via an aspect.</p> 
    <p>Because we want to retry the operation, we will need to use around advice so that we can call proceed multiple times. Heres how the basic aspect implementation looks:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Aspect</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ConcurrentOperationExecutor <span class="hl-keyword">implements</span> Ordered {

    <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> <span class="hl-keyword">final</span> <span class="hl-keyword">int</span> DEFAULT_MAX_RETRIES = <span class="hl-number">2</span>;

    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> maxRetries = DEFAULT_MAX_RETRIES;
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> order = <span class="hl-number">1</span>;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMaxRetries(<span class="hl-keyword">int</span> maxRetries) {
        <span class="hl-keyword">this</span>.maxRetries = maxRetries;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getOrder() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.order;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setOrder(<span class="hl-keyword">int</span> order) {
        <span class="hl-keyword">this</span>.order = order;
    }

    <i><span class="hl-annotation" style="color: gray">@Around(&quot;com.xyz.myapp.SystemArchitecture.businessService()&quot;)</span></i>
    <span class="hl-keyword">public</span> Object doConcurrentOperation(ProceedingJoinPoint pjp) <span class="hl-keyword">throws</span> Throwable {
        <span class="hl-keyword">int</span> numAttempts = <span class="hl-number">0</span>;
        PessimisticLockingFailureException lockFailureException;
        <span class="hl-keyword">do</span> {
            numAttempts++;
            <span class="hl-keyword">try</span> {
                <span class="hl-keyword">return</span> pjp.proceed();
            }
            <span class="hl-keyword">catch</span>(PessimisticLockingFailureException ex) {
                lockFailureException = ex;
            }
        } <span class="hl-keyword">while</span>(numAttempts &lt;= <span class="hl-keyword">this</span>.maxRetries);
        <span class="hl-keyword">throw</span> lockFailureException;
    }

}</pre> 
    <p>Note that the aspect implements the <code class="literal">Ordered</code> interface so we can set the precedence of the aspect higher than the transaction advice (we want a fresh transaction each time we retry). The <code class="literal">maxRetries</code> and <code class="literal">order</code> properties will both be configured by Spring. The main action happens in the <code class="literal">doConcurrentOperation</code> around advice. Notice that for the moment were applying the retry logic to all <code class="literal">businessService()s</code>. We try to proceed, and if we fail with an <code class="literal">PessimisticLockingFailureException</code> we simply try again unless we have exhausted all of our retry attempts.</p> 
    <p>The corresponding Spring configuration is:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;aop:aspectj-autoproxy/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;concurrentOperationExecutor&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.xyz.myapp.service.impl.ConcurrentOperationExecutor&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;maxRetries&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;3&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;order&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;100&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>To refine the aspect so that it only retries idempotent operations, we might define an <code class="literal">Idempotent</code> annotation:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></i>
<span class="hl-keyword">public</span> <i><span class="hl-annotation" style="color: gray">@interface</span></i> Idempotent {
    <span class="hl-comment">// marker annotation</span>
}</pre> 
    <p>and use the annotation to annotate the implementation of service operations. The change to the aspect to only retry idempotent operations simply involves refining the pointcut expression so that only <code class="literal">@Idempotent</code> operations match:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Around(&quot;com.xyz.myapp.SystemArchitecture.businessService() &amp;&amp; &quot; + &quot;@annotation(com.xyz.myapp.service.Idempotent)&quot;)</span></i>
<span class="hl-keyword">public</span> Object doConcurrentOperation(ProceedingJoinPoint pjp) <span class="hl-keyword">throws</span> Throwable {
    ...
}</pre> 
   </div> 
  </div> 
  <div class="section" title="8.3&nbsp;Schema-based AOP support">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="aop-schema"></a>8.3&nbsp;Schema-based AOP support</h2>
     </div>
    </div>
   </div> 
   <p>If you prefer an XML-based format, then Spring also offers support for defining aspects using the new &quot;aop&quot; namespace tags. The exact same pointcut expressions and advice kinds are supported as when using the @AspectJ style, hence in this section we will focus on the new <span class="emphasis"><em>syntax</em></span> and refer the reader to the discussion in the previous section (<a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-ataspectj" title="8.2&nbsp;@AspectJ support">Section&nbsp;8.2, @AspectJ support</a>) for an understanding of writing pointcut expressions and the binding of advice parameters.</p> 
   <p>To use the aop namespace tags described in this section, you need to import the spring-aop schema as described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#xsd-config" title="33.&nbsp;XML Schema-based configuration">Chapter&nbsp;33, <i>XML Schema-based configuration</i></a>. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-aop" title="33.2.7&nbsp;the aop schema">Section&nbsp;33.2.7, the aop schema</a> for how to import the tags in the aop namespace.</p> 
   <p>Within your Spring configurations, all aspect and advisor elements must be placed within an <code class="literal">&lt;aop:config&gt;</code> element (you can have more than one <code class="literal">&lt;aop:config&gt;</code> element in an application context configuration). An <code class="literal">&lt;aop:config&gt;</code> element can contain pointcut, advisor, and aspect elements (note these must be declared in that order).</p> 
   <div class="warning" title="Warning" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Warning">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Warning]" src="./Spring Framework Reference Documentation_files/warning.png" /></td>
       <th align="left">Warning</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>The <code class="literal">&lt;aop:config&gt;</code> style of configuration makes heavy use of Springs <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-autoproxy" title="9.9&nbsp;Using the &quot;auto-proxy&quot; facility">auto-proxying</a> mechanism. This can cause issues (such as advice not being woven) if you are already using explicit auto-proxying via the use of <code class="literal">BeanNameAutoProxyCreator</code> or suchlike. The recommended usage pattern is to use either just the <code class="literal">&lt;aop:config&gt;</code> style, or just the <code class="literal">AutoProxyCreator</code> style.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <div class="section" title="8.3.1&nbsp;Declaring an aspect">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-schema-declaring-an-aspect"></a>8.3.1&nbsp;Declaring an aspect</h3>
      </div>
     </div>
    </div> 
    <p>Using the schema support, an aspect is simply a regular Java object defined as a bean in your Spring application context. The state and behavior is captured in the fields and methods of the object, and the pointcut and advice information is captured in the XML.</p> 
    <p>An aspect is declared using the &lt;aop:aspect&gt; element, and the backing bean is referenced using the <code class="literal">ref</code> attribute:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;aop:config&gt;</span>
    <span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myAspect&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;aBean&quot;</span><span class="hl-tag">&gt;</span>
        ...
    <span class="hl-tag">&lt;/aop:aspect&gt;</span>
<span class="hl-tag">&lt;/aop:config&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;aBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;...&quot;</span><span class="hl-tag">&gt;</span>
    ...
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>The bean backing the aspect (&quot; <code class="literal">aBean</code>&quot; in this case) can of course be configured and dependency injected just like any other Spring bean.</p> 
   </div> 
   <div class="section" title="8.3.2&nbsp;Declaring a pointcut">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-schema-pointcuts"></a>8.3.2&nbsp;Declaring a pointcut</h3>
      </div>
     </div>
    </div> 
    <p>A named pointcut can be declared inside an &lt;aop:config&gt; element, enabling the pointcut definition to be shared across several aspects and advisors.</p> 
    <p>A pointcut representing the execution of any business service in the service layer could be defined as follows:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;aop:config&gt;</span>

    <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;businessService&quot;</span>
        <span class="hl-attribute">expression</span>=<span class="hl-value">&quot;execution(* com.xyz.myapp.service.</span><span class="strong"><strong>.</strong></span>(..))&quot;/&gt;

<span class="hl-tag">&lt;/aop:config&gt;</span></pre> 
    <p>Note that the pointcut expression itself is using the same AspectJ pointcut expression language as described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-ataspectj" title="8.2&nbsp;@AspectJ support">Section&nbsp;8.2, @AspectJ support</a>. If you are using the schema based declaration style, you can refer to named pointcuts defined in types (@Aspects) within the pointcut expression. Another way of defining the above pointcut would be:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;aop:config&gt;</span>

    <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;businessService&quot;</span>
        <span class="hl-attribute">expression</span>=<span class="hl-value">&quot;com.xyz.myapp.SystemArchitecture.businessService()&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/aop:config&gt;</span></pre> 
    <p>Assuming you have a <code class="literal">SystemArchitecture</code> aspect as described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-common-pointcuts" title="Sharing common pointcut definitions">the section called Sharing common pointcut definitions</a>.</p> 
    <p>Declaring a pointcut inside an aspect is very similar to declaring a top-level pointcut:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;aop:config&gt;</span>

    <span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myAspect&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;aBean&quot;</span><span class="hl-tag">&gt;</span>

        <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;businessService&quot;</span>
            <span class="hl-attribute">expression</span>=<span class="hl-value">&quot;execution(* com.xyz.myapp.service.</span><span class="strong"><strong>.</strong></span>(..))&quot;/&gt;

        ...

    <span class="hl-tag">&lt;/aop:aspect&gt;</span>

<span class="hl-tag">&lt;/aop:config&gt;</span></pre> 
    <p>Much the same way in an @AspectJ aspect, pointcuts declared using the schema based definition style may collect join point context. For example, the following pointcut collects the <span class="emphasis"><em>this</em></span> object as the join point context and passes it to advice:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;aop:config&gt;</span>

    <span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myAspect&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;aBean&quot;</span><span class="hl-tag">&gt;</span>

        <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;businessService&quot;</span>
            <span class="hl-attribute">expression</span>=<span class="hl-value">&quot;execution(* com.xyz.myapp.service.</span><span class="strong"><strong>.</strong></span>(..)) &amp;amp;&amp;amp; this(service)&quot;/&gt;

        <span class="hl-tag">&lt;aop:before</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">&quot;businessService&quot;</span> <span class="hl-attribute">method</span>=<span class="hl-value">&quot;monitor&quot;</span><span class="hl-tag">/&gt;</span>

        ...

    <span class="hl-tag">&lt;/aop:aspect&gt;</span>

<span class="hl-tag">&lt;/aop:config&gt;</span></pre> 
    <p>The advice must be declared to receive the collected join point context by including parameters of the matching names:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">void</span> monitor(Object service) {
    ...
}</pre> 
    <p>When combining pointcut sub-expressions, <span class="emphasis"><em>&amp;&amp;</em></span> is awkward within an XML document, and so the keywords <span class="emphasis"><em>and</em></span>, <span class="emphasis"><em>or</em></span> and <span class="emphasis"><em>not</em></span> can be used in place of <span class="emphasis"><em>&amp;&amp;</em></span>, <span class="emphasis"><em>||</em></span> and <span class="emphasis"><em>!</em></span> respectively. For example, the previous pointcut may be better written as:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;aop:config&gt;</span>

    <span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myAspect&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;aBean&quot;</span><span class="hl-tag">&gt;</span>

        <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;businessService&quot;</span>
            <span class="hl-attribute">expression</span>=<span class="hl-value">&quot;execution(* com.xyz.myapp.service.</span><span class="strong"><strong>.</strong></span>(..)) <span class="strong"><strong>and</strong></span> this(service)&quot;/&gt;

        <span class="hl-tag">&lt;aop:before</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">&quot;businessService&quot;</span> <span class="hl-attribute">method</span>=<span class="hl-value">&quot;monitor&quot;</span><span class="hl-tag">/&gt;</span>

        ...
    <span class="hl-tag">&lt;/aop:aspect&gt;</span>
<span class="hl-tag">&lt;/aop:config&gt;</span></pre> 
    <p>Note that pointcuts defined in this way are referred to by their XML id and cannot be used as named pointcuts to form composite pointcuts. The named pointcut support in the schema based definition style is thus more limited than that offered by the @AspectJ style.</p> 
   </div> 
   <div class="section" title="8.3.3&nbsp;Declaring advice">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-schema-advice"></a>8.3.3&nbsp;Declaring advice</h3>
      </div>
     </div>
    </div> 
    <p>The same five advice kinds are supported as for the @AspectJ style, and they have exactly the same semantics.</p> 
    <div class="section" title="Before advice">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-schema-advice-before"></a>Before advice</h4>
       </div>
      </div>
     </div> 
     <p>Before advice runs before a matched method execution. It is declared inside an <code class="literal">&lt;aop:aspect&gt;</code> using the &lt;aop:before&gt; element.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;beforeExample&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;aBean&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:before</span>
        <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">&quot;dataAccessOperation&quot;</span>
        <span class="hl-attribute">method</span>=<span class="hl-value">&quot;doAccessCheck&quot;</span><span class="hl-tag">/&gt;</span>

    ...

<span class="hl-tag">&lt;/aop:aspect&gt;</span></pre> 
     <p>Here <code class="literal">dataAccessOperation</code> is the id of a pointcut defined at the top ( <code class="literal">&lt;aop:config&gt;</code>) level. To define the pointcut inline instead, replace the <code class="literal">pointcut-ref</code> attribute with a <code class="literal">pointcut</code> attribute:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;beforeExample&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;aBean&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:before</span>
        <span class="hl-attribute">pointcut</span>=<span class="hl-value">&quot;execution(* com.xyz.myapp.dao.</span><span class="strong"><strong>.</strong></span>(..))&quot;
        method=&quot;doAccessCheck&quot;/&gt;

    ...

<span class="hl-tag">&lt;/aop:aspect&gt;</span></pre> 
     <p>As we noted in the discussion of the @AspectJ style, using named pointcuts can significantly improve the readability of your code.</p> 
     <p>The method attribute identifies a method ( <code class="literal">doAccessCheck</code>) that provides the body of the advice. This method must be defined for the bean referenced by the aspect element containing the advice. Before a data access operation is executed (a method execution join point matched by the pointcut expression), the &quot;doAccessCheck&quot; method on the aspect bean will be invoked.</p> 
    </div> 
    <div class="section" title="After returning advice">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-schema-advice-after-returning"></a>After returning advice</h4>
       </div>
      </div>
     </div> 
     <p>After returning advice runs when a matched method execution completes normally. It is declared inside an <code class="literal">&lt;aop:aspect&gt;</code> in the same way as before advice. For example:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;afterReturningExample&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;aBean&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:after-returning</span>
        <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">&quot;dataAccessOperation&quot;</span>
        <span class="hl-attribute">method</span>=<span class="hl-value">&quot;doAccessCheck&quot;</span><span class="hl-tag">/&gt;</span>

    ...

<span class="hl-tag">&lt;/aop:aspect&gt;</span></pre> 
     <p>Just as in the @AspectJ style, it is possible to get hold of the return value within the advice body. Use the returning attribute to specify the name of the parameter to which the return value should be passed:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;afterReturningExample&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;aBean&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:after-returning</span>
        <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">&quot;dataAccessOperation&quot;</span>
        <span class="hl-attribute">returning</span>=<span class="hl-value">&quot;retVal&quot;</span>
        <span class="hl-attribute">method</span>=<span class="hl-value">&quot;doAccessCheck&quot;</span><span class="hl-tag">/&gt;</span>

    ...

<span class="hl-tag">&lt;/aop:aspect&gt;</span></pre> 
     <p>The doAccessCheck method must declare a parameter named <code class="literal">retVal</code>. The type of this parameter constrains matching in the same way as described for @AfterReturning. For example, the method signature may be declared as:</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doAccessCheck(Object retVal) {...</pre> 
    </div> 
    <div class="section" title="After throwing advice">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-schema-advice-after-throwing"></a>After throwing advice</h4>
       </div>
      </div>
     </div> 
     <p>After throwing advice executes when a matched method execution exits by throwing an exception. It is declared inside an <code class="literal">&lt;aop:aspect&gt;</code> using the after-throwing element:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;afterThrowingExample&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;aBean&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:after-throwing</span>
        <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">&quot;dataAccessOperation&quot;</span>
        <span class="hl-attribute">method</span>=<span class="hl-value">&quot;doRecoveryActions&quot;</span><span class="hl-tag">/&gt;</span>

    ...

<span class="hl-tag">&lt;/aop:aspect&gt;</span></pre> 
     <p>Just as in the @AspectJ style, it is possible to get hold of the thrown exception within the advice body. Use the throwing attribute to specify the name of the parameter to which the exception should be passed:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;afterThrowingExample&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;aBean&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:after-throwing</span>
        <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">&quot;dataAccessOperation&quot;</span>
        <span class="hl-attribute">throwing</span>=<span class="hl-value">&quot;dataAccessEx&quot;</span>
        <span class="hl-attribute">method</span>=<span class="hl-value">&quot;doRecoveryActions&quot;</span><span class="hl-tag">/&gt;</span>

    ...

<span class="hl-tag">&lt;/aop:aspect&gt;</span></pre> 
     <p>The doRecoveryActions method must declare a parameter named <code class="literal">dataAccessEx</code>. The type of this parameter constrains matching in the same way as described for @AfterThrowing. For example, the method signature may be declared as:</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">void</span> doRecoveryActions(DataAccessException dataAccessEx) {...</pre> 
    </div> 
    <div class="section" title="After (finally) advice">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-schema-advice-after-finally"></a>After (finally) advice</h4>
       </div>
      </div>
     </div> 
     <p>After (finally) advice runs however a matched method execution exits. It is declared using the <code class="literal">after</code> element:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;afterFinallyExample&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;aBean&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:after</span>
        <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">&quot;dataAccessOperation&quot;</span>
        <span class="hl-attribute">method</span>=<span class="hl-value">&quot;doReleaseLock&quot;</span><span class="hl-tag">/&gt;</span>

    ...

<span class="hl-tag">&lt;/aop:aspect&gt;</span></pre> 
    </div> 
    <div class="section" title="Around advice">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-schema-advice-around"></a>Around advice</h4>
       </div>
      </div>
     </div> 
     <p>The final kind of advice is around advice. Around advice runs &quot;around&quot; a matched method execution. It has the opportunity to do work both before and after the method executes, and to determine when, how, and even if, the method actually gets to execute at all. Around advice is often used if you need to share state before and after a method execution in a thread-safe manner (starting and stopping a timer for example). Always use the least powerful form of advice that meets your requirements; dont use around advice if simple before advice would do.</p> 
     <p>Around advice is declared using the <code class="literal">aop:around</code> element. The first parameter of the advice method must be of type <code class="literal">ProceedingJoinPoint</code>. Within the body of the advice, calling <code class="literal">proceed()</code> on the <code class="literal">ProceedingJoinPoint</code> causes the underlying method to execute. The <code class="literal">proceed</code> method may also be calling passing in an <code class="literal">Object[]</code> - the values in the array will be used as the arguments to the method execution when it proceeds. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-ataspectj-around-advice" title="Around advice">the section called Around advice</a> for notes on calling proceed with an <code class="literal">Object[]</code>.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;aroundExample&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;aBean&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:around</span>
        <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">&quot;businessService&quot;</span>
        <span class="hl-attribute">method</span>=<span class="hl-value">&quot;doBasicProfiling&quot;</span><span class="hl-tag">/&gt;</span>

    ...

<span class="hl-tag">&lt;/aop:aspect&gt;</span></pre> 
     <p>The implementation of the <code class="literal">doBasicProfiling</code> advice would be exactly the same as in the @AspectJ example (minus the annotation of course):</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> Object doBasicProfiling(ProceedingJoinPoint pjp) <span class="hl-keyword">throws</span> Throwable {
    <span class="hl-comment">// start stopwatch</span>
    Object retVal = pjp.proceed();
    <span class="hl-comment">// stop stopwatch</span>
    <span class="hl-keyword">return</span> retVal;
}</pre> 
    </div> 
    <div class="section" title="Advice parameters">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-schema-params"></a>Advice parameters</h4>
       </div>
      </div>
     </div> 
     <p>The schema based declaration style supports fully typed advice in the same way as described for the @AspectJ support - by matching pointcut parameters by name against advice method parameters. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-ataspectj-advice-params" title="Advice parameters">the section called Advice parameters</a> for details. If you wish to explicitly specify argument names for the advice methods (not relying on the detection strategies previously described) then this is done using the <code class="literal">arg-names</code> attribute of the advice element, which is treated in the same manner to the &quot;argNames&quot; attribute in an advice annotation as described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-ataspectj-advice-params-names" title="Determining argument names">the section called Determining argument names</a>. For example:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;aop:before</span>
    <span class="hl-attribute">pointcut</span>=<span class="hl-value">&quot;com.xyz.lib.Pointcuts.anyPublicMethod() and @annotation(auditable)&quot;</span>
    <span class="hl-attribute">method</span>=<span class="hl-value">&quot;audit&quot;</span>
    <span class="hl-attribute">arg-names</span>=<span class="hl-value">&quot;auditable&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <p>The <code class="literal">arg-names</code> attribute accepts a comma-delimited list of parameter names.</p> 
     <p>Find below a slightly more involved example of the XSD-based approach that illustrates some around advice used in conjunction with a number of strongly typed parameters.</p> 
     <pre class="programlisting"><span class="hl-keyword">package</span> x.y.service;

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> FooService {

    Foo getFoo(String fooName, <span class="hl-keyword">int</span> age);
}

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DefaultFooService <span class="hl-keyword">implements</span> FooService {

    <span class="hl-keyword">public</span> Foo getFoo(String name, <span class="hl-keyword">int</span> age) {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> Foo(name, age);
    }
}</pre> 
     <p>Next up is the aspect. Notice the fact that the <code class="literal">profile(..)</code> method accepts a number of strongly-typed parameters, the first of which happens to be the join point used to proceed with the method call: the presence of this parameter is an indication that the <code class="literal">profile(..)</code> is to be used as <code class="literal">around</code> advice:</p> 
     <pre class="programlisting"><span class="hl-keyword">package</span> x.y;

<span class="hl-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;
<span class="hl-keyword">import</span> org.springframework.util.StopWatch;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleProfiler {

    <span class="hl-keyword">public</span> Object profile(ProceedingJoinPoint call, String name, <span class="hl-keyword">int</span> age) <span class="hl-keyword">throws</span> Throwable {
        StopWatch clock = <span class="hl-keyword">new</span> StopWatch(<span class="hl-string">&quot;Profiling for </span><span class="emphasis"><em>&quot; + name + &quot;</em></span> and <span class="emphasis"><em>&quot; + age + &quot;</em></span><span class="hl-string">&quot;);
</span>        <span class="hl-keyword">try</span> {
            clock.start(call.toShortString());
            <span class="hl-keyword">return</span> call.proceed();
        } <span class="hl-keyword">finally</span> {
            clock.stop();
            System.out.println(clock.prettyPrint());
        }
    }
}</pre> 
     <p>Finally, here is the XML configuration that is required to effect the execution of the above advice for a particular join point:</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:aop</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/aop&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- this is the object that will be proxied by Spring's AOP infrastructure --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;fooService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;x.y.service.DefaultFooService&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- this is the actual advice itself --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;profiler&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;x.y.SimpleProfiler&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;aop:config&gt;</span>
        <span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;profiler&quot;</span><span class="hl-tag">&gt;</span>

            <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;theExecutionOfSomeFooServiceMethod&quot;</span>
                <span class="hl-attribute">expression</span>=<span class="hl-value">&quot;execution(* x.y.service.FooService.getFoo(String,int))
                and args(name, age)&quot;</span><span class="hl-tag">/&gt;</span>

            <span class="hl-tag">&lt;aop:around</span> <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">&quot;theExecutionOfSomeFooServiceMethod&quot;</span>
                <span class="hl-attribute">method</span>=<span class="hl-value">&quot;profile&quot;</span><span class="hl-tag">/&gt;</span>

        <span class="hl-tag">&lt;/aop:aspect&gt;</span>
    <span class="hl-tag">&lt;/aop:config&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
     <p>If we had the following driver script, we would get output something like this on standard output:</p> 
     <pre class="programlisting"><span class="hl-keyword">import</span> org.springframework.beans.factory.BeanFactory;
<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;
<span class="hl-keyword">import</span> x.y.service.FooService;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> Boot {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(<span class="hl-keyword">final</span> String[] args) <span class="hl-keyword">throws</span> Exception {
        BeanFactory ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">&quot;x/y/plain.xml&quot;</span>);
        FooService foo = (FooService) ctx.getBean(<span class="hl-string">&quot;fooService&quot;</span>);
        foo.getFoo(<span class="hl-string">&quot;Pengo&quot;</span>, <span class="hl-number">12</span>);
    }
}</pre> 
     <pre class="literallayout">StopWatch <span class="emphasis"><em>Profiling for 'Pengo</em></span> and <span class="emphasis"><em>12</em></span>': running time (millis) = 0
-----------------------------------------
ms     %     Task name
-----------------------------------------
00000  ?  execution(getFoo)</pre> 
    </div> 
    <div class="section" title="Advice ordering">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-ordering"></a>Advice ordering</h4>
       </div>
      </div>
     </div> 
     <p>When multiple advice needs to execute at the same join point (executing method) the ordering rules are as described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-ataspectj-advice-ordering" title="Advice ordering">the section called Advice ordering</a>. The precedence between aspects is determined by either adding the <code class="literal">Order</code> annotation to the bean backing the aspect or by having the bean implement the <code class="literal">Ordered</code> interface.</p> 
    </div> 
   </div> 
   <div class="section" title="8.3.4&nbsp;Introductions">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-schema-introductions"></a>8.3.4&nbsp;Introductions</h3>
      </div>
     </div>
    </div> 
    <p>Introductions (known as inter-type declarations in AspectJ) enable an aspect to declare that advised objects implement a given interface, and to provide an implementation of that interface on behalf of those objects.</p> 
    <p>An introduction is made using the <code class="literal">aop:declare-parents</code> element inside an <code class="literal">aop:aspect</code> This element is used to declare that matching types have a new parent (hence the name). For example, given an interface <code class="literal">UsageTracked</code>, and an implementation of that interface <code class="literal">DefaultUsageTracked</code>, the following aspect declares that all implementors of service interfaces also implement the <code class="literal">UsageTracked</code> interface. (In order to expose statistics via JMX for example.)</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;usageTrackerAspect&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;usageTracking&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;aop:declare-parents</span>
        <span class="hl-attribute">types-matching</span>=<span class="hl-value">&quot;com.xzy.myapp.service.*+&quot;</span>
        <span class="hl-attribute">implement-interface</span>=<span class="hl-value">&quot;com.xyz.myapp.service.tracking.UsageTracked&quot;</span>
        <span class="hl-attribute">default-impl</span>=<span class="hl-value">&quot;com.xyz.myapp.service.tracking.DefaultUsageTracked&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;aop:before</span>
        <span class="hl-attribute">pointcut</span>=<span class="hl-value">&quot;com.xyz.myapp.SystemArchitecture.businessService()
            and this(usageTracked)&quot;</span>
            <span class="hl-attribute">method</span>=<span class="hl-value">&quot;recordUsage&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/aop:aspect&gt;</span></pre> 
    <p>The class backing the <code class="literal">usageTracking</code> bean would contain the method:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">void</span> recordUsage(UsageTracked usageTracked) {
    usageTracked.incrementUseCount();
}</pre> 
    <p>The interface to be implemented is determined by <code class="literal">implement-interface</code> attribute. The value of the <code class="literal">types-matching</code> attribute is an AspectJ type pattern :- any bean of a matching type will implement the <code class="literal">UsageTracked</code> interface. Note that in the before advice of the above example, service beans can be directly used as implementations of the <code class="literal">UsageTracked</code> interface. If accessing a bean programmatically you would write the following:</p> 
    <pre class="programlisting">UsageTracked usageTracked = (UsageTracked) context.getBean(<span class="hl-string">&quot;myService&quot;</span>);</pre> 
   </div> 
   <div class="section" title="8.3.5&nbsp;Aspect instantiation models">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-schema-instatiation-models"></a>8.3.5&nbsp;Aspect instantiation models</h3>
      </div>
     </div>
    </div> 
    <p>The only supported instantiation model for schema-defined aspects is the singleton model. Other instantiation models may be supported in future releases.</p> 
   </div> 
   <div class="section" title="8.3.6&nbsp;Advisors">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-schema-advisors"></a>8.3.6&nbsp;Advisors</h3>
      </div>
     </div>
    </div> 
    <p>The concept of &quot;advisors&quot; is brought forward from the AOP support defined in Spring 1.2 and does not have a direct equivalent in AspectJ. An advisor is like a small self-contained aspect that has a single piece of advice. The advice itself is represented by a bean, and must implement one of the advice interfaces described in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-api-advice-types" title="9.3.2&nbsp;Advice types in Spring">Section&nbsp;9.3.2, Advice types in Spring</a>. Advisors can take advantage of AspectJ pointcut expressions though.</p> 
    <p>Spring supports the advisor concept with the <code class="literal">&lt;aop:advisor&gt;</code> element. You will most commonly see it used in conjunction with transactional advice, which also has its own namespace support in Spring. Heres how it looks:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;aop:config&gt;</span>

    <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;businessService&quot;</span>
        <span class="hl-attribute">expression</span>=<span class="hl-value">&quot;execution(* com.xyz.myapp.service.</span><span class="strong"><strong>.</strong></span>(..))&quot;/&gt;

    <span class="hl-tag">&lt;aop:advisor</span>
        <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">&quot;businessService&quot;</span>
        <span class="hl-attribute">advice-ref</span>=<span class="hl-value">&quot;tx-advice&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/aop:config&gt;</span>

<span class="hl-tag">&lt;tx:advice</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;tx-advice&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;tx:attributes&gt;</span>
        <span class="hl-tag">&lt;tx:method</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;*&quot;</span> <span class="hl-attribute">propagation</span>=<span class="hl-value">&quot;REQUIRED&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/tx:attributes&gt;</span>
<span class="hl-tag">&lt;/tx:advice&gt;</span></pre> 
    <p>As well as the <code class="literal">pointcut-ref</code> attribute used in the above example, you can also use the <code class="literal">pointcut</code> attribute to define a pointcut expression inline.</p> 
    <p>To define the precedence of an advisor so that the advice can participate in ordering, use the <code class="literal">order</code> attribute to define the <code class="literal">Ordered</code> value of the advisor.</p> 
   </div> 
   <div class="section" title="8.3.7&nbsp;Example">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-schema-example"></a>8.3.7&nbsp;Example</h3>
      </div>
     </div>
    </div> 
    <p>Lets see how the concurrent locking failure retry example from <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-ataspectj-example" title="8.2.7&nbsp;Example">Section&nbsp;8.2.7, Example</a> looks when rewritten using the schema support.</p> 
    <p>The execution of business services can sometimes fail due to concurrency issues (for example, deadlock loser). If the operation is retried, it is quite likely it will succeed next time round. For business services where it is appropriate to retry in such conditions (idempotent operations that dont need to go back to the user for conflict resolution), wed like to transparently retry the operation to avoid the client seeing a <code class="literal">PessimisticLockingFailureException</code>. This is a requirement that clearly cuts across multiple services in the service layer, and hence is ideal for implementing via an aspect.</p> 
    <p>Because we want to retry the operation, well need to use around advice so that we can call proceed multiple times. Heres how the basic aspect implementation looks (its just a regular Java class using the schema support):</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ConcurrentOperationExecutor <span class="hl-keyword">implements</span> Ordered {

    <span class="hl-keyword">private</span> <span class="hl-keyword">static</span> <span class="hl-keyword">final</span> <span class="hl-keyword">int</span> DEFAULT_MAX_RETRIES = <span class="hl-number">2</span>;

    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> maxRetries = DEFAULT_MAX_RETRIES;
    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> order = <span class="hl-number">1</span>;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setMaxRetries(<span class="hl-keyword">int</span> maxRetries) {
        <span class="hl-keyword">this</span>.maxRetries = maxRetries;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getOrder() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.order;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setOrder(<span class="hl-keyword">int</span> order) {
        <span class="hl-keyword">this</span>.order = order;
    }

    <span class="hl-keyword">public</span> Object doConcurrentOperation(ProceedingJoinPoint pjp) <span class="hl-keyword">throws</span> Throwable {
        <span class="hl-keyword">int</span> numAttempts = <span class="hl-number">0</span>;
        PessimisticLockingFailureException lockFailureException;
        <span class="hl-keyword">do</span> {
            numAttempts++;
            <span class="hl-keyword">try</span> {
                <span class="hl-keyword">return</span> pjp.proceed();
            }
            <span class="hl-keyword">catch</span>(PessimisticLockingFailureException ex) {
                lockFailureException = ex;
            }
        } <span class="hl-keyword">while</span>(numAttempts &lt;= <span class="hl-keyword">this</span>.maxRetries);
        <span class="hl-keyword">throw</span> lockFailureException;
    }

}</pre> 
    <p>Note that the aspect implements the <code class="literal">Ordered</code> interface so we can set the precedence of the aspect higher than the transaction advice (we want a fresh transaction each time we retry). The <code class="literal">maxRetries</code> and <code class="literal">order</code> properties will both be configured by Spring. The main action happens in the <code class="literal">doConcurrentOperation</code> around advice method. We try to proceed, and if we fail with a <code class="literal">PessimisticLockingFailureException</code> we simply try again unless we have exhausted all of our retry attempts.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>This class is identical to the one used in the @AspectJ example, but with the annotations removed.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>The corresponding Spring configuration is:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;aop:config&gt;</span>

    <span class="hl-tag">&lt;aop:aspect</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;concurrentOperationRetry&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;concurrentOperationExecutor&quot;</span><span class="hl-tag">&gt;</span>

        <span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;idempotentOperation&quot;</span>
            <span class="hl-attribute">expression</span>=<span class="hl-value">&quot;execution(* com.xyz.myapp.service.</span><span class="strong"><strong>.</strong></span>(..))&quot;/&gt;

        <span class="hl-tag">&lt;aop:around</span>
            <span class="hl-attribute">pointcut-ref</span>=<span class="hl-value">&quot;idempotentOperation&quot;</span>
            <span class="hl-attribute">method</span>=<span class="hl-value">&quot;doConcurrentOperation&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;/aop:aspect&gt;</span>

<span class="hl-tag">&lt;/aop:config&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;concurrentOperationExecutor&quot;</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.xyz.myapp.service.impl.ConcurrentOperationExecutor&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;maxRetries&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;3&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;order&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;100&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>Notice that for the time being we assume that all business services are idempotent. If this is not the case we can refine the aspect so that it only retries genuinely idempotent operations, by introducing an <code class="literal">Idempotent</code> annotation:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></i>
<span class="hl-keyword">public</span> <i><span class="hl-annotation" style="color: gray">@interface</span></i> Idempotent {
    <span class="hl-comment">// marker annotation</span>
}</pre> 
    <p>and using the annotation to annotate the implementation of service operations. The change to the aspect to retry only idempotent operations simply involves refining the pointcut expression so that only <code class="literal">@Idempotent</code> operations match:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;idempotentOperation&quot;</span>
        <span class="hl-attribute">expression</span>=<span class="hl-value">&quot;execution(* com.xyz.myapp.service.</span><span class="strong"><strong>.</strong></span>(..)) and
        @annotation(com.xyz.myapp.service.Idempotent)&quot;/&gt;</pre> 
   </div> 
  </div> 
  <div class="section" title="8.4&nbsp;Choosing which AOP declaration style to use">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="aop-choosing"></a>8.4&nbsp;Choosing which AOP declaration style to use</h2>
     </div>
    </div>
   </div> 
   <p>Once you have decided that an aspect is the best approach for implementing a given requirement, how do you decide between using Spring AOP or AspectJ, and between the Aspect language (code) style, @AspectJ annotation style, or the Spring XML style? These decisions are influenced by a number of factors including application requirements, development tools, and team familiarity with AOP.</p> 
   <div class="section" title="8.4.1&nbsp;Spring AOP or full AspectJ?">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-spring-or-aspectj"></a>8.4.1&nbsp;Spring AOP or full AspectJ?</h3>
      </div>
     </div>
    </div> 
    <p>Use the simplest thing that can work. Spring AOP is simpler than using full AspectJ as there is no requirement to introduce the AspectJ compiler / weaver into your development and build processes. If you only need to advise the execution of operations on Spring beans, then Spring AOP is the right choice. If you need to advise objects not managed by the Spring container (such as domain objects typically), then you will need to use AspectJ. You will also need to use AspectJ if you wish to advise join points other than simple method executions (for example, field get or set join points, and so on).</p> 
    <p>When using AspectJ, you have the choice of the AspectJ language syntax (also known as the &quot;code style&quot;) or the @AspectJ annotation style. Clearly, if you are not using Java 5+ then the choice has been made for you use the code style. If aspects play a large role in your design, and you are able to use the <a class="ulink" href="http://www.eclipse.org/ajdt/" target="_top">AspectJ Development Tools (AJDT)</a> plugin for Eclipse, then the AspectJ language syntax is the preferred option: it is cleaner and simpler because the language was purposefully designed for writing aspects. If you are not using Eclipse, or have only a few aspects that do not play a major role in your application, then you may want to consider using the @AspectJ style and sticking with a regular Java compilation in your IDE, and adding an aspect weaving phase to your build script.</p> 
   </div> 
   <div class="section" title="8.4.2&nbsp;@AspectJ or XML for Spring AOP?">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-ataspectj-or-xml"></a>8.4.2&nbsp;@AspectJ or XML for Spring AOP?</h3>
      </div>
     </div>
    </div> 
    <p>If you have chosen to use Spring AOP, then you have a choice of @AspectJ or XML style. There are various tradeoffs to consider.</p> 
    <p>The XML style will be most familiar to existing Spring users and it is backed by genuine POJOs. When using AOP as a tool to configure enterprise services then XML can be a good choice (a good test is whether you consider the pointcut expression to be a part of your configuration you might want to change independently). With the XML style arguably it is clearer from your configuration what aspects are present in the system.</p> 
    <p>The XML style has two disadvantages. Firstly it does not fully encapsulate the implementation of the requirement it addresses in a single place. The DRY principle says that there should be a single, unambiguous, authoritative representation of any piece of knowledge within a system. When using the XML style, the knowledge of <span class="emphasis"><em>how</em></span> a requirement is implemented is split across the declaration of the backing bean class, and the XML in the configuration file. When using the @AspectJ style there is a single module - the aspect - in which this information is encapsulated. Secondly, the XML style is slightly more limited in what it can express than the @AspectJ style: only the &quot;singleton&quot; aspect instantiation model is supported, and it is not possible to combine named pointcuts declared in XML. For example, in the @AspectJ style you can write something like:</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Pointcut(execution(* get*()))</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> propertyAccess() {}

    @Pointcut(execution(org.xyz.Account+ *(..))
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> operationReturningAnAccount() {}

    <i><span class="hl-annotation" style="color: gray">@Pointcut(propertyAccess() &amp;&amp; operationReturningAnAccount())</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> accountPropertyAccess() {}</pre> 
    <p>In the XML style I can declare the first two pointcuts:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;propertyAccess&quot;</span>
        <span class="hl-attribute">expression</span>=<span class="hl-value">&quot;execution(* get*())&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;aop:pointcut</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;operationReturningAnAccount&quot;</span>
        <span class="hl-attribute">expression</span>=<span class="hl-value">&quot;execution(org.xyz.Account+ *(..))&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <p>The downside of the XML approach is that you cannot define the ' <code class="literal">accountPropertyAccess</code>' pointcut by combining these definitions.</p> 
    <p>The @AspectJ style supports additional instantiation models, and richer pointcut composition. It has the advantage of keeping the aspect as a modular unit. It also has the advantage the @AspectJ aspects can be understood (and thus consumed) both by Spring AOP and by AspectJ - so if you later decide you need the capabilities of AspectJ to implement additional requirements then it is very easy to migrate to an AspectJ-based approach. On balance the Spring team prefer the @AspectJ style whenever you have aspects that do more than simple &quot;configuration&quot; of enterprise services.</p> 
   </div> 
  </div> 
  <div class="section" title="8.5&nbsp;Mixing aspect types">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="aop-mixing-styles"></a>8.5&nbsp;Mixing aspect types</h2>
     </div>
    </div>
   </div> 
   <p>It is perfectly possible to mix @AspectJ style aspects using the autoproxying support, schema-defined <code class="literal">&lt;aop:aspect&gt;</code> aspects, <code class="literal">&lt;aop:advisor&gt;</code> declared advisors and even proxies and interceptors defined using the Spring 1.2 style in the same configuration. All of these are implemented using the same underlying support mechanism and will co-exist without any difficulty.</p> 
  </div> 
  <div class="section" title="8.6&nbsp;Proxying mechanisms">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="aop-proxying"></a>8.6&nbsp;Proxying mechanisms</h2>
     </div>
    </div>
   </div> 
   <p>Spring AOP uses either JDK dynamic proxies or CGLIB to create the proxy for a given target object. (JDK dynamic proxies are preferred whenever you have a choice).</p> 
   <p>If the target object to be proxied implements at least one interface then a JDK dynamic proxy will be used. All of the interfaces implemented by the target type will be proxied. If the target object does not implement any interfaces then a CGLIB proxy will be created.</p> 
   <p>If you want to force the use of CGLIB proxying (for example, to proxy every method defined for the target object, not just those implemented by its interfaces) you can do so. However, there are some issues to consider:</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem"> <code class="literal">final</code> methods cannot be advised, as they cannot be overridden. </li>
     <li class="listitem"> As of Spring 3.2, it is no longer necessary to add CGLIB to your project classpath, as CGLIB classes are repackaged under org.springframework and included directly in the spring-core JAR. This means that CGLIB-based proxy support <span class="emphasis"><em>just works</em></span> in the same way that JDK dynamic proxies always have. </li>
     <li class="listitem"> The constructor of your proxied object will be called twice. This is a natural consequence of the CGLIB proxy model whereby a subclass is generated for each proxied object. For each proxied instance, two objects are created: the actual proxied object and an instance of the subclass that implements the advice. This behavior is not exhibited when using JDK proxies. Usually, calling the constructor of the proxied type twice, is not an issue, as there are usually only assignments taking place and no real logic is implemented in the constructor. </li>
    </ul>
   </div> 
   <p>To force the use of CGLIB proxies set the value of the <code class="literal">proxy-target-class</code> attribute of the <code class="literal">&lt;aop:config&gt;</code> element to true:</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;aop:config</span> <span class="hl-attribute">proxy-target-class</span>=<span class="hl-value">&quot;true&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- other beans defined here... --&gt;</span>
<span class="hl-tag">&lt;/aop:config&gt;</span></pre> 
   <p>To force CGLIB proxying when using the @AspectJ autoproxy support, set the <code class="literal">'proxy-target-class'</code> attribute of the <code class="literal">&lt;aop:aspectj-autoproxy&gt;</code> element to <code class="literal">true</code>:</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;aop:aspectj-autoproxy</span> <span class="hl-attribute">proxy-target-class</span>=<span class="hl-value">&quot;true&quot;</span><span class="hl-tag">/&gt;</span></pre> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>Multiple <code class="literal">&lt;aop:config/&gt;</code> sections are collapsed into a single unified auto-proxy creator at runtime, which applies the <span class="emphasis"><em>strongest</em></span> proxy settings that any of the <code class="literal">&lt;aop:config/&gt;</code> sections (typically from different XML bean definition files) specified. This also applies to the <code class="literal">&lt;tx:annotation-driven/&gt;</code> and <code class="literal">&lt;aop:aspectj-autoproxy/&gt;</code> elements.</p> <p>To be clear: using ' <code class="literal">proxy-target-class=&quot;true&quot;</code>' on <code class="literal">&lt;tx:annotation-driven/&gt;</code>, <code class="literal">&lt;aop:aspectj-autoproxy/&gt;</code> or <code class="literal">&lt;aop:config/&gt;</code> elements will force the use of CGLIB proxies <span class="emphasis"><em>for all three of them</em></span>.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <div class="section" title="8.6.1&nbsp;Understanding AOP proxies">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-understanding-aop-proxies"></a>8.6.1&nbsp;Understanding AOP proxies</h3>
      </div>
     </div>
    </div> 
    <p>Spring AOP is <span class="emphasis"><em>proxy-based</em></span>. It is vitally important that you grasp the semantics of what that last statement actually means before you write your own aspects or use any of the Spring AOP-based aspects supplied with the Spring Framework.</p> 
    <p>Consider first the scenario where you have a plain-vanilla, un-proxied, nothing-special-about-it, straight object reference, as illustrated by the following code snippet.</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimplePojo <span class="hl-keyword">implements</span> Pojo {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> foo() {
        <span class="hl-comment">// this next method invocation is a direct call on the </span><span class="emphasis"><em>this</em></span> reference
        <span class="hl-keyword">this</span>.bar();
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> bar() {
        <span class="hl-comment">// some logic...</span>
    }
}</pre> 
    <p>If you invoke a method on an object reference, the method is invoked <span class="emphasis"><em>directly</em></span> on that object reference, as can be seen below.</p> 
    <div class="figure">
     <a name="d4e6514"></a>
     <p class="title"><b>Figure&nbsp;8.1.&nbsp;</b></p>
     <div class="figure-contents"> 
      <div class="mediaobject">
       <img src="./Spring Framework Reference Documentation_files/aop-proxy-plain-pojo-call.png" alt="aop proxy plain pojo call" />
      </div> 
     </div>
    </div>
    <br class="figure-break" /> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Main {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {

        Pojo pojo = <span class="hl-keyword">new</span> SimplePojo();

        <span class="hl-comment">// this is a direct method call on the </span><span class="emphasis"><em>pojo</em></span> reference
        pojo.foo();
    }
}</pre> 
    <p>Things change slightly when the reference that client code has is a proxy. Consider the following diagram and code snippet.</p> 
    <div class="figure">
     <a name="d4e6523"></a>
     <p class="title"><b>Figure&nbsp;8.2.&nbsp;</b></p>
     <div class="figure-contents"> 
      <div class="mediaobject">
       <img src="./Spring Framework Reference Documentation_files/aop-proxy-call.png" alt="aop proxy call" />
      </div> 
     </div>
    </div>
    <br class="figure-break" /> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Main {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {

        ProxyFactory factory = <span class="hl-keyword">new</span> ProxyFactory(<span class="hl-keyword">new</span> SimplePojo());
        factory.addInterface(Pojo.<span class="hl-keyword">class</span>);
        factory.addAdvice(<span class="hl-keyword">new</span> RetryAdvice());

        Pojo pojo = (Pojo) factory.getProxy();

        <span class="hl-comment">// this is a method call on the proxy!</span>
        pojo.foo();
    }
}</pre> 
    <p>The key thing to understand here is that the client code inside the <code class="literal">main(..)</code> of the <code class="literal">Main</code> class <span class="emphasis"><em>has a reference to the proxy</em></span>. This means that method calls on that object reference will be calls on the proxy, and as such the proxy will be able to delegate to all of the interceptors (advice) that are relevant to that particular method call. However, once the call has finally reached the target object, the <code class="literal">SimplePojo</code> reference in this case, any method calls that it may make on itself, such as <code class="literal">this.bar()</code> or <code class="literal">this.foo()</code>, are going to be invoked against the <span class="emphasis"><em>this</em></span> reference, and <span class="emphasis"><em>not</em></span> the proxy. This has important implications. It means that self-invocation is <span class="emphasis"><em>not</em></span> going to result in the advice associated with a method invocation getting a chance to execute.</p> 
    <p>Okay, so what is to be done about this? The best approach (the term best is used loosely here) is to refactor your code such that the self-invocation does not happen. For sure, this does entail some work on your part, but it is the best, least-invasive approach. The next approach is absolutely horrendous, and I am almost reticent to point it out precisely because it is so horrendous. You can (choke!) totally tie the logic within your class to Spring AOP by doing this:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimplePojo <span class="hl-keyword">implements</span> Pojo {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> foo() {
        <span class="hl-comment">// this works, but... gah!</span>
        ((Pojo) AopContext.currentProxy()).bar();
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> bar() {
        <span class="hl-comment">// some logic...</span>
    }
}</pre> 
    <p>This totally couples your code to Spring AOP, <span class="emphasis"><em>and</em></span> it makes the class itself aware of the fact that it is being used in an AOP context, which flies in the face of AOP. It also requires some additional configuration when the proxy is being created:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Main {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {

        ProxyFactory factory = <span class="hl-keyword">new</span> ProxyFactory(<span class="hl-keyword">new</span> SimplePojo());
        factory.adddInterface(Pojo.<span class="hl-keyword">class</span>);
        factory.addAdvice(<span class="hl-keyword">new</span> RetryAdvice());
        factory.setExposeProxy(true);

        Pojo pojo = (Pojo) factory.getProxy();

        <span class="hl-comment">// this is a method call on the proxy!</span>
        pojo.foo();
    }
}</pre> 
    <p>Finally, it must be noted that AspectJ does not have this self-invocation issue because it is not a proxy-based AOP framework.</p> 
   </div> 
  </div> 
  <div class="section" title="8.7&nbsp;Programmatic creation of @AspectJ Proxies">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="aop-aspectj-programmatic"></a>8.7&nbsp;Programmatic creation of @AspectJ Proxies</h2>
     </div>
    </div>
   </div> 
   <p>In addition to declaring aspects in your configuration using either <code class="literal">&lt;aop:config&gt;</code> or <code class="literal">&lt;aop:aspectj-autoproxy&gt;</code>, it is also possible programmatically to create proxies that advise target objects. For the full details of Springs AOP API, see the next chapter. Here we want to focus on the ability to automatically create proxies using @AspectJ aspects.</p> 
   <p>The class <code class="literal">org.springframework.aop.aspectj.annotation.AspectJProxyFactory</code> can be used to create a proxy for a target object that is advised by one or more @AspectJ aspects. Basic usage for this class is very simple, as illustrated below. See the Javadocs for full information.</p> 
   <pre class="programlisting"><span class="hl-comment">// create a factory that can generate a proxy for the given target object</span>
AspectJProxyFactory factory = <span class="hl-keyword">new</span> AspectJProxyFactory(targetObject);

<span class="hl-comment">// add an aspect, the class must be an @AspectJ aspect</span>
<span class="hl-comment">// you can call this as many times as you need with different aspects</span>
factory.addAspect(SecurityManager.<span class="hl-keyword">class</span>);

<span class="hl-comment">// you can also add existing aspect instances, the type of the object supplied must be an @AspectJ aspect</span>
factory.addAspect(usageTracker);

<span class="hl-comment">// now get the proxy object...</span>
MyInterfaceType proxy = factory.getProxy();</pre> 
  </div> 
  <div class="section" title="8.8&nbsp;Using AspectJ with Spring applications">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="aop-using-aspectj"></a>8.8&nbsp;Using AspectJ with Spring applications</h2>
     </div>
    </div>
   </div> 
   <p>Everything weve covered so far in this chapter is pure Spring AOP. In this section, were going to look at how you can use the AspectJ compiler/weaver instead of, or in addition to, Spring AOP if your needs go beyond the facilities offered by Spring AOP alone.</p> 
   <p>Spring ships with a small AspectJ aspect library, which is available standalone in your distribution as <code class="literal">spring-aspects.jar</code>; youll need to add this to your classpath in order to use the aspects in it. <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-atconfigurable" title="8.8.1&nbsp;Using AspectJ to dependency inject domain objects with Spring">Section&nbsp;8.8.1, Using AspectJ to dependency inject domain objects with Spring</a> and <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-ajlib-other" title="8.8.2&nbsp;Other Spring aspects for AspectJ">Section&nbsp;8.8.2, Other Spring aspects for AspectJ</a> discuss the content of this library and how you can use it. <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-aj-configure" title="8.8.3&nbsp;Configuring AspectJ aspects using Spring IoC">Section&nbsp;8.8.3, Configuring AspectJ aspects using Spring IoC</a> discusses how to dependency inject AspectJ aspects that are woven using the AspectJ compiler. Finally, <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-aj-ltw" title="8.8.4&nbsp;Load-time weaving with AspectJ in the Spring Framework">Section&nbsp;8.8.4, Load-time weaving with AspectJ in the Spring Framework</a> provides an introduction to load-time weaving for Spring applications using AspectJ.</p> 
   <div class="section" title="8.8.1&nbsp;Using AspectJ to dependency inject domain objects with Spring">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-atconfigurable"></a>8.8.1&nbsp;Using AspectJ to dependency inject domain objects with Spring</h3>
      </div>
     </div>
    </div> 
    <p>The Spring container instantiates and configures beans defined in your application context. It is also possible to ask a bean factory to configure a <span class="emphasis"><em>pre-existing</em></span> object given the name of a bean definition containing the configuration to be applied. The <code class="literal">spring-aspects.jar</code> contains an annotation-driven aspect that exploits this capability to allow dependency injection of <span class="emphasis"><em>any object</em></span>. The support is intended to be used for objects created <span class="emphasis"><em>outside of the control of any container</em></span>. Domain objects often fall into this category because they are often created programmatically using the <code class="literal">new</code> operator, or by an ORM tool as a result of a database query.</p> 
    <p>The <code class="literal">@Configurable</code> annotation marks a class as eligible for Spring-driven configuration. In the simplest case it can be used just as a marker annotation:</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> com.xyz.myapp.domain;

<span class="hl-keyword">import</span> org.springframework.beans.factory.annotation.Configurable;

<i><span class="hl-annotation" style="color: gray">@Configurable</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Account {
    <span class="hl-comment">// ...</span>
}</pre> 
    <p>When used as a marker interface in this way, Spring will configure new instances of the annotated type ( <code class="literal">Account</code> in this case) using a bean definition (typically prototype-scoped) with the same name as the fully-qualified type name ( <code class="literal">com.xyz.myapp.domain.Account</code>). Since the default name for a bean is the fully-qualified name of its type, a convenient way to declare the prototype definition is simply to omit the <code class="literal">id</code> attribute:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.xyz.myapp.domain.Account&quot;</span> <span class="hl-attribute">scope</span>=<span class="hl-value">&quot;prototype&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;fundsTransferService&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;fundsTransferService&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>If you want to explicitly specify the name of the prototype bean definition to use, you can do so directly in the annotation:</p> 
    <pre class="programlisting"><span class="hl-keyword">package</span> com.xyz.myapp.domain;

<span class="hl-keyword">import</span> org.springframework.beans.factory.annotation.Configurable;

<i><span class="hl-annotation" style="color: gray">@Configurable(&quot;account&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> Account {
    <span class="hl-comment">// ...</span>
}</pre> 
    <p>Spring will now look for a bean definition named &quot; <code class="literal">account</code>&quot; and use that as the definition to configure new <code class="literal">Account</code> instances.</p> 
    <p>You can also use autowiring to avoid having to specify a dedicated bean definition at all. To have Spring apply autowiring use the ' <code class="literal">autowire</code>' property of the <code class="literal">@Configurable</code> annotation: specify either <code class="literal">@Configurable(autowire=Autowire.BY_TYPE)</code> or <code class="literal">@Configurable(autowire=Autowire.BY_NAME</code> for autowiring by type or by name respectively. As an alternative, as of Spring 2.5 it is preferable to specify explicit, annotation-driven dependency injection for your <code class="literal">@Configurable</code> beans by using <code class="literal">@Autowired</code> or <code class="literal">@Inject</code> at the field or method level (see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-annotation-config" title="4.9&nbsp;Annotation-based container configuration">Section&nbsp;4.9, Annotation-based container configuration</a> for further details).</p> 
    <p>Finally you can enable Spring dependency checking for the object references in the newly created and configured object by using the <code class="literal">dependencyCheck</code> attribute (for example: <code class="literal">@Configurable(autowire=Autowire.BY_NAME,dependencyCheck=true)</code>). If this attribute is set to true, then Spring will validate after configuration that all properties (<span class="emphasis"><em>which are not primitives or collections</em></span>) have been set.</p> 
    <p>Using the annotation on its own does nothing of course. It is the <code class="literal">AnnotationBeanConfigurerAspect</code> in <code class="literal">spring-aspects.jar</code> that acts on the presence of the annotation. In essence the aspect says &quot;after returning from the initialization of a new object of a type annotated with <code class="literal">@Configurable</code>, configure the newly created object using Spring in accordance with the properties of the annotation&quot;. In this context, <span class="emphasis"><em>initialization</em></span> refers to newly instantiated objects (e.g., objects instantiated with the ' <code class="literal">new</code>' operator) as well as to <code class="literal">Serializable</code> objects that are undergoing deserialization (e.g., via <a class="ulink" href="http://docs.oracle.com/javase/6/docs/api/java/io/Serializable.html" target="_top">readResolve()</a>).</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>One of the key phrases in the above paragraph is <span class="emphasis"><em><span class="emphasis"><em>in essence</em></span></em></span>. For most cases, the exact semantics of <span class="emphasis"><em><span class="emphasis"><em>after returning from the initialization of a new object</em></span></em></span> will be fine in this context, <span class="emphasis"><em><span class="emphasis"><em>after initialization</em></span></em></span> means that the dependencies will be injected <span class="emphasis"><em>after</em></span> the object has been constructed - this means that the dependencies will not be available for use in the constructor bodies of the class. If you want the dependencies to be injected <span class="emphasis"><em>before</em></span> the constructor bodies execute, and thus be available for use in the body of the constructors, then you need to define this on the <code class="literal">@Configurable</code> declaration like so:</p> <pre class="programlisting">@Configurable(preConstruction=true)</pre> <p>You can find out more information about the language semantics of the various pointcut types in AspectJ <a class="ulink" href="http://www.eclipse.org/aspectj/doc/next/progguide/semantics-joinPoints.html" target="_top">in this appendix</a> of the <a class="ulink" href="http://www.eclipse.org/aspectj/doc/next/progguide/index.html" target="_top">AspectJ Programming Guide</a>.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>For this to work the annotated types must be woven with the AspectJ weaver - you can either use a build-time Ant or Maven task to do this (see for example the <a class="ulink" href="http://www.eclipse.org/aspectj/doc/released/devguide/antTasks.html" target="_top">AspectJ Development Environment Guide</a>) or load-time weaving (see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-aj-ltw" title="8.8.4&nbsp;Load-time weaving with AspectJ in the Spring Framework">Section&nbsp;8.8.4, Load-time weaving with AspectJ in the Spring Framework</a>). The <code class="literal">AnnotationBeanConfigurerAspect</code> itself needs configuring by Spring (in order to obtain a reference to the bean factory that is to be used to configure new objects). If you are using Java based configuration simply add <code class="literal">@EnableSpringConfigured</code> to any <code class="literal">@Configuration</code> class.</p> 
    <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableSpringConfigured</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

}</pre> 
    <p>If you prefer XML based configuration, the Spring <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#xsd-config-body-schemas-context" title="33.2.8&nbsp;the context schema"><code class="literal">context</code> namespace</a> defines a convenient <code class="literal">context:spring-configured</code> element:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;context:spring-configured/&gt;</span></pre> 
    <p>Instances of <code class="literal">@Configurable</code> objects created <span class="emphasis"><em>before</em></span> the aspect has been configured will result in a message being issued to the debug log and no configuration of the object taking place. An example might be a bean in the Spring configuration that creates domain objects when it is initialized by Spring. In this case you can use the &quot;depends-on&quot; bean attribute to manually specify that the bean depends on the configuration aspect.</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myService&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.xzy.myapp.service.MyService&quot;</span>
        <span class="hl-attribute">depends-on</span>=<span class="hl-value">&quot;org.springframework.beans.factory.aspectj.AnnotationBeanConfigurerAspect&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- ... --&gt;</span>

<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Do not activate <code class="literal">@Configurable</code> processing through the bean configurer aspect unless you really mean to rely on its semantics at runtime. In particular, make sure that you do not use <code class="literal">@Configurable</code> on bean classes which are registered as regular Spring beans with the container: You would get double initialization otherwise, once through the container and once through the aspect.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <div class="section" title="Unit testing @Configurable objects">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-configurable-testing"></a>Unit testing @Configurable objects</h4>
       </div>
      </div>
     </div> 
     <p>One of the goals of the <code class="literal">@Configurable</code> support is to enable independent unit testing of domain objects without the difficulties associated with hard-coded lookups. If <code class="literal">@Configurable</code> types have not been woven by AspectJ then the annotation has no affect during unit testing, and you can simply set mock or stub property references in the object under test and proceed as normal. If <code class="literal">@Configurable</code> types <span class="emphasis"><em>have</em></span> been woven by AspectJ then you can still unit test outside of the container as normal, but you will see a warning message each time that you construct an <code class="literal">@Configurable</code> object indicating that it has not been configured by Spring.</p> 
    </div> 
    <div class="section" title="Working with multiple application contexts">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-configurable-container"></a>Working with multiple application contexts</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">AnnotationBeanConfigurerAspect</code> used to implement the <code class="literal">@Configurable</code> support is an AspectJ singleton aspect. The scope of a singleton aspect is the same as the scope of <code class="literal">static</code> members, that is to say there is one aspect instance per classloader that defines the type. This means that if you define multiple application contexts within the same classloader hierarchy you need to consider where to define the <code class="literal">@EnableSpringConfigured</code> bean and where to place <code class="literal">spring-aspects.jar</code> on the classpath.</p> 
     <p>Consider a typical Spring web-app configuration with a shared parent application context defining common business services and everything needed to support them, and one child application context per servlet containing definitions particular to that servlet. All of these contexts will co-exist within the same classloader hierarchy, and so the <code class="literal">AnnotationBeanConfigurerAspect</code> can only hold a reference to one of them. In this case we recommend defining the <code class="literal">@EnableSpringConfigured</code> bean in the shared (parent) application context: this defines the services that you are likely to want to inject into domain objects. A consequence is that you cannot configure domain objects with references to beans defined in the child (servlet-specific) contexts using the @Configurable mechanism (probably not something you want to do anyway!).</p> 
     <p>When deploying multiple web-apps within the same container, ensure that each web-application loads the types in <code class="literal">spring-aspects.jar</code> using its own classloader (for example, by placing <code class="literal">spring-aspects.jar</code> in <code class="literal">'WEB-INF/lib'</code>). If <code class="literal">spring-aspects.jar</code> is only added to the container wide classpath (and hence loaded by the shared parent classloader), all web applications will share the same aspect instance which is probably not what you want.</p> 
    </div> 
   </div> 
   <div class="section" title="8.8.2&nbsp;Other Spring aspects for AspectJ">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-ajlib-other"></a>8.8.2&nbsp;Other Spring aspects for AspectJ</h3>
      </div>
     </div>
    </div> 
    <p>In addition to the <code class="literal">@Configurable</code> aspect, <code class="literal">spring-aspects.jar</code> contains an AspectJ aspect that can be used to drive Springs transaction management for types and methods annotated with the <code class="literal">@Transactional</code> annotation. This is primarily intended for users who want to use the Spring Frameworks transaction support outside of the Spring container.</p> 
    <p>The aspect that interprets <code class="literal">@Transactional</code> annotations is the <code class="literal">AnnotationTransactionAspect</code>. When using this aspect, you must annotate the <span class="emphasis"><em>implementation</em></span> class (and/or methods within that class), <span class="emphasis"><em>not</em></span> the interface (if any) that the class implements. AspectJ follows Javas rule that annotations on interfaces are <span class="emphasis"><em>not inherited</em></span>.</p> 
    <p>A <code class="literal">@Transactional</code> annotation on a class specifies the default transaction semantics for the execution of any <span class="emphasis"><em>public</em></span> operation in the class.</p> 
    <p>A <code class="literal">@Transactional</code> annotation on a method within the class overrides the default transaction semantics given by the class annotation (if present). Methods with <code class="literal">public</code>, <code class="literal">protected</code>, and default visibility may all be annotated. Annotating <code class="literal">protected</code> and default visibility methods directly is the only way to get transaction demarcation for the execution of such methods.</p> 
    <p>For AspectJ programmers that want to use the Spring configuration and transaction management support but dont want to (or cannot) use annotations, <code class="literal">spring-aspects.jar</code> also contains <code class="literal">abstract</code> aspects you can extend to provide your own pointcut definitions. See the sources for the <code class="literal">AbstractBeanConfigurerAspect</code> and <code class="literal">AbstractTransactionAspect</code> aspects for more information. As an example, the following excerpt shows how you could write an aspect to configure all instances of objects defined in the domain model using prototype bean definitions that match the fully-qualified class names:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> aspect DomainObjectConfiguration <span class="hl-keyword">extends</span> AbstractBeanConfigurerAspect {

    <span class="hl-keyword">public</span> DomainObjectConfiguration() {
        setBeanWiringInfoResolver(<span class="hl-keyword">new</span> ClassNameBeanWiringInfoResolver());
    }

    <span class="hl-comment">// the creation of a new bean (any object in the domain model)</span>
    <span class="hl-keyword">protected</span> pointcut beanCreation(Object beanInstance) :
        initialization(<span class="hl-keyword">new</span>(..)) &amp;&amp;
        SystemArchitecture.inDomainModel() &amp;&amp;
        <span class="hl-keyword">this</span>(beanInstance);

}</pre> 
   </div> 
   <div class="section" title="8.8.3&nbsp;Configuring AspectJ aspects using Spring IoC">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-aj-configure"></a>8.8.3&nbsp;Configuring AspectJ aspects using Spring IoC</h3>
      </div>
     </div>
    </div> 
    <p>When using AspectJ aspects with Spring applications, it is natural to both want and expect to be able to configure such aspects using Spring. The AspectJ runtime itself is responsible for aspect creation, and the means of configuring the AspectJ created aspects via Spring depends on the AspectJ instantiation model (the ' <code class="literal">per-xxx</code>' clause) used by the aspect.</p> 
    <p>The majority of AspectJ aspects are <span class="emphasis"><em>singleton</em></span> aspects. Configuration of these aspects is very easy: simply create a bean definition referencing the aspect type as normal, and include the bean attribute <code class="literal">'factory-method=&quot;aspectOf&quot;'</code>. This ensures that Spring obtains the aspect instance by asking AspectJ for it rather than trying to create an instance itself. For example:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;profiler&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.xyz.profiler.Profiler&quot;</span>
        <span class="strong"><strong>factory-method=&quot;aspectOf&quot;</strong></span>&gt;

    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;profilingStrategy&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;jamonProfilingStrategy&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>Non-singleton aspects are harder to configure: however it is possible to do so by creating prototype bean definitions and using the <code class="literal">@Configurable</code> support from <code class="literal">spring-aspects.jar</code> to configure the aspect instances once they have bean created by the AspectJ runtime.</p> 
    <p>If you have some @AspectJ aspects that you want to weave with AspectJ (for example, using load-time weaving for domain model types) and other @AspectJ aspects that you want to use with Spring AOP, and these aspects are all configured using Spring, then you will need to tell the Spring AOP @AspectJ autoproxying support which exact subset of the @AspectJ aspects defined in the configuration should be used for autoproxying. You can do this by using one or more <code class="literal">&lt;include/&gt;</code> elements inside the <code class="literal">&lt;aop:aspectj-autoproxy/&gt;</code> declaration. Each <code class="literal">&lt;include/&gt;</code> element specifies a name pattern, and only beans with names matched by at least one of the patterns will be used for Spring AOP autoproxy configuration:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;aop:aspectj-autoproxy&gt;</span>
    <span class="hl-tag">&lt;aop:include</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;thisBean&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;aop:include</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;thatBean&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/aop:aspectj-autoproxy&gt;</span></pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Do not be misled by the name of the <code class="literal">&lt;aop:aspectj-autoproxy/&gt;</code> element: using it will result in the creation of <span class="emphasis"><em>Spring AOP proxies</em></span>. The @AspectJ style of aspect declaration is just being used here, but the AspectJ runtime is <span class="emphasis"><em>not</em></span> involved.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="8.8.4&nbsp;Load-time weaving with AspectJ in the Spring Framework">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-aj-ltw"></a>8.8.4&nbsp;Load-time weaving with AspectJ in the Spring Framework</h3>
      </div>
     </div>
    </div> 
    <p>Load-time weaving (LTW) refers to the process of weaving AspectJ aspects into an applications class files as they are being loaded into the Java virtual machine (JVM). The focus of this section is on configuring and using LTW in the specific context of the Spring Framework: this section is not an introduction to LTW though. For full details on the specifics of LTW and configuring LTW with just AspectJ (with Spring not being involved at all), see the <a class="ulink" href="http://www.eclipse.org/aspectj/doc/released/devguide/ltw.html" target="_top">LTW section of the AspectJ Development Environment Guide</a>.</p> 
    <p>The value-add that the Spring Framework brings to AspectJ LTW is in enabling much finer-grained control over the weaving process. <span class="emphasis"><em>Vanilla</em></span> AspectJ LTW is effected using a Java (5+) agent, which is switched on by specifying a VM argument when starting up a JVM. It is thus a JVM-wide setting, which may be fine in some situations, but often is a little too coarse. Spring-enabled LTW enables you to switch on LTW on a <span class="emphasis"><em>per-ClassLoader</em></span> basis, which obviously is more fine-grained and which can make more sense in a <span class="emphasis"><em>single-JVM-multiple-application</em></span> environment (such as is found in a typical application server environment).</p> 
    <p>Further, <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-aj-ltw-environments" title="Environment-specific configuration">in certain environments</a>, this support enables load-time weaving <span class="emphasis"><em>without making any modifications to the application servers launch script</em></span> that will be needed to add <code class="literal">-javaagent:path/to/aspectjweaver.jar</code> or (as we describe later in this section) <code class="literal">-javaagent:path/to/org.springframework.instrument-{version}.jar</code> (previously named <code class="literal">spring-agent.jar</code>). Developers simply modify one or more files that form the application context to enable load-time weaving instead of relying on administrators who typically are in charge of the deployment configuration such as the launch script.</p> 
    <p>Now that the sales pitch is over, let us first walk through a quick example of AspectJ LTW using Spring, followed by detailed specifics about elements introduced in the following example. For a complete example, please see the <a class="ulink" href="https://github.com/spring-projects/spring-petclinic" target="_top">Petclinic sample application</a>.</p> 
    <div class="section" title="A first example">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-aj-ltw-first-example"></a>A first example</h4>
       </div>
      </div>
     </div> 
     <p>Let us assume that you are an application developer who has been tasked with diagnosing the cause of some performance problems in a system. Rather than break out a profiling tool, what we are going to do is switch on a simple profiling aspect that will enable us to very quickly get some performance metrics, so that we can then apply a finer-grained profiling tool to that specific area immediately afterwards.</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>The example presented here uses XML style configuration, it is also possible to configure and use @AspectJ with <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-java" title="4.12&nbsp;Java-based container configuration">Java Configuration</a>. Specifically the <code class="literal">@EnableLoadTimeWeaving</code> annotation can be used as an alternative to <code class="literal">&lt;context:load-time-weaver/&gt;</code> (see <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-aj-ltw-spring" title="Spring configuration">below</a> for details).</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <p>Here is the profiling aspect. Nothing too fancy, just a quick-and-dirty time-based profiler, using the @AspectJ-style of aspect declaration.</p> 
     <pre class="programlisting"><span class="hl-keyword">package</span> foo;

<span class="hl-keyword">import</span> org.aspectj.lang.ProceedingJoinPoint;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Aspect;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Around;
<span class="hl-keyword">import</span> org.aspectj.lang.annotation.Pointcut;
<span class="hl-keyword">import</span> org.springframework.util.StopWatch;
<span class="hl-keyword">import</span> org.springframework.core.annotation.Order;

<i><span class="hl-annotation" style="color: gray">@Aspect</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ProfilingAspect {

    <i><span class="hl-annotation" style="color: gray">@Around(&quot;methodsToBeProfiled()&quot;)</span></i>
    <span class="hl-keyword">public</span> Object profile(ProceedingJoinPoint pjp) <span class="hl-keyword">throws</span> Throwable {
        StopWatch sw = <span class="hl-keyword">new</span> StopWatch(getClass().getSimpleName());
        <span class="hl-keyword">try</span> {
            sw.start(pjp.getSignature().getName());
            <span class="hl-keyword">return</span> pjp.proceed();
        } <span class="hl-keyword">finally</span> {
            sw.stop();
            System.out.println(sw.prettyPrint());
        }
    }

    @Pointcut(<span class="hl-string">&quot;execution(public * foo..</span><span class="strong"><strong>.</strong></span>(..))<span class="hl-string">&quot;)
</span>    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> methodsToBeProfiled(){}
}</pre> 
     <p>We will also need to create an ' <code class="literal">META-INF/aop.xml</code>' file, to inform the AspectJ weaver that we want to weave our <code class="literal">ProfilingAspect</code> into our classes. This file convention, namely the presence of a file (or files) on the Java classpath called ' <code class="literal">META-INF/aop.xml</code>' is standard AspectJ.</p> 
     <pre class="programlisting"><b class="hl-tag" style="color: blue">&lt;!DOCTYPE aspectj PUBLIC &quot;-//AspectJ//DTD//EN&quot; &quot;http://www.eclipse.org/aspectj/dtd/aspectj.dtd&quot;&gt;</b>
<span class="hl-tag">&lt;aspectj&gt;</span>

    <span class="hl-tag">&lt;weaver&gt;</span>
        <span class="hl-comment">&lt;!-- only weave classes in our application-specific packages --&gt;</span>
        <span class="hl-tag">&lt;include</span> <span class="hl-attribute">within</span>=<span class="hl-value">&quot;foo.*&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/weaver&gt;</span>

    <span class="hl-tag">&lt;aspects&gt;</span>
        <span class="hl-comment">&lt;!-- weave in just this aspect --&gt;</span>
        <span class="hl-tag">&lt;aspect</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;foo.ProfilingAspect&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/aspects&gt;</span>

<span class="hl-tag">&lt;/aspectj&gt;</span></pre> 
     <p>Now to the Spring-specific portion of the configuration. We need to configure a <code class="literal">LoadTimeWeaver</code> (all explained later, just take it on trust for now). This load-time weaver is the essential component responsible for weaving the aspect configuration in one or more ' <code class="literal">META-INF/aop.xml</code>' files into the classes in your application. The good thing is that it does not require a lot of configuration, as can be seen below (there are some more options that you can specify, but these are detailed later).</p> 
     <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/context&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- a service object; we will be profiling its methods --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;entitlementCalculationService&quot;</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">&quot;foo.StubEntitlementCalculationService&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-comment">&lt;!-- this switches on the load-time weaving --&gt;</span>
    <span class="strong"><strong>&lt;context:load-time-weaver/&gt;</strong></span>
<span class="hl-tag">&lt;/beans&gt;</span></pre> 
     <p>Now that all the required artifacts are in place - the aspect, the ' <code class="literal">META-INF/aop.xml</code>' file, and the Spring configuration -, let us create a simple driver class with a <code class="literal">main(..)</code> method to demonstrate the LTW in action.</p> 
     <pre class="programlisting"><span class="hl-keyword">package</span> foo;

<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> Main {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {

        ApplicationContext ctx = <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">&quot;beans.xml&quot;</span>, Main.<span class="hl-keyword">class</span>);

        EntitlementCalculationService entitlementCalculationService
            = (EntitlementCalculationService) ctx.getBean(<span class="hl-string">&quot;entitlementCalculationService&quot;</span>);

        <span class="hl-comment">// the profiling aspect is </span><span class="emphasis"><em>woven</em></span> around <span class="hl-keyword">this</span> method execution
        entitlementCalculationService.calculateEntitlement();
    }
}</pre> 
     <p>There is one last thing to do. The introduction to this section did say that one could switch on LTW selectively on a per- <code class="literal">ClassLoader</code> basis with Spring, and this is true. However, just for this example, we are going to use a Java agent (supplied with Spring) to switch on the LTW. This is the command line we will use to run the above <code class="literal">Main</code> class:</p> 
     <pre class="literallayout">java -javaagent:C:/projects/foo/lib/global/spring-instrument.jar foo.Main</pre> 
     <p>The ' <code class="literal">-javaagent</code>' is a flag for specifying and enabling <a class="ulink" href="http://docs.oracle.com/javase/6/docs/api/java/lang/instrument/package-summary.html" target="_top">agents to instrument programs running on the JVM</a>. The Spring Framework ships with such an agent, the <code class="literal">InstrumentationSavingAgent</code>, which is packaged in the <code class="literal">spring-instrument.jar</code> that was supplied as the value of the <code class="literal">-javaagent</code> argument in the above example.</p> 
     <p>The output from the execution of the <code class="literal">Main</code> program will look something like that below. (I have introduced a <code class="literal">Thread.sleep(..)</code> statement into the <code class="literal">calculateEntitlement()</code> implementation so that the profiler actually captures something other than 0 milliseconds - the <code class="literal">01234</code> milliseconds is <span class="emphasis"><em>not</em></span> an overhead introduced by the AOP :) )</p> 
     <pre class="literallayout">Calculating entitlement

StopWatch <span class="emphasis"><em>ProfilingAspect</em></span>: running time (millis) = 1234
------ ----- ----------------------------
ms     %     Task name
------ ----- ----------------------------
01234  100%  calculateEntitlement</pre> 
     <p>Since this LTW is effected using full-blown AspectJ, we are not just limited to advising Spring beans; the following slight variation on the <code class="literal">Main</code> program will yield the same result.</p> 
     <pre class="programlisting"><span class="hl-keyword">package</span> foo;

<span class="hl-keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;

<span class="hl-keyword">public</span> <span class="hl-keyword">final</span> <span class="hl-keyword">class</span> Main {

    <span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">void</span> main(String[] args) {

        <span class="hl-keyword">new</span> ClassPathXmlApplicationContext(<span class="hl-string">&quot;beans.xml&quot;</span>, Main.<span class="hl-keyword">class</span>);

        EntitlementCalculationService entitlementCalculationService =
            <span class="hl-keyword">new</span> StubEntitlementCalculationService();

        <span class="hl-comment">// the profiling aspect will be </span><span class="emphasis"><em>woven</em></span> around <span class="hl-keyword">this</span> method execution
        entitlementCalculationService.calculateEntitlement();
    }
}</pre> 
     <p>Notice how in the above program we are simply bootstrapping the Spring container, and then creating a new instance of the <code class="literal">StubEntitlementCalculationService</code> totally outside the context of Spring the profiling advice still gets woven in.</p> 
     <p>The example admittedly is simplistic however the basics of the LTW support in Spring have all been introduced in the above example, and the rest of this section will explain the <span class="emphasis"><em>why</em></span> behind each bit of configuration and usage in detail.</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>The <code class="literal">ProfilingAspect</code> used in this example may be basic, but it is quite useful. It is a nice example of a development-time aspect that developers can use during development (of course), and then quite easily exclude from builds of the application being deployed into UAT or production.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="Aspects">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-aj-ltw-the-aspects"></a>Aspects</h4>
       </div>
      </div>
     </div> 
     <p>The aspects that you use in LTW have to be AspectJ aspects. They can be written in either the AspectJ language itself or you can write your aspects in the @AspectJ-style. It means that your aspects are then both valid AspectJ <span class="emphasis"><em>and</em></span> Spring AOP aspects. Furthermore, the compiled aspect classes need to be available on the classpath.</p> 
    </div> 
    <div class="section" title="' META-INF/aop.xml'">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-aj-ltw-aop_dot_xml"></a>' META-INF/aop.xml'</h4>
       </div>
      </div>
     </div> 
     <p>The AspectJ LTW infrastructure is configured using one or more ' <code class="literal">META-INF/aop.xml</code>' files, that are on the Java classpath (either directly, or more typically in jar files).</p> 
     <p>The structure and contents of this file is detailed in the main AspectJ reference documentation, and the interested reader is <a class="ulink" href="http://www.eclipse.org/aspectj/doc/released/devguide/ltw-configuration.html" target="_top">referred to that resource</a>. (I appreciate that this section is brief, but the ' <code class="literal">aop.xml</code>' file is 100% AspectJ - there is no Spring-specific information or semantics that apply to it, and so there is no extra value that I can contribute either as a result), so rather than rehash the quite satisfactory section that the AspectJ developers wrote, I am just directing you there.)</p> 
    </div> 
    <div class="section" title="Required libraries (JARS)">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-aj-ltw-libraries"></a>Required libraries (JARS)</h4>
       </div>
      </div>
     </div> 
     <p>At a minimum you will need the following libraries to use the Spring Frameworks support for AspectJ LTW:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> <code class="literal">spring-aop.jar</code> (version 2.5 or later, plus all mandatory dependencies) </li>
       <li class="listitem"> <code class="literal">aspectjweaver.jar</code> (version 1.6.8 or later) </li>
      </ul>
     </div> 
     <p>If you are using the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-aj-ltw-environment-generic" title="Generic Java applications">Spring-provided agent to enable instrumentation</a>, you will also need:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> <code class="literal">spring-instrument.jar</code> </li>
      </ul>
     </div> 
    </div> 
    <div class="section" title="Spring configuration">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-aj-ltw-spring"></a>Spring configuration</h4>
       </div>
      </div>
     </div> 
     <p>The key component in Springs LTW support is the <code class="literal">LoadTimeWeaver</code> interface (in the <code class="literal">org.springframework.instrument.classloading</code> package), and the numerous implementations of it that ship with the Spring distribution. A <code class="literal">LoadTimeWeaver</code> is responsible for adding one or more <code class="literal">java.lang.instrument.ClassFileTransformers</code> to a <code class="literal">ClassLoader</code> at runtime, which opens the door to all manner of interesting applications, one of which happens to be the LTW of aspects.</p> 
     <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Tip">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
         <th align="left">Tip</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>If you are unfamiliar with the idea of runtime class file transformation, you are encouraged to read the Javadoc API documentation for the <code class="literal">java.lang.instrument</code> package before continuing. This is not a huge chore because there is - rather annoyingly - precious little documentation there the key interfaces and classes will at least be laid out in front of you for reference as you read through this section.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <p>Configuring a <code class="literal">LoadTimeWeaver</code> for a particular <code class="literal">ApplicationContext</code> can be as easy as adding one line. (Please note that you almost certainly will need to be using an <code class="literal">ApplicationContext</code> as your Spring container - typically a <code class="literal">BeanFactory</code> will not be enough because the LTW support makes use of <code class="literal">BeanFactoryPostProcessors</code>.)</p> 
     <p>To enable the Spring Frameworks LTW support, you need to configure a <code class="literal">LoadTimeWeaver</code>, which typically is done using the <code class="literal">@EnableLoadTimeWeaving</code> annotation.</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableLoadTimeWeaving</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig {

}</pre> 
     <p>Alternatively, if you prefer XML based configuration, use the <code class="literal">&lt;context:load-time-weaver/&gt;</code> element. Note that the element is defined in the ' <code class="literal">context</code>' namespace.</p> 
     <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/context&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;context:load-time-weaver/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
     <p>The above configuration will define and register a number of LTW-specific infrastructure beans for you automatically, such as a <code class="literal">LoadTimeWeaver</code> and an <code class="literal">AspectJWeavingEnabler</code>. The default <code class="literal">LoadTimeWeaver</code> is the <code class="literal">DefaultContextLoadTimeWeaver</code> class, which attempts to decorate an automatically detected <code class="literal">LoadTimeWeaver</code>: the exact type of <code class="literal">LoadTimeWeaver</code> that will be <span class="emphasis"><em>automatically detected</em></span> is dependent upon your runtime environment (summarized in the following table).</p> 
     <div class="table">
      <a name="aop-aj-ltw-spring-env-impls"></a>
      <p class="title"><b>Table&nbsp;8.1.&nbsp;DefaultContextLoadTimeWeaver LoadTimeWeavers</b></p>
      <div class="table-contents"> 
       <table summary="DefaultContextLoadTimeWeaver LoadTimeWeavers" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
        <colgroup>
         <col />
         <col />
        </colgroup>
        <thead>
         <tr>
          <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Runtime Environment</th>
          <th style="border-bottom: 0.5pt solid ; " align="left" valign="top"><code class="literal">LoadTimeWeaver</code> implementation</th>
         </tr>
        </thead>
        <tbody>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Running in <a class="ulink" href="http://www.bea.com/framework.jsp?CNT=index.htm&amp;FP=/content/products/weblogic/server" target="_top">BEAs Weblogic 10</a></p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">WebLogicLoadTimeWeaver</code></p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Running in <a class="ulink" href="http://www-01.ibm.com/software/webservers/appserv/was/" target="_top">IBM WebSphere Application Server 7</a></p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">WebSphereLoadTimeWeaver</code></p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Running in <a class="ulink" href="http://glassfish.dev.java.net/" target="_top">GlassFish</a></p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">GlassFishLoadTimeWeaver</code></p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>Running in <a class="ulink" href="http://www.jboss.org/jbossas/" target="_top">JBoss AS</a></p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">JBossLoadTimeWeaver</code></p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p>JVM started with Spring <code class="literal">InstrumentationSavingAgent</code> <span class="emphasis"><em>(java -javaagent:path/to/spring-instrument.jar)</em></span></p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">InstrumentationLoadTimeWeaver</code></p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p>Fallback, expecting the underlying ClassLoader to follow common conventions (e.g. applicable to <code class="literal">TomcatInstrumentableClassLoader</code> and <a class="ulink" href="http://www.caucho.com/" target="_top">Resin</a>)</p></td>
          <td style="" align="left" valign="top"><p><code class="literal">ReflectiveLoadTimeWeaver</code></p></td>
         </tr>
        </tbody>
       </table> 
      </div>
     </div>
     <br class="table-break" /> 
     <p>Note that these are just the <code class="literal">LoadTimeWeavers</code> that are autodetected when using the <code class="literal">DefaultContextLoadTimeWeaver</code>: it is of course possible to specify exactly which <code class="literal">LoadTimeWeaver</code> implementation that you wish to use.</p> 
     <p>To specify a specific <code class="literal">LoadTimeWeaver</code> with Java configuration implement the <code class="literal">LoadTimeWeavingConfigurer</code> interface and override the <code class="literal">getLoadTimeWeaver()</code> method:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@EnableLoadTimeWeaving</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AppConfig <span class="hl-keyword">implements</span> LoadTimeWeavingConfigurer {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> LoadTimeWeaver getLoadTimeWeaver() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> ReflectiveLoadTimeWeaver();
    }
}</pre> 
     <p>If you are using XML based configuration you can specify the fully-qualified classname as the value of the ' <code class="literal">weaver-class</code>' attribute on the <code class="literal">&lt;context:load-time-weaver/&gt;</code> element:</p> 
     <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:context</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/context&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;
        http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/context
        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;context:load-time-weaver</span>
            <span class="hl-attribute">weaver-class</span>=<span class="hl-value">&quot;org.springframework.instrument.classloading.ReflectiveLoadTimeWeaver&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
     <p>The <code class="literal">LoadTimeWeaver</code> that is defined and registered by the configuration can be later retrieved from the Spring container using the well-known name ' <code class="literal">loadTimeWeaver</code>'. Remember that the <code class="literal">LoadTimeWeaver</code> exists just as a mechanism for Springs LTW infrastructure to add one or more <code class="literal">ClassFileTransformers</code>. The actual <code class="literal">ClassFileTransformer</code> that does the LTW is the <code class="literal">ClassPreProcessorAgentAdapter</code> (from the <code class="literal">org.aspectj.weaver.loadtime</code> package) class. See the class-level Javadoc for the <code class="literal">ClassPreProcessorAgentAdapter</code> class for further details, because the specifics of how the weaving is actually effected is beyond the scope of this section.</p> 
     <p>There is one final attribute of the configuration left to discuss: the ' <code class="literal">aspectjWeaving</code>' attribute (or ' <code class="literal">aspectj-weaving</code>' if you are using XML). This is a simple attribute that controls whether LTW is enabled or not, it is as simple as that. It accepts one of three possible values, summarized below, with the default value if the attribute is not present being ' <code class="literal">autodetect</code>'</p> 
     <div class="table">
      <a name="aop-aj-ltw-ltw-tag-attrs"></a>
      <p class="title"><b>Table&nbsp;8.2.&nbsp;AspectJ weaving attribute values</b></p>
      <div class="table-contents"> 
       <table summary="AspectJ weaving attribute values" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; ">
        <colgroup>
         <col />
         <col />
         <col />
        </colgroup>
        <thead>
         <tr>
          <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">Annotation Value</th>
          <th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top">XML Value</th>
          <th style="border-bottom: 0.5pt solid ; " align="left" valign="top">Explanation</th>
         </tr>
        </thead>
        <tbody>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">ENABLED</code></p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">on</code></p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>AspectJ weaving is on, and aspects will be woven at load-time as appropriate.</p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">DISABLED</code></p></td>
          <td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">off</code></p></td>
          <td style="border-bottom: 0.5pt solid ; " align="left" valign="top"><p>LTW is off no aspect will be woven at load-time.</p></td>
         </tr>
         <tr>
          <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">AUTODETECT</code></p></td>
          <td style="border-right: 0.5pt solid ; " align="left" valign="top"><p><code class="literal">autodetect</code></p></td>
          <td style="" align="left" valign="top"><p>If the Spring LTW infrastructure can find at least one ' <code class="literal">META-INF/aop.xml</code>' file, then AspectJ weaving is on, else it is off. This is the default value.</p></td>
         </tr>
        </tbody>
       </table> 
      </div>
     </div>
     <br class="table-break" /> 
    </div> 
    <div class="section" title="Environment-specific configuration">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-aj-ltw-environments"></a>Environment-specific configuration</h4>
       </div>
      </div>
     </div> 
     <p>This last section contains any additional settings and configuration that you will need when using Springs LTW support in environments such as application servers and web containers.</p> 
     <div class="section" title="Tomcat">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="aop-aj-ltw-environment-tomcat"></a>Tomcat</h5>
        </div>
       </div>
      </div> 
      <p><a class="ulink" href="http://tomcat.apache.org/" target="_top">Apache Tomcat</a>'s default class loader does not support class transformation which is why Spring provides an enhanced implementation that addresses this need. Named <code class="literal">TomcatInstrumentableClassLoader</code>, the loader works on Tomcat 5.0 and above and can be registered individually for <span class="emphasis"><em>each</em></span> web application as follows:</p> 
      <div class="itemizedlist">
       <ul class="itemizedlist" type="disc">
        <li class="listitem"> Tomcat 6.0.x or higher </li>
        <li class="listitem"> Copy <code class="literal">org.springframework.instrument.tomcat.jar</code> into <span class="emphasis"><em>$CATALINA_HOME</em></span>/lib, where <span class="emphasis"><em>$CATALINA_HOME</em></span> represents the root of the Tomcat installation) </li>
        <li class="listitem"> Instruct Tomcat to use the custom class loader (instead of the default) by editing the web application context file: </li>
       </ul>
      </div> 
      <pre class="programlisting"><span class="hl-tag">&lt;Context</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;/myWebApp&quot;</span> <span class="hl-attribute">docBase</span>=<span class="hl-value">&quot;/my/webApp/location&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;Loader</span>
        <span class="hl-attribute">loaderClass</span>=<span class="hl-value">&quot;org.springframework.instrument.classloading.tomcat.TomcatInstrumentableClassLoader&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/Context&gt;</span></pre> 
      <p>Apache Tomcat 6.0.x (similar to 5.0.x/5.5.x) series supports several context locations:</p> 
      <div class="itemizedlist">
       <ul class="itemizedlist" type="disc">
        <li class="listitem"> server configuration file - <span class="emphasis"><em>$CATALINA_HOME/conf/server.xml</em></span> </li>
        <li class="listitem"> default context configuration - <span class="emphasis"><em>$CATALINA_HOME/conf/context.xml</em></span> - that affects all deployed web applications </li>
        <li class="listitem"> per-web application configuration which can be deployed either on the server-side at <span class="emphasis"><em>$CATALINA_HOME/conf/[enginename]/[hostname]/[webapp]-context.xml</em></span> or embedded inside the web-app archive at <span class="emphasis"><em>META-INF/context.xml</em></span> </li>
       </ul>
      </div> 
      <p>For efficiency, the embedded per-web-app configuration style is recommended because it will impact only applications that use the custom class loader and does not require any changes to the server configuration. See the Tomcat 6.0.x <a class="ulink" href="http://tomcat.apache.org/tomcat-6.0-doc/config/context.html" target="_top">documentation</a> for more details about available context locations.</p> 
      <div class="itemizedlist">
       <ul class="itemizedlist" type="disc">
        <li class="listitem"> Tomcat 5.0.x/5.5.x </li>
        <li class="listitem"> Copy <code class="literal">org.springframework.instrument.tomcat.jar</code> into <span class="emphasis"><em>$CATALINA_HOME</em></span>/server/lib, where <span class="emphasis"><em>$CATALINA_HOME</em></span> represents the root of the Tomcat installation. </li>
        <li class="listitem"> Instruct Tomcat to use the custom class loader instead of the default one by editing the web application context file: </li>
       </ul>
      </div> 
      <pre class="programlisting"><span class="hl-tag">&lt;Context</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;/myWebApp&quot;</span> <span class="hl-attribute">docBase</span>=<span class="hl-value">&quot;/my/webApp/location&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;Loader</span>
        <span class="hl-attribute">loaderClass</span>=<span class="hl-value">&quot;org.springframework.instrument.classloading.tomcat.TomcatInstrumentableClassLoader&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/Context&gt;</span></pre> 
      <p>Tomcat 5.0.x and 5.5.x series supports several context locations:</p> 
      <div class="itemizedlist">
       <ul class="itemizedlist" type="disc">
        <li class="listitem"> server configuration file - <span class="emphasis"><em>$CATALINA_HOME/conf/server.xml</em></span> </li>
        <li class="listitem"> default context configuration - <span class="emphasis"><em>$CATALINA_HOME/conf/context.xml</em></span> - that affects all deployed web applications </li>
        <li class="listitem"> per-web application configuration which can be deployed either on the server-side at <span class="emphasis"><em>$CATALINA_HOME/conf/[enginename]/[hostname]/[webapp]-context.xml</em></span> or embedded inside the web-app archive at <span class="emphasis"><em>META-INF/context.xml</em></span> </li>
       </ul>
      </div> 
      <p>For efficiency, the embedded web-app configuration style is recommended recommended because it will impact only applications that use the class loader. See the Tomcat 5.x <a class="ulink" href="http://tomcat.apache.org/tomcat-5.5-doc/config/context.html" target="_top">documentation</a> for more details about available context locations.</p> 
      <p>Tomcat versions prior to 5.5.20 contained a bug in the XML configuration parsing that prevented usage of the <code class="literal">Loader</code> tag inside <span class="emphasis"><em>server.xml</em></span> configuration, regardless of whether a class loader is specified or whether it is the official or a custom one. See Tomcats bugzilla for <a class="ulink" href="http://issues.apache.org/bugzilla/show_bug.cgi?id=39704" target="_top">more details</a>.</p> 
      <p>In Tomcat 5.5.x, versions 5.5.20 or later, you should set <span class="emphasis"><em>useSystemClassLoaderAsParent</em></span> to <code class="literal">false</code> to fix this problem:</p> 
      <pre class="programlisting"><span class="hl-tag">&lt;Context</span> <span class="hl-attribute">path</span>=<span class="hl-value">&quot;/myWebApp&quot;</span> <span class="hl-attribute">docBase</span>=<span class="hl-value">&quot;/my/webApp/location&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;Loader</span>
        <span class="hl-attribute">loaderClass</span>=<span class="hl-value">&quot;org.springframework.instrument.classloading.tomcat.TomcatInstrumentableClassLoader&quot;</span>
                <span class="strong"><strong>useSystemClassLoaderAsParent=&quot;false&quot;</strong></span>/&gt;
<span class="hl-tag">&lt;/Context&gt;</span></pre> 
      <p>This setting is not needed on Tomcat 6 or higher.</p> 
      <p>Alternatively, consider the use of the Spring-provided generic VM agent, to be specified in Tomcats launch script (see above). This will make instrumentation available to all deployed web applications, no matter what ClassLoader they happen to run on.</p> 
     </div> 
     <div class="section" title="WebLogic, WebSphere, Resin, GlassFish, JBoss">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="aop-aj-ltw-environments-weblogic-oc4j-resin-glassfish-jboss"></a>WebLogic, WebSphere, Resin, GlassFish, JBoss</h5>
        </div>
       </div>
      </div> 
      <p>Recent versions of WebLogic Server (version 10 and above), IBM WebSphere Application Server (version 7 and above), Resin (3.1 and above) and JBoss (5.x or above) provide a ClassLoader that is capable of local instrumentation. Springs native LTW leverages such ClassLoaders to enable AspectJ weaving. You can enable LTW by simply activating load-time weaving as described earlier. Specifically, you do <span class="emphasis"><em>not</em></span> need to modify the launch script to add <code class="literal">-javaagent:path/to/spring-instrument.jar</code>.</p> 
      <p>Note that GlassFish instrumentation-capable ClassLoader is available only in its EAR environment. For GlassFish web applications, follow the Tomcat setup instructions as outlined above.</p> 
      <p>Note that on JBoss 6.x, the app server scanning needs to be disabled to prevent it from loading the classes before the application actually starts. A quick workaround is to add to your artifact a file named <code class="literal">WEB-INF/jboss-scanning.xml</code> with the following content:</p> 
      <pre class="programlisting"><span class="hl-tag">&lt;scanning</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;urn:jboss:scanning:1.0&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     </div> 
     <div class="section" title="Generic Java applications">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="aop-aj-ltw-environment-generic"></a>Generic Java applications</h5>
        </div>
       </div>
      </div> 
      <p>When class instrumentation is required in environments that do not support or are not supported by the existing <code class="literal">LoadTimeWeaver</code> implementations, a JDK agent can be the only solution. For such cases, Spring provides <code class="literal">InstrumentationLoadTimeWeaver</code>, which requires a Spring-specific (but very general) VM agent, <code class="literal">org.springframework.instrument-{version}.jar</code> (previously named <code class="literal">spring-agent.jar</code>).</p> 
      <p>To use it, you must start the virtual machine with the Spring agent, by supplying the following JVM options:</p> 
      <pre class="literallayout">-javaagent:/path/to/org.springframework.instrument-{version}.jar</pre> 
      <p>Note that this requires modification of the VM launch script which may prevent you from using this in application server environments (depending on your operation policies). Additionally, the JDK agent will instrument the <span class="emphasis"><em>entire</em></span> VM which can prove expensive.</p> 
      <p>For performance reasons, it is recommended to use this configuration only if your target environment (such as <a class="ulink" href="http://www.eclipse.org/jetty/" target="_top">Jetty</a>) does not have (or does not support) a dedicated LTW.</p> 
     </div> 
    </div> 
   </div> 
  </div> 
  <div class="section" title="8.9&nbsp;Further Resources">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="aop-resources"></a>8.9&nbsp;Further Resources</h2>
     </div>
    </div>
   </div> 
   <p>More information on AspectJ can be found on the <a class="ulink" href="http://www.eclipse.org/aspectj" target="_top">AspectJ website</a>.</p> 
   <p>The book <span class="emphasis"><em>Eclipse AspectJ</em></span> by Adrian Colyer et. al. (Addison-Wesley, 2005) provides a comprehensive introduction and reference for the AspectJ language.</p> 
   <p>The book <span class="emphasis"><em>AspectJ in Action</em></span> by Ramnivas Laddad (Manning, 2003) comes highly recommended; the focus of the book is on AspectJ, but a lot of general AOP themes are explored (in some depth).</p> 
  </div> 
 </div> 
 <div class="chapter" title="9.&nbsp;Spring AOP APIs">
  <div class="titlepage">
   <div>
    <div>
     <h2 class="title"><a name="aop-api"></a>9.&nbsp;Spring AOP APIs</h2>
    </div>
   </div>
  </div> 
  <div class="section" title="9.1&nbsp;Introduction">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="aop-api-introduction"></a>9.1&nbsp;Introduction</h2>
     </div>
    </div>
   </div> 
   <p>The previous chapter described the Springs support for AOP using @AspectJ and schema-based aspect definitions. In this chapter we discuss the lower-level Spring AOP APIs and the AOP support used in Spring 1.2 applications. For new applications, we recommend the use of the Spring 2.0 and later AOP support described in the previous chapter, but when working with existing applications, or when reading books and articles, you may come across Spring 1.2 style examples. Spring 4.0 is backwards compatible with Spring 1.2 and everything described in this chapter is fully supported in Spring 4.0.</p> 
  </div> 
  <div class="section" title="9.2&nbsp;Pointcut API in Spring">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="aop-api-pointcuts"></a>9.2&nbsp;Pointcut API in Spring</h2>
     </div>
    </div>
   </div> 
   <p>Lets look at how Spring handles the crucial pointcut concept.</p> 
   <div class="section" title="9.2.1&nbsp;Concepts">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-api-concepts"></a>9.2.1&nbsp;Concepts</h3>
      </div>
     </div>
    </div> 
    <p>Springs pointcut model enables pointcut reuse independent of advice types. Its possible to target different advice using the same pointcut.</p> 
    <p>The <code class="literal">org.springframework.aop.Pointcut</code> interface is the central interface, used to target advices to particular classes and methods. The complete interface is shown below:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Pointcut {

    ClassFilter getClassFilter();

    MethodMatcher getMethodMatcher();

}</pre> 
    <p>Splitting the <code class="literal">Pointcut</code> interface into two parts allows reuse of class and method matching parts, and fine-grained composition operations (such as performing a &quot;union&quot; with another method matcher).</p> 
    <p>The <code class="literal">ClassFilter</code> interface is used to restrict the pointcut to a given set of target classes. If the <code class="literal">matches()</code> method always returns true, all target classes will be matched:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> ClassFilter {

    <span class="hl-keyword">boolean</span> matches(Class clazz);
}</pre> 
    <p>The <code class="literal">MethodMatcher</code> interface is normally more important. The complete interface is shown below:</p> 
    <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> MethodMatcher {

    <span class="hl-keyword">boolean</span> matches(Method m, Class targetClass);

    <span class="hl-keyword">boolean</span> isRuntime();

    <span class="hl-keyword">boolean</span> matches(Method m, Class targetClass, Object[] args);
}</pre> 
    <p>The <code class="literal">matches(Method, Class)</code> method is used to test whether this pointcut will ever match a given method on a target class. This evaluation can be performed when an AOP proxy is created, to avoid the need for a test on every method invocation. If the 2-argument matches method returns true for a given method, and the <code class="literal">isRuntime()</code> method for the MethodMatcher returns true, the 3-argument matches method will be invoked on every method invocation. This enables a pointcut to look at the arguments passed to the method invocation immediately before the target advice is to execute.</p> 
    <p>Most MethodMatchers are static, meaning that their <code class="literal">isRuntime()</code> method returns false. In this case, the 3-argument matches method will never be invoked.</p> 
    <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Tip">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
        <th align="left">Tip</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>If possible, try to make pointcuts static, allowing the AOP framework to cache the results of pointcut evaluation when an AOP proxy is created.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
   <div class="section" title="9.2.2&nbsp;Operations on pointcuts">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-api-pointcut-ops"></a>9.2.2&nbsp;Operations on pointcuts</h3>
      </div>
     </div>
    </div> 
    <p>Spring supports operations on pointcuts: notably, <span class="emphasis"><em>union</em></span> and <span class="emphasis"><em>intersection</em></span>.</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> Union means the methods that either pointcut matches. </li>
      <li class="listitem"> Intersection means the methods that both pointcuts match. </li>
      <li class="listitem"> Union is usually more useful. </li>
      <li class="listitem"> Pointcuts can be composed using the static methods in the <span class="emphasis"><em>org.springframework.aop.support.Pointcuts</em></span> class, or using the <span class="emphasis"><em>ComposablePointcut</em></span> class in the same package. However, using AspectJ pointcut expressions is usually a simpler approach. </li>
     </ul>
    </div> 
   </div> 
   <div class="section" title="9.2.3&nbsp;AspectJ expression pointcuts">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-api-pointcuts-aspectj"></a>9.2.3&nbsp;AspectJ expression pointcuts</h3>
      </div>
     </div>
    </div> 
    <p>Since 2.0, the most important type of pointcut used by Spring is <code class="literal">org.springframework.aop.aspectj.AspectJExpressionPointcut</code>. This is a pointcut that uses an AspectJ supplied library to parse an AspectJ pointcut expression string.</p> 
    <p>See the previous chapter for a discussion of supported AspectJ pointcut primitives.</p> 
   </div> 
   <div class="section" title="9.2.4&nbsp;Convenience pointcut implementations">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-api-pointcuts-impls"></a>9.2.4&nbsp;Convenience pointcut implementations</h3>
      </div>
     </div>
    </div> 
    <p>Spring provides several convenient pointcut implementations. Some can be used out of the box; others are intended to be subclassed in application-specific pointcuts.</p> 
    <div class="section" title="Static pointcuts">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-api-pointcuts-static"></a>Static pointcuts</h4>
       </div>
      </div>
     </div> 
     <p>Static pointcuts are based on method and target class, and cannot take into account the methods arguments. Static pointcuts are sufficient - <span class="emphasis"><em>and best</em></span> - for most usages. Its possible for Spring to evaluate a static pointcut only once, when a method is first invoked: after that, there is no need to evaluate the pointcut again with each method invocation.</p> 
     <p>Lets consider some static pointcut implementations included with Spring.</p> 
     <div class="section" title="Regular expression pointcuts">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="aop-api-pointcuts-regex"></a>Regular expression pointcuts</h5>
        </div>
       </div>
      </div> 
      <p>One obvious way to specify static pointcuts is regular expressions. Several AOP frameworks besides Spring make this possible. <code class="literal">org.springframework.aop.support.JdkRegexpMethodPointcut</code> is a generic regular expression pointcut, using the regular expression support in JDK 1.4+.</p> 
      <p>Using the <code class="literal">JdkRegexpMethodPointcut</code> class, you can provide a list of pattern Strings. If any of these is a match, the pointcut will evaluate to true. (So the result is effectively the union of these pointcuts.)</p> 
      <p>The usage is shown below:</p> 
      <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;settersAndAbsquatulatePointcut&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.support.JdkRegexpMethodPointcut&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;patterns&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>.<span class="strong"><strong>set.</strong></span><span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>.*absquatulate<span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
      <p>Spring provides a convenience class, <code class="literal">RegexpMethodPointcutAdvisor</code>, that allows us to also reference an Advice (remember that an Advice can be an interceptor, before advice, throws advice etc.). Behind the scenes, Spring will use a <code class="literal">JdkRegexpMethodPointcut</code>. Using <code class="literal">RegexpMethodPointcutAdvisor</code> simplifies wiring, as the one bean encapsulates both pointcut and advice, as shown below:</p> 
      <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;settersAndAbsquatulateAdvisor&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.support.RegexpMethodPointcutAdvisor&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;advice&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">&quot;beanNameOfAopAllianceInterceptor&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;patterns&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>.<span class="strong"><strong>set.</strong></span><span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>.*absquatulate<span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
      <p><span class="emphasis"><em>RegexpMethodPointcutAdvisor</em></span> can be used with any Advice type.</p> 
     </div> 
     <div class="section" title="Attribute-driven pointcuts">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="aop-api-pointcuts-attribute-driven"></a>Attribute-driven pointcuts</h5>
        </div>
       </div>
      </div> 
      <p>An important type of static pointcut is a <span class="emphasis"><em>metadata-driven</em></span> pointcut. This uses the values of metadata attributes: typically, source-level metadata.</p> 
     </div> 
    </div> 
    <div class="section" title="Dynamic pointcuts">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-api-pointcuts-dynamic"></a>Dynamic pointcuts</h4>
       </div>
      </div>
     </div> 
     <p>Dynamic pointcuts are costlier to evaluate than static pointcuts. They take into account method <span class="emphasis"><em>arguments</em></span>, as well as static information. This means that they must be evaluated with every method invocation; the result cannot be cached, as arguments will vary.</p> 
     <p>The main example is the <code class="literal">control flow</code> pointcut.</p> 
     <div class="section" title="Control flow pointcuts">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="aop-api-pointcuts-cflow"></a>Control flow pointcuts</h5>
        </div>
       </div>
      </div> 
      <p>Spring control flow pointcuts are conceptually similar to AspectJ <span class="emphasis"><em>cflow</em></span> pointcuts, although less powerful. (There is currently no way to specify that a pointcut executes below a join point matched by another pointcut.) A control flow pointcut matches the current call stack. For example, it might fire if the join point was invoked by a method in the <code class="literal">com.mycompany.web</code> package, or by the <code class="literal">SomeCaller</code> class. Control flow pointcuts are specified using the <code class="literal">org.springframework.aop.support.ControlFlowPointcut</code> class.</p> 
      <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
       <table border="0" summary="Note">
        <tbody>
         <tr>
          <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
          <th align="left">Note</th>
         </tr>
         <tr>
          <td align="left" valign="top"> <p>Control flow pointcuts are significantly more expensive to evaluate at runtime than even other dynamic pointcuts. In Java 1.4, the cost is about 5 times that of other dynamic pointcuts.</p> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
    </div> 
   </div> 
   <div class="section" title="9.2.5&nbsp;Pointcut superclasses">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-api-pointcuts-superclasses"></a>9.2.5&nbsp;Pointcut superclasses</h3>
      </div>
     </div>
    </div> 
    <p>Spring provides useful pointcut superclasses to help you to implement your own pointcuts.</p> 
    <p>Because static pointcuts are most useful, youll probably subclass StaticMethodMatcherPointcut, as shown below. This requires implementing just one abstract method (although its possible to override other methods to customize behavior):</p> 
    <pre class="programlisting"><span class="hl-keyword">class</span> TestStaticPointcut <span class="hl-keyword">extends</span> StaticMethodMatcherPointcut {

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> matches(Method m, Class targetClass) {
        <span class="hl-comment">// return true if custom criteria match</span>
    }
}</pre> 
    <p>There are also superclasses for dynamic pointcuts.</p> 
    <p>You can use custom pointcuts with any advice type in Spring 1.0 RC2 and above.</p> 
   </div> 
   <div class="section" title="9.2.6&nbsp;Custom pointcuts">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-api-pointcuts-custom"></a>9.2.6&nbsp;Custom pointcuts</h3>
      </div>
     </div>
    </div> 
    <p>Because pointcuts in Spring AOP are Java classes, rather than language features (as in AspectJ) its possible to declare custom pointcuts, whether static or dynamic. Custom pointcuts in Spring can be arbitrarily complex. However, using the AspectJ pointcut expression language is recommended if possible.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Later versions of Spring may offer support for &quot;semantic pointcuts&quot; as offered by JAC: for example, &quot;all methods that change instance variables in the target object.&quot;</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
  </div> 
  <div class="section" title="9.3&nbsp;Advice API in Spring">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="aop-api-advice"></a>9.3&nbsp;Advice API in Spring</h2>
     </div>
    </div>
   </div> 
   <p>Lets now look at how Spring AOP handles advice.</p> 
   <div class="section" title="9.3.1&nbsp;Advice lifecycles">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-api-advice-lifecycle"></a>9.3.1&nbsp;Advice lifecycles</h3>
      </div>
     </div>
    </div> 
    <p>Each advice is a Spring bean. An advice instance can be shared across all advised objects, or unique to each advised object. This corresponds to <span class="emphasis"><em>per-class</em></span> or <span class="emphasis"><em>per-instance</em></span> advice.</p> 
    <p>Per-class advice is used most often. It is appropriate for generic advice such as transaction advisors. These do not depend on the state of the proxied object or add new state; they merely act on the method and arguments.</p> 
    <p>Per-instance advice is appropriate for introductions, to support mixins. In this case, the advice adds state to the proxied object.</p> 
    <p>Its possible to use a mix of shared and per-instance advice in the same AOP proxy.</p> 
   </div> 
   <div class="section" title="9.3.2&nbsp;Advice types in Spring">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-api-advice-types"></a>9.3.2&nbsp;Advice types in Spring</h3>
      </div>
     </div>
    </div> 
    <p>Spring provides several advice types out of the box, and is extensible to support arbitrary advice types. Let us look at the basic concepts and standard advice types.</p> 
    <div class="section" title="Interception around advice">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-api-advice-around"></a>Interception around advice</h4>
       </div>
      </div>
     </div> 
     <p>The most fundamental advice type in Spring is <span class="emphasis"><em>interception around advice</em></span>.</p> 
     <p>Spring is compliant with the AOP Alliance interface for around advice using method interception. MethodInterceptors implementing around advice should implement the following interface:</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> MethodInterceptor <span class="hl-keyword">extends</span> Interceptor {

    Object invoke(MethodInvocation invocation) <span class="hl-keyword">throws</span> Throwable;
}</pre> 
     <p>The <code class="literal">MethodInvocation</code> argument to the <code class="literal">invoke()</code> method exposes the method being invoked; the target join point; the AOP proxy; and the arguments to the method. The <code class="literal">invoke()</code> method should return the invocations result: the return value of the join point.</p> 
     <p>A simple <code class="literal">MethodInterceptor</code> implementation looks as follows:</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DebugInterceptor <span class="hl-keyword">implements</span> MethodInterceptor {

    <span class="hl-keyword">public</span> Object invoke(MethodInvocation invocation) <span class="hl-keyword">throws</span> Throwable {
        System.out.println(<span class="hl-string">&quot;Before: invocation=[&quot;</span> + invocation + <span class="hl-string">&quot;]&quot;</span>);
        Object rval = invocation.proceed();
        System.out.println(<span class="hl-string">&quot;Invocation returned&quot;</span>);
        <span class="hl-keyword">return</span> rval;
    }
}</pre> 
     <p>Note the call to the MethodInvocations <code class="literal">proceed()</code> method. This proceeds down the interceptor chain towards the join point. Most interceptors will invoke this method, and return its return value. However, a MethodInterceptor, like any around advice, can return a different value or throw an exception rather than invoke the proceed method. However, you dont want to do this without good reason!</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>MethodInterceptors offer interoperability with other AOP Alliance-compliant AOP implementations. The other advice types discussed in the remainder of this section implement common AOP concepts, but in a Spring-specific way. While there is an advantage in using the most specific advice type, stick with MethodInterceptor around advice if you are likely to want to run the aspect in another AOP framework. Note that pointcuts are not currently interoperable between frameworks, and the AOP Alliance does not currently define pointcut interfaces.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="Before advice">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-api-advice-before"></a>Before advice</h4>
       </div>
      </div>
     </div> 
     <p>A simpler advice type is a <span class="emphasis"><em>before advice</em></span>. This does not need a <code class="literal">MethodInvocation</code> object, since it will only be called before entering the method.</p> 
     <p>The main advantage of a before advice is that there is no need to invoke the <code class="literal">proceed()</code> method, and therefore no possibility of inadvertently failing to proceed down the interceptor chain.</p> 
     <p>The <code class="literal">MethodBeforeAdvice</code> interface is shown below. (Springs API design would allow for field before advice, although the usual objects apply to field interception and its unlikely that Spring will ever implement it).</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> MethodBeforeAdvice <span class="hl-keyword">extends</span> BeforeAdvice {

    <span class="hl-keyword">void</span> before(Method m, Object[] args, Object target) <span class="hl-keyword">throws</span> Throwable;
}</pre> 
     <p>Note the return type is <code class="literal">void</code>. Before advice can insert custom behavior before the join point executes, but cannot change the return value. If a before advice throws an exception, this will abort further execution of the interceptor chain. The exception will propagate back up the interceptor chain. If it is unchecked, or on the signature of the invoked method, it will be passed directly to the client; otherwise it will be wrapped in an unchecked exception by the AOP proxy.</p> 
     <p>An example of a before advice in Spring, which counts all method invocations:</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CountingBeforeAdvice <span class="hl-keyword">implements</span> MethodBeforeAdvice {

    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> count;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> before(Method m, Object[] args, Object target) <span class="hl-keyword">throws</span> Throwable {
        ++count;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getCount() {
        <span class="hl-keyword">return</span> count;
    }
}</pre> 
     <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Tip">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
         <th align="left">Tip</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>Before advice can be used with any pointcut.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="Throws advice">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-api-advice-throws"></a>Throws advice</h4>
       </div>
      </div>
     </div> 
     <p><span class="emphasis"><em>Throws advice</em></span> is invoked after the return of the join point if the join point threw an exception. Spring offers typed throws advice. Note that this means that the <code class="literal">org.springframework.aop.ThrowsAdvice</code> interface does not contain any methods: It is a tag interface identifying that the given object implements one or more typed throws advice methods. These should be in the form of:</p> 
     <pre class="programlisting">afterThrowing([Method, args, target], subclassOfThrowable)</pre> 
     <p>Only the last argument is required. The method signatures may have either one or four arguments, depending on whether the advice method is interested in the method and arguments. The following classes are examples of throws advice.</p> 
     <p>The advice below is invoked if a <code class="literal">RemoteException</code> is thrown (including subclasses):</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RemoteThrowsAdvice <span class="hl-keyword">implements</span> ThrowsAdvice {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterThrowing(RemoteException ex) <span class="hl-keyword">throws</span> Throwable {
        <span class="hl-comment">// Do something with remote exception</span>
    }
}</pre> 
     <p>The following advice is invoked if a <code class="literal">ServletException</code> is thrown. Unlike the above advice, it declares 4 arguments, so that it has access to the invoked method, method arguments and target object:</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ServletThrowsAdviceWithArguments <span class="hl-keyword">implements</span> ThrowsAdvice {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterThrowing(Method m, Object[] args, Object target, ServletException ex) {
        <span class="hl-comment">// Do something with all arguments</span>
    }
}</pre> 
     <p>The final example illustrates how these two methods could be used in a single class, which handles both <code class="literal">RemoteException</code> and <code class="literal">ServletException</code>. Any number of throws advice methods can be combined in a single class.</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">static</span> <span class="hl-keyword">class</span> CombinedThrowsAdvice <span class="hl-keyword">implements</span> ThrowsAdvice {

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterThrowing(RemoteException ex) <span class="hl-keyword">throws</span> Throwable {
        <span class="hl-comment">// Do something with remote exception</span>
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterThrowing(Method m, Object[] args, Object target, ServletException ex) {
        <span class="hl-comment">// Do something with all arguments</span>
    }
}</pre> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>If a throws-advice method throws an exception itself, it will override the original exception (i.e. change the exception thrown to the user). The overriding exception will typically be a RuntimeException; this is compatible with any method signature. However, if a throws-advice method throws a checked exception, it will have to match the declared exceptions of the target method and is hence to some degree coupled to specific target method signatures. <span class="emphasis"><em>Do not throw an undeclared checked exception that is incompatible with the target methods signature!</em></span></p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Tip">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
         <th align="left">Tip</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>Throws advice can be used with any pointcut.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="After Returning advice">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-api-advice-after-returning"></a>After Returning advice</h4>
       </div>
      </div>
     </div> 
     <p>An after returning advice in Spring must implement the <span class="emphasis"><em>org.springframework.aop.AfterReturningAdvice</em></span> interface, shown below:</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> AfterReturningAdvice <span class="hl-keyword">extends</span> Advice {

    <span class="hl-keyword">void</span> afterReturning(Object returnValue, Method m, Object[] args, Object target)
            <span class="hl-keyword">throws</span> Throwable;
}</pre> 
     <p>An after returning advice has access to the return value (which it cannot modify), invoked method, methods arguments and target.</p> 
     <p>The following after returning advice counts all successful method invocations that have not thrown exceptions:</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CountingAfterReturningAdvice <span class="hl-keyword">implements</span> AfterReturningAdvice {

    <span class="hl-keyword">private</span> <span class="hl-keyword">int</span> count;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterReturning(Object returnValue, Method m, Object[] args, Object target)
            <span class="hl-keyword">throws</span> Throwable {
        ++count;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">int</span> getCount() {
        <span class="hl-keyword">return</span> count;
    }
}</pre> 
     <p>This advice doesnt change the execution path. If it throws an exception, this will be thrown up the interceptor chain instead of the return value.</p> 
     <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Tip">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
         <th align="left">Tip</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>After returning advice can be used with any pointcut.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="Introduction advice">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-api-advice-introduction"></a>Introduction advice</h4>
       </div>
      </div>
     </div> 
     <p>Spring treats introduction advice as a special kind of interception advice.</p> 
     <p>Introduction requires an <code class="literal">IntroductionAdvisor</code>, and an <code class="literal">IntroductionInterceptor</code>, implementing the following interface:</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> IntroductionInterceptor <span class="hl-keyword">extends</span> MethodInterceptor {

    <span class="hl-keyword">boolean</span> implementsInterface(Class intf);
}</pre> 
     <p>The <code class="literal">invoke()</code> method inherited from the AOP Alliance <code class="literal">MethodInterceptor</code> interface must implement the introduction: that is, if the invoked method is on an introduced interface, the introduction interceptor is responsible for handling the method call - it cannot invoke <code class="literal">proceed()</code>.</p> 
     <p>Introduction advice cannot be used with any pointcut, as it applies only at class, rather than method, level. You can only use introduction advice with the <code class="literal">IntroductionAdvisor</code>, which has the following methods:</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> IntroductionAdvisor <span class="hl-keyword">extends</span> Advisor, IntroductionInfo {

    ClassFilter getClassFilter();

    <span class="hl-keyword">void</span> validateInterfaces() <span class="hl-keyword">throws</span> IllegalArgumentException;
}

<span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> IntroductionInfo {

    Class[] getInterfaces();
}</pre> 
     <p>There is no <code class="literal">MethodMatcher</code>, and hence no <code class="literal">Pointcut</code>, associated with introduction advice. Only class filtering is logical.</p> 
     <p>The <code class="literal">getInterfaces()</code> method returns the interfaces introduced by this advisor.</p> 
     <p>The <code class="literal">validateInterfaces()</code> method is used internally to see whether or not the introduced interfaces can be implemented by the configured <code class="literal">IntroductionInterceptor</code>.</p> 
     <p>Lets look at a simple example from the Spring test suite. Lets suppose we want to introduce the following interface to one or more objects:</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">interface</span> Lockable {
    <span class="hl-keyword">void</span> lock();
    <span class="hl-keyword">void</span> unlock();
    <span class="hl-keyword">boolean</span> locked();
}</pre> 
     <p>This illustrates a <span class="emphasis"><em>mixin</em></span>. We want to be able to cast advised objects to Lockable, whatever their type, and call lock and unlock methods. If we call the lock() method, we want all setter methods to throw a <code class="literal">LockedException</code>. Thus we can add an aspect that provides the ability to make objects immutable, without them having any knowledge of it: a good example of AOP.</p> 
     <p>Firstly, well need an <code class="literal">IntroductionInterceptor</code> that does the heavy lifting. In this case, we extend the <code class="literal">org.springframework.aop.support.DelegatingIntroductionInterceptor</code> convenience class. We could implement IntroductionInterceptor directly, but using <code class="literal">DelegatingIntroductionInterceptor</code> is best for most cases.</p> 
     <p>The <code class="literal">DelegatingIntroductionInterceptor</code> is designed to delegate an introduction to an actual implementation of the introduced interface(s), concealing the use of interception to do so. The delegate can be set to any object using a constructor argument; the default delegate (when the no-arg constructor is used) is this. Thus in the example below, the delegate is the <code class="literal">LockMixin</code> subclass of <code class="literal">DelegatingIntroductionInterceptor</code>. Given a delegate (by default itself), a <code class="literal">DelegatingIntroductionInterceptor</code> instance looks for all interfaces implemented by the delegate (other than IntroductionInterceptor), and will support introductions against any of them. Its possible for subclasses such as <code class="literal">LockMixin</code> to call the <code class="literal">suppressInterface(Class intf)</code> method to suppress interfaces that should not be exposed. However, no matter how many interfaces an <code class="literal">IntroductionInterceptor</code> is prepared to support, the <code class="literal">IntroductionAdvisor</code> used will control which interfaces are actually exposed. An introduced interface will conceal any implementation of the same interface by the target.</p> 
     <p>Thus LockMixin subclasses <code class="literal">DelegatingIntroductionInterceptor</code> and implements Lockable itself. The superclass automatically picks up that Lockable can be supported for introduction, so we dont need to specify that. We could introduce any number of interfaces in this way.</p> 
     <p>Note the use of the <code class="literal">locked</code> instance variable. This effectively adds additional state to that held in the target object.</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> LockMixin <span class="hl-keyword">extends</span> DelegatingIntroductionInterceptor <span class="hl-keyword">implements</span> Lockable {

    <span class="hl-keyword">private</span> <span class="hl-keyword">boolean</span> locked;

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> lock() {
        <span class="hl-keyword">this</span>.locked = true;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> unlock() {
        <span class="hl-keyword">this</span>.locked = false;
    }

    <span class="hl-keyword">public</span> <span class="hl-keyword">boolean</span> locked() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">this</span>.locked;
    }

    <span class="hl-keyword">public</span> Object invoke(MethodInvocation invocation) <span class="hl-keyword">throws</span> Throwable {
        <span class="hl-keyword">if</span> (locked() &amp;&amp; invocation.getMethod().getName().indexOf(<span class="hl-string">&quot;set&quot;</span>) == <span class="hl-number">0</span>) {
            <span class="hl-keyword">throw</span> <span class="hl-keyword">new</span> LockedException();
        }
        <span class="hl-keyword">return</span> <span class="hl-keyword">super</span>.invoke(invocation);
    }

}</pre> 
     <p>Often it isnt necessary to override the <code class="literal">invoke()</code> method: the <code class="literal">DelegatingIntroductionInterceptor</code> implementation - which calls the delegate method if the method is introduced, otherwise proceeds towards the join point - is usually sufficient. In the present case, we need to add a check: no setter method can be invoked if in locked mode.</p> 
     <p>The introduction advisor required is simple. All it needs to do is hold a distinct <code class="literal">LockMixin</code> instance, and specify the introduced interfaces - in this case, just <code class="literal">Lockable</code>. A more complex example might take a reference to the introduction interceptor (which would be defined as a prototype): in this case, theres no configuration relevant for a <code class="literal">LockMixin</code>, so we simply create it using <code class="literal">new</code>.</p> 
     <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> LockMixinAdvisor <span class="hl-keyword">extends</span> DefaultIntroductionAdvisor {

    <span class="hl-keyword">public</span> LockMixinAdvisor() {
        <span class="hl-keyword">super</span>(<span class="hl-keyword">new</span> LockMixin(), Lockable.<span class="hl-keyword">class</span>);
    }
}</pre> 
     <p>We can apply this advisor very simply: it requires no configuration. (However, it <span class="emphasis"><em>is</em></span> necessary: Its impossible to use an <code class="literal">IntroductionInterceptor</code> without an <span class="emphasis"><em>IntroductionAdvisor</em></span>.) As usual with introductions, the advisor must be per-instance, as it is stateful. We need a different instance of <code class="literal">LockMixinAdvisor</code>, and hence <code class="literal">LockMixin</code>, for each advised object. The advisor comprises part of the advised objects state.</p> 
     <p>We can apply this advisor programmatically, using the <code class="literal">Advised.addAdvisor()</code> method, or (the recommended way) in XML configuration, like any other advisor. All proxy creation choices discussed below, including &quot;auto proxy creators,&quot; correctly handle introductions and stateful mixins.</p> 
    </div> 
   </div> 
  </div> 
  <div class="section" title="9.4&nbsp;Advisor API in Spring">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="aop-api-advisor"></a>9.4&nbsp;Advisor API in Spring</h2>
     </div>
    </div>
   </div> 
   <p>In Spring, an Advisor is an aspect that contains just a single advice object associated with a pointcut expression.</p> 
   <p>Apart from the special case of introductions, any advisor can be used with any advice. <code class="literal">org.springframework.aop.support.DefaultPointcutAdvisor</code> is the most commonly used advisor class. For example, it can be used with a <code class="literal">MethodInterceptor</code>, <code class="literal">BeforeAdvice</code> or <code class="literal">ThrowsAdvice</code>.</p> 
   <p>It is possible to mix advisor and advice types in Spring in the same AOP proxy. For example, you could use a interception around advice, throws advice and before advice in one proxy configuration: Spring will automatically create the necessary interceptor chain.</p> 
  </div> 
  <div class="section" title="9.5&nbsp;Using the ProxyFactoryBean to create AOP proxies">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="aop-pfb"></a>9.5&nbsp;Using the ProxyFactoryBean to create AOP proxies</h2>
     </div>
    </div>
   </div> 
   <p>If youre using the Spring IoC container (an ApplicationContext or BeanFactory) for your business objects - and you should be! - you will want to use one of Springs AOP FactoryBeans. (Remember that a factory bean introduces a layer of indirection, enabling it to create objects of a different type.)</p> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>The Spring AOP support also uses factory beans under the covers.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <p>The basic way to create an AOP proxy in Spring is to use the <span class="emphasis"><em>org.springframework.aop.framework.ProxyFactoryBean</em></span>. This gives complete control over the pointcuts and advice that will apply, and their ordering. However, there are simpler options that are preferable if you dont need such control.</p> 
   <div class="section" title="9.5.1&nbsp;Basics">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-pfb-1"></a>9.5.1&nbsp;Basics</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">ProxyFactoryBean</code>, like other Spring <code class="literal">FactoryBean</code> implementations, introduces a level of indirection. If you define a <code class="literal">ProxyFactoryBean</code> with name <code class="literal">foo</code>, what objects referencing <code class="literal">foo</code> see is not the <code class="literal">ProxyFactoryBean</code> instance itself, but an object created by the <code class="literal">ProxyFactoryBean</code>'s implementation of the <code class="literal">getObject()</code> method. This method will create an AOP proxy wrapping a target object.</p> 
    <p>One of the most important benefits of using a <code class="literal">ProxyFactoryBean</code> or another IoC-aware class to create AOP proxies, is that it means that advices and pointcuts can also be managed by IoC. This is a powerful feature, enabling certain approaches that are hard to achieve with other AOP frameworks. For example, an advice may itself reference application objects (besides the target, which should be available in any AOP framework), benefiting from all the pluggability provided by Dependency Injection.</p> 
   </div> 
   <div class="section" title="9.5.2&nbsp;JavaBean properties">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-pfb-2"></a>9.5.2&nbsp;JavaBean properties</h3>
      </div>
     </div>
    </div> 
    <p>In common with most <code class="literal">FactoryBean</code> implementations provided with Spring, the <code class="literal">ProxyFactoryBean</code> class is itself a JavaBean. Its properties are used to:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> Specify the target you want to proxy. </li>
      <li class="listitem"> Specify whether to use CGLIB (see below and also <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-pfb-proxy-types" title="9.5.3&nbsp;JDK- and CGLIB-based proxies">Section&nbsp;9.5.3, JDK- and CGLIB-based proxies</a>). </li>
     </ul>
    </div> 
    <p>Some key properties are inherited from <code class="literal">org.springframework.aop.framework.ProxyConfig</code> (the superclass for all AOP proxy factories in Spring). These key properties include:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> <code class="literal">proxyTargetClass</code>: <code class="literal">true</code> if the target class is to be proxied, rather than the target class' interfaces. If this property value is set to <code class="literal">true</code>, then CGLIB proxies will be created (but see also <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-pfb-proxy-types" title="9.5.3&nbsp;JDK- and CGLIB-based proxies">Section&nbsp;9.5.3, JDK- and CGLIB-based proxies</a>). </li>
      <li class="listitem"> <code class="literal">optimize</code>: controls whether or not aggressive optimizations are applied to proxies <span class="emphasis"><em>created via CGLIB</em></span>. One should not blithely use this setting unless one fully understands how the relevant AOP proxy handles optimization. This is currently used only for CGLIB proxies; it has no effect with JDK dynamic proxies. </li>
      <li class="listitem"> <code class="literal">frozen</code>: if a proxy configuration is <code class="literal">frozen</code>, then changes to the configuration are no longer allowed. This is useful both as a slight optimization and for those cases when you dont want callers to be able to manipulate the proxy (via the <code class="literal">Advised</code> interface) after the proxy has been created. The default value of this property is <code class="literal">false</code>, so changes such as adding additional advice are allowed. </li>
      <li class="listitem"> <code class="literal">exposeProxy</code>: determines whether or not the current proxy should be exposed in a <code class="literal">ThreadLocal</code> so that it can be accessed by the target. If a target needs to obtain the proxy and the <code class="literal">exposeProxy</code> property is set to <code class="literal">true</code>, the target can use the <code class="literal">AopContext.currentProxy()</code> method. </li>
     </ul>
    </div> 
    <p>Other properties specific to <code class="literal">ProxyFactoryBean</code> include:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> <code class="literal">proxyInterfaces</code>: array of String interface names. If this isnt supplied, a CGLIB proxy for the target class will be used (but see also <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-pfb-proxy-types" title="9.5.3&nbsp;JDK- and CGLIB-based proxies">Section&nbsp;9.5.3, JDK- and CGLIB-based proxies</a>). </li>
      <li class="listitem"> <code class="literal">interceptorNames</code>: String array of <code class="literal">Advisor</code>, interceptor or other advice names to apply. Ordering is significant, on a first come-first served basis. That is to say that the first interceptor in the list will be the first to be able to intercept the invocation. </li>
     </ul>
    </div> 
    <p>The names are bean names in the current factory, including bean names from ancestor factories. You cant mention bean references here since doing so would result in the <code class="literal">ProxyFactoryBean</code> ignoring the singleton setting of the advice.</p> 
    <p>You can append an interceptor name with an asterisk ( <code class="literal">*</code>). This will result in the application of all advisor beans with names starting with the part before the asterisk to be applied. An example of using this feature can be found in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#aop-global-advisors" title="9.5.6&nbsp;Using global advisors">Section&nbsp;9.5.6, Using <span class="emphasis"><em>global</em></span> advisors</a>.</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> singleton: whether or not the factory should return a single object, no matter how often the <code class="literal">getObject()</code> method is called. Several <code class="literal">FactoryBean</code> implementations offer such a method. The default value is <code class="literal">true</code>. If you want to use stateful advice - for example, for stateful mixins - use prototype advices along with a singleton value of <code class="literal">false</code>. </li>
     </ul>
    </div> 
   </div> 
   <div class="section" title="9.5.3&nbsp;JDK- and CGLIB-based proxies">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-pfb-proxy-types"></a>9.5.3&nbsp;JDK- and CGLIB-based proxies</h3>
      </div>
     </div>
    </div> 
    <p>This section serves as the definitive documentation on how the <code class="literal">ProxyFactoryBean</code> chooses to create one of either a JDK- and CGLIB-based proxy for a particular target object (that is to be proxied).</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>The behavior of the <code class="literal">ProxyFactoryBean</code> with regard to creating JDK- or CGLIB-based proxies changed between versions 1.2.x and 2.0 of Spring. The <code class="literal">ProxyFactoryBean</code> now exhibits similar semantics with regard to auto-detecting interfaces as those of the <code class="literal">TransactionProxyFactoryBean</code> class.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>If the class of a target object that is to be proxied (hereafter simply referred to as the target class) doesnt implement any interfaces, then a CGLIB-based proxy will be created. This is the easiest scenario, because JDK proxies are interface based, and no interfaces means JDK proxying isnt even possible. One simply plugs in the target bean, and specifies the list of interceptors via the <code class="literal">interceptorNames</code> property. Note that a CGLIB-based proxy will be created even if the <code class="literal">proxyTargetClass</code> property of the <code class="literal">ProxyFactoryBean</code> has been set to <code class="literal">false</code>. (Obviously this makes no sense, and is best removed from the bean definition because it is at best redundant, and at worst confusing.)</p> 
    <p>If the target class implements one (or more) interfaces, then the type of proxy that is created depends on the configuration of the <code class="literal">ProxyFactoryBean</code>.</p> 
    <p>If the <code class="literal">proxyTargetClass</code> property of the <code class="literal">ProxyFactoryBean</code> has been set to <code class="literal">true</code>, then a CGLIB-based proxy will be created. This makes sense, and is in keeping with the principle of least surprise. Even if the <code class="literal">proxyInterfaces</code> property of the <code class="literal">ProxyFactoryBean</code> has been set to one or more fully qualified interface names, the fact that the <code class="literal">proxyTargetClass</code> property is set to <code class="literal">true</code> <span class="emphasis"><em>will</em></span> cause CGLIB-based proxying to be in effect.</p> 
    <p>If the <code class="literal">proxyInterfaces</code> property of the <code class="literal">ProxyFactoryBean</code> has been set to one or more fully qualified interface names, then a JDK-based proxy will be created. The created proxy will implement all of the interfaces that were specified in the <code class="literal">proxyInterfaces</code> property; if the target class happens to implement a whole lot more interfaces than those specified in the <code class="literal">proxyInterfaces</code> property, that is all well and good but those additional interfaces will not be implemented by the returned proxy.</p> 
    <p>If the <code class="literal">proxyInterfaces</code> property of the <code class="literal">ProxyFactoryBean</code> has <span class="emphasis"><em>not</em></span> been set, but the target class <span class="emphasis"><em>does implement one (or more)</em></span> interfaces, then the <code class="literal">ProxyFactoryBean</code> will auto-detect the fact that the target class does actually implement at least one interface, and a JDK-based proxy will be created. The interfaces that are actually proxied will be <span class="emphasis"><em>all</em></span> of the interfaces that the target class implements; in effect, this is the same as simply supplying a list of each and every interface that the target class implements to the <code class="literal">proxyInterfaces</code> property. However, it is significantly less work, and less prone to typos.</p> 
   </div> 
   <div class="section" title="9.5.4&nbsp;Proxying interfaces">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-api-proxying-intf"></a>9.5.4&nbsp;Proxying interfaces</h3>
      </div>
     </div>
    </div> 
    <p>Lets look at a simple example of <code class="literal">ProxyFactoryBean</code> in action. This example involves:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> A <span class="emphasis"><em>target bean</em></span> that will be proxied. This is the &quot;personTarget&quot; bean definition in the example below. </li>
      <li class="listitem"> An Advisor and an Interceptor used to provide advice. </li>
      <li class="listitem"> An AOP proxy bean definition specifying the target object (the personTarget bean) and the interfaces to proxy, along with the advices to apply. </li>
     </ul>
    </div> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;personTarget&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.mycompany.PersonImpl&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Tony&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;age&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;51&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myAdvisor&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.mycompany.MyAdvisor&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;someProperty&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Custom string property value&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;debugInterceptor&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.interceptor.DebugInterceptor&quot;</span><span class="hl-tag">&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;person&quot;</span>
    <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;proxyInterfaces&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;com.mycompany.Person&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;target&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;personTarget&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;interceptorNames&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>myAdvisor<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>debugInterceptor<span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>Note that the <code class="literal">interceptorNames</code> property takes a list of String: the bean names of the interceptor or advisors in the current factory. Advisors, interceptors, before, after returning and throws advice objects can be used. The ordering of advisors is significant.</p> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>You might be wondering why the list doesnt hold bean references. The reason for this is that if the ProxyFactoryBeans singleton property is set to false, it must be able to return independent proxy instances. If any of the advisors is itself a prototype, an independent instance would need to be returned, so its necessary to be able to obtain an instance of the prototype from the factory; holding a reference isnt sufficient.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>The &quot;person&quot; bean definition above can be used in place of a Person implementation, as follows:</p> 
    <pre class="programlisting">Person person = (Person) factory.getBean(<span class="hl-string">&quot;person&quot;</span>);</pre> 
    <p>Other beans in the same IoC context can express a strongly typed dependency on it, as with an ordinary Java object:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;personUser&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.mycompany.PersonUser&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;person&quot;</span><span class="hl-tag">&gt;</span><span class="hl-tag">&lt;ref</span> <span class="hl-attribute">bean</span>=<span class="hl-value">&quot;person&quot;</span><span class="hl-tag">/&gt;</span><span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>The <code class="literal">PersonUser</code> class in this example would expose a property of type Person. As far as its concerned, the AOP proxy can be used transparently in place of a &quot;real&quot; person implementation. However, its class would be a dynamic proxy class. It would be possible to cast it to the <code class="literal">Advised</code> interface (discussed below).</p> 
    <p>Its possible to conceal the distinction between target and proxy using an anonymous <span class="emphasis"><em>inner bean</em></span>, as follows. Only the <code class="literal">ProxyFactoryBean</code> definition is different; the advice is included only for completeness:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myAdvisor&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.mycompany.MyAdvisor&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;someProperty&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Custom string property value&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;debugInterceptor&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.interceptor.DebugInterceptor&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;person&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;proxyInterfaces&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;com.mycompany.Person&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-comment">&lt;!-- Use inner bean, not local reference to target --&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;target&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.mycompany.PersonImpl&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;name&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;Tony&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;age&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;51&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/bean&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;interceptorNames&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>myAdvisor<span class="hl-tag">&lt;/value&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>debugInterceptor<span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>This has the advantage that theres only one object of type <code class="literal">Person</code>: useful if we want to prevent users of the application context from obtaining a reference to the un-advised object, or need to avoid any ambiguity with Spring IoC <span class="emphasis"><em>autowiring</em></span>. Theres also arguably an advantage in that the ProxyFactoryBean definition is self-contained. However, there are times when being able to obtain the un-advised target from the factory might actually be an <span class="emphasis"><em>advantage</em></span>: for example, in certain test scenarios.</p> 
   </div> 
   <div class="section" title="9.5.5&nbsp;Proxying classes">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-api-proxying-class"></a>9.5.5&nbsp;Proxying classes</h3>
      </div>
     </div>
    </div> 
    <p>What if you need to proxy a class, rather than one or more interfaces?</p> 
    <p>Imagine that in our example above, there was no <code class="literal">Person</code> interface: we needed to advise a class called <code class="literal">Person</code> that didnt implement any business interface. In this case, you can configure Spring to use CGLIB proxying, rather than dynamic proxies. Simply set the <code class="literal">proxyTargetClass</code> property on the ProxyFactoryBean above to true. While its best to program to interfaces, rather than classes, the ability to advise classes that dont implement interfaces can be useful when working with legacy code. (In general, Spring isnt prescriptive. While it makes it easy to apply good practices, it avoids forcing a particular approach.)</p> 
    <p>If you want to, you can force the use of CGLIB in any case, even if you do have interfaces.</p> 
    <p>CGLIB proxying works by generating a subclass of the target class at runtime. Spring configures this generated subclass to delegate method calls to the original target: the subclass is used to implement the <span class="emphasis"><em>Decorator</em></span> pattern, weaving in the advice.</p> 
    <p>CGLIB proxying should generally be transparent to users. However, there are some issues to consider:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> <code class="literal">Final</code> methods cant be advised, as they cant be overridden. </li>
      <li class="listitem"> There is no need to add CGLIB to your classpath. As of Spring 3.2, CGLIB is repackaged and included in the spring-core JAR. In other words, CGLIB-based AOP will work &quot;out of the box&quot; just as do JDK dynamic proxies. </li>
     </ul>
    </div> 
    <p>Theres little performance difference between CGLIB proxying and dynamic proxies. As of Spring 1.0, dynamic proxies are slightly faster. However, this may change in the future. Performance should not be a decisive consideration in this case.</p> 
   </div> 
   <div class="section" title="9.5.6&nbsp;Using global advisors">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-global-advisors"></a>9.5.6&nbsp;Using <span class="emphasis"><em>global</em></span> advisors</h3>
      </div>
     </div>
    </div> 
    <p>By appending an asterisk to an interceptor name, all advisors with bean names matching the part before the asterisk, will be added to the advisor chain. This can come in handy if you need to add a standard set of <span class="emphasis"><em>global</em></span> advisors:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;proxy&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;target&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;service&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;interceptorNames&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>global*<span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;global_debug&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.interceptor.DebugInterceptor&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;global_performance&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.interceptor.PerformanceMonitorInterceptor&quot;</span><span class="hl-tag">/&gt;</span></pre> 
   </div> 
  </div> 
  <div class="section" title="9.6&nbsp;Concise proxy definitions">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="aop-concise-proxy"></a>9.6&nbsp;Concise proxy definitions</h2>
     </div>
    </div>
   </div> 
   <p>Especially when defining transactional proxies, you may end up with many similar proxy definitions. The use of parent and child bean definitions, along with inner bean definitions, can result in much cleaner and more concise proxy definitions.</p> 
   <p>First a parent, <span class="emphasis"><em>template</em></span>, bean definition is created for the proxy:</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;txProxyTemplate&quot;</span> <span class="hl-attribute">abstract</span>=<span class="hl-value">&quot;true&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.transaction.interceptor.TransactionProxyFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;transactionManager&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;transactionManager&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;transactionAttributes&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;props&gt;</span>
            <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;*&quot;</span><span class="hl-tag">&gt;</span>PROPAGATION_REQUIRED<span class="hl-tag">&lt;/prop&gt;</span>
        <span class="hl-tag">&lt;/props&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   <p>This will never be instantiated itself, so may actually be incomplete. Then each proxy which needs to be created is just a child bean definition, which wraps the target of the proxy as an inner bean definition, since the target will never be used on its own anyway.</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;myService&quot;</span> <span class="hl-attribute">parent</span>=<span class="hl-value">&quot;txProxyTemplate&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;target&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.samples.MyServiceImpl&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;/bean&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   <p>It is of course possible to override properties from the parent template, such as in this case, the transaction propagation settings:</p> 
   <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;mySpecialService&quot;</span> <span class="hl-attribute">parent</span>=<span class="hl-value">&quot;txProxyTemplate&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;target&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.samples.MySpecialServiceImpl&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;/bean&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;transactionAttributes&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;props&gt;</span>
            <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;get*&quot;</span><span class="hl-tag">&gt;</span>PROPAGATION_REQUIRED,readOnly<span class="hl-tag">&lt;/prop&gt;</span>
            <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;find*&quot;</span><span class="hl-tag">&gt;</span>PROPAGATION_REQUIRED,readOnly<span class="hl-tag">&lt;/prop&gt;</span>
            <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;load*&quot;</span><span class="hl-tag">&gt;</span>PROPAGATION_REQUIRED,readOnly<span class="hl-tag">&lt;/prop&gt;</span>
            <span class="hl-tag">&lt;prop</span> <span class="hl-attribute">key</span>=<span class="hl-value">&quot;store*&quot;</span><span class="hl-tag">&gt;</span>PROPAGATION_REQUIRED<span class="hl-tag">&lt;/prop&gt;</span>
        <span class="hl-tag">&lt;/props&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
   <p>Note that in the example above, we have explicitly marked the parent bean definition as <span class="emphasis"><em>abstract</em></span> by using the <span class="emphasis"><em>abstract</em></span> attribute, as described <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-child-bean-definitions" title="4.7&nbsp;Bean definition inheritance">previously</a>, so that it may not actually ever be instantiated. Application contexts (but not simple bean factories) will by default pre-instantiate all singletons. It is therefore important (at least for singleton beans) that if you have a (parent) bean definition which you intend to use only as a template, and this definition specifies a class, you must make sure to set the <span class="emphasis"><em>abstract</em></span> attribute to <span class="emphasis"><em>true</em></span>, otherwise the application context will actually try to pre-instantiate it.</p> 
  </div> 
  <div class="section" title="9.7&nbsp;Creating AOP proxies programmatically with the ProxyFactory">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="aop-prog"></a>9.7&nbsp;Creating AOP proxies programmatically with the ProxyFactory</h2>
     </div>
    </div>
   </div> 
   <p>Its easy to create AOP proxies programmatically using Spring. This enables you to use Spring AOP without dependency on Spring IoC.</p> 
   <p>The following listing shows creation of a proxy for a target object, with one interceptor and one advisor. The interfaces implemented by the target object will automatically be proxied:</p> 
   <pre class="programlisting">ProxyFactory factory = <span class="hl-keyword">new</span> ProxyFactory(myBusinessInterfaceImpl);
factory.addAdvice(myMethodInterceptor);
factory.addAdvisor(myAdvisor);
MyBusinessInterface tb = (MyBusinessInterface) factory.getProxy();</pre> 
   <p>The first step is to construct an object of type <code class="literal">org.springframework.aop.framework.ProxyFactory</code>. You can create this with a target object, as in the above example, or specify the interfaces to be proxied in an alternate constructor.</p> 
   <p>You can add advices (with interceptors as a specialized kind of advice) and/or advisors, and manipulate them for the life of the ProxyFactory. If you add an IntroductionInterceptionAroundAdvisor, you can cause the proxy to implement additional interfaces.</p> 
   <p>There are also convenience methods on ProxyFactory (inherited from <code class="literal">AdvisedSupport</code>) which allow you to add other advice types such as before and throws advice. AdvisedSupport is the superclass of both ProxyFactory and ProxyFactoryBean.</p> 
   <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Tip">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
       <th align="left">Tip</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>Integrating AOP proxy creation with the IoC framework is best practice in most applications. We recommend that you externalize configuration from Java code with AOP, as in general.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
  </div> 
  <div class="section" title="9.8&nbsp;Manipulating advised objects">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="aop-api-advised"></a>9.8&nbsp;Manipulating advised objects</h2>
     </div>
    </div>
   </div> 
   <p>However you create AOP proxies, you can manipulate them using the <code class="literal">org.springframework.aop.framework.Advised</code> interface. Any AOP proxy can be cast to this interface, whichever other interfaces it implements. This interface includes the following methods:</p> 
   <pre class="programlisting">Advisor[] getAdvisors();

<span class="hl-keyword">void</span> addAdvice(Advice advice) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">void</span> addAdvice(<span class="hl-keyword">int</span> pos, Advice advice) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">void</span> addAdvisor(Advisor advisor) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">void</span> addAdvisor(<span class="hl-keyword">int</span> pos, Advisor advisor) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">int</span> indexOf(Advisor advisor);

<span class="hl-keyword">boolean</span> removeAdvisor(Advisor advisor) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">void</span> removeAdvisor(<span class="hl-keyword">int</span> index) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">boolean</span> replaceAdvisor(Advisor a, Advisor b) <span class="hl-keyword">throws</span> AopConfigException;

<span class="hl-keyword">boolean</span> isFrozen();</pre> 
   <p>The <code class="literal">getAdvisors()</code> method will return an Advisor for every advisor, interceptor or other advice type that has been added to the factory. If you added an Advisor, the returned advisor at this index will be the object that you added. If you added an interceptor or other advice type, Spring will have wrapped this in an advisor with a pointcut that always returns true. Thus if you added a <code class="literal">MethodInterceptor</code>, the advisor returned for this index will be an <code class="literal">DefaultPointcutAdvisor</code> returning your <code class="literal">MethodInterceptor</code> and a pointcut that matches all classes and methods.</p> 
   <p>The <code class="literal">addAdvisor()</code> methods can be used to add any Advisor. Usually the advisor holding pointcut and advice will be the generic <code class="literal">DefaultPointcutAdvisor</code>, which can be used with any advice or pointcut (but not for introductions).</p> 
   <p>By default, its possible to add or remove advisors or interceptors even once a proxy has been created. The only restriction is that its impossible to add or remove an introduction advisor, as existing proxies from the factory will not show the interface change. (You can obtain a new proxy from the factory to avoid this problem.)</p> 
   <p>A simple example of casting an AOP proxy to the <code class="literal">Advised</code> interface and examining and manipulating its advice:</p> 
   <pre class="programlisting">Advised advised = (Advised) myObject;
Advisor[] advisors = advised.getAdvisors();
<span class="hl-keyword">int</span> oldAdvisorCount = advisors.length;
System.out.println(oldAdvisorCount + <span class="hl-string">&quot; advisors&quot;</span>);

<span class="hl-comment">// Add an advice like an interceptor without a pointcut</span>
<span class="hl-comment">// Will match all proxied methods</span>
<span class="hl-comment">// Can use for interceptors, before, after returning or throws advice</span>
advised.addAdvice(<span class="hl-keyword">new</span> DebugInterceptor());

<span class="hl-comment">// Add selective advice using a pointcut</span>
advised.addAdvisor(<span class="hl-keyword">new</span> DefaultPointcutAdvisor(mySpecialPointcut, myAdvice));

assertEquals(<span class="hl-string">&quot;Added two advisors&quot;</span>, oldAdvisorCount + <span class="hl-number">2</span>, advised.getAdvisors().length);</pre> 
   <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Note">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
       <th align="left">Note</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>Its questionable whether its advisable (no pun intended) to modify advice on a business object in production, although there are no doubt legitimate usage cases. However, it can be very useful in development: for example, in tests. I have sometimes found it very useful to be able to add test code in the form of an interceptor or other advice, getting inside a method invocation I want to test. (For example, the advice can get inside a transaction created for that method: for example, to run SQL to check that a database was correctly updated, before marking the transaction for roll back.)</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <p>Depending on how you created the proxy, you can usually set a <code class="literal">frozen</code> flag, in which case the <code class="literal">Advised</code> <code class="literal">isFrozen()</code> method will return true, and any attempts to modify advice through addition or removal will result in an <code class="literal">AopConfigException</code>. The ability to freeze the state of an advised object is useful in some cases, for example, to prevent calling code removing a security interceptor. It may also be used in Spring 1.1 to allow aggressive optimization if runtime advice modification is known not to be required.</p> 
  </div> 
  <div class="section" title="9.9&nbsp;Using the &quot;auto-proxy&quot; facility">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="aop-autoproxy"></a>9.9&nbsp;Using the &quot;auto-proxy&quot; facility</h2>
     </div>
    </div>
   </div> 
   <p>So far weve considered explicit creation of AOP proxies using a <code class="literal">ProxyFactoryBean</code> or similar factory bean.</p> 
   <p>Spring also allows us to use &quot;auto-proxy&quot; bean definitions, which can automatically proxy selected bean definitions. This is built on Spring &quot;bean post processor&quot; infrastructure, which enables modification of any bean definition as the container loads.</p> 
   <p>In this model, you set up some special bean definitions in your XML bean definition file to configure the auto proxy infrastructure. This allows you just to declare the targets eligible for auto-proxying: you dont need to use <code class="literal">ProxyFactoryBean</code>.</p> 
   <p>There are two ways to do this:</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem"> Using an auto-proxy creator that refers to specific beans in the current context. </li>
     <li class="listitem"> A special case of auto-proxy creation that deserves to be considered separately; auto-proxy creation driven by source-level metadata attributes. </li>
    </ul>
   </div> 
   <div class="section" title="9.9.1&nbsp;Autoproxy bean definitions">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-autoproxy-choices"></a>9.9.1&nbsp;Autoproxy bean definitions</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">org.springframework.aop.framework.autoproxy</code> package provides the following standard auto-proxy creators.</p> 
    <div class="section" title="BeanNameAutoProxyCreator">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-api-autoproxy"></a>BeanNameAutoProxyCreator</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">BeanNameAutoProxyCreator</code> class is a <code class="literal">BeanPostProcessor</code> that automatically creates AOP proxies for beans with names matching literal values or wildcards.</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;beanNames&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;jdk*,onlyJdk&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;interceptorNames&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;list&gt;</span>
            <span class="hl-tag">&lt;value&gt;</span>myInterceptor<span class="hl-tag">&lt;/value&gt;</span>
        <span class="hl-tag">&lt;/list&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
     <p>As with <code class="literal">ProxyFactoryBean</code>, there is an <code class="literal">interceptorNames</code> property rather than a list of interceptors, to allow correct behavior for prototype advisors. Named &quot;interceptors&quot; can be advisors or any advice type.</p> 
     <p>As with auto proxying in general, the main point of using <code class="literal">BeanNameAutoProxyCreator</code> is to apply the same configuration consistently to multiple objects, with minimal volume of configuration. It is a popular choice for applying declarative transactions to multiple objects.</p> 
     <p>Bean definitions whose names match, such as &quot;jdkMyBean&quot; and &quot;onlyJdk&quot; in the above example, are plain old bean definitions with the target class. An AOP proxy will be created automatically by the <code class="literal">BeanNameAutoProxyCreator</code>. The same advice will be applied to all matching beans. Note that if advisors are used (rather than the interceptor in the above example), the pointcuts may apply differently to different beans.</p> 
    </div> 
    <div class="section" title="DefaultAdvisorAutoProxyCreator">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-api-autoproxy-default"></a>DefaultAdvisorAutoProxyCreator</h4>
       </div>
      </div>
     </div> 
     <p>A more general and extremely powerful auto proxy creator is <code class="literal">DefaultAdvisorAutoProxyCreator</code>. This will automagically apply eligible advisors in the current context, without the need to include specific bean names in the auto-proxy advisors bean definition. It offers the same merit of consistent configuration and avoidance of duplication as <code class="literal">BeanNameAutoProxyCreator</code>.</p> 
     <p>Using this mechanism involves:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> Specifying a <code class="literal">DefaultAdvisorAutoProxyCreator</code> bean definition. </li>
       <li class="listitem"> Specifying any number of Advisors in the same or related contexts. Note that these <span class="emphasis"><em>must</em></span> be Advisors, not just interceptors or other advices. This is necessary because there must be a pointcut to evaluate, to check the eligibility of each advice to candidate bean definitions. </li>
      </ul>
     </div> 
     <p>The <code class="literal">DefaultAdvisorAutoProxyCreator</code> will automatically evaluate the pointcut contained in each advisor, to see what (if any) advice it should apply to each business object (such as &quot;businessObject1&quot; and &quot;businessObject2&quot; in the example).</p> 
     <p>This means that any number of advisors can be applied automatically to each business object. If no pointcut in any of the advisors matches any method in a business object, the object will not be proxied. As bean definitions are added for new business objects, they will automatically be proxied if necessary.</p> 
     <p>Autoproxying in general has the advantage of making it impossible for callers or dependencies to obtain an un-advised object. Calling getBean(&quot;businessObject1&quot;) on this ApplicationContext will return an AOP proxy, not the target business object. (The &quot;inner bean&quot; idiom shown earlier also offers this benefit.)</p> 
     <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;transactionInterceptor&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;transactionInterceptor&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;customAdvisor&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.mycompany.MyAdvisor&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;businessObject1&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.mycompany.BusinessObject1&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-comment">&lt;!-- Properties omitted --&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;businessObject2&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.mycompany.BusinessObject2&quot;</span><span class="hl-tag">/&gt;</span></pre> 
     <p>The <code class="literal">DefaultAdvisorAutoProxyCreator</code> is very useful if you want to apply the same advice consistently to many business objects. Once the infrastructure definitions are in place, you can simply add new business objects without including specific proxy configuration. You can also drop in additional aspects very easily - for example, tracing or performance monitoring aspects - with minimal change to configuration.</p> 
     <p>The DefaultAdvisorAutoProxyCreator offers support for filtering (using a naming convention so that only certain advisors are evaluated, allowing use of multiple, differently configured, AdvisorAutoProxyCreators in the same factory) and ordering. Advisors can implement the <code class="literal">org.springframework.core.Ordered</code> interface to ensure correct ordering if this is an issue. The TransactionAttributeSourceAdvisor used in the above example has a configurable order value; the default setting is unordered.</p> 
    </div> 
    <div class="section" title="AbstractAdvisorAutoProxyCreator">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="aop-api-autoproxy-abstract"></a>AbstractAdvisorAutoProxyCreator</h4>
       </div>
      </div>
     </div> 
     <p>This is the superclass of DefaultAdvisorAutoProxyCreator. You can create your own auto-proxy creators by subclassing this class, in the unlikely event that advisor definitions offer insufficient customization to the behavior of the framework <code class="literal">DefaultAdvisorAutoProxyCreator</code>.</p> 
    </div> 
   </div> 
   <div class="section" title="9.9.2&nbsp;Using metadata-driven auto-proxying">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-autoproxy-metadata"></a>9.9.2&nbsp;Using metadata-driven auto-proxying</h3>
      </div>
     </div>
    </div> 
    <p>A particularly important type of auto-proxying is driven by metadata. This produces a similar programming model to .NET <code class="literal">ServicedComponents</code>. Instead of defining metadata in XML descriptors, configuration for transaction management and other enterprise services is held in source-level attributes.</p> 
    <p>In this case, you use the <code class="literal">DefaultAdvisorAutoProxyCreator</code>, in combination with Advisors that understand metadata attributes. The metadata specifics are held in the pointcut part of the candidate advisors, rather than in the auto-proxy creation class itself.</p> 
    <p>This is really a special case of the <code class="literal">DefaultAdvisorAutoProxyCreator</code>, but deserves consideration on its own. (The metadata-aware code is in the pointcuts contained in the advisors, not the AOP framework itself.)</p> 
    <p>The <code class="literal">/attributes</code> directory of the JPetStore sample application shows the use of attribute-driven auto-proxying. In this case, theres no need to use the <code class="literal">TransactionProxyFactoryBean</code>. Simply defining transactional attributes on business objects is sufficient, because of the use of metadata-aware pointcuts. The bean definitions include the following code, in <code class="literal">/WEB-INF/declarativeServices.xml</code>. Note that this is generic, and can be used outside the JPetStore:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;transactionInterceptor&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;transactionInterceptor&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;transactionInterceptor&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.transaction.interceptor.TransactionInterceptor&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;transactionManager&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;transactionManager&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;transactionAttributeSource&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.transaction.interceptor.AttributesTransactionAttributeSource&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;attributes&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;attributes&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/bean&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;attributes&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.metadata.commons.CommonsAttributes&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <p>The <code class="literal">DefaultAdvisorAutoProxyCreator</code> bean definition (the name is not significant, hence it can even be omitted) will pick up all eligible pointcuts in the current application context. In this case, the &quot;transactionAdvisor&quot; bean definition, of type <code class="literal">TransactionAttributeSourceAdvisor</code>, will apply to classes or methods carrying a transaction attribute. The TransactionAttributeSourceAdvisor depends on a TransactionInterceptor, via constructor dependency. The example resolves this via autowiring. The <code class="literal">AttributesTransactionAttributeSource</code> depends on an implementation of the <code class="literal">org.springframework.metadata.Attributes</code> interface. In this fragment, the &quot;attributes&quot; bean satisfies this, using the Jakarta Commons Attributes API to obtain attribute information. (The application code must have been compiled using the Commons Attributes compilation task.)</p> 
    <p>The <code class="literal">/annotation</code> directory of the JPetStore sample application contains an analogous example for auto-proxying driven by JDK 1.5+ annotations. The following configuration enables automatic detection of Springs <code class="literal">Transactional</code> annotation, leading to implicit proxies for beans containing that annotation:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.transaction.interceptor.TransactionAttributeSourceAdvisor&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;transactionInterceptor&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;transactionInterceptor&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;transactionInterceptor&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.transaction.interceptor.TransactionInterceptor&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;transactionManager&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;transactionManager&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;transactionAttributeSource&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.transaction.annotation.AnnotationTransactionAttributeSource&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/property&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>The <code class="literal">TransactionInterceptor</code> defined here depends on a <code class="literal">PlatformTransactionManager</code> definition, which is not included in this generic file (although it could be) because it will be specific to the applications transaction requirements (typically JTA, as in this example, or Hibernate, JDO or JDBC):</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;transactionManager&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.transaction.jta.JtaTransactionManager&quot;</span><span class="hl-tag">/&gt;</span></pre> 
    <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Tip">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
        <th align="left">Tip</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>If you require only declarative transaction management, using these generic XML definitions will result in Spring automatically proxying all classes or methods with transaction attributes. You wont need to work directly with AOP, and the programming model is similar to that of .NET ServicedComponents.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>This mechanism is extensible. Its possible to do auto-proxying based on custom attributes. You need to:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> Define your custom attribute. </li>
      <li class="listitem"> Specify an Advisor with the necessary advice, including a pointcut that is triggered by the presence of the custom attribute on a class or method. You may be able to use an existing advice, merely implementing a static pointcut that picks up the custom attribute. </li>
     </ul>
    </div> 
    <p>Its possible for such advisors to be unique to each advised class (for example, mixins): they simply need to be defined as prototype, rather than singleton, bean definitions. For example, the <code class="literal">LockMixin</code> introduction interceptor from the Spring test suite, shown above, could be used in conjunction with an attribute-driven pointcut to target a mixin, as shown here. We use the generic <code class="literal">DefaultPointcutAdvisor</code>, configured using JavaBean properties:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;lockMixin&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.LockMixin&quot;</span>
        <span class="hl-attribute">scope</span>=<span class="hl-value">&quot;prototype&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;lockableAdvisor&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.support.DefaultPointcutAdvisor&quot;</span>
        <span class="hl-attribute">scope</span>=<span class="hl-value">&quot;prototype&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;pointcut&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;myAttributeAwarePointcut&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;advice&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;lockMixin&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;anyBean&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;anyclass&quot;</span> <span class="hl-attribute">...</span></pre> 
    <p>If the attribute aware pointcut matches any methods in the <code class="literal">anyBean</code> or other bean definitions, the mixin will be applied. Note that both <code class="literal">lockMixin</code> and <code class="literal">lockableAdvisor</code> definitions are prototypes. The <code class="literal">myAttributeAwarePointcut</code> pointcut can be a singleton definition, as it doesnt hold state for individual advised objects.</p> 
   </div> 
  </div> 
  <div class="section" title="9.10&nbsp;Using TargetSources">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="aop-targetsource"></a>9.10&nbsp;Using TargetSources</h2>
     </div>
    </div>
   </div> 
   <p>Spring offers the concept of a <span class="emphasis"><em>TargetSource</em></span>, expressed in the <code class="literal">org.springframework.aop.TargetSource</code> interface. This interface is responsible for returning the &quot;target object&quot; implementing the join point. The <code class="literal">TargetSource</code> implementation is asked for a target instance each time the AOP proxy handles a method invocation.</p> 
   <p>Developers using Spring AOP dont normally need to work directly with TargetSources, but this provides a powerful means of supporting pooling, hot swappable and other sophisticated targets. For example, a pooling TargetSource can return a different target instance for each invocation, using a pool to manage instances.</p> 
   <p>If you do not specify a TargetSource, a default implementation is used that wraps a local object. The same target is returned for each invocation (as you would expect).</p> 
   <p>Lets look at the standard target sources provided with Spring, and how you can use them.</p> 
   <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
    <table border="0" summary="Tip">
     <tbody>
      <tr>
       <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
       <th align="left">Tip</th>
      </tr>
      <tr>
       <td align="left" valign="top"> <p>When using a custom target source, your target will usually need to be a prototype rather than a singleton bean definition. This allows Spring to create a new target instance when required.</p> </td>
      </tr>
     </tbody>
    </table>
   </div> 
   <div class="section" title="9.10.1&nbsp;Hot swappable target sources">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-ts-swap"></a>9.10.1&nbsp;Hot swappable target sources</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">org.springframework.aop.target.HotSwappableTargetSource</code> exists to allow the target of an AOP proxy to be switched while allowing callers to keep their references to it.</p> 
    <p>Changing the target sources target takes effect immediately. The <code class="literal">HotSwappableTargetSource</code> is threadsafe.</p> 
    <p>You can change the target via the <code class="literal">swap()</code> method on HotSwappableTargetSource as follows:</p> 
    <pre class="programlisting">HotSwappableTargetSource swapper = (HotSwappableTargetSource) beanFactory.getBean(<span class="hl-string">&quot;swapper&quot;</span>);
Object oldTarget = swapper.swap(newTarget);</pre> 
    <p>The XML definitions required look as follows:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;initialTarget&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;mycompany.OldTarget&quot;</span><span class="hl-tag">/&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;swapper&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.target.HotSwappableTargetSource&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;initialTarget&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;swappable&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;targetSource&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;swapper&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>The above <code class="literal">swap()</code> call changes the target of the swappable bean. Clients who hold a reference to that bean will be unaware of the change, but will immediately start hitting the new target.</p> 
    <p>Although this example doesnt add any advice - and its not necessary to add advice to use a <code class="literal">TargetSource</code> - of course any <code class="literal">TargetSource</code> can be used in conjunction with arbitrary advice.</p> 
   </div> 
   <div class="section" title="9.10.2&nbsp;Pooling target sources">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-ts-pool"></a>9.10.2&nbsp;Pooling target sources</h3>
      </div>
     </div>
    </div> 
    <p>Using a pooling target source provides a similar programming model to stateless session EJBs, in which a pool of identical instances is maintained, with method invocations going to free objects in the pool.</p> 
    <p>A crucial difference between Spring pooling and SLSB pooling is that Spring pooling can be applied to any POJO. As with Spring in general, this service can be applied in a non-invasive way.</p> 
    <p>Spring provides out-of-the-box support for Jakarta Commons Pool 1.3, which provides a fairly efficient pooling implementation. Youll need the commons-pool Jar on your applications classpath to use this feature. Its also possible to subclass <code class="literal">org.springframework.aop.target.AbstractPoolingTargetSource</code> to support any other pooling API.</p> 
    <p>Sample configuration is shown below:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;businessObjectTarget&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.mycompany.MyBusinessObject&quot;</span>
        <span class="hl-attribute">scope</span>=<span class="hl-value">&quot;prototype&quot;</span><span class="hl-tag">&gt;</span>
    ... properties omitted
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;poolTargetSource&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.target.CommonsPoolTargetSource&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;targetBeanName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;businessObjectTarget&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;maxSize&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;25&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;businessObject&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.framework.ProxyFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;targetSource&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;poolTargetSource&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;interceptorNames&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;myInterceptor&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>Note that the target object - &quot;businessObjectTarget&quot; in the example - <span class="emphasis"><em>must</em></span> be a prototype. This allows the <code class="literal">PoolingTargetSource</code> implementation to create new instances of the target to grow the pool as necessary. See the javadoc for <code class="literal">AbstractPoolingTargetSource</code> and the concrete subclass you wish to use for information about its properties: &quot;maxSize&quot; is the most basic, and always guaranteed to be present.</p> 
    <p>In this case, &quot;myInterceptor&quot; is the name of an interceptor that would need to be defined in the same IoC context. However, it isnt necessary to specify interceptors to use pooling. If you want only pooling, and no other advice, dont set the interceptorNames property at all.</p> 
    <p>Its possible to configure Spring so as to be able to cast any pooled object to the <code class="literal">org.springframework.aop.target.PoolingConfig</code> interface, which exposes information about the configuration and current size of the pool through an introduction. Youll need to define an advisor like this:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;poolConfigAdvisor&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.beans.factory.config.MethodInvokingFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;targetObject&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;poolTargetSource&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;targetMethod&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;getPoolingConfigMixin&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>This advisor is obtained by calling a convenience method on the <code class="literal">AbstractPoolingTargetSource</code> class, hence the use of MethodInvokingFactoryBean. This advisors name (&quot;poolConfigAdvisor&quot; here) must be in the list of interceptors names in the ProxyFactoryBean exposing the pooled object.</p> 
    <p>The cast will look as follows:</p> 
    <pre class="programlisting">PoolingConfig conf = (PoolingConfig) beanFactory.getBean(<span class="hl-string">&quot;businessObject&quot;</span>);
System.out.println(<span class="hl-string">&quot;Max pool size is &quot;</span> + conf.getMaxSize());</pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>Pooling stateless service objects is not usually necessary. We dont believe it should be the default choice, as most stateless objects are naturally thread safe, and instance pooling is problematic if resources are cached.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
    <p>Simpler pooling is available using auto-proxying. Its possible to set the TargetSources used by any auto-proxy creator.</p> 
   </div> 
   <div class="section" title="9.10.3&nbsp;Prototype target sources">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-ts-prototype"></a>9.10.3&nbsp;Prototype target sources</h3>
      </div>
     </div>
    </div> 
    <p>Setting up a &quot;prototype&quot; target source is similar to a pooling TargetSource. In this case, a new instance of the target will be created on every method invocation. Although the cost of creating a new object isnt high in a modern JVM, the cost of wiring up the new object (satisfying its IoC dependencies) may be more expensive. Thus you shouldnt use this approach without very good reason.</p> 
    <p>To do this, you could modify the <code class="literal">poolTargetSource</code> definition shown above as follows. (Ive also changed the name, for clarity.)</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;prototypeTargetSource&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.target.PrototypeTargetSource&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;targetBeanName&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;businessObjectTarget&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <p>Theres only one property: the name of the target bean. Inheritance is used in the TargetSource implementations to ensure consistent naming. As with the pooling target source, the target bean must be a prototype bean definition.</p> 
   </div> 
   <div class="section" title="9.10.4&nbsp;ThreadLocal target sources">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="aop-ts-threadlocal"></a>9.10.4&nbsp;ThreadLocal target sources</h3>
      </div>
     </div>
    </div> 
    <p><code class="literal">ThreadLocal</code> target sources are useful if you need an object to be created for each incoming request (per thread that is). The concept of a <code class="literal">ThreadLocal</code> provide a JDK-wide facility to transparently store resource alongside a thread. Setting up a <code class="literal">ThreadLocalTargetSource</code> is pretty much the same as was explained for the other types of target source:</p> 
    <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;threadlocalTargetSource&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.aop.target.ThreadLocalTargetSource&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;targetBeanName&quot;</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;businessObjectTarget&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
    <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
     <table border="0" summary="Note">
      <tbody>
       <tr>
        <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
        <th align="left">Note</th>
       </tr>
       <tr>
        <td align="left" valign="top"> <p>ThreadLocals come with serious issues (potentially resulting in memory leaks) when incorrectly using them in a multi-threaded and multi-classloader environments. One should always consider wrapping a threadlocal in some other class and never directly use the <code class="literal">ThreadLocal</code> itself (except of course in the wrapper class). Also, one should always remember to correctly set and unset (where the latter simply involved a call to <code class="literal">ThreadLocal.set(null)</code>) the resource local to the thread. Unsetting should be done in any case since not unsetting it might result in problematic behavior. Springs ThreadLocal support does this for you and should always be considered in favor of using ThreadLocals without other proper handling code.</p> </td>
       </tr>
      </tbody>
     </table>
    </div> 
   </div> 
  </div> 
  <div class="section" title="9.11&nbsp;Defining new Advice types">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="aop-extensibility"></a>9.11&nbsp;Defining new Advice types</h2>
     </div>
    </div>
   </div> 
   <p>Spring AOP is designed to be extensible. While the interception implementation strategy is presently used internally, it is possible to support arbitrary advice types in addition to the out-of-the-box interception around advice, before, throws advice and after returning advice.</p> 
   <p>The <code class="literal">org.springframework.aop.framework.adapter</code> package is an SPI package allowing support for new custom advice types to be added without changing the core framework. The only constraint on a custom <code class="literal">Advice</code> type is that it must implement the <code class="literal">org.aopalliance.aop.Advice</code> tag interface.</p> 
   <p>Please refer to the <code class="literal">org.springframework.aop.framework.adapter</code> packages Javadocs for further information.</p> 
  </div> 
  <div class="section" title="9.12&nbsp;Further resources">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="aop-api-resources"></a>9.12&nbsp;Further resources</h2>
     </div>
    </div>
   </div> 
   <p>Please refer to the Spring sample applications for further examples of Spring AOP:</p> 
   <div class="itemizedlist">
    <ul class="itemizedlist" type="disc">
     <li class="listitem"> The JPetStores default configuration illustrates the use of the <code class="literal">TransactionProxyFactoryBean</code> for declarative transaction management. </li>
     <li class="listitem"> The <code class="literal">/attributes</code> directory of the JPetStore illustrates the use of attribute-driven declarative transaction management. </li>
    </ul>
   </div> 
  </div> 
 </div> 
 <div class="chapter" title="10.&nbsp;Testing">
  <div class="titlepage">
   <div>
    <div>
     <h2 class="title"><a name="testing"></a>10.&nbsp;Testing</h2>
    </div>
   </div>
  </div> 
  <div class="section" title="10.1&nbsp;Introduction to Spring Testing">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="testing-introduction"></a>10.1&nbsp;Introduction to Spring Testing</h2>
     </div>
    </div>
   </div> 
   <p>Testing is an integral part of enterprise software development. This chapter focuses on the value-add of the IoC principle to <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#unit-testing" title="10.2&nbsp;Unit Testing">unit testing</a> and on the benefits of the Spring Frameworks support for <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#integration-testing" title="10.3&nbsp;Integration Testing">integration testing</a>. <span class="emphasis"><em>(A thorough treatment of testing in the enterprise is beyond the scope of this reference manual.)</em></span></p> 
  </div> 
  <div class="section" title="10.2&nbsp;Unit Testing">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="unit-testing"></a>10.2&nbsp;Unit Testing</h2>
     </div>
    </div>
   </div> 
   <p>Dependency Injection should make your code less dependent on the container than it would be with traditional Java EE development. The POJOs that make up your application should be testable in JUnit or TestNG tests, with objects simply instantiated using the <code class="literal">new</code> operator, <span class="emphasis"><em>without Spring or any other container</em></span>. You can use <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mock-objects" title="10.2.1&nbsp;Mock Objects">mock objects</a> (in conjunction with other valuable testing techniques) to test your code in isolation. If you follow the architecture recommendations for Spring, the resulting clean layering and componentization of your codebase will facilitate easier unit testing. For example, you can test service layer objects by stubbing or mocking DAO or Repository interfaces, without needing to access persistent data while running unit tests.</p> 
   <p>True unit tests typically run extremely quickly, as there is no runtime infrastructure to set up. Emphasizing true unit tests as part of your development methodology will boost your productivity. You may not need this section of the testing chapter to help you write effective unit tests for your IoC-based applications. For certain unit testing scenarios, however, the Spring Framework provides the following mock objects and testing support classes.</p> 
   <div class="section" title="10.2.1&nbsp;Mock Objects">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="mock-objects"></a>10.2.1&nbsp;Mock Objects</h3>
      </div>
     </div>
    </div> 
    <div class="section" title="Environment">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mock-objects-env"></a>Environment</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">org.springframework.mock.env</code> package contains mock implementations of the <code class="literal">Environment</code> and <code class="literal">PropertySource</code> abstractions (see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-definition-profiles" title="4.13&nbsp;Bean definition profiles and environment abstraction">Section&nbsp;4.13, Bean definition profiles and environment abstraction</a> and <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-property-source-abstraction" title="4.14&nbsp;PropertySource Abstraction">Section&nbsp;4.14, PropertySource Abstraction</a>). <code class="literal">MockEnvironment</code> and <code class="literal">MockPropertySource</code> are useful for developing <span class="emphasis"><em>out-of-container</em></span> tests for code that depends on environment-specific properties.</p> 
    </div> 
    <div class="section" title="JNDI">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mock-objects-jndi"></a>JNDI</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">org.springframework.mock.jndi</code> package contains an implementation of the JNDI SPI, which you can use to set up a simple JNDI environment for test suites or stand-alone applications. If, for example, JDBC <code class="literal">DataSource</code> s get bound to the same JNDI names in test code as within a Java EE container, you can reuse both application code and configuration in testing scenarios without modification.</p> 
    </div> 
    <div class="section" title="Servlet API">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mock-objects-servlet"></a>Servlet API</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">org.springframework.mock.web</code> package contains a comprehensive set of Servlet API mock objects, targeted at usage with Springs Web MVC framework, which are useful for testing web contexts and controllers. These mock objects are generally more convenient to use than dynamic mock objects such as <a class="ulink" href="http://www.easymock.org/" target="_top">EasyMock</a> or existing Servlet API mock objects such as <a class="ulink" href="http://www.mockobjects.com/" target="_top">MockObjects</a>.</p> 
    </div> 
    <div class="section" title="Portlet API">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="mock-objects-portlet"></a>Portlet API</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">org.springframework.mock.web.portlet</code> package contains a set of Portlet API mock objects, targeted at usage with Springs Portlet MVC framework.</p> 
    </div> 
   </div> 
   <div class="section" title="10.2.2&nbsp;Unit Testing support Classes">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="unit-testing-support-classes"></a>10.2.2&nbsp;Unit Testing support Classes</h3>
      </div>
     </div>
    </div> 
    <div class="section" title="General utilities">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="unit-testing-utilities"></a>General utilities</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">org.springframework.test.util</code> package contains <code class="literal">ReflectionTestUtils</code>, which is a collection of reflection-based utility methods. Developers use these methods in unit and integration testing scenarios in which they need to set a non- <code class="literal">public</code> field or invoke a non- <code class="literal">public</code> setter method when testing application code involving, for example:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> ORM frameworks such as JPA and Hibernate that condone <code class="literal">private</code> or <code class="literal">protected</code> field access as opposed to <code class="literal">public</code> setter methods for properties in a domain entity. </li>
       <li class="listitem"> Springs support for annotations such as <code class="literal">@Autowired</code>, <code class="literal">@Inject</code>, and <code class="literal">@Resource,</code> which provides dependency injection for <code class="literal">private</code> or <code class="literal">protected</code> fields, setter methods, and configuration methods. </li>
      </ul>
     </div> 
    </div> 
    <div class="section" title="Spring MVC">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="unit-testing-spring-mvc"></a>Spring MVC</h4>
       </div>
      </div>
     </div> 
     <p>The <code class="literal">org.springframework.test.web</code> package contains <code class="literal">ModelAndViewAssert</code>, which you can use in combination with JUnit, TestNG, or any other testing framework for unit tests dealing with Spring MVC <code class="literal">ModelAndView</code> objects.</p> 
     <div class="tip" title="Unit testing Spring MVC Controllers" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Tip: Unit testing Spring MVC Controllers">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
         <th align="left">Unit testing Spring MVC Controllers</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>To test your Spring MVC <code class="literal">Controller</code> s, use <code class="literal">ModelAndViewAssert</code> combined with <code class="literal">MockHttpServletRequest</code>, <code class="literal">MockHttpSession</code>, and so on from the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#mock-objects-servlet" title="Servlet API"><code class="literal">org.springframework.mock.web</code></a> package.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
   </div> 
  </div> 
  <div class="section" title="10.3&nbsp;Integration Testing">
   <div class="titlepage">
    <div>
     <div>
      <h2 class="title" style="clear: both"><a name="integration-testing"></a>10.3&nbsp;Integration Testing</h2>
     </div>
    </div>
   </div> 
   <div class="section" title="10.3.1&nbsp;Overview">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="integration-testing-overview"></a>10.3.1&nbsp;Overview</h3>
      </div>
     </div>
    </div> 
    <p>It is important to be able to perform some integration testing without requiring deployment to your application server or connecting to other enterprise infrastructure. This will enable you to test things such as:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> The correct wiring of your Spring IoC container contexts. </li>
      <li class="listitem"> Data access using JDBC or an ORM tool. This would include such things as the correctness of SQL statements, Hibernate queries, JPA entity mappings, etc. </li>
     </ul>
    </div> 
    <p>The Spring Framework provides first-class support for integration testing in the <code class="literal">spring-test</code> module. The name of the actual JAR file might include the release version and might also be in the long <code class="literal">org.springframework.test</code> form, depending on where you get it from (see the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#dependency-management" title="2.3.1&nbsp;Dependency Management and Naming Conventions">section on Dependency Management</a> for an explanation). This library includes the <code class="literal">org.springframework.test</code> package, which contains valuable classes for integration testing with a Spring container. This testing does not rely on an application server or other deployment environment. Such tests are slower to run than unit tests but much faster than the equivalent Cactus tests or remote tests that rely on deployment to an application server.</p> 
    <p>In Spring 2.5 and later, unit and integration testing support is provided in the form of the annotation-driven <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-framework" title="10.3.5&nbsp;Spring TestContext Framework">Spring TestContext Framework</a>. The TestContext framework is agnostic of the actual testing framework in use, thus allowing instrumentation of tests in various environments including JUnit, TestNG, and so on.</p> 
   </div> 
   <div class="section" title="10.3.2&nbsp;Goals of Integration Testing">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="integration-testing-goals"></a>10.3.2&nbsp;Goals of Integration Testing</h3>
      </div>
     </div>
    </div> 
    <p>Springs integration testing support has the following primary goals:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> To manage <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testing-ctx-management" title="Context management and caching">Spring IoC container caching</a> between test execution. </li>
      <li class="listitem"> To provide <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testing-fixture-di" title="Dependency Injection of test fixtures">Dependency Injection of test fixture instances</a>. </li>
      <li class="listitem"> To provide <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testing-tx" title="Transaction management">transaction management</a> appropriate to integration testing. </li>
      <li class="listitem"> To supply <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testing-support-classes" title="Support classes for integration testing">Spring-specific base classes</a> that assist developers in writing integration tests. </li>
     </ul>
    </div> 
    <p>The next few sections describe each goal and provide links to implementation and configuration details.</p> 
    <div class="section" title="Context management and caching">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="testing-ctx-management"></a>Context management and caching</h4>
       </div>
      </div>
     </div> 
     <p>The Spring TestContext Framework provides consistent loading of Spring <code class="literal">ApplicationContext</code> s and <code class="literal">WebApplicationContext</code> s as well as caching of those contexts. Support for the caching of loaded contexts is important, because startup time can become an issue&#x2009;&#x2009;not because of the overhead of Spring itself, but because the objects instantiated by the Spring container take time to instantiate. For example, a project with 50 to 100 Hibernate mapping files might take 10 to 20 seconds to load the mapping files, and incurring that cost before running every test in every test fixture leads to slower overall test runs that reduce developer productivity.</p> 
     <p>Test classes typically declare either an array of <span class="emphasis"><em>resource locations</em></span> for XML configuration metadata&#x2009;&#x2009;often in the classpath&#x2009;&#x2009;or an array of <span class="emphasis"><em>annotated classes</em></span> that is used to configure the application. These locations or classes are the same as or similar to those specified in <code class="literal">web.xml</code> or other deployment configuration files.</p> 
     <p>By default, once loaded, the configured <code class="literal">ApplicationContext</code> is reused for each test. Thus the setup cost is incurred only once per test suite, and subsequent test execution is much faster. In this context, the term <span class="emphasis"><em>test suite</em></span> means all tests run in the same JVM&#x2009;&#x2009;for example, all tests run from an Ant, Maven, or Gradle build for a given project or module. In the unlikely case that a test corrupts the application context and requires reloading&#x2009;&#x2009;for example, by modifying a bean definition or the state of an application object&#x2009;&#x2009;the TestContext framework can be configured to reload the configuration and rebuild the application context before executing the next test.</p> 
     <p>See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-ctx-management" title="Context management">the section called Context management</a> and <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-ctx-management-caching" title="Context caching">the section called Context caching</a> with the TestContext framework.</p> 
    </div> 
    <div class="section" title="Dependency Injection of test fixtures">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="testing-fixture-di"></a>Dependency Injection of test fixtures</h4>
       </div>
      </div>
     </div> 
     <p>When the TestContext framework loads your application context, it can optionally configure instances of your test classes via Dependency Injection. This provides a convenient mechanism for setting up test fixtures using preconfigured beans from your application context. A strong benefit here is that you can reuse application contexts across various testing scenarios (e.g., for configuring Spring-managed object graphs, transactional proxies, <code class="literal">DataSource</code> s, etc.), thus avoiding the need to duplicate complex test fixture setup for individual test cases.</p> 
     <p>As an example, consider the scenario where we have a class, <code class="literal">HibernateTitleRepository</code>, that implements data access logic for a <code class="literal">Title</code> domain entity. We want to write integration tests that test the following areas:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> The Spring configuration: basically, is everything related to the configuration of the <code class="literal">HibernateTitleRepository</code> bean correct and present? </li>
       <li class="listitem"> The Hibernate mapping file configuration: is everything mapped correctly, and are the correct lazy-loading settings in place? </li>
       <li class="listitem"> The logic of the <code class="literal">HibernateTitleRepository</code>: does the configured instance of this class perform as anticipated? </li>
      </ul>
     </div> 
     <p>See dependency injection of test fixtures with the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-fixture-di" title="Dependency injection of test fixtures">TestContext framework</a>.</p> 
    </div> 
    <div class="section" title="Transaction management">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="testing-tx"></a>Transaction management</h4>
       </div>
      </div>
     </div> 
     <p>One common issue in tests that access a real database is their effect on the state of the persistence store. Even when youre using a development database, changes to the state may affect future tests. Also, many operations&#x2009;&#x2009;such as inserting or modifying persistent data&#x2009;&#x2009;cannot be performed (or verified) outside a transaction.</p> 
     <p>The TestContext framework addresses this issue. By default, the framework will create and roll back a transaction for each test. You simply write code that can assume the existence of a transaction. If you call transactionally proxied objects in your tests, they will behave correctly, according to their configured transactional semantics. In addition, if a test method deletes the contents of selected tables while running within the transaction managed for the test, the transaction will roll back by default, and the database will return to its state prior to execution of the test. Transactional support is provided to a test via a <code class="literal">PlatformTransactionManager</code> bean defined in the tests application context.</p> 
     <p>If you want a transaction to commit&#x2009;&#x2009;unusual, but occasionally useful when you want a particular test to populate or modify the database&#x2009;&#x2009;the TestContext framework can be instructed to cause the transaction to commit instead of roll back via the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#integration-testing-annotations" title="10.3.4&nbsp;Annotations"><code class="literal">@TransactionConfiguration</code></a> and <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#integration-testing-annotations" title="10.3.4&nbsp;Annotations"><code class="literal">@Rollback</code></a> annotations.</p> 
     <p>See transaction management with the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-tx" title="Transaction management">TestContext framework</a>.</p> 
    </div> 
    <div class="section" title="Support classes for integration testing">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="testing-support-classes"></a>Support classes for integration testing</h4>
       </div>
      </div>
     </div> 
     <p>The Spring TestContext Framework provides several <code class="literal">abstract</code> support classes that simplify the writing of integration tests. These base test classes provide well-defined hooks into the testing framework as well as convenient instance variables and methods, which enable you to access:</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> The <code class="literal">ApplicationContext</code>, for performing explicit bean lookups or testing the state of the context as a whole. </li>
       <li class="listitem"> A <code class="literal">JdbcTemplate</code>, for executing SQL statements to query the database. Such queries can be used to confirm database state both <span class="emphasis"><em>prior to</em></span> and <span class="emphasis"><em>after</em></span> execution of database-related application code, and Spring ensures that such queries run in the scope of the same transaction as the application code. When used in conjunction with an ORM tool, be sure to avoid <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#">false positives</a>. </li>
      </ul>
     </div> 
     <p>In addition, you may want to create your own custom, application-wide superclass with instance variables and methods specific to your project.</p> 
     <p>See support classes for the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-support-classes" title="TestContext Framework support classes">TestContext framework</a>.</p> 
    </div> 
   </div> 
   <div class="section" title="10.3.3&nbsp;JDBC Testing Support">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="integration-testing-support-jdbc"></a>10.3.3&nbsp;JDBC Testing Support</h3>
      </div>
     </div>
    </div> 
    <p>The <code class="literal">org.springframework.test.jdbc</code> package contains <code class="literal">JdbcTestUtils</code>, which is a collection of JDBC related utility functions intended to simplify standard database testing scenarios. <span class="emphasis"><em>Note that <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-support-classes-junit4" title="JUnit support classes"><code class="literal">AbstractTransactionalJUnit4SpringContextTests</code></a> and <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-support-classes-testng" title="TestNG support classes"><code class="literal">AbstractTransactionalTestNGSpringContextTests</code></a> provide convenience methods which delegate to <code class="literal">JdbcTestUtils</code> internally.</em></span></p> 
    <p>The <code class="literal">spring-jdbc</code> module provides support for configuring and launching an embedded database which can be used in integration tests that interact with a database. For details, see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#jdbc-embedded-database-support" title="13.8&nbsp;Embedded database support">Section&nbsp;13.8, Embedded database support</a> and <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#jdbc-embedded-database-dao-testing" title="13.8.8&nbsp;Testing data access logic with an embedded database">Section&nbsp;13.8.8, Testing data access logic with an embedded database</a>.</p> 
   </div> 
   <div class="section" title="10.3.4&nbsp;Annotations">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="integration-testing-annotations"></a>10.3.4&nbsp;Annotations</h3>
      </div>
     </div>
    </div> 
    <div class="section" title="Spring Testing Annotations">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="integration-testing-annotations-spring"></a>Spring Testing Annotations</h4>
       </div>
      </div>
     </div> 
     <p>The Spring Framework provides the following set of <span class="emphasis"><em>Spring-specific</em></span> annotations that you can use in your unit and integration tests in conjunction with the TestContext framework. Refer to the respective Javadoc for further information, including default attribute values, attribute aliases, and so on.</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> <p class="simpara"><code class="literal">@ContextConfiguration</code></p> <p class="simpara">Defines class-level metadata that is used to determine how to load and configure an <code class="literal">ApplicationContext</code> for integration tests. Specifically, <code class="literal">@ContextConfiguration</code> declares <span class="emphasis"><em>either</em></span> the application context resource <code class="literal">locations</code> <span class="emphasis"><em>or</em></span> the annotated <code class="literal">classes</code> that will be used to load the context.</p> <p class="simpara">Resource locations are typically XML configuration files located in the classpath; whereas, annotated classes are typically <code class="literal">@Configuration</code> classes. However, resource locations can also refer to files in the file system, and annotated classes can be component classes, etc.</p> <pre class="programlisting"><span class="strong"><strong>@ContextConfiguration</strong></span>(<span class="hl-string">&quot;/test-config.xml&quot;</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> XmlApplicationContextTests {
    <span class="hl-comment">// class body...</span>
}</pre> <pre class="programlisting"><span class="strong"><strong>@ContextConfiguration</strong></span>(<span class="strong"><strong>classes</strong></span> = TestConfig.<span class="hl-keyword">class</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ConfigClassApplicationContextTests {
    <span class="hl-comment">// class body...</span>
}</pre> <p class="simpara">As an alternative or in addition to declaring resource locations or annotated classes, <code class="literal">@ContextConfiguration</code> may be used to declare <code class="literal">ApplicationContextInitializer</code> classes.</p> <pre class="programlisting"><span class="strong"><strong>@ContextConfiguration</strong></span>(<span class="strong"><strong>initializers</strong></span> = CustomContextIntializer.<span class="hl-keyword">class</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ContextInitializerTests {
    <span class="hl-comment">// class body...</span>
}</pre> <p class="simpara"><code class="literal">@ContextConfiguration</code> may optionally be used to declare the <code class="literal">ContextLoader</code> strategy as well. Note, however, that you typically do not need to explicitly configure the loader since the default loader supports either resource <code class="literal">locations</code> or annotated <code class="literal">classes</code> as well as <code class="literal">initializers</code>.</p> <pre class="programlisting"><span class="strong"><strong>@ContextConfiguration</strong></span>(<span class="strong"><strong>locations</strong></span> = <span class="hl-string">&quot;/test-context.xml&quot;</span>, <span class="strong"><strong>loader</strong></span> = CustomContextLoader.<span class="hl-keyword">class</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CustomLoaderXmlApplicationContextTests {
    <span class="hl-comment">// class body...</span>
}</pre> 
        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
         <table border="0" summary="Note">
          <tbody>
           <tr>
            <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
            <th align="left">Note</th>
           </tr>
           <tr>
            <td align="left" valign="top"> <p><code class="literal">@ContextConfiguration</code> provides support for <span class="emphasis"><em>inheriting</em></span> resource locations or configuration classes as well as context initializers declared by superclasses by default.</p> </td>
           </tr>
          </tbody>
         </table>
        </div> <p class="simpara">See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-ctx-management" title="Context management">the section called Context management</a> and the Javadoc for <code class="literal">@ContextConfiguration</code> for further details.</p> </li>
       <li class="listitem"> <p class="simpara"><code class="literal">@WebAppConfiguration</code></p> <p class="simpara">A class-level annotation that is used to declare that the <code class="literal">ApplicationContext</code> loaded for an integration test should be a <code class="literal">WebApplicationContext</code>. The mere presence of <code class="literal">@WebAppConfiguration</code> on a test class ensures that a <code class="literal">WebApplicationContext</code> will be loaded for the test, using the default value of <code class="literal">&quot;file:src/main/webapp&quot;</code> for the path to the root of the web application (i.e., the <span class="emphasis"><em>resource base path</em></span>). The resource base path is used behind the scenes to create a <code class="literal">MockServletContext</code> which serves as the <code class="literal">ServletContext</code> for the tests <code class="literal">WebApplicationContext</code>.</p> <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></i>
<span class="strong"><strong>@WebAppConfiguration</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebAppTests {
    <span class="hl-comment">// class body...</span>
}</pre> <p class="simpara">To override the default, specify a different base resource path via the <span class="emphasis"><em>implicit</em></span> <code class="literal">value</code> attribute. Both <code class="literal">classpath:</code> and <code class="literal">file:</code> resource prefixes are supported. If no resource prefix is supplied the path is assumed to be a file system resource.</p> <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></i>
<span class="strong"><strong>@WebAppConfiguration(&quot;classpath:test-web-resources&quot;)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebAppTests {
    <span class="hl-comment">// class body...</span>
}</pre> <p class="simpara">Note that <code class="literal">@WebAppConfiguration</code> must be used in conjunction with <code class="literal">@ContextConfiguration</code>, either within a single test class or within a test class hierarchy. See the Javadoc for <code class="literal">@WebAppConfiguration</code> for further details.</p> </li>
       <li class="listitem"> <p class="simpara"><code class="literal">@ContextHierarchy</code></p> <p class="simpara">A class-level annotation that is used to define a hierarchy of <code class="literal">ApplicationContext</code> s for integration tests. <code class="literal">@ContextHierarchy</code> should be declared with a list of one or more <code class="literal">@ContextConfiguration</code> instances, each of which defines a level in the context hierarchy. The following examples demonstrate the use of <code class="literal">@ContextHierarchy</code> within a single test class; however, <code class="literal">@ContextHierarchy</code> can also be used within a test class hierarchy.</p> <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@ContextHierarchy({ @ContextConfiguration(&quot;/parent-config.xml&quot;), @ContextConfiguration(&quot;/child-config.xml&quot;) })</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ContextHierarchyTests {
    <span class="hl-comment">// class body...</span>
}</pre> <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@WebAppConfiguration</span></i>
<i><span class="hl-annotation" style="color: gray">@ContextHierarchy({ @ContextConfiguration(classes = AppConfig.class), @ContextConfiguration(classes = WebConfig.class) })</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WebIntegrationTests {
    <span class="hl-comment">// class body...</span>
}</pre> <p class="simpara">If you need to merge or override the configuration for a given level of the context hierarchy within a test class hierarchy, you must explicitly name that level by supplying the same value to the <code class="literal">name</code> attribute in <code class="literal">@ContextConfiguration</code> at each corresponding level in the class hierarchy. See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-ctx-management-ctx-hierarchies" title="Context hierarchies">the section called Context hierarchies</a> and the Javadoc for <code class="literal">@ContextHierarchy</code> for further examples.</p> </li>
       <li class="listitem"> <p class="simpara"><code class="literal">@ActiveProfiles</code></p> <p class="simpara">A class-level annotation that is used to declare which <span class="emphasis"><em>bean definition profiles</em></span> should be active when loading an <code class="literal">ApplicationContext</code> for test classes.</p> <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></i>
<span class="strong"><strong>@ActiveProfiles</strong></span>(<span class="hl-string">&quot;dev&quot;</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DeveloperTests {
    <span class="hl-comment">// class body...</span>
}</pre> <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></i>
<span class="strong"><strong>@ActiveProfiles</strong></span>({<span class="hl-string">&quot;dev&quot;</span>, <span class="hl-string">&quot;integration&quot;</span>})
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> DeveloperIntegrationTests {
    <span class="hl-comment">// class body...</span>
}</pre> 
        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
         <table border="0" summary="Note">
          <tbody>
           <tr>
            <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
            <th align="left">Note</th>
           </tr>
           <tr>
            <td align="left" valign="top"> <p><code class="literal">@ActiveProfiles</code> provides support for <span class="emphasis"><em>inheriting</em></span> active bean definition profiles declared by superclasses by default. It is also possible to resolve active bean definition profiles programmatically by implementing a custom <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-ctx-management-env-profiles-ActiveProfilesResolver"><code class="literal">ActiveProfilesResolver</code></a> and registering it via the <code class="literal">resolver</code> attribute of <code class="literal">@ActiveProfiles</code>.</p> </td>
           </tr>
          </tbody>
         </table>
        </div> <p class="simpara">See <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-ctx-management-env-profiles" title="Context configuration with environment profiles">the section called Context configuration with environment profiles</a> and the Javadoc for <code class="literal">@ActiveProfiles</code> for examples and further details.</p> </li>
       <li class="listitem"> <p class="simpara"><code class="literal">@DirtiesContext</code></p> <p class="simpara">Indicates that the underlying Spring <code class="literal">ApplicationContext</code> has been <span class="emphasis"><em>dirtied</em></span> during the execution of a test (i.e., modified or corrupted in some manner&#x2009;&#x2009;for example, by changing the state of a singleton bean) and should be closed, regardless of whether the test passed. When an application context is marked <span class="emphasis"><em>dirty</em></span>, it is removed from the testing frameworks cache and closed. As a consequence, the underlying Spring container will be rebuilt for any subsequent test that requires a context with the same configuration metadata.</p> <p class="simpara"><code class="literal">@DirtiesContext</code> can be used as both a class-level and method-level annotation within the same test class. In such scenarios, the <code class="literal">ApplicationContext</code> is marked as <span class="emphasis"><em>dirty</em></span> after any such annotated method as well as after the entire class. If the <code class="literal">ClassMode</code> is set to <code class="literal">AFTER_EACH_TEST_METHOD</code>, the context is marked dirty after each test method in the class.</p> <p class="simpara">The following examples explain when the context would be dirtied for various configuration scenarios:</p> 
        <div class="itemizedlist">
         <ul class="itemizedlist" type="circle">
          <li class="listitem"> <p class="simpara">After the current test class, when declared on a class with class mode set to <code class="literal">AFTER_CLASS</code> (i.e., the default class mode).</p> <pre class="programlisting"><span class="strong"><strong>@DirtiesContext</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ContextDirtyingTests {
    <span class="hl-comment">// some tests that result in the Spring container being dirtied</span>
}</pre> </li>
          <li class="listitem"> <p class="simpara">After each test method in the current test class, when declared on a class with class mode set to <code class="literal">AFTER_EACH_TEST_METHOD.</code></p> <pre class="programlisting"><span class="strong"><strong>@DirtiesContext</strong></span>(<span class="strong"><strong>classMode</strong></span> = ClassMode.AFTER_EACH_TEST_METHOD)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ContextDirtyingTests {
    <span class="hl-comment">// some tests that result in the Spring container being dirtied</span>
}</pre> </li>
          <li class="listitem"> <p class="simpara">After the current test, when declared on a method.</p> <pre class="programlisting"><span class="strong"><strong>@DirtiesContext</strong></span>
<i><span class="hl-annotation" style="color: gray">@Test</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testProcessWhichDirtiesAppCtx() {
    <span class="hl-comment">// some logic that results in the Spring container being dirtied</span>
}</pre> <p class="simpara">If <code class="literal">@DirtiesContext</code> is used in a test whose context is configured as part of a context hierarchy via <code class="literal">@ContextHierarchy</code>, the <code class="literal">hierarchyMode</code> flag can be used to control how the context cache is cleared. By default an <span class="emphasis"><em>exhaustive</em></span> algorithm will be used that clears the context cache including not only the current level but also all other context hierarchies that share an ancestor context common to the current test; all <code class="literal">ApplicationContext</code> s that reside in a sub-hierarchy of the common ancestor context will be removed from the context cache and closed. If the <span class="emphasis"><em>exhaustive</em></span> algorithm is overkill for a particular use case, the simpler <span class="emphasis"><em>current level</em></span> algorithm can be specified instead, as seen below.</p> <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@ContextHierarchy({ @ContextConfiguration(&quot;/parent-config.xml&quot;), @ContextConfiguration(&quot;/child-config.xml&quot;) })</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BaseTests {
    <span class="hl-comment">// class body...</span>
}

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExtendedTests <span class="hl-keyword">extends</span> BaseTests {

    <i><span class="hl-annotation" style="color: gray">@Test</span></i>
    @DirtiesContext(<span class="strong"><strong>hierarchyMode = HierarchyMode.CURRENT_LEVEL</strong></span>)
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> test() {
        <span class="hl-comment">// some logic that results in the child context being dirtied</span>
    }
}</pre> </li>
         </ul>
        </div> <p class="simpara">For further details regarding the <code class="literal">EXHAUSTIVE</code> and <code class="literal">CURRENT_LEVEL</code> algorithms see the Javadoc for <code class="literal">DirtiesContext.HierarchyMode</code>.</p> </li>
       <li class="listitem"> <p class="simpara"><code class="literal">@TestExecutionListeners</code></p> <p class="simpara">Defines class-level metadata for configuring which <code class="literal">TestExecutionListener</code> s should be registered with the <code class="literal">TestContextManager</code>. Typically, <code class="literal">@TestExecutionListeners</code> is used in conjunction with <code class="literal">@ContextConfiguration</code>.</p> <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></i>
<span class="strong"><strong>@TestExecutionListeners</strong></span>({CustomTestExecutionListener.<span class="hl-keyword">class</span>, AnotherTestExecutionListener.<span class="hl-keyword">class</span>})
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CustomTestExecutionListenerTests {
    <span class="hl-comment">// class body...</span>
}</pre> <p class="simpara"><code class="literal">@TestExecutionListeners</code> supports <span class="emphasis"><em>inherited</em></span> listeners by default. See the Javadoc for an example and further details.</p> </li>
       <li class="listitem"> <p class="simpara"><code class="literal">@TransactionConfiguration</code></p> <p class="simpara">Defines class-level metadata for configuring transactional tests. Specifically, the bean name of the <code class="literal">PlatformTransactionManager</code> that should be used to drive transactions can be explicitly specified if there are multiple beans of type <code class="literal">PlatformTransactionManager</code> in the tests <code class="literal">ApplicationContext</code> and if the bean name of the desired <code class="literal">PlatformTransactionManager</code> is not &quot;transactionManager&quot;. In addition, you can change the <code class="literal">defaultRollback</code> flag to <code class="literal">false</code>. Typically, <code class="literal">@TransactionConfiguration</code> is used in conjunction with <code class="literal">@ContextConfiguration</code>.</p> <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></i>
<span class="strong"><strong>@TransactionConfiguration</strong></span>(<span class="strong"><strong>transactionManager</strong></span> = <span class="hl-string">&quot;txMgr&quot;</span>, <span class="strong"><strong>defaultRollback</strong></span> = false)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CustomConfiguredTransactionalTests {
    <span class="hl-comment">// class body...</span>
}</pre> 
        <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
         <table border="0" summary="Note">
          <tbody>
           <tr>
            <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
            <th align="left">Note</th>
           </tr>
           <tr>
            <td align="left" valign="top"> <p>If the default conventions are sufficient for your test configuration, you can avoid using <code class="literal">@TransactionConfiguration</code> altogether. In other words, if you have only one transaction manger&#x2009;&#x2009;or if you have multiple transaction mangers but the transaction manager for tests is named &quot;transactionManager&quot; or specified via a <code class="literal">TransactionManagementConfigurer</code>&#x2009;&#x2009;and if you want transactions to roll back automatically, then there is no need to annotate your test class with <code class="literal">@TransactionConfiguration</code>.</p> </td>
           </tr>
          </tbody>
         </table>
        </div> </li>
       <li class="listitem"> <p class="simpara"><code class="literal">@Rollback</code></p> <p class="simpara">Indicates whether the transaction for the annotated test method should be <span class="emphasis"><em>rolled back</em></span> after the test method has completed. If <code class="literal">true</code>, the transaction is rolled back; otherwise, the transaction is committed. Use <code class="literal">@Rollback</code> to override the default rollback flag configured at the class level.</p> <pre class="programlisting"><span class="strong"><strong>@Rollback</strong></span>(false)
<i><span class="hl-annotation" style="color: gray">@Test</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testProcessWithoutRollback() {
    <span class="hl-comment">// ...</span>
}</pre> </li>
       <li class="listitem"> <p class="simpara"><code class="literal">@BeforeTransaction</code></p> <p class="simpara">Indicates that the annotated <code class="literal">public void</code> method should be executed <span class="emphasis"><em>before</em></span> a transaction is started for test methods configured to run within a transaction via the <code class="literal">@Transactional</code> annotation.</p> <pre class="programlisting"><span class="strong"><strong>@BeforeTransaction</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> beforeTransaction() {
    <span class="hl-comment">// logic to be executed before a transaction is started</span>
}</pre> </li>
       <li class="listitem"> <p class="simpara"><code class="literal">@AfterTransaction</code></p> <p class="simpara">Indicates that the annotated <code class="literal">public void</code> method should be executed <span class="emphasis"><em>after</em></span> a transaction has ended for test methods configured to run within a transaction via the <code class="literal">@Transactional</code> annotation.</p> <pre class="programlisting"><span class="strong"><strong>@AfterTransaction</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> afterTransaction() {
    <span class="hl-comment">// logic to be executed after a transaction has ended</span>
}</pre> </li>
      </ul>
     </div> 
    </div> 
    <div class="section" title="Standard Annotation Support">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="integration-testing-annotations-standard"></a>Standard Annotation Support</h4>
       </div>
      </div>
     </div> 
     <p>The following annotations are supported with standard semantics for all configurations of the Spring TestContext Framework. Note that these annotations are not specific to tests and can be used anywhere in the Spring Framework.</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> <code class="literal">@Autowired</code> </li>
       <li class="listitem"> <code class="literal">@Qualifier</code> </li>
       <li class="listitem"> <code class="literal">@Resource</code> (javax.annotation) <span class="emphasis"><em>if JSR-250 is present</em></span> </li>
       <li class="listitem"> <code class="literal">@Inject</code> (javax.inject) <span class="emphasis"><em>if JSR-330 is present</em></span> </li>
       <li class="listitem"> <code class="literal">@Named</code> (javax.inject) <span class="emphasis"><em>if JSR-330 is present</em></span> </li>
       <li class="listitem"> <code class="literal">@PersistenceContext</code> (javax.persistence) <span class="emphasis"><em>if JPA is present</em></span> </li>
       <li class="listitem"> <code class="literal">@PersistenceUnit</code> (javax.persistence) <span class="emphasis"><em>if JPA is present</em></span> </li>
       <li class="listitem"> <code class="literal">@Required</code> </li>
       <li class="listitem"> <code class="literal">@Transactional</code> </li>
      </ul>
     </div> 
     <div class="note" title="JSR-250 Lifecycle Annotations" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note: JSR-250 Lifecycle Annotations">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">JSR-250 Lifecycle Annotations</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>In the Spring TestContext Framework <code class="literal">@PostConstruct</code> and <code class="literal">@PreDestroy</code> may be used with standard semantics on any application components configured in the <code class="literal">ApplicationContext</code>; however, these lifecycle annotations have limited usage within an actual test class.</p> <p>If a method within a test class is annotated with <code class="literal">@PostConstruct</code>, that method will be executed before any <span class="emphasis"><em>before</em></span> methods of the underlying test framework (e.g., methods annotated with JUnits <code class="literal">@Before</code>), and that will apply for every test method in the test class. On the other hand, if a method within a test class is annotated with <code class="literal">@PreDestroy</code>, that method will <span class="emphasis"><em>never</em></span> be executed. Within a test class it is therefore recommended to use test lifecycle callbacks from the underlying test framework instead of <code class="literal">@PostConstruct</code> and <code class="literal">@PreDestroy</code>.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="Spring JUnit Testing Annotations">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="integration-testing-annotations-junit"></a>Spring JUnit Testing Annotations</h4>
       </div>
      </div>
     </div> 
     <p>The following annotations are <span class="emphasis"><em>only</em></span> supported when used in conjunction with the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-junit4-runner" title="Spring JUnit Runner">SpringJUnit4ClassRunner</a> or the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-support-classes-junit4" title="JUnit support classes">JUnit</a> support classes.</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> <p class="simpara"><code class="literal">@IfProfileValue</code></p> <p class="simpara">Indicates that the annotated test is enabled for a specific testing environment. If the configured <code class="literal">ProfileValueSource</code> returns a matching <code class="literal">value</code> for the provided <code class="literal">name</code>, the test is enabled. This annotation can be applied to an entire class or to individual methods. Class-level usage overrides method-level usage.</p> <pre class="programlisting"><span class="strong"><strong>@IfProfileValue</strong></span>(<span class="strong"><strong>name</strong></span>=<span class="hl-string">&quot;java.vendor&quot;</span>, <span class="strong"><strong>value</strong></span>=<span class="hl-string">&quot;Oracle Corporation&quot;</span>)
<i><span class="hl-annotation" style="color: gray">@Test</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testProcessWhichRunsOnlyOnOracleJvm() {
    <span class="hl-comment">// some logic that should run only on Java VMs from Oracle Corporation</span>
}</pre> <p class="simpara">Alternatively, you can configure <code class="literal">@IfProfileValue</code> with a list of <code class="literal">values</code> (with <span class="emphasis"><em>OR</em></span> semantics) to achieve TestNG-like support for <span class="emphasis"><em>test groups</em></span> in a JUnit environment. Consider the following example:</p> <pre class="programlisting"><span class="strong"><strong>@IfProfileValue</strong></span>(<span class="strong"><strong>name</strong></span>=<span class="hl-string">&quot;test-groups&quot;</span>, <span class="strong"><strong>values</strong></span>={<span class="hl-string">&quot;unit-tests&quot;</span>, <span class="hl-string">&quot;integration-tests&quot;</span>})
<i><span class="hl-annotation" style="color: gray">@Test</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testProcessWhichRunsForUnitOrIntegrationTestGroups() {
    <span class="hl-comment">// some logic that should run only for unit and integration test groups</span>
}</pre> </li>
       <li class="listitem"> <p class="simpara"><code class="literal">@ProfileValueSourceConfiguration</code></p> <p class="simpara">Class-level annotation that specifies what type of <code class="literal">ProfileValueSource</code> to use when retrieving <span class="emphasis"><em>profile values</em></span> configured through the <code class="literal">@IfProfileValue</code> annotation. If <code class="literal">@ProfileValueSourceConfiguration</code> is not declared for a test, <code class="literal">SystemProfileValueSource</code> is used by default.</p> <pre class="programlisting"><span class="strong"><strong>@ProfileValueSourceConfiguration</strong></span>(CustomProfileValueSource.<span class="hl-keyword">class</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> CustomProfileValueSourceTests {
    <span class="hl-comment">// class body...</span>
}</pre> </li>
       <li class="listitem"> <p class="simpara"><code class="literal">@Timed</code></p> <p class="simpara">Indicates that the annotated test method must finish execution in a specified time period (in milliseconds). If the text execution time exceeds the specified time period, the test fails.</p> <p class="simpara">The time period includes execution of the test method itself, any repetitions of the test (see <code class="literal">@Repeat</code>), as well as any <span class="emphasis"><em>set up</em></span> or <span class="emphasis"><em>tear down</em></span> of the test fixture.</p> <pre class="programlisting"><span class="strong"><strong>@Timed</strong></span>(millis=<span class="hl-number">1000</span>)
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testProcessWithOneSecondTimeout() {
    <span class="hl-comment">// some logic that should not take longer than 1 second to execute</span>
}</pre> <p class="simpara">Springs <code class="literal">@Timed</code> annotation has different semantics than JUnits <code class="literal">@Test(timeout=...)</code> support. Specifically, due to the manner in which JUnit handles test execution timeouts (that is, by executing the test method in a separate <code class="literal">Thread</code>), <code class="literal">@Test(timeout=...)</code> applies to <span class="emphasis"><em>each iteration</em></span> in the case of repetitions and preemptively fails the test if the test takes too long. Springs <code class="literal">@Timed</code>, on the other hand, times the <span class="emphasis"><em>total</em></span> test execution time (including all repetitions) and does not preemptively fail the test but rather waits for the test to complete before failing.</p> </li>
       <li class="listitem"> <p class="simpara"><code class="literal">@Repeat</code></p> <p class="simpara">Indicates that the annotated test method must be executed repeatedly. The number of times that the test method is to be executed is specified in the annotation.</p> <p class="simpara">The scope of execution to be repeated includes execution of the test method itself as well as any <span class="emphasis"><em>set up</em></span> or <span class="emphasis"><em>tear down</em></span> of the test fixture.</p> <pre class="programlisting"><span class="strong"><strong>@Repeat</strong></span>(<span class="hl-number">10</span>)
<i><span class="hl-annotation" style="color: gray">@Test</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testProcessRepeatedly() {
    <span class="hl-comment">// ...</span>
}</pre> </li>
      </ul>
     </div> 
    </div> 
    <div class="section" title="Meta-Annotation Support for Testing">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="integration-testing-annotations-meta"></a>Meta-Annotation Support for Testing</h4>
       </div>
      </div>
     </div> 
     <p>As of Spring Framework 4.0, it is now possible to use test-related annotations as <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-meta-annotations" title="4.10.2&nbsp;Meta-annotations">meta-annotations</a> in order to create custom <span class="emphasis"><em>composed annotations</em></span> and reduce configuration duplication across tests.</p> 
     <p>Each of the following may be used as meta-annotations in conjunction with the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-framework" title="10.3.5&nbsp;Spring TestContext Framework">TestContext framework</a>.</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> <code class="literal">@ContextConfiguration</code> </li>
       <li class="listitem"> <code class="literal">@ContextHierarchy</code> </li>
       <li class="listitem"> <code class="literal">@ActiveProfiles</code> </li>
       <li class="listitem"> <code class="literal">@DirtiesContext</code> </li>
       <li class="listitem"> <code class="literal">@WebAppConfiguration</code> </li>
       <li class="listitem"> <code class="literal">@TestExecutionListeners</code> </li>
       <li class="listitem"> <code class="literal">@Transactional</code> </li>
       <li class="listitem"> <code class="literal">@BeforeTransaction</code> </li>
       <li class="listitem"> <code class="literal">@AfterTransaction</code> </li>
       <li class="listitem"> <code class="literal">@TransactionConfiguration</code> </li>
       <li class="listitem"> <code class="literal">@Rollback</code> </li>
       <li class="listitem"> <code class="literal">@Repeat</code> </li>
       <li class="listitem"> <code class="literal">@Timed</code> </li>
       <li class="listitem"> <code class="literal">@IfProfileValue</code> </li>
       <li class="listitem"> <code class="literal">@ProfileValueSourceConfiguration</code> </li>
      </ul>
     </div> 
     <p>For example, if we discover that we are repeating the following configuration across our JUnit-based test suite</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<i><span class="hl-annotation" style="color: gray">@ContextConfiguration({&quot;/app-config.xml&quot;, &quot;/test-data-access-config.xml&quot;})</span></i>
<i><span class="hl-annotation" style="color: gray">@ActiveProfiles(&quot;dev&quot;)</span></i>
<i><span class="hl-annotation" style="color: gray">@Transactional</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> OrderRepositoryTests { }

<i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<i><span class="hl-annotation" style="color: gray">@ContextConfiguration({&quot;/app-config.xml&quot;, &quot;/test-data-access-config.xml&quot;})</span></i>
<i><span class="hl-annotation" style="color: gray">@ActiveProfiles(&quot;dev&quot;)</span></i>
<i><span class="hl-annotation" style="color: gray">@Transactional</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> UserRepositoryTests { }</pre> 
     <p>We can reduce the above duplication by introducing a custom <span class="emphasis"><em>composed annotation</em></span> that centralizes the common test configuration like this:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Target(ElementType.TYPE)</span></i>
<i><span class="hl-annotation" style="color: gray">@Retention(RetentionPolicy.RUNTIME)</span></i>
<i><span class="hl-annotation" style="color: gray">@ContextConfiguration({&quot;/app-config.xml&quot;, &quot;/test-data-access-config.xml&quot;})</span></i>
<i><span class="hl-annotation" style="color: gray">@ActiveProfiles(&quot;dev&quot;)</span></i>
<i><span class="hl-annotation" style="color: gray">@Transactional</span></i>
<span class="hl-keyword">public</span> <i><span class="hl-annotation" style="color: gray">@interface</span></i> TransactionalDevTest { }</pre> 
     <p>Then we can use our custom <code class="literal">@TransactionalDevTest</code> annotation to simplify the configuration of individual test classes as follows:</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<i><span class="hl-annotation" style="color: gray">@TransactionalDevTest</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> OrderRepositoryTests { }

<i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<i><span class="hl-annotation" style="color: gray">@TransactionalDevTest</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> UserRepositoryTests { }</pre> 
    </div> 
   </div> 
   <div class="section" title="10.3.5&nbsp;Spring TestContext Framework">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="testcontext-framework"></a>10.3.5&nbsp;Spring TestContext Framework</h3>
      </div>
     </div>
    </div> 
    <p>The <span class="emphasis"><em>Spring TestContext Framework</em></span> (located in the <code class="literal">org.springframework.test.context</code> package) provides generic, annotation-driven unit and integration testing support that is agnostic of the testing framework in use. The TestContext framework also places a great deal of importance on <span class="emphasis"><em>convention over configuration</em></span> with reasonable defaults that can be overridden through annotation-based configuration.</p> 
    <p>In addition to generic testing infrastructure, the TestContext framework provides explicit support for JUnit and TestNG in the form of <code class="literal">abstract</code> support classes. For JUnit, Spring also provides a custom JUnit <code class="literal">Runner</code> that allows one to write so-called <span class="emphasis"><em>POJO test classes</em></span>. POJO test classes are not required to extend a particular class hierarchy.</p> 
    <p>The following section provides an overview of the internals of the TestContext framework. If you are only interested in using the framework and not necessarily interested in extending it with your own custom listeners or custom loaders, feel free to go directly to the configuration (<a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-ctx-management" title="Context management">context management</a>, <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-fixture-di" title="Dependency injection of test fixtures">dependency injection</a>, <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-tx" title="Transaction management">transaction management</a>), <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-support-classes" title="TestContext Framework support classes">support classes</a>, and <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#integration-testing-annotations" title="10.3.4&nbsp;Annotations">annotation support</a> sections.</p> 
    <div class="section" title="Key abstractions">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="testcontext-key-abstractions"></a>Key abstractions</h4>
       </div>
      </div>
     </div> 
     <p>The core of the framework consists of the <code class="literal">TestContext</code> and <code class="literal">TestContextManager</code> classes and the <code class="literal">TestExecutionListener</code>, <code class="literal">ContextLoader</code>, and <code class="literal">SmartContextLoader</code> interfaces. A <code class="literal">TestContextManager</code> is created on a per-test basis (e.g., for the execution of a single test method in JUnit). The <code class="literal">TestContextManager</code> in turn manages a <code class="literal">TestContext</code> that holds the context of the current test. The <code class="literal">TestContextManager</code> also updates the state of the <code class="literal">TestContext</code> as the test progresses and delegates to <code class="literal">TestExecutionListener</code> s, which instrument the actual test execution by providing dependency injection, managing transactions, and so on. A <code class="literal">ContextLoader</code> (or <code class="literal">SmartContextLoader</code>) is responsible for loading an <code class="literal">ApplicationContext</code> for a given test class. Consult the Javadoc and the Spring test suite for further information and examples of various implementations.</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> <code class="literal">TestContext</code>: Encapsulates the context in which a test is executed, agnostic of the actual testing framework in use, and provides context management and caching support for the test instance for which it is responsible. The <code class="literal">TestContext</code> also delegates to a <code class="literal">ContextLoader</code> (or <code class="literal">SmartContextLoader</code>) to load an <code class="literal">ApplicationContext</code> if requested. </li>
       <li class="listitem"> <p class="simpara"><code class="literal">TestContextManager</code>: The main entry point into the <span class="emphasis"><em>Spring TestContext Framework</em></span>, which manages a single <code class="literal">TestContext</code> and signals events to all registered <code class="literal">TestExecutionListener</code> s at well-defined test execution points:</p> 
        <div class="itemizedlist">
         <ul class="itemizedlist" type="circle">
          <li class="listitem"> prior to any <span class="emphasis"><em>before class methods</em></span> of a particular testing framework </li>
          <li class="listitem"> test instance preparation </li>
          <li class="listitem"> prior to any <span class="emphasis"><em>before methods</em></span> of a particular testing framework </li>
          <li class="listitem"> after any <span class="emphasis"><em>after methods</em></span> of a particular testing framework </li>
          <li class="listitem"> after any <span class="emphasis"><em>after class methods</em></span> of a particular testing framework </li>
         </ul>
        </div> </li>
       <li class="listitem"> <p class="simpara"><code class="literal">TestExecutionListener</code>: Defines a <span class="emphasis"><em>listener</em></span> API for reacting to test execution events published by the <code class="literal">TestContextManager</code> with which the listener is registered.</p> <p class="simpara">Spring provides four <code class="literal">TestExecutionListener</code> implementations that are configured by default: <code class="literal">ServletTestExecutionListener</code>, <code class="literal">DependencyInjectionTestExecutionListener</code>, <code class="literal">DirtiesContextTestExecutionListener</code>, and <code class="literal">TransactionalTestExecutionListener</code>. Respectively, they support Servlet API mocks for a <code class="literal">WebApplicationContext</code>, dependency injection of the test instance, handling of the <code class="literal">@DirtiesContext</code> annotation, and transactional test execution with default rollback semantics.</p> </li>
       <li class="listitem"> <p class="simpara"><code class="literal">ContextLoader</code>: Strategy interface introduced in Spring 2.5 for loading an <code class="literal">ApplicationContext</code> for an integration test managed by the Spring TestContext Framework.</p> <p class="simpara">As of Spring 3.1, implement <code class="literal">SmartContextLoader</code> instead of this interface in order to provide support for annotated classes and active bean definition profiles.</p> </li>
       <li class="listitem"> <p class="simpara"><code class="literal">SmartContextLoader</code>: Extension of the <code class="literal">ContextLoader</code> interface introduced in Spring 3.1.</p> <p class="simpara">The <code class="literal">SmartContextLoader</code> SPI supersedes the <code class="literal">ContextLoader</code> SPI that was introduced in Spring 2.5. Specifically, a <code class="literal">SmartContextLoader</code> can choose to process resource <code class="literal">locations</code>, annotated <code class="literal">classes</code>, or context <code class="literal">initializers</code>. Furthermore, a <code class="literal">SmartContextLoader</code> can set active bean definition profiles in the context that it loads.</p> <p class="simpara">Spring provides the following implementations:</p> 
        <div class="itemizedlist">
         <ul class="itemizedlist" type="circle">
          <li class="listitem"> <code class="literal">DelegatingSmartContextLoader</code>: one of two default loaders which delegates internally to an <code class="literal">AnnotationConfigContextLoader</code> or a <code class="literal">GenericXmlContextLoader</code> depending either on the configuration declared for the test class or on the presence of default locations or default configuration classes. </li>
          <li class="listitem"> <code class="literal">WebDelegatingSmartContextLoader</code>: one of two default loaders which delegates internally to an <code class="literal">AnnotationConfigWebContextLoader</code> or a <code class="literal">GenericXmlWebContextLoader</code> depending either on the configuration declared for the test class or on the presence of default locations or default configuration classes. A web <code class="literal">ContextLoader</code> will only be used if <code class="literal">@WebAppConfiguration</code> is present on the test class. </li>
          <li class="listitem"> <code class="literal">AnnotationConfigContextLoader</code>: loads a standard <code class="literal">ApplicationContext</code> from <span class="emphasis"><em>annotated classes</em></span>. </li>
          <li class="listitem"> <code class="literal">AnnotationConfigWebContextLoader</code>: loads a <code class="literal">WebApplicationContext</code> from <span class="emphasis"><em>annotated classes</em></span>. </li>
          <li class="listitem"> <code class="literal">GenericXmlContextLoader</code>: loads a standard <code class="literal">ApplicationContext</code> from XML <span class="emphasis"><em>resource locations</em></span>. </li>
          <li class="listitem"> <code class="literal">GenericXmlWebContextLoader</code>: loads a <code class="literal">WebApplicationContext</code> from XML <span class="emphasis"><em>resource locations</em></span>. </li>
          <li class="listitem"> <code class="literal">GenericPropertiesContextLoader</code>: loads a standard <code class="literal">ApplicationContext</code> from Java Properties files. </li>
         </ul>
        </div> </li>
      </ul>
     </div> 
     <p>The following sections explain how to configure the TestContext framework through annotations and provide working examples of how to write unit and integration tests with the framework.</p> 
    </div> 
    <div class="section" title="Context management">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="testcontext-ctx-management"></a>Context management</h4>
       </div>
      </div>
     </div> 
     <p>Each <code class="literal">TestContext</code> provides context management and caching support for the test instance it is responsible for. Test instances do not automatically receive access to the configured <code class="literal">ApplicationContext</code>. However, if a test class implements the <code class="literal">ApplicationContextAware</code> interface, a reference to the <code class="literal">ApplicationContext</code> is supplied to the test instance. Note that <code class="literal">AbstractJUnit4SpringContextTests</code> and <code class="literal">AbstractTestNGSpringContextTests</code> implement <code class="literal">ApplicationContextAware</code> and therefore provide access to the <code class="literal">ApplicationContext</code> automatically.</p> 
     <div class="tip" title="@Autowired ApplicationContext" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Tip: @Autowired ApplicationContext">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
         <th align="left">@Autowired ApplicationContext</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>As an alternative to implementing the <code class="literal">ApplicationContextAware</code> interface, you can inject the application context for your test class through the <code class="literal">@Autowired</code> annotation on either a field or setter method. For example:</p> <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<i><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {

    <span class="strong"><strong>@Autowired</strong></span>
    <span class="hl-keyword">private</span> ApplicationContext applicationContext;

    <span class="hl-comment">// class body...</span>
}</pre> <p>Similarly, if your test is configured to load a <code class="literal">WebApplicationContext</code>, you can inject the web application context into your test as follows:</p> <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<span class="strong"><strong>@WebAppConfiguration</strong></span>
<i><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWebAppTest {
    <span class="strong"><strong>@Autowired</strong></span>
    <span class="hl-keyword">private</span> WebApplicationContext wac;

    <span class="hl-comment">// class body...</span>
}</pre> <p>Dependency injection via <code class="literal">@Autowired</code> is provided by the <code class="literal">DependencyInjectionTestExecutionListener</code> which is configured by default (see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-fixture-di" title="Dependency injection of test fixtures">the section called Dependency injection of test fixtures</a>).</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <p>Test classes that use the TestContext framework do not need to extend any particular class or implement a specific interface to configure their application context. Instead, configuration is achieved simply by declaring the <code class="literal">@ContextConfiguration</code> annotation at the class level. If your test class does not explicitly declare application context resource <code class="literal">locations</code> or annotated <code class="literal">classes</code>, the configured <code class="literal">ContextLoader</code> determines how to load a context from a default location or default configuration classes. In addition to context resource <code class="literal">locations</code> and annotated <code class="literal">classes</code>, an application context can also be configured via application context <code class="literal">initializers</code>.</p> 
     <p>The following sections explain how to configure an <code class="literal">ApplicationContext</code> via XML configuration files, annotated classes (typically <code class="literal">@Configuration</code> classes), or context initializers using Springs <code class="literal">@ContextConfiguration</code> annotation. Alternatively, you can implement and configure your own custom <code class="literal">SmartContextLoader</code> for advanced use cases.</p> 
     <div class="section" title="Context configuration with XML resources">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="testcontext-ctx-management-xml"></a>Context configuration with XML resources</h5>
        </div>
       </div>
      </div> 
      <p>To load an <code class="literal">ApplicationContext</code> for your tests using XML configuration files, annotate your test class with <code class="literal">@ContextConfiguration</code> and configure the <code class="literal">locations</code> attribute with an array that contains the resource locations of XML configuration metadata. A plain or relative path&#x2009;&#x2009;for example <code class="literal">&quot;context.xml&quot;</code>&#x2009;&#x2009;will be treated as a classpath resource that is relative to the package in which the test class is defined. A path starting with a slash is treated as an absolute classpath location, for example <code class="literal">&quot;/org/example/config.xml&quot;</code>. A path which represents a resource URL (i.e., a path prefixed with <code class="literal">classpath:</code>, <code class="literal">file:</code>, <code class="literal">http:</code>, etc.) will be used <span class="emphasis"><em>as is</em></span>.</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<span class="hl-comment">// ApplicationContext will be loaded from &quot;/app-config.xml&quot; and</span>
<span class="hl-comment">// &quot;/test-config.xml&quot; in the root of the classpath</span>
<span class="strong"><strong>@ContextConfiguration(locations={&quot;/app-config.xml&quot;, &quot;/test-config.xml&quot;})</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
    <span class="hl-comment">// class body...</span>
}</pre> 
      <p><code class="literal">@ContextConfiguration</code> supports an alias for the <code class="literal">locations</code> attribute through the standard Java <code class="literal">value</code> attribute. Thus, if you do not need to declare additional attributes in <code class="literal">@ContextConfiguration</code>, you can omit the declaration of the <code class="literal">locations</code> attribute name and declare the resource locations by using the shorthand format demonstrated in the following example.</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<span class="strong"><strong>@ContextConfiguration({&quot;/app-config.xml&quot;, &quot;/test-config.xml&quot;})</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
    <span class="hl-comment">// class body...</span>
}</pre> 
      <p>If you omit both the <code class="literal">locations</code> and <code class="literal">value</code> attributes from the <code class="literal">@ContextConfiguration</code> annotation, the TestContext framework will attempt to detect a default XML resource location. Specifically, <code class="literal">GenericXmlContextLoader</code> detects a default location based on the name of the test class. If your class is named <code class="literal">com.example.MyTest</code>, <code class="literal">GenericXmlContextLoader</code> loads your application context from <code class="literal">&quot;classpath:/com/example/MyTest-context.xml&quot;</code>.</p> 
      <pre class="programlisting"><span class="hl-keyword">package</span> com.example;

<i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<span class="hl-comment">// ApplicationContext will be loaded from</span>
<span class="hl-comment">// &quot;classpath:/com/example/MyTest-context.xml&quot;</span>
<span class="strong"><strong>@ContextConfiguration</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
    <span class="hl-comment">// class body...</span>
}</pre> 
     </div> 
     <div class="section" title="Context configuration with annotated classes">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="testcontext-ctx-management-javaconfig"></a>Context configuration with annotated classes</h5>
        </div>
       </div>
      </div> 
      <p>To load an <code class="literal">ApplicationContext</code> for your tests using <span class="emphasis"><em>annotated classes</em></span> (see <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-java" title="4.12&nbsp;Java-based container configuration">Section&nbsp;4.12, Java-based container configuration</a>), annotate your test class with <code class="literal">@ContextConfiguration</code> and configure the <code class="literal">classes</code> attribute with an array that contains references to annotated classes.</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<span class="hl-comment">// ApplicationContext will be loaded from AppConfig and TestConfig</span>
<span class="strong"><strong>@ContextConfiguration(classes = {AppConfig.class, TestConfig.class})</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
    <span class="hl-comment">// class body...</span>
}</pre> 
      <div class="tip" title="Annotated Classes" style="margin-left: 0.5in; margin-right: 0.5in;">
       <table border="0" summary="Tip: Annotated Classes">
        <tbody>
         <tr>
          <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
          <th align="left">Annotated Classes</th>
         </tr>
         <tr>
          <td align="left" valign="top"> <p>The term <span class="emphasis"><em>annotated class</em></span> can refer to any of the following.</p> 
           <div class="itemizedlist">
            <ul class="itemizedlist" type="disc">
             <li class="listitem"> A class annotated with <code class="literal">@Configuration</code> </li>
             <li class="listitem"> A component (i.e., a class annotated with <code class="literal">@Component</code>, <code class="literal">@Service</code>, <code class="literal">@Repository</code>, etc.) </li>
             <li class="listitem"> A JSR-330 compliant class that is annotated with <code class="literal">javax.inject</code> annotations </li>
             <li class="listitem"> Any other class that contains <code class="literal">@Bean</code>-methods </li>
            </ul>
           </div> <p>Consult the Javadoc for <code class="literal">@Configuration</code> and <code class="literal">@Bean</code> for further information regarding the configuration and semantics of <span class="emphasis"><em>annotated classes</em></span>, paying special attention to the discussion of <span class="emphasis"><em> <code class="literal">@Bean</code> Lite Mode</em></span>.</p> </td>
         </tr>
        </tbody>
       </table>
      </div> 
      <p>If you omit the <code class="literal">classes</code> attribute from the <code class="literal">@ContextConfiguration</code> annotation, the TestContext framework will attempt to detect the presence of default configuration classes. Specifically, <code class="literal">AnnotationConfigContextLoader</code> will detect all static inner classes of the test class that meet the requirements for configuration class implementations as specified in the Javadoc for <code class="literal">@Configuration</code>. In the following example, the <code class="literal">OrderServiceTest</code> class declares a static inner configuration class named <code class="literal">Config</code> that will be automatically used to load the <code class="literal">ApplicationContext</code> for the test class. Note that the name of the configuration class is arbitrary. In addition, a test class can contain more than one static inner configuration class if desired.</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<span class="hl-comment">// ApplicationContext will be loaded from the</span>
<span class="hl-comment">// static inner Config class</span>
<span class="strong"><strong>@ContextConfiguration</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> OrderServiceTest {

    <i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
    <span class="hl-keyword">static</span> <span class="hl-keyword">class</span> Config {

        <span class="hl-comment">// this bean will be injected into the OrderServiceTest class</span>
        <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
        <span class="hl-keyword">public</span> OrderService orderService() {
            OrderService orderService = <span class="hl-keyword">new</span> OrderServiceImpl();
            <span class="hl-comment">// set properties, etc.</span>
            <span class="hl-keyword">return</span> orderService;
        }
    }

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> OrderService orderService;

    <i><span class="hl-annotation" style="color: gray">@Test</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testOrderService() {
        <span class="hl-comment">// test the orderService</span>
    }

}</pre> 
     </div> 
     <div class="section" title="Mixing XML resources and annotated classes">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="testcontext-ctx-management-mixed-config"></a>Mixing XML resources and annotated classes</h5>
        </div>
       </div>
      </div> 
      <p>It may sometimes be desirable to mix XML resources and annotated classes (i.e., typically <code class="literal">@Configuration</code> classes) to configure an <code class="literal">ApplicationContext</code> for your tests. For example, if you use XML configuration in production, you may decide that you want to use <code class="literal">@Configuration</code> classes to configure specific Spring-managed components for your tests, or vice versa. As mentioned in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#integration-testing-annotations-spring" title="Spring Testing Annotations">the section called Spring Testing Annotations</a> the TestContext framework does not allow you to declare <span class="emphasis"><em>both</em></span> via <code class="literal">@ContextConfiguration</code>, but this does not mean that you cannot use both.</p> 
      <p>If you want to use XML <span class="emphasis"><em>and</em></span> <code class="literal">@Configuration</code> classes to configure your tests, you will have to pick one as the <span class="emphasis"><em>entry point</em></span>, and that one will have to include or import the other. For example, in XML you can include <code class="literal">@Configuration</code> classes via component scanning or define them as normal Spring beans in XML; whereas, in a <code class="literal">@Configuration</code> class you can use <code class="literal">@ImportResource</code> to import XML configuration files. Note that this behavior is semantically equivalent to how you configure your application in production: in production configuration you will define either a set of XML resource locations or a set of <code class="literal">@Configuration</code> classes that your production <code class="literal">ApplicationContext</code> will be loaded from, but you still have the freedom to include or import the other type of configuration.</p> 
     </div> 
     <div class="section" title="Context configuration with context initializers">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="testcontext-ctx-management-initializers"></a>Context configuration with context initializers</h5>
        </div>
       </div>
      </div> 
      <p>To configure an <code class="literal">ApplicationContext</code> for your tests using context initializers, annotate your test class with <code class="literal">@ContextConfiguration</code> and configure the <code class="literal">initializers</code> attribute with an array that contains references to classes that implement <code class="literal">ApplicationContextInitializer</code>. The declared context initializers will then be used to initialize the <code class="literal">ConfigurableApplicationContext</code> that is loaded for your tests. Note that the concrete <code class="literal">ConfigurableApplicationContext</code> type supported by each declared initializer must be compatible with the type of <code class="literal">ApplicationContext</code> created by the <code class="literal">SmartContextLoader</code> in use (i.e., typically a <code class="literal">GenericApplicationContext</code>). Furthermore, the order in which the initializers are invoked depends on whether they implement Springs <code class="literal">Ordered</code> interface or are annotated with Springs <code class="literal">@Order</code> annotation.</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<span class="hl-comment">// ApplicationContext will be loaded from TestConfig</span>
<span class="hl-comment">// and initialized by TestAppCtxInitializer</span>
<span class="strong"><strong>@ContextConfiguration( classes = TestConfig.class, initializers = TestAppCtxInitializer.class)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
    <span class="hl-comment">// class body...</span>
}</pre> 
      <p>It is also possible to omit the declaration of XML configuration files or annotated classes in <code class="literal">@ContextConfiguration</code> entirely and instead declare only <code class="literal">ApplicationContextInitializer</code> classes which are then responsible for registering beans in the context&#x2009;&#x2009;for example, by programmatically loading bean definitions from XML files or configuration classes.</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<span class="hl-comment">// ApplicationContext will be initialized by EntireAppInitializer</span>
<span class="hl-comment">// which presumably registers beans in the context</span>
<span class="strong"><strong>@ContextConfiguration(initializers = EntireAppInitializer.class)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyTest {
    <span class="hl-comment">// class body...</span>
}</pre> 
     </div> 
     <div class="section" title="Context configuration inheritance">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="testcontext-ctx-management-inheritance"></a>Context configuration inheritance</h5>
        </div>
       </div>
      </div> 
      <p><code class="literal">@ContextConfiguration</code> supports boolean <code class="literal">inheritLocations</code> and <code class="literal">inheritInitializers</code> attributes that denote whether resource locations or annotated classes and context initializers declared by superclasses should be <span class="emphasis"><em>inherited</em></span>. The default value for both flags is <code class="literal">true</code>. This means that a test class inherits the resource locations or annotated classes as well as the context initializers declared by any superclasses. Specifically, the resource locations or annotated classes for a test class are appended to the list of resource locations or annotated classes declared by superclasses. Similarly, the initializers for a given test class will be added to the set of initializers defined by test superclasses. Thus, subclasses have the option of <span class="emphasis"><em>extending</em></span> the resource locations, annotated classes, or context initializers.</p> 
      <p>If <code class="literal">@ContextConfiguration</code>'s <code class="literal">inheritLocations</code> or <code class="literal">inheritInitializers</code> attribute is set to <code class="literal">false</code>, the resource locations or annotated classes and the context initializers, respectively, for the test class <span class="emphasis"><em>shadow</em></span> and effectively replace the configuration defined by superclasses.</p> 
      <p>In the following example that uses XML resource locations, the <code class="literal">ApplicationContext</code> for <code class="literal">ExtendedTest</code> will be loaded from <span class="emphasis"><em>&quot;base-config.xml&quot;</em></span> <span class="emphasis"><em>and</em></span> <span class="emphasis"><em>&quot;extended-config.xml&quot;</em></span>, in that order. Beans defined in <span class="emphasis"><em>&quot;extended-config.xml&quot;</em></span> may therefore <span class="emphasis"><em>override</em></span> (i.e., replace) those defined in <span class="emphasis"><em>&quot;base-config.xml&quot;</em></span>.</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<span class="hl-comment">// ApplicationContext will be loaded from &quot;/base-config.xml&quot;</span>
<span class="hl-comment">// in the root of the classpath</span>
<span class="strong"><strong>@ContextConfiguration(&quot;/base-config.xml&quot;)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BaseTest {
    <span class="hl-comment">// class body...</span>
}

<span class="hl-comment">// ApplicationContext will be loaded from &quot;/base-config.xml&quot; and</span>
<span class="hl-comment">// &quot;/extended-config.xml&quot; in the root of the classpath</span>
<span class="strong"><strong>@ContextConfiguration(&quot;/extended-config.xml&quot;)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExtendedTest <span class="hl-keyword">extends</span> BaseTest {
    <span class="hl-comment">// class body...</span>
}</pre> 
      <p>Similarly, in the following example that uses annotated classes, the <code class="literal">ApplicationContext</code> for <code class="literal">ExtendedTest</code> will be loaded from the <code class="literal">BaseConfig</code> <span class="emphasis"><em>and</em></span> <code class="literal">ExtendedConfig</code> classes, in that order. Beans defined in <code class="literal">ExtendedConfig</code> may therefore override (i.e., replace) those defined in <code class="literal">BaseConfig</code>.</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<span class="hl-comment">// ApplicationContext will be loaded from BaseConfig</span>
<span class="strong"><strong>@ContextConfiguration(classes = BaseConfig.class)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BaseTest {
    <span class="hl-comment">// class body...</span>
}

<span class="hl-comment">// ApplicationContext will be loaded from BaseConfig and ExtendedConfig</span>
<span class="strong"><strong>@ContextConfiguration(classes = ExtendedConfig.class)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExtendedTest <span class="hl-keyword">extends</span> BaseTest {
    <span class="hl-comment">// class body...</span>
}</pre> 
      <p>In the following example that uses context initializers, the <code class="literal">ApplicationContext</code> for <code class="literal">ExtendedTest</code> will be initialized using <code class="literal">BaseInitializer</code> <span class="emphasis"><em>and</em></span> <code class="literal">ExtendedInitializer</code>. Note, however, that the order in which the initializers are invoked depends on whether they implement Springs <code class="literal">Ordered</code> interface or are annotated with Springs <code class="literal">@Order</code> annotation.</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<span class="hl-comment">// ApplicationContext will be initialized by BaseInitializer</span>
<span class="strong"><strong>@ContextConfiguration(initializers=BaseInitializer.class)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BaseTest {
    <span class="hl-comment">// class body...</span>
}

<span class="hl-comment">// ApplicationContext will be initialized by BaseInitializer</span>
<span class="hl-comment">// and ExtendedInitializer</span>
<span class="strong"><strong>@ContextConfiguration(initializers=ExtendedInitializer.class)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExtendedTest <span class="hl-keyword">extends</span> BaseTest {
    <span class="hl-comment">// class body...</span>
}</pre> 
     </div> 
     <div class="section" title="Context configuration with environment profiles">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="testcontext-ctx-management-env-profiles"></a>Context configuration with environment profiles</h5>
        </div>
       </div>
      </div> 
      <p>Spring 3.1 introduced first-class support in the framework for the notion of environments and profiles (a.k.a., <span class="emphasis"><em>bean definition profiles</em></span>), and integration tests can be configured to activate particular bean definition profiles for various testing scenarios. This is achieved by annotating a test class with the <code class="literal">@ActiveProfiles</code> annotation and supplying a list of profiles that should be activated when loading the <code class="literal">ApplicationContext</code> for the test.</p> 
      <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
       <table border="0" summary="Note">
        <tbody>
         <tr>
          <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
          <th align="left">Note</th>
         </tr>
         <tr>
          <td align="left" valign="top"> <p><code class="literal">@ActiveProfiles</code> may be used with any implementation of the new <code class="literal">SmartContextLoader</code> SPI, but <code class="literal">@ActiveProfiles</code> is not supported with implementations of the older <code class="literal">ContextLoader</code> SPI.</p> </td>
         </tr>
        </tbody>
       </table>
      </div> 
      <p>Lets take a look at some examples with XML configuration and <code class="literal">@Configuration</code> classes.</p> 
      <pre class="programlisting"><span class="hl-comment">&lt;!-- app-config.xml --&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xmlns:jdbc</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/jdbc&quot;</span>
    <span class="hl-attribute">xmlns:jee</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/jee&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;...&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;transferService&quot;</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.bank.service.internal.DefaultTransferService&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;accountRepository&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;feePolicy&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;accountRepository&quot;</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.bank.repository.internal.JdbcAccountRepository&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;dataSource&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;feePolicy&quot;</span>
        <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.bank.service.internal.ZeroFeePolicy&quot;</span><span class="hl-tag">/&gt;</span>

    <span class="hl-tag">&lt;beans</span> <span class="hl-attribute">profile</span>=<span class="hl-value">&quot;dev&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;jdbc:embedded-database</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;dataSource&quot;</span><span class="hl-tag">&gt;</span>
            <span class="hl-tag">&lt;jdbc:script</span>
                <span class="hl-attribute">location</span>=<span class="hl-value">&quot;classpath:com/bank/config/sql/schema.sql&quot;</span><span class="hl-tag">/&gt;</span>
            <span class="hl-tag">&lt;jdbc:script</span>
                <span class="hl-attribute">location</span>=<span class="hl-value">&quot;classpath:com/bank/config/sql/test-data.sql&quot;</span><span class="hl-tag">/&gt;</span>
        <span class="hl-tag">&lt;/jdbc:embedded-database&gt;</span>
    <span class="hl-tag">&lt;/beans&gt;</span>

    <span class="hl-tag">&lt;beans</span> <span class="hl-attribute">profile</span>=<span class="hl-value">&quot;production&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-tag">&lt;jee:jndi-lookup</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;dataSource&quot;</span> <span class="hl-attribute">jndi-name</span>=<span class="hl-value">&quot;java:comp/env/jdbc/datasource&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/beans&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
      <pre class="programlisting"><span class="hl-keyword">package</span> com.bank.service;

<i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<span class="hl-comment">// ApplicationContext will be loaded from &quot;classpath:/app-config.xml&quot;</span>
<i><span class="hl-annotation" style="color: gray">@ContextConfiguration(&quot;/app-config.xml&quot;)</span></i>
<i><span class="hl-annotation" style="color: gray">@ActiveProfiles(&quot;dev&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TransferServiceTest {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> TransferService transferService;

    <i><span class="hl-annotation" style="color: gray">@Test</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testTransferService() {
        <span class="hl-comment">// test the transferService</span>
    }
}</pre> 
      <p>When <code class="literal">TransferServiceTest</code> is run, its <code class="literal">ApplicationContext</code> will be loaded from the <code class="literal">app-config.xml</code> configuration file in the root of the classpath. If you inspect <code class="literal">app-config.xml</code> youll notice that the <code class="literal">accountRepository</code> bean has a dependency on a <code class="literal">dataSource</code> bean; however, <code class="literal">dataSource</code> is not defined as a top-level bean. Instead, <code class="literal">dataSource</code> is defined twice: once in the <span class="emphasis"><em>production</em></span> profile and once in the <span class="emphasis"><em>dev</em></span> profile.</p> 
      <p>By annotating <code class="literal">TransferServiceTest</code> with <code class="literal">@ActiveProfiles(&quot;dev&quot;)</code> we instruct the Spring TestContext Framework to load the <code class="literal">ApplicationContext</code> with the active profiles set to <code class="literal">{&quot;dev&quot;}</code>. As a result, an embedded database will be created, and the <code class="literal">accountRepository</code> bean will be wired with a reference to the development <code class="literal">DataSource</code>. And thats likely what we want in an integration test.</p> 
      <p>The following code listings demonstrate how to implement the same configuration and integration test but using <code class="literal">@Configuration</code> classes instead of XML.</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@Profile(&quot;dev&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> StandaloneDataConfig {

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> DataSource dataSource() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> EmbeddedDatabaseBuilder()
            .setType(EmbeddedDatabaseType.HSQL)
            .addScript(<span class="hl-string">&quot;classpath:com/bank/config/sql/schema.sql&quot;</span>)
            .addScript(<span class="hl-string">&quot;classpath:com/bank/config/sql/test-data.sql&quot;</span>)
            .build();
    }
}</pre> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<i><span class="hl-annotation" style="color: gray">@Profile(&quot;production&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> JndiDataConfig {

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> DataSource dataSource() <span class="hl-keyword">throws</span> Exception {
        Context ctx = <span class="hl-keyword">new</span> InitialContext();
        <span class="hl-keyword">return</span> (DataSource) ctx.lookup(<span class="hl-string">&quot;java:comp/env/jdbc/datasource&quot;</span>);
    }
}</pre> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@Configuration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TransferServiceConfig {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i> DataSource dataSource;

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> TransferService transferService() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> DefaultTransferService(accountRepository(), feePolicy());
    }

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> AccountRepository accountRepository() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> JdbcAccountRepository(dataSource);
    }

    <i><span class="hl-annotation" style="color: gray">@Bean</span></i>
    <span class="hl-keyword">public</span> FeePolicy feePolicy() {
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> ZeroFeePolicy();
    }

}</pre> 
      <pre class="programlisting"><span class="hl-keyword">package</span> com.bank.service;

<i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<i><span class="hl-annotation" style="color: gray">@ContextConfiguration(classes = { TransferServiceConfig.class, StandaloneDataConfig.class, JndiDataConfig.class})</span></i>
<i><span class="hl-annotation" style="color: gray">@ActiveProfiles(&quot;dev&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TransferServiceTest {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> TransferService transferService;

    <i><span class="hl-annotation" style="color: gray">@Test</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testTransferService() {
        <span class="hl-comment">// test the transferService</span>
    }
}</pre> 
      <p>In this variation, we have split the XML configuration into three independent <code class="literal">@Configuration</code> classes:</p> 
      <div class="itemizedlist">
       <ul class="itemizedlist" type="disc">
        <li class="listitem"> <code class="literal">TransferServiceConfig</code>: acquires a <code class="literal">dataSource</code> via dependency injection using <code class="literal">@Autowired</code> </li>
        <li class="listitem"> <code class="literal">StandaloneDataConfig</code>: defines a <code class="literal">dataSource</code> for an embedded database suitable for developer tests </li>
        <li class="listitem"> <code class="literal">JndiDataConfig</code>: defines a <code class="literal">dataSource</code> that is retrieved from JNDI in a production environment </li>
       </ul>
      </div> 
      <p>As with the XML-based configuration example, we still annotate <code class="literal">TransferServiceTest</code> with <code class="literal">@ActiveProfiles(&quot;dev&quot;)</code>, but this time we specify all three configuration classes via the <code class="literal">@ContextConfiguration</code> annotation. The body of the test class itself remains completely unchanged.</p> 
      <p>It is often the case that a single set of profiles is used across multiple test classes within a given project. Thus, to avoid duplicate declarations of the <code class="literal">@ActiveProfiles</code> annotation it is possible to declare <code class="literal">@ActiveProfiles</code> once on a base class, and subclasses will automatically inherit the <code class="literal">@ActiveProfiles</code> configuration from the base class. In the following example, the declaration of <code class="literal">@ActiveProfiles</code> (as well as other annotations) has been moved to an abstract superclass, <code class="literal">AbstractIntegrationTest</code>.</p> 
      <pre class="programlisting"><span class="hl-keyword">package</span> com.bank.service;

<i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<i><span class="hl-annotation" style="color: gray">@ContextConfiguration(classes = { TransferServiceConfig.class, StandaloneDataConfig.class, JndiDataConfig.class})</span></i>
<i><span class="hl-annotation" style="color: gray">@ActiveProfiles(&quot;dev&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> AbstractIntegrationTest {
}</pre> 
      <pre class="programlisting"><span class="hl-keyword">package</span> com.bank.service;

<span class="hl-comment">// &quot;dev&quot; profile inherited from superclass</span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TransferServiceTest <span class="hl-keyword">extends</span> AbstractIntegrationTest {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> TransferService transferService;

    <i><span class="hl-annotation" style="color: gray">@Test</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testTransferService() {
        <span class="hl-comment">// test the transferService</span>
    }
}</pre> 
      <p><code class="literal">@ActiveProfiles</code> also supports an <code class="literal">inheritProfiles</code> attribute that can be used to disable the inheritance of active profiles.</p> 
      <pre class="programlisting"><span class="hl-keyword">package</span> com.bank.service;

<span class="hl-comment">// &quot;dev&quot; profile overridden with &quot;production&quot;</span>
<i><span class="hl-annotation" style="color: gray">@ActiveProfiles(profiles = &quot;production&quot;, inheritProfiles = false)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ProductionTransferServiceTest <span class="hl-keyword">extends</span> AbstractIntegrationTest {
    <span class="hl-comment">// test body</span>
}</pre> 
      <p><a name="testcontext-ctx-management-env-profiles-ActiveProfilesResolver"></a>Furthermore, it is sometimes necessary to resolve active profiles for tests <span class="emphasis"><em>programmatically</em></span> instead of declaratively&#x2009;&#x2009;for example, based on:</p> 
      <div class="itemizedlist">
       <ul class="itemizedlist" type="disc">
        <li class="listitem"> the current operating system </li>
        <li class="listitem"> whether tests are being executed on a continuous integration build server </li>
        <li class="listitem"> the presence of certain environment variables </li>
        <li class="listitem"> the presence of custom class-level annotations </li>
        <li class="listitem"> etc. </li>
       </ul>
      </div> 
      <p>To resolve active bean definition profiles programmatically, simply implement a custom <code class="literal">ActiveProfilesResolver</code> and register it via the <code class="literal">resolver</code> attribute of <code class="literal">@ActiveProfiles</code>. The following example demonstrates how to implement and register a custom <code class="literal">OperatingSystemActiveProfilesResolver</code>. For further information, refer to the respective Javadoc.</p> 
      <pre class="programlisting"><span class="hl-keyword">package</span> com.bank.service;

<span class="hl-comment">// &quot;dev&quot; profile overridden programmatically via a custom resolver</span>
<i><span class="hl-annotation" style="color: gray">@ActiveProfiles( resolver = OperatingSystemActiveProfilesResolver.class, inheritProfiles = false)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> TransferServiceTest <span class="hl-keyword">extends</span> AbstractIntegrationTest {
    <span class="hl-comment">// test body</span>
}</pre> 
      <pre class="programlisting"><span class="hl-keyword">package</span> com.bank.service.test;

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> OperatingSystemActiveProfilesResolver <span class="hl-keyword">implements</span> ActiveProfilesResolver {

    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    String[] resolve(Class&lt;?&gt; testClass) {
        String profile = ...;
        <span class="hl-comment">// determine the value of profile based on the operating system</span>
        <span class="hl-keyword">return</span> <span class="hl-keyword">new</span> String[] {profile};
    }
}</pre> 
     </div> 
     <div class="section" title="Loading a WebApplicationContext">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="testcontext-ctx-management-web"></a>Loading a WebApplicationContext</h5>
        </div>
       </div>
      </div> 
      <p>Spring 3.2 introduced support for loading a <code class="literal">WebApplicationContext</code> in integration tests. To instruct the TestContext framework to load a <code class="literal">WebApplicationContext</code> instead of a standard <code class="literal">ApplicationContext</code>, simply annotate the respective test class with <code class="literal">@WebAppConfiguration</code>.</p> 
      <p>The presence of <code class="literal">@WebAppConfiguration</code> on your test class instructs the TestContext framework (TCF) that a <code class="literal">WebApplicationContext</code> (WAC) should be loaded for your integration tests. In the background the TCF makes sure that a <code class="literal">MockServletContext</code> is created and supplied to your tests WAC. By default the base resource path for your <code class="literal">MockServletContext</code> will be set to <span class="emphasis"><em>&quot;src/main/webapp&quot;</em></span>. This is interpreted as a path relative to the root of your JVM (i.e., normally the path to your project). If youre familiar with the directory structure of a web application in a Maven project, youll know that <span class="emphasis"><em>&quot;src/main/webapp&quot;</em></span> is the default location for the root of your WAR. If you need to override this default, simply provide an alternate path to the <code class="literal">@WebAppConfiguration</code> annotation (e.g., <code class="literal">@WebAppConfiguration(&quot;src/test/webapp&quot;)</code>). If you wish to reference a base resource path from the classpath instead of the file system, just use Springs <span class="emphasis"><em>classpath:</em></span> prefix.</p> 
      <p>Please note that Springs testing support for <code class="literal">WebApplicationContexts</code> is on par with its support for standard <code class="literal">ApplicationContexts</code>. When testing with a <code class="literal">WebApplicationContext</code> you are free to declare either XML configuration files or <code class="literal">@Configuration</code> classes via <code class="literal">@ContextConfiguration</code>. You are of course also free to use any other test annotations such as <code class="literal">@TestExecutionListeners</code>, <code class="literal">@TransactionConfiguration</code>, <code class="literal">@ActiveProfiles</code>, etc.</p> 
      <p>The following examples demonstrate some of the various configuration options for loading a <code class="literal">WebApplicationContext</code>.</p> 
      <p title="Conventions"> <b>Conventions.&nbsp;</b> </p>
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>

<span class="hl-comment">// defaults to &quot;file:src/main/webapp&quot;</span>
<i><span class="hl-annotation" style="color: gray">@WebAppConfiguration</span></i>

<span class="hl-comment">// detects &quot;WacTests-context.xml&quot; in same package</span>
<span class="hl-comment">// or static nested @Configuration class</span>
<i><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></i>

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WacTests {
    <span class="hl-comment">//...</span>
}</pre>
      <p title="Conventions"> </p> 
      <p>The above example demonstrates the TestContext frameworks support for <span class="emphasis"><em>convention over configuration</em></span>. If you annotate a test class with <code class="literal">@WebAppConfiguration</code> without specifying a resource base path, the resource path will effectively default to <span class="emphasis"><em>&quot;file:src/main/webapp&quot;</em></span>. Similarly, if you declare <code class="literal">@ContextConfiguration</code> without specifying resource <code class="literal">locations</code>, annotated <code class="literal">classes</code>, or context <code class="literal">initializers</code>, Spring will attempt to detect the presence of your configuration using conventions (i.e., <span class="emphasis"><em>&quot;WacTests-context.xml&quot;</em></span> in the same package as the <code class="literal">WacTests</code> class or static nested <code class="literal">@Configuration</code> classes).</p> 
      <p title="Default resource semantics"> <b>Default resource semantics.&nbsp;</b> </p>
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>

<span class="hl-comment">// file system resource</span>
<i><span class="hl-annotation" style="color: gray">@WebAppConfiguration(&quot;webapp&quot;)</span></i>

<span class="hl-comment">// classpath resource</span>
<i><span class="hl-annotation" style="color: gray">@ContextConfiguration(&quot;/spring/test-servlet-config.xml&quot;)</span></i>

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WacTests {
    <span class="hl-comment">//...</span>
}</pre>
      <p title="Default resource semantics"> </p> 
      <p>This example demonstrates how to explicitly declare a resource base path with <code class="literal">@WebAppConfiguration</code> and an XML resource location with <code class="literal">@ContextConfiguration</code>. The important thing to note here is the different semantics for paths with these two annotations. By default, <code class="literal">@WebAppConfiguration</code> resource paths are file system based; whereas, <code class="literal">@ContextConfiguration</code> resource locations are classpath based.</p> 
      <p title="Explicit resource semantics"> <b>Explicit resource semantics.&nbsp;</b> </p>
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>

<span class="hl-comment">// classpath resource</span>
<i><span class="hl-annotation" style="color: gray">@WebAppConfiguration(&quot;classpath:test-web-resources&quot;)</span></i>

<span class="hl-comment">// file system resource</span>
<i><span class="hl-annotation" style="color: gray">@ContextConfiguration(&quot;file:src/main/webapp/WEB-INF/servlet-config.xml&quot;)</span></i>

<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WacTests {
    <span class="hl-comment">//...</span>
}</pre>
      <p title="Explicit resource semantics"> </p> 
      <p>In this third example, we see that we can override the default resource semantics for both annotations by specifying a Spring resource prefix. Contrast the comments in this example with the previous example.</p> 
      <p>To provide comprehensive web testing support, Spring 3.2 introduced a <code class="literal">ServletTestExecutionListener</code> that is enabled by default. When testing against a <code class="literal">WebApplicationContext</code> this <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-key-abstractions" title="Key abstractions">TestExecutionListener</a> sets up default thread-local state via Spring Webs <code class="literal">RequestContextHolder</code> before each test method and creates a <code class="literal">MockHttpServletRequest</code>, <code class="literal">MockHttpServletResponse</code>, and <code class="literal">ServletWebRequest</code> based on the base resource path configured via <code class="literal">@WebAppConfiguration</code>. <code class="literal">ServletTestExecutionListener</code> also ensures that the <code class="literal">MockHttpServletResponse</code> and <code class="literal">ServletWebRequest</code> can be injected into the test instance, and once the test is complete it cleans up thread-local state.</p> 
      <p>Once you have a <code class="literal">WebApplicationContext</code> loaded for your test you might find that you need to interact with the web mocks&#x2009;&#x2009;for example, to set up your test fixture or to perform assertions after invoking your web component. The following example demonstrates which mocks can be autowired into your test instance. Note that the <code class="literal">WebApplicationContext</code> and <code class="literal">MockServletContext</code> are both cached across the test suite; whereas, the other mocks are managed per test method by the <code class="literal">ServletTestExecutionListener</code>.</p> 
      <p title="Injecting mocks"> <b>Injecting mocks.&nbsp;</b> </p>
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@WebAppConfiguration</span></i>
<i><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> WacTests {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    WebApplicationContext wac; <span class="hl-comment">// cached</span>

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    MockServletContext servletContext; <span class="hl-comment">// cached</span>

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    MockHttpSession session;

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    MockHttpServletRequest request;

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    MockHttpServletResponse response;

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    ServletWebRequest webRequest;

    <span class="hl-comment">//...</span>
}</pre>
      <p title="Injecting mocks"> </p> 
     </div> 
     <div class="section" title="Context caching">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="testcontext-ctx-management-caching"></a>Context caching</h5>
        </div>
       </div>
      </div> 
      <p>Once the TestContext framework loads an <code class="literal">ApplicationContext</code> (or <code class="literal">WebApplicationContext</code>) for a test, that context will be cached and reused for <span class="emphasis"><em>all</em></span> subsequent tests that declare the same unique context configuration within the same test suite. To understand how caching works, it is important to understand what is meant by <span class="emphasis"><em>unique</em></span> and <span class="emphasis"><em>test suite</em></span>.</p> 
      <p>An <code class="literal">ApplicationContext</code> can be <span class="emphasis"><em>uniquely</em></span> identified by the combination of configuration parameters that are used to load it. Consequently, the unique combination of configuration parameters are used to generate a <span class="emphasis"><em>key</em></span> under which the context is cached. The TestContext framework uses the following configuration parameters to build the context cache key:</p> 
      <div class="itemizedlist">
       <ul class="itemizedlist" type="disc">
        <li class="listitem"> <code class="literal">locations</code> <span class="emphasis"><em>(from @ContextConfiguration)</em></span> </li>
        <li class="listitem"> <code class="literal">classes</code> <span class="emphasis"><em>(from @ContextConfiguration)</em></span> </li>
        <li class="listitem"> <code class="literal">contextInitializerClasses</code> <span class="emphasis"><em>(from @ContextConfiguration)</em></span> </li>
        <li class="listitem"> <code class="literal">contextLoader</code> <span class="emphasis"><em>(from @ContextConfiguration)</em></span> </li>
        <li class="listitem"> <code class="literal">activeProfiles</code> <span class="emphasis"><em>(from @ActiveProfiles)</em></span> </li>
        <li class="listitem"> <code class="literal">resourceBasePath</code> <span class="emphasis"><em>(from @WebAppConfiguration)</em></span> </li>
       </ul>
      </div> 
      <p>For example, if <code class="literal">TestClassA</code> specifies <code class="literal">{&quot;app-config.xml&quot;, &quot;test-config.xml&quot;}</code> for the <code class="literal">locations</code> (or <code class="literal">value</code>) attribute of <code class="literal">@ContextConfiguration</code>, the TestContext framework will load the corresponding <code class="literal">ApplicationContext</code> and store it in a <code class="literal">static</code> context cache under a key that is based solely on those locations. So if <code class="literal">TestClassB</code> also defines <code class="literal">{&quot;app-config.xml&quot;, &quot;test-config.xml&quot;}</code> for its locations (either explicitly or implicitly through inheritance) but does not define <code class="literal">@WebAppConfiguration</code>, a different <code class="literal">ContextLoader</code>, different active profiles, or different context initializers, then the same <code class="literal">ApplicationContext</code> will be shared by both test classes. This means that the setup cost for loading an application context is incurred only once (per test suite), and subsequent test execution is much faster.</p> 
      <div class="note" title="Test suites and forked processes" style="margin-left: 0.5in; margin-right: 0.5in;">
       <table border="0" summary="Note: Test suites and forked processes">
        <tbody>
         <tr>
          <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
          <th align="left">Test suites and forked processes</th>
         </tr>
         <tr>
          <td align="left" valign="top"> <p>The Spring TestContext framework stores application contexts in a <span class="emphasis"><em>static</em></span> cache. This means that the context is literally stored in a <code class="literal">static</code> variable. In other words, if tests execute in separate processes the static cache will be cleared between each test execution, and this will effectively disable the caching mechanism.</p> <p>To benefit from the caching mechanism, all tests must run within the same process or test suite. This can be achieved by executing all tests as a group within an IDE. Similarly, when executing tests with a build framework such as Ant, Maven, or Gradle it is important to make sure that the build framework does not <span class="emphasis"><em>fork</em></span> between tests. For example, if the <a class="ulink" href="http://maven.apache.org/plugins/maven-surefire-plugin/test-mojo.html#forkMode" target="_top">forkMode</a> for the Maven Surefire plug-in is set to <code class="literal">always</code> or <code class="literal">pertest</code>, the TestContext framework will not be able to cache application contexts between test classes and the build process will run significantly slower as a result.</p> </td>
         </tr>
        </tbody>
       </table>
      </div> 
      <p>In the unlikely case that a test corrupts the application context and requires reloading&#x2009;&#x2009;for example, by modifying a bean definition or the state of an application object&#x2009;&#x2009;you can annotate your test class or test method with <code class="literal">@DirtiesContext</code> (see the discussion of <code class="literal">@DirtiesContext</code> in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#integration-testing-annotations-spring" title="Spring Testing Annotations">the section called Spring Testing Annotations</a>). This instructs Spring to remove the context from the cache and rebuild the application context before executing the next test. Note that support for the <code class="literal">@DirtiesContext</code> annotation is provided by the <code class="literal">DirtiesContextTestExecutionListener</code> which is enabled by default.</p> 
     </div> 
     <div class="section" title="Context hierarchies">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="testcontext-ctx-management-ctx-hierarchies"></a>Context hierarchies</h5>
        </div>
       </div>
      </div> 
      <p>When writing integration tests that rely on a loaded Spring <code class="literal">ApplicationContext</code>, it is often sufficient to test against a single context; however, there are times when it is beneficial or even necessary to test against a hierarchy of <code class="literal">ApplicationContext</code> s. For example, if you are developing a Spring MVC web application you will typically have a root <code class="literal">WebApplicationContext</code> loaded via Springs <code class="literal">ContextLoaderListener</code> and a child <code class="literal">WebApplicationContext</code> loaded via Springs <code class="literal">DispatcherServlet</code>. This results in a parent-child context hierarchy where shared components and infrastructure configuration are declared in the root context and consumed in the child context by web-specific components. Another use case can be found in Spring Batch applications where you often have a parent context that provides configuration for shared batch infrastructure and a child context for the configuration of a specific batch job.</p> 
      <p>As of Spring Framework 3.2.2, it is possible to write integration tests that use context hierarchies by declaring context configuration via the <code class="literal">@ContextHierarchy</code> annotation, either on an individual test class or within a test class hierarchy. If a context hierarchy is declared on multiple classes within a test class hierarchy it is also possible to merge or override the context configuration for a specific, named level in the context hierarchy. When merging configuration for a given level in the hierarchy the configuration resource type (i.e., XML configuration files or annotated classes) must be consistent; otherwise, it is perfectly acceptable to have different levels in a context hierarchy configured using different resource types.</p> 
      <p>The following JUnit-based examples demonstrate common configuration scenarios for integration tests that require the use of context hierarchies.</p> 
      <p><code class="literal">ControllerIntegrationTests</code> represents a typical integration testing scenario for a Spring MVC web application by declaring a context hierarchy consisting of two levels, one for the <span class="emphasis"><em>root</em></span> WebApplicationContext (loaded using the <code class="literal">TestAppConfig</code> <code class="literal">@Configuration</code> class) and one for the <span class="emphasis"><em>dispatcher servlet</em></span> <code class="literal">WebApplicationContext</code> (loaded using the <code class="literal">WebConfig</code> <code class="literal">@Configuration</code> class). The <code class="literal">WebApplicationContext</code> that is <span class="emphasis"><em>autowired</em></span> into the test instance is the one for the child context (i.e., the lowest context in the hierarchy).</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<i><span class="hl-annotation" style="color: gray">@WebAppConfiguration</span></i>
<i><span class="hl-annotation" style="color: gray">@ContextHierarchy({ @ContextConfiguration(classes = TestAppConfig.class), @ContextConfiguration(classes = WebConfig.class) })</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ControllerIntegrationTests {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> WebApplicationContext wac;

    <span class="hl-comment">// ...</span>
}</pre> 
      <p>The following test classes define a context hierarchy within a test class hierarchy. <code class="literal">AbstractWebTests</code> declares the configuration for a root <code class="literal">WebApplicationContext</code> in a Spring-powered web application. Note, however, that <code class="literal">AbstractWebTests</code> does not declare <code class="literal">@ContextHierarchy</code>; consequently, subclasses of <code class="literal">AbstractWebTests</code> can optionally participate in a context hierarchy or simply follow the standard semantics for <code class="literal">@ContextConfiguration</code>. <code class="literal">SoapWebServiceTests</code> and <code class="literal">RestWebServiceTests</code> both extend <code class="literal">AbstractWebTests</code> and define a context hierarchy via <code class="literal">@ContextHierarchy</code>. The result is that three application contexts will be loaded (one for each declaration of <code class="literal">@ContextConfiguration</code>), and the application context loaded based on the configuration in <code class="literal">AbstractWebTests</code> will be set as the parent context for each of the contexts loaded for the concrete subclasses.</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<i><span class="hl-annotation" style="color: gray">@WebAppConfiguration</span></i>
<i><span class="hl-annotation" style="color: gray">@ContextConfiguration(&quot;file:src/main/webapp/WEB-INF/applicationContext.xml&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> AbstractWebTests {}

@ContextHierarchy(<i><span class="hl-annotation" style="color: gray">@ContextConfiguration(&quot;/spring/soap-ws-config.xml&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SoapWebServiceTests <span class="hl-keyword">extends</span> AbstractWebTests {}

@ContextHierarchy(<i><span class="hl-annotation" style="color: gray">@ContextConfiguration(&quot;/spring/rest-ws-config.xml&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RestWebServiceTests <span class="hl-keyword">extends</span> AbstractWebTests {}</pre> 
      <p>The following classes demonstrate the use of <span class="emphasis"><em>named</em></span> hierarchy levels in order to <span class="emphasis"><em>merge</em></span> the configuration for specific levels in a context hierarchy. <code class="literal">BaseTests</code> defines two levels in the hierarchy, <code class="literal">parent</code> and <code class="literal">child</code>. <code class="literal">ExtendedTests</code> extends <code class="literal">BaseTests</code> and instructs the Spring TestContext Framework to merge the context configuration for the <code class="literal">child</code> hierarchy level, simply by ensuring that the names declared via <code class="literal">ContextConfiguration</code>'s <code class="literal">name</code> attribute are both <code class="literal">&quot;child&quot;</code>. The result is that three application contexts will be loaded: one for <code class="literal">&quot;/app-config.xml&quot;</code>, one for <code class="literal">&quot;/user-config.xml&quot;</code>, and one for <code class="literal">{&quot;/user-config.xml&quot;, &quot;/order-config.xml&quot;}</code>. As with the previous example, the application context loaded from <code class="literal">&quot;/app-config.xml&quot;</code> will be set as the parent context for the contexts loaded from <code class="literal">&quot;/user-config.xml&quot;</code> and <code class="literal">{&quot;/user-config.xml&quot;, &quot;/order-config.xml&quot;}</code>.</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<i><span class="hl-annotation" style="color: gray">@ContextHierarchy({ @ContextConfiguration(name = &quot;parent&quot;, locations = &quot;/app-config.xml&quot;), @ContextConfiguration(name = &quot;child&quot;, locations = &quot;/user-config.xml&quot;) })</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BaseTests {}

<i><span class="hl-annotation" style="color: gray">@ContextHierarchy( @ContextConfiguration(name = &quot;child&quot;, locations = &quot;/order-config.xml&quot;) )</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExtendedTests <span class="hl-keyword">extends</span> BaseTests {}</pre> 
      <p>In contrast to the previous example, this example demonstrates how to <span class="emphasis"><em>override</em></span> the configuration for a given named level in a context hierarchy by setting <code class="literal">ContextConfiguration</code>'s <code class="literal">inheritLocations</code> flag to <code class="literal">false</code>. Consequently, the application context for <code class="literal">ExtendedTests</code> will be loaded only from <code class="literal">&quot;/test-user-config.xml&quot;</code> and will have its parent set to the context loaded from <code class="literal">&quot;/app-config.xml&quot;</code>.</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<i><span class="hl-annotation" style="color: gray">@ContextHierarchy({ @ContextConfiguration(name = &quot;parent&quot;, locations = &quot;/app-config.xml&quot;), @ContextConfiguration(name = &quot;child&quot;, locations = &quot;/user-config.xml&quot;) })</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> BaseTests {}

<i><span class="hl-annotation" style="color: gray">@ContextHierarchy( @ContextConfiguration( name = &quot;child&quot;, locations = &quot;/test-user-config.xml&quot;, inheritLocations = false ))</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExtendedTests <span class="hl-keyword">extends</span> BaseTests {}</pre> 
      <div class="note" title="Dirtying a context within a context hierarchy" style="margin-left: 0.5in; margin-right: 0.5in;">
       <table border="0" summary="Note: Dirtying a context within a context hierarchy">
        <tbody>
         <tr>
          <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
          <th align="left">Dirtying a context within a context hierarchy</th>
         </tr>
         <tr>
          <td align="left" valign="top"> <p>If <code class="literal">@DirtiesContext</code> is used in a test whose context is configured as part of a context hierarchy, the <code class="literal">hierarchyMode</code> flag can be used to control how the context cache is cleared. For further details consult the discussion of <code class="literal">@DirtiesContext</code> in <a class="xref" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#integration-testing-annotations-spring" title="Spring Testing Annotations">the section called Spring Testing Annotations</a> and the Javadoc for <code class="literal">@DirtiesContext</code>.</p> </td>
         </tr>
        </tbody>
       </table>
      </div> 
     </div> 
    </div> 
    <div class="section" title="Dependency injection of test fixtures">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="testcontext-fixture-di"></a>Dependency injection of test fixtures</h4>
       </div>
      </div>
     </div> 
     <p>When you use the <code class="literal">DependencyInjectionTestExecutionListener</code>&#x2009;&#x2009;which is configured by default&#x2009;&#x2009;the dependencies of your test instances are <span class="emphasis"><em>injected</em></span> from beans in the application context that you configured with <code class="literal">@ContextConfiguration</code>. You may use setter injection, field injection, or both, depending on which annotations you choose and whether you place them on setter methods or fields. For consistency with the annotation support introduced in Spring 2.5 and 3.0, you can use Springs <code class="literal">@Autowired</code> annotation or the <code class="literal">@Inject</code> annotation from JSR 300.</p> 
     <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Tip">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
         <th align="left">Tip</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>The TestContext framework does not instrument the manner in which a test instance is instantiated. Thus the use of <code class="literal">@Autowired</code> or <code class="literal">@Inject</code> for constructors has no effect for test classes.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <p>Because <code class="literal">@Autowired</code> is used to perform <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-autowire" title="4.4.5&nbsp;Autowiring collaborators"><span class="emphasis"><em>autowiring by type</em></span></a>, if you have multiple bean definitions of the same type, you cannot rely on this approach for those particular beans. In that case, you can use <code class="literal">@Autowired</code> in conjunction with <code class="literal">@Qualifier</code>. As of Spring 3.0 you may also choose to use <code class="literal">@Inject</code> in conjunction with <code class="literal">@Named</code>. Alternatively, if your test class has access to its <code class="literal">ApplicationContext</code>, you can perform an explicit lookup by using (for example) a call to <code class="literal">applicationContext.getBean(&quot;titleRepository&quot;)</code>.</p> 
     <p>If you do not want dependency injection applied to your test instances, simply do not annotate fields or setter methods with <code class="literal">@Autowired</code> or <code class="literal">@Inject</code>. Alternatively, you can disable dependency injection altogether by explicitly configuring your class with <code class="literal">@TestExecutionListeners</code> and omitting <code class="literal">DependencyInjectionTestExecutionListener.class</code> from the list of listeners.</p> 
     <p>Consider the scenario of testing a <code class="literal">HibernateTitleRepository</code> class, as outlined in the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#integration-testing-goals" title="10.3.2&nbsp;Goals of Integration Testing">Goals</a> section. The next two code listings demonstrate the use of <code class="literal">@Autowired</code> on fields and setter methods. The application context configuration is presented after all sample code listings.</p> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>The dependency injection behavior in the following code listings is not specific to JUnit. The same DI techniques can be used in conjunction with any testing framework.</p> <p>The following examples make calls to static assertion methods such as <code class="literal">assertNotNull()</code> but without prepending the call with <code class="literal">Assert</code>. In such cases, assume that the method was properly imported through an <code class="literal">import static</code> declaration that is not shown in the example.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <p>The first code listing shows a JUnit-based implementation of the test class that uses <code class="literal">@Autowired</code> for field injection.</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<span class="hl-comment">// specifies the Spring configuration to load for this test fixture</span>
<span class="strong"><strong>@ContextConfiguration(&quot;repository-config.xml&quot;)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HibernateTitleRepositoryTests {

    <span class="hl-comment">// this instance will be dependency injected by type</span>
    <span class="strong"><strong>@Autowired</strong></span>
    <span class="hl-keyword">private</span> HibernateTitleRepository titleRepository;

    <i><span class="hl-annotation" style="color: gray">@Test</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findById() {
        Title title = titleRepository.findById(<span class="hl-keyword">new</span> Long(<span class="hl-number">10</span>));
        assertNotNull(title);
    }
}</pre> 
     <p>Alternatively, you can configure the class to use <code class="literal">@Autowired</code> for setter injection as seen below.</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<span class="hl-comment">// specifies the Spring configuration to load for this test fixture</span>
<span class="strong"><strong>@ContextConfiguration(&quot;repository-config.xml&quot;)</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HibernateTitleRepositoryTests {

    <span class="hl-comment">// this instance will be dependency injected by type</span>
    <span class="hl-keyword">private</span> HibernateTitleRepository titleRepository;

    <span class="strong"><strong>@Autowired</strong></span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setTitleRepository(HibernateTitleRepository titleRepository) {
        <span class="hl-keyword">this</span>.titleRepository = titleRepository;
    }

    <i><span class="hl-annotation" style="color: gray">@Test</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> findById() {
        Title title = titleRepository.findById(<span class="hl-keyword">new</span> Long(<span class="hl-number">10</span>));
        assertNotNull(title);
    }
}</pre> 
     <p>The preceding code listings use the same XML context file referenced by the <code class="literal">@ContextConfiguration</code> annotation (that is, <code class="literal">repository-config.xml</code>), which looks like this:</p> 
     <pre class="programlisting"><span class="hl-directive" style="color: maroon">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="hl-tag">&lt;beans</span> <span class="hl-attribute">xmlns</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans&quot;</span>
    <span class="hl-attribute">xmlns:xsi</span>=<span class="hl-value">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="hl-attribute">xsi:schemaLocation</span>=<span class="hl-value">&quot;http://www.springframework.org/schema/beans
        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span><span class="hl-tag">&gt;</span>

    <span class="hl-comment">&lt;!-- this bean will be injected into the HibernateTitleRepositoryTests class --&gt;</span>
    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;</span><span class="strong"><strong>titleRepository</strong></span>&quot; class=&quot;<span class="strong"><strong>com.foo.repository.hibernate.HibernateTitleRepository</strong></span>&quot;&gt;
        <span class="hl-tag">&lt;property</span> <span class="hl-attribute">name</span>=<span class="hl-value">&quot;sessionFactory&quot;</span> <span class="hl-attribute">ref</span>=<span class="hl-value">&quot;sessionFactory&quot;</span><span class="hl-tag">/&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;sessionFactory&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.springframework.orm.hibernate3.LocalSessionFactoryBean&quot;</span><span class="hl-tag">&gt;</span>
        <span class="hl-comment">&lt;!-- configuration elided for brevity --&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre> 
     <div class="note" title="Note" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Note</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>If you are extending from a Spring-provided test base class that happens to use <code class="literal">@Autowired</code> on one of its setter methods, you might have multiple beans of the affected type defined in your application context: for example, multiple <code class="literal">DataSource</code> beans. In such a case, you can override the setter method and use the <code class="literal">@Qualifier</code> annotation to indicate a specific target bean as follows, but make sure to delegate to the overridden method in the superclass as well.</p> <pre class="programlisting"><span class="hl-comment">// ...</span>

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <i><span class="hl-annotation" style="color: gray">@Override</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setDataSource(<span class="strong"><strong>@Qualifier(&quot;myDataSource&quot;)</strong></span> DataSource dataSource) {
        <span class="strong"><strong>super</strong></span>.setDataSource(dataSource);
    }

<span class="hl-comment">// ...</span></pre> <p>The specified qualifier value indicates the specific <code class="literal">DataSource</code> bean to inject, narrowing the set of type matches to a specific bean. Its value is matched against <code class="literal">&lt;qualifier&gt;</code> declarations within the corresponding <code class="literal">&lt;bean&gt;</code> definitions. The bean name is used as a fallback qualifier value, so you may effectively also point to a specific bean by name there (as shown above, assuming that &quot;myDataSource&quot; is the bean id).</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="Testing request and session scoped beans">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="testcontext-web-scoped-beans"></a>Testing request and session scoped beans</h4>
       </div>
      </div>
     </div> 
     <p><a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#beans-factory-scopes-other" title="4.5.4&nbsp;Request, session, and global session scopes">Request and session scoped beans</a> have been supported by Spring for several years now, but its always been a bit non-trivial to test them. As of Spring 3.2 its a breeze to test your request-scoped and session-scoped beans by following these steps.</p> 
     <div class="itemizedlist">
      <ul class="itemizedlist" type="disc">
       <li class="listitem"> Ensure that a <code class="literal">WebApplicationContext</code> is loaded for your test by annotating your test class with <code class="literal">@WebAppConfiguration</code>. </li>
       <li class="listitem"> Inject the mock request or session into your test instance and prepare your test fixture as appropriate. </li>
       <li class="listitem"> Invoke your web component that you retrieved from the configured <code class="literal">WebApplicationContext</code> (i.e., via dependency injection). </li>
       <li class="listitem"> Perform assertions against the mocks. </li>
      </ul>
     </div> 
     <p>The following code snippet displays the XML configuration for a login use case. Note that the <code class="literal">userService</code> bean has a dependency on a request-scoped <code class="literal">loginAction</code> bean. Also, the <code class="literal">LoginAction</code> is instantiated using <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#expressions" title="7.&nbsp;Spring Expression Language (SpEL)">SpEL expressions</a> that retrieve the username and password from the current HTTP request. In our test, we will want to configure these request parameters via the mock managed by the TestContext framework.</p> 
     <p title="Request-scoped bean configuration"> <b>Request-scoped bean configuration.&nbsp;</b> </p>
     <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;userService&quot;</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.example.SimpleUserService&quot;</span>
            <span class="hl-attribute">c:loginAction-ref</span>=<span class="hl-value">&quot;loginAction&quot;</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;loginAction&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.example.LoginAction&quot;</span>
            <span class="hl-attribute">c:username</span>=<span class="hl-value">&quot;{request.getParameter(</span><span class="emphasis"><em>user</em></span>)}&quot;
            c:password=&quot;{request.getParameter(<span class="emphasis"><em>pswd</em></span>)}&quot;
            scope=&quot;request&quot;&gt;
        <span class="hl-tag">&lt;aop:scoped-proxy /&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
     <p title="Request-scoped bean configuration"> </p> 
     <p>In <code class="literal">RequestScopedBeanTests</code> we inject both the <code class="literal">UserService</code> (i.e., the subject under test) and the <code class="literal">MockHttpServletRequest</code> into our test instance. Within our <code class="literal">requestScope()</code> test method we set up our test fixture by setting request parameters in the provided <code class="literal">MockHttpServletRequest</code>. When the <code class="literal">loginUser()</code> method is invoked on our <code class="literal">userService</code> we are assured that the user service has access to the request-scoped <code class="literal">loginAction</code> for the current <code class="literal">MockHttpServletRequest</code> (i.e., the one we just set parameters in). We can then perform assertions against the results based on the known inputs for the username and password.</p> 
     <p title="Request-scoped bean test"> <b>Request-scoped bean test.&nbsp;</b> </p>
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<i><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></i>
<i><span class="hl-annotation" style="color: gray">@WebAppConfiguration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> RequestScopedBeanTests {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i> UserService userService;
    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i> MockHttpServletRequest request;

    <i><span class="hl-annotation" style="color: gray">@Test</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> requestScope() {

        request.setParameter(<span class="hl-string">&quot;user&quot;</span>, <span class="hl-string">&quot;enigma&quot;</span>);
        request.setParameter(<span class="hl-string">&quot;pswd&quot;</span>, <span class="hl-string">&quot;$pr!ng&quot;</span>);

        LoginResults results = userService.loginUser();

        <span class="hl-comment">// assert results</span>
    }
}</pre>
     <p title="Request-scoped bean test"> </p> 
     <p>The following code snippet is similar to the one we saw above for a request-scoped bean; however, this time the <code class="literal">userService</code> bean has a dependency on a session-scoped <code class="literal">userPreferences</code> bean. Note that the <code class="literal">UserPreferences</code> bean is instantiated using a SpEL expression that retrieves the <span class="emphasis"><em>theme</em></span> from the current HTTP session. In our test, we will need to configure a theme in the mock session managed by the TestContext framework.</p> 
     <p title="Session-scoped bean configuration"> <b>Session-scoped bean configuration.&nbsp;</b> </p>
     <pre class="programlisting"><span class="hl-tag">&lt;beans&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;userService&quot;</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.example.SimpleUserService&quot;</span>
            <span class="hl-attribute">c:userPreferences-ref</span>=<span class="hl-value">&quot;userPreferences&quot;</span><span class="hl-tag"> /&gt;</span>

    <span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;userPreferences&quot;</span>
            <span class="hl-attribute">class</span>=<span class="hl-value">&quot;com.example.UserPreferences&quot;</span>
            <span class="hl-attribute">c:theme</span>=<span class="hl-value">&quot;#{session.getAttribute(</span><span class="emphasis"><em>theme</em></span>)}&quot;
            scope=&quot;session&quot;&gt;
        <span class="hl-tag">&lt;aop:scoped-proxy /&gt;</span>
    <span class="hl-tag">&lt;/bean&gt;</span>

<span class="hl-tag">&lt;/beans&gt;</span></pre>
     <p title="Session-scoped bean configuration"> </p> 
     <p>In <code class="literal">SessionScopedBeanTests</code> we inject the <code class="literal">UserService</code> and the <code class="literal">MockHttpSession</code> into our test instance. Within our <code class="literal">sessionScope()</code> test method we set up our test fixture by setting the expected &quot;theme&quot; attribute in the provided <code class="literal">MockHttpSession</code>. When the <code class="literal">processUserPreferences()</code> method is invoked on our <code class="literal">userService</code> we are assured that the user service has access to the session-scoped <code class="literal">userPreferences</code> for the current <code class="literal">MockHttpSession</code>, and we can perform assertions against the results based on the configured theme.</p> 
     <p title="Session-scoped bean test"> <b>Session-scoped bean test.&nbsp;</b> </p>
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<i><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></i>
<i><span class="hl-annotation" style="color: gray">@WebAppConfiguration</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SessionScopedBeanTests {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i> UserService userService;
    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i> MockHttpSession session;

    <i><span class="hl-annotation" style="color: gray">@Test</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> sessionScope() <span class="hl-keyword">throws</span> Exception {

        session.setAttribute(<span class="hl-string">&quot;theme&quot;</span>, <span class="hl-string">&quot;blue&quot;</span>);

        Results results = userService.processUserPreferences();

        <span class="hl-comment">// assert results</span>
    }
}</pre>
     <p title="Session-scoped bean test"> </p> 
    </div> 
    <div class="section" title="Transaction management">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="testcontext-tx"></a>Transaction management</h4>
       </div>
      </div>
     </div> 
     <p>In the TestContext framework, transactions are managed by the <code class="literal">TransactionalTestExecutionListener</code>. Note that <code class="literal">TransactionalTestExecutionListener</code> is configured by default, even if you do not explicitly declare <code class="literal">@TestExecutionListeners</code> on your test class. To enable support for transactions, however, you must provide a <code class="literal">PlatformTransactionManager</code> bean in the application context loaded by <code class="literal">@ContextConfiguration</code> semantics. In addition, you must declare <code class="literal">@Transactional</code> either at the class or method level for your tests.</p> 
     <p>For class-level transaction configuration (i.e., setting an explicit bean name for the transaction manager and the default rollback flag), see the <code class="literal">@TransactionConfiguration</code> entry in the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#integration-testing-annotations" title="10.3.4&nbsp;Annotations">annotation support</a> section.</p> 
     <p>If transactions are not enabled for the entire test class, you can annotate methods explicitly with <code class="literal">@Transactional</code>. To control whether a transaction should commit for a particular test method, you can use the <code class="literal">@Rollback</code> annotation to override the class-level default rollback setting.</p> 
     <p><span class="emphasis"><em><a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-support-classes-junit4" title="JUnit support classes"><code class="literal">AbstractTransactionalJUnit4SpringContextTests</code></a> and <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#testcontext-support-classes-testng" title="TestNG support classes"><code class="literal">AbstractTransactionalTestNGSpringContextTests</code></a> are preconfigured for transactional support at the class level.</em></span></p> 
     <p>Occasionally you need to execute certain code before or after a transactional test method but outside the transactional context, for example, to verify the initial database state prior to execution of your test or to verify expected transactional commit behavior after test execution (if the test was configured not to roll back the transaction). <code class="literal">TransactionalTestExecutionListener</code> supports the <code class="literal">@BeforeTransaction</code> and <code class="literal">@AfterTransaction</code> annotations exactly for such scenarios. Simply annotate any <code class="literal">public void</code> method in your test class with one of these annotations, and the <code class="literal">TransactionalTestExecutionListener</code> ensures that your <span class="emphasis"><em>before transaction method</em></span> or <span class="emphasis"><em>after transaction method</em></span> is executed at the appropriate time.</p> 
     <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Tip">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
         <th align="left">Tip</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>Any <span class="emphasis"><em>before methods</em></span> (such as methods annotated with JUnits <code class="literal">@Before</code>) and any <span class="emphasis"><em>after methods</em></span> (such as methods annotated with JUnits <code class="literal">@After</code>) are executed <span class="emphasis"><em>within</em></span> a transaction. In addition, methods annotated with <code class="literal">@BeforeTransaction</code> or <code class="literal">@AfterTransaction</code> are naturally not executed for test methods that are not configured to run within a transaction.</p> </td>
        </tr>
       </tbody>
      </table>
     </div> 
     <p>The following JUnit-based example displays a fictitious integration testing scenario highlighting several transaction-related annotations. Consult the <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#integration-testing-annotations" title="10.3.4&nbsp;Annotations">annotation support</a> section for further information and configuration examples.</p> 
     <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<i><span class="hl-annotation" style="color: gray">@ContextConfiguration</span></i>
<span class="strong"><strong>@TransactionConfiguration(transactionManager=&quot;txMgr&quot;, defaultRollback=false) @Transactional</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> FictitiousTransactionalTest {

    <span class="strong"><strong>@BeforeTransaction</strong></span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> verifyInitialDatabaseState() {
        <span class="hl-comment">// logic to verify the initial state before a transaction is started</span>
    }

    <i><span class="hl-annotation" style="color: gray">@Before</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setUpTestDataWithinTransaction() {
        <span class="hl-comment">// set up test data within the transaction</span>
    }

    <i><span class="hl-annotation" style="color: gray">@Test</span></i>
    <span class="hl-comment">// overrides the class-level defaultRollback setting</span>
    <span class="strong"><strong>@Rollback(true)</strong></span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> modifyDatabaseWithinTransaction() {
        <span class="hl-comment">// logic which uses the test data and modifies database state</span>
    }

    <i><span class="hl-annotation" style="color: gray">@After</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> tearDownWithinTransaction() {
        <span class="hl-comment">// execute &quot;tear down&quot; logic within the transaction</span>
    }

    <span class="strong"><strong>@AfterTransaction</strong></span>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> verifyFinalDatabaseState() {
        <span class="hl-comment">// logic to verify the final state after transaction has rolled back</span>
    }

}</pre> 
     <div class="note" title="Avoid false positives when testing ORM code" style="margin-left: 0.5in; margin-right: 0.5in;">
      <table border="0" summary="Note: Avoid false positives when testing ORM code">
       <tbody>
        <tr>
         <td rowspan="2" align="center" valign="top" width="25"><img alt="[Note]" src="./Spring Framework Reference Documentation_files/note.png" /></td>
         <th align="left">Avoid false positives when testing ORM code</th>
        </tr>
        <tr>
         <td align="left" valign="top"> <p>When you test application code that manipulates the state of the Hibernate session, make sure to <span class="emphasis"><em>flush</em></span> the underlying session within test methods that execute that code. Failing to flush the underlying session can produce <span class="emphasis"><em>false positives</em></span>: your test may pass, but the same code throws an exception in a live, production environment. In the following Hibernate-based example test case, one method demonstrates a false positive, and the other method correctly exposes the results of flushing the session. Note that this applies to JPA and any other ORM frameworks that maintain an in-memory <span class="emphasis"><em>unit of work</em></span>.</p> <pre class="programlisting"><span class="hl-comment">// ...</span>

<i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
<span class="hl-keyword">private</span> SessionFactory sessionFactory;

<i><span class="hl-annotation" style="color: gray">@Test</span></i> <span class="hl-comment">// no expected exception!</span>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> falsePositive() {
    updateEntityInHibernateSession();
    <span class="hl-comment">// False positive: an exception will be thrown once the session is</span>
    <span class="hl-comment">// finally flushed (i.e., in production code)</span>
}

<i><span class="hl-annotation" style="color: gray">@Test(expected = GenericJDBCException.class)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">void</span> updateWithSessionFlush() {
    updateEntityInHibernateSession();
    <span class="hl-comment">// Manual flush is required to avoid false positive in test</span>
    sessionFactory.getCurrentSession().flush();
}

<span class="hl-comment">// ...</span></pre> </td>
        </tr>
       </tbody>
      </table>
     </div> 
    </div> 
    <div class="section" title="TestContext Framework support classes">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="testcontext-support-classes"></a>TestContext Framework support classes</h4>
       </div>
      </div>
     </div> 
     <div class="section" title="JUnit support classes">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="testcontext-support-classes-junit4"></a>JUnit support classes</h5>
        </div>
       </div>
      </div> 
      <p>The <code class="literal">org.springframework.test.context.junit4</code> package provides support classes for JUnit 4.5+ based test cases.</p> 
      <div class="itemizedlist">
       <ul class="itemizedlist" type="disc">
        <li class="listitem"> <p class="simpara"><code class="literal">AbstractJUnit4SpringContextTests</code>: Abstract base test class that integrates the <span class="emphasis"><em>Spring TestContext Framework</em></span> with explicit <code class="literal">ApplicationContext</code> testing support in a JUnit 4.5+ environment.</p> <p class="simpara">When you extend <code class="literal">AbstractJUnit4SpringContextTests</code>, you can access the following <code class="literal">protected</code> instance variable:</p> 
         <div class="itemizedlist">
          <ul class="itemizedlist" type="circle">
           <li class="listitem"> <code class="literal">applicationContext</code>: Use this variable to perform explicit bean lookups or to test the state of the context as a whole. </li>
          </ul>
         </div> </li>
        <li class="listitem"> <p class="simpara"><code class="literal">AbstractTransactionalJUnit4SpringContextTests</code>: Abstract <span class="emphasis"><em>transactional</em></span> extension of <code class="literal">AbstractJUnit4SpringContextTests</code> that also adds some convenience functionality for JDBC access. Expects a <code class="literal">javax.sql.DataSource</code> bean and a <code class="literal">PlatformTransactionManager</code> bean to be defined in the <code class="literal">ApplicationContext</code>. When you extend <code class="literal">AbstractTransactionalJUnit4SpringContextTests</code> you can access the following <code class="literal">protected</code> instance variables:</p> 
         <div class="itemizedlist">
          <ul class="itemizedlist" type="circle">
           <li class="listitem"> <code class="literal">applicationContext</code>: Inherited from the <code class="literal">AbstractJUnit4SpringContextTests</code> superclass. Use this variable to perform explicit bean lookups or to test the state of the context as a whole. </li>
           <li class="listitem"> <code class="literal">jdbcTemplate</code>: Use this variable to execute SQL statements to query the database. Such queries can be used to confirm database state both <span class="emphasis"><em>prior to</em></span> and <span class="emphasis"><em>after</em></span> execution of database-related application code, and Spring ensures that such queries run in the scope of the same transaction as the application code. When used in conjunction with an ORM tool, be sure to avoid <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#">false positives</a>. </li>
          </ul>
         </div> 
         <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
           <tbody>
            <tr>
             <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
             <th align="left">Tip</th>
            </tr>
            <tr>
             <td align="left" valign="top"> <p>These classes are a convenience for extension. If you do not want your test classes to be tied to a Spring-specific class hierarchy&#x2009;&#x2009;for example, if you want to directly extend the class you are testing&#x2009;&#x2009;you can configure your own custom test classes by using <code class="literal">@RunWith(SpringJUnit4ClassRunner.class)</code>, <code class="literal">@ContextConfiguration</code>, <code class="literal">@TestExecutionListeners</code>, and so on.</p> </td>
            </tr>
           </tbody>
          </table>
         </div> </li>
       </ul>
      </div> 
     </div> 
     <div class="section" title="Spring JUnit Runner">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="testcontext-junit4-runner"></a>Spring JUnit Runner</h5>
        </div>
       </div>
      </div> 
      <p>The <span class="emphasis"><em>Spring TestContext Framework</em></span> offers full integration with JUnit 4.5+ through a custom runner (tested on JUnit 4.5&#x2009;&#x2009;4.11). By annotating test classes with <code class="literal">@RunWith(SpringJUnit4ClassRunner.class)</code>, developers can implement standard JUnit-based unit and integration tests and simultaneously reap the benefits of the TestContext framework such as support for loading application contexts, dependency injection of test instances, transactional test method execution, and so on. The following code listing displays the minimal requirements for configuring a test class to run with the custom Spring Runner. <code class="literal">@TestExecutionListeners</code> is configured with an empty list in order to disable the default listeners, which otherwise would require an ApplicationContext to be configured through <code class="literal">@ContextConfiguration</code>.</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<i><span class="hl-annotation" style="color: gray">@TestExecutionListeners({})</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> SimpleTest {

    <i><span class="hl-annotation" style="color: gray">@Test</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> testMethod() {
        <span class="hl-comment">// execute test logic...</span>
    }
}</pre> 
     </div> 
     <div class="section" title="TestNG support classes">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="testcontext-support-classes-testng"></a>TestNG support classes</h5>
        </div>
       </div>
      </div> 
      <p>The <code class="literal">org.springframework.test.context.testng</code> package provides support classes for TestNG based test cases.</p> 
      <div class="itemizedlist">
       <ul class="itemizedlist" type="disc">
        <li class="listitem"> <p class="simpara"><code class="literal">AbstractTestNGSpringContextTests</code>: Abstract base test class that integrates the <span class="emphasis"><em>Spring TestContext Framework</em></span> with explicit <code class="literal">ApplicationContext</code> testing support in a TestNG environment.</p> <p class="simpara">When you extend <code class="literal">AbstractTestNGSpringContextTests</code>, you can access the following <code class="literal">protected</code> instance variable:</p> 
         <div class="itemizedlist">
          <ul class="itemizedlist" type="circle">
           <li class="listitem"> <code class="literal">applicationContext</code>: Use this variable to perform explicit bean lookups or to test the state of the context as a whole. </li>
           <li class="listitem"> <code class="literal">AbstractTransactionalTestNGSpringContextTests</code>: Abstract <span class="emphasis"><em>transactional</em></span> extension of <code class="literal">AbstractTestNGSpringContextTests</code> that adds some convenience functionality for JDBC access. Expects a <code class="literal">javax.sql.DataSource</code> bean and a <code class="literal">PlatformTransactionManager</code> bean to be defined in the <code class="literal">ApplicationContext</code>. When you extend <code class="literal">AbstractTransactionalTestNGSpringContextTests</code>, you can access the following <code class="literal">protected</code> instance variables: </li>
           <li class="listitem"> <code class="literal">applicationContext</code>: Inherited from the <code class="literal">AbstractTestNGSpringContextTests</code> superclass. Use this variable to perform explicit bean lookups or to test the state of the context as a whole. </li>
           <li class="listitem"> <code class="literal">jdbcTemplate</code>: Use this variable to execute SQL statements to query the database. Such queries can be used to confirm database state both <span class="emphasis"><em>prior to</em></span> and <span class="emphasis"><em>after</em></span> execution of database-related application code, and Spring ensures that such queries run in the scope of the same transaction as the application code. When used in conjunction with an ORM tool, be sure to avoid <a class="link" href="http://docs.spring.io/spring/docs/4.0.0.RELEASE/spring-framework-reference/htmlsingle/#">false positives</a>. </li>
          </ul>
         </div> 
         <div class="tip" title="Tip" style="margin-left: 0.5in; margin-right: 0.5in;">
          <table border="0" summary="Tip">
           <tbody>
            <tr>
             <td rowspan="2" align="center" valign="top" width="25"><img alt="[Tip]" src="./Spring Framework Reference Documentation_files/tip.png" /></td>
             <th align="left">Tip</th>
            </tr>
            <tr>
             <td align="left" valign="top"> <p>These classes are a convenience for extension. If you do not want your test classes to be tied to a Spring-specific class hierarchy&#x2009;&#x2009;for example, if you want to directly extend the class you are testing&#x2009;&#x2009;you can configure your own custom test classes by using <code class="literal">@ContextConfiguration</code>, <code class="literal">@TestExecutionListeners</code>, and so on, and by manually instrumenting your test class with a <code class="literal">TestContextManager</code>. See the source code of <code class="literal">AbstractTestNGSpringContextTests</code> for an example of how to instrument your test class.</p> </td>
            </tr>
           </tbody>
          </table>
         </div> </li>
       </ul>
      </div> 
     </div> 
    </div> 
   </div> 
   <div class="section" title="10.3.6&nbsp;Spring MVC Test Framework">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="spring-mvc-test-framework"></a>10.3.6&nbsp;Spring MVC Test Framework</h3>
      </div>
     </div>
    </div> 
    <div class="sidebar" title="Standalone project">
     <p class="title"><b>Standalone project</b></p> 
     <p>Before inclusion in Spring Framework 3.2, the Spring MVC Test framework had already existed as a separate project on GitHub where it grew and evolved through actual use, feedback, and the contribution of many.</p> 
     <p>The standalone <a class="ulink" href="https://github.com/SpringSource/spring-test-mvc" target="_top">spring-test-mvc project</a> is still available on GitHub and can be used in conjunction with Spring Framework 3.1.x. Applications upgrading to 3.2 or later should replace the <code class="literal">spring-test-mvc</code> dependency with a dependency on <code class="literal">spring-test</code>.</p> 
     <p>The <code class="literal">spring-test</code> module uses a different package <code class="literal">org.springframework.test.web</code> but otherwise is nearly identical with two exceptions. One is support for features new in 3.2 (e.g. asynchronous web requests). The other relates to the options for creating a <code class="literal">MockMvc</code> instance. In Spring Framework 3.2 and later, this can only be done through the TestContext framework, which provides caching benefits for the loaded configuration.</p> 
    </div> 
    <p>The <span class="emphasis"><em>Spring MVC Test framework</em></span> provides first class JUnit support for testing client and server-side Spring MVC code through a fluent API. Typically it loads the actual Spring configuration through the <span class="emphasis"><em>TestContext framework</em></span> and always uses the <code class="literal">DispatcherServlet</code> to process requests thus approximating full integration tests without requiring a running Servlet container.</p> 
    <p>Client-side tests are <code class="literal">RestTemplate</code>-based and allow tests for code that relies on the <code class="literal">RestTemplate</code> without requiring a running server to respond to the requests.</p> 
    <div class="section" title="Server-Side Tests">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="spring-mvc-test-server"></a>Server-Side Tests</h4>
       </div>
      </div>
     </div> 
     <p>Before Spring Framework 3.2, the most likely way to test a Spring MVC controller was to write a unit test that instantiates the controller, injects it with mock or stub dependencies, and then calls its methods directly, using a <code class="literal">MockHttpServletRequest</code> and <code class="literal">MockHttpServletResponse</code> where necessary.</p> 
     <p>Although this is pretty easy to do, controllers have many annotations, and much remains untested. Request mappings, data binding, type conversion, and validation are just a few examples of what isnt tested. Furthermore, there are other types of annotated methods such as <code class="literal">@InitBinder</code>, <code class="literal">@ModelAttribute</code>, and <code class="literal">@ExceptionHandler</code> that get invoked as part of request processing.</p> 
     <p>The idea behind Spring MVC Test is to be able to re-write those controller tests by performing actual requests and generating responses, as they would be at runtime, along the way invoking controllers through the Spring MVC <code class="literal">DispatcherServlet</code>. Controllers can still be injected with mock dependencies, so tests can remain focused on the web layer.</p> 
     <p>Spring MVC Test builds on the familiar &quot;mock&quot; implementations of the Servlet API available in the <code class="literal">spring-test</code> module. This allows performing requests and generating responses without the need for running in a Servlet container. For the most part everything should work as it does at runtime with the exception of JSP rendering, which is not available outside a Servlet container. Furthermore, if you are familiar with how the <code class="literal">MockHttpServletResponse</code> works, youll know that forwards and redirects are not actually executed. Instead &quot;forwarded&quot; and &quot;redirected&quot; URLs are saved and can be asserted in tests. This means if you are using JSPs, you can verify the JSP page to which the request was forwarded.</p> 
     <p>All other means of rendering including <code class="literal">@ResponseBody</code> methods and <code class="literal">View</code> types (besides JSPs) such as Freemarker, Velocity, Thymeleaf, and others for rendering HTML, JSON, XML, and so on should work as expected, and the response will contain the generated content.</p> 
     <p>Below is an example of a test requesting account information in JSON format:</p> 
     <pre class="programlisting"><span class="hl-keyword">import</span> <span class="hl-keyword">static</span> org.springframework.test.web.servlet.request.MockMvcRequestBuilders.*;
<span class="hl-keyword">import</span> <span class="hl-keyword">static</span> org.springframework.test.web.servlet.result.MockMvcResultMatchers.*;

<i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<i><span class="hl-annotation" style="color: gray">@WebAppConfiguration</span></i>
<i><span class="hl-annotation" style="color: gray">@ContextConfiguration(&quot;test-servlet-context.xml&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> ExampleTests {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> WebApplicationContext wac;

    <span class="hl-keyword">private</span> MockMvc mockMvc;

    <i><span class="hl-annotation" style="color: gray">@Before</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setup() {
        <span class="hl-keyword">this</span>.mockMvc = MockMvcBuilders.webAppContextSetup(<span class="hl-keyword">this</span>.wac).build();
    }

    <i><span class="hl-annotation" style="color: gray">@Test</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> getAccount() <span class="hl-keyword">throws</span> Exception {
        <span class="hl-keyword">this</span>.mockMvc.perform(get(<span class="hl-string">&quot;/accounts/1&quot;</span>).accept(MediaType.parseMediaType(<span class="hl-string">&quot;application/json;charset=UTF-8&quot;</span>)))
            .andExpect(status().isOk())
            .andExpect(content().contentType(<span class="hl-string">&quot;application/json&quot;</span>))
            .andExpect(jsonPath(<span class="hl-string">&quot;$.name&quot;</span>).value(<span class="hl-string">&quot;Lee&quot;</span>));
    }

}</pre> 
     <p>The test relies on the <code class="literal">WebApplicationContext</code> support of the <span class="emphasis"><em>TestContext framework</em></span>. It loads Spring configuration from an XML configuration file located in the same package as the test class (also supports JavaConfig) and injects the created <code class="literal">WebApplicationContext</code> into the test so a <code class="literal">MockMvc</code> instance can be created with it.</p> 
     <p>The <code class="literal">MockMvc</code> is then used to perform a request to <code class="literal">&quot;/accounts/1&quot;</code> and verify the resulting response status is 200, the response content type is <code class="literal">&quot;application/json&quot;</code>, and response content has a JSON property called &quot;name&quot; with the value &quot;Lee&quot;. JSON content is inspected with the help of Jayways <a class="ulink" href="https://github.com/jayway/JsonPath" target="_top">JsonPath project</a>. There are lots of other options for verifying the result of the performed request and those will be discussed later.</p> 
     <div class="section" title="Static Imports">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="spring-mvc-test-server-static-imports"></a>Static Imports</h5>
        </div>
       </div>
      </div> 
      <p>The fluent API in the example above requires a few static imports such as <code class="literal">MockMvcRequestBuilders.*</code>, <code class="literal">MockMvcResultMatchers.*</code>, and <code class="literal">MockMvcBuilders.*</code>. An easy way to find these classes is to search for types matching <span class="emphasis"><em>&quot;MockMvc*&quot;</em></span>. If using Eclipse, be sure to add them as &quot;favorite static members&quot; in the Eclipse preferences under<span class="emphasis"><em>Java &#x2192; Editor &#x2192; Content Assist &#x2192; Favorites</em></span>. That will allow use of content assist after typing the first character of the static method name. Other IDEs (e.g. IntelliJ) may not require any additional configuration. Just check the support for code completion on static members.</p> 
     </div> 
     <div class="section" title="Setup Options">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="spring-mvc-test-server-setup-options"></a>Setup Options</h5>
        </div>
       </div>
      </div> 
      <p>The goal of server-side test setup is to create an instance of <code class="literal">MockMvc</code> that can be used to perform requests. There are two main options.</p> 
      <p>The first option is to point to Spring MVC configuration through the <span class="emphasis"><em>TestContext framework</em></span>, which loads the Spring configuration and injects a <code class="literal">WebApplicationContext</code> into the test to use to create a <code class="literal">MockMvc</code>:</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<i><span class="hl-annotation" style="color: gray">@WebAppConfiguration</span></i>
<i><span class="hl-annotation" style="color: gray">@ContextConfiguration(&quot;my-servlet-context.xml&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWebTests {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> WebApplicationContext wac;

    <span class="hl-keyword">private</span> MockMvc mockMvc;

    <i><span class="hl-annotation" style="color: gray">@Before</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setup() {
        <span class="hl-keyword">this</span>.mockMvc = MockMvcBuilders.webAppContextSetup(<span class="hl-keyword">this</span>.wac).build();
    }

    <span class="hl-comment">// ...</span>

}</pre> 
      <p>The second option is to simply register a controller instance without loading any Spring configuration. Instead basic Spring MVC configuration suitable for testing annotated controllers is automatically created. The created configuration is comparable to that of the MVC JavaConfig (and the MVC namespace) and can be customized to a degree through builder-style methods:</p> 
      <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWebTests {

    <span class="hl-keyword">private</span> MockMvc mockMvc;

    <i><span class="hl-annotation" style="color: gray">@Before</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setup() {
        <span class="hl-keyword">this</span>.mockMvc = MockMvcBuilders.standaloneSetup(<span class="hl-keyword">new</span> AccountController()).build();
    }

    <span class="hl-comment">// ...</span>

}</pre> 
      <p>Which option should you use?</p> 
      <p>The <span class="emphasis"><em>&quot;webAppContextSetup&quot;</em></span> loads the actual Spring MVC configuration resulting in a more complete integration test. Since the <span class="emphasis"><em>TestContext framework</em></span> caches the loaded Spring configuration, it helps to keep tests running fast even as more tests get added. Furthermore, you can inject mock services into controllers through Spring configuration, in order to remain focused on testing the web layer. Here is an example of declaring a mock service with Mockito:</p> 
      <pre class="programlisting"><span class="hl-tag">&lt;bean</span> <span class="hl-attribute">id</span>=<span class="hl-value">&quot;accountService&quot;</span> <span class="hl-attribute">class</span>=<span class="hl-value">&quot;org.mockito.Mockito&quot;</span> <span class="hl-attribute">factory-method</span>=<span class="hl-value">&quot;mock&quot;</span><span class="hl-tag">&gt;</span>
    <span class="hl-tag">&lt;constructor-arg</span> <span class="hl-attribute">value</span>=<span class="hl-value">&quot;org.example.AccountService&quot;</span><span class="hl-tag">/&gt;</span>
<span class="hl-tag">&lt;/bean&gt;</span></pre> 
      <p>Then you can inject the mock service into the test in order set up and verify expectations:</p> 
      <pre class="programlisting"><i><span class="hl-annotation" style="color: gray">@RunWith(SpringJUnit4ClassRunner.class)</span></i>
<i><span class="hl-annotation" style="color: gray">@WebAppConfiguration</span></i>
<i><span class="hl-annotation" style="color: gray">@ContextConfiguration(&quot;test-servlet-context.xml&quot;)</span></i>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> AccountTests {

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> WebApplicationContext wac;

    <span class="hl-keyword">private</span> MockMvc mockMvc;

    <i><span class="hl-annotation" style="color: gray">@Autowired</span></i>
    <span class="hl-keyword">private</span> AccountService accountService;

    <span class="hl-comment">// ...</span>

}</pre> 
      <p>The <span class="emphasis"><em>&quot;standaloneSetup&quot;</em></span> on the other hand is a little closer to a unit test. It tests one controller at a time, the controller can be injected with mock dependencies manually, and it doesnt involve loading Spring configuration. Such tests are more focused in style and make it easier to see which controller is being tested, whether any specific Spring MVC configuration is required to work, and so on. The &quot;standaloneSetup&quot; is also a very convenient way to write ad-hoc tests to verify some behavior or to debug an issue.</p> 
      <p>Just like with integration vs unit testing, there is no right or wrong answer. Using the &quot;standaloneSetup&quot; does imply the need for some additional &quot;webAppContextSetup&quot; tests to verify the Spring MVC configuration. Alternatively, you can decide write all tests with &quot;webAppContextSetup&quot; and always test against actual Spring MVC configuration.</p> 
     </div> 
     <div class="section" title="Performing Requests">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="spring-mvc-test-server-performing-requests"></a>Performing Requests</h5>
        </div>
       </div>
      </div> 
      <p>To perform requests, use the appropriate HTTP method and additional builder-style methods corresponding to properties of <code class="literal">MockHttpServletRequest</code>. For example:</p> 
      <pre class="programlisting">mockMvc.perform(post(<span class="hl-string">&quot;/hotels/{id}&quot;</span>, <span class="hl-number">42</span>).accept(MediaType.APPLICATION_JSON));</pre> 
      <p>In addition to all the HTTP methods, you can also perform file upload requests, which internally creates an instance of <code class="literal">MockMultipartHttpServletRequest</code>:</p> 
      <pre class="programlisting">mockMvc.perform(fileUpload(<span class="hl-string">&quot;/doc&quot;</span>).file(<span class="hl-string">&quot;a1&quot;</span>, <span class="hl-string">&quot;ABC&quot;</span>.getBytes(<span class="hl-string">&quot;UTF-8&quot;</span>)));</pre> 
      <p>Query string parameters can be specified in the URI template:</p> 
      <pre class="programlisting">mockMvc.perform(get(<span class="hl-string">&quot;/hotels?foo={foo}&quot;</span>, <span class="hl-string">&quot;bar&quot;</span>));</pre> 
      <p>Or by adding Servlet request parameters:</p> 
      <pre class="programlisting">mockMvc.perform(get(<span class="hl-string">&quot;/hotels&quot;</span>).param(<span class="hl-string">&quot;foo&quot;</span>, <span class="hl-string">&quot;bar&quot;</span>));</pre> 
      <p>If application code relies on Servlet request parameters, and doesnt check the query string, as is most often the case, then it doesnt matter how parameters are added. Keep in mind though that parameters provided in the URI template will be decoded while parameters provided through the <code class="literal">param(...)</code> method are expected to be decoded.</p> 
      <p>In most cases its preferable to leave out the context path and the Servlet path from the request URI. If you must test with the full request URI, be sure to set the <code class="literal">contextPath</code> and <code class="literal">servletPath</code> accordingly so that request mappings will work:</p> 
      <pre class="programlisting">mockMvc.perform(get(<span class="hl-string">&quot;/app/main/hotels/{id}&quot;</span>).contextPath(<span class="hl-string">&quot;/app&quot;</span>).servletPath(<span class="hl-string">&quot;/main&quot;</span>))</pre> 
      <p>Looking at the above example, it would be cumbersome to set the contextPath and servletPath with every performed request. Thats why you can define default request properties when building the <code class="literal">MockMvc</code>:</p> 
      <pre class="programlisting"><span class="hl-keyword">public</span> <span class="hl-keyword">class</span> MyWebTests {

    <span class="hl-keyword">private</span> MockMvc mockMvc;

    <i><span class="hl-annotation" style="color: gray">@Before</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> setup() {
        mockMvc = standaloneSetup(<span class="hl-keyword">new</span> AccountController())
            .defaultRequest(get(<span class="hl-string">&quot;/&quot;</span>)
            .contextPath(<span class="hl-string">&quot;/app&quot;</span>).servletPath(<span class="hl-string">&quot;/main&quot;</span>)
            .accept(MediaType.APPLICATION_JSON).build();
    }</pre> 
      <p>The above properties will apply to every request performed through the <code class="literal">MockMvc</code>. If the same property is also specified on a given request, it will override the default value. That is why, the HTTP method and URI dont matter, when setting default request properties, since they must be specified on every request.</p> 
     </div> 
     <div class="section" title="Defining Expectations">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="spring-mvc-test-server-defining-expectations"></a>Defining Expectations</h5>
        </div>
       </div>
      </div> 
      <p>Expectations can be defined by appending one or more <code class="literal">.andExpect(..)</code> after call to perform the request:</p> 
      <pre class="programlisting">mockMvc.perform(get(<span class="hl-string">&quot;/accounts/1&quot;</span>)).andExpect(status().isOk());</pre> 
      <p><code class="literal">MockMvcResultMatchers.*</code> defines a number of static members, some of which return types with additional methods, for asserting the result of the performed request. The assertions fall in two general categories.</p> 
      <p>The first category of assertions verify properties of the response, i.e the response status, headers, and content. Those are the most important things to test for.</p> 
      <p>The second category of assertions go beyond the response, and allow inspecting Spring MVC specific constructs such as which controller method processed the request, whether an exception was raised and handled, what the content of the model is, what view was selected, what flash attributes were added, and so on. It is also possible to verify Servlet specific constructs such as request and session attributes. The following test asserts that binding/validation failed:</p> 
      <pre class="programlisting">mockMvc.perform(post(<span class="hl-string">&quot;/persons&quot;</span>))
    .andExpect(status().isOk())
    .andExpect(model().attributeHasErrors(<span class="hl-string">&quot;person&quot;</span>));</pre> 
      <p>Many times when writing tests, its useful to dump the result of the performed request. This can be done as follows, where <code class="literal">print()</code> is a static import from <code class="literal">MockMvcResultHandlers</code>:</p> 
      <pre class="programlisting">mockMvc.perform(post(<span class="hl-string">&quot;/persons&quot;</span>))
    .andDo(print())
    .andExpect(status().isOk())
    .andExpect(model().attributeHasErrors(<span class="hl-string">&quot;person&quot;</span>));</pre> 
      <p>As long as request processing causes an unhandled exception, the <code class="literal">print()</code> method will print all the available result data to <code class="literal">System.out</code>.</p> 
      <p>In some cases, you may want to get direct access to the result and verify something that cannot be verified otherwise. This can be done by appending <code class="literal">.andReturn()</code> at the end after all expectations:</p> 
      <pre class="programlisting">MvcResult mvcResult = mockMvc.perform(post(<span class="hl-string">&quot;/persons&quot;</span>)).andExpect(status().isOk()).andReturn();
<span class="hl-comment">// ...</span></pre> 
      <p>When all tests repeat the same expectations, you can define the common expectations once when building the <code class="literal">MockMvc</code>:</p> 
      <pre class="programlisting">standaloneSetup(<span class="hl-keyword">new</span> SimpleController())
    .alwaysExpect(status().isOk())
    .alwaysExpect(content().contentType(<span class="hl-string">&quot;application/json;charset=UTF-8&quot;</span>))
    .build()</pre> 
      <p>Note that the expectation is <span class="emphasis"><em>always</em></span> applied and cannot be overridden without creating a separate <code class="literal">MockMvc</code> instance.</p> 
      <p>When JSON response content contains hypermedia links created with <a class="ulink" href="https://github.com/SpringSource/spring-hateoas" target="_top">Spring HATEOAS</a>, the resulting links can be verified:</p> 
      <pre class="programlisting">mockMvc.perform(get(<span class="hl-string">&quot;/people&quot;</span>).accept(MediaType.APPLICATION_JSON))
    .andExpect(jsonPath(<span class="hl-string">&quot;$.links[?(@.rel == </span><span class="emphasis"><em>self</em></span>)].href<span class="hl-string">&quot;).value(&quot;</span>http:<span class="hl-comment">//localhost:8080/people&quot;));</span></pre> 
      <p>When XML response content contains hypermedia links created with <a class="ulink" href="https://github.com/SpringSource/spring-hateoas" target="_top">Spring HATEOAS</a>, the resulting links can be verified:</p> 
      <pre class="programlisting">Map&lt;String, String&gt; ns = Collections.singletonMap(<span class="hl-string">&quot;ns&quot;</span>, <span class="hl-string">&quot;http://www.w3.org/2005/Atom&quot;</span>);
mockMvc.perform(get(<span class="hl-string">&quot;/handle&quot;</span>).accept(MediaType.APPLICATION_XML))
    .andExpect(xpath(<span class="hl-string">&quot;/person/ns:link[@rel=</span><span class="emphasis"><em>self</em></span>]/<i><span class="hl-annotation" style="color: gray">@href&quot;,</span></i> ns).string(<span class="hl-string">&quot;http://localhost:8080/people&quot;</span>));</pre> 
     </div> 
     <div class="section" title="Filter Registrations">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="spring-mvc-test-server-filters"></a>Filter Registrations</h5>
        </div>
       </div>
      </div> 
      <p>When setting up a <code class="literal">MockMvc</code>, you can register one or more <code class="literal">Filter</code> instances:</p> 
      <pre class="programlisting">mockMvc = standaloneSetup(<span class="hl-keyword">new</span> PersonController()).addFilters(<span class="hl-keyword">new</span> CharacterEncodingFilter()).build();</pre> 
      <p>Registered filters will be invoked through <code class="literal">MockFilterChain</code> from <code class="literal">spring-test</code> and the last filter will delegates to the <code class="literal">DispatcherServlet</code>.</p> 
     </div> 
     <div class="section" title="Further Server-Side Test Examples">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="spring-mvc-test-server-resources"></a>Further Server-Side Test Examples</h5>
        </div>
       </div>
      </div> 
      <p>The frameworks own tests include <a class="ulink" href="https://github.com/SpringSource/spring-framework/tree/master/spring-test/src/test/java/org/springframework/test/web/servlet/samples" target="_top">many sample tests</a> intended to demonstrate how to use Spring MVC Test. Browse these examples for further ideas. Also the <a class="ulink" href="https://github.com/SpringSource/spring-mvc-showcase" target="_top">spring-mvc-showcase</a> has full test coverage based on Spring MVC Test.</p> 
     </div> 
    </div> 
    <div class="section" title="Client-Side REST Tests">
     <div class="titlepage">
      <div>
       <div>
        <h4 class="title"><a name="spring-mvc-test-client"></a>Client-Side REST Tests</h4>
       </div>
      </div>
     </div> 
     <p>Client-side tests are for code using the <code class="literal">RestTemplate</code>. The goal is to define expected requests and provide &quot;stub&quot; responses:</p> 
     <pre class="programlisting">RestTemplate restTemplate = <span class="hl-keyword">new</span> RestTemplate();

MockRestServiceServer mockServer = MockRestServiceServer.createServer(restTemplate);
mockServer.expect(requestTo(<span class="hl-string">&quot;/greeting&quot;</span>)).andRespond(withSuccess(<span class="hl-string">&quot;Hello world&quot;</span>, <span class="hl-string">&quot;text/plain&quot;</span>));

<span class="hl-comment">// use RestTemplate ...</span>

mockServer.verify();</pre> 
     <p>In the above example, <code class="literal">MockRestServiceServer</code>&#x2009;&#x2009;the central class for client-side REST tests&#x2009;&#x2009;configures the <code class="literal">RestTemplate</code> with a custom <code class="literal">ClientHttpRequestFactory</code> that asserts actual requests against expectations and returns &quot;stub&quot; responses. In this case we expect a single request to &quot;/greeting&quot; and want to return a 200 response with &quot;text/plain&quot; content. We could define as many additional requests and stub responses as necessary.</p> 
     <p>Once expected requests and stub responses have been defined, the <code class="literal">RestTemplate</code> can be used in client-side code as usual. At the end of the tests <code class="literal">mockServer.verify()</code> can be used to verify that all expected requests were performed.</p> 
     <div class="section" title="Static Imports">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="spring-mvc-test-client-static-imports"></a>Static Imports</h5>
        </div>
       </div>
      </div> 
      <p>Just like with server-side tests, the fluent API for client-side tests requires a few static imports. Those are easy to find by searching <span class="emphasis"><em>&quot;MockRest*&quot;</em></span>. Eclipse users should add <code class="literal">&quot;MockRestRequestMatchers.*&quot;</code> and <code class="literal">&quot;MockRestResponseCreators.*&quot;</code> as &quot;favorite static members&quot; in the Eclipse preferences under <span class="emphasis"><em>Java &#x2192; Editor &#x2192; Content Assist &#x2192; Favorites</em></span>. That allows using content assist after typing the first character of the static method name. Other IDEs (e.g. IntelliJ) may not require any additional configuration. Just check the support for code completion on static members.</p> 
     </div> 
     <div class="section" title="Further Examples of Client-side REST Tests">
      <div class="titlepage">
       <div>
        <div>
         <h5 class="title"><a name="spring-mvc-test-client-resources"></a>Further Examples of Client-side REST Tests</h5>
        </div>
       </div>
      </div> 
      <p>Spring MVC Tests own tests include <a class="ulink" href="https://github.com/SpringSource/spring-framework/tree/master/spring-test/src/test/java/org/springframework/test/web/client/samples" target="_top">example tests</a> of client-side REST tests.</p> 
     </div> 
    </div> 
   </div> 
   <div class="section" title="10.3.7&nbsp;PetClinic Example">
    <div class="titlepage">
     <div>
      <div>
       <h3 class="title"><a name="testing-examples-petclinic"></a>10.3.7&nbsp;PetClinic Example</h3>
      </div>
     </div>
    </div> 
    <p>The PetClinic application, available on <a class="ulink" href="https://github.com/spring-projects/spring-petclinic" target="_top">Github</a>, illustrates several features of the <span class="emphasis"><em>Spring TestContext Framework</em></span> in a JUnit 4.5+ environment. Most test functionality is included in the <code class="literal">AbstractClinicTests</code>, for which a partial listing is shown below:</p> 
    <pre class="programlisting"><span class="hl-keyword">import</span> <span class="hl-keyword">static</span> org.junit.Assert.assertEquals;
<span class="hl-comment">// import ...</span>

<span class="strong"><strong>@ContextConfiguration</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">abstract</span> <span class="hl-keyword">class</span> AbstractClinicTests <span class="strong"><strong>extends AbstractTransactionalJUnit4SpringContextTests</strong></span> {

    <span class="strong"><strong>@Autowired</strong></span>
    <span class="hl-keyword">protected</span> Clinic clinic;

    <i><span class="hl-annotation" style="color: gray">@Test</span></i>
    <span class="hl-keyword">public</span> <span class="hl-keyword">void</span> getVets() {
        Collection&lt;Vet&gt; vets = <span class="hl-keyword">this</span>.clinic.getVets();
        assertEquals(<span class="hl-string">&quot;JDBC query must show the same number of vets&quot;</span>,
            <span class="strong"><strong>super.countRowsInTable(&quot;VETS&quot;)</strong></span>, vets.size());
        Vet v1 = EntityUtils.getById(vets, Vet.<span class="hl-keyword">class</span>, <span class="hl-number">2</span>);
        assertEquals(<span class="hl-string">&quot;Leary&quot;</span>, v1.getLastName());
        assertEquals(<span class="hl-number">1</span>, v1.getNrOfSpecialties());
        assertEquals(<span class="hl-string">&quot;radiology&quot;</span>, (v1.getSpecialties().get(<span class="hl-number">0</span>)).getName());
        <span class="hl-comment">// ...</span>
    }

    <span class="hl-comment">// ...</span>
}</pre> 
    <p>Notes:</p> 
    <div class="itemizedlist">
     <ul class="itemizedlist" type="disc">
      <li class="listitem"> This test case extends the <code class="literal">AbstractTransactionalJUnit4SpringContextTests</code> class, from which it inherits configuration for Dependency Injection (through the <code class="literal">DependencyInjectionTestExecutionListener</code>) and transactional behavior (through the <code class="literal">TransactionalTestExecutionListener</code>). </li>
      <li class="listitem"> The <code class="literal">clinic</code> instance variable&#x2009;&#x2009;the application object being tested&#x2009;&#x2009;is set by Dependency Injection through <code class="literal">@Autowired</code> semantics. </li>
      <li class="listitem"> The <code class="literal">testGetVets()</code> method illustrates how you can use the inherited <code class="literal">countRowsInTable()</code> method to easily verify the number of rows in a given table, thus verifying correct behavior of the application code being tested. This allows for stronger tests and lessens dependency on the exact test data. For example, you can add additional rows in the database without breaking tests. </li>
      <li class="listitem"> Like many integration tests that use a database, most of the tests in <code class="literal">AbstractClinicTests</code> depend on a minimum amount of data already in the database before the test cases run. Alternatively, you might choose to populate the database within the test fixture set up of your test cases&#x2009;&#x2009;again, within the same transaction as the tests. </li>
     </ul>
    </div> 
    <p>The PetClinic application supports three data access technologies: JDBC, Hibernate, and JPA. By declaring <code class="literal">@ContextConfiguration</code> without any specific resource locations, the <code class="literal">AbstractClinicTests</code> class will have its application context loaded from the default location, <code class="literal">AbstractClinicTests-context.xml</code>, which declares a common <code class="literal">DataSource</code>. Subclasses specify additional context locations that must declare a <code class="literal">PlatformTransactionManager</code> and a concrete implementation of <code class="literal">Clinic</code>.</p> 
    <p>For example, the Hibernate implementation of the PetClinic tests contains the following implementation. For this example, <code class="literal">HibernateClinicTests</code> does not contain a single line of code: we only need to declare <code class="literal">@ContextConfiguration</code>, and the tests are inherited from <code class="literal">AbstractClinicTests</code>. Because <code class="literal">@ContextConfiguration</code> is declared without any specific resource locations, the <span class="emphasis"><em>Spring TestContext Framework</em></span> loads an application context from all the beans defined in <code class="literal">AbstractClinicTests-context.xml</code> (i.e., the inherited locations) and <code class="literal">HibernateClinicTests-context.xml</code>, with <code class="literal">HibernateClinicTests-context.xml</code> possibly overriding beans defined in <code class="literal">AbstractClinicTests-context.xml</code>.</p> 
    <pre class="programlisting"><span class="strong"><strong>@ContextConfiguration</strong></span>
<span class="hl-keyword">public</span> <span class="hl-keyword">class</span> HibernateClinicTests <span class="hl-keyword">extends</span> AbstractClinicTests { }</pre> 
    <p>In a large-scale application, the Spring configuration is often split across multiple files. Consequently, configuration locations are typically specified in a common base class for all application-specific integration tests. Such a base class may also add useful instance variables&#x2009;&#x2009;populated by Dependency Injection, naturally&#x2009;&#x2009;such as a <code class="literal">SessionFactory</code> in the case of an application using Hibernate.</p> 
    <p>As far as possible, you should have exactly the same Spring configuration files in your integration tests as in the deployed environment. One likely point of difference concerns database connection pooling and transaction infrastructure. If you are deploying to a full-blown application server, you will probably use its connection pool (available through JNDI) and JTA implementation. Thus in production you will use a <code class="literal">JndiObjectFactoryBean</code> or <code class="literal">&lt;jee:jndi-lookup&gt;</code> for the <code class="literal">DataSource</code> and <code class="literal">JtaTransactionManager</code>. JNDI and JTA will not be available in out-of-container integration tests, so you should use a combination like the Commons DBCP <code class="literal">BasicDataSource</code> and <code class="literal">DataSourceTransactionManager</code> or <code class="literal">HibernateTransa